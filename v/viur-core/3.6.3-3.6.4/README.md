# Comparing `tmp/viur_core-3.6.3-py3-none-any.whl.zip` & `tmp/viur_core-3.6.4-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,8 +1,8 @@
-Zip file size: 323740 bytes, number of entries: 100
+Zip file size: 324362 bytes, number of entries: 100
 -rw-r--r--  2.0 unx    14891 b- defN 24-Apr-02 18:35 viur/core/__init__.py
 -rw-r--r--  2.0 unx    13860 b- defN 24-Apr-02 18:35 viur/core/cache.py
 -rw-r--r--  2.0 unx    33153 b- defN 24-Apr-02 18:35 viur/core/config.py
 -rw-r--r--  2.0 unx      592 b- defN 24-Apr-02 18:35 viur/core/current.py
 -rw-r--r--  2.0 unx      589 b- defN 24-Apr-02 18:35 viur/core/db.py
 -rw-r--r--  2.0 unx     4949 b- defN 24-Apr-02 18:35 viur/core/decorators.py
 -rw-r--r--  2.0 unx    20415 b- defN 24-Apr-02 18:35 viur/core/email.py
@@ -14,61 +14,61 @@
 -rw-r--r--  2.0 unx     5612 b- defN 24-Apr-02 18:35 viur/core/ratelimit.py
 -rw-r--r--  2.0 unx    26101 b- defN 24-Apr-02 18:35 viur/core/request.py
 -rw-r--r--  2.0 unx    56179 b- defN 24-Apr-02 19:16 viur/core/requirements.txt
 -rw-r--r--  2.0 unx      813 b- defN 24-Apr-02 18:35 viur/core/secret.py
 -rw-r--r--  2.0 unx    14741 b- defN 24-Apr-02 18:35 viur/core/securityheaders.py
 -rw-r--r--  2.0 unx     5217 b- defN 24-Apr-02 18:35 viur/core/securitykey.py
 -rw-r--r--  2.0 unx     8593 b- defN 24-Apr-02 18:35 viur/core/session.py
--rw-r--r--  2.0 unx    71734 b- defN 24-Apr-09 19:11 viur/core/skeleton.py
+-rw-r--r--  2.0 unx    71734 b- defN 24-Apr-09 19:14 viur/core/skeleton.py
 -rw-r--r--  2.0 unx    35182 b- defN 24-Apr-03 18:41 viur/core/tasks.py
--rw-r--r--  2.0 unx      429 b- defN 24-Apr-09 19:12 viur/core/version.py
+-rw-r--r--  2.0 unx      429 b- defN 24-Apr-30 10:46 viur/core/version.py
 -rw-r--r--  2.0 unx     3099 b- defN 24-Apr-02 19:16 viur/core/bones/__init__.py
 -rw-r--r--  2.0 unx    61654 b- defN 24-Apr-02 19:16 viur/core/bones/base.py
 -rw-r--r--  2.0 unx     5411 b- defN 24-Apr-02 18:35 viur/core/bones/boolean.py
 -rw-r--r--  2.0 unx     3489 b- defN 24-Apr-02 18:35 viur/core/bones/captcha.py
 -rw-r--r--  2.0 unx     2276 b- defN 24-Jan-30 12:15 viur/core/bones/color.py
 -rw-r--r--  2.0 unx     3004 b- defN 24-Apr-02 18:35 viur/core/bones/credential.py
 -rw-r--r--  2.0 unx    16128 b- defN 24-Apr-02 18:35 viur/core/bones/date.py
 -rw-r--r--  2.0 unx     2513 b- defN 24-Jan-30 12:15 viur/core/bones/email.py
 -rw-r--r--  2.0 unx    13995 b- defN 24-Apr-02 18:35 viur/core/bones/file.py
 -rw-r--r--  2.0 unx     3037 b- defN 24-Apr-02 19:16 viur/core/bones/json.py
 -rw-r--r--  2.0 unx     9722 b- defN 24-Apr-02 18:35 viur/core/bones/key.py
--rw-r--r--  2.0 unx     9228 b- defN 24-Apr-02 18:35 viur/core/bones/numeric.py
+-rw-r--r--  2.0 unx     9310 b- defN 24-Apr-30 10:16 viur/core/bones/numeric.py
 -rw-r--r--  2.0 unx     9308 b- defN 24-Apr-02 18:35 viur/core/bones/password.py
 -rw-r--r--  2.0 unx     7793 b- defN 24-Apr-02 18:35 viur/core/bones/randomslice.py
 -rw-r--r--  2.0 unx      863 b- defN 24-Jan-30 12:15 viur/core/bones/raw.py
 -rw-r--r--  2.0 unx     6913 b- defN 24-Apr-02 18:35 viur/core/bones/record.py
--rw-r--r--  2.0 unx    65168 b- defN 24-Apr-02 18:35 viur/core/bones/relational.py
+-rw-r--r--  2.0 unx    65221 b- defN 24-Apr-30 10:16 viur/core/bones/relational.py
 -rw-r--r--  2.0 unx     5657 b- defN 24-Apr-02 19:16 viur/core/bones/select.py
 -rw-r--r--  2.0 unx    18919 b- defN 24-Jan-30 12:15 viur/core/bones/selectcountry.py
 -rw-r--r--  2.0 unx     1266 b- defN 24-Apr-02 18:35 viur/core/bones/sortindex.py
 -rw-r--r--  2.0 unx    19676 b- defN 24-Apr-02 18:35 viur/core/bones/spatial.py
--rw-r--r--  2.0 unx    13432 b- defN 24-Apr-02 18:35 viur/core/bones/string.py
+-rw-r--r--  2.0 unx    15441 b- defN 24-Apr-30 10:16 viur/core/bones/string.py
 -rw-r--r--  2.0 unx    22615 b- defN 24-Apr-02 18:35 viur/core/bones/text.py
 -rw-r--r--  2.0 unx      700 b- defN 24-Jan-30 12:15 viur/core/bones/treeleaf.py
 -rw-r--r--  2.0 unx      844 b- defN 24-Jan-30 12:15 viur/core/bones/treenode.py
 -rw-r--r--  2.0 unx     2847 b- defN 24-Apr-02 18:35 viur/core/bones/user.py
 -rw-r--r--  2.0 unx       38 b- defN 24-Jan-30 12:15 viur/core/languages/__init__.py
 -rw-r--r--  2.0 unx    14045 b- defN 24-Apr-02 18:35 viur/core/languages/de.py
 -rw-r--r--  2.0 unx     2375 b- defN 24-Apr-02 18:35 viur/core/languages/en.py
 -rw-r--r--  2.0 unx        0 b- defN 24-Jan-30 12:15 viur/core/modules/__init__.py
--rw-r--r--  2.0 unx    40537 b- defN 24-Apr-02 18:35 viur/core/modules/file.py
+-rw-r--r--  2.0 unx    40557 b- defN 24-Apr-30 10:16 viur/core/modules/file.py
 -rw-r--r--  2.0 unx     1826 b- defN 24-Jan-30 12:15 viur/core/modules/formmailer.py
--rw-r--r--  2.0 unx     6206 b- defN 24-Apr-09 19:11 viur/core/modules/moduleconf.py
+-rw-r--r--  2.0 unx     6206 b- defN 24-Apr-09 19:14 viur/core/modules/moduleconf.py
 -rw-r--r--  2.0 unx      883 b- defN 24-Apr-02 18:35 viur/core/modules/page.py
--rw-r--r--  2.0 unx     4431 b- defN 24-Apr-09 19:11 viur/core/modules/script.py
+-rw-r--r--  2.0 unx     4431 b- defN 24-Apr-09 19:14 viur/core/modules/script.py
 -rw-r--r--  2.0 unx      487 b- defN 24-Jan-30 12:15 viur/core/modules/site.py
 -rw-r--r--  2.0 unx     5186 b- defN 24-Apr-02 18:35 viur/core/modules/translation.py
 -rw-r--r--  2.0 unx    62541 b- defN 24-Apr-02 19:16 viur/core/modules/user.py
 -rw-r--r--  2.0 unx      816 b- defN 24-Jan-30 12:15 viur/core/prototypes/__init__.py
 -rw-r--r--  2.0 unx     2955 b- defN 24-Apr-02 18:35 viur/core/prototypes/instanced_module.py
--rw-r--r--  2.0 unx    27962 b- defN 24-Apr-03 18:41 viur/core/prototypes/list.py
+-rw-r--r--  2.0 unx    27958 b- defN 24-Apr-30 10:16 viur/core/prototypes/list.py
 -rw-r--r--  2.0 unx     9866 b- defN 24-Apr-02 18:35 viur/core/prototypes/singleton.py
 -rw-r--r--  2.0 unx     2507 b- defN 24-Apr-02 18:35 viur/core/prototypes/skelmodule.py
--rw-r--r--  2.0 unx    41378 b- defN 24-Apr-03 18:41 viur/core/prototypes/tree.py
+-rw-r--r--  2.0 unx    41374 b- defN 24-Apr-30 10:16 viur/core/prototypes/tree.py
 -rw-r--r--  2.0 unx      204 b- defN 24-Jan-30 12:15 viur/core/render/__init__.py
 -rw-r--r--  2.0 unx      169 b- defN 24-Jan-30 12:15 viur/core/render/html/__init__.py
 -rw-r--r--  2.0 unx    20436 b- defN 24-Apr-02 18:35 viur/core/render/html/default.py
 -rw-r--r--  2.0 unx     4374 b- defN 24-Apr-02 18:35 viur/core/render/html/user.py
 -rw-r--r--  2.0 unx     1976 b- defN 24-Apr-02 18:35 viur/core/render/html/utils.py
 -rw-r--r--  2.0 unx      142 b- defN 24-Jan-30 12:15 viur/core/render/html/env/__init__.py
 -rw-r--r--  2.0 unx      945 b- defN 24-Apr-02 18:35 viur/core/render/html/env/date.py
@@ -89,14 +89,14 @@
 -rw-r--r--  2.0 unx     7221 b- defN 24-Apr-02 18:35 viur/core/scripts/migrate_config.py
 -rw-r--r--  2.0 unx     4009 b- defN 24-Apr-02 18:35 viur/core/template/error.html
 -rw-r--r--  2.0 unx     1083 b- defN 24-Jan-30 12:15 viur/core/template/vi_user_google_login.html
 -rw-r--r--  2.0 unx     5630 b- defN 24-Apr-02 18:35 viur/core/utils/__init__.py
 -rw-r--r--  2.0 unx     2713 b- defN 24-Apr-02 18:35 viur/core/utils/json.py
 -rw-r--r--  2.0 unx     1244 b- defN 24-Apr-02 18:35 viur/core/utils/parse.py
 -rw-r--r--  2.0 unx     3389 b- defN 24-Apr-02 18:35 viur/core/utils/string.py
--rw-r--r--  2.0 unx     7651 b- defN 24-Apr-09 19:13 viur_core-3.6.3.dist-info/LICENSE
--rw-r--r--  2.0 unx     7598 b- defN 24-Apr-09 19:13 viur_core-3.6.3.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-Apr-09 19:13 viur_core-3.6.3.dist-info/WHEEL
--rw-r--r--  2.0 unx       83 b- defN 24-Apr-09 19:13 viur_core-3.6.3.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        5 b- defN 24-Apr-09 19:13 viur_core-3.6.3.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     8374 b- defN 24-Apr-09 19:13 viur_core-3.6.3.dist-info/RECORD
-100 files, 1055046 bytes uncompressed, 310656 bytes compressed:  70.6%
+-rw-r--r--  2.0 unx     7651 b- defN 24-Apr-30 10:48 viur_core-3.6.4.dist-info/LICENSE
+-rw-r--r--  2.0 unx     7598 b- defN 24-Apr-30 10:48 viur_core-3.6.4.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-Apr-30 10:48 viur_core-3.6.4.dist-info/WHEEL
+-rw-r--r--  2.0 unx       83 b- defN 24-Apr-30 10:48 viur_core-3.6.4.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        5 b- defN 24-Apr-30 10:48 viur_core-3.6.4.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     8374 b- defN 24-Apr-30 10:48 viur_core-3.6.4.dist-info/RECORD
+100 files, 1057202 bytes uncompressed, 311278 bytes compressed:  70.6%
```

## zipnote {}

```diff
@@ -276,26 +276,26 @@
 
 Filename: viur/core/utils/parse.py
 Comment: 
 
 Filename: viur/core/utils/string.py
 Comment: 
 
-Filename: viur_core-3.6.3.dist-info/LICENSE
+Filename: viur_core-3.6.4.dist-info/LICENSE
 Comment: 
 
-Filename: viur_core-3.6.3.dist-info/METADATA
+Filename: viur_core-3.6.4.dist-info/METADATA
 Comment: 
 
-Filename: viur_core-3.6.3.dist-info/WHEEL
+Filename: viur_core-3.6.4.dist-info/WHEEL
 Comment: 
 
-Filename: viur_core-3.6.3.dist-info/entry_points.txt
+Filename: viur_core-3.6.4.dist-info/entry_points.txt
 Comment: 
 
-Filename: viur_core-3.6.3.dist-info/top_level.txt
+Filename: viur_core-3.6.4.dist-info/top_level.txt
 Comment: 
 
-Filename: viur_core-3.6.3.dist-info/RECORD
+Filename: viur_core-3.6.4.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## viur/core/version.py

```diff
@@ -1,9 +1,9 @@
 # This is the place where the viur-core version number is defined;
 # For pre-releases, postfix with ".betaN" or ".rcN" where `N` is an incremented number for each pre-release.
 # This will mark it as a pre-release as well on PyPI.
 # See CONTRIBUTING.md for further information.
 
-__version__ = "3.6.3"
+__version__ = "3.6.4"
 
 assert __version__.count(".") >= 2 and "".join(__version__.split(".", 3)[:3]).isdigit(), \
     "Semantic __version__ expected!"
```

## viur/core/bones/numeric.py

```diff
@@ -205,14 +205,15 @@
         def refresh_single_value(value: t.Any) -> float | int:
             if value == "":
                 return self.getEmptyValue()
             elif not isinstance(value, (int, float, type(None))):
                 return self._convert_to_numeric(value)
             return value
 
+        # TODO: duplicate code, this is the same iteration logic as in StringBone
         new_value = {}
         for _, lang, value in self.iter_bone_value(skel, boneName):
             new_value.setdefault(lang, []).append(refresh_single_value(value))
 
         if not self.multiple:
             # take the first one
             new_value = {lang: values[0] for lang, values in new_value.items() if values}
```

## viur/core/bones/relational.py

```diff
@@ -396,14 +396,15 @@
         :param str name: The name of the bone to be serialized.
         :param bool parentIndexed: A flag indicating whether the parent bone is indexed.
         :return: True if the serialization is successful, False otherwise.
         :rtype: bool
 
         :raises AssertionError: If a programming error is detected.
         """
+        super().serialize(skel, name, parentIndexed)
         oldRelationalLocks = set(skel.dbEntity.get(f"{name}_outgoingRelationalLocks") or [])
         newRelationalLocks = set()
         # Clean old properties from entry (prevent name collision)
         for k in list(skel.dbEntity.keys()):
             if k.startswith(f"{name}."):
                 del skel.dbEntity[k]
         indexed = self.indexed and parentIndexed
```

## viur/core/bones/string.py

```diff
@@ -1,15 +1,21 @@
-import warnings
-
+import datetime
 import logging
 import typing as t
+import warnings
+from numbers import Number
 
 from viur.core import current, db, utils
 from viur.core.bones.base import BaseBone, ReadFromClientError, ReadFromClientErrorSeverity
 
+if t.TYPE_CHECKING:
+    from ..skeleton import SkeletonInstance
+
+DB_TYPE_INDEXED: t.TypeAlias = dict[t.Literal["val", "idx", "sort_idx"], str]
+
 
 class StringBone(BaseBone):
     """
     The "StringBone" represents a data field that contains text values.
     """
     type = "str"
 
@@ -56,49 +62,78 @@
             self.natural_sorting = natural_sorting
         elif not isinstance(natural_sorting, bool):
             raise TypeError("natural_sorting must be a callable or boolean!")
         elif not natural_sorting:
             self.natural_sorting = None
         # else: keep self.natural_sorting as is
 
-    def singleValueSerialize(self, value, skel: 'SkeletonInstance', name: str, parentIndexed: bool):
+    def type_coerce_single_value(self, value: t.Any) -> str:
+        """Convert a value to a string (if not already)
+
+        Converts a value that is not a string into a string
+        if a meaningful conversion is possible (simple data types only).
+        """
+        if isinstance(value, str):
+            return value
+        elif isinstance(value, Number):
+            return str(value)
+        elif isinstance(value, (datetime.datetime, datetime.date, datetime.time)):
+            return value.isoformat()
+        elif isinstance(value, db.Key):
+            return value.to_legacy_urlsafe().decode("ASCII")
+        elif not value:  # None or any other falsy value
+            return self.getEmptyValue()
+        else:
+            raise ValueError(
+                f"Value {value} of type {type(value)} cannot be coerced for {type(self).__name__} {self.name}"
+            )
+
+    def singleValueSerialize(
+        self,
+        value: t.Any,
+        skel: "SkeletonInstance",
+        name: str,
+        parentIndexed: bool,
+    ) -> str | DB_TYPE_INDEXED:
         """
         Serializes a single value of this data field for storage in the database.
 
         :param value: The value to serialize.
+            It should be a str value, if not it is forced with :meth:`type_coerce_single_value`.
         :param skel: The skeleton instance that this data field belongs to.
         :param name: The name of this data field.
         :param parentIndexed: A boolean value indicating whether the parent object has an index on
             this data field or not.
         :return: The serialized value.
         """
+        value = self.type_coerce_single_value(value)
         if (not self.caseSensitive or self.natural_sorting) and parentIndexed:
-            serialized = {"val": value}
+            serialized: DB_TYPE_INDEXED = {"val": value}
             if not self.caseSensitive:
-                serialized["idx"] = value.lower() if isinstance(value, str) else None
+                serialized["idx"] = value.lower()
             if self.natural_sorting:
                 serialized["sort_idx"] = self.natural_sorting(value)
             return serialized
         return value
 
-    def singleValueUnserialize(self, value):
+    def singleValueUnserialize(self, value: str | DB_TYPE_INDEXED) -> str:
         """
         Unserializes a single value of this data field from the database.
 
         :param value: The serialized value to unserialize.
         :return: The unserialized value.
         """
         if isinstance(value, dict) and "val" in value:
-            return value["val"]
-        elif value:
+            value = value["val"]  # Process with the raw value
+        if value:
             return str(value)
         else:
-            return ""
+            return self.getEmptyValue()
 
-    def getEmptyValue(self):
+    def getEmptyValue(self) -> str:
         """
         Returns the empty value for this data field.
 
         :return: An empty string.
         """
         return ""
 
@@ -110,15 +145,15 @@
         :return: A boolean value indicating whether the value is empty or not.
         """
         if not value:
             return True
 
         return not bool(str(value).strip())
 
-    def isInvalid(self, value):
+    def isInvalid(self, value: t.Any) -> str | None:
         """
         Returns None if the value would be valid for
         this bone, an error-message otherwise.
         """
         if self.max_length is not None and len(value) > self.max_length:
             return "Maximum length exceeded"
         if self.min_length is not None and len(value) < self.min_length:
@@ -126,25 +161,24 @@
         return None
 
     def singleValueFromClient(self, value, skel, bone_name, client_data):
         """
         Returns None and the escaped value if the value would be valid for
         this bone, otherwise the empty value and an error-message.
         """
-        value = utils.string.escape(value, self.max_length)
 
-        if not (err := self.isInvalid(value)):
-            return value, None
+        if not (err := self.isInvalid(str(value))):
+            return utils.string.escape(value, self.max_length), None
 
         return self.getEmptyValue(), [ReadFromClientError(ReadFromClientErrorSeverity.Invalid, err)]
 
     def buildDBFilter(
         self,
         name: str,
-        skel: 'viur.core.skeleton.SkeletonInstance',
+        skel: "SkeletonInstance",
         dbFilter: db.Query,
         rawFilter: dict,
         prefix: t.Optional[str] = None
     ) -> db.Query:
         """
         Builds and returns a database filter for this data field based on the provided raw filter data.
 
@@ -204,27 +238,26 @@
                 dbFilter.filter((prefix or "") + namefilter, str(rawFilter[name]))
 
         return dbFilter
 
     def buildDBSort(
         self,
         name: str,
-        skel: 'viur.core.skeleton.SkeletonInstance',
+        skel: "SkeletonInstance",
         dbFilter: db.Query,
         rawFilter: dict
     ) -> t.Optional[db.Query]:
         """
         Build a DB sort based on the specified name and a raw filter.
 
         :param name: The name of the attribute to sort by.
         :param skel: A SkeletonInstance object.
         :param dbFilter: A Query object representing the current DB filter.
         :param rawFilter: A dictionary containing the raw filter.
         :return: The Query object with the specified sort applied.
-        :rtype: Optional[google.cloud.ndb.query.Query]
         """
         if ((orderby := rawFilter.get("orderby"))
             and (orderby == name
                  or (isinstance(orderby, str) and orderby.startswith(f"{name}.") and self.languages))):
             if self.languages:
                 lang = None
                 if orderby.startswith(f"{name}."):
@@ -282,49 +315,65 @@
             "ü": "ue",
             "Ü": "Ue",
             "ä": "ae",
             "Ä": "Ae",
             "ẞ": "SS",
         }))
 
-    def getSearchTags(self, skel: 'viur.core.skeleton.SkeletonInstance', name: str) -> set[str]:
+    def getSearchTags(self, skel: "SkeletonInstance", name: str) -> set[str]:
         """
         Returns a set of lowercased words that represent searchable tags for the given bone.
 
         :param skel: The skeleton instance being searched.
         :param name: The name of the bone to generate tags for.
 
         :return: A set of lowercased words representing searchable tags.
-        :rtype: set
         """
         result = set()
         for idx, lang, value in self.iter_bone_value(skel, name):
             if value is None:
                 continue
             for line in str(value).splitlines():  # TODO: Can a StringBone be multiline?
                 for word in line.split(" "):
                     result.add(word.lower())
         return result
 
-    def getUniquePropertyIndexValues(self, skel, name: str) -> list[str]:
+    def getUniquePropertyIndexValues(self, skel: "SkeletonInstance", name: str) -> list[str]:
         """
         Returns a list of unique index values for a given property name.
 
         :param skel: The skeleton instance.
         :param name: The name of the property.
         :return: A list of unique index values for the property.
-        :rtype: List[str]
         :raises NotImplementedError: If the StringBone has languages and the implementation
             for this case is not yet defined.
         """
         if self.languages:
             # Not yet implemented as it's unclear if we should keep each language distinct or not
             raise NotImplementedError()
 
         return super().getUniquePropertyIndexValues(skel, name)
 
+    def refresh(self, skel: "SkeletonInstance", bone_name: str) -> None:
+        super().refresh(skel, bone_name)
+
+        # TODO: duplicate code, this is the same iteration logic as in NumericBone
+        new_value = {}
+        for _, lang, value in self.iter_bone_value(skel, bone_name):
+            new_value.setdefault(lang, []).append(self.type_coerce_single_value(value))
+
+        if not self.multiple:
+            # take the first one
+            new_value = {lang: values[0] for lang, values in new_value.items() if values}
+
+        if self.languages:
+            skel[bone_name] = new_value
+        elif not self.languages:
+            # just the value(s) with None language
+            skel[bone_name] = new_value.get(None, [] if self.multiple else self.getEmptyValue())
+
     def structure(self) -> dict:
         ret = super().structure() | {
             "maxlength": self.max_length,
             "minlength": self.min_length
         }
         return ret
```

## viur/core/modules/file.py

```diff
@@ -4,14 +4,15 @@
 import hashlib
 import hmac
 import html
 import io
 import json
 import logging
 import PIL
+import PIL.ImageCms
 import re
 import requests
 import string
 import typing as t
 from collections import namedtuple
 from urllib.parse import quote as urlquote
 from urllib.request import urlopen
```

## viur/core/prototypes/list.py

```diff
@@ -705,13 +705,13 @@
         :param src_skel: The source SkeletonInstance `skel` was cloned from.
 
         .. seealso:: :func:`clone`, :func:`onClone`
         """
         logging.info(f"""Entry cloned: {skel["key"]!r}""")
         flushCache(kind=skel.kindName)
 
-        if user := utils.getCurrentUser():
+        if user := current.user.get():
             logging.info(f"""User: {user["name"]!r} ({user["key"]!r})""")
 
 
 List.admin = True
 List.vi = True
```

## viur/core/prototypes/tree.py

```diff
@@ -1012,15 +1012,15 @@
         :param src_skel: The source SkeletonInstance `skel` was cloned from.
 
         .. seealso:: :func:`clone`, :func:`onClone`
         """
         logging.info(f"""Entry cloned: {skel["key"]!r} ({skelType!r})""")
         flushCache(kind=skel.kindName)
 
-        if user := utils.getCurrentUser():
+        if user := current.user.get():
             logging.info(f"""User: {user["name"]!r} ({user["key"]!r})""")
 
         # Clone entire structure below, in case this is a node.
         if skelType == "node":
             self._clone_recursive("node", src_skel["key"], skel["key"], skel["parentrepo"])
 
             if self.leafSkelCls:
```

## Comparing `viur_core-3.6.3.dist-info/LICENSE` & `viur_core-3.6.4.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `viur_core-3.6.3.dist-info/METADATA` & `viur_core-3.6.4.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: viur-core
-Version: 3.6.3
+Version: 3.6.4
 Summary: The core component of ViUR, a development framework for Google App Engine
 Home-page: https://github.com/viur-framework/viur-core
 Author: Mausbrand Informationssysteme GmbH
 Author-email: devs@viur.dev
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: GNU Lesser General Public License v3 (LGPLv3)
```

## Comparing `viur_core-3.6.3.dist-info/RECORD` & `viur_core-3.6.4.dist-info/RECORD`

 * *Files 9% similar despite different names*

```diff
@@ -15,59 +15,59 @@
 viur/core/requirements.txt,sha256=-Mwq0eB9zdEljRFSZi1ttAN0ZLoIOCNU0I28mxHRQ2w,56179
 viur/core/secret.py,sha256=5J8JLxjrwOqdvWndfFfW2l3WbV8a39Mco7vnSAAMqmg,813
 viur/core/securityheaders.py,sha256=DrbZApwkgFwgRpYkg3v3Ud6poUW4X-xdvtv3KqXe9-o,14741
 viur/core/securitykey.py,sha256=XkPKOCcdyndzHiJT7aCYiS_W5wez2LuGWiRz-wJV8ps,5217
 viur/core/session.py,sha256=hNPCUKrSF_fQ08b6OOxCR4WS0m9_WG6dCIWqXhM7D8I,8593
 viur/core/skeleton.py,sha256=0Td-tnyz97Rn8KDKoxsgTIIUKJJgMbsosjmvou1S9dY,71734
 viur/core/tasks.py,sha256=NX_QeqBooCoUEnAPlrwd2vEoci-Pz8-rPWXXyaOb-9s,35182
-viur/core/version.py,sha256=L1ZqG2ZqddlOAFgJPEr7RhoZyezgJTL0nYqX7t8T0k8,429
+viur/core/version.py,sha256=4NyZNa0AxcY0CIoCb3n59TosmRw0S1XbDVAHYoa7ufE,429
 viur/core/bones/__init__.py,sha256=T9mFiqZMO0DfRBM0v0H9i-3jKMQLHB2fvLFeC9bzitg,3099
 viur/core/bones/base.py,sha256=dSppirtR_F4bq294XCf_0ndKc3aA7Qk3sU6-K87tAQ0,61654
 viur/core/bones/boolean.py,sha256=jB_0362g6upeovfn3-6Kcd0bsACYFJAFL8xZ9-u-Kn4,5411
 viur/core/bones/captcha.py,sha256=MOWBxV24ohjjYi5Qlig8SnUKyH1RrS-R13xDe8sNC-c,3489
 viur/core/bones/color.py,sha256=jHwwBGMOznTKCWxMtDeszSwJEb_8EylyHKRAOtrZD8U,2276
 viur/core/bones/credential.py,sha256=qc2YageO3PKassMjmMsXfLLHcveuPNlpc5imNloe4iA,3004
 viur/core/bones/date.py,sha256=Ll5XPlCrBqOqYX8ftrJvpOSX2gF3zj6FphOCtd6iOTA,16128
 viur/core/bones/email.py,sha256=PC3YJf47ucX7zHp1QOXGNJf6WZmZTubWofihggPGYcg,2513
 viur/core/bones/file.py,sha256=Fz4-5lTDnhIZWZWFmbUGnz9R-59rwOnCTBS8Z3tBcd4,13995
 viur/core/bones/json.py,sha256=IrjcANK9krn2OTUztV0bw1DP9FMzD2wHcwyTmtq1sxE,3037
 viur/core/bones/key.py,sha256=860hbYT7TJ97sFJKqdk6fezR4JN9h2ijscs9AzMwgmM,9722
-viur/core/bones/numeric.py,sha256=fo3uOmOvG7SZnAluiujsrAVxQJzXUG3spyrwIRzLk6U,9228
+viur/core/bones/numeric.py,sha256=xNeSUxNAaiQmXj1a86m42XMt8E35kqny_EZs2oFTMwk,9310
 viur/core/bones/password.py,sha256=Il-WcR9AzBZSexmDz-txUQr6Xydcj0jx1C96Je-6iyc,9308
 viur/core/bones/randomslice.py,sha256=tmCQVGe0zrfEA1we476HY4a-1pVpdvOu6stliXfZDvE,7793
 viur/core/bones/raw.py,sha256=LGjuxsNwcHGMJhSIjixH0PAhO1wRSeUWKj57IH8ztKg,863
 viur/core/bones/record.py,sha256=TULp2ZvXHzIp6R9qi0yplkcKVtB1A4xwF7t3yMYj3PQ,6913
-viur/core/bones/relational.py,sha256=_RU4DfysF7PD_gMjbYt-ewvT554TX0LXUCOjm_ltZvA,65168
+viur/core/bones/relational.py,sha256=b0FGy48PlT_FgDg6eQsvwfGViUaOHMAI0gOJ4X7MMd8,65221
 viur/core/bones/select.py,sha256=86tKFAEYDmBTDxXnjxnPV3MLafcC--H-qQpSssliOpg,5657
 viur/core/bones/selectcountry.py,sha256=JSgspE8BeP342--24p1xlKXEXrARtCoZzv1Koq1WEoA,18919
 viur/core/bones/sortindex.py,sha256=k8Ojcze6PBOx83ctoQNYSylv-RZs65oyRnp2V_0DoTs,1266
 viur/core/bones/spatial.py,sha256=-A6v9FwjN3LWTzCOYVpXN-OgVZXEgspzJyKoOJ1LJaU,19676
-viur/core/bones/string.py,sha256=fpFUf2fe8JUMEr-m35FJ7Bi-golbg6uFyegwSBstwqA,13432
+viur/core/bones/string.py,sha256=17bo6d8eMH-3qD1PKCe53BmkE-Xq4-yXuMA5ZIbp6vA,15441
 viur/core/bones/text.py,sha256=PNSM_BNL89F7rgyldqbEKG7hUDFmCE6V0GsvAsYf9PM,22615
 viur/core/bones/treeleaf.py,sha256=efwax8MQxdFP5_wKbPwSMfhH0hZF4-hLjo6qW8FfgTY,700
 viur/core/bones/treenode.py,sha256=8Vsw-WaBy2PFbkK9JgUFviv04fQXyrkdjVrtpfppfxg,844
 viur/core/bones/user.py,sha256=gfNGCF_QgLfvxZYb6gFOA49kimfASTjJUYO_yJKoi1Y,2847
 viur/core/languages/__init__.py,sha256=NpyUzlGt3ZFRClF_ZZ3vuE6whv7Xw4HY_QRS_Ilww2Q,38
 viur/core/languages/de.py,sha256=6t_UFLNuJGitDJnsRyvwK3PXR4JAOnIiqKFHmpG3hAU,14045
 viur/core/languages/en.py,sha256=QS-pycd93T_Mq5X27Km6tx7hh3yHMNp6tCgYhyms6b4,2375
 viur/core/modules/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
-viur/core/modules/file.py,sha256=9qJyOL6f78Qy9n4ieW_kvUuF-8VXykUUAS2jRGaaEck,40537
+viur/core/modules/file.py,sha256=qENvtYRoKZ3afrEzjqP6_gTLAyYrKU2tMNiwi2DP2MM,40557
 viur/core/modules/formmailer.py,sha256=6IwdrwVSiZjiQ_FxuZiC4rOOykLJnVlClMKS8DgcIzY,1826
 viur/core/modules/moduleconf.py,sha256=LQ_JVmDqaBGCXlHBkJwKJkEC0qd_kGKE2Auv6N16FqY,6206
 viur/core/modules/page.py,sha256=ZCt_i3Fba7gykEzR3R4BXPsQbwoB5_YyfNxICXh5abE,883
 viur/core/modules/script.py,sha256=K7z0wMZfuvhRqLdfuO-lVc-93yoER76WFjWpjaJ25w8,4431
 viur/core/modules/site.py,sha256=GNMPI21yDFyGfIJMLH_dC7p3TYuqL4dcQrsh4hfFzVY,487
 viur/core/modules/translation.py,sha256=NSn5_ZSSMi8QfxUKpl1YYynXlXFuIc54U4tWPX6mq08,5186
 viur/core/modules/user.py,sha256=B5rFfUdXZ7QWfn98rnm59JJvbz0f_MquO2binIyUWnE,62541
 viur/core/prototypes/__init__.py,sha256=qU6GQfQDDvUJugNmagumTp0GfP5jneepddgeXs8myLg,816
 viur/core/prototypes/instanced_module.py,sha256=LBuu_qgJzteFwB5wyLkh_0bkJDemhCWJBFC-5LyE-wA,2955
-viur/core/prototypes/list.py,sha256=BN7Q2eP6tkZyzfFNbvUaJNSkyQF8xvglZGKZXyYyM0g,27962
+viur/core/prototypes/list.py,sha256=z0xIingHwCXmSWTd2ulVxy6ewf6kirMlJW8iZ5qfoRo,27958
 viur/core/prototypes/singleton.py,sha256=7RLy4-a0I4iuxMADJ8Eck5_HJTmn-s4n8JsLYp6lkjY,9866
 viur/core/prototypes/skelmodule.py,sha256=3w_8r5EbjpnX8tWx11hPrcSxW6GL_08nfg2SqwvJ0UA,2507
-viur/core/prototypes/tree.py,sha256=sGIroPyEbYGwfcs8KTYoGdC-jDz_efcUu2mPiqNZ7gc,41378
+viur/core/prototypes/tree.py,sha256=bu5IvkWe8hhtUFLVLNzML4-x8j0jQWcWLBdG78yPDjM,41374
 viur/core/render/__init__.py,sha256=WnbFrpDhZDnZ6iwQOcIZEyM-NcO0ZXjaMko3CeIKrTo,204
 viur/core/render/html/__init__.py,sha256=VPzcYq1d52WRQXdn3HeTugM6iZlUs1k7INbYmCUuxQ0,169
 viur/core/render/html/default.py,sha256=QXeCIM3Fsvw6hi5TnsTjWFOS4tFqGisnis7-Uni6MLw,20436
 viur/core/render/html/user.py,sha256=3GXYyw4z6_wEIJWeQTQydS0slQlqB2SxYnI1femIPJQ,4374
 viur/core/render/html/utils.py,sha256=5c7mzJ0Qi5pP19MRDGQY1vo7a3q6tNxK-6wtvHEvSew,1976
 viur/core/render/html/env/__init__.py,sha256=Yu0H1AvRe_Q7_WLMvP3wLyXsilWZ29Lmjq-SHzDu5fw,142
 viur/core/render/html/env/date.py,sha256=xmJqGSRJJAFqkVDpv26XE0qC_v-MUEm5vanzXfsdR3E,945
@@ -88,13 +88,13 @@
 viur/core/scripts/migrate_config.py,sha256=CbA96ZHzvdVv64fLP5UdYltVGkPlFFU05fjWwFD54SU,7221
 viur/core/template/error.html,sha256=DLYj14V6_lS4NW5c222_a3fMBWwlYElf5zNuXPhRoQ0,4009
 viur/core/template/vi_user_google_login.html,sha256=yzFit0gQBAIy5-feRabZQZM2R3bfD-Wkk67MiUNdrcY,1083
 viur/core/utils/__init__.py,sha256=HqkKR8hp_sRW8Xuu8u_5gW3ijVnH49Spe-c8QJgsu74,5630
 viur/core/utils/json.py,sha256=6mW3Bu_iEnKpHZnRBLG2amk-Y34mkQRcSoAHFATyxIU,2713
 viur/core/utils/parse.py,sha256=jMPz6jpGmZfBXmYfmQoFs73ncT0HSVHzGkhJemU8KIs,1244
 viur/core/utils/string.py,sha256=5E40BqtpRUjGEzelBGQhCy_kOoEFuESMnwsQK7CEt2Y,3389
-viur_core-3.6.3.dist-info/LICENSE,sha256=2n6rt7r999OuXp8iOqW9we7ORaxWncIbOwN1ILRGR2g,7651
-viur_core-3.6.3.dist-info/METADATA,sha256=-HPrwXftCM70p7VXKoIpw2H507CskUVugOBl0Bm_8mk,7598
-viur_core-3.6.3.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-viur_core-3.6.3.dist-info/entry_points.txt,sha256=hZfKeScumX0lUSduvSViOVz0H1tofU_UYCwjDDmmkPM,83
-viur_core-3.6.3.dist-info/top_level.txt,sha256=UpXSoS_clIJYncMZKAppy3WNRScHSjarTabKBOa8OeI,5
-viur_core-3.6.3.dist-info/RECORD,,
+viur_core-3.6.4.dist-info/LICENSE,sha256=2n6rt7r999OuXp8iOqW9we7ORaxWncIbOwN1ILRGR2g,7651
+viur_core-3.6.4.dist-info/METADATA,sha256=nzX1B8-YV-tqTkkP3RVx5XZUk_AaEKS9X0iPZloJsxw,7598
+viur_core-3.6.4.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+viur_core-3.6.4.dist-info/entry_points.txt,sha256=hZfKeScumX0lUSduvSViOVz0H1tofU_UYCwjDDmmkPM,83
+viur_core-3.6.4.dist-info/top_level.txt,sha256=UpXSoS_clIJYncMZKAppy3WNRScHSjarTabKBOa8OeI,5
+viur_core-3.6.4.dist-info/RECORD,,
```

