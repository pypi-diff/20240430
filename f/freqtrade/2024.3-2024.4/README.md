# Comparing `tmp/freqtrade-2024.3.tar.gz` & `tmp/freqtrade-2024.4.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "freqtrade-2024.3.tar", last modified: Sun Mar 31 16:25:17 2024, max compression
+gzip compressed data, was "freqtrade-2024.4.tar", last modified: Tue Apr 30 12:41:51 2024, max compression
```

## Comparing `freqtrade-2024.3.tar` & `freqtrade-2024.4.tar`

### file list

```diff
@@ -1,367 +1,370 @@
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.627776 freqtrade-2024.3/
--rw-r--r--   0 runner    (1001) docker     (127)    35141 2024-03-31 16:25:11.000000 freqtrade-2024.3/LICENSE
--rw-r--r--   0 runner    (1001) docker     (127)      290 2024-03-31 16:25:11.000000 freqtrade-2024.3/MANIFEST.in
--rw-r--r--   0 runner    (1001) docker     (127)    18209 2024-03-31 16:25:17.627776 freqtrade-2024.3/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)    11493 2024-03-31 16:25:11.000000 freqtrade-2024.3/README.md
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.567776 freqtrade-2024.3/freqtrade/
--rw-r--r--   0 runner    (1001) docker     (127)      810 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/__init__.py
--rwxr-xr-x   0 runner    (1001) docker     (127)      206 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/__main__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.571776 freqtrade-2024.3/freqtrade/commands/
--rw-r--r--   0 runner    (1001) docker     (127)     1912 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     2187 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/analyze_commands.py
--rwxr-xr-x   0 runner    (1001) docker     (127)    22580 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/arguments.py
--rw-r--r--   0 runner    (1001) docker     (127)     9504 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/build_config_commands.py
--rwxr-xr-x   0 runner    (1001) docker     (127)    23376 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/cli_options.py
--rw-r--r--   0 runner    (1001) docker     (127)     5541 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/data_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)     1672 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/db_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)     6848 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/deploy_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)     3634 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/hyperopt_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)    10329 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/list_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)     5298 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/optimize_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)     1458 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/pairlist_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)     1158 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/plot_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)     1852 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/strategy_utils_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)      750 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/trade_commands.py
--rw-r--r--   0 runner    (1001) docker     (127)      428 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/commands/webserver_commands.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.575776 freqtrade-2024.3/freqtrade/configuration/
--rw-r--r--   0 runner    (1001) docker     (127)      439 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     1022 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/config_secrets.py
--rw-r--r--   0 runner    (1001) docker     (127)      777 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/config_setup.py
--rw-r--r--   0 runner    (1001) docker     (127)    17535 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/config_validation.py
--rw-r--r--   0 runner    (1001) docker     (127)    21745 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/configuration.py
--rw-r--r--   0 runner    (1001) docker     (127)     7049 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/deprecated_settings.py
--rw-r--r--   0 runner    (1001) docker     (127)      163 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/detect_environment.py
--rw-r--r--   0 runner    (1001) docker     (127)     3630 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/directory_operations.py
--rw-r--r--   0 runner    (1001) docker     (127)     1826 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/environment_vars.py
--rw-r--r--   0 runner    (1001) docker     (127)     3887 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/load_config.py
--rw-r--r--   0 runner    (1001) docker     (127)     6278 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/configuration/timerange.py
--rw-r--r--   0 runner    (1001) docker     (127)    30148 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/constants.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.575776 freqtrade-2024.3/freqtrade/data/
--rw-r--r--   0 runner    (1001) docker     (127)      152 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    18042 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/btanalysis.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.575776 freqtrade-2024.3/freqtrade/data/converter/
--rw-r--r--   0 runner    (1001) docker     (127)     1238 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/converter/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    10906 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/converter/converter.py
--rw-r--r--   0 runner    (1001) docker     (127)     5886 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/converter/trade_converter.py
--rw-r--r--   0 runner    (1001) docker     (127)     3225 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/converter/trade_converter_kraken.py
--rw-r--r--   0 runner    (1001) docker     (127)    21785 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/dataprovider.py
--rw-r--r--   0 runner    (1001) docker     (127)    13192 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/entryexitanalysis.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.575776 freqtrade-2024.3/freqtrade/data/history/
--rw-r--r--   0 runner    (1001) docker     (127)      485 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/history/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.575776 freqtrade-2024.3/freqtrade/data/history/datahandlers/
--rw-r--r--   0 runner    (1001) docker     (127)       77 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/history/datahandlers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     5135 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/history/datahandlers/featherdatahandler.py
--rw-r--r--   0 runner    (1001) docker     (127)     6349 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/history/datahandlers/hdf5datahandler.py
--rw-r--r--   0 runner    (1001) docker     (127)    20148 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/history/datahandlers/idatahandler.py
--rw-r--r--   0 runner    (1001) docker     (127)     5996 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/history/datahandlers/jsondatahandler.py
--rw-r--r--   0 runner    (1001) docker     (127)     5025 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/history/datahandlers/parquetdatahandler.py
--rw-r--r--   0 runner    (1001) docker     (127)    25505 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/history/history_utils.py
--rw-r--r--   0 runner    (1001) docker     (127)    12824 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/data/metrics.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.579776 freqtrade-2024.3/freqtrade/edge/
--rw-r--r--   0 runner    (1001) docker     (127)       59 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/edge/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    20653 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/edge/edge_positioning.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.579776 freqtrade-2024.3/freqtrade/enums/
--rw-r--r--   0 runner    (1001) docker     (127)      861 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)      238 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/backteststate.py
--rw-r--r--   0 runner    (1001) docker     (127)      798 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/candletype.py
--rw-r--r--   0 runner    (1001) docker     (127)      640 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/exitchecktuple.py
--rw-r--r--   0 runner    (1001) docker     (127)      619 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/exittype.py
--rw-r--r--   0 runner    (1001) docker     (127)      210 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/hyperoptstate.py
--rw-r--r--   0 runner    (1001) docker     (127)      242 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/marginmode.py
--rw-r--r--   0 runner    (1001) docker     (127)      261 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/marketstatetype.py
--rw-r--r--   0 runner    (1001) docker     (127)      100 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/ordertypevalue.py
--rw-r--r--   0 runner    (1001) docker     (127)      177 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/pricetype.py
--rw-r--r--   0 runner    (1001) docker     (127)      976 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/rpcmessagetype.py
--rw-r--r--   0 runner    (1001) docker     (127)      592 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/runmode.py
--rw-r--r--   0 runner    (1001) docker     (127)      626 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/signaltype.py
--rw-r--r--   0 runner    (1001) docker     (127)      202 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/state.py
--rw-r--r--   0 runner    (1001) docker     (127)      220 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/enums/tradingmode.py
--rw-r--r--   0 runner    (1001) docker     (127)     2200 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exceptions.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.583776 freqtrade-2024.3/freqtrade/exchange/
--rw-r--r--   0 runner    (1001) docker     (127)     1761 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     9883 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/binance.py
--rw-r--r--   0 runner    (1001) docker     (127)   846122 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/binance_leverage_tiers.json
--rw-r--r--   0 runner    (1001) docker     (127)      449 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/bitmart.py
--rw-r--r--   0 runner    (1001) docker     (127)     1621 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/bitpanda.py
--rw-r--r--   0 runner    (1001) docker     (127)      547 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/bitvavo.py
--rw-r--r--   0 runner    (1001) docker     (127)     9871 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/bybit.py
--rw-r--r--   0 runner    (1001) docker     (127)     2975 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/check_exchange.py
--rw-r--r--   0 runner    (1001) docker     (127)      564 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/coinbasepro.py
--rw-r--r--   0 runner    (1001) docker     (127)     6356 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/common.py
--rw-r--r--   0 runner    (1001) docker     (127)   139496 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/exchange.py
--rw-r--r--   0 runner    (1001) docker     (127)    11767 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/exchange_utils.py
--rw-r--r--   0 runner    (1001) docker     (127)     2804 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/exchange_utils_timeframe.py
--rw-r--r--   0 runner    (1001) docker     (127)     4928 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/gate.py
--rw-r--r--   0 runner    (1001) docker     (127)      517 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/hitbtc.py
--rw-r--r--   0 runner    (1001) docker     (127)      902 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/htx.py
--rw-r--r--   0 runner    (1001) docker     (127)     7127 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/kraken.py
--rw-r--r--   0 runner    (1001) docker     (127)     2201 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/kucoin.py
--rw-r--r--   0 runner    (1001) docker     (127)    10203 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/okx.py
--rw-r--r--   0 runner    (1001) docker     (127)      725 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/exchange/types.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.583776 freqtrade-2024.3/freqtrade/freqai/
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.587776 freqtrade-2024.3/freqtrade/freqai/RL/
--rw-r--r--   0 runner    (1001) docker     (127)     4496 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/RL/Base3ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (127)     5021 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/RL/Base4ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (127)     5644 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/RL/Base5ActionRLEnv.py
--rw-r--r--   0 runner    (1001) docker     (127)    15446 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/RL/BaseEnvironment.py
--rw-r--r--   0 runner    (1001) docker     (127)    21142 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/RL/BaseReinforcementLearningModel.py
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/RL/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.587776 freqtrade-2024.3/freqtrade/freqai/base_models/
--rw-r--r--   0 runner    (1001) docker     (127)     5137 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/base_models/BaseClassifierModel.py
--rw-r--r--   0 runner    (1001) docker     (127)     8283 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/base_models/BasePyTorchClassifier.py
--rw-r--r--   0 runner    (1001) docker     (127)     1144 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/base_models/BasePyTorchModel.py
--rw-r--r--   0 runner    (1001) docker     (127)     4774 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/base_models/BasePyTorchRegressor.py
--rw-r--r--   0 runner    (1001) docker     (127)     5039 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/base_models/BaseRegressionModel.py
--rw-r--r--   0 runner    (1001) docker     (127)     3451 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
--rw-r--r--   0 runner    (1001) docker     (127)     2487 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
--rw-r--r--   0 runner    (1001) docker     (127)    31753 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/data_drawer.py
--rw-r--r--   0 runner    (1001) docker     (127)    43575 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/data_kitchen.py
--rw-r--r--   0 runner    (1001) docker     (127)    45856 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/freqai_interface.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.591776 freqtrade-2024.3/freqtrade/freqai/prediction_models/
--rw-r--r--   0 runner    (1001) docker     (127)     2083 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/CatboostClassifier.py
--rw-r--r--   0 runner    (1001) docker     (127)     2866 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (127)     2048 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/CatboostRegressor.py
--rw-r--r--   0 runner    (1001) docker     (127)     2834 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (127)     1921 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/LightGBMClassifier.py
--rw-r--r--   0 runner    (1001) docker     (127)     2698 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (127)     1839 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/LightGBMRegressor.py
--rw-r--r--   0 runner    (1001) docker     (127)     2694 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (127)     3622 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py
--rw-r--r--   0 runner    (1001) docker     (127)     3308 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py
--rw-r--r--   0 runner    (1001) docker     (127)     6158 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py
--rw-r--r--   0 runner    (1001) docker     (127)     7160 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/ReinforcementLearner.py
--rw-r--r--   0 runner    (1001) docker     (127)     3284 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py
--rw-r--r--   0 runner    (1001) docker     (127)     3241 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/SKLearnRandomForestClassifier.py
--rw-r--r--   0 runner    (1001) docker     (127)     3338 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostClassifier.py
--rw-r--r--   0 runner    (1001) docker     (127)     3345 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py
--rw-r--r--   0 runner    (1001) docker     (127)     2074 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py
--rw-r--r--   0 runner    (1001) docker     (127)     2219 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostRegressor.py
--rw-r--r--   0 runner    (1001) docker     (127)     2596 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/prediction_models/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.591776 freqtrade-2024.3/freqtrade/freqai/tensorboard/
--rw-r--r--   0 runner    (1001) docker     (127)     2152 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/tensorboard/TensorboardCallback.py
--rw-r--r--   0 runner    (1001) docker     (127)      587 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/tensorboard/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)      690 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/tensorboard/base_tensorboard.py
--rw-r--r--   0 runner    (1001) docker     (127)     1859 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/tensorboard/tensorboard.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.591776 freqtrade-2024.3/freqtrade/freqai/torch/
--rw-r--r--   0 runner    (1001) docker     (127)     1886 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/torch/PyTorchDataConvertor.py
--rw-r--r--   0 runner    (1001) docker     (127)     3762 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/torch/PyTorchMLPModel.py
--rw-r--r--   0 runner    (1001) docker     (127)     8740 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/torch/PyTorchModelTrainer.py
--rw-r--r--   0 runner    (1001) docker     (127)     2026 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/torch/PyTorchTrainerInterface.py
--rw-r--r--   0 runner    (1001) docker     (127)     3613 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/torch/PyTorchTransformerModel.py
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/torch/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)      666 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/torch/datasets.py
--rw-r--r--   0 runner    (1001) docker     (127)     7456 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqai/utils.py
--rw-r--r--   0 runner    (1001) docker     (127)   100161 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/freqtradebot.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.591776 freqtrade-2024.3/freqtrade/leverage/
--rw-r--r--   0 runner    (1001) docker     (127)       63 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/leverage/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     1257 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/leverage/interest.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.591776 freqtrade-2024.3/freqtrade/loggers/
--rw-r--r--   0 runner    (1001) docker     (127)     4271 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/loggers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)      460 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/loggers/buffering_handler.py
--rw-r--r--   0 runner    (1001) docker     (127)     1598 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/loggers/set_log_levels.py
--rw-r--r--   0 runner    (1001) docker     (127)      714 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/loggers/std_err_stream_handler.py
--rwxr-xr-x   0 runner    (1001) docker     (127)     2328 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/main.py
--rw-r--r--   0 runner    (1001) docker     (127)     7610 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/misc.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.591776 freqtrade-2024.3/freqtrade/mixins/
--rw-r--r--   0 runner    (1001) docker     (127)       70 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/mixins/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     1263 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/mixins/logging_mixin.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.595776 freqtrade-2024.3/freqtrade/optimize/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.595776 freqtrade-2024.3/freqtrade/optimize/analysis/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/analysis/__init__.py
--rwxr-xr-x   0 runner    (1001) docker     (127)    12380 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/analysis/lookahead.py
--rw-r--r--   0 runner    (1001) docker     (127)    10417 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/analysis/lookahead_helpers.py
--rw-r--r--   0 runner    (1001) docker     (127)     7448 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/analysis/recursive.py
--rw-r--r--   0 runner    (1001) docker     (127)     4230 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/analysis/recursive_helpers.py
--rw-r--r--   0 runner    (1001) docker     (127)     1519 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/backtest_caching.py
--rw-r--r--   0 runner    (1001) docker     (127)    67638 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/backtesting.py
--rw-r--r--   0 runner    (1001) docker     (127)     1902 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/base_analysis.py
--rw-r--r--   0 runner    (1001) docker     (127)      856 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/bt_progress.py
--rw-r--r--   0 runner    (1001) docker     (127)     1823 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/edge_cli.py
--rw-r--r--   0 runner    (1001) docker     (127)    29040 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt.py
--rw-r--r--   0 runner    (1001) docker     (127)     3672 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_auto.py
--rw-r--r--   0 runner    (1001) docker     (127)     4525 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_epoch_filters.py
--rw-r--r--   0 runner    (1001) docker     (127)     8554 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_interface.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.599776 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/
--rw-r--r--   0 runner    (1001) docker     (127)     1102 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py
--rw-r--r--   0 runner    (1001) docker     (127)     1237 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py
--rw-r--r--   0 runner    (1001) docker     (127)     1470 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py
--rw-r--r--   0 runner    (1001) docker     (127)      746 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py
--rw-r--r--   0 runner    (1001) docker     (127)      931 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py
--rw-r--r--   0 runner    (1001) docker     (127)     1095 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py
--rw-r--r--   0 runner    (1001) docker     (127)     2108 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py
--rw-r--r--   0 runner    (1001) docker     (127)     1965 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
--rw-r--r--   0 runner    (1001) docker     (127)     1109 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
--rw-r--r--   0 runner    (1001) docker     (127)     2568 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
--rw-r--r--   0 runner    (1001) docker     (127)      951 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_loss_interface.py
--rw-r--r--   0 runner    (1001) docker     (127)    23103 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/hyperopt_tools.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.599776 freqtrade-2024.3/freqtrade/optimize/optimize_reports/
--rw-r--r--   0 runner    (1001) docker     (127)     1456 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/optimize_reports/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    19388 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/optimize_reports/bt_output.py
--rw-r--r--   0 runner    (1001) docker     (127)     2940 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/optimize_reports/bt_storage.py
--rw-r--r--   0 runner    (1001) docker     (127)    24937 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/optimize_reports/optimize_reports.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.599776 freqtrade-2024.3/freqtrade/optimize/space/
--rw-r--r--   0 runner    (1001) docker     (127)      127 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/space/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     1402 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/optimize/space/decimalspace.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.599776 freqtrade-2024.3/freqtrade/persistence/
--rw-r--r--   0 runner    (1001) docker     (127)      504 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)      154 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/base.py
--rw-r--r--   0 runner    (1001) docker     (127)     6569 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/custom_data.py
--rw-r--r--   0 runner    (1001) docker     (127)     6439 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/key_value_store.py
--rw-r--r--   0 runner    (1001) docker     (127)    16084 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/migrations.py
--rw-r--r--   0 runner    (1001) docker     (127)     3145 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/models.py
--rw-r--r--   0 runner    (1001) docker     (127)     3103 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/pairlock.py
--rw-r--r--   0 runner    (1001) docker     (127)     6364 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/pairlock_middleware.py
--rw-r--r--   0 runner    (1001) docker     (127)    80127 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/trade_model.py
--rw-r--r--   0 runner    (1001) docker     (127)      968 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/persistence/usedb_context.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.599776 freqtrade-2024.3/freqtrade/plot/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plot/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    26263 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plot/plotting.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.599776 freqtrade-2024.3/freqtrade/plugins/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.603776 freqtrade-2024.3/freqtrade/plugins/pairlist/
--rw-r--r--   0 runner    (1001) docker     (127)     6497 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/AgeFilter.py
--rw-r--r--   0 runner    (1001) docker     (127)     1875 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/FullTradesFilter.py
--rw-r--r--   0 runner    (1001) docker     (127)     9088 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/IPairList.py
--rw-r--r--   0 runner    (1001) docker     (127)     5888 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/MarketCapPairList.py
--rw-r--r--   0 runner    (1001) docker     (127)     2926 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/OffsetFilter.py
--rw-r--r--   0 runner    (1001) docker     (127)     3990 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/PerformanceFilter.py
--rw-r--r--   0 runner    (1001) docker     (127)     3089 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/PrecisionFilter.py
--rw-r--r--   0 runner    (1001) docker     (127)     6630 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/PriceFilter.py
--rw-r--r--   0 runner    (1001) docker     (127)     3987 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/ProducerPairList.py
--rw-r--r--   0 runner    (1001) docker     (127)    12345 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/RemotePairList.py
--rw-r--r--   0 runner    (1001) docker     (127)     3639 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/ShuffleFilter.py
--rw-r--r--   0 runner    (1001) docker     (127)     2971 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/SpreadFilter.py
--rw-r--r--   0 runner    (1001) docker     (127)     2879 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/StaticPairList.py
--rw-r--r--   0 runner    (1001) docker     (127)     7157 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/VolatilityFilter.py
--rw-r--r--   0 runner    (1001) docker     (127)    12987 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/VolumePairList.py
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     2311 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/pairlist_helpers.py
--rw-r--r--   0 runner    (1001) docker     (127)     7312 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlist/rangestabilityfilter.py
--rw-r--r--   0 runner    (1001) docker     (127)     6881 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/pairlistmanager.py
--rw-r--r--   0 runner    (1001) docker     (127)     2870 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/protectionmanager.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.603776 freqtrade-2024.3/freqtrade/plugins/protections/
--rw-r--r--   0 runner    (1001) docker     (127)      105 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/protections/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     2707 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/protections/cooldown_period.py
--rw-r--r--   0 runner    (1001) docker     (127)     4273 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/protections/iprotection.py
--rw-r--r--   0 runner    (1001) docker     (127)     3607 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/protections/low_profit_pairs.py
--rw-r--r--   0 runner    (1001) docker     (127)     3544 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/protections/max_drawdown_protection.py
--rw-r--r--   0 runner    (1001) docker     (127)     3691 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/plugins/protections/stoploss_guard.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.607776 freqtrade-2024.3/freqtrade/resolvers/
--rw-r--r--   0 runner    (1001) docker     (127)      512 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/resolvers/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     3699 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/resolvers/exchange_resolver.py
--rw-r--r--   0 runner    (1001) docker     (127)     1776 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/resolvers/freqaimodel_resolver.py
--rw-r--r--   0 runner    (1001) docker     (127)     1727 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/resolvers/hyperopt_resolver.py
--rw-r--r--   0 runner    (1001) docker     (127)    10500 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/resolvers/iresolver.py
--rw-r--r--   0 runner    (1001) docker     (127)     1794 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/resolvers/pairlist_resolver.py
--rw-r--r--   0 runner    (1001) docker     (127)     1377 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/resolvers/protection_resolver.py
--rw-r--r--   0 runner    (1001) docker     (127)    13871 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/resolvers/strategy_resolver.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.607776 freqtrade-2024.3/freqtrade/rpc/
--rw-r--r--   0 runner    (1001) docker     (127)      111 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.611776 freqtrade-2024.3/freqtrade/rpc/api_server/
--rw-r--r--   0 runner    (1001) docker     (127)       47 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     5425 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/api_auth.py
--rw-r--r--   0 runner    (1001) docker     (127)     5234 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/api_background_tasks.py
--rw-r--r--   0 runner    (1001) docker     (127)    11734 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/api_backtest.py
--rw-r--r--   0 runner    (1001) docker     (127)    13500 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/api_schemas.py
--rw-r--r--   0 runner    (1001) docker     (127)    16575 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/api_v1.py
--rw-r--r--   0 runner    (1001) docker     (127)     4601 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/api_ws.py
--rw-r--r--   0 runner    (1001) docker     (127)     2033 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/deps.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.611776 freqtrade-2024.3/freqtrade/rpc/api_server/ui/
--rw-r--r--   0 runner    (1001) docker     (127)      753 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/ui/fallback_file.html
--rw-r--r--   0 runner    (1001) docker     (127)   126794 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/ui/favicon.ico
--rw-r--r--   0 runner    (1001) docker     (127)     2100 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/uvicorn_threaded.py
--rw-r--r--   0 runner    (1001) docker     (127)     2175 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/web_ui.py
--rw-r--r--   0 runner    (1001) docker     (127)     8230 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/webserver.py
--rw-r--r--   0 runner    (1001) docker     (127)      889 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/webserver_bgwork.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.611776 freqtrade-2024.3/freqtrade/rpc/api_server/ws/
--rw-r--r--   0 runner    (1001) docker     (127)      419 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/ws/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     7570 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/ws/channel.py
--rw-r--r--   0 runner    (1001) docker     (127)      898 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/ws/message_stream.py
--rw-r--r--   0 runner    (1001) docker     (127)     2292 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/ws/proxy.py
--rw-r--r--   0 runner    (1001) docker     (127)     1678 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/ws/serializer.py
--rw-r--r--   0 runner    (1001) docker     (127)      257 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/ws/types.py
--rw-r--r--   0 runner    (1001) docker     (127)     1884 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/api_server/ws_schemas.py
--rw-r--r--   0 runner    (1001) docker     (127)     2052 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/discord.py
--rw-r--r--   0 runner    (1001) docker     (127)    14699 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/external_message_consumer.py
--rw-r--r--   0 runner    (1001) docker     (127)     7312 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/fiat_convert.py
--rw-r--r--   0 runner    (1001) docker     (127)    61214 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/rpc.py
--rw-r--r--   0 runner    (1001) docker     (127)     5294 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/rpc_manager.py
--rw-r--r--   0 runner    (1001) docker     (127)     3206 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/rpc_types.py
--rw-r--r--   0 runner    (1001) docker     (127)    84144 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/telegram.py
--rw-r--r--   0 runner    (1001) docker     (127)     4911 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/rpc/webhook.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.611776 freqtrade-2024.3/freqtrade/strategy/
--rw-r--r--   0 runner    (1001) docker     (127)      650 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/strategy/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     8240 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/strategy/hyper.py
--rw-r--r--   0 runner    (1001) docker     (127)     6114 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/strategy/informative_decorator.py
--rw-r--r--   0 runner    (1001) docker     (127)    69757 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/strategy/interface.py
--rw-r--r--   0 runner    (1001) docker     (127)    12586 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/strategy/parameters.py
--rw-r--r--   0 runner    (1001) docker     (127)     7269 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/strategy/strategy_helper.py
--rw-r--r--   0 runner    (1001) docker     (127)     1568 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/strategy/strategy_wrapper.py
--rw-r--r--   0 runner    (1001) docker     (127)     9774 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/strategy/strategyupdater.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.615776 freqtrade-2024.3/freqtrade/templates/
--rw-r--r--   0 runner    (1001) docker     (127)    12782 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/FreqaiExampleHybridStrategy.py
--rw-r--r--   0 runner    (1001) docker     (127)    11706 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/FreqaiExampleStrategy.py
--rw-r--r--   0 runner    (1001) docker     (127)     2100 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/base_config.json.j2
--rw-r--r--   0 runner    (1001) docker     (127)     5903 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/base_strategy.py.j2
--rw-r--r--   0 runner    (1001) docker     (127)     1917 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/sample_hyperopt_loss.py
--rw-r--r--   0 runner    (1001) docker     (127)    16720 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/sample_strategy.py
--rw-r--r--   0 runner    (1001) docker     (127)    14243 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_analysis_example.ipynb
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.615776 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/
--rw-r--r--   0 runner    (1001) docker     (127)      261 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/buy_trend_full.j2
--rw-r--r--   0 runner    (1001) docker     (127)      101 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/buy_trend_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (127)     7747 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/indicators_full.j2
--rw-r--r--   0 runner    (1001) docker     (127)      464 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/indicators_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (127)      506 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/plot_config_full.j2
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/plot_config_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (127)      262 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/sell_trend_full.j2
--rw-r--r--   0 runner    (1001) docker     (127)      103 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/sell_trend_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (127)      249 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/strategy_attributes_full.j2
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/strategy_attributes_minimal.j2
--rw-r--r--   0 runner    (1001) docker     (127)    16126 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/strategy_methods_empty.j2
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.615776 freqtrade-2024.3/freqtrade/templates/subtemplates/
--rw-r--r--   0 runner    (1001) docker     (127)      261 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/subtemplates/exchange_binance.j2
--rw-r--r--   0 runner    (1001) docker     (127)      397 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/subtemplates/exchange_bittrex.j2
--rw-r--r--   0 runner    (1001) docker     (127)      271 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/subtemplates/exchange_gateio.j2
--rw-r--r--   0 runner    (1001) docker     (127)      244 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/subtemplates/exchange_generic.j2
--rw-r--r--   0 runner    (1001) docker     (127)      260 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/subtemplates/exchange_huobi.j2
--rw-r--r--   0 runner    (1001) docker     (127)      249 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/subtemplates/exchange_kraken.j2
--rw-r--r--   0 runner    (1001) docker     (127)      291 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/subtemplates/exchange_kucoin.j2
--rw-r--r--   0 runner    (1001) docker     (127)      291 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/templates/subtemplates/exchange_okex.j2
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.615776 freqtrade-2024.3/freqtrade/types/
--rw-r--r--   0 runner    (1001) docker     (127)      339 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/types/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)      736 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/types/backtest_result_type.py
--rw-r--r--   0 runner    (1001) docker     (127)      311 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/types/valid_exchanges_type.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.619776 freqtrade-2024.3/freqtrade/util/
--rw-r--r--   0 runner    (1001) docker     (127)      854 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     2839 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/datetime_helpers.py
--rw-r--r--   0 runner    (1001) docker     (127)     1656 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/formatters.py
--rw-r--r--   0 runner    (1001) docker     (127)      337 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/ft_precise.py
--rw-r--r--   0 runner    (1001) docker     (127)      458 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/gc_setup.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.619776 freqtrade-2024.3/freqtrade/util/migrations/
--rw-r--r--   0 runner    (1001) docker     (127)      485 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/migrations/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)     2670 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/migrations/binance_mig.py
--rw-r--r--   0 runner    (1001) docker     (127)      813 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/migrations/funding_rate_mig.py
--rw-r--r--   0 runner    (1001) docker     (127)      580 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/periodic_cache.py
--rw-r--r--   0 runner    (1001) docker     (127)      898 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/util/template_renderer.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.619776 freqtrade-2024.3/freqtrade/vendor/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/vendor/__init__.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.619776 freqtrade-2024.3/freqtrade/vendor/qtpylib/
--rw-r--r--   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/vendor/qtpylib/__init__.py
--rw-r--r--   0 runner    (1001) docker     (127)    19869 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/vendor/qtpylib/indicators.py
--rw-r--r--   0 runner    (1001) docker     (127)    15009 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/wallets.py
--rw-r--r--   0 runner    (1001) docker     (127)     8487 2024-03-31 16:25:11.000000 freqtrade-2024.3/freqtrade/worker.py
-drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-03-31 16:25:17.619776 freqtrade-2024.3/freqtrade.egg-info/
--rw-r--r--   0 runner    (1001) docker     (127)    18209 2024-03-31 16:25:17.000000 freqtrade-2024.3/freqtrade.egg-info/PKG-INFO
--rw-r--r--   0 runner    (1001) docker     (127)    13130 2024-03-31 16:25:17.000000 freqtrade-2024.3/freqtrade.egg-info/SOURCES.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-03-31 16:25:17.000000 freqtrade-2024.3/freqtrade.egg-info/dependency_links.txt
--rw-r--r--   0 runner    (1001) docker     (127)       50 2024-03-31 16:25:17.000000 freqtrade-2024.3/freqtrade.egg-info/entry_points.txt
--rw-r--r--   0 runner    (1001) docker     (127)        1 2024-03-31 16:25:17.000000 freqtrade-2024.3/freqtrade.egg-info/not-zip-safe
--rw-r--r--   0 runner    (1001) docker     (127)     1786 2024-03-31 16:25:17.000000 freqtrade-2024.3/freqtrade.egg-info/requires.txt
--rw-r--r--   0 runner    (1001) docker     (127)       10 2024-03-31 16:25:17.000000 freqtrade-2024.3/freqtrade.egg-info/top_level.txt
--rw-r--r--   0 runner    (1001) docker     (127)     3650 2024-03-31 16:25:11.000000 freqtrade-2024.3/pyproject.toml
--rw-r--r--   0 runner    (1001) docker     (127)       38 2024-03-31 16:25:17.627776 freqtrade-2024.3/setup.cfg
--rw-r--r--   0 runner    (1001) docker     (127)     2421 2024-03-31 16:25:11.000000 freqtrade-2024.3/setup.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.534379 freqtrade-2024.4/
+-rw-r--r--   0 runner    (1001) docker     (127)    35141 2024-04-30 12:41:47.000000 freqtrade-2024.4/LICENSE
+-rw-r--r--   0 runner    (1001) docker     (127)      290 2024-04-30 12:41:47.000000 freqtrade-2024.4/MANIFEST.in
+-rw-r--r--   0 runner    (1001) docker     (127)    18224 2024-04-30 12:41:51.534379 freqtrade-2024.4/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)    11493 2024-04-30 12:41:47.000000 freqtrade-2024.4/README.md
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.470379 freqtrade-2024.4/freqtrade/
+-rw-r--r--   0 runner    (1001) docker     (127)      810 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/__init__.py
+-rwxr-xr-x   0 runner    (1001) docker     (127)      206 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/__main__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.474379 freqtrade-2024.4/freqtrade/commands/
+-rw-r--r--   0 runner    (1001) docker     (127)     1912 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2187 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/analyze_commands.py
+-rwxr-xr-x   0 runner    (1001) docker     (127)    22632 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/arguments.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9504 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/build_config_commands.py
+-rwxr-xr-x   0 runner    (1001) docker     (127)    23376 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/cli_options.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5541 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/data_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1672 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/db_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6953 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/deploy_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3634 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/hyperopt_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10329 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/list_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5298 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/optimize_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1458 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/pairlist_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1158 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/plot_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1852 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/strategy_utils_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)      750 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/trade_commands.py
+-rw-r--r--   0 runner    (1001) docker     (127)      428 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/commands/webserver_commands.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.478379 freqtrade-2024.4/freqtrade/configuration/
+-rw-r--r--   0 runner    (1001) docker     (127)      439 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1022 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/config_secrets.py
+-rw-r--r--   0 runner    (1001) docker     (127)      777 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/config_setup.py
+-rw-r--r--   0 runner    (1001) docker     (127)    17535 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/config_validation.py
+-rw-r--r--   0 runner    (1001) docker     (127)    21740 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/configuration.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7049 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/deprecated_settings.py
+-rw-r--r--   0 runner    (1001) docker     (127)      163 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/detect_environment.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3630 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/directory_operations.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1826 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/environment_vars.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3887 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/load_config.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6278 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/configuration/timerange.py
+-rw-r--r--   0 runner    (1001) docker     (127)    30148 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/constants.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.478379 freqtrade-2024.4/freqtrade/data/
+-rw-r--r--   0 runner    (1001) docker     (127)      152 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    18339 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/btanalysis.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.478379 freqtrade-2024.4/freqtrade/data/converter/
+-rw-r--r--   0 runner    (1001) docker     (127)     1238 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/converter/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10906 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/converter/converter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5886 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/converter/trade_converter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3225 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/converter/trade_converter_kraken.py
+-rw-r--r--   0 runner    (1001) docker     (127)    21785 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/dataprovider.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13192 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/entryexitanalysis.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.482379 freqtrade-2024.4/freqtrade/data/history/
+-rw-r--r--   0 runner    (1001) docker     (127)      485 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/history/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.482379 freqtrade-2024.4/freqtrade/data/history/datahandlers/
+-rw-r--r--   0 runner    (1001) docker     (127)       77 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/history/datahandlers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5135 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/history/datahandlers/featherdatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6349 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/history/datahandlers/hdf5datahandler.py
+-rw-r--r--   0 runner    (1001) docker     (127)    20160 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/history/datahandlers/idatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5996 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/history/datahandlers/jsondatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5025 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/history/datahandlers/parquetdatahandler.py
+-rw-r--r--   0 runner    (1001) docker     (127)    25505 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/history/history_utils.py
+-rw-r--r--   0 runner    (1001) docker     (127)    14256 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/data/metrics.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.482379 freqtrade-2024.4/freqtrade/edge/
+-rw-r--r--   0 runner    (1001) docker     (127)       59 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/edge/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    20653 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/edge/edge_positioning.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.486379 freqtrade-2024.4/freqtrade/enums/
+-rw-r--r--   0 runner    (1001) docker     (127)      859 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)      238 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/backteststate.py
+-rw-r--r--   0 runner    (1001) docker     (127)      798 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/candletype.py
+-rw-r--r--   0 runner    (1001) docker     (127)      640 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/exitchecktuple.py
+-rw-r--r--   0 runner    (1001) docker     (127)      619 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/exittype.py
+-rw-r--r--   0 runner    (1001) docker     (127)      210 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/hyperoptstate.py
+-rw-r--r--   0 runner    (1001) docker     (127)      242 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/marginmode.py
+-rw-r--r--   0 runner    (1001) docker     (127)      261 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/marketstatetype.py
+-rw-r--r--   0 runner    (1001) docker     (127)      100 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/ordertypevalue.py
+-rw-r--r--   0 runner    (1001) docker     (127)      177 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/pricetype.py
+-rw-r--r--   0 runner    (1001) docker     (127)      976 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/rpcmessagetype.py
+-rw-r--r--   0 runner    (1001) docker     (127)      588 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/runmode.py
+-rw-r--r--   0 runner    (1001) docker     (127)      626 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/signaltype.py
+-rw-r--r--   0 runner    (1001) docker     (127)      202 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/state.py
+-rw-r--r--   0 runner    (1001) docker     (127)      220 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/enums/tradingmode.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2200 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exceptions.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.490379 freqtrade-2024.4/freqtrade/exchange/
+-rw-r--r--   0 runner    (1001) docker     (127)     1845 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9889 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/binance.py
+-rw-r--r--   0 runner    (1001) docker     (127)   902770 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/binance_leverage_tiers.json
+-rw-r--r--   0 runner    (1001) docker     (127)      357 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/bingx.py
+-rw-r--r--   0 runner    (1001) docker     (127)      449 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/bitmart.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1621 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/bitpanda.py
+-rw-r--r--   0 runner    (1001) docker     (127)      547 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/bitvavo.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9886 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/bybit.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2971 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/check_exchange.py
+-rw-r--r--   0 runner    (1001) docker     (127)      564 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/coinbasepro.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6356 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/common.py
+-rw-r--r--   0 runner    (1001) docker     (127)   139830 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/exchange.py
+-rw-r--r--   0 runner    (1001) docker     (127)    11767 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/exchange_utils.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2804 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/exchange_utils_timeframe.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4965 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/gate.py
+-rw-r--r--   0 runner    (1001) docker     (127)      517 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/hitbtc.py
+-rw-r--r--   0 runner    (1001) docker     (127)      902 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/htx.py
+-rw-r--r--   0 runner    (1001) docker     (127)      354 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/idex.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7130 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/kraken.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2201 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/kucoin.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10248 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/okx.py
+-rw-r--r--   0 runner    (1001) docker     (127)      725 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/exchange/types.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.490379 freqtrade-2024.4/freqtrade/freqai/
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.490379 freqtrade-2024.4/freqtrade/freqai/RL/
+-rw-r--r--   0 runner    (1001) docker     (127)     4496 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/RL/Base3ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5021 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/RL/Base4ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5644 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/RL/Base5ActionRLEnv.py
+-rw-r--r--   0 runner    (1001) docker     (127)    15447 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/RL/BaseEnvironment.py
+-rw-r--r--   0 runner    (1001) docker     (127)    21145 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/RL/BaseReinforcementLearningModel.py
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/RL/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.494379 freqtrade-2024.4/freqtrade/freqai/base_models/
+-rw-r--r--   0 runner    (1001) docker     (127)     5137 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/base_models/BaseClassifierModel.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8283 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/base_models/BasePyTorchClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1144 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/base_models/BasePyTorchModel.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4774 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/base_models/BasePyTorchRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5039 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/base_models/BaseRegressionModel.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3451 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2487 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (127)    33102 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/data_drawer.py
+-rw-r--r--   0 runner    (1001) docker     (127)    43694 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/data_kitchen.py
+-rw-r--r--   0 runner    (1001) docker     (127)    45701 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/freqai_interface.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.494379 freqtrade-2024.4/freqtrade/freqai/prediction_models/
+-rw-r--r--   0 runner    (1001) docker     (127)     2083 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/CatboostClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2866 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2048 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/CatboostRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2834 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1921 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/LightGBMClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2698 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1839 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/LightGBMRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2694 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3622 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3308 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6158 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7160 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/ReinforcementLearner.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3284 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3241 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/SKLearnRandomForestClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3338 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3345 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2074 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2219 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostRegressor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2596 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/prediction_models/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.498379 freqtrade-2024.4/freqtrade/freqai/tensorboard/
+-rw-r--r--   0 runner    (1001) docker     (127)     2152 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/tensorboard/TensorboardCallback.py
+-rw-r--r--   0 runner    (1001) docker     (127)      587 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/tensorboard/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)      690 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/tensorboard/base_tensorboard.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1859 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/tensorboard/tensorboard.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.498379 freqtrade-2024.4/freqtrade/freqai/torch/
+-rw-r--r--   0 runner    (1001) docker     (127)     1886 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/torch/PyTorchDataConvertor.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3762 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/torch/PyTorchMLPModel.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8740 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/torch/PyTorchModelTrainer.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2026 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/torch/PyTorchTrainerInterface.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3613 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/torch/PyTorchTransformerModel.py
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/torch/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)      666 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/torch/datasets.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7457 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqai/utils.py
+-rw-r--r--   0 runner    (1001) docker     (127)   102237 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/freqtradebot.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.498379 freqtrade-2024.4/freqtrade/leverage/
+-rw-r--r--   0 runner    (1001) docker     (127)       63 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/leverage/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1257 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/leverage/interest.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.498379 freqtrade-2024.4/freqtrade/loggers/
+-rw-r--r--   0 runner    (1001) docker     (127)     4271 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/loggers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)      460 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/loggers/buffering_handler.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1598 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/loggers/set_log_levels.py
+-rw-r--r--   0 runner    (1001) docker     (127)      714 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/loggers/std_err_stream_handler.py
+-rwxr-xr-x   0 runner    (1001) docker     (127)     2328 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/main.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7610 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/misc.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.498379 freqtrade-2024.4/freqtrade/mixins/
+-rw-r--r--   0 runner    (1001) docker     (127)       70 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/mixins/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1263 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/mixins/logging_mixin.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.502379 freqtrade-2024.4/freqtrade/optimize/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.502379 freqtrade-2024.4/freqtrade/optimize/analysis/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/analysis/__init__.py
+-rwxr-xr-x   0 runner    (1001) docker     (127)    12380 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/analysis/lookahead.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10417 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/analysis/lookahead_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7448 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/analysis/recursive.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4230 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/analysis/recursive_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1519 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/backtest_caching.py
+-rw-r--r--   0 runner    (1001) docker     (127)    67874 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/backtesting.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1902 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/base_analysis.py
+-rw-r--r--   0 runner    (1001) docker     (127)      856 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/bt_progress.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1823 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/edge_cli.py
+-rw-r--r--   0 runner    (1001) docker     (127)    29040 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3672 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_auto.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4525 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_epoch_filters.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8554 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_interface.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.502379 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/
+-rw-r--r--   0 runner    (1001) docker     (127)     1102 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1237 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1470 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py
+-rw-r--r--   0 runner    (1001) docker     (127)      746 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py
+-rw-r--r--   0 runner    (1001) docker     (127)      931 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1095 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2108 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1965 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1109 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2568 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py
+-rw-r--r--   0 runner    (1001) docker     (127)      951 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_loss_interface.py
+-rw-r--r--   0 runner    (1001) docker     (127)    23157 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/hyperopt_tools.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.506379 freqtrade-2024.4/freqtrade/optimize/optimize_reports/
+-rw-r--r--   0 runner    (1001) docker     (127)     1345 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/optimize_reports/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    18515 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/optimize_reports/bt_output.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3649 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/optimize_reports/bt_storage.py
+-rw-r--r--   0 runner    (1001) docker     (127)    23477 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/optimize_reports/optimize_reports.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.506379 freqtrade-2024.4/freqtrade/optimize/space/
+-rw-r--r--   0 runner    (1001) docker     (127)      127 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/space/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1402 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/optimize/space/decimalspace.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.506379 freqtrade-2024.4/freqtrade/persistence/
+-rw-r--r--   0 runner    (1001) docker     (127)      504 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)      154 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/base.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6569 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/custom_data.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6439 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/key_value_store.py
+-rw-r--r--   0 runner    (1001) docker     (127)    16084 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/migrations.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3145 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/models.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3103 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/pairlock.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6364 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/pairlock_middleware.py
+-rw-r--r--   0 runner    (1001) docker     (127)    80124 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/trade_model.py
+-rw-r--r--   0 runner    (1001) docker     (127)      968 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/persistence/usedb_context.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.506379 freqtrade-2024.4/freqtrade/plot/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plot/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    26350 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plot/plotting.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.506379 freqtrade-2024.4/freqtrade/plugins/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.510379 freqtrade-2024.4/freqtrade/plugins/pairlist/
+-rw-r--r--   0 runner    (1001) docker     (127)     6497 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/AgeFilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1875 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/FullTradesFilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9088 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/IPairList.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5888 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/MarketCapPairList.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2926 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/OffsetFilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3990 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/PerformanceFilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3089 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/PrecisionFilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6627 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/PriceFilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3987 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/ProducerPairList.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12344 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/RemotePairList.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3639 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/ShuffleFilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2971 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/SpreadFilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2879 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/StaticPairList.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7157 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/VolatilityFilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12988 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/VolumePairList.py
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2311 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/pairlist_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7312 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlist/rangestabilityfilter.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6881 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/pairlistmanager.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2870 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/protectionmanager.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.510379 freqtrade-2024.4/freqtrade/plugins/protections/
+-rw-r--r--   0 runner    (1001) docker     (127)      105 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/protections/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2707 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/protections/cooldown_period.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4272 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/protections/iprotection.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3607 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/protections/low_profit_pairs.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3544 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/protections/max_drawdown_protection.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3691 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/plugins/protections/stoploss_guard.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.514379 freqtrade-2024.4/freqtrade/resolvers/
+-rw-r--r--   0 runner    (1001) docker     (127)      512 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/resolvers/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3699 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/resolvers/exchange_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1776 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/resolvers/freqaimodel_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1727 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/resolvers/hyperopt_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (127)    10538 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/resolvers/iresolver.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1794 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/resolvers/pairlist_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1377 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/resolvers/protection_resolver.py
+-rw-r--r--   0 runner    (1001) docker     (127)    13871 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/resolvers/strategy_resolver.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.514379 freqtrade-2024.4/freqtrade/rpc/
+-rw-r--r--   0 runner    (1001) docker     (127)      111 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.514379 freqtrade-2024.4/freqtrade/rpc/api_server/
+-rw-r--r--   0 runner    (1001) docker     (127)       47 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5445 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/api_auth.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5234 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/api_background_tasks.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12785 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/api_backtest.py
+-rw-r--r--   0 runner    (1001) docker     (127)    14070 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/api_schemas.py
+-rw-r--r--   0 runner    (1001) docker     (127)    18152 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/api_v1.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4601 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/api_ws.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2033 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/deps.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.518379 freqtrade-2024.4/freqtrade/rpc/api_server/ui/
+-rw-r--r--   0 runner    (1001) docker     (127)      753 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/ui/fallback_file.html
+-rw-r--r--   0 runner    (1001) docker     (127)   126794 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/ui/favicon.ico
+-rw-r--r--   0 runner    (1001) docker     (127)     2100 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/uvicorn_threaded.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2175 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/web_ui.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8230 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/webserver.py
+-rw-r--r--   0 runner    (1001) docker     (127)      889 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/webserver_bgwork.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.518379 freqtrade-2024.4/freqtrade/rpc/api_server/ws/
+-rw-r--r--   0 runner    (1001) docker     (127)      419 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/ws/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7565 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/ws/channel.py
+-rw-r--r--   0 runner    (1001) docker     (127)      898 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/ws/message_stream.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2292 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/ws/proxy.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1678 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/ws/serializer.py
+-rw-r--r--   0 runner    (1001) docker     (127)      257 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/ws/types.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1884 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/api_server/ws_schemas.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2052 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/discord.py
+-rw-r--r--   0 runner    (1001) docker     (127)    14701 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/external_message_consumer.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7312 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/fiat_convert.py
+-rw-r--r--   0 runner    (1001) docker     (127)    62215 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/rpc.py
+-rw-r--r--   0 runner    (1001) docker     (127)     5294 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/rpc_manager.py
+-rw-r--r--   0 runner    (1001) docker     (127)     3206 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/rpc_types.py
+-rw-r--r--   0 runner    (1001) docker     (127)    84100 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/telegram.py
+-rw-r--r--   0 runner    (1001) docker     (127)     4911 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/rpc/webhook.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.518379 freqtrade-2024.4/freqtrade/strategy/
+-rw-r--r--   0 runner    (1001) docker     (127)      650 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/strategy/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8240 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/strategy/hyper.py
+-rw-r--r--   0 runner    (1001) docker     (127)     6128 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/strategy/informative_decorator.py
+-rw-r--r--   0 runner    (1001) docker     (127)    69757 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/strategy/interface.py
+-rw-r--r--   0 runner    (1001) docker     (127)    12586 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/strategy/parameters.py
+-rw-r--r--   0 runner    (1001) docker     (127)     7269 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/strategy/strategy_helper.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1568 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/strategy/strategy_wrapper.py
+-rw-r--r--   0 runner    (1001) docker     (127)     9774 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/strategy/strategyupdater.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.522379 freqtrade-2024.4/freqtrade/templates/
+-rw-r--r--   0 runner    (1001) docker     (127)    12782 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/FreqaiExampleHybridStrategy.py
+-rw-r--r--   0 runner    (1001) docker     (127)    11706 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/FreqaiExampleStrategy.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2100 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/base_config.json.j2
+-rw-r--r--   0 runner    (1001) docker     (127)     5903 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/base_strategy.py.j2
+-rw-r--r--   0 runner    (1001) docker     (127)     1917 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/sample_hyperopt_loss.py
+-rw-r--r--   0 runner    (1001) docker     (127)    16720 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/sample_strategy.py
+-rw-r--r--   0 runner    (1001) docker     (127)    14243 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_analysis_example.ipynb
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.522379 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/
+-rw-r--r--   0 runner    (1001) docker     (127)      261 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/buy_trend_full.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      101 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/buy_trend_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (127)     7747 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/indicators_full.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      464 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/indicators_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      506 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/plot_config_full.j2
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/plot_config_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      262 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/sell_trend_full.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      103 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/sell_trend_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      249 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/strategy_attributes_full.j2
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/strategy_attributes_minimal.j2
+-rw-r--r--   0 runner    (1001) docker     (127)    16125 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/strategy_methods_empty.j2
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.522379 freqtrade-2024.4/freqtrade/templates/subtemplates/
+-rw-r--r--   0 runner    (1001) docker     (127)      261 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/subtemplates/exchange_binance.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      397 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/subtemplates/exchange_bittrex.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      271 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/subtemplates/exchange_gateio.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      244 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/subtemplates/exchange_generic.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      260 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/subtemplates/exchange_huobi.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      249 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/subtemplates/exchange_kraken.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      291 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/subtemplates/exchange_kucoin.j2
+-rw-r--r--   0 runner    (1001) docker     (127)      291 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/templates/subtemplates/exchange_okex.j2
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.522379 freqtrade-2024.4/freqtrade/types/
+-rw-r--r--   0 runner    (1001) docker     (127)      339 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/types/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)      736 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/types/backtest_result_type.py
+-rw-r--r--   0 runner    (1001) docker     (127)      311 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/types/valid_exchanges_type.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.526379 freqtrade-2024.4/freqtrade/util/
+-rw-r--r--   0 runner    (1001) docker     (127)      937 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2740 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/datetime_helpers.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1656 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/formatters.py
+-rw-r--r--   0 runner    (1001) docker     (127)      337 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/ft_precise.py
+-rw-r--r--   0 runner    (1001) docker     (127)      458 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/gc_setup.py
+-rw-r--r--   0 runner    (1001) docker     (127)     1312 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/measure_time.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.526379 freqtrade-2024.4/freqtrade/util/migrations/
+-rw-r--r--   0 runner    (1001) docker     (127)      485 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/migrations/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)     2670 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/migrations/binance_mig.py
+-rw-r--r--   0 runner    (1001) docker     (127)      813 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/migrations/funding_rate_mig.py
+-rw-r--r--   0 runner    (1001) docker     (127)      580 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/periodic_cache.py
+-rw-r--r--   0 runner    (1001) docker     (127)      990 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/util/template_renderer.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.526379 freqtrade-2024.4/freqtrade/vendor/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/vendor/__init__.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.526379 freqtrade-2024.4/freqtrade/vendor/qtpylib/
+-rw-r--r--   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/vendor/qtpylib/__init__.py
+-rw-r--r--   0 runner    (1001) docker     (127)    19869 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/vendor/qtpylib/indicators.py
+-rw-r--r--   0 runner    (1001) docker     (127)    15005 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/wallets.py
+-rw-r--r--   0 runner    (1001) docker     (127)     8486 2024-04-30 12:41:47.000000 freqtrade-2024.4/freqtrade/worker.py
+drwxr-xr-x   0 runner    (1001) docker     (127)        0 2024-04-30 12:41:51.526379 freqtrade-2024.4/freqtrade.egg-info/
+-rw-r--r--   0 runner    (1001) docker     (127)    18224 2024-04-30 12:41:51.000000 freqtrade-2024.4/freqtrade.egg-info/PKG-INFO
+-rw-r--r--   0 runner    (1001) docker     (127)    13216 2024-04-30 12:41:51.000000 freqtrade-2024.4/freqtrade.egg-info/SOURCES.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-04-30 12:41:51.000000 freqtrade-2024.4/freqtrade.egg-info/dependency_links.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       50 2024-04-30 12:41:51.000000 freqtrade-2024.4/freqtrade.egg-info/entry_points.txt
+-rw-r--r--   0 runner    (1001) docker     (127)        1 2024-04-30 12:41:51.000000 freqtrade-2024.4/freqtrade.egg-info/not-zip-safe
+-rw-r--r--   0 runner    (1001) docker     (127)     1801 2024-04-30 12:41:51.000000 freqtrade-2024.4/freqtrade.egg-info/requires.txt
+-rw-r--r--   0 runner    (1001) docker     (127)       10 2024-04-30 12:41:51.000000 freqtrade-2024.4/freqtrade.egg-info/top_level.txt
+-rw-r--r--   0 runner    (1001) docker     (127)     4088 2024-04-30 12:41:47.000000 freqtrade-2024.4/pyproject.toml
+-rw-r--r--   0 runner    (1001) docker     (127)       38 2024-04-30 12:41:51.534379 freqtrade-2024.4/setup.cfg
+-rw-r--r--   0 runner    (1001) docker     (127)     2436 2024-04-30 12:41:47.000000 freqtrade-2024.4/setup.py
```

### Comparing `freqtrade-2024.3/LICENSE` & `freqtrade-2024.4/LICENSE`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/PKG-INFO` & `freqtrade-2024.4/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: freqtrade
-Version: 2024.3
+Version: 2024.4
 Summary: Freqtrade - Crypto Trading Bot
 Home-page: https://github.com/freqtrade/freqtrade
 Author: Freqtrade Team
 Author-email: Freqtrade Team <freqtrade@protonmail.com>
 License: GPLv3
 Project-URL: Homepage, https://github.com/freqtrade/freqtrade
 Project-URL: Documentation, https://freqtrade.io
@@ -21,22 +21,22 @@
 Classifier: Topic :: Office/Business :: Financial :: Investment
 Requires-Python: >=3.9
 Description-Content-Type: text/markdown
 License-File: LICENSE
 Requires-Dist: ccxt>=4.2.47
 Requires-Dist: SQLAlchemy>=2.0.6
 Requires-Dist: python-telegram-bot>=20.1
-Requires-Dist: arrow>=1.0.0
+Requires-Dist: humanize>=4.0.0
 Requires-Dist: cachetools
 Requires-Dist: requests
 Requires-Dist: httpx>=0.24.1
 Requires-Dist: urllib3
 Requires-Dist: jsonschema
 Requires-Dist: numpy
-Requires-Dist: pandas
+Requires-Dist: pandas<3.0,>=2.2.0
 Requires-Dist: TA-Lib
 Requires-Dist: pandas-ta
 Requires-Dist: technical
 Requires-Dist: tabulate
 Requires-Dist: pycoingecko
 Requires-Dist: py_find_1st
 Requires-Dist: python-rapidjson
```

### Comparing `freqtrade-2024.3/README.md` & `freqtrade-2024.4/README.md`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/__init__.py` & `freqtrade-2024.4/freqtrade/__init__.py`

 * *Files 0% similar despite different names*

```diff
@@ -1,9 +1,9 @@
 """ Freqtrade bot """
-__version__ = '2024.3'
+__version__ = '2024.4'
 
 if 'dev' in __version__:
     from pathlib import Path
     try:
         import subprocess
         freqtrade_basedir = Path(__file__).parent
```

### Comparing `freqtrade-2024.3/freqtrade/commands/__init__.py` & `freqtrade-2024.4/freqtrade/commands/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/analyze_commands.py` & `freqtrade-2024.4/freqtrade/commands/analyze_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/arguments.py` & `freqtrade-2024.4/freqtrade/commands/arguments.py`

 * *Files 0% similar despite different names*

```diff
@@ -193,15 +193,18 @@
         self._build_args(optionlist=ARGS_COMMON, parser=group)
 
         _strategy_parser = argparse.ArgumentParser(add_help=False)
         strategy_group = _strategy_parser.add_argument_group("Strategy arguments")
         self._build_args(optionlist=ARGS_STRATEGY, parser=strategy_group)
 
         # Build main command
-        self.parser = argparse.ArgumentParser(description='Free, open source crypto trading bot')
+        self.parser = argparse.ArgumentParser(
+            prog="freqtrade",
+            description='Free, open source crypto trading bot'
+        )
         self._build_args(optionlist=['version'], parser=self.parser)
 
         from freqtrade.commands import (start_analysis_entries_exits, start_backtesting,
                                         start_backtesting_show, start_convert_data,
                                         start_convert_db, start_convert_trades,
                                         start_create_userdir, start_download_data, start_edge,
                                         start_hyperopt, start_hyperopt_list, start_hyperopt_show,
```

### Comparing `freqtrade-2024.3/freqtrade/commands/build_config_commands.py` & `freqtrade-2024.4/freqtrade/commands/build_config_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/cli_options.py` & `freqtrade-2024.4/freqtrade/commands/cli_options.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/data_commands.py` & `freqtrade-2024.4/freqtrade/commands/data_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/db_commands.py` & `freqtrade-2024.4/freqtrade/commands/db_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/deploy_commands.py` & `freqtrade-2024.4/freqtrade/commands/deploy_commands.py`

 * *Files 2% similar despite different names*

```diff
@@ -12,14 +12,18 @@
 from freqtrade.exceptions import ConfigurationError, OperationalException
 from freqtrade.util import render_template, render_template_with_fallback
 
 
 logger = logging.getLogger(__name__)
 
 
+# Timeout for requests
+req_timeout = 30
+
+
 def start_create_userdir(args: Dict[str, Any]) -> None:
     """
     Create "user_data" directory to contain user data strategies, hyperopt, ...)
     :param args: Cli args from Arguments()
     :return: None
     """
     if "user_data_dir" in args and args["user_data_dir"]:
@@ -115,15 +119,15 @@
 
 
 def download_and_install_ui(dest_folder: Path, dl_url: str, version: str):
     from io import BytesIO
     from zipfile import ZipFile
 
     logger.info(f"Downloading {dl_url}")
-    resp = requests.get(dl_url).content
+    resp = requests.get(dl_url, timeout=req_timeout).content
     dest_folder.mkdir(parents=True, exist_ok=True)
     with ZipFile(BytesIO(resp)) as zf:
         for fn in zf.filelist:
             with zf.open(fn) as x:
                 destfile = dest_folder / fn.filename
                 if fn.is_dir():
                     destfile.mkdir(exist_ok=True)
@@ -133,15 +137,15 @@
         f.write(version)
 
 
 def get_ui_download_url(version: Optional[str] = None) -> Tuple[str, str]:
     base_url = 'https://api.github.com/repos/freqtrade/frequi/'
     # Get base UI Repo path
 
-    resp = requests.get(f"{base_url}releases")
+    resp = requests.get(f"{base_url}releases", timeout=req_timeout)
     resp.raise_for_status()
     r = resp.json()
 
     if version:
         tmp = [x for x in r if x['name'] == version]
         if tmp:
             latest_version = tmp[0]['name']
@@ -154,15 +158,15 @@
     dl_url = ''
     if assets and len(assets) > 0:
         dl_url = assets[0]['browser_download_url']
 
     # URL not found - try assets url
     if not dl_url:
         assets = r[0]['assets_url']
-        resp = requests.get(assets)
+        resp = requests.get(assets, timeout=req_timeout)
         r = resp.json()
         dl_url = r[0]['browser_download_url']
 
     return dl_url, latest_version
 
 
 def start_install_ui(args: Dict[str, Any]) -> None:
```

### Comparing `freqtrade-2024.3/freqtrade/commands/hyperopt_commands.py` & `freqtrade-2024.4/freqtrade/commands/hyperopt_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/list_commands.py` & `freqtrade-2024.4/freqtrade/commands/list_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/optimize_commands.py` & `freqtrade-2024.4/freqtrade/commands/optimize_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/pairlist_commands.py` & `freqtrade-2024.4/freqtrade/commands/pairlist_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/plot_commands.py` & `freqtrade-2024.4/freqtrade/commands/plot_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/strategy_utils_commands.py` & `freqtrade-2024.4/freqtrade/commands/strategy_utils_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/commands/trade_commands.py` & `freqtrade-2024.4/freqtrade/commands/trade_commands.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/configuration/config_secrets.py` & `freqtrade-2024.4/freqtrade/configuration/config_secrets.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/configuration/config_setup.py` & `freqtrade-2024.4/freqtrade/configuration/config_setup.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/configuration/config_validation.py` & `freqtrade-2024.4/freqtrade/configuration/config_validation.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/configuration/configuration.py` & `freqtrade-2024.4/freqtrade/configuration/configuration.py`

 * *Files 1% similar despite different names*

```diff
@@ -9,15 +9,15 @@
 
 from freqtrade import constants
 from freqtrade.configuration.deprecated_settings import process_temporary_deprecated_settings
 from freqtrade.configuration.directory_operations import create_datadir, create_userdata_dir
 from freqtrade.configuration.environment_vars import enironment_vars_to_dict
 from freqtrade.configuration.load_config import load_file, load_from_files
 from freqtrade.constants import Config
-from freqtrade.enums import NON_UTIL_MODES, TRADING_MODES, CandleType, RunMode, TradingMode
+from freqtrade.enums import NON_UTIL_MODES, TRADE_MODES, CandleType, RunMode, TradingMode
 from freqtrade.exceptions import OperationalException
 from freqtrade.loggers import setup_logging
 from freqtrade.misc import deep_merge_dicts, parse_db_uri_for_logging
 
 
 logger = logging.getLogger(__name__)
 
@@ -123,15 +123,15 @@
 
         if 'logfile' in self.args and self.args['logfile']:
             config.update({'logfile': self.args['logfile']})
 
         setup_logging(config)
 
     def _process_trading_options(self, config: Config) -> None:
-        if config['runmode'] not in TRADING_MODES:
+        if config['runmode'] not in TRADE_MODES:
             return
 
         if config.get('dry_run', False):
             logger.info('Dry run is enabled')
             if config.get('db_url') in [None, constants.DEFAULT_DB_PROD_URL]:
                 # Default to in-memory db for dry_run if not specified
                 config['db_url'] = constants.DEFAULT_DB_DRYRUN_URL
@@ -198,15 +198,15 @@
             config['exportfilename'] = Path(config['exportfilename'])
         else:
             config['exportfilename'] = (config['user_data_dir']
                                         / 'backtest_results')
 
         if self.args.get('show_sensitive'):
             logger.warning(
-                "Sensitive information will be shown in the upcomming output. "
+                "Sensitive information will be shown in the upcoming output. "
                 "Please make sure to never share this output without redacting "
                 "the information yourself.")
 
     def _process_optimize_options(self, config: Config) -> None:
 
         # This will override the strategy configuration
         self._args_to_config(config, argname='timeframe',
```

### Comparing `freqtrade-2024.3/freqtrade/configuration/deprecated_settings.py` & `freqtrade-2024.4/freqtrade/configuration/deprecated_settings.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/configuration/directory_operations.py` & `freqtrade-2024.4/freqtrade/configuration/directory_operations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/configuration/environment_vars.py` & `freqtrade-2024.4/freqtrade/configuration/environment_vars.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/configuration/load_config.py` & `freqtrade-2024.4/freqtrade/configuration/load_config.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/configuration/timerange.py` & `freqtrade-2024.4/freqtrade/configuration/timerange.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/constants.py` & `freqtrade-2024.4/freqtrade/constants.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/btanalysis.py` & `freqtrade-2024.4/freqtrade/data/btanalysis.py`

 * *Files 0% similar despite different names*

```diff
@@ -234,14 +234,24 @@
     if strategy not in metadata:
         raise ValueError("Strategy not in metadata.")
     metadata[strategy].update(content)
     # Write data again.
     file_dump_json(get_backtest_metadata_filename(filename), metadata)
 
 
+def get_backtest_market_change(filename: Path, include_ts: bool = True) -> pd.DataFrame:
+    """
+    Read backtest market change file.
+    """
+    df = pd.read_feather(filename)
+    if include_ts:
+        df.loc[:, '__date_ts'] = df.loc[:, 'date'].astype(np.int64) // 1000 // 1000
+    return df
+
+
 def find_existing_backtest_stats(dirname: Union[Path, str], run_ids: Dict[str, str],
                                  min_backtest_date: Optional[datetime] = None) -> Dict[str, Any]:
     """
     Find existing backtest stats that match specified run IDs and load them.
     :param dirname: pathlib.Path object, or string pointing to the file.
     :param run_ids: {strategy_name: id_string} dictionary.
     :param min_backtest_date: do not load a backtest older than specified date.
```

### Comparing `freqtrade-2024.3/freqtrade/data/converter/__init__.py` & `freqtrade-2024.4/freqtrade/data/converter/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/converter/converter.py` & `freqtrade-2024.4/freqtrade/data/converter/converter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/converter/trade_converter.py` & `freqtrade-2024.4/freqtrade/data/converter/trade_converter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/converter/trade_converter_kraken.py` & `freqtrade-2024.4/freqtrade/data/converter/trade_converter_kraken.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/dataprovider.py` & `freqtrade-2024.4/freqtrade/data/dataprovider.py`

 * *Files 0% similar despite different names*

```diff
@@ -519,15 +519,15 @@
         return self._exchange.fetch_l2_order_book(pair, maximum)
 
     def send_msg(self, message: str, *, always_send: bool = False) -> None:
         """
         Send custom RPC Notifications from your bot.
         Will not send any bot in modes other than Dry-run or Live.
         :param message: Message to be sent. Must be below 4096.
-        :param always_send: If False, will send the message only once per candle, and surpress
+        :param always_send: If False, will send the message only once per candle, and suppress
                             identical messages.
                             Careful as this can end up spaming your chat.
                             Defaults to False
         """
         if self.runmode not in (RunMode.DRY_RUN, RunMode.LIVE):
             return
```

### Comparing `freqtrade-2024.3/freqtrade/data/entryexitanalysis.py` & `freqtrade-2024.4/freqtrade/data/entryexitanalysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/history/datahandlers/featherdatahandler.py` & `freqtrade-2024.4/freqtrade/data/history/datahandlers/featherdatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/history/datahandlers/hdf5datahandler.py` & `freqtrade-2024.4/freqtrade/data/history/datahandlers/hdf5datahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/history/datahandlers/idatahandler.py` & `freqtrade-2024.4/freqtrade/data/history/datahandlers/idatahandler.py`

 * *Files 1% similar despite different names*

```diff
@@ -298,16 +298,16 @@
 
     @staticmethod
     def rebuild_pair_from_filename(pair: str) -> str:
         """
         Rebuild pair name from filename
         Assumes a asset name of max. 7 length to also support BTC-PERP and BTC-PERP:USD names.
         """
-        res = re.sub(r'^(([A-Za-z\d]{1,10})|^([A-Za-z\-]{1,6}))(_)', r'\g<1>/', pair, 1)
-        res = re.sub('_', ':', res, 1)
+        res = re.sub(r'^(([A-Za-z\d]{1,10})|^([A-Za-z\-]{1,6}))(_)', r'\g<1>/', pair, count=1)
+        res = re.sub('_', ':', res, count=1)
         return res
 
     def ohlcv_load(self, pair, timeframe: str,
                    candle_type: CandleType, *,
                    timerange: Optional[TimeRange] = None,
                    fill_missing: bool = True,
                    drop_incomplete: bool = False,
```

### Comparing `freqtrade-2024.3/freqtrade/data/history/datahandlers/jsondatahandler.py` & `freqtrade-2024.4/freqtrade/data/history/datahandlers/jsondatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/history/datahandlers/parquetdatahandler.py` & `freqtrade-2024.4/freqtrade/data/history/datahandlers/parquetdatahandler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/history/history_utils.py` & `freqtrade-2024.4/freqtrade/data/history/history_utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/data/metrics.py` & `freqtrade-2024.4/freqtrade/data/metrics.py`

 * *Files 4% similar despite different names*

```diff
@@ -26,26 +26,61 @@
         start = df[column].dropna().iloc[0]
         end = df[column].dropna().iloc[-1]
         tmp_means.append((end - start) / start)
 
     return float(np.mean(tmp_means))
 
 
-def combine_dataframes_with_mean(data: Dict[str, pd.DataFrame],
-                                 column: str = "close") -> pd.DataFrame:
+def combine_dataframes_by_column(
+        data: Dict[str, pd.DataFrame], column: str = "close") -> pd.DataFrame:
     """
     Combine multiple dataframes "column"
     :param data: Dict of Dataframes, dict key should be pair.
     :param column: Column in the original dataframes to use
-    :return: DataFrame with the column renamed to the dict key, and a column
-        named mean, containing the mean of all pairs.
+    :return: DataFrame with the column renamed to the dict key.
     :raise: ValueError if no data is provided.
     """
+    if not data:
+        raise ValueError("No data provided.")
     df_comb = pd.concat([data[pair].set_index('date').rename(
         {column: pair}, axis=1)[pair] for pair in data], axis=1)
+    return df_comb
+
+
+def combined_dataframes_with_rel_mean(
+        data: Dict[str, pd.DataFrame], fromdt: datetime, todt: datetime,
+        column: str = "close") -> pd.DataFrame:
+    """
+    Combine multiple dataframes "column"
+    :param data: Dict of Dataframes, dict key should be pair.
+    :param column: Column in the original dataframes to use
+    :return: DataFrame with the column renamed to the dict key, and a column
+        named mean, containing the mean of all pairs.
+    :raise: ValueError if no data is provided.
+    """
+    df_comb = combine_dataframes_by_column(data, column)
+    # Trim dataframes to the given timeframe
+    df_comb = df_comb.iloc[(df_comb.index >= fromdt) & (df_comb.index < todt)]
+    df_comb['count'] = df_comb.count(axis=1)
+    df_comb['mean'] = df_comb.mean(axis=1)
+    df_comb['rel_mean'] = df_comb['mean'].pct_change().fillna(0).cumsum()
+    return df_comb[['mean', 'rel_mean', 'count']]
+
+
+def combine_dataframes_with_mean(
+        data: Dict[str, pd.DataFrame], column: str = "close") -> pd.DataFrame:
+    """
+    Combine multiple dataframes "column"
+    :param data: Dict of Dataframes, dict key should be pair.
+    :param column: Column in the original dataframes to use
+    :return: DataFrame with the column renamed to the dict key, and a column
+        named mean, containing the mean of all pairs.
+    :raise: ValueError if no data is provided.
+    """
+    df_comb = combine_dataframes_by_column(data, column)
 
     df_comb['mean'] = df_comb.mean(axis=1)
 
     return df_comb
 
 
 def create_cum_profit(df: pd.DataFrame, trades: pd.DataFrame, col_name: str,
```

### Comparing `freqtrade-2024.3/freqtrade/edge/edge_positioning.py` & `freqtrade-2024.4/freqtrade/edge/edge_positioning.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/enums/__init__.py` & `freqtrade-2024.4/freqtrade/enums/__init__.py`

 * *Files 10% similar despite different names*

```diff
@@ -5,11 +5,11 @@
 from freqtrade.enums.exittype import ExitType
 from freqtrade.enums.hyperoptstate import HyperoptState
 from freqtrade.enums.marginmode import MarginMode
 from freqtrade.enums.marketstatetype import MarketDirection
 from freqtrade.enums.ordertypevalue import OrderTypeValues
 from freqtrade.enums.pricetype import PriceType
 from freqtrade.enums.rpcmessagetype import NO_ECHO_MESSAGES, RPCMessageType, RPCRequestType
-from freqtrade.enums.runmode import NON_UTIL_MODES, OPTIMIZE_MODES, TRADING_MODES, RunMode
+from freqtrade.enums.runmode import NON_UTIL_MODES, OPTIMIZE_MODES, TRADE_MODES, RunMode
 from freqtrade.enums.signaltype import SignalDirection, SignalTagType, SignalType
 from freqtrade.enums.state import State
 from freqtrade.enums.tradingmode import TradingMode
```

### Comparing `freqtrade-2024.3/freqtrade/enums/candletype.py` & `freqtrade-2024.4/freqtrade/enums/candletype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/enums/exitchecktuple.py` & `freqtrade-2024.4/freqtrade/enums/exitchecktuple.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/enums/exittype.py` & `freqtrade-2024.4/freqtrade/enums/exittype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/enums/rpcmessagetype.py` & `freqtrade-2024.4/freqtrade/enums/rpcmessagetype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/enums/runmode.py` & `freqtrade-2024.4/freqtrade/enums/runmode.py`

 * *Files 25% similar despite different names*

```diff
@@ -14,10 +14,10 @@
     UTIL_EXCHANGE = "util_exchange"
     UTIL_NO_EXCHANGE = "util_no_exchange"
     PLOT = "plot"
     WEBSERVER = "webserver"
     OTHER = "other"
 
 
-TRADING_MODES = [RunMode.LIVE, RunMode.DRY_RUN]
+TRADE_MODES = [RunMode.LIVE, RunMode.DRY_RUN]
 OPTIMIZE_MODES = [RunMode.BACKTEST, RunMode.EDGE, RunMode.HYPEROPT]
-NON_UTIL_MODES = TRADING_MODES + OPTIMIZE_MODES
+NON_UTIL_MODES = TRADE_MODES + OPTIMIZE_MODES
```

### Comparing `freqtrade-2024.3/freqtrade/enums/signaltype.py` & `freqtrade-2024.4/freqtrade/enums/signaltype.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exceptions.py` & `freqtrade-2024.4/freqtrade/exceptions.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/__init__.py` & `freqtrade-2024.4/freqtrade/exchange/__init__.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,13 +1,14 @@
 # flake8: noqa: F401
 # isort: off
 from freqtrade.exchange.common import remove_exchange_credentials, MAP_EXCHANGE_CHILDCLASS
 from freqtrade.exchange.exchange import Exchange
 # isort: on
 from freqtrade.exchange.binance import Binance
+from freqtrade.exchange.bingx import Bingx
 from freqtrade.exchange.bitmart import Bitmart
 from freqtrade.exchange.bitpanda import Bitpanda
 from freqtrade.exchange.bitvavo import Bitvavo
 from freqtrade.exchange.bybit import Bybit
 from freqtrade.exchange.coinbasepro import Coinbasepro
 from freqtrade.exchange.exchange_utils import (ROUND_DOWN, ROUND_UP, amount_to_contract_precision,
                                                amount_to_contracts, amount_to_precision,
@@ -20,10 +21,11 @@
                                                          timeframe_to_next_date,
                                                          timeframe_to_prev_date,
                                                          timeframe_to_resample_freq,
                                                          timeframe_to_seconds)
 from freqtrade.exchange.gate import Gate
 from freqtrade.exchange.hitbtc import Hitbtc
 from freqtrade.exchange.htx import Htx
+from freqtrade.exchange.idex import Idex
 from freqtrade.exchange.kraken import Kraken
 from freqtrade.exchange.kucoin import Kucoin
 from freqtrade.exchange.okx import Okx
```

### Comparing `freqtrade-2024.3/freqtrade/exchange/binance.py` & `freqtrade-2024.4/freqtrade/exchange/binance.py`

 * *Files 2% similar despite different names*

```diff
@@ -80,15 +80,15 @@
                 if assets_margin.get('multiAssetsMargin') is True:
                     msg += ("\nMulti-Asset Mode is not supported by freqtrade. "
                             "Please change 'Asset Mode' on your binance futures account.")
                 if msg:
                     raise OperationalException(msg)
         except ccxt.DDoSProtection as e:
             raise DDosProtection(e) from e
-        except (ccxt.NetworkError, ccxt.ExchangeError) as e:
+        except (ccxt.OperationFailed, ccxt.ExchangeError) as e:
             raise TemporaryError(
                 f'Error in additional_exchange_init due to {e.__class__.__name__}. Message: {e}'
                 ) from e
 
         except ccxt.BaseError as e:
             raise OperationalException(e) from e
 
@@ -206,14 +206,14 @@
                 with leverage_tiers_path.open() as json_file:
                     return json_load(json_file)
             else:
                 try:
                     return self._api.fetch_leverage_tiers()
                 except ccxt.DDoSProtection as e:
                     raise DDosProtection(e) from e
-                except (ccxt.NetworkError, ccxt.ExchangeError) as e:
+                except (ccxt.OperationFailed, ccxt.ExchangeError) as e:
                     raise TemporaryError(f'Could not fetch leverage amounts due to'
                                          f'{e.__class__.__name__}. Message: {e}') from e
                 except ccxt.BaseError as e:
                     raise OperationalException(e) from e
         else:
             return {}
```

### Comparing `freqtrade-2024.3/freqtrade/exchange/binance_leverage_tiers.json` & `freqtrade-2024.4/freqtrade/exchange/binance_leverage_tiers.json`

 * *Files 0% similar despite different names*

#### Pretty-printed

 * *Similarity: 0.9425115899725274%*

 * *Differences: {"'1000BONK/USDT:USDT'": "{1: {'maintenanceMarginRate': 0.02, 'maxLeverage': 25.0, 'info': "*

 * *                         "{'initialLeverage': '25', 'maintMarginRatio': '0.02', 'cum': '25.0'}}, "*

 * *                         "3: {'tier': 4.0, 'minNotional': 50000.0, 'maxNotional': 500000.0, "*

 * *                         "'info': {'bracket': '4', 'notionalCap': '500000', 'notionalFloor': "*

 * *                         "'50000', 'cum': '1400.0'}}, 4: {'tier': 5.0, 'minNotional': 500000.0, "*

 * *                         "'maxNot []*

```diff
@@ -16,105 +16,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "50000",
                 "notionalFloor": "25000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 100000.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 50000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5675.0",
+                "cum": "1400.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "500000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 500000.0,
+            "minNotional": 50000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "26400.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
-                "notionalFloor": "100000"
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
-            "minNotional": 100000.0,
-            "tier": 4.0
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "5",
-                "cum": "10675.0",
+                "bracket": "6",
+                "cum": "51400.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "1250000",
+                "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 1250000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "207650.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "2500000",
+                "notionalFloor": "1250000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 2500000.0,
+            "minNotional": 1250000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "832650.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "5000000",
+                "notionalFloor": "2500000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 5000000.0,
+            "minNotional": 2500000.0,
+            "tier": 8.0
         }
     ],
     "1000FLOKI/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -618,105 +634,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "50000",
                 "notionalFloor": "25000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 100000.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 50000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5675.0",
+                "cum": "1400.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "500000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 500000.0,
+            "minNotional": 50000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "26400.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
-                "notionalFloor": "100000"
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
-            "minNotional": 100000.0,
-            "tier": 4.0
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "5",
-                "cum": "10675.0",
+                "bracket": "6",
+                "cum": "51400.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "1250000",
+                "notionalFloor": "1000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 1250000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "207650.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "2500000",
+                "notionalFloor": "1250000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 2500000.0,
+            "minNotional": 1250000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "832650.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "5000000",
+                "notionalFloor": "2500000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 5000000.0,
+            "minNotional": 2500000.0,
+            "tier": 8.0
         }
     ],
     "1000SATS/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -1870,105 +1902,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
-                "notionalCap": "25000",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
-            "maxNotional": 25000.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
+                "cum": "275.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
                 "notionalCap": "100000",
-                "notionalFloor": "25000"
+                "notionalFloor": "50000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
             "maxNotional": 100000.0,
-            "minNotional": 25000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5675.0",
-                "initialLeverage": "5",
-                "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
+                "cum": "2775.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1000000",
                 "notionalFloor": "100000"
             },
-            "maintenanceMarginRate": 0.1,
-            "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1000000.0,
             "minNotional": 100000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "10675.0",
+                "cum": "52775.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "2000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 1000000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "102775.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "2500000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 2500000.0,
+            "minNotional": 2000000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "415275.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "5000000",
+                "notionalFloor": "2500000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 5000000.0,
+            "minNotional": 2500000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "1665275.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "10000000",
+                "notionalFloor": "5000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 10000000.0,
+            "minNotional": 5000000.0,
+            "tier": 8.0
         }
     ],
     "AGIX/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -3591,14 +3639,144 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "ARB/USDC:USDC": [
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.006",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.006,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "2",
+                "cum": "20.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.01",
+                "notionalCap": "50000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.01,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "3",
+                "cum": "770.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "600000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 600000.0,
+            "minNotional": 50000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "4",
+                "cum": "15770.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1200000",
+                "notionalFloor": "600000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1200000.0,
+            "minNotional": 600000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "5",
+                "cum": "75770.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "3000000",
+                "notionalFloor": "1200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1200000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "6",
+                "cum": "150770.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "5000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 3000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "7",
+                "cum": "775770.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "12000000",
+                "notionalFloor": "5000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 12000000.0,
+            "minNotional": 5000000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "8",
+                "cum": "3775770.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "20000000",
+                "notionalFloor": "12000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 20000000.0,
+            "minNotional": 12000000.0,
+            "tier": 8.0
+        }
+    ],
     "ARB/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -5739,14 +5917,176 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "BCH/USDC:USDC": [
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "75",
+                "maintMarginRatio": "0.005",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.005,
+            "maxLeverage": 75.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "2",
+                "cum": "7.5",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.0065",
+                "notionalCap": "10000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.0065,
+            "maxLeverage": 50.0,
+            "maxNotional": 10000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "3",
+                "cum": "42.5",
+                "initialLeverage": "40",
+                "maintMarginRatio": "0.01",
+                "notionalCap": "50000",
+                "notionalFloor": "10000"
+            },
+            "maintenanceMarginRate": 0.01,
+            "maxLeverage": 40.0,
+            "maxNotional": 50000.0,
+            "minNotional": 10000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "4",
+                "cum": "542.5",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "500000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 500000.0,
+            "minNotional": 50000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "5",
+                "cum": "15542.5",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "2000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "6",
+                "cum": "115542.5",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "4000000",
+                "notionalFloor": "2000000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 4000000.0,
+            "minNotional": 2000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "7",
+                "cum": "215542.5",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "8000000",
+                "notionalFloor": "4000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 8000000.0,
+            "minNotional": 4000000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "8",
+                "cum": "415542.5",
+                "initialLeverage": "3",
+                "maintMarginRatio": "0.15",
+                "notionalCap": "15000000",
+                "notionalFloor": "8000000"
+            },
+            "maintenanceMarginRate": 0.15,
+            "maxLeverage": 3.0,
+            "maxNotional": 15000000.0,
+            "minNotional": 8000000.0,
+            "tier": 8.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "9",
+                "cum": "1915542.5",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "20000000",
+                "notionalFloor": "15000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 20000000.0,
+            "minNotional": 15000000.0,
+            "tier": 9.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "10",
+                "cum": "6915542.5",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "50000000",
+                "notionalFloor": "20000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 50000000.0,
+            "minNotional": 20000000.0,
+            "tier": 10.0
+        }
+    ],
     "BCH/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "75",
@@ -7203,14 +7543,144 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "BOME/USDC:USDC": [
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.01",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.01,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "2",
+                "cum": "50.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "50000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "3",
+                "cum": "300.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "600000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 600000.0,
+            "minNotional": 50000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "4",
+                "cum": "15300.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1200000",
+                "notionalFloor": "600000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1200000.0,
+            "minNotional": 600000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "5",
+                "cum": "75300.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "3000000",
+                "notionalFloor": "1200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1200000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "6",
+                "cum": "150300.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "4000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 4000000.0,
+            "minNotional": 3000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "7",
+                "cum": "650300.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "6000000",
+                "notionalFloor": "4000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 6000000.0,
+            "minNotional": 4000000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "8",
+                "cum": "2150300.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "10000000",
+                "notionalFloor": "6000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 10000000.0,
+            "minNotional": 6000000.0,
+            "tier": 8.0
+        }
+    ],
     "BOME/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -7224,105 +7694,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
-                "notionalCap": "25000",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
-            "maxNotional": 25000.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
+                "cum": "275.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "150000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 150000.0,
+            "minNotional": 50000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "4025.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
-                "notionalFloor": "25000"
+                "notionalCap": "1500000",
+                "notionalFloor": "150000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 100000.0,
-            "minNotional": 25000.0,
-            "tier": 3.0
+            "maxNotional": 1500000.0,
+            "minNotional": 150000.0,
+            "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "4",
-                "cum": "5675.0",
+                "bracket": "5",
+                "cum": "79025.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
-                "notionalFloor": "100000"
+                "notionalCap": "3000000",
+                "notionalFloor": "1500000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
-            "minNotional": 100000.0,
-            "tier": 4.0
+            "maxNotional": 3000000.0,
+            "minNotional": 1500000.0,
+            "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "5",
-                "cum": "10675.0",
+                "bracket": "6",
+                "cum": "154025.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "3750000",
+                "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 3750000.0,
+            "minNotional": 3000000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "622775.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "7500000",
+                "notionalFloor": "3750000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 7500000.0,
+            "minNotional": 3750000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "2497775.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "15000000",
+                "notionalFloor": "7500000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 15000000.0,
+            "minNotional": 7500000.0,
+            "tier": 8.0
         }
     ],
     "BOND/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -12055,14 +12541,144 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 10000000.0,
             "minNotional": 6000000.0,
             "tier": 7.0
         }
     ],
+    "ENA/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "50000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "275.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "100000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 100000.0,
+            "minNotional": 50000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "2775.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1000000",
+                "notionalFloor": "100000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 100000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "52775.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "2000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 1000000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "102775.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "2500000",
+                "notionalFloor": "2000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 2500000.0,
+            "minNotional": 2000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "415275.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "5000000",
+                "notionalFloor": "2500000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 2500000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "8",
+                "cum": "1665275.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "10000000",
+                "notionalFloor": "5000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 10000000.0,
+            "minNotional": 5000000.0,
+            "tier": 8.0
+        }
+    ],
     "ENJ/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "25",
@@ -13406,105 +14022,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
-                "notionalCap": "25000",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
-            "maxNotional": 25000.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
+                "cum": "275.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
                 "notionalCap": "100000",
-                "notionalFloor": "25000"
+                "notionalFloor": "50000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
             "maxNotional": 100000.0,
-            "minNotional": 25000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5675.0",
-                "initialLeverage": "5",
-                "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
+                "cum": "2775.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1000000",
                 "notionalFloor": "100000"
             },
-            "maintenanceMarginRate": 0.1,
-            "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1000000.0,
             "minNotional": 100000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "10675.0",
+                "cum": "52775.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "2000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 1000000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "102775.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "2500000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 2500000.0,
+            "minNotional": 2000000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "415275.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "5000000",
+                "notionalFloor": "2500000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 5000000.0,
+            "minNotional": 2500000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "1665275.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "10000000",
+                "notionalFloor": "5000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 10000000.0,
+            "minNotional": 5000000.0,
+            "tier": 8.0
         }
     ],
     "ETHW/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -13727,14 +14359,160 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
             "minNotional": 3000000.0,
             "tier": 7.0
         }
     ],
+    "FIL/USDC:USDC": [
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "75",
+                "maintMarginRatio": "0.006",
+                "notionalCap": "50000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.006,
+            "maxLeverage": 75.0,
+            "maxNotional": 50000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "2",
+                "cum": "200.0",
+                "initialLeverage": "40",
+                "maintMarginRatio": "0.01",
+                "notionalCap": "250000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.01,
+            "maxLeverage": 40.0,
+            "maxNotional": 250000.0,
+            "minNotional": 50000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "3",
+                "cum": "2700.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "600000",
+                "notionalFloor": "250000"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 20.0,
+            "maxNotional": 600000.0,
+            "minNotional": 250000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "4",
+                "cum": "20700.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1200000",
+                "notionalFloor": "600000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1200000.0,
+            "minNotional": 600000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "5",
+                "cum": "80700.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "3000000",
+                "notionalFloor": "1200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1200000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "6",
+                "cum": "155700.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "6000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 6000000.0,
+            "minNotional": 3000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "7",
+                "cum": "395700.0",
+                "initialLeverage": "3",
+                "maintMarginRatio": "0.165",
+                "notionalCap": "10000000",
+                "notionalFloor": "6000000"
+            },
+            "maintenanceMarginRate": 0.165,
+            "maxLeverage": 3.0,
+            "maxNotional": 10000000.0,
+            "minNotional": 6000000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "8",
+                "cum": "1245700.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "20000000",
+                "notionalFloor": "10000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 20000000.0,
+            "minNotional": 10000000.0,
+            "tier": 8.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "9",
+                "cum": "6245700.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "30000000",
+                "notionalFloor": "20000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 30000000.0,
+            "minNotional": 20000000.0,
+            "tier": 9.0
+        }
+    ],
     "FIL/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "75",
@@ -17708,105 +18486,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
-                "notionalCap": "25000",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
-            "maxNotional": 25000.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
+                "cum": "275.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
                 "notionalCap": "100000",
-                "notionalFloor": "25000"
+                "notionalFloor": "50000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
             "maxNotional": 100000.0,
-            "minNotional": 25000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5675.0",
-                "initialLeverage": "5",
-                "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
+                "cum": "2775.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1000000",
                 "notionalFloor": "100000"
             },
-            "maintenanceMarginRate": 0.1,
-            "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1000000.0,
             "minNotional": 100000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "10675.0",
+                "cum": "52775.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "2000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 1000000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "102775.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "2500000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 2500000.0,
+            "minNotional": 2000000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "415275.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "5000000",
+                "notionalFloor": "2500000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 5000000.0,
+            "minNotional": 2500000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "1665275.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "10000000",
+                "notionalFloor": "5000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 10000000.0,
+            "minNotional": 5000000.0,
+            "tier": 8.0
         }
     ],
     "JUP/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -19869,14 +20663,176 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 2000000.0,
             "minNotional": 1000000.0,
             "tier": 7.0
         }
     ],
+    "LTC/USDC:USDC": [
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "75",
+                "maintMarginRatio": "0.005",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.005,
+            "maxLeverage": 75.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "2",
+                "cum": "5.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.006",
+                "notionalCap": "10000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.006,
+            "maxLeverage": 50.0,
+            "maxNotional": 10000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "3",
+                "cum": "45.0",
+                "initialLeverage": "40",
+                "maintMarginRatio": "0.01",
+                "notionalCap": "50000",
+                "notionalFloor": "10000"
+            },
+            "maintenanceMarginRate": 0.01,
+            "maxLeverage": 40.0,
+            "maxNotional": 50000.0,
+            "minNotional": 10000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "4",
+                "cum": "545.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "750000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 750000.0,
+            "minNotional": 50000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "5",
+                "cum": "23045.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "3000000",
+                "notionalFloor": "750000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 750000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "6",
+                "cum": "173045.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "10000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 10000000.0,
+            "minNotional": 3000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "7",
+                "cum": "423045.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "12000000",
+                "notionalFloor": "10000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 12000000.0,
+            "minNotional": 10000000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "8",
+                "cum": "723045.0",
+                "initialLeverage": "3",
+                "maintMarginRatio": "0.15",
+                "notionalCap": "20000000",
+                "notionalFloor": "12000000"
+            },
+            "maintenanceMarginRate": 0.15,
+            "maxLeverage": 3.0,
+            "maxNotional": 20000000.0,
+            "minNotional": 12000000.0,
+            "tier": 8.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "9",
+                "cum": "2723045.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "30000000",
+                "notionalFloor": "20000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 30000000.0,
+            "minNotional": 20000000.0,
+            "tier": 9.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "10",
+                "cum": "10223045.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "50000000",
+                "notionalFloor": "30000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 50000000.0,
+            "minNotional": 30000000.0,
+            "tier": 10.0
+        }
+    ],
     "LTC/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "75",
@@ -20633,14 +21589,160 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 30000000.0,
             "minNotional": 18000000.0,
             "tier": 8.0
         }
     ],
+    "MATIC/USDC:USDC": [
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "75",
+                "maintMarginRatio": "0.006",
+                "notionalCap": "10000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.006,
+            "maxLeverage": 75.0,
+            "maxNotional": 10000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "2",
+                "cum": "10.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.007",
+                "notionalCap": "25000",
+                "notionalFloor": "10000"
+            },
+            "maintenanceMarginRate": 0.007,
+            "maxLeverage": 50.0,
+            "maxNotional": 25000.0,
+            "minNotional": 10000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "3",
+                "cum": "85.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.01",
+                "notionalCap": "600000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.01,
+            "maxLeverage": 25.0,
+            "maxNotional": 600000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "4",
+                "cum": "9085.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "900000",
+                "notionalFloor": "600000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 900000.0,
+            "minNotional": 600000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "5",
+                "cum": "31585.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1800000",
+                "notionalFloor": "900000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1800000.0,
+            "minNotional": 900000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "6",
+                "cum": "121585.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "4800000",
+                "notionalFloor": "1800000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 4800000.0,
+            "minNotional": 1800000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "7",
+                "cum": "241585.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "6000000",
+                "notionalFloor": "4800000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 6000000.0,
+            "minNotional": 4800000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "8",
+                "cum": "991585.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "18000000",
+                "notionalFloor": "6000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 18000000.0,
+            "minNotional": 6000000.0,
+            "tier": 8.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "9",
+                "cum": "5491585.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "30000000",
+                "notionalFloor": "18000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 30000000.0,
+            "minNotional": 18000000.0,
+            "tier": 9.0
+        }
+    ],
     "MATIC/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "75",
@@ -22065,14 +23167,144 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 2000000.0,
             "minNotional": 1000000.0,
             "tier": 7.0
         }
     ],
+    "NEAR/USDC:USDC": [
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
+                "notionalCap": "10000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
+            "maxNotional": 10000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "2",
+                "cum": "100.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "250000",
+                "notionalFloor": "10000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 250000.0,
+            "minNotional": 10000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "3",
+                "cum": "1350.0",
+                "initialLeverage": "15",
+                "maintMarginRatio": "0.03",
+                "notionalCap": "750000",
+                "notionalFloor": "250000"
+            },
+            "maintenanceMarginRate": 0.03,
+            "maxLeverage": 15.0,
+            "maxNotional": 750000.0,
+            "minNotional": 250000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "4",
+                "cum": "16350.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1500000",
+                "notionalFloor": "750000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1500000.0,
+            "minNotional": 750000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "5",
+                "cum": "91350.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "4000000",
+                "notionalFloor": "1500000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 4000000.0,
+            "minNotional": 1500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "6",
+                "cum": "191350.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "5000000",
+                "notionalFloor": "4000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 4000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "7",
+                "cum": "816350.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "12000000",
+                "notionalFloor": "5000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 12000000.0,
+            "minNotional": 5000000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "8",
+                "cum": "3816350.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "20000000",
+                "notionalFloor": "12000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 20000000.0,
+            "minNotional": 12000000.0,
+            "tier": 8.0
+        }
+    ],
     "NEAR/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -22195,14 +23427,144 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 20000000.0,
             "minNotional": 12000000.0,
             "tier": 8.0
         }
     ],
+    "NEO/USDC:USDC": [
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.006",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.006,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "2",
+                "cum": "20.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.01",
+                "notionalCap": "50000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.01,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "3",
+                "cum": "770.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "400000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 400000.0,
+            "minNotional": 50000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "4",
+                "cum": "10770.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "800000",
+                "notionalFloor": "400000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 800000.0,
+            "minNotional": 400000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "5",
+                "cum": "50770.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "2000000",
+                "notionalFloor": "800000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 800000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "6",
+                "cum": "100770.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "5000000",
+                "notionalFloor": "2000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 2000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "7",
+                "cum": "725770.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "12000000",
+                "notionalFloor": "5000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 12000000.0,
+            "minNotional": 5000000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "8",
+                "cum": "3725770.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "20000000",
+                "notionalFloor": "12000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 20000000.0,
+            "minNotional": 12000000.0,
+            "tier": 8.0
+        }
+    ],
     "NEO/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -23205,14 +24567,128 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 15000000.0,
             "minNotional": 9000000.0,
             "tier": 7.0
         }
     ],
+    "OMNI/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "50.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "675.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "100000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 100000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "5675.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "200000",
+                "notionalFloor": "100000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 200000.0,
+            "minNotional": 100000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "10675.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "73175.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "323175.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "2000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 1000000.0,
+            "tier": 7.0
+        }
+    ],
     "ONDO/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -23229,117 +24705,117 @@
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
                 "initialLeverage": "25",
                 "maintMarginRatio": "0.02",
-                "notionalCap": "25000",
+                "notionalCap": "50000",
                 "notionalFloor": "5000"
             },
             "maintenanceMarginRate": 0.02,
             "maxLeverage": 25.0,
-            "maxNotional": 25000.0,
+            "maxNotional": 50000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "150.0",
+                "cum": "275.0",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
-                "notionalCap": "80000",
-                "notionalFloor": "25000"
+                "notionalCap": "150000",
+                "notionalFloor": "50000"
             },
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 20.0,
-            "maxNotional": 80000.0,
-            "minNotional": 25000.0,
+            "maxNotional": 150000.0,
+            "minNotional": 50000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "2150.0",
+                "cum": "4025.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "800000",
-                "notionalFloor": "80000"
+                "notionalCap": "1500000",
+                "notionalFloor": "150000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 800000.0,
-            "minNotional": 80000.0,
+            "maxNotional": 1500000.0,
+            "minNotional": 150000.0,
             "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "5",
-                "cum": "42150.0",
+                "cum": "79025.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "1600000",
-                "notionalFloor": "800000"
+                "notionalCap": "3000000",
+                "notionalFloor": "1500000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 1600000.0,
-            "minNotional": 800000.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1500000.0,
             "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "6",
-                "cum": "82150.0",
+                "cum": "154025.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "2000000",
-                "notionalFloor": "1600000"
+                "notionalCap": "3750000",
+                "notionalFloor": "3000000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1600000.0,
+            "maxNotional": 3750000.0,
+            "minNotional": 3000000.0,
             "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "7",
-                "cum": "332150.0",
+                "cum": "622775.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "4000000",
-                "notionalFloor": "2000000"
+                "notionalCap": "7500000",
+                "notionalFloor": "3750000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 4000000.0,
-            "minNotional": 2000000.0,
+            "maxNotional": 7500000.0,
+            "minNotional": 3750000.0,
             "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "8",
-                "cum": "1332150.0",
+                "cum": "2497775.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "8000000",
-                "notionalFloor": "4000000"
+                "notionalCap": "15000000",
+                "notionalFloor": "7500000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 8000000.0,
-            "minNotional": 4000000.0,
+            "maxNotional": 15000000.0,
+            "minNotional": 7500000.0,
             "tier": 8.0
         }
     ],
     "ONE/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
@@ -24349,120 +25825,136 @@
     ],
     "PENDLE/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.02",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
-            "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "15",
-                "maintMarginRatio": "0.025",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 15.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "650.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
-                "notionalCap": "200000",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "80000",
                 "notionalFloor": "25000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 200000.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 80000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "10650.0",
+                "cum": "2150.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "800000",
+                "notionalFloor": "80000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 800000.0,
+            "minNotional": 80000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "42150.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "1600000",
+                "notionalFloor": "800000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 4.0
+            "maxNotional": 1600000.0,
+            "minNotional": 800000.0,
+            "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "5",
-                "cum": "23150.0",
+                "bracket": "6",
+                "cum": "82150.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "2000000",
+                "notionalFloor": "1600000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 5.0
+            "maxNotional": 2000000.0,
+            "minNotional": 1600000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "148150.0",
+                "bracket": "7",
+                "cum": "332150.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "3000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "4000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 3000000.0,
-            "minNotional": 1000000.0,
-            "tier": 6.0
+            "maxNotional": 4000000.0,
+            "minNotional": 2000000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "898150.0",
+                "bracket": "8",
+                "cum": "1332150.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
-                "notionalFloor": "3000000"
+                "notionalCap": "8000000",
+                "notionalFloor": "4000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
-            "minNotional": 3000000.0,
-            "tier": 7.0
+            "maxNotional": 8000000.0,
+            "minNotional": 4000000.0,
+            "tier": 8.0
         }
     ],
     "PEOPLE/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -24934,105 +26426,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "80000",
                 "notionalFloor": "25000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 100000.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 80000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5675.0",
+                "cum": "2150.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "800000",
+                "notionalFloor": "80000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 800000.0,
+            "minNotional": 80000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "42150.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
-                "notionalFloor": "100000"
+                "notionalCap": "1600000",
+                "notionalFloor": "800000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
-            "minNotional": 100000.0,
-            "tier": 4.0
+            "maxNotional": 1600000.0,
+            "minNotional": 800000.0,
+            "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "5",
-                "cum": "10675.0",
+                "bracket": "6",
+                "cum": "82150.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "2000000",
+                "notionalFloor": "1600000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 2000000.0,
+            "minNotional": 1600000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "332150.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "4000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 4000000.0,
+            "minNotional": 2000000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "1332150.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "8000000",
+                "notionalFloor": "4000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 8000000.0,
+            "minNotional": 4000000.0,
+            "tier": 8.0
         }
     ],
     "PORTAL/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -25276,105 +26784,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "80000",
                 "notionalFloor": "25000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 100000.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 80000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5675.0",
+                "cum": "2150.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "800000",
+                "notionalFloor": "80000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 800000.0,
+            "minNotional": 80000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "42150.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
-                "notionalFloor": "100000"
+                "notionalCap": "1600000",
+                "notionalFloor": "800000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
-            "minNotional": 100000.0,
-            "tier": 4.0
+            "maxNotional": 1600000.0,
+            "minNotional": 800000.0,
+            "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "5",
-                "cum": "10675.0",
+                "bracket": "6",
+                "cum": "82150.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "2000000",
+                "notionalFloor": "1600000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 2000000.0,
+            "minNotional": 1600000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "332150.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "4000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 4000000.0,
+            "minNotional": 2000000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "1332150.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "8000000",
+                "notionalFloor": "4000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 8000000.0,
+            "minNotional": 4000000.0,
+            "tier": 8.0
         }
     ],
     "QNT/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -26353,120 +27877,136 @@
     ],
     "RNDR/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.02",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
             },
-            "maintenanceMarginRate": 0.02,
-            "maxLeverage": 20.0,
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
-                "initialLeverage": "15",
-                "maintMarginRatio": "0.025",
-                "notionalCap": "50000",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 15.0,
-            "maxNotional": 50000.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "1275.0",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "80000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 80000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "2150.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
-                "notionalCap": "200000",
-                "notionalFloor": "50000"
+                "notionalCap": "800000",
+                "notionalFloor": "80000"
             },
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
-            "maxNotional": 200000.0,
-            "minNotional": 50000.0,
-            "tier": 3.0
+            "maxNotional": 800000.0,
+            "minNotional": 80000.0,
+            "tier": 4.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "4",
-                "cum": "11275.0",
+                "bracket": "5",
+                "cum": "42150.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "1600000",
+                "notionalFloor": "800000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 4.0
+            "maxNotional": 1600000.0,
+            "minNotional": 800000.0,
+            "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "5",
-                "cum": "23775.0",
+                "bracket": "6",
+                "cum": "82150.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "2000000",
+                "notionalFloor": "1600000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 5.0
+            "maxNotional": 2000000.0,
+            "minNotional": 1600000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "148775.0",
+                "bracket": "7",
+                "cum": "332150.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "4000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 6.0
+            "maxNotional": 4000000.0,
+            "minNotional": 2000000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "648775.0",
+                "bracket": "8",
+                "cum": "1332150.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "5000000",
-                "notionalFloor": "2000000"
+                "notionalCap": "8000000",
+                "notionalFloor": "4000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 5000000.0,
-            "minNotional": 2000000.0,
-            "tier": 7.0
+            "maxNotional": 8000000.0,
+            "minNotional": 4000000.0,
+            "tier": 8.0
         }
     ],
     "RONIN/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -27015,14 +28555,144 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "SAGA/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "50000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 50000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "1400.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "500000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 500000.0,
+            "minNotional": 50000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "26400.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "51400.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1250000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1250000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "207650.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "2500000",
+                "notionalFloor": "1250000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 2500000.0,
+            "minNotional": 1250000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "8",
+                "cum": "832650.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "2500000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 2500000.0,
+            "tier": 8.0
+        }
+    ],
     "SAND/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -29234,105 +30904,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "80000",
                 "notionalFloor": "25000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 100000.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 80000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5675.0",
+                "cum": "2150.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "800000",
+                "notionalFloor": "80000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 800000.0,
+            "minNotional": 80000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "42150.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
-                "notionalFloor": "100000"
+                "notionalCap": "1600000",
+                "notionalFloor": "800000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
-            "minNotional": 100000.0,
-            "tier": 4.0
+            "maxNotional": 1600000.0,
+            "minNotional": 800000.0,
+            "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "5",
-                "cum": "10675.0",
+                "bracket": "6",
+                "cum": "82150.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "2000000",
+                "notionalFloor": "1600000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 2000000.0,
+            "minNotional": 1600000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "332150.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "4000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 4000000.0,
+            "minNotional": 2000000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "1332150.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "8000000",
+                "notionalFloor": "4000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 8000000.0,
+            "minNotional": 4000000.0,
+            "tier": 8.0
         }
     ],
     "STX/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -30141,14 +31827,128 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
             "minNotional": 1000000.0,
             "tier": 6.0
         }
     ],
+    "TAO/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "50.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "675.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "100000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 100000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "5675.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "200000",
+                "notionalFloor": "100000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 200000.0,
+            "minNotional": 100000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "10675.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "73175.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "323175.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "2000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 1000000.0,
+            "tier": 7.0
+        }
+    ],
     "THETA/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -30271,14 +32071,144 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 30000000.0,
             "minNotional": 20000000.0,
             "tier": 8.0
         }
     ],
+    "TIA/USDC:USDC": [
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.01",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.01,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "2",
+                "cum": "50.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "50000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "3",
+                "cum": "300.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "600000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 600000.0,
+            "minNotional": 50000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "4",
+                "cum": "15300.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "1200000",
+                "notionalFloor": "600000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 1200000.0,
+            "minNotional": 600000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "5",
+                "cum": "75300.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "3000000",
+                "notionalFloor": "1200000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 3000000.0,
+            "minNotional": 1200000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "6",
+                "cum": "150300.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "4000000",
+                "notionalFloor": "3000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 4000000.0,
+            "minNotional": 3000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "7",
+                "cum": "650300.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "6000000",
+                "notionalFloor": "4000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 6000000.0,
+            "minNotional": 4000000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDC",
+            "info": {
+                "bracket": "8",
+                "cum": "2150300.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "10000000",
+                "notionalFloor": "6000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 10000000.0,
+            "minNotional": 6000000.0,
+            "tier": 8.0
+        }
+    ],
     "TIA/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -30515,14 +32445,128 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 5000000.0,
             "minNotional": 3000000.0,
             "tier": 7.0
         }
     ],
+    "TNSR/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "50.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "675.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "100000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 100000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "5675.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "200000",
+                "notionalFloor": "100000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 200000.0,
+            "minNotional": 100000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "10675.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "500000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 500000.0,
+            "minNotional": 200000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "73175.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "323175.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "2000000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 1000000.0,
+            "tier": 7.0
+        }
+    ],
     "TOKEN/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -30748,105 +32792,121 @@
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "2",
-                "cum": "50.0",
-                "initialLeverage": "20",
-                "maintMarginRatio": "0.025",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
             },
-            "maintenanceMarginRate": 0.025,
-            "maxLeverage": 20.0,
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "3",
-                "cum": "675.0",
-                "initialLeverage": "10",
-                "maintMarginRatio": "0.05",
-                "notionalCap": "100000",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "80000",
                 "notionalFloor": "25000"
             },
-            "maintenanceMarginRate": 0.05,
-            "maxLeverage": 10.0,
-            "maxNotional": 100000.0,
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 80000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
             "currency": "USDT",
             "info": {
                 "bracket": "4",
-                "cum": "5675.0",
+                "cum": "2150.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "800000",
+                "notionalFloor": "80000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 800000.0,
+            "minNotional": 80000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "42150.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
-                "notionalCap": "200000",
-                "notionalFloor": "100000"
+                "notionalCap": "1600000",
+                "notionalFloor": "800000"
             },
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
-            "maxNotional": 200000.0,
-            "minNotional": 100000.0,
-            "tier": 4.0
+            "maxNotional": 1600000.0,
+            "minNotional": 800000.0,
+            "tier": 5.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "5",
-                "cum": "10675.0",
+                "bracket": "6",
+                "cum": "82150.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
-                "notionalCap": "500000",
-                "notionalFloor": "200000"
+                "notionalCap": "2000000",
+                "notionalFloor": "1600000"
             },
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
-            "maxNotional": 500000.0,
-            "minNotional": 200000.0,
-            "tier": 5.0
+            "maxNotional": 2000000.0,
+            "minNotional": 1600000.0,
+            "tier": 6.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "6",
-                "cum": "73175.0",
+                "bracket": "7",
+                "cum": "332150.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
-                "notionalCap": "1000000",
-                "notionalFloor": "500000"
+                "notionalCap": "4000000",
+                "notionalFloor": "2000000"
             },
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
-            "maxNotional": 1000000.0,
-            "minNotional": 500000.0,
-            "tier": 6.0
+            "maxNotional": 4000000.0,
+            "minNotional": 2000000.0,
+            "tier": 7.0
         },
         {
             "currency": "USDT",
             "info": {
-                "bracket": "7",
-                "cum": "323175.0",
+                "bracket": "8",
+                "cum": "1332150.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
-                "notionalCap": "2000000",
-                "notionalFloor": "1000000"
+                "notionalCap": "8000000",
+                "notionalFloor": "4000000"
             },
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
-            "maxNotional": 2000000.0,
-            "minNotional": 1000000.0,
-            "tier": 7.0
+            "maxNotional": 8000000.0,
+            "minNotional": 4000000.0,
+            "tier": 8.0
         }
     ],
     "TRB/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
@@ -32191,14 +34251,144 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 10000000.0,
             "minNotional": 6000000.0,
             "tier": 8.0
         }
     ],
+    "W/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "25000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 25000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "150.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "50000",
+                "notionalFloor": "25000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 50000.0,
+            "minNotional": 25000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "1400.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "500000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 500000.0,
+            "minNotional": 50000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "26400.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "1000000",
+                "notionalFloor": "500000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 1000000.0,
+            "minNotional": 500000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "51400.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "1250000",
+                "notionalFloor": "1000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 1250000.0,
+            "minNotional": 1000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "207650.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "2500000",
+                "notionalFloor": "1250000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 2500000.0,
+            "minNotional": 1250000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "8",
+                "cum": "832650.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "5000000",
+                "notionalFloor": "2500000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 2500000.0,
+            "tier": 8.0
+        }
+    ],
     "WAVES/USDT:USDT": [
         {
             "currency": "USDT",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
@@ -32419,17 +34609,17 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 3000000.0,
             "minNotional": 1500000.0,
             "tier": 7.0
         }
     ],
-    "WIF/USDT:USDT": [
+    "WIF/USDC:USDC": [
         {
-            "currency": "USDT",
+            "currency": "USDC",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "50",
                 "maintMarginRatio": "0.015",
                 "notionalCap": "5000",
                 "notionalFloor": "0"
@@ -32437,15 +34627,15 @@
             "maintenanceMarginRate": 0.015,
             "maxLeverage": 50.0,
             "maxNotional": 5000.0,
             "minNotional": 0.0,
             "tier": 1.0
         },
         {
-            "currency": "USDT",
+            "currency": "USDC",
             "info": {
                 "bracket": "2",
                 "cum": "25.0",
                 "initialLeverage": "25",
                 "maintMarginRatio": "0.02",
                 "notionalCap": "25000",
                 "notionalFloor": "5000"
@@ -32453,15 +34643,15 @@
             "maintenanceMarginRate": 0.02,
             "maxLeverage": 25.0,
             "maxNotional": 25000.0,
             "minNotional": 5000.0,
             "tier": 2.0
         },
         {
-            "currency": "USDT",
+            "currency": "USDC",
             "info": {
                 "bracket": "3",
                 "cum": "150.0",
                 "initialLeverage": "20",
                 "maintMarginRatio": "0.025",
                 "notionalCap": "80000",
                 "notionalFloor": "25000"
@@ -32469,15 +34659,15 @@
             "maintenanceMarginRate": 0.025,
             "maxLeverage": 20.0,
             "maxNotional": 80000.0,
             "minNotional": 25000.0,
             "tier": 3.0
         },
         {
-            "currency": "USDT",
+            "currency": "USDC",
             "info": {
                 "bracket": "4",
                 "cum": "2150.0",
                 "initialLeverage": "10",
                 "maintMarginRatio": "0.05",
                 "notionalCap": "800000",
                 "notionalFloor": "80000"
@@ -32485,15 +34675,15 @@
             "maintenanceMarginRate": 0.05,
             "maxLeverage": 10.0,
             "maxNotional": 800000.0,
             "minNotional": 80000.0,
             "tier": 4.0
         },
         {
-            "currency": "USDT",
+            "currency": "USDC",
             "info": {
                 "bracket": "5",
                 "cum": "42150.0",
                 "initialLeverage": "5",
                 "maintMarginRatio": "0.1",
                 "notionalCap": "1600000",
                 "notionalFloor": "800000"
@@ -32501,15 +34691,15 @@
             "maintenanceMarginRate": 0.1,
             "maxLeverage": 5.0,
             "maxNotional": 1600000.0,
             "minNotional": 800000.0,
             "tier": 5.0
         },
         {
-            "currency": "USDT",
+            "currency": "USDC",
             "info": {
                 "bracket": "6",
                 "cum": "82150.0",
                 "initialLeverage": "4",
                 "maintMarginRatio": "0.125",
                 "notionalCap": "2000000",
                 "notionalFloor": "1600000"
@@ -32517,15 +34707,15 @@
             "maintenanceMarginRate": 0.125,
             "maxLeverage": 4.0,
             "maxNotional": 2000000.0,
             "minNotional": 1600000.0,
             "tier": 6.0
         },
         {
-            "currency": "USDT",
+            "currency": "USDC",
             "info": {
                 "bracket": "7",
                 "cum": "332150.0",
                 "initialLeverage": "2",
                 "maintMarginRatio": "0.25",
                 "notionalCap": "4000000",
                 "notionalFloor": "2000000"
@@ -32533,15 +34723,15 @@
             "maintenanceMarginRate": 0.25,
             "maxLeverage": 2.0,
             "maxNotional": 4000000.0,
             "minNotional": 2000000.0,
             "tier": 7.0
         },
         {
-            "currency": "USDT",
+            "currency": "USDC",
             "info": {
                 "bracket": "8",
                 "cum": "1332150.0",
                 "initialLeverage": "1",
                 "maintMarginRatio": "0.5",
                 "notionalCap": "8000000",
                 "notionalFloor": "4000000"
@@ -32549,14 +34739,144 @@
             "maintenanceMarginRate": 0.5,
             "maxLeverage": 1.0,
             "maxNotional": 8000000.0,
             "minNotional": 4000000.0,
             "tier": 8.0
         }
     ],
+    "WIF/USDT:USDT": [
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "1",
+                "cum": "0.0",
+                "initialLeverage": "50",
+                "maintMarginRatio": "0.015",
+                "notionalCap": "5000",
+                "notionalFloor": "0"
+            },
+            "maintenanceMarginRate": 0.015,
+            "maxLeverage": 50.0,
+            "maxNotional": 5000.0,
+            "minNotional": 0.0,
+            "tier": 1.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "2",
+                "cum": "25.0",
+                "initialLeverage": "25",
+                "maintMarginRatio": "0.02",
+                "notionalCap": "50000",
+                "notionalFloor": "5000"
+            },
+            "maintenanceMarginRate": 0.02,
+            "maxLeverage": 25.0,
+            "maxNotional": 50000.0,
+            "minNotional": 5000.0,
+            "tier": 2.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "3",
+                "cum": "275.0",
+                "initialLeverage": "20",
+                "maintMarginRatio": "0.025",
+                "notionalCap": "200000",
+                "notionalFloor": "50000"
+            },
+            "maintenanceMarginRate": 0.025,
+            "maxLeverage": 20.0,
+            "maxNotional": 200000.0,
+            "minNotional": 50000.0,
+            "tier": 3.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "4",
+                "cum": "5275.0",
+                "initialLeverage": "10",
+                "maintMarginRatio": "0.05",
+                "notionalCap": "2000000",
+                "notionalFloor": "200000"
+            },
+            "maintenanceMarginRate": 0.05,
+            "maxLeverage": 10.0,
+            "maxNotional": 2000000.0,
+            "minNotional": 200000.0,
+            "tier": 4.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "5",
+                "cum": "105275.0",
+                "initialLeverage": "5",
+                "maintMarginRatio": "0.1",
+                "notionalCap": "4000000",
+                "notionalFloor": "2000000"
+            },
+            "maintenanceMarginRate": 0.1,
+            "maxLeverage": 5.0,
+            "maxNotional": 4000000.0,
+            "minNotional": 2000000.0,
+            "tier": 5.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "6",
+                "cum": "205275.0",
+                "initialLeverage": "4",
+                "maintMarginRatio": "0.125",
+                "notionalCap": "5000000",
+                "notionalFloor": "4000000"
+            },
+            "maintenanceMarginRate": 0.125,
+            "maxLeverage": 4.0,
+            "maxNotional": 5000000.0,
+            "minNotional": 4000000.0,
+            "tier": 6.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "7",
+                "cum": "830275.0",
+                "initialLeverage": "2",
+                "maintMarginRatio": "0.25",
+                "notionalCap": "10000000",
+                "notionalFloor": "5000000"
+            },
+            "maintenanceMarginRate": 0.25,
+            "maxLeverage": 2.0,
+            "maxNotional": 10000000.0,
+            "minNotional": 5000000.0,
+            "tier": 7.0
+        },
+        {
+            "currency": "USDT",
+            "info": {
+                "bracket": "8",
+                "cum": "3330275.0",
+                "initialLeverage": "1",
+                "maintMarginRatio": "0.5",
+                "notionalCap": "20000000",
+                "notionalFloor": "10000000"
+            },
+            "maintenanceMarginRate": 0.5,
+            "maxLeverage": 1.0,
+            "maxNotional": 20000000.0,
+            "minNotional": 10000000.0,
+            "tier": 8.0
+        }
+    ],
     "WLD/USDC:USDC": [
         {
             "currency": "USDC",
             "info": {
                 "bracket": "1",
                 "cum": "0.0",
                 "initialLeverage": "75",
```

### Comparing `freqtrade-2024.3/freqtrade/exchange/bitpanda.py` & `freqtrade-2024.4/freqtrade/exchange/bitpanda.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/bitvavo.py` & `freqtrade-2024.4/freqtrade/exchange/bitvavo.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/bybit.py` & `freqtrade-2024.4/freqtrade/exchange/bybit.py`

 * *Files 1% similar despite different names*

```diff
@@ -95,15 +95,15 @@
                     raise OperationalException("Bybit: Unified account is not supported. "
                                                "Please use a standard (sub)account.")
                 else:
                     self.unified_account = False
                     logger.info("Bybit: Standard account.")
         except ccxt.DDoSProtection as e:
             raise DDosProtection(e) from e
-        except (ccxt.NetworkError, ccxt.ExchangeError) as e:
+        except (ccxt.OperationFailed, ccxt.ExchangeError) as e:
             raise TemporaryError(
                 f'Error in additional_exchange_init due to {e.__class__.__name__}. Message: {e}'
                 ) from e
         except ccxt.BaseError as e:
             raise OperationalException(e) from e
 
     def ohlcv_candle_limit(
@@ -235,15 +235,15 @@
         while since < dt_now():
             until = since + timedelta(days=7, minutes=-1)
             orders += super().fetch_orders(pair, since, params={'until': dt_ts(until)})
             since = until
 
         return orders
 
-    def fetch_order(self, order_id: str, pair: str, params: Dict = {}) -> Dict:
+    def fetch_order(self, order_id: str, pair: str, params: Optional[Dict] = None) -> Dict:
         order = super().fetch_order(order_id, pair, params)
         if (
             order.get('status') == 'canceled'
             and order.get('filled') == 0.0
             and order.get('remaining') == 0.0
         ):
             # Canceled orders will have "remaining=0" on bybit.
```

### Comparing `freqtrade-2024.3/freqtrade/exchange/check_exchange.py` & `freqtrade-2024.4/freqtrade/exchange/check_exchange.py`

 * *Files 0% similar despite different names*

```diff
@@ -52,14 +52,14 @@
         else:
             logger.warning(f'Exchange "{exchange}"  will not work with Freqtrade. Reason: {reason}')
 
     if MAP_EXCHANGE_CHILDCLASS.get(exchange, exchange) in SUPPORTED_EXCHANGES:
         logger.info(f'Exchange "{exchange}" is officially supported '
                     f'by the Freqtrade development team.')
     else:
-        logger.warning(f'Exchange "{exchange}" is known to the the ccxt library, '
+        logger.warning(f'Exchange "{exchange}" is known to the ccxt library, '
                        f'available for the bot, but not officially supported '
                        f'by the Freqtrade development team. '
                        f'It may work flawlessly (please report back) or have serious issues. '
                        f'Use it at your own discretion.')
 
     return True
```

### Comparing `freqtrade-2024.3/freqtrade/exchange/coinbasepro.py` & `freqtrade-2024.4/freqtrade/exchange/coinbasepro.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/common.py` & `freqtrade-2024.4/freqtrade/exchange/common.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/exchange.py` & `freqtrade-2024.4/freqtrade/exchange/exchange.py`

 * *Files 2% similar despite different names*

```diff
@@ -159,8561 +159,8582 @@
 000009e0: 7274 2065 7870 616e 645f 7061 6972 6c69  rt expand_pairli
 000009f0: 7374 0a66 726f 6d20 6672 6571 7472 6164  st.from freqtrad
 00000a00: 652e 7574 696c 2069 6d70 6f72 7420 6474  e.util import dt
 00000a10: 5f66 726f 6d5f 7473 2c20 6474 5f6e 6f77  _from_ts, dt_now
 00000a20: 0a66 726f 6d20 6672 6571 7472 6164 652e  .from freqtrade.
 00000a30: 7574 696c 2e64 6174 6574 696d 655f 6865  util.datetime_he
 00000a40: 6c70 6572 7320 696d 706f 7274 2064 745f  lpers import dt_
-00000a50: 6875 6d61 6e69 7a65 2c20 6474 5f74 730a  humanize, dt_ts.
-00000a60: 6672 6f6d 2066 7265 7174 7261 6465 2e75  from freqtrade.u
-00000a70: 7469 6c2e 7065 7269 6f64 6963 5f63 6163  til.periodic_cac
-00000a80: 6865 2069 6d70 6f72 7420 5065 7269 6f64  he import Period
-00000a90: 6963 4361 6368 650a 0a0a 6c6f 6767 6572  icCache...logger
-00000aa0: 203d 206c 6f67 6769 6e67 2e67 6574 4c6f   = logging.getLo
-00000ab0: 6767 6572 285f 5f6e 616d 655f 5f29 0a0a  gger(__name__)..
-00000ac0: 0a63 6c61 7373 2045 7863 6861 6e67 653a  .class Exchange:
-00000ad0: 0a0a 2020 2020 2320 5061 7261 6d65 7465  ..    # Paramete
-00000ae0: 7273 2074 6f20 6164 6420 6469 7265 6374  rs to add direct
-00000af0: 6c79 2074 6f20 6275 792f 7365 6c6c 2063  ly to buy/sell c
-00000b00: 616c 6c73 2028 6c69 6b65 2061 6772 6565  alls (like agree
-00000b10: 696e 6720 746f 2074 7261 6469 6e67 2061  ing to trading a
-00000b20: 6772 6565 6d65 6e74 290a 2020 2020 5f70  greement).    _p
-00000b30: 6172 616d 733a 2044 6963 7420 3d20 7b7d  arams: Dict = {}
-00000b40: 0a0a 2020 2020 2320 4164 6469 7469 6f6e  ..    # Addition
-00000b50: 616c 2070 6172 616d 6574 6572 7320 2d20  al parameters - 
-00000b60: 6164 6465 6420 746f 2074 6865 2063 6378  added to the ccx
-00000b70: 7420 6f62 6a65 6374 0a20 2020 205f 6363  t object.    _cc
-00000b80: 7874 5f70 6172 616d 733a 2044 6963 7420  xt_params: Dict 
-00000b90: 3d20 7b7d 0a0a 2020 2020 2320 4469 6374  = {}..    # Dict
-00000ba0: 2074 6f20 7370 6563 6966 7920 7768 6963   to specify whic
-00000bb0: 6820 6f70 7469 6f6e 7320 6561 6368 2065  h options each e
-00000bc0: 7863 6861 6e67 6520 696d 706c 656d 656e  xchange implemen
-00000bd0: 7473 0a20 2020 2023 2054 6869 7320 6465  ts.    # This de
-00000be0: 6669 6e65 7320 6465 6661 756c 7473 2c20  fines defaults, 
-00000bf0: 7768 6963 6820 6361 6e20 6265 2073 656c  which can be sel
-00000c00: 6563 7469 7665 6c79 206f 7665 7272 6964  ectively overrid
-00000c10: 6465 6e20 6279 2073 7562 636c 6173 7365  den by subclasse
-00000c20: 7320 7573 696e 6720 5f66 745f 6861 730a  s using _ft_has.
-00000c30: 2020 2020 2320 6f72 2062 7920 7370 6563      # or by spec
-00000c40: 6966 7969 6e67 2074 6865 6d20 696e 2074  ifying them in t
-00000c50: 6865 2063 6f6e 6669 6775 7261 7469 6f6e  he configuration
-00000c60: 2e0a 2020 2020 5f66 745f 6861 735f 6465  ..    _ft_has_de
-00000c70: 6661 756c 743a 2044 6963 7420 3d20 7b0a  fault: Dict = {.
-00000c80: 2020 2020 2020 2020 2273 746f 706c 6f73          "stoplos
-00000c90: 735f 6f6e 5f65 7863 6861 6e67 6522 3a20  s_on_exchange": 
-00000ca0: 4661 6c73 652c 0a20 2020 2020 2020 2022  False,.        "
-00000cb0: 7374 6f70 5f70 7269 6365 5f70 6172 616d  stop_price_param
-00000cc0: 223a 2022 7374 6f70 4c6f 7373 5072 6963  ": "stopLossPric
-00000cd0: 6522 2c20 2023 2055 7365 6420 666f 7220  e",  # Used for 
-00000ce0: 7374 6f70 6c6f 7373 5f6f 6e5f 6578 6368  stoploss_on_exch
-00000cf0: 616e 6765 2072 6571 7565 7374 0a20 2020  ange request.   
-00000d00: 2020 2020 2022 7374 6f70 5f70 7269 6365       "stop_price
-00000d10: 5f70 726f 7022 3a20 2273 746f 704c 6f73  _prop": "stopLos
-00000d20: 7350 7269 6365 222c 2020 2320 5573 6564  sPrice",  # Used
-00000d30: 2066 6f72 2073 746f 706c 6f73 735f 6f6e   for stoploss_on
-00000d40: 5f65 7863 6861 6e67 6520 7265 7370 6f6e  _exchange respon
-00000d50: 7365 2070 6172 7369 6e67 0a20 2020 2020  se parsing.     
-00000d60: 2020 2022 6f72 6465 725f 7469 6d65 5f69     "order_time_i
-00000d70: 6e5f 666f 7263 6522 3a20 5b22 4754 4322  n_force": ["GTC"
-00000d80: 5d2c 0a20 2020 2020 2020 2022 6f68 6c63  ],.        "ohlc
-00000d90: 765f 7061 7261 6d73 223a 207b 7d2c 0a20  v_params": {},. 
-00000da0: 2020 2020 2020 2022 6f68 6c63 765f 6361         "ohlcv_ca
-00000db0: 6e64 6c65 5f6c 696d 6974 223a 2035 3030  ndle_limit": 500
-00000dc0: 2c0a 2020 2020 2020 2020 226f 686c 6376  ,.        "ohlcv
-00000dd0: 5f68 6173 5f68 6973 746f 7279 223a 2054  _has_history": T
-00000de0: 7275 652c 2020 2320 536f 6d65 2065 7863  rue,  # Some exc
-00000df0: 6861 6e67 6573 2028 4b72 616b 656e 2920  hanges (Kraken) 
-00000e00: 646f 6e27 7420 7072 6f76 6964 6520 6869  don't provide hi
-00000e10: 7374 6f72 7920 7669 6120 6f68 6c63 760a  story via ohlcv.
-00000e20: 2020 2020 2020 2020 226f 686c 6376 5f70          "ohlcv_p
-00000e30: 6172 7469 616c 5f63 616e 646c 6522 3a20  artial_candle": 
-00000e40: 5472 7565 2c0a 2020 2020 2020 2020 226f  True,.        "o
-00000e50: 686c 6376 5f72 6571 7569 7265 5f73 696e  hlcv_require_sin
-00000e60: 6365 223a 2046 616c 7365 2c0a 2020 2020  ce": False,.    
-00000e70: 2020 2020 2320 4368 6563 6b20 6874 7470      # Check http
-00000e80: 733a 2f2f 6769 7468 7562 2e63 6f6d 2f63  s://github.com/c
-00000e90: 6378 742f 6363 7874 2f69 7373 7565 732f  cxt/ccxt/issues/
-00000ea0: 3130 3736 3720 666f 7220 7265 6d6f 7661  10767 for remova
-00000eb0: 6c20 6f66 206f 686c 6376 5f76 6f6c 756d  l of ohlcv_volum
-00000ec0: 655f 6375 7272 656e 6379 0a20 2020 2020  e_currency.     
-00000ed0: 2020 2022 6f68 6c63 765f 766f 6c75 6d65     "ohlcv_volume
-00000ee0: 5f63 7572 7265 6e63 7922 3a20 2262 6173  _currency": "bas
-00000ef0: 6522 2c20 2023 2022 6261 7365 2220 6f72  e",  # "base" or
-00000f00: 2022 7175 6f74 6522 0a20 2020 2020 2020   "quote".       
-00000f10: 2022 7469 636b 6572 735f 6861 7665 5f71   "tickers_have_q
-00000f20: 756f 7465 566f 6c75 6d65 223a 2054 7275  uoteVolume": Tru
-00000f30: 652c 0a20 2020 2020 2020 2022 7469 636b  e,.        "tick
-00000f40: 6572 735f 6861 7665 5f62 6964 5f61 736b  ers_have_bid_ask
-00000f50: 223a 2054 7275 652c 2020 2320 6269 6420  ": True,  # bid 
-00000f60: 2f20 6173 6b20 656d 7074 7920 666f 7220  / ask empty for 
-00000f70: 6665 7463 685f 7469 636b 6572 730a 2020  fetch_tickers.  
-00000f80: 2020 2020 2020 2274 6963 6b65 7273 5f68        "tickers_h
-00000f90: 6176 655f 7072 6963 6522 3a20 5472 7565  ave_price": True
-00000fa0: 2c0a 2020 2020 2020 2020 2274 7261 6465  ,.        "trade
-00000fb0: 735f 7061 6769 6e61 7469 6f6e 223a 2022  s_pagination": "
-00000fc0: 7469 6d65 222c 2020 2320 506f 7373 6962  time",  # Possib
-00000fd0: 6c65 2061 7265 2022 7469 6d65 2220 6f72  le are "time" or
-00000fe0: 2022 6964 220a 2020 2020 2020 2020 2274   "id".        "t
-00000ff0: 7261 6465 735f 7061 6769 6e61 7469 6f6e  rades_pagination
-00001000: 5f61 7267 223a 2022 7369 6e63 6522 2c0a  _arg": "since",.
-00001010: 2020 2020 2020 2020 226c 325f 6c69 6d69          "l2_limi
-00001020: 745f 7261 6e67 6522 3a20 4e6f 6e65 2c0a  t_range": None,.
-00001030: 2020 2020 2020 2020 226c 325f 6c69 6d69          "l2_limi
-00001040: 745f 7261 6e67 655f 7265 7175 6972 6564  t_range_required
-00001050: 223a 2054 7275 652c 2020 2320 416c 6c6f  ": True,  # Allo
-00001060: 7720 456d 7074 7920 4c32 206c 696d 6974  w Empty L2 limit
-00001070: 2028 6b75 636f 696e 290a 2020 2020 2020   (kucoin).      
-00001080: 2020 226d 6172 6b5f 6f68 6c63 765f 7072    "mark_ohlcv_pr
-00001090: 6963 6522 3a20 226d 6172 6b22 2c0a 2020  ice": "mark",.  
-000010a0: 2020 2020 2020 226d 6172 6b5f 6f68 6c63        "mark_ohlc
-000010b0: 765f 7469 6d65 6672 616d 6522 3a20 2238  v_timeframe": "8
-000010c0: 6822 2c0a 2020 2020 2020 2020 2266 756e  h",.        "fun
-000010d0: 6469 6e67 5f66 6565 5f74 696d 6566 7261  ding_fee_timefra
-000010e0: 6d65 223a 2022 3868 222c 0a20 2020 2020  me": "8h",.     
-000010f0: 2020 2022 6363 7874 5f66 7574 7572 6573     "ccxt_futures
-00001100: 5f6e 616d 6522 3a20 2273 7761 7022 2c0a  _name": "swap",.
-00001110: 2020 2020 2020 2020 226e 6565 6473 5f74          "needs_t
-00001120: 7261 6469 6e67 5f66 6565 7322 3a20 4661  rading_fees": Fa
-00001130: 6c73 652c 2020 2320 7573 6520 6665 7463  lse,  # use fetc
-00001140: 685f 7472 6164 696e 675f 6665 6573 2074  h_trading_fees t
-00001150: 6f20 6361 6368 6520 6665 6573 0a20 2020  o cache fees.   
-00001160: 2020 2020 2022 6f72 6465 725f 7072 6f70       "order_prop
-00001170: 735f 696e 5f63 6f6e 7472 6163 7473 223a  s_in_contracts":
-00001180: 205b 2761 6d6f 756e 7427 2c20 2766 696c   ['amount', 'fil
-00001190: 6c65 6427 2c20 2772 656d 6169 6e69 6e67  led', 'remaining
-000011a0: 275d 2c0a 2020 2020 2020 2020 2320 4f76  '],.        # Ov
-000011b0: 6572 7269 6465 2063 7265 6174 654d 6172  erride createMar
-000011c0: 6b65 7442 7579 4f72 6465 7252 6571 7569  ketBuyOrderRequi
-000011d0: 7265 7350 7269 6365 2077 6865 7265 2063  resPrice where c
-000011e0: 6378 7420 6861 7320 6974 2077 726f 6e67  cxt has it wrong
-000011f0: 0a20 2020 2020 2020 2022 6d61 726b 6574  .        "market
-00001200: 4f72 6465 7252 6571 7569 7265 7350 7269  OrderRequiresPri
-00001210: 6365 223a 2046 616c 7365 2c0a 2020 2020  ce": False,.    
-00001220: 2020 2020 2265 7863 6861 6e67 655f 6861      "exchange_ha
-00001230: 735f 6f76 6572 7269 6465 7322 3a20 7b7d  s_overrides": {}
-00001240: 2c20 2023 2044 6963 7469 6f6e 6172 7920  ,  # Dictionary 
-00001250: 6f76 6572 7269 6469 6e67 2063 6378 7427  overriding ccxt'
-00001260: 7320 2268 6173 222e 0a20 2020 2020 2020  s "has"..       
-00001270: 2023 2045 7870 6563 7465 6420 746f 2062   # Expected to b
-00001280: 6520 696e 2074 6865 2066 6f72 6d61 7420  e in the format 
-00001290: 7b22 6665 7463 684f 484c 4356 223a 2054  {"fetchOHLCV": T
-000012a0: 7275 657d 206f 7220 7b22 6665 7463 684f  rue} or {"fetchO
-000012b0: 484c 4356 223a 2046 616c 7365 7d0a 2020  HLCV": False}.  
-000012c0: 2020 7d0a 2020 2020 5f66 745f 6861 733a    }.    _ft_has:
-000012d0: 2044 6963 7420 3d20 7b7d 0a20 2020 205f   Dict = {}.    _
-000012e0: 6674 5f68 6173 5f66 7574 7572 6573 3a20  ft_has_futures: 
-000012f0: 4469 6374 203d 207b 7d0a 0a20 2020 205f  Dict = {}..    _
-00001300: 7375 7070 6f72 7465 645f 7472 6164 696e  supported_tradin
-00001310: 675f 6d6f 6465 5f6d 6172 6769 6e5f 7061  g_mode_margin_pa
-00001320: 6972 733a 204c 6973 745b 5475 706c 655b  irs: List[Tuple[
-00001330: 5472 6164 696e 674d 6f64 652c 204d 6172  TradingMode, Mar
-00001340: 6769 6e4d 6f64 655d 5d20 3d20 5b0a 2020  ginMode]] = [.  
-00001350: 2020 2020 2020 2320 5472 6164 696e 674d        # TradingM
-00001360: 6f64 652e 5350 4f54 2061 6c77 6179 7320  ode.SPOT always 
-00001370: 7375 7070 6f72 7465 6420 616e 6420 6e6f  supported and no
-00001380: 7420 7265 7175 6972 6564 2069 6e20 7468  t required in th
-00001390: 6973 206c 6973 740a 2020 2020 5d0a 0a20  is list.    ].. 
-000013a0: 2020 2064 6566 205f 5f69 6e69 745f 5f28     def __init__(
-000013b0: 7365 6c66 2c20 636f 6e66 6967 3a20 436f  self, config: Co
-000013c0: 6e66 6967 2c20 2a2c 2065 7863 6861 6e67  nfig, *, exchang
-000013d0: 655f 636f 6e66 6967 3a20 4f70 7469 6f6e  e_config: Option
-000013e0: 616c 5b45 7863 6861 6e67 6543 6f6e 6669  al[ExchangeConfi
-000013f0: 675d 203d 204e 6f6e 652c 0a20 2020 2020  g] = None,.     
-00001400: 2020 2020 2020 2020 2020 2020 7661 6c69              vali
-00001410: 6461 7465 3a20 626f 6f6c 203d 2054 7275  date: bool = Tru
-00001420: 652c 206c 6f61 645f 6c65 7665 7261 6765  e, load_leverage
-00001430: 5f74 6965 7273 3a20 626f 6f6c 203d 2046  _tiers: bool = F
-00001440: 616c 7365 2920 2d3e 204e 6f6e 653a 0a20  alse) -> None:. 
-00001450: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001460: 2020 2049 6e69 7469 616c 697a 6573 2074     Initializes t
-00001470: 6869 7320 6d6f 6475 6c65 2077 6974 6820  his module with 
-00001480: 7468 6520 6769 7665 6e20 636f 6e66 6967  the given config
-00001490: 2c0a 2020 2020 2020 2020 6974 2064 6f65  ,.        it doe
-000014a0: 7320 6261 7369 6320 7661 6c69 6461 7469  s basic validati
-000014b0: 6f6e 2077 6865 7468 6572 2074 6865 2073  on whether the s
-000014c0: 7065 6369 6669 6564 2065 7863 6861 6e67  pecified exchang
-000014d0: 6520 616e 6420 7061 6972 7320 6172 6520  e and pairs are 
-000014e0: 7661 6c69 642e 0a20 2020 2020 2020 203a  valid..        :
-000014f0: 7265 7475 726e 3a20 4e6f 6e65 0a20 2020  return: None.   
-00001500: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00001510: 2073 656c 662e 5f61 7069 3a20 6363 7874   self._api: ccxt
-00001520: 2e45 7863 6861 6e67 650a 2020 2020 2020  .Exchange.      
-00001530: 2020 7365 6c66 2e5f 6170 695f 6173 796e    self._api_asyn
-00001540: 633a 2063 6378 745f 6173 796e 632e 4578  c: ccxt_async.Ex
-00001550: 6368 616e 6765 203d 204e 6f6e 650a 2020  change = None.  
-00001560: 2020 2020 2020 7365 6c66 2e5f 6d61 726b        self._mark
-00001570: 6574 733a 2044 6963 7420 3d20 7b7d 0a20  ets: Dict = {}. 
-00001580: 2020 2020 2020 2073 656c 662e 5f74 7261         self._tra
-00001590: 6469 6e67 5f66 6565 733a 2044 6963 745b  ding_fees: Dict[
-000015a0: 7374 722c 2041 6e79 5d20 3d20 7b7d 0a20  str, Any] = {}. 
-000015b0: 2020 2020 2020 2073 656c 662e 5f6c 6576         self._lev
-000015c0: 6572 6167 655f 7469 6572 733a 2044 6963  erage_tiers: Dic
-000015d0: 745b 7374 722c 204c 6973 745b 4469 6374  t[str, List[Dict
-000015e0: 5d5d 203d 207b 7d0a 2020 2020 2020 2020  ]] = {}.        
-000015f0: 2320 4c6f 636b 2065 7665 6e74 206c 6f6f  # Lock event loo
-00001600: 702e 2054 6869 7320 6973 206e 6563 6573  p. This is neces
-00001610: 7361 7279 2074 6f20 6176 6f69 6420 7261  sary to avoid ra
-00001620: 6365 2d63 6f6e 6469 7469 6f6e 7320 7768  ce-conditions wh
-00001630: 656e 2075 7369 6e67 2066 6f72 6365 2a20  en using force* 
-00001640: 636f 6d6d 616e 6473 0a20 2020 2020 2020  commands.       
-00001650: 2023 2044 7565 2074 6f20 6675 6e64 696e   # Due to fundin
-00001660: 6720 6665 6520 6665 7463 6869 6e67 2e0a  g fee fetching..
-00001670: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-00001680: 6f70 5f6c 6f63 6b20 3d20 4c6f 636b 2829  op_lock = Lock()
-00001690: 0a20 2020 2020 2020 2073 656c 662e 6c6f  .        self.lo
-000016a0: 6f70 203d 2073 656c 662e 5f69 6e69 745f  op = self._init_
-000016b0: 6173 796e 635f 6c6f 6f70 2829 0a20 2020  async_loop().   
-000016c0: 2020 2020 2073 656c 662e 5f63 6f6e 6669       self._confi
-000016d0: 673a 2043 6f6e 6669 6720 3d20 7b7d 0a0a  g: Config = {}..
-000016e0: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
-000016f0: 6e66 6967 2e75 7064 6174 6528 636f 6e66  nfig.update(conf
-00001700: 6967 290a 0a20 2020 2020 2020 2023 2048  ig)..        # H
-00001710: 6f6c 6473 206c 6173 7420 6361 6e64 6c65  olds last candle
-00001720: 2072 6566 7265 7368 6564 2074 696d 6520   refreshed time 
-00001730: 6f66 2065 6163 6820 7061 6972 0a20 2020  of each pair.   
-00001740: 2020 2020 2073 656c 662e 5f70 6169 7273       self._pairs
-00001750: 5f6c 6173 745f 7265 6672 6573 685f 7469  _last_refresh_ti
-00001760: 6d65 3a20 4469 6374 5b50 6169 7257 6974  me: Dict[PairWit
-00001770: 6854 696d 6566 7261 6d65 2c20 696e 745d  hTimeframe, int]
-00001780: 203d 207b 7d0a 2020 2020 2020 2020 2320   = {}.        # 
-00001790: 5469 6d65 7374 616d 7020 6f66 206c 6173  Timestamp of las
-000017a0: 7420 6d61 726b 6574 7320 7265 6672 6573  t markets refres
-000017b0: 680a 2020 2020 2020 2020 7365 6c66 2e5f  h.        self._
-000017c0: 6c61 7374 5f6d 6172 6b65 7473 5f72 6566  last_markets_ref
-000017d0: 7265 7368 3a20 696e 7420 3d20 300a 0a20  resh: int = 0.. 
-000017e0: 2020 2020 2020 2023 2043 6163 6865 2066         # Cache f
-000017f0: 6f72 2031 3020 6d69 6e75 7465 7320 2e2e  or 10 minutes ..
-00001800: 2e0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-00001810: 6361 6368 655f 6c6f 636b 203d 204c 6f63  cache_lock = Loc
-00001820: 6b28 290a 2020 2020 2020 2020 7365 6c66  k().        self
-00001830: 2e5f 6665 7463 685f 7469 636b 6572 735f  ._fetch_tickers_
-00001840: 6361 6368 653a 2054 544c 4361 6368 6520  cache: TTLCache 
-00001850: 3d20 5454 4c43 6163 6865 286d 6178 7369  = TTLCache(maxsi
-00001860: 7a65 3d32 2c20 7474 6c3d 3630 202a 2031  ze=2, ttl=60 * 1
-00001870: 3029 0a20 2020 2020 2020 2023 2043 6163  0).        # Cac
-00001880: 6865 2076 616c 7565 7320 666f 7220 3330  he values for 30
-00001890: 3020 746f 2061 766f 6964 2066 7265 7175  0 to avoid frequ
-000018a0: 656e 7420 706f 6c6c 696e 6720 6f66 2074  ent polling of t
-000018b0: 6865 2065 7863 6861 6e67 6520 666f 7220  he exchange for 
-000018c0: 7072 6963 6573 0a20 2020 2020 2020 2023  prices.        #
-000018d0: 2043 6163 6869 6e67 206f 6e6c 7920 6170   Caching only ap
-000018e0: 706c 6965 7320 746f 2052 5043 206d 6574  plies to RPC met
-000018f0: 686f 6473 2c20 736f 2070 7269 6365 7320  hods, so prices 
-00001900: 666f 7220 6f70 656e 2074 7261 6465 7320  for open trades 
-00001910: 6172 6520 7374 696c 6c0a 2020 2020 2020  are still.      
-00001920: 2020 2320 7265 6672 6573 6865 6420 6f6e    # refreshed on
-00001930: 6365 2065 7665 7279 2069 7465 7261 7469  ce every iterati
-00001940: 6f6e 2e0a 2020 2020 2020 2020 2320 5368  on..        # Sh
-00001950: 6f75 6c64 6e27 7420 6265 2074 6f6f 2068  ouldn't be too h
-00001960: 6967 6820 6569 7468 6572 2c20 6173 2069  igh either, as i
-00001970: 7427 6c6c 2066 7265 657a 6520 5549 2075  t'll freeze UI u
-00001980: 7064 6174 6573 2069 6e20 6361 7365 206f  pdates in case o
-00001990: 6620 6f70 656e 206f 7264 6572 732e 0a20  f open orders.. 
-000019a0: 2020 2020 2020 2073 656c 662e 5f65 7869         self._exi
-000019b0: 745f 7261 7465 5f63 6163 6865 3a20 5454  t_rate_cache: TT
-000019c0: 4c43 6163 6865 203d 2054 544c 4361 6368  LCache = TTLCach
-000019d0: 6528 6d61 7873 697a 653d 3130 302c 2074  e(maxsize=100, t
-000019e0: 746c 3d33 3030 290a 2020 2020 2020 2020  tl=300).        
-000019f0: 7365 6c66 2e5f 656e 7472 795f 7261 7465  self._entry_rate
-00001a00: 5f63 6163 6865 3a20 5454 4c43 6163 6865  _cache: TTLCache
-00001a10: 203d 2054 544c 4361 6368 6528 6d61 7873   = TTLCache(maxs
-00001a20: 697a 653d 3130 302c 2074 746c 3d33 3030  ize=100, ttl=300
-00001a30: 290a 0a20 2020 2020 2020 2023 2048 6f6c  )..        # Hol
-00001a40: 6473 2063 616e 646c 6573 0a20 2020 2020  ds candles.     
-00001a50: 2020 2073 656c 662e 5f6b 6c69 6e65 733a     self._klines:
-00001a60: 2044 6963 745b 5061 6972 5769 7468 5469   Dict[PairWithTi
-00001a70: 6d65 6672 616d 652c 2044 6174 6146 7261  meframe, DataFra
-00001a80: 6d65 5d20 3d20 7b7d 0a20 2020 2020 2020  me] = {}.       
-00001a90: 2073 656c 662e 5f65 7870 6972 696e 675f   self._expiring_
-00001aa0: 6361 6e64 6c65 5f63 6163 6865 3a20 4469  candle_cache: Di
-00001ab0: 6374 5b54 7570 6c65 5b73 7472 2c20 696e  ct[Tuple[str, in
-00001ac0: 745d 2c20 5065 7269 6f64 6963 4361 6368  t], PeriodicCach
-00001ad0: 655d 203d 207b 7d0a 0a20 2020 2020 2020  e] = {}..       
-00001ae0: 2023 2048 6f6c 6473 2061 6c6c 206f 7065   # Holds all ope
-00001af0: 6e20 7365 6c6c 206f 7264 6572 7320 666f  n sell orders fo
-00001b00: 7220 6472 795f 7275 6e0a 2020 2020 2020  r dry_run.      
-00001b10: 2020 7365 6c66 2e5f 6472 795f 7275 6e5f    self._dry_run_
-00001b20: 6f70 656e 5f6f 7264 6572 733a 2044 6963  open_orders: Dic
-00001b30: 745b 7374 722c 2041 6e79 5d20 3d20 7b7d  t[str, Any] = {}
-00001b40: 0a0a 2020 2020 2020 2020 6966 2063 6f6e  ..        if con
-00001b50: 6669 675b 2764 7279 5f72 756e 275d 3a0a  fig['dry_run']:.
-00001b60: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-00001b70: 6572 2e69 6e66 6f28 2749 6e73 7461 6e63  er.info('Instanc
-00001b80: 6520 6973 2072 756e 6e69 6e67 2077 6974  e is running wit
-00001b90: 6820 6472 795f 7275 6e20 656e 6162 6c65  h dry_run enable
-00001ba0: 6427 290a 2020 2020 2020 2020 6c6f 6767  d').        logg
-00001bb0: 6572 2e69 6e66 6f28 6622 5573 696e 6720  er.info(f"Using 
-00001bc0: 4343 5854 207b 6363 7874 2e5f 5f76 6572  CCXT {ccxt.__ver
-00001bd0: 7369 6f6e 5f5f 7d22 290a 2020 2020 2020  sion__}").      
-00001be0: 2020 6578 6368 616e 6765 5f63 6f6e 663a    exchange_conf:
-00001bf0: 2044 6963 745b 7374 722c 2041 6e79 5d20   Dict[str, Any] 
-00001c00: 3d20 6578 6368 616e 6765 5f63 6f6e 6669  = exchange_confi
-00001c10: 6720 6966 2065 7863 6861 6e67 655f 636f  g if exchange_co
-00001c20: 6e66 6967 2065 6c73 6520 636f 6e66 6967  nfig else config
-00001c30: 5b27 6578 6368 616e 6765 275d 0a20 2020  ['exchange'].   
-00001c40: 2020 2020 2072 656d 6f76 655f 6578 6368       remove_exch
-00001c50: 616e 6765 5f63 7265 6465 6e74 6961 6c73  ange_credentials
-00001c60: 2865 7863 6861 6e67 655f 636f 6e66 2c20  (exchange_conf, 
-00001c70: 636f 6e66 6967 2e67 6574 2827 6472 795f  config.get('dry_
-00001c80: 7275 6e27 2c20 4661 6c73 6529 290a 2020  run', False)).  
-00001c90: 2020 2020 2020 7365 6c66 2e6c 6f67 5f72        self.log_r
-00001ca0: 6573 706f 6e73 6573 203d 2065 7863 6861  esponses = excha
-00001cb0: 6e67 655f 636f 6e66 2e67 6574 2827 6c6f  nge_conf.get('lo
-00001cc0: 675f 7265 7370 6f6e 7365 7327 2c20 4661  g_responses', Fa
-00001cd0: 6c73 6529 0a0a 2020 2020 2020 2020 2320  lse)..        # 
-00001ce0: 4c65 7665 7261 6765 2070 726f 7065 7274  Leverage propert
-00001cf0: 6965 730a 2020 2020 2020 2020 7365 6c66  ies.        self
-00001d00: 2e74 7261 6469 6e67 5f6d 6f64 653a 2054  .trading_mode: T
-00001d10: 7261 6469 6e67 4d6f 6465 203d 2063 6f6e  radingMode = con
-00001d20: 6669 672e 6765 7428 2774 7261 6469 6e67  fig.get('trading
-00001d30: 5f6d 6f64 6527 2c20 5472 6164 696e 674d  _mode', TradingM
-00001d40: 6f64 652e 5350 4f54 290a 2020 2020 2020  ode.SPOT).      
-00001d50: 2020 7365 6c66 2e6d 6172 6769 6e5f 6d6f    self.margin_mo
-00001d60: 6465 3a20 4d61 7267 696e 4d6f 6465 203d  de: MarginMode =
-00001d70: 2028 0a20 2020 2020 2020 2020 2020 204d   (.            M
-00001d80: 6172 6769 6e4d 6f64 6528 636f 6e66 6967  arginMode(config
-00001d90: 2e67 6574 2827 6d61 7267 696e 5f6d 6f64  .get('margin_mod
-00001da0: 6527 2929 0a20 2020 2020 2020 2020 2020  e')).           
-00001db0: 2069 6620 636f 6e66 6967 2e67 6574 2827   if config.get('
-00001dc0: 6d61 7267 696e 5f6d 6f64 6527 290a 2020  margin_mode').  
-00001dd0: 2020 2020 2020 2020 2020 656c 7365 204d            else M
-00001de0: 6172 6769 6e4d 6f64 652e 4e4f 4e45 0a20  arginMode.NONE. 
-00001df0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00001e00: 2073 656c 662e 6c69 7175 6964 6174 696f   self.liquidatio
-00001e10: 6e5f 6275 6666 6572 203d 2063 6f6e 6669  n_buffer = confi
-00001e20: 672e 6765 7428 276c 6971 7569 6461 7469  g.get('liquidati
-00001e30: 6f6e 5f62 7566 6665 7227 2c20 302e 3035  on_buffer', 0.05
-00001e40: 290a 0a20 2020 2020 2020 2023 2044 6565  )..        # Dee
-00001e50: 7020 6d65 7267 6520 6674 5f68 6173 2077  p merge ft_has w
-00001e60: 6974 6820 6465 6661 756c 7420 6674 5f68  ith default ft_h
-00001e70: 6173 206f 7074 696f 6e73 0a20 2020 2020  as options.     
-00001e80: 2020 2073 656c 662e 5f66 745f 6861 7320     self._ft_has 
-00001e90: 3d20 6465 6570 5f6d 6572 6765 5f64 6963  = deep_merge_dic
-00001ea0: 7473 2873 656c 662e 5f66 745f 6861 732c  ts(self._ft_has,
-00001eb0: 2064 6565 7063 6f70 7928 7365 6c66 2e5f   deepcopy(self._
-00001ec0: 6674 5f68 6173 5f64 6566 6175 6c74 2929  ft_has_default))
-00001ed0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00001ee0: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
-00001ef0: 2054 7261 6469 6e67 4d6f 6465 2e46 5554   TradingMode.FUT
-00001f00: 5552 4553 3a0a 2020 2020 2020 2020 2020  URES:.          
-00001f10: 2020 7365 6c66 2e5f 6674 5f68 6173 203d    self._ft_has =
-00001f20: 2064 6565 705f 6d65 7267 655f 6469 6374   deep_merge_dict
-00001f30: 7328 7365 6c66 2e5f 6674 5f68 6173 5f66  s(self._ft_has_f
-00001f40: 7574 7572 6573 2c20 7365 6c66 2e5f 6674  utures, self._ft
-00001f50: 5f68 6173 290a 2020 2020 2020 2020 6966  _has).        if
-00001f60: 2065 7863 6861 6e67 655f 636f 6e66 2e67   exchange_conf.g
-00001f70: 6574 2827 5f66 745f 6861 735f 7061 7261  et('_ft_has_para
-00001f80: 6d73 2729 3a0a 2020 2020 2020 2020 2020  ms'):.          
-00001f90: 2020 7365 6c66 2e5f 6674 5f68 6173 203d    self._ft_has =
-00001fa0: 2064 6565 705f 6d65 7267 655f 6469 6374   deep_merge_dict
-00001fb0: 7328 6578 6368 616e 6765 5f63 6f6e 662e  s(exchange_conf.
-00001fc0: 6765 7428 275f 6674 5f68 6173 5f70 6172  get('_ft_has_par
-00001fd0: 616d 7327 292c 0a20 2020 2020 2020 2020  ams'),.         
+00000a50: 6875 6d61 6e69 7a65 5f64 656c 7461 2c20  humanize_delta, 
+00000a60: 6474 5f74 730a 6672 6f6d 2066 7265 7174  dt_ts.from freqt
+00000a70: 7261 6465 2e75 7469 6c2e 7065 7269 6f64  rade.util.period
+00000a80: 6963 5f63 6163 6865 2069 6d70 6f72 7420  ic_cache import 
+00000a90: 5065 7269 6f64 6963 4361 6368 650a 0a0a  PeriodicCache...
+00000aa0: 6c6f 6767 6572 203d 206c 6f67 6769 6e67  logger = logging
+00000ab0: 2e67 6574 4c6f 6767 6572 285f 5f6e 616d  .getLogger(__nam
+00000ac0: 655f 5f29 0a0a 0a63 6c61 7373 2045 7863  e__)...class Exc
+00000ad0: 6861 6e67 653a 0a0a 2020 2020 2320 5061  hange:..    # Pa
+00000ae0: 7261 6d65 7465 7273 2074 6f20 6164 6420  rameters to add 
+00000af0: 6469 7265 6374 6c79 2074 6f20 6275 792f  directly to buy/
+00000b00: 7365 6c6c 2063 616c 6c73 2028 6c69 6b65  sell calls (like
+00000b10: 2061 6772 6565 696e 6720 746f 2074 7261   agreeing to tra
+00000b20: 6469 6e67 2061 6772 6565 6d65 6e74 290a  ding agreement).
+00000b30: 2020 2020 5f70 6172 616d 733a 2044 6963      _params: Dic
+00000b40: 7420 3d20 7b7d 0a0a 2020 2020 2320 4164  t = {}..    # Ad
+00000b50: 6469 7469 6f6e 616c 2070 6172 616d 6574  ditional paramet
+00000b60: 6572 7320 2d20 6164 6465 6420 746f 2074  ers - added to t
+00000b70: 6865 2063 6378 7420 6f62 6a65 6374 0a20  he ccxt object. 
+00000b80: 2020 205f 6363 7874 5f70 6172 616d 733a     _ccxt_params:
+00000b90: 2044 6963 7420 3d20 7b7d 0a0a 2020 2020   Dict = {}..    
+00000ba0: 2320 4469 6374 2074 6f20 7370 6563 6966  # Dict to specif
+00000bb0: 7920 7768 6963 6820 6f70 7469 6f6e 7320  y which options 
+00000bc0: 6561 6368 2065 7863 6861 6e67 6520 696d  each exchange im
+00000bd0: 706c 656d 656e 7473 0a20 2020 2023 2054  plements.    # T
+00000be0: 6869 7320 6465 6669 6e65 7320 6465 6661  his defines defa
+00000bf0: 756c 7473 2c20 7768 6963 6820 6361 6e20  ults, which can 
+00000c00: 6265 2073 656c 6563 7469 7665 6c79 206f  be selectively o
+00000c10: 7665 7272 6964 6465 6e20 6279 2073 7562  verridden by sub
+00000c20: 636c 6173 7365 7320 7573 696e 6720 5f66  classes using _f
+00000c30: 745f 6861 730a 2020 2020 2320 6f72 2062  t_has.    # or b
+00000c40: 7920 7370 6563 6966 7969 6e67 2074 6865  y specifying the
+00000c50: 6d20 696e 2074 6865 2063 6f6e 6669 6775  m in the configu
+00000c60: 7261 7469 6f6e 2e0a 2020 2020 5f66 745f  ration..    _ft_
+00000c70: 6861 735f 6465 6661 756c 743a 2044 6963  has_default: Dic
+00000c80: 7420 3d20 7b0a 2020 2020 2020 2020 2273  t = {.        "s
+00000c90: 746f 706c 6f73 735f 6f6e 5f65 7863 6861  toploss_on_excha
+00000ca0: 6e67 6522 3a20 4661 6c73 652c 0a20 2020  nge": False,.   
+00000cb0: 2020 2020 2022 7374 6f70 5f70 7269 6365       "stop_price
+00000cc0: 5f70 6172 616d 223a 2022 7374 6f70 4c6f  _param": "stopLo
+00000cd0: 7373 5072 6963 6522 2c20 2023 2055 7365  ssPrice",  # Use
+00000ce0: 6420 666f 7220 7374 6f70 6c6f 7373 5f6f  d for stoploss_o
+00000cf0: 6e5f 6578 6368 616e 6765 2072 6571 7565  n_exchange reque
+00000d00: 7374 0a20 2020 2020 2020 2022 7374 6f70  st.        "stop
+00000d10: 5f70 7269 6365 5f70 726f 7022 3a20 2273  _price_prop": "s
+00000d20: 746f 704c 6f73 7350 7269 6365 222c 2020  topLossPrice",  
+00000d30: 2320 5573 6564 2066 6f72 2073 746f 706c  # Used for stopl
+00000d40: 6f73 735f 6f6e 5f65 7863 6861 6e67 6520  oss_on_exchange 
+00000d50: 7265 7370 6f6e 7365 2070 6172 7369 6e67  response parsing
+00000d60: 0a20 2020 2020 2020 2022 6f72 6465 725f  .        "order_
+00000d70: 7469 6d65 5f69 6e5f 666f 7263 6522 3a20  time_in_force": 
+00000d80: 5b22 4754 4322 5d2c 0a20 2020 2020 2020  ["GTC"],.       
+00000d90: 2022 6f68 6c63 765f 7061 7261 6d73 223a   "ohlcv_params":
+00000da0: 207b 7d2c 0a20 2020 2020 2020 2022 6f68   {},.        "oh
+00000db0: 6c63 765f 6361 6e64 6c65 5f6c 696d 6974  lcv_candle_limit
+00000dc0: 223a 2035 3030 2c0a 2020 2020 2020 2020  ": 500,.        
+00000dd0: 226f 686c 6376 5f68 6173 5f68 6973 746f  "ohlcv_has_histo
+00000de0: 7279 223a 2054 7275 652c 2020 2320 536f  ry": True,  # So
+00000df0: 6d65 2065 7863 6861 6e67 6573 2028 4b72  me exchanges (Kr
+00000e00: 616b 656e 2920 646f 6e27 7420 7072 6f76  aken) don't prov
+00000e10: 6964 6520 6869 7374 6f72 7920 7669 6120  ide history via 
+00000e20: 6f68 6c63 760a 2020 2020 2020 2020 226f  ohlcv.        "o
+00000e30: 686c 6376 5f70 6172 7469 616c 5f63 616e  hlcv_partial_can
+00000e40: 646c 6522 3a20 5472 7565 2c0a 2020 2020  dle": True,.    
+00000e50: 2020 2020 226f 686c 6376 5f72 6571 7569      "ohlcv_requi
+00000e60: 7265 5f73 696e 6365 223a 2046 616c 7365  re_since": False
+00000e70: 2c0a 2020 2020 2020 2020 2320 4368 6563  ,.        # Chec
+00000e80: 6b20 6874 7470 733a 2f2f 6769 7468 7562  k https://github
+00000e90: 2e63 6f6d 2f63 6378 742f 6363 7874 2f69  .com/ccxt/ccxt/i
+00000ea0: 7373 7565 732f 3130 3736 3720 666f 7220  ssues/10767 for 
+00000eb0: 7265 6d6f 7661 6c20 6f66 206f 686c 6376  removal of ohlcv
+00000ec0: 5f76 6f6c 756d 655f 6375 7272 656e 6379  _volume_currency
+00000ed0: 0a20 2020 2020 2020 2022 6f68 6c63 765f  .        "ohlcv_
+00000ee0: 766f 6c75 6d65 5f63 7572 7265 6e63 7922  volume_currency"
+00000ef0: 3a20 2262 6173 6522 2c20 2023 2022 6261  : "base",  # "ba
+00000f00: 7365 2220 6f72 2022 7175 6f74 6522 0a20  se" or "quote". 
+00000f10: 2020 2020 2020 2022 7469 636b 6572 735f         "tickers_
+00000f20: 6861 7665 5f71 756f 7465 566f 6c75 6d65  have_quoteVolume
+00000f30: 223a 2054 7275 652c 0a20 2020 2020 2020  ": True,.       
+00000f40: 2022 7469 636b 6572 735f 6861 7665 5f62   "tickers_have_b
+00000f50: 6964 5f61 736b 223a 2054 7275 652c 2020  id_ask": True,  
+00000f60: 2320 6269 6420 2f20 6173 6b20 656d 7074  # bid / ask empt
+00000f70: 7920 666f 7220 6665 7463 685f 7469 636b  y for fetch_tick
+00000f80: 6572 730a 2020 2020 2020 2020 2274 6963  ers.        "tic
+00000f90: 6b65 7273 5f68 6176 655f 7072 6963 6522  kers_have_price"
+00000fa0: 3a20 5472 7565 2c0a 2020 2020 2020 2020  : True,.        
+00000fb0: 2274 7261 6465 735f 7061 6769 6e61 7469  "trades_paginati
+00000fc0: 6f6e 223a 2022 7469 6d65 222c 2020 2320  on": "time",  # 
+00000fd0: 506f 7373 6962 6c65 2061 7265 2022 7469  Possible are "ti
+00000fe0: 6d65 2220 6f72 2022 6964 220a 2020 2020  me" or "id".    
+00000ff0: 2020 2020 2274 7261 6465 735f 7061 6769      "trades_pagi
+00001000: 6e61 7469 6f6e 5f61 7267 223a 2022 7369  nation_arg": "si
+00001010: 6e63 6522 2c0a 2020 2020 2020 2020 226c  nce",.        "l
+00001020: 325f 6c69 6d69 745f 7261 6e67 6522 3a20  2_limit_range": 
+00001030: 4e6f 6e65 2c0a 2020 2020 2020 2020 226c  None,.        "l
+00001040: 325f 6c69 6d69 745f 7261 6e67 655f 7265  2_limit_range_re
+00001050: 7175 6972 6564 223a 2054 7275 652c 2020  quired": True,  
+00001060: 2320 416c 6c6f 7720 456d 7074 7920 4c32  # Allow Empty L2
+00001070: 206c 696d 6974 2028 6b75 636f 696e 290a   limit (kucoin).
+00001080: 2020 2020 2020 2020 226d 6172 6b5f 6f68          "mark_oh
+00001090: 6c63 765f 7072 6963 6522 3a20 226d 6172  lcv_price": "mar
+000010a0: 6b22 2c0a 2020 2020 2020 2020 226d 6172  k",.        "mar
+000010b0: 6b5f 6f68 6c63 765f 7469 6d65 6672 616d  k_ohlcv_timefram
+000010c0: 6522 3a20 2238 6822 2c0a 2020 2020 2020  e": "8h",.      
+000010d0: 2020 2266 756e 6469 6e67 5f66 6565 5f74    "funding_fee_t
+000010e0: 696d 6566 7261 6d65 223a 2022 3868 222c  imeframe": "8h",
+000010f0: 0a20 2020 2020 2020 2022 6363 7874 5f66  .        "ccxt_f
+00001100: 7574 7572 6573 5f6e 616d 6522 3a20 2273  utures_name": "s
+00001110: 7761 7022 2c0a 2020 2020 2020 2020 226e  wap",.        "n
+00001120: 6565 6473 5f74 7261 6469 6e67 5f66 6565  eeds_trading_fee
+00001130: 7322 3a20 4661 6c73 652c 2020 2320 7573  s": False,  # us
+00001140: 6520 6665 7463 685f 7472 6164 696e 675f  e fetch_trading_
+00001150: 6665 6573 2074 6f20 6361 6368 6520 6665  fees to cache fe
+00001160: 6573 0a20 2020 2020 2020 2022 6f72 6465  es.        "orde
+00001170: 725f 7072 6f70 735f 696e 5f63 6f6e 7472  r_props_in_contr
+00001180: 6163 7473 223a 205b 2761 6d6f 756e 7427  acts": ['amount'
+00001190: 2c20 2766 696c 6c65 6427 2c20 2772 656d  , 'filled', 'rem
+000011a0: 6169 6e69 6e67 275d 2c0a 2020 2020 2020  aining'],.      
+000011b0: 2020 2320 4f76 6572 7269 6465 2063 7265    # Override cre
+000011c0: 6174 654d 6172 6b65 7442 7579 4f72 6465  ateMarketBuyOrde
+000011d0: 7252 6571 7569 7265 7350 7269 6365 2077  rRequiresPrice w
+000011e0: 6865 7265 2063 6378 7420 6861 7320 6974  here ccxt has it
+000011f0: 2077 726f 6e67 0a20 2020 2020 2020 2022   wrong.        "
+00001200: 6d61 726b 6574 4f72 6465 7252 6571 7569  marketOrderRequi
+00001210: 7265 7350 7269 6365 223a 2046 616c 7365  resPrice": False
+00001220: 2c0a 2020 2020 2020 2020 2265 7863 6861  ,.        "excha
+00001230: 6e67 655f 6861 735f 6f76 6572 7269 6465  nge_has_override
+00001240: 7322 3a20 7b7d 2c20 2023 2044 6963 7469  s": {},  # Dicti
+00001250: 6f6e 6172 7920 6f76 6572 7269 6469 6e67  onary overriding
+00001260: 2063 6378 7427 7320 2268 6173 222e 0a20   ccxt's "has".. 
+00001270: 2020 2020 2020 2023 2045 7870 6563 7465         # Expecte
+00001280: 6420 746f 2062 6520 696e 2074 6865 2066  d to be in the f
+00001290: 6f72 6d61 7420 7b22 6665 7463 684f 484c  ormat {"fetchOHL
+000012a0: 4356 223a 2054 7275 657d 206f 7220 7b22  CV": True} or {"
+000012b0: 6665 7463 684f 484c 4356 223a 2046 616c  fetchOHLCV": Fal
+000012c0: 7365 7d0a 2020 2020 7d0a 2020 2020 5f66  se}.    }.    _f
+000012d0: 745f 6861 733a 2044 6963 7420 3d20 7b7d  t_has: Dict = {}
+000012e0: 0a20 2020 205f 6674 5f68 6173 5f66 7574  .    _ft_has_fut
+000012f0: 7572 6573 3a20 4469 6374 203d 207b 7d0a  ures: Dict = {}.
+00001300: 0a20 2020 205f 7375 7070 6f72 7465 645f  .    _supported_
+00001310: 7472 6164 696e 675f 6d6f 6465 5f6d 6172  trading_mode_mar
+00001320: 6769 6e5f 7061 6972 733a 204c 6973 745b  gin_pairs: List[
+00001330: 5475 706c 655b 5472 6164 696e 674d 6f64  Tuple[TradingMod
+00001340: 652c 204d 6172 6769 6e4d 6f64 655d 5d20  e, MarginMode]] 
+00001350: 3d20 5b0a 2020 2020 2020 2020 2320 5472  = [.        # Tr
+00001360: 6164 696e 674d 6f64 652e 5350 4f54 2061  adingMode.SPOT a
+00001370: 6c77 6179 7320 7375 7070 6f72 7465 6420  lways supported 
+00001380: 616e 6420 6e6f 7420 7265 7175 6972 6564  and not required
+00001390: 2069 6e20 7468 6973 206c 6973 740a 2020   in this list.  
+000013a0: 2020 5d0a 0a20 2020 2064 6566 205f 5f69    ]..    def __i
+000013b0: 6e69 745f 5f28 7365 6c66 2c20 636f 6e66  nit__(self, conf
+000013c0: 6967 3a20 436f 6e66 6967 2c20 2a2c 2065  ig: Config, *, e
+000013d0: 7863 6861 6e67 655f 636f 6e66 6967 3a20  xchange_config: 
+000013e0: 4f70 7469 6f6e 616c 5b45 7863 6861 6e67  Optional[Exchang
+000013f0: 6543 6f6e 6669 675d 203d 204e 6f6e 652c  eConfig] = None,
+00001400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00001410: 2020 7661 6c69 6461 7465 3a20 626f 6f6c    validate: bool
+00001420: 203d 2054 7275 652c 206c 6f61 645f 6c65   = True, load_le
+00001430: 7665 7261 6765 5f74 6965 7273 3a20 626f  verage_tiers: bo
+00001440: 6f6c 203d 2046 616c 7365 2920 2d3e 204e  ol = False) -> N
+00001450: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+00001460: 0a20 2020 2020 2020 2049 6e69 7469 616c  .        Initial
+00001470: 697a 6573 2074 6869 7320 6d6f 6475 6c65  izes this module
+00001480: 2077 6974 6820 7468 6520 6769 7665 6e20   with the given 
+00001490: 636f 6e66 6967 2c0a 2020 2020 2020 2020  config,.        
+000014a0: 6974 2064 6f65 7320 6261 7369 6320 7661  it does basic va
+000014b0: 6c69 6461 7469 6f6e 2077 6865 7468 6572  lidation whether
+000014c0: 2074 6865 2073 7065 6369 6669 6564 2065   the specified e
+000014d0: 7863 6861 6e67 6520 616e 6420 7061 6972  xchange and pair
+000014e0: 7320 6172 6520 7661 6c69 642e 0a20 2020  s are valid..   
+000014f0: 2020 2020 203a 7265 7475 726e 3a20 4e6f       :return: No
+00001500: 6e65 0a20 2020 2020 2020 2022 2222 0a20  ne.        """. 
+00001510: 2020 2020 2020 2073 656c 662e 5f61 7069         self._api
+00001520: 3a20 6363 7874 2e45 7863 6861 6e67 650a  : ccxt.Exchange.
+00001530: 2020 2020 2020 2020 7365 6c66 2e5f 6170          self._ap
+00001540: 695f 6173 796e 633a 2063 6378 745f 6173  i_async: ccxt_as
+00001550: 796e 632e 4578 6368 616e 6765 203d 204e  ync.Exchange = N
+00001560: 6f6e 650a 2020 2020 2020 2020 7365 6c66  one.        self
+00001570: 2e5f 6d61 726b 6574 733a 2044 6963 7420  ._markets: Dict 
+00001580: 3d20 7b7d 0a20 2020 2020 2020 2073 656c  = {}.        sel
+00001590: 662e 5f74 7261 6469 6e67 5f66 6565 733a  f._trading_fees:
+000015a0: 2044 6963 745b 7374 722c 2041 6e79 5d20   Dict[str, Any] 
+000015b0: 3d20 7b7d 0a20 2020 2020 2020 2073 656c  = {}.        sel
+000015c0: 662e 5f6c 6576 6572 6167 655f 7469 6572  f._leverage_tier
+000015d0: 733a 2044 6963 745b 7374 722c 204c 6973  s: Dict[str, Lis
+000015e0: 745b 4469 6374 5d5d 203d 207b 7d0a 2020  t[Dict]] = {}.  
+000015f0: 2020 2020 2020 2320 4c6f 636b 2065 7665        # Lock eve
+00001600: 6e74 206c 6f6f 702e 2054 6869 7320 6973  nt loop. This is
+00001610: 206e 6563 6573 7361 7279 2074 6f20 6176   necessary to av
+00001620: 6f69 6420 7261 6365 2d63 6f6e 6469 7469  oid race-conditi
+00001630: 6f6e 7320 7768 656e 2075 7369 6e67 2066  ons when using f
+00001640: 6f72 6365 2a20 636f 6d6d 616e 6473 0a20  orce* commands. 
+00001650: 2020 2020 2020 2023 2044 7565 2074 6f20         # Due to 
+00001660: 6675 6e64 696e 6720 6665 6520 6665 7463  funding fee fetc
+00001670: 6869 6e67 2e0a 2020 2020 2020 2020 7365  hing..        se
+00001680: 6c66 2e5f 6c6f 6f70 5f6c 6f63 6b20 3d20  lf._loop_lock = 
+00001690: 4c6f 636b 2829 0a20 2020 2020 2020 2073  Lock().        s
+000016a0: 656c 662e 6c6f 6f70 203d 2073 656c 662e  elf.loop = self.
+000016b0: 5f69 6e69 745f 6173 796e 635f 6c6f 6f70  _init_async_loop
+000016c0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+000016d0: 5f63 6f6e 6669 673a 2043 6f6e 6669 6720  _config: Config 
+000016e0: 3d20 7b7d 0a0a 2020 2020 2020 2020 7365  = {}..        se
+000016f0: 6c66 2e5f 636f 6e66 6967 2e75 7064 6174  lf._config.updat
+00001700: 6528 636f 6e66 6967 290a 0a20 2020 2020  e(config)..     
+00001710: 2020 2023 2048 6f6c 6473 206c 6173 7420     # Holds last 
+00001720: 6361 6e64 6c65 2072 6566 7265 7368 6564  candle refreshed
+00001730: 2074 696d 6520 6f66 2065 6163 6820 7061   time of each pa
+00001740: 6972 0a20 2020 2020 2020 2073 656c 662e  ir.        self.
+00001750: 5f70 6169 7273 5f6c 6173 745f 7265 6672  _pairs_last_refr
+00001760: 6573 685f 7469 6d65 3a20 4469 6374 5b50  esh_time: Dict[P
+00001770: 6169 7257 6974 6854 696d 6566 7261 6d65  airWithTimeframe
+00001780: 2c20 696e 745d 203d 207b 7d0a 2020 2020  , int] = {}.    
+00001790: 2020 2020 2320 5469 6d65 7374 616d 7020      # Timestamp 
+000017a0: 6f66 206c 6173 7420 6d61 726b 6574 7320  of last markets 
+000017b0: 7265 6672 6573 680a 2020 2020 2020 2020  refresh.        
+000017c0: 7365 6c66 2e5f 6c61 7374 5f6d 6172 6b65  self._last_marke
+000017d0: 7473 5f72 6566 7265 7368 3a20 696e 7420  ts_refresh: int 
+000017e0: 3d20 300a 0a20 2020 2020 2020 2023 2043  = 0..        # C
+000017f0: 6163 6865 2066 6f72 2031 3020 6d69 6e75  ache for 10 minu
+00001800: 7465 7320 2e2e 2e0a 2020 2020 2020 2020  tes ....        
+00001810: 7365 6c66 2e5f 6361 6368 655f 6c6f 636b  self._cache_lock
+00001820: 203d 204c 6f63 6b28 290a 2020 2020 2020   = Lock().      
+00001830: 2020 7365 6c66 2e5f 6665 7463 685f 7469    self._fetch_ti
+00001840: 636b 6572 735f 6361 6368 653a 2054 544c  ckers_cache: TTL
+00001850: 4361 6368 6520 3d20 5454 4c43 6163 6865  Cache = TTLCache
+00001860: 286d 6178 7369 7a65 3d32 2c20 7474 6c3d  (maxsize=2, ttl=
+00001870: 3630 202a 2031 3029 0a20 2020 2020 2020  60 * 10).       
+00001880: 2023 2043 6163 6865 2076 616c 7565 7320   # Cache values 
+00001890: 666f 7220 3330 3020 746f 2061 766f 6964  for 300 to avoid
+000018a0: 2066 7265 7175 656e 7420 706f 6c6c 696e   frequent pollin
+000018b0: 6720 6f66 2074 6865 2065 7863 6861 6e67  g of the exchang
+000018c0: 6520 666f 7220 7072 6963 6573 0a20 2020  e for prices.   
+000018d0: 2020 2020 2023 2043 6163 6869 6e67 206f       # Caching o
+000018e0: 6e6c 7920 6170 706c 6965 7320 746f 2052  nly applies to R
+000018f0: 5043 206d 6574 686f 6473 2c20 736f 2070  PC methods, so p
+00001900: 7269 6365 7320 666f 7220 6f70 656e 2074  rices for open t
+00001910: 7261 6465 7320 6172 6520 7374 696c 6c0a  rades are still.
+00001920: 2020 2020 2020 2020 2320 7265 6672 6573          # refres
+00001930: 6865 6420 6f6e 6365 2065 7665 7279 2069  hed once every i
+00001940: 7465 7261 7469 6f6e 2e0a 2020 2020 2020  teration..      
+00001950: 2020 2320 5368 6f75 6c64 6e27 7420 6265    # Shouldn't be
+00001960: 2074 6f6f 2068 6967 6820 6569 7468 6572   too high either
+00001970: 2c20 6173 2069 7427 6c6c 2066 7265 657a  , as it'll freez
+00001980: 6520 5549 2075 7064 6174 6573 2069 6e20  e UI updates in 
+00001990: 6361 7365 206f 6620 6f70 656e 206f 7264  case of open ord
+000019a0: 6572 732e 0a20 2020 2020 2020 2073 656c  ers..        sel
+000019b0: 662e 5f65 7869 745f 7261 7465 5f63 6163  f._exit_rate_cac
+000019c0: 6865 3a20 5454 4c43 6163 6865 203d 2054  he: TTLCache = T
+000019d0: 544c 4361 6368 6528 6d61 7873 697a 653d  TLCache(maxsize=
+000019e0: 3130 302c 2074 746c 3d33 3030 290a 2020  100, ttl=300).  
+000019f0: 2020 2020 2020 7365 6c66 2e5f 656e 7472        self._entr
+00001a00: 795f 7261 7465 5f63 6163 6865 3a20 5454  y_rate_cache: TT
+00001a10: 4c43 6163 6865 203d 2054 544c 4361 6368  LCache = TTLCach
+00001a20: 6528 6d61 7873 697a 653d 3130 302c 2074  e(maxsize=100, t
+00001a30: 746c 3d33 3030 290a 0a20 2020 2020 2020  tl=300)..       
+00001a40: 2023 2048 6f6c 6473 2063 616e 646c 6573   # Holds candles
+00001a50: 0a20 2020 2020 2020 2073 656c 662e 5f6b  .        self._k
+00001a60: 6c69 6e65 733a 2044 6963 745b 5061 6972  lines: Dict[Pair
+00001a70: 5769 7468 5469 6d65 6672 616d 652c 2044  WithTimeframe, D
+00001a80: 6174 6146 7261 6d65 5d20 3d20 7b7d 0a20  ataFrame] = {}. 
+00001a90: 2020 2020 2020 2073 656c 662e 5f65 7870         self._exp
+00001aa0: 6972 696e 675f 6361 6e64 6c65 5f63 6163  iring_candle_cac
+00001ab0: 6865 3a20 4469 6374 5b54 7570 6c65 5b73  he: Dict[Tuple[s
+00001ac0: 7472 2c20 696e 745d 2c20 5065 7269 6f64  tr, int], Period
+00001ad0: 6963 4361 6368 655d 203d 207b 7d0a 0a20  icCache] = {}.. 
+00001ae0: 2020 2020 2020 2023 2048 6f6c 6473 2061         # Holds a
+00001af0: 6c6c 206f 7065 6e20 7365 6c6c 206f 7264  ll open sell ord
+00001b00: 6572 7320 666f 7220 6472 795f 7275 6e0a  ers for dry_run.
+00001b10: 2020 2020 2020 2020 7365 6c66 2e5f 6472          self._dr
+00001b20: 795f 7275 6e5f 6f70 656e 5f6f 7264 6572  y_run_open_order
+00001b30: 733a 2044 6963 745b 7374 722c 2041 6e79  s: Dict[str, Any
+00001b40: 5d20 3d20 7b7d 0a0a 2020 2020 2020 2020  ] = {}..        
+00001b50: 6966 2063 6f6e 6669 675b 2764 7279 5f72  if config['dry_r
+00001b60: 756e 275d 3a0a 2020 2020 2020 2020 2020  un']:.          
+00001b70: 2020 6c6f 6767 6572 2e69 6e66 6f28 2749    logger.info('I
+00001b80: 6e73 7461 6e63 6520 6973 2072 756e 6e69  nstance is runni
+00001b90: 6e67 2077 6974 6820 6472 795f 7275 6e20  ng with dry_run 
+00001ba0: 656e 6162 6c65 6427 290a 2020 2020 2020  enabled').      
+00001bb0: 2020 6c6f 6767 6572 2e69 6e66 6f28 6622    logger.info(f"
+00001bc0: 5573 696e 6720 4343 5854 207b 6363 7874  Using CCXT {ccxt
+00001bd0: 2e5f 5f76 6572 7369 6f6e 5f5f 7d22 290a  .__version__}").
+00001be0: 2020 2020 2020 2020 6578 6368 616e 6765          exchange
+00001bf0: 5f63 6f6e 663a 2044 6963 745b 7374 722c  _conf: Dict[str,
+00001c00: 2041 6e79 5d20 3d20 6578 6368 616e 6765   Any] = exchange
+00001c10: 5f63 6f6e 6669 6720 6966 2065 7863 6861  _config if excha
+00001c20: 6e67 655f 636f 6e66 6967 2065 6c73 6520  nge_config else 
+00001c30: 636f 6e66 6967 5b27 6578 6368 616e 6765  config['exchange
+00001c40: 275d 0a20 2020 2020 2020 2072 656d 6f76  '].        remov
+00001c50: 655f 6578 6368 616e 6765 5f63 7265 6465  e_exchange_crede
+00001c60: 6e74 6961 6c73 2865 7863 6861 6e67 655f  ntials(exchange_
+00001c70: 636f 6e66 2c20 636f 6e66 6967 2e67 6574  conf, config.get
+00001c80: 2827 6472 795f 7275 6e27 2c20 4661 6c73  ('dry_run', Fals
+00001c90: 6529 290a 2020 2020 2020 2020 7365 6c66  e)).        self
+00001ca0: 2e6c 6f67 5f72 6573 706f 6e73 6573 203d  .log_responses =
+00001cb0: 2065 7863 6861 6e67 655f 636f 6e66 2e67   exchange_conf.g
+00001cc0: 6574 2827 6c6f 675f 7265 7370 6f6e 7365  et('log_response
+00001cd0: 7327 2c20 4661 6c73 6529 0a0a 2020 2020  s', False)..    
+00001ce0: 2020 2020 2320 4c65 7665 7261 6765 2070      # Leverage p
+00001cf0: 726f 7065 7274 6965 730a 2020 2020 2020  roperties.      
+00001d00: 2020 7365 6c66 2e74 7261 6469 6e67 5f6d    self.trading_m
+00001d10: 6f64 653a 2054 7261 6469 6e67 4d6f 6465  ode: TradingMode
+00001d20: 203d 2063 6f6e 6669 672e 6765 7428 2774   = config.get('t
+00001d30: 7261 6469 6e67 5f6d 6f64 6527 2c20 5472  rading_mode', Tr
+00001d40: 6164 696e 674d 6f64 652e 5350 4f54 290a  adingMode.SPOT).
+00001d50: 2020 2020 2020 2020 7365 6c66 2e6d 6172          self.mar
+00001d60: 6769 6e5f 6d6f 6465 3a20 4d61 7267 696e  gin_mode: Margin
+00001d70: 4d6f 6465 203d 2028 0a20 2020 2020 2020  Mode = (.       
+00001d80: 2020 2020 204d 6172 6769 6e4d 6f64 6528       MarginMode(
+00001d90: 636f 6e66 6967 2e67 6574 2827 6d61 7267  config.get('marg
+00001da0: 696e 5f6d 6f64 6527 2929 0a20 2020 2020  in_mode')).     
+00001db0: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
+00001dc0: 2e67 6574 2827 6d61 7267 696e 5f6d 6f64  .get('margin_mod
+00001dd0: 6527 290a 2020 2020 2020 2020 2020 2020  e').            
+00001de0: 656c 7365 204d 6172 6769 6e4d 6f64 652e  else MarginMode.
+00001df0: 4e4f 4e45 0a20 2020 2020 2020 2029 0a20  NONE.        ). 
+00001e00: 2020 2020 2020 2073 656c 662e 6c69 7175         self.liqu
+00001e10: 6964 6174 696f 6e5f 6275 6666 6572 203d  idation_buffer =
+00001e20: 2063 6f6e 6669 672e 6765 7428 276c 6971   config.get('liq
+00001e30: 7569 6461 7469 6f6e 5f62 7566 6665 7227  uidation_buffer'
+00001e40: 2c20 302e 3035 290a 0a20 2020 2020 2020  , 0.05)..       
+00001e50: 2023 2044 6565 7020 6d65 7267 6520 6674   # Deep merge ft
+00001e60: 5f68 6173 2077 6974 6820 6465 6661 756c  _has with defaul
+00001e70: 7420 6674 5f68 6173 206f 7074 696f 6e73  t ft_has options
+00001e80: 0a20 2020 2020 2020 2073 656c 662e 5f66  .        self._f
+00001e90: 745f 6861 7320 3d20 6465 6570 5f6d 6572  t_has = deep_mer
+00001ea0: 6765 5f64 6963 7473 2873 656c 662e 5f66  ge_dicts(self._f
+00001eb0: 745f 6861 732c 2064 6565 7063 6f70 7928  t_has, deepcopy(
+00001ec0: 7365 6c66 2e5f 6674 5f68 6173 5f64 6566  self._ft_has_def
+00001ed0: 6175 6c74 2929 0a20 2020 2020 2020 2069  ault)).        i
+00001ee0: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
+00001ef0: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
+00001f00: 6465 2e46 5554 5552 4553 3a0a 2020 2020  de.FUTURES:.    
+00001f10: 2020 2020 2020 2020 7365 6c66 2e5f 6674          self._ft
+00001f20: 5f68 6173 203d 2064 6565 705f 6d65 7267  _has = deep_merg
+00001f30: 655f 6469 6374 7328 7365 6c66 2e5f 6674  e_dicts(self._ft
+00001f40: 5f68 6173 5f66 7574 7572 6573 2c20 7365  _has_futures, se
+00001f50: 6c66 2e5f 6674 5f68 6173 290a 2020 2020  lf._ft_has).    
+00001f60: 2020 2020 6966 2065 7863 6861 6e67 655f      if exchange_
+00001f70: 636f 6e66 2e67 6574 2827 5f66 745f 6861  conf.get('_ft_ha
+00001f80: 735f 7061 7261 6d73 2729 3a0a 2020 2020  s_params'):.    
+00001f90: 2020 2020 2020 2020 7365 6c66 2e5f 6674          self._ft
+00001fa0: 5f68 6173 203d 2064 6565 705f 6d65 7267  _has = deep_merg
+00001fb0: 655f 6469 6374 7328 6578 6368 616e 6765  e_dicts(exchange
+00001fc0: 5f63 6f6e 662e 6765 7428 275f 6674 5f68  _conf.get('_ft_h
+00001fd0: 6173 5f70 6172 616d 7327 292c 0a20 2020  as_params'),.   
 00001fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00001ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002000: 2020 2073 656c 662e 5f66 745f 6861 7329     self._ft_has)
-00002010: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00002020: 6765 722e 696e 666f 2822 4f76 6572 7269  ger.info("Overri
-00002030: 6469 6e67 2065 7863 6861 6e67 652e 5f66  ding exchange._f
-00002040: 745f 6861 7320 7769 7468 2063 6f6e 6669  t_has with confi
-00002050: 6720 7061 7261 6d73 2c20 7265 7375 6c74  g params, result
-00002060: 3a20 2573 222c 2073 656c 662e 5f66 745f  : %s", self._ft_
-00002070: 6861 7329 0a0a 2020 2020 2020 2020 2320  has)..        # 
-00002080: 4173 7369 676e 2074 6869 7320 6469 7265  Assign this dire
-00002090: 6374 6c79 2066 6f72 2065 6173 7920 6163  ctly for easy ac
-000020a0: 6365 7373 0a20 2020 2020 2020 2073 656c  cess.        sel
-000020b0: 662e 5f6f 686c 6376 5f70 6172 7469 616c  f._ohlcv_partial
-000020c0: 5f63 616e 646c 6520 3d20 7365 6c66 2e5f  _candle = self._
-000020d0: 6674 5f68 6173 5b27 6f68 6c63 765f 7061  ft_has['ohlcv_pa
-000020e0: 7274 6961 6c5f 6361 6e64 6c65 275d 0a0a  rtial_candle']..
-000020f0: 2020 2020 2020 2020 7365 6c66 2e5f 7472          self._tr
-00002100: 6164 6573 5f70 6167 696e 6174 696f 6e20  ades_pagination 
-00002110: 3d20 7365 6c66 2e5f 6674 5f68 6173 5b27  = self._ft_has['
-00002120: 7472 6164 6573 5f70 6167 696e 6174 696f  trades_paginatio
-00002130: 6e27 5d0a 2020 2020 2020 2020 7365 6c66  n'].        self
-00002140: 2e5f 7472 6164 6573 5f70 6167 696e 6174  ._trades_paginat
-00002150: 696f 6e5f 6172 6720 3d20 7365 6c66 2e5f  ion_arg = self._
-00002160: 6674 5f68 6173 5b27 7472 6164 6573 5f70  ft_has['trades_p
-00002170: 6167 696e 6174 696f 6e5f 6172 6727 5d0a  agination_arg'].
-00002180: 0a20 2020 2020 2020 2023 2049 6e69 7469  .        # Initi
-00002190: 616c 697a 6520 6363 7874 206f 626a 6563  alize ccxt objec
-000021a0: 7473 0a20 2020 2020 2020 2063 6378 745f  ts.        ccxt_
-000021b0: 636f 6e66 6967 203d 2073 656c 662e 5f63  config = self._c
-000021c0: 6378 745f 636f 6e66 6967 0a20 2020 2020  cxt_config.     
-000021d0: 2020 2063 6378 745f 636f 6e66 6967 203d     ccxt_config =
-000021e0: 2064 6565 705f 6d65 7267 655f 6469 6374   deep_merge_dict
-000021f0: 7328 6578 6368 616e 6765 5f63 6f6e 662e  s(exchange_conf.
-00002200: 6765 7428 2763 6378 745f 636f 6e66 6967  get('ccxt_config
-00002210: 272c 207b 7d29 2c20 6363 7874 5f63 6f6e  ', {}), ccxt_con
-00002220: 6669 6729 0a20 2020 2020 2020 2063 6378  fig).        ccx
-00002230: 745f 636f 6e66 6967 203d 2064 6565 705f  t_config = deep_
-00002240: 6d65 7267 655f 6469 6374 7328 6578 6368  merge_dicts(exch
-00002250: 616e 6765 5f63 6f6e 662e 6765 7428 2763  ange_conf.get('c
-00002260: 6378 745f 7379 6e63 5f63 6f6e 6669 6727  cxt_sync_config'
-00002270: 2c20 7b7d 292c 2063 6378 745f 636f 6e66  , {}), ccxt_conf
-00002280: 6967 290a 0a20 2020 2020 2020 2073 656c  ig)..        sel
-00002290: 662e 5f61 7069 203d 2073 656c 662e 5f69  f._api = self._i
-000022a0: 6e69 745f 6363 7874 2865 7863 6861 6e67  nit_ccxt(exchang
-000022b0: 655f 636f 6e66 2c20 6363 7874 5f6b 7761  e_conf, ccxt_kwa
-000022c0: 7267 733d 6363 7874 5f63 6f6e 6669 6729  rgs=ccxt_config)
-000022d0: 0a0a 2020 2020 2020 2020 6363 7874 5f61  ..        ccxt_a
-000022e0: 7379 6e63 5f63 6f6e 6669 6720 3d20 7365  sync_config = se
-000022f0: 6c66 2e5f 6363 7874 5f63 6f6e 6669 670a  lf._ccxt_config.
-00002300: 2020 2020 2020 2020 6363 7874 5f61 7379          ccxt_asy
-00002310: 6e63 5f63 6f6e 6669 6720 3d20 6465 6570  nc_config = deep
-00002320: 5f6d 6572 6765 5f64 6963 7473 2865 7863  _merge_dicts(exc
-00002330: 6861 6e67 655f 636f 6e66 2e67 6574 2827  hange_conf.get('
-00002340: 6363 7874 5f63 6f6e 6669 6727 2c20 7b7d  ccxt_config', {}
-00002350: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00002000: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+00002010: 745f 6861 7329 0a20 2020 2020 2020 2020  t_has).         
+00002020: 2020 206c 6f67 6765 722e 696e 666f 2822     logger.info("
+00002030: 4f76 6572 7269 6469 6e67 2065 7863 6861  Overriding excha
+00002040: 6e67 652e 5f66 745f 6861 7320 7769 7468  nge._ft_has with
+00002050: 2063 6f6e 6669 6720 7061 7261 6d73 2c20   config params, 
+00002060: 7265 7375 6c74 3a20 2573 222c 2073 656c  result: %s", sel
+00002070: 662e 5f66 745f 6861 7329 0a0a 2020 2020  f._ft_has)..    
+00002080: 2020 2020 2320 4173 7369 676e 2074 6869      # Assign thi
+00002090: 7320 6469 7265 6374 6c79 2066 6f72 2065  s directly for e
+000020a0: 6173 7920 6163 6365 7373 0a20 2020 2020  asy access.     
+000020b0: 2020 2073 656c 662e 5f6f 686c 6376 5f70     self._ohlcv_p
+000020c0: 6172 7469 616c 5f63 616e 646c 6520 3d20  artial_candle = 
+000020d0: 7365 6c66 2e5f 6674 5f68 6173 5b27 6f68  self._ft_has['oh
+000020e0: 6c63 765f 7061 7274 6961 6c5f 6361 6e64  lcv_partial_cand
+000020f0: 6c65 275d 0a0a 2020 2020 2020 2020 7365  le']..        se
+00002100: 6c66 2e5f 7472 6164 6573 5f70 6167 696e  lf._trades_pagin
+00002110: 6174 696f 6e20 3d20 7365 6c66 2e5f 6674  ation = self._ft
+00002120: 5f68 6173 5b27 7472 6164 6573 5f70 6167  _has['trades_pag
+00002130: 696e 6174 696f 6e27 5d0a 2020 2020 2020  ination'].      
+00002140: 2020 7365 6c66 2e5f 7472 6164 6573 5f70    self._trades_p
+00002150: 6167 696e 6174 696f 6e5f 6172 6720 3d20  agination_arg = 
+00002160: 7365 6c66 2e5f 6674 5f68 6173 5b27 7472  self._ft_has['tr
+00002170: 6164 6573 5f70 6167 696e 6174 696f 6e5f  ades_pagination_
+00002180: 6172 6727 5d0a 0a20 2020 2020 2020 2023  arg']..        #
+00002190: 2049 6e69 7469 616c 697a 6520 6363 7874   Initialize ccxt
+000021a0: 206f 626a 6563 7473 0a20 2020 2020 2020   objects.       
+000021b0: 2063 6378 745f 636f 6e66 6967 203d 2073   ccxt_config = s
+000021c0: 656c 662e 5f63 6378 745f 636f 6e66 6967  elf._ccxt_config
+000021d0: 0a20 2020 2020 2020 2063 6378 745f 636f  .        ccxt_co
+000021e0: 6e66 6967 203d 2064 6565 705f 6d65 7267  nfig = deep_merg
+000021f0: 655f 6469 6374 7328 6578 6368 616e 6765  e_dicts(exchange
+00002200: 5f63 6f6e 662e 6765 7428 2763 6378 745f  _conf.get('ccxt_
+00002210: 636f 6e66 6967 272c 207b 7d29 2c20 6363  config', {}), cc
+00002220: 7874 5f63 6f6e 6669 6729 0a20 2020 2020  xt_config).     
+00002230: 2020 2063 6378 745f 636f 6e66 6967 203d     ccxt_config =
+00002240: 2064 6565 705f 6d65 7267 655f 6469 6374   deep_merge_dict
+00002250: 7328 6578 6368 616e 6765 5f63 6f6e 662e  s(exchange_conf.
+00002260: 6765 7428 2763 6378 745f 7379 6e63 5f63  get('ccxt_sync_c
+00002270: 6f6e 6669 6727 2c20 7b7d 292c 2063 6378  onfig', {}), ccx
+00002280: 745f 636f 6e66 6967 290a 0a20 2020 2020  t_config)..     
+00002290: 2020 2073 656c 662e 5f61 7069 203d 2073     self._api = s
+000022a0: 656c 662e 5f69 6e69 745f 6363 7874 2865  elf._init_ccxt(e
+000022b0: 7863 6861 6e67 655f 636f 6e66 2c20 6363  xchange_conf, cc
+000022c0: 7874 5f6b 7761 7267 733d 6363 7874 5f63  xt_kwargs=ccxt_c
+000022d0: 6f6e 6669 6729 0a0a 2020 2020 2020 2020  onfig)..        
+000022e0: 6363 7874 5f61 7379 6e63 5f63 6f6e 6669  ccxt_async_confi
+000022f0: 6720 3d20 7365 6c66 2e5f 6363 7874 5f63  g = self._ccxt_c
+00002300: 6f6e 6669 670a 2020 2020 2020 2020 6363  onfig.        cc
+00002310: 7874 5f61 7379 6e63 5f63 6f6e 6669 6720  xt_async_config 
+00002320: 3d20 6465 6570 5f6d 6572 6765 5f64 6963  = deep_merge_dic
+00002330: 7473 2865 7863 6861 6e67 655f 636f 6e66  ts(exchange_conf
+00002340: 2e67 6574 2827 6363 7874 5f63 6f6e 6669  .get('ccxt_confi
+00002350: 6727 2c20 7b7d 292c 0a20 2020 2020 2020  g', {}),.       
 00002360: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00002370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002380: 6363 7874 5f61 7379 6e63 5f63 6f6e 6669  ccxt_async_confi
-00002390: 6729 0a20 2020 2020 2020 2063 6378 745f  g).        ccxt_
-000023a0: 6173 796e 635f 636f 6e66 6967 203d 2064  async_config = d
-000023b0: 6565 705f 6d65 7267 655f 6469 6374 7328  eep_merge_dicts(
-000023c0: 6578 6368 616e 6765 5f63 6f6e 662e 6765  exchange_conf.ge
-000023d0: 7428 2763 6378 745f 6173 796e 635f 636f  t('ccxt_async_co
-000023e0: 6e66 6967 272c 207b 7d29 2c0a 2020 2020  nfig', {}),.    
-000023f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002380: 2020 2020 2020 6363 7874 5f61 7379 6e63        ccxt_async
+00002390: 5f63 6f6e 6669 6729 0a20 2020 2020 2020  _config).       
+000023a0: 2063 6378 745f 6173 796e 635f 636f 6e66   ccxt_async_conf
+000023b0: 6967 203d 2064 6565 705f 6d65 7267 655f  ig = deep_merge_
+000023c0: 6469 6374 7328 6578 6368 616e 6765 5f63  dicts(exchange_c
+000023d0: 6f6e 662e 6765 7428 2763 6378 745f 6173  onf.get('ccxt_as
+000023e0: 796e 635f 636f 6e66 6967 272c 207b 7d29  ync_config', {})
+000023f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00002400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002410: 2020 2020 2020 2020 2063 6378 745f 6173           ccxt_as
-00002420: 796e 635f 636f 6e66 6967 290a 2020 2020  ync_config).    
-00002430: 2020 2020 7365 6c66 2e5f 6170 695f 6173      self._api_as
-00002440: 796e 6320 3d20 7365 6c66 2e5f 696e 6974  ync = self._init
-00002450: 5f63 6378 7428 0a20 2020 2020 2020 2020  _ccxt(.         
-00002460: 2020 2065 7863 6861 6e67 655f 636f 6e66     exchange_conf
-00002470: 2c20 6363 7874 5f61 7379 6e63 2c20 6363  , ccxt_async, cc
-00002480: 7874 5f6b 7761 7267 733d 6363 7874 5f61  xt_kwargs=ccxt_a
-00002490: 7379 6e63 5f63 6f6e 6669 6729 0a0a 2020  sync_config)..  
-000024a0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-000024b0: 6f28 6627 5573 696e 6720 4578 6368 616e  o(f'Using Exchan
-000024c0: 6765 2022 7b73 656c 662e 6e61 6d65 7d22  ge "{self.name}"
-000024d0: 2729 0a20 2020 2020 2020 2073 656c 662e  ').        self.
-000024e0: 7265 7175 6972 6564 5f63 616e 646c 655f  required_candle_
-000024f0: 6361 6c6c 5f63 6f75 6e74 203d 2031 0a20  call_count = 1. 
-00002500: 2020 2020 2020 2069 6620 7661 6c69 6461         if valida
-00002510: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
-00002520: 2320 496e 6974 6961 6c20 6d61 726b 6574  # Initial market
-00002530: 7320 6c6f 6164 0a20 2020 2020 2020 2020  s load.         
-00002540: 2020 2073 656c 662e 5f6c 6f61 645f 6d61     self._load_ma
-00002550: 726b 6574 7328 290a 2020 2020 2020 2020  rkets().        
-00002560: 2020 2020 7365 6c66 2e76 616c 6964 6174      self.validat
-00002570: 655f 636f 6e66 6967 2863 6f6e 6669 6729  e_config(config)
-00002580: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00002590: 662e 5f73 7461 7274 7570 5f63 616e 646c  f._startup_candl
-000025a0: 655f 636f 756e 743a 2069 6e74 203d 2063  e_count: int = c
-000025b0: 6f6e 6669 672e 6765 7428 2773 7461 7274  onfig.get('start
-000025c0: 7570 5f63 616e 646c 655f 636f 756e 7427  up_candle_count'
-000025d0: 2c20 3029 0a20 2020 2020 2020 2020 2020  , 0).           
-000025e0: 2073 656c 662e 7265 7175 6972 6564 5f63   self.required_c
-000025f0: 616e 646c 655f 6361 6c6c 5f63 6f75 6e74  andle_call_count
-00002600: 203d 2073 656c 662e 7661 6c69 6461 7465   = self.validate
-00002610: 5f72 6571 7569 7265 645f 7374 6172 7475  _required_startu
-00002620: 705f 6361 6e64 6c65 7328 0a20 2020 2020  p_candles(.     
-00002630: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00002640: 5f73 7461 7274 7570 5f63 616e 646c 655f  _startup_candle_
-00002650: 636f 756e 742c 2063 6f6e 6669 672e 6765  count, config.ge
-00002660: 7428 2774 696d 6566 7261 6d65 272c 2027  t('timeframe', '
-00002670: 2729 290a 0a20 2020 2020 2020 2023 2043  '))..        # C
-00002680: 6f6e 7665 7274 7320 7468 6520 696e 7465  onverts the inte
-00002690: 7276 616c 2070 726f 7669 6465 6420 696e  rval provided in
-000026a0: 206d 696e 7574 6573 2069 6e20 636f 6e66   minutes in conf
-000026b0: 6967 2074 6f20 7365 636f 6e64 730a 2020  ig to seconds.  
-000026c0: 2020 2020 2020 7365 6c66 2e6d 6172 6b65        self.marke
-000026d0: 7473 5f72 6566 7265 7368 5f69 6e74 6572  ts_refresh_inter
-000026e0: 7661 6c3a 2069 6e74 203d 2065 7863 6861  val: int = excha
-000026f0: 6e67 655f 636f 6e66 2e67 6574 280a 2020  nge_conf.get(.  
-00002700: 2020 2020 2020 2020 2020 226d 6172 6b65            "marke
-00002710: 7473 5f72 6566 7265 7368 5f69 6e74 6572  ts_refresh_inter
-00002720: 7661 6c22 2c20 3630 2920 2a20 3630 202a  val", 60) * 60 *
-00002730: 2031 3030 300a 0a20 2020 2020 2020 2069   1000..        i
-00002740: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
-00002750: 6f64 6520 213d 2054 7261 6469 6e67 4d6f  ode != TradingMo
-00002760: 6465 2e53 504f 5420 616e 6420 6c6f 6164  de.SPOT and load
-00002770: 5f6c 6576 6572 6167 655f 7469 6572 733a  _leverage_tiers:
-00002780: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-00002790: 662e 6669 6c6c 5f6c 6576 6572 6167 655f  f.fill_leverage_
-000027a0: 7469 6572 7328 290a 2020 2020 2020 2020  tiers().        
-000027b0: 7365 6c66 2e61 6464 6974 696f 6e61 6c5f  self.additional_
-000027c0: 6578 6368 616e 6765 5f69 6e69 7428 290a  exchange_init().
-000027d0: 0a20 2020 2064 6566 205f 5f64 656c 5f5f  .    def __del__
-000027e0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-000027f0: 2222 220a 2020 2020 2020 2020 4465 7374  """.        Dest
-00002800: 7275 6374 6f72 202d 2063 6c65 616e 2075  ructor - clean u
-00002810: 7020 6173 796e 6320 7374 7566 660a 2020  p async stuff.  
-00002820: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00002830: 2020 7365 6c66 2e63 6c6f 7365 2829 0a0a    self.close()..
-00002840: 2020 2020 6465 6620 636c 6f73 6528 7365      def close(se
-00002850: 6c66 293a 0a20 2020 2020 2020 206c 6f67  lf):.        log
-00002860: 6765 722e 6465 6275 6728 2245 7863 6861  ger.debug("Excha
-00002870: 6e67 6520 6f62 6a65 6374 2064 6573 7472  nge object destr
-00002880: 6f79 6564 2c20 636c 6f73 696e 6720 6173  oyed, closing as
-00002890: 796e 6320 6c6f 6f70 2229 0a20 2020 2020  ync loop").     
-000028a0: 2020 2069 6620 2873 656c 662e 5f61 7069     if (self._api
-000028b0: 5f61 7379 6e63 2061 6e64 2069 6e73 7065  _async and inspe
-000028c0: 6374 2e69 7363 6f72 6f75 7469 6e65 6675  ct.iscoroutinefu
-000028d0: 6e63 7469 6f6e 2873 656c 662e 5f61 7069  nction(self._api
-000028e0: 5f61 7379 6e63 2e63 6c6f 7365 290a 2020  _async.close).  
-000028f0: 2020 2020 2020 2020 2020 2020 2020 616e                an
-00002900: 6420 7365 6c66 2e5f 6170 695f 6173 796e  d self._api_asyn
-00002910: 632e 7365 7373 696f 6e29 3a0a 2020 2020  c.session):.    
-00002920: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-00002930: 6562 7567 2822 436c 6f73 696e 6720 6173  ebug("Closing as
-00002940: 796e 6320 6363 7874 2073 6573 7369 6f6e  ync ccxt session
-00002950: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-00002960: 7365 6c66 2e6c 6f6f 702e 7275 6e5f 756e  self.loop.run_un
-00002970: 7469 6c5f 636f 6d70 6c65 7465 2873 656c  til_complete(sel
-00002980: 662e 5f61 7069 5f61 7379 6e63 2e63 6c6f  f._api_async.clo
-00002990: 7365 2829 290a 2020 2020 2020 2020 6966  se()).        if
-000029a0: 2073 656c 662e 6c6f 6f70 2061 6e64 206e   self.loop and n
-000029b0: 6f74 2073 656c 662e 6c6f 6f70 2e69 735f  ot self.loop.is_
-000029c0: 636c 6f73 6564 2829 3a0a 2020 2020 2020  closed():.      
-000029d0: 2020 2020 2020 7365 6c66 2e6c 6f6f 702e        self.loop.
-000029e0: 636c 6f73 6528 290a 0a20 2020 2064 6566  close()..    def
-000029f0: 205f 696e 6974 5f61 7379 6e63 5f6c 6f6f   _init_async_loo
-00002a00: 7028 7365 6c66 2920 2d3e 2061 7379 6e63  p(self) -> async
-00002a10: 696f 2e41 6273 7472 6163 7445 7665 6e74  io.AbstractEvent
-00002a20: 4c6f 6f70 3a0a 2020 2020 2020 2020 6c6f  Loop:.        lo
-00002a30: 6f70 203d 2061 7379 6e63 696f 2e6e 6577  op = asyncio.new
-00002a40: 5f65 7665 6e74 5f6c 6f6f 7028 290a 2020  _event_loop().  
-00002a50: 2020 2020 2020 6173 796e 6369 6f2e 7365        asyncio.se
-00002a60: 745f 6576 656e 745f 6c6f 6f70 286c 6f6f  t_event_loop(loo
-00002a70: 7029 0a20 2020 2020 2020 2072 6574 7572  p).        retur
-00002a80: 6e20 6c6f 6f70 0a0a 2020 2020 6465 6620  n loop..    def 
-00002a90: 7661 6c69 6461 7465 5f63 6f6e 6669 6728  validate_config(
-00002aa0: 7365 6c66 2c20 636f 6e66 6967 293a 0a20  self, config):. 
-00002ab0: 2020 2020 2020 2023 2043 6865 636b 2069         # Check i
-00002ac0: 6620 7469 6d65 6672 616d 6520 6973 2061  f timeframe is a
-00002ad0: 7661 696c 6162 6c65 0a20 2020 2020 2020  vailable.       
-00002ae0: 2073 656c 662e 7661 6c69 6461 7465 5f74   self.validate_t
-00002af0: 696d 6566 7261 6d65 7328 636f 6e66 6967  imeframes(config
-00002b00: 2e67 6574 2827 7469 6d65 6672 616d 6527  .get('timeframe'
-00002b10: 2929 0a0a 2020 2020 2020 2020 2320 4368  ))..        # Ch
-00002b20: 6563 6b20 6966 2061 6c6c 2070 6169 7273  eck if all pairs
-00002b30: 2061 7265 2061 7661 696c 6162 6c65 0a20   are available. 
-00002b40: 2020 2020 2020 2073 656c 662e 7661 6c69         self.vali
-00002b50: 6461 7465 5f73 7461 6b65 6375 7272 656e  date_stakecurren
-00002b60: 6379 2863 6f6e 6669 675b 2773 7461 6b65  cy(config['stake
-00002b70: 5f63 7572 7265 6e63 7927 5d29 0a20 2020  _currency']).   
-00002b80: 2020 2020 2069 6620 6e6f 7420 636f 6e66       if not conf
-00002b90: 6967 5b27 6578 6368 616e 6765 275d 2e67  ig['exchange'].g
-00002ba0: 6574 2827 736b 6970 5f70 6169 725f 7661  et('skip_pair_va
-00002bb0: 6c69 6461 7469 6f6e 2729 3a0a 2020 2020  lidation'):.    
-00002bc0: 2020 2020 2020 2020 7365 6c66 2e76 616c          self.val
-00002bd0: 6964 6174 655f 7061 6972 7328 636f 6e66  idate_pairs(conf
-00002be0: 6967 5b27 6578 6368 616e 6765 275d 5b27  ig['exchange']['
-00002bf0: 7061 6972 5f77 6869 7465 6c69 7374 275d  pair_whitelist']
-00002c00: 290a 2020 2020 2020 2020 7365 6c66 2e76  ).        self.v
-00002c10: 616c 6964 6174 655f 6f72 6465 7274 7970  alidate_ordertyp
-00002c20: 6573 2863 6f6e 6669 672e 6765 7428 276f  es(config.get('o
-00002c30: 7264 6572 5f74 7970 6573 272c 207b 7d29  rder_types', {})
-00002c40: 290a 2020 2020 2020 2020 7365 6c66 2e76  ).        self.v
-00002c50: 616c 6964 6174 655f 6f72 6465 725f 7469  alidate_order_ti
-00002c60: 6d65 5f69 6e5f 666f 7263 6528 636f 6e66  me_in_force(conf
-00002c70: 6967 2e67 6574 2827 6f72 6465 725f 7469  ig.get('order_ti
-00002c80: 6d65 5f69 6e5f 666f 7263 6527 2c20 7b7d  me_in_force', {}
-00002c90: 2929 0a20 2020 2020 2020 2073 656c 662e  )).        self.
-00002ca0: 7661 6c69 6461 7465 5f74 7261 6469 6e67  validate_trading
-00002cb0: 5f6d 6f64 655f 616e 645f 6d61 7267 696e  _mode_and_margin
-00002cc0: 5f6d 6f64 6528 7365 6c66 2e74 7261 6469  _mode(self.tradi
-00002cd0: 6e67 5f6d 6f64 652c 2073 656c 662e 6d61  ng_mode, self.ma
-00002ce0: 7267 696e 5f6d 6f64 6529 0a20 2020 2020  rgin_mode).     
-00002cf0: 2020 2073 656c 662e 7661 6c69 6461 7465     self.validate
-00002d00: 5f70 7269 6369 6e67 2863 6f6e 6669 675b  _pricing(config[
-00002d10: 2765 7869 745f 7072 6963 696e 6727 5d29  'exit_pricing'])
-00002d20: 0a20 2020 2020 2020 2073 656c 662e 7661  .        self.va
-00002d30: 6c69 6461 7465 5f70 7269 6369 6e67 2863  lidate_pricing(c
-00002d40: 6f6e 6669 675b 2765 6e74 7279 5f70 7269  onfig['entry_pri
-00002d50: 6369 6e67 275d 290a 0a20 2020 2064 6566  cing'])..    def
-00002d60: 205f 696e 6974 5f63 6378 7428 7365 6c66   _init_ccxt(self
-00002d70: 2c20 6578 6368 616e 6765 5f63 6f6e 6669  , exchange_confi
-00002d80: 673a 2044 6963 745b 7374 722c 2041 6e79  g: Dict[str, Any
-00002d90: 5d2c 2063 6378 745f 6d6f 6475 6c65 3a20  ], ccxt_module: 
-00002da0: 4363 7874 4d6f 6475 6c65 5479 7065 203d  CcxtModuleType =
-00002db0: 2063 6378 742c 0a20 2020 2020 2020 2020   ccxt,.         
-00002dc0: 2020 2020 2020 2020 2020 6363 7874 5f6b            ccxt_k
-00002dd0: 7761 7267 733a 2044 6963 7420 3d20 7b7d  wargs: Dict = {}
-00002de0: 2920 2d3e 2063 6378 742e 4578 6368 616e  ) -> ccxt.Exchan
-00002df0: 6765 3a0a 2020 2020 2020 2020 2222 220a  ge:.        """.
-00002e00: 2020 2020 2020 2020 496e 6974 6961 6c69          Initiali
-00002e10: 7a65 2063 6378 7420 7769 7468 2067 6976  ze ccxt with giv
-00002e20: 656e 2063 6f6e 6669 6720 616e 6420 7265  en config and re
-00002e30: 7475 726e 2076 616c 6964 0a20 2020 2020  turn valid.     
-00002e40: 2020 2063 6378 7420 696e 7374 616e 6365     ccxt instance
-00002e50: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00002e60: 2020 2020 2020 2320 4669 6e64 206d 6174        # Find mat
-00002e70: 6368 696e 6720 636c 6173 7320 666f 7220  ching class for 
-00002e80: 7468 6520 6769 7665 6e20 6578 6368 616e  the given exchan
-00002e90: 6765 206e 616d 650a 2020 2020 2020 2020  ge name.        
-00002ea0: 6e61 6d65 203d 2065 7863 6861 6e67 655f  name = exchange_
-00002eb0: 636f 6e66 6967 5b27 6e61 6d65 275d 0a0a  config['name']..
-00002ec0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-00002ed0: 735f 6578 6368 616e 6765 5f6b 6e6f 776e  s_exchange_known
-00002ee0: 5f63 6378 7428 6e61 6d65 2c20 6363 7874  _ccxt(name, ccxt
-00002ef0: 5f6d 6f64 756c 6529 3a0a 2020 2020 2020  _module):.      
-00002f00: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
-00002f10: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
-00002f20: 2866 2745 7863 6861 6e67 6520 7b6e 616d  (f'Exchange {nam
-00002f30: 657d 2069 7320 6e6f 7420 7375 7070 6f72  e} is not suppor
-00002f40: 7465 6420 6279 2063 6378 7427 290a 0a20  ted by ccxt').. 
-00002f50: 2020 2020 2020 2065 785f 636f 6e66 6967         ex_config
-00002f60: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-00002f70: 2027 6170 694b 6579 273a 2065 7863 6861   'apiKey': excha
-00002f80: 6e67 655f 636f 6e66 6967 2e67 6574 2827  nge_config.get('
-00002f90: 6b65 7927 292c 0a20 2020 2020 2020 2020  key'),.         
-00002fa0: 2020 2027 7365 6372 6574 273a 2065 7863     'secret': exc
-00002fb0: 6861 6e67 655f 636f 6e66 6967 2e67 6574  hange_config.get
-00002fc0: 2827 7365 6372 6574 2729 2c0a 2020 2020  ('secret'),.    
-00002fd0: 2020 2020 2020 2020 2770 6173 7377 6f72          'passwor
-00002fe0: 6427 3a20 6578 6368 616e 6765 5f63 6f6e  d': exchange_con
-00002ff0: 6669 672e 6765 7428 2770 6173 7377 6f72  fig.get('passwor
-00003000: 6427 292c 0a20 2020 2020 2020 2020 2020  d'),.           
-00003010: 2027 7569 6427 3a20 6578 6368 616e 6765   'uid': exchange
-00003020: 5f63 6f6e 6669 672e 6765 7428 2775 6964  _config.get('uid
-00003030: 272c 2027 2729 2c0a 2020 2020 2020 2020  ', ''),.        
-00003040: 7d0a 2020 2020 2020 2020 6966 2063 6378  }.        if ccx
-00003050: 745f 6b77 6172 6773 3a0a 2020 2020 2020  t_kwargs:.      
-00003060: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
-00003070: 6f28 2741 7070 6c79 696e 6720 6164 6469  o('Applying addi
-00003080: 7469 6f6e 616c 2063 6378 7420 636f 6e66  tional ccxt conf
-00003090: 6967 3a20 2573 272c 2063 6378 745f 6b77  ig: %s', ccxt_kw
-000030a0: 6172 6773 290a 2020 2020 2020 2020 6966  args).        if
-000030b0: 2073 656c 662e 5f63 6378 745f 7061 7261   self._ccxt_para
-000030c0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-000030d0: 2320 496e 6a65 6374 2073 7461 7469 6320  # Inject static 
-000030e0: 6f70 7469 6f6e 7320 6166 7465 7220 7468  options after th
-000030f0: 6520 6162 6f76 6520 6f75 7470 7574 2074  e above output t
-00003100: 6f20 6e6f 7420 636f 6e66 7573 6520 7573  o not confuse us
-00003110: 6572 732e 0a20 2020 2020 2020 2020 2020  ers..           
-00003120: 2063 6378 745f 6b77 6172 6773 203d 2064   ccxt_kwargs = d
-00003130: 6565 705f 6d65 7267 655f 6469 6374 7328  eep_merge_dicts(
-00003140: 7365 6c66 2e5f 6363 7874 5f70 6172 616d  self._ccxt_param
-00003150: 732c 2063 6378 745f 6b77 6172 6773 290a  s, ccxt_kwargs).
-00003160: 2020 2020 2020 2020 6966 2063 6378 745f          if ccxt_
-00003170: 6b77 6172 6773 3a0a 2020 2020 2020 2020  kwargs:.        
-00003180: 2020 2020 6578 5f63 6f6e 6669 672e 7570      ex_config.up
-00003190: 6461 7465 2863 6378 745f 6b77 6172 6773  date(ccxt_kwargs
-000031a0: 290a 2020 2020 2020 2020 7472 793a 0a0a  ).        try:..
-000031b0: 2020 2020 2020 2020 2020 2020 6170 6920              api 
-000031c0: 3d20 6765 7461 7474 7228 6363 7874 5f6d  = getattr(ccxt_m
-000031d0: 6f64 756c 652c 206e 616d 652e 6c6f 7765  odule, name.lowe
-000031e0: 7228 2929 2865 785f 636f 6e66 6967 290a  r())(ex_config).
-000031f0: 2020 2020 2020 2020 6578 6365 7074 2028          except (
-00003200: 4b65 7945 7272 6f72 2c20 4174 7472 6962  KeyError, Attrib
-00003210: 7574 6545 7272 6f72 2920 6173 2065 3a0a  uteError) as e:.
-00003220: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00003230: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-00003240: 6570 7469 6f6e 2866 2745 7863 6861 6e67  eption(f'Exchang
-00003250: 6520 7b6e 616d 657d 2069 7320 6e6f 7420  e {name} is not 
-00003260: 7375 7070 6f72 7465 6427 2920 6672 6f6d  supported') from
-00003270: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00003280: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
-00003290: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000032a0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-000032b0: 6f6e 616c 4578 6365 7074 696f 6e28 6622  onalException(f"
-000032c0: 496e 6974 6961 6c69 7a61 7469 6f6e 206f  Initialization o
-000032d0: 6620 6363 7874 2066 6169 6c65 642e 2052  f ccxt failed. R
-000032e0: 6561 736f 6e3a 207b 657d 2229 2066 726f  eason: {e}") fro
-000032f0: 6d20 650a 0a20 2020 2020 2020 2072 6574  m e..        ret
-00003300: 7572 6e20 6170 690a 0a20 2020 2040 7072  urn api..    @pr
-00003310: 6f70 6572 7479 0a20 2020 2064 6566 205f  operty.    def _
-00003320: 6363 7874 5f63 6f6e 6669 6728 7365 6c66  ccxt_config(self
-00003330: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
-00003340: 2020 2023 2050 6172 616d 6574 6572 7320     # Parameters 
-00003350: 746f 2061 6464 2064 6972 6563 746c 7920  to add directly 
-00003360: 746f 2063 6378 7420 7379 6e63 2f61 7379  to ccxt sync/asy
-00003370: 6e63 2069 6e69 7469 616c 697a 6174 696f  nc initializatio
-00003380: 6e2e 0a20 2020 2020 2020 2069 6620 7365  n..        if se
-00003390: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
-000033a0: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e4d  == TradingMode.M
-000033b0: 4152 4749 4e3a 0a20 2020 2020 2020 2020  ARGIN:.         
-000033c0: 2020 2072 6574 7572 6e20 7b0a 2020 2020     return {.    
-000033d0: 2020 2020 2020 2020 2020 2020 226f 7074              "opt
-000033e0: 696f 6e73 223a 207b 0a20 2020 2020 2020  ions": {.       
-000033f0: 2020 2020 2020 2020 2020 2020 2022 6465               "de
-00003400: 6661 756c 7454 7970 6522 3a20 226d 6172  faultType": "mar
-00003410: 6769 6e22 0a20 2020 2020 2020 2020 2020  gin".           
-00003420: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-00003430: 2020 207d 0a20 2020 2020 2020 2065 6c69     }.        eli
-00003440: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
-00003450: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
-00003460: 6465 2e46 5554 5552 4553 3a0a 2020 2020  de.FUTURES:.    
-00003470: 2020 2020 2020 2020 7265 7475 726e 207b          return {
-00003480: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003490: 2022 6f70 7469 6f6e 7322 3a20 7b0a 2020   "options": {.  
-000034a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000034b0: 2020 2264 6566 6175 6c74 5479 7065 223a    "defaultType":
-000034c0: 2073 656c 662e 5f66 745f 6861 735b 2263   self._ft_has["c
-000034d0: 6378 745f 6675 7475 7265 735f 6e61 6d65  cxt_futures_name
-000034e0: 225d 0a20 2020 2020 2020 2020 2020 2020  "].             
-000034f0: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00003500: 207d 0a20 2020 2020 2020 2065 6c73 653a   }.        else:
-00003510: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00003520: 7572 6e20 7b7d 0a0a 2020 2020 4070 726f  urn {}..    @pro
-00003530: 7065 7274 790a 2020 2020 6465 6620 6e61  perty.    def na
-00003540: 6d65 2873 656c 6629 202d 3e20 7374 723a  me(self) -> str:
-00003550: 0a20 2020 2020 2020 2022 2222 6578 6368  .        """exch
-00003560: 616e 6765 204e 616d 6520 2866 726f 6d20  ange Name (from 
-00003570: 6363 7874 2922 2222 0a20 2020 2020 2020  ccxt)""".       
-00003580: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
-00003590: 692e 6e61 6d65 0a0a 2020 2020 4070 726f  i.name..    @pro
-000035a0: 7065 7274 790a 2020 2020 6465 6620 6964  perty.    def id
-000035b0: 2873 656c 6629 202d 3e20 7374 723a 0a20  (self) -> str:. 
-000035c0: 2020 2020 2020 2022 2222 6578 6368 616e         """exchan
-000035d0: 6765 2063 6378 7420 6964 2222 220a 2020  ge ccxt id""".  
-000035e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000035f0: 662e 5f61 7069 2e69 640a 0a20 2020 2040  f._api.id..    @
-00003600: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-00003610: 2074 696d 6566 7261 6d65 7328 7365 6c66   timeframes(self
-00003620: 2920 2d3e 204c 6973 745b 7374 725d 3a0a  ) -> List[str]:.
-00003630: 2020 2020 2020 2020 7265 7475 726e 206c          return l
-00003640: 6973 7428 2873 656c 662e 5f61 7069 2e74  ist((self._api.t
-00003650: 696d 6566 7261 6d65 7320 6f72 207b 7d29  imeframes or {})
-00003660: 2e6b 6579 7328 2929 0a0a 2020 2020 4070  .keys())..    @p
-00003670: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00003680: 6d61 726b 6574 7328 7365 6c66 2920 2d3e  markets(self) ->
-00003690: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
-000036a0: 0a20 2020 2020 2020 2022 2222 6578 6368  .        """exch
-000036b0: 616e 6765 2063 6378 7420 6d61 726b 6574  ange ccxt market
-000036c0: 7322 2222 0a20 2020 2020 2020 2069 6620  s""".        if 
-000036d0: 6e6f 7420 7365 6c66 2e5f 6d61 726b 6574  not self._market
-000036e0: 733a 0a20 2020 2020 2020 2020 2020 206c  s:.            l
-000036f0: 6f67 6765 722e 696e 666f 2822 4d61 726b  ogger.info("Mark
-00003700: 6574 7320 7765 7265 206e 6f74 206c 6f61  ets were not loa
-00003710: 6465 642e 204c 6f61 6469 6e67 2074 6865  ded. Loading the
-00003720: 6d20 6e6f 772e 2e22 290a 2020 2020 2020  m now..").      
-00003730: 2020 2020 2020 7365 6c66 2e5f 6c6f 6164        self._load
-00003740: 5f6d 6172 6b65 7473 2829 0a20 2020 2020  _markets().     
-00003750: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
-00003760: 6d61 726b 6574 730a 0a20 2020 2040 7072  markets..    @pr
-00003770: 6f70 6572 7479 0a20 2020 2064 6566 2070  operty.    def p
-00003780: 7265 6369 7369 6f6e 4d6f 6465 2873 656c  recisionMode(sel
-00003790: 6629 202d 3e20 696e 743a 0a20 2020 2020  f) -> int:.     
-000037a0: 2020 2022 2222 6578 6368 616e 6765 2063     """exchange c
-000037b0: 6378 7420 7072 6563 6973 696f 6e4d 6f64  cxt precisionMod
-000037c0: 6522 2222 0a20 2020 2020 2020 2072 6574  e""".        ret
-000037d0: 7572 6e20 7365 6c66 2e5f 6170 692e 7072  urn self._api.pr
-000037e0: 6563 6973 696f 6e4d 6f64 650a 0a20 2020  ecisionMode..   
-000037f0: 2064 6566 2061 6464 6974 696f 6e61 6c5f   def additional_
-00003800: 6578 6368 616e 6765 5f69 6e69 7428 7365  exchange_init(se
-00003810: 6c66 2920 2d3e 204e 6f6e 653a 0a20 2020  lf) -> None:.   
-00003820: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00003830: 2041 6464 6974 696f 6e61 6c20 6578 6368   Additional exch
-00003840: 616e 6765 2069 6e69 7469 616c 697a 6174  ange initializat
-00003850: 696f 6e20 6c6f 6769 632e 0a20 2020 2020  ion logic..     
-00003860: 2020 202e 6170 6920 7769 6c6c 2062 6520     .api will be 
-00003870: 6176 6169 6c61 626c 6520 6174 2074 6869  available at thi
-00003880: 7320 706f 696e 742e 0a20 2020 2020 2020  s point..       
-00003890: 204d 7573 7420 6265 206f 7665 7272 6964   Must be overrid
-000038a0: 6465 6e20 696e 2063 6869 6c64 206d 6574  den in child met
-000038b0: 686f 6473 2069 6620 7265 7175 6972 6564  hods if required
-000038c0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-000038d0: 2020 2020 2020 7061 7373 0a0a 2020 2020        pass..    
-000038e0: 6465 6620 5f6c 6f67 5f65 7863 6861 6e67  def _log_exchang
-000038f0: 655f 7265 7370 6f6e 7365 2873 656c 662c  e_response(self,
-00003900: 2065 6e64 706f 696e 743a 2073 7472 2c20   endpoint: str, 
-00003910: 7265 7370 6f6e 7365 2c20 2a2c 2061 6464  response, *, add
-00003920: 5f69 6e66 6f3d 4e6f 6e65 2920 2d3e 204e  _info=None) -> N
-00003930: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
-00003940: 204c 6f67 2065 7863 6861 6e67 6520 7265   Log exchange re
-00003950: 7370 6f6e 7365 7320 2222 220a 2020 2020  sponses """.    
-00003960: 2020 2020 6966 2073 656c 662e 6c6f 675f      if self.log_
-00003970: 7265 7370 6f6e 7365 733a 0a20 2020 2020  responses:.     
-00003980: 2020 2020 2020 2061 6464 5f69 6e66 6f5f         add_info_
-00003990: 7374 7220 3d20 2222 2069 6620 6164 645f  str = "" if add_
-000039a0: 696e 666f 2069 7320 4e6f 6e65 2065 6c73  info is None els
-000039b0: 6520 6622 207b 6164 645f 696e 666f 7d3a  e f" {add_info}:
-000039c0: 2022 0a20 2020 2020 2020 2020 2020 206c   ".            l
-000039d0: 6f67 6765 722e 696e 666f 2866 2241 5049  ogger.info(f"API
-000039e0: 207b 656e 6470 6f69 6e74 7d3a 207b 6164   {endpoint}: {ad
-000039f0: 645f 696e 666f 5f73 7472 7d7b 7265 7370  d_info_str}{resp
-00003a00: 6f6e 7365 7d22 290a 0a20 2020 2064 6566  onse}")..    def
-00003a10: 206f 686c 6376 5f63 616e 646c 655f 6c69   ohlcv_candle_li
-00003a20: 6d69 7428 0a20 2020 2020 2020 2020 2020  mit(.           
-00003a30: 2073 656c 662c 2074 696d 6566 7261 6d65   self, timeframe
-00003a40: 3a20 7374 722c 2063 616e 646c 655f 7479  : str, candle_ty
-00003a50: 7065 3a20 4361 6e64 6c65 5479 7065 2c20  pe: CandleType, 
-00003a60: 7369 6e63 655f 6d73 3a20 4f70 7469 6f6e  since_ms: Option
-00003a70: 616c 5b69 6e74 5d20 3d20 4e6f 6e65 2920  al[int] = None) 
-00003a80: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-00003a90: 2222 220a 2020 2020 2020 2020 4578 6368  """.        Exch
-00003aa0: 616e 6765 206f 686c 6376 2063 616e 646c  ange ohlcv candl
-00003ab0: 6520 6c69 6d69 740a 2020 2020 2020 2020  e limit.        
-00003ac0: 5573 6573 206f 686c 6376 5f63 616e 646c  Uses ohlcv_candl
-00003ad0: 655f 6c69 6d69 745f 7065 725f 7469 6d65  e_limit_per_time
-00003ae0: 6672 616d 6520 6966 2074 6865 2065 7863  frame if the exc
-00003af0: 6861 6e67 6520 6861 7320 6469 6666 6572  hange has differ
-00003b00: 656e 7420 6c69 6d69 7473 0a20 2020 2020  ent limits.     
-00003b10: 2020 2070 6572 2074 696d 6566 7261 6d65     per timeframe
-00003b20: 2028 652e 672e 2062 6974 7472 6578 292c   (e.g. bittrex),
-00003b30: 206f 7468 6572 7769 7365 2066 616c 6c73   otherwise falls
-00003b40: 2062 6163 6b20 746f 206f 686c 6376 5f63   back to ohlcv_c
-00003b50: 616e 646c 655f 6c69 6d69 740a 2020 2020  andle_limit.    
-00003b60: 2020 2020 544f 444f 3a20 7468 6973 2069      TODO: this i
-00003b70: 7320 6d6f 7374 206c 696b 656c 7920 6e6f  s most likely no
-00003b80: 206c 6f6e 6765 7220 6e65 6564 6564 2073   longer needed s
-00003b90: 696e 6365 206f 6e6c 7920 6269 7474 7265  ince only bittre
-00003ba0: 7820 6e65 6564 6564 2074 6869 732e 0a20  x needed this.. 
-00003bb0: 2020 2020 2020 203a 7061 7261 6d20 7469         :param ti
-00003bc0: 6d65 6672 616d 653a 2054 696d 6566 7261  meframe: Timefra
-00003bd0: 6d65 2074 6f20 6368 6563 6b0a 2020 2020  me to check.    
-00003be0: 2020 2020 3a70 6172 616d 2063 616e 646c      :param candl
-00003bf0: 655f 7479 7065 3a20 4361 6e64 6c65 2d74  e_type: Candle-t
-00003c00: 7970 650a 2020 2020 2020 2020 3a70 6172  ype.        :par
-00003c10: 616d 2073 696e 6365 5f6d 733a 2053 7461  am since_ms: Sta
-00003c20: 7274 696e 6720 7469 6d65 7374 616d 700a  rting timestamp.
-00003c30: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00003c40: 2043 616e 646c 6520 6c69 6d69 7420 6173   Candle limit as
-00003c50: 2069 6e74 6567 6572 0a20 2020 2020 2020   integer.       
-00003c60: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-00003c70: 7572 6e20 696e 7428 7365 6c66 2e5f 6674  urn int(self._ft
-00003c80: 5f68 6173 2e67 6574 2827 6f68 6c63 765f  _has.get('ohlcv_
-00003c90: 6361 6e64 6c65 5f6c 696d 6974 5f70 6572  candle_limit_per
-00003ca0: 5f74 696d 6566 7261 6d65 272c 207b 7d29  _timeframe', {})
-00003cb0: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
-00003cc0: 2020 7469 6d65 6672 616d 652c 2073 656c    timeframe, sel
-00003cd0: 662e 5f66 745f 6861 732e 6765 7428 276f  f._ft_has.get('o
-00003ce0: 686c 6376 5f63 616e 646c 655f 6c69 6d69  hlcv_candle_limi
-00003cf0: 7427 2929 290a 0a20 2020 2064 6566 2067  t')))..    def g
-00003d00: 6574 5f6d 6172 6b65 7473 2873 656c 662c  et_markets(self,
-00003d10: 2062 6173 655f 6375 7272 656e 6369 6573   base_currencies
-00003d20: 3a20 4c69 7374 5b73 7472 5d20 3d20 5b5d  : List[str] = []
-00003d30: 2c20 7175 6f74 655f 6375 7272 656e 6369  , quote_currenci
-00003d40: 6573 3a20 4c69 7374 5b73 7472 5d20 3d20  es: List[str] = 
-00003d50: 5b5d 2c0a 2020 2020 2020 2020 2020 2020  [],.            
-00003d60: 2020 2020 2020 2020 7370 6f74 5f6f 6e6c          spot_onl
-00003d70: 793a 2062 6f6f 6c20 3d20 4661 6c73 652c  y: bool = False,
-00003d80: 206d 6172 6769 6e5f 6f6e 6c79 3a20 626f   margin_only: bo
-00003d90: 6f6c 203d 2046 616c 7365 2c20 6675 7475  ol = False, futu
-00003da0: 7265 735f 6f6e 6c79 3a20 626f 6f6c 203d  res_only: bool =
-00003db0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-00003dc0: 2020 2020 2020 2020 2020 2020 7472 6164              trad
-00003dd0: 6162 6c65 5f6f 6e6c 793a 2062 6f6f 6c20  able_only: bool 
-00003de0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-00003df0: 2020 2020 2020 2020 2020 2020 6163 7469              acti
-00003e00: 7665 5f6f 6e6c 793a 2062 6f6f 6c20 3d20  ve_only: bool = 
-00003e10: 4661 6c73 6529 202d 3e20 4469 6374 5b73  False) -> Dict[s
-00003e20: 7472 2c20 416e 795d 3a0a 2020 2020 2020  tr, Any]:.      
-00003e30: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00003e40: 7475 726e 2065 7863 6861 6e67 6520 6363  turn exchange cc
-00003e50: 7874 206d 6172 6b65 7473 2c20 6669 6c74  xt markets, filt
-00003e60: 6572 6564 206f 7574 2062 7920 6261 7365  ered out by base
-00003e70: 2063 7572 7265 6e63 7920 616e 6420 7175   currency and qu
-00003e80: 6f74 6520 6375 7272 656e 6379 0a20 2020  ote currency.   
-00003e90: 2020 2020 2069 6620 7468 6973 2077 6173       if this was
-00003ea0: 2072 6571 7565 7374 6564 2069 6e20 7061   requested in pa
-00003eb0: 7261 6d65 7465 7273 2e0a 2020 2020 2020  rameters..      
-00003ec0: 2020 2222 220a 2020 2020 2020 2020 6d61    """.        ma
-00003ed0: 726b 6574 7320 3d20 7365 6c66 2e6d 6172  rkets = self.mar
-00003ee0: 6b65 7473 0a20 2020 2020 2020 2069 6620  kets.        if 
-00003ef0: 6e6f 7420 6d61 726b 6574 733a 0a20 2020  not markets:.   
-00003f00: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-00003f10: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-00003f20: 696f 6e28 224d 6172 6b65 7473 2077 6572  ion("Markets wer
-00003f30: 6520 6e6f 7420 6c6f 6164 6564 2e22 290a  e not loaded.").
-00003f40: 0a20 2020 2020 2020 2069 6620 6261 7365  .        if base
-00003f50: 5f63 7572 7265 6e63 6965 733a 0a20 2020  _currencies:.   
-00003f60: 2020 2020 2020 2020 206d 6172 6b65 7473           markets
-00003f70: 203d 207b 6b3a 2076 2066 6f72 206b 2c20   = {k: v for k, 
-00003f80: 7620 696e 206d 6172 6b65 7473 2e69 7465  v in markets.ite
-00003f90: 6d73 2829 2069 6620 765b 2762 6173 6527  ms() if v['base'
-00003fa0: 5d20 696e 2062 6173 655f 6375 7272 656e  ] in base_curren
-00003fb0: 6369 6573 7d0a 2020 2020 2020 2020 6966  cies}.        if
-00003fc0: 2071 756f 7465 5f63 7572 7265 6e63 6965   quote_currencie
-00003fd0: 733a 0a20 2020 2020 2020 2020 2020 206d  s:.            m
-00003fe0: 6172 6b65 7473 203d 207b 6b3a 2076 2066  arkets = {k: v f
-00003ff0: 6f72 206b 2c20 7620 696e 206d 6172 6b65  or k, v in marke
-00004000: 7473 2e69 7465 6d73 2829 2069 6620 765b  ts.items() if v[
-00004010: 2771 756f 7465 275d 2069 6e20 7175 6f74  'quote'] in quot
-00004020: 655f 6375 7272 656e 6369 6573 7d0a 2020  e_currencies}.  
-00004030: 2020 2020 2020 6966 2074 7261 6461 626c        if tradabl
-00004040: 655f 6f6e 6c79 3a0a 2020 2020 2020 2020  e_only:.        
-00004050: 2020 2020 6d61 726b 6574 7320 3d20 7b6b      markets = {k
-00004060: 3a20 7620 666f 7220 6b2c 2076 2069 6e20  : v for k, v in 
-00004070: 6d61 726b 6574 732e 6974 656d 7328 2920  markets.items() 
-00004080: 6966 2073 656c 662e 6d61 726b 6574 5f69  if self.market_i
-00004090: 735f 7472 6164 6162 6c65 2876 297d 0a20  s_tradable(v)}. 
-000040a0: 2020 2020 2020 2069 6620 7370 6f74 5f6f         if spot_o
-000040b0: 6e6c 793a 0a20 2020 2020 2020 2020 2020  nly:.           
-000040c0: 206d 6172 6b65 7473 203d 207b 6b3a 2076   markets = {k: v
-000040d0: 2066 6f72 206b 2c20 7620 696e 206d 6172   for k, v in mar
-000040e0: 6b65 7473 2e69 7465 6d73 2829 2069 6620  kets.items() if 
-000040f0: 7365 6c66 2e6d 6172 6b65 745f 6973 5f73  self.market_is_s
-00004100: 706f 7428 7629 7d0a 2020 2020 2020 2020  pot(v)}.        
-00004110: 6966 206d 6172 6769 6e5f 6f6e 6c79 3a0a  if margin_only:.
-00004120: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
-00004130: 6574 7320 3d20 7b6b 3a20 7620 666f 7220  ets = {k: v for 
-00004140: 6b2c 2076 2069 6e20 6d61 726b 6574 732e  k, v in markets.
-00004150: 6974 656d 7328 2920 6966 2073 656c 662e  items() if self.
-00004160: 6d61 726b 6574 5f69 735f 6d61 7267 696e  market_is_margin
-00004170: 2876 297d 0a20 2020 2020 2020 2069 6620  (v)}.        if 
-00004180: 6675 7475 7265 735f 6f6e 6c79 3a0a 2020  futures_only:.  
-00004190: 2020 2020 2020 2020 2020 6d61 726b 6574            market
-000041a0: 7320 3d20 7b6b 3a20 7620 666f 7220 6b2c  s = {k: v for k,
-000041b0: 2076 2069 6e20 6d61 726b 6574 732e 6974   v in markets.it
-000041c0: 656d 7328 2920 6966 2073 656c 662e 6d61  ems() if self.ma
-000041d0: 726b 6574 5f69 735f 6675 7475 7265 2876  rket_is_future(v
-000041e0: 297d 0a20 2020 2020 2020 2069 6620 6163  )}.        if ac
-000041f0: 7469 7665 5f6f 6e6c 793a 0a20 2020 2020  tive_only:.     
-00004200: 2020 2020 2020 206d 6172 6b65 7473 203d         markets =
-00004210: 207b 6b3a 2076 2066 6f72 206b 2c20 7620   {k: v for k, v 
-00004220: 696e 206d 6172 6b65 7473 2e69 7465 6d73  in markets.items
-00004230: 2829 2069 6620 6d61 726b 6574 5f69 735f  () if market_is_
-00004240: 6163 7469 7665 2876 297d 0a20 2020 2020  active(v)}.     
-00004250: 2020 2072 6574 7572 6e20 6d61 726b 6574     return market
-00004260: 730a 0a20 2020 2064 6566 2067 6574 5f71  s..    def get_q
-00004270: 756f 7465 5f63 7572 7265 6e63 6965 7328  uote_currencies(
-00004280: 7365 6c66 2920 2d3e 204c 6973 745b 7374  self) -> List[st
-00004290: 725d 3a0a 2020 2020 2020 2020 2222 220a  r]:.        """.
-000042a0: 2020 2020 2020 2020 5265 7475 726e 2061          Return a
-000042b0: 206c 6973 7420 6f66 2073 7570 706f 7274   list of support
-000042c0: 6564 2071 756f 7465 2063 7572 7265 6e63  ed quote currenc
-000042d0: 6965 730a 2020 2020 2020 2020 2222 220a  ies.        """.
-000042e0: 2020 2020 2020 2020 6d61 726b 6574 7320          markets 
-000042f0: 3d20 7365 6c66 2e6d 6172 6b65 7473 0a20  = self.markets. 
-00004300: 2020 2020 2020 2072 6574 7572 6e20 736f         return so
-00004310: 7274 6564 2873 6574 285b 785b 2771 756f  rted(set([x['quo
-00004320: 7465 275d 2066 6f72 205f 2c20 7820 696e  te'] for _, x in
-00004330: 206d 6172 6b65 7473 2e69 7465 6d73 2829   markets.items()
-00004340: 5d29 290a 0a20 2020 2064 6566 2067 6574  ]))..    def get
-00004350: 5f70 6169 725f 7175 6f74 655f 6375 7272  _pair_quote_curr
-00004360: 656e 6379 2873 656c 662c 2070 6169 723a  ency(self, pair:
-00004370: 2073 7472 2920 2d3e 2073 7472 3a0a 2020   str) -> str:.  
-00004380: 2020 2020 2020 2222 2220 5265 7475 726e        """ Return
-00004390: 2061 2070 6169 7227 7320 7175 6f74 6520   a pair's quote 
-000043a0: 6375 7272 656e 6379 2028 6261 7365 2f71  currency (base/q
-000043b0: 756f 7465 3a73 6574 746c 656d 656e 7429  uote:settlement)
-000043c0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-000043d0: 7572 6e20 7365 6c66 2e6d 6172 6b65 7473  urn self.markets
-000043e0: 2e67 6574 2870 6169 722c 207b 7d29 2e67  .get(pair, {}).g
-000043f0: 6574 2827 7175 6f74 6527 2c20 2727 290a  et('quote', '').
-00004400: 0a20 2020 2064 6566 2067 6574 5f70 6169  .    def get_pai
-00004410: 725f 6261 7365 5f63 7572 7265 6e63 7928  r_base_currency(
-00004420: 7365 6c66 2c20 7061 6972 3a20 7374 7229  self, pair: str)
-00004430: 202d 3e20 7374 723a 0a20 2020 2020 2020   -> str:.       
-00004440: 2022 2222 2052 6574 7572 6e20 6120 7061   """ Return a pa
-00004450: 6972 2773 2062 6173 6520 6375 7272 656e  ir's base curren
-00004460: 6379 2028 6261 7365 2f71 756f 7465 3a73  cy (base/quote:s
-00004470: 6574 746c 656d 656e 7429 2022 2222 0a20  ettlement) """. 
-00004480: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00004490: 6c66 2e6d 6172 6b65 7473 2e67 6574 2870  lf.markets.get(p
-000044a0: 6169 722c 207b 7d29 2e67 6574 2827 6261  air, {}).get('ba
-000044b0: 7365 272c 2027 2729 0a0a 2020 2020 6465  se', '')..    de
-000044c0: 6620 6d61 726b 6574 5f69 735f 6675 7475  f market_is_futu
-000044d0: 7265 2873 656c 662c 206d 6172 6b65 743a  re(self, market:
-000044e0: 2044 6963 745b 7374 722c 2041 6e79 5d29   Dict[str, Any])
-000044f0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
-00004500: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
-00004510: 2020 2020 2020 206d 6172 6b65 742e 6765         market.ge
-00004520: 7428 7365 6c66 2e5f 6674 5f68 6173 5b22  t(self._ft_has["
-00004530: 6363 7874 5f66 7574 7572 6573 5f6e 616d  ccxt_futures_nam
-00004540: 6522 5d2c 2046 616c 7365 2920 6973 2054  e"], False) is T
-00004550: 7275 6520 616e 640a 2020 2020 2020 2020  rue and.        
-00004560: 2020 2020 6d61 726b 6574 2e67 6574 2827      market.get('
-00004570: 6c69 6e65 6172 272c 2046 616c 7365 2920  linear', False) 
-00004580: 6973 2054 7275 650a 2020 2020 2020 2020  is True.        
-00004590: 290a 0a20 2020 2064 6566 206d 6172 6b65  )..    def marke
-000045a0: 745f 6973 5f73 706f 7428 7365 6c66 2c20  t_is_spot(self, 
-000045b0: 6d61 726b 6574 3a20 4469 6374 5b73 7472  market: Dict[str
-000045c0: 2c20 416e 795d 2920 2d3e 2062 6f6f 6c3a  , Any]) -> bool:
-000045d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000045e0: 6d61 726b 6574 2e67 6574 2827 7370 6f74  market.get('spot
-000045f0: 272c 2046 616c 7365 2920 6973 2054 7275  ', False) is Tru
-00004600: 650a 0a20 2020 2064 6566 206d 6172 6b65  e..    def marke
-00004610: 745f 6973 5f6d 6172 6769 6e28 7365 6c66  t_is_margin(self
-00004620: 2c20 6d61 726b 6574 3a20 4469 6374 5b73  , market: Dict[s
-00004630: 7472 2c20 416e 795d 2920 2d3e 2062 6f6f  tr, Any]) -> boo
-00004640: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
-00004650: 6e20 6d61 726b 6574 2e67 6574 2827 6d61  n market.get('ma
-00004660: 7267 696e 272c 2046 616c 7365 2920 6973  rgin', False) is
-00004670: 2054 7275 650a 0a20 2020 2064 6566 206d   True..    def m
-00004680: 6172 6b65 745f 6973 5f74 7261 6461 626c  arket_is_tradabl
-00004690: 6528 7365 6c66 2c20 6d61 726b 6574 3a20  e(self, market: 
-000046a0: 4469 6374 5b73 7472 2c20 416e 795d 2920  Dict[str, Any]) 
-000046b0: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-000046c0: 2022 2222 0a20 2020 2020 2020 2043 6865   """.        Che
-000046d0: 636b 2069 6620 7468 6520 6d61 726b 6574  ck if the market
-000046e0: 2073 796d 626f 6c20 6973 2074 7261 6461   symbol is trada
-000046f0: 626c 6520 6279 2046 7265 7174 7261 6465  ble by Freqtrade
-00004700: 2e0a 2020 2020 2020 2020 456e 7375 7265  ..        Ensure
-00004710: 7320 7468 6174 2043 6f6e 6669 6775 7265  s that Configure
-00004720: 6420 6d6f 6465 2061 6c69 676e 7320 746f  d mode aligns to
-00004730: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00004740: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
-00004750: 2020 2020 2020 2020 2020 6d61 726b 6574            market
-00004760: 2e67 6574 2827 7175 6f74 6527 2c20 4e6f  .get('quote', No
-00004770: 6e65 2920 6973 206e 6f74 204e 6f6e 650a  ne) is not None.
-00004780: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-00004790: 6d61 726b 6574 2e67 6574 2827 6261 7365  market.get('base
-000047a0: 272c 204e 6f6e 6529 2069 7320 6e6f 7420  ', None) is not 
-000047b0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-000047c0: 2061 6e64 2028 7365 6c66 2e70 7265 6369   and (self.preci
-000047d0: 7369 6f6e 4d6f 6465 2021 3d20 5449 434b  sionMode != TICK
-000047e0: 5f53 495a 450a 2020 2020 2020 2020 2020  _SIZE.          
-000047f0: 2020 2020 2020 2023 2054 6f6f 206c 6f77         # Too low
-00004800: 2070 7265 6369 7369 6f6e 2077 696c 6c20   precision will 
-00004810: 6661 6c73 6966 7920 6361 6c63 756c 6174  falsify calculat
-00004820: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
-00004830: 2020 2020 2020 6f72 206d 6172 6b65 742e        or market.
-00004840: 6765 7428 2770 7265 6369 7369 6f6e 272c  get('precision',
-00004850: 207b 7d29 2e67 6574 2827 7072 6963 6527   {}).get('price'
-00004860: 2920 3e20 3165 2d31 3129 0a20 2020 2020  ) > 1e-11).     
-00004870: 2020 2020 2020 2061 6e64 2028 2873 656c         and ((sel
-00004880: 662e 7472 6164 696e 675f 6d6f 6465 203d  f.trading_mode =
-00004890: 3d20 5472 6164 696e 674d 6f64 652e 5350  = TradingMode.SP
-000048a0: 4f54 2061 6e64 2073 656c 662e 6d61 726b  OT and self.mark
-000048b0: 6574 5f69 735f 7370 6f74 286d 6172 6b65  et_is_spot(marke
-000048c0: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
-000048d0: 2020 2020 206f 7220 2873 656c 662e 7472       or (self.tr
-000048e0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
-000048f0: 6164 696e 674d 6f64 652e 4d41 5247 494e  adingMode.MARGIN
-00004900: 2061 6e64 2073 656c 662e 6d61 726b 6574   and self.market
-00004910: 5f69 735f 6d61 7267 696e 286d 6172 6b65  _is_margin(marke
-00004920: 7429 290a 2020 2020 2020 2020 2020 2020  t)).            
-00004930: 2020 2020 206f 7220 2873 656c 662e 7472       or (self.tr
-00004940: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
-00004950: 6164 696e 674d 6f64 652e 4655 5455 5245  adingMode.FUTURE
-00004960: 5320 616e 6420 7365 6c66 2e6d 6172 6b65  S and self.marke
-00004970: 745f 6973 5f66 7574 7572 6528 6d61 726b  t_is_future(mark
-00004980: 6574 2929 290a 2020 2020 2020 2020 290a  et))).        ).
-00004990: 0a20 2020 2064 6566 206b 6c69 6e65 7328  .    def klines(
-000049a0: 7365 6c66 2c20 7061 6972 5f69 6e74 6572  self, pair_inter
-000049b0: 7661 6c3a 2050 6169 7257 6974 6854 696d  val: PairWithTim
-000049c0: 6566 7261 6d65 2c20 636f 7079 3a20 626f  eframe, copy: bo
-000049d0: 6f6c 203d 2054 7275 6529 202d 3e20 4461  ol = True) -> Da
-000049e0: 7461 4672 616d 653a 0a20 2020 2020 2020  taFrame:.       
-000049f0: 2069 6620 7061 6972 5f69 6e74 6572 7661   if pair_interva
-00004a00: 6c20 696e 2073 656c 662e 5f6b 6c69 6e65  l in self._kline
-00004a10: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
-00004a20: 6574 7572 6e20 7365 6c66 2e5f 6b6c 696e  eturn self._klin
-00004a30: 6573 5b70 6169 725f 696e 7465 7276 616c  es[pair_interval
-00004a40: 5d2e 636f 7079 2829 2069 6620 636f 7079  ].copy() if copy
-00004a50: 2065 6c73 6520 7365 6c66 2e5f 6b6c 696e   else self._klin
-00004a60: 6573 5b70 6169 725f 696e 7465 7276 616c  es[pair_interval
-00004a70: 5d0a 2020 2020 2020 2020 656c 7365 3a0a  ].        else:.
-00004a80: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00004a90: 726e 2044 6174 6146 7261 6d65 2829 0a0a  rn DataFrame()..
-00004aa0: 2020 2020 6465 6620 6765 745f 636f 6e74      def get_cont
-00004ab0: 7261 6374 5f73 697a 6528 7365 6c66 2c20  ract_size(self, 
-00004ac0: 7061 6972 3a20 7374 7229 202d 3e20 4f70  pair: str) -> Op
-00004ad0: 7469 6f6e 616c 5b66 6c6f 6174 5d3a 0a20  tional[float]:. 
-00004ae0: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-00004af0: 7261 6469 6e67 5f6d 6f64 6520 3d3d 2054  rading_mode == T
-00004b00: 7261 6469 6e67 4d6f 6465 2e46 5554 5552  radingMode.FUTUR
-00004b10: 4553 3a0a 2020 2020 2020 2020 2020 2020  ES:.            
-00004b20: 6d61 726b 6574 203d 2073 656c 662e 6d61  market = self.ma
-00004b30: 726b 6574 732e 6765 7428 7061 6972 2c20  rkets.get(pair, 
-00004b40: 7b7d 290a 2020 2020 2020 2020 2020 2020  {}).            
-00004b50: 636f 6e74 7261 6374 5f73 697a 653a 2066  contract_size: f
-00004b60: 6c6f 6174 203d 2031 2e30 0a20 2020 2020  loat = 1.0.     
-00004b70: 2020 2020 2020 2069 6620 6e6f 7420 6d61         if not ma
-00004b80: 726b 6574 3a0a 2020 2020 2020 2020 2020  rket:.          
-00004b90: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00004ba0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
-00004bb0: 206d 6172 6b65 742e 6765 7428 2763 6f6e   market.get('con
-00004bc0: 7472 6163 7453 697a 6527 2920 6973 206e  tractSize') is n
-00004bd0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00004be0: 2020 2020 2020 2020 2023 2063 6378 7420           # ccxt 
-00004bf0: 6861 7320 636f 6e74 7261 6374 5369 7a65  has contractSize
-00004c00: 2069 6e20 6d61 726b 6574 7320 6173 2073   in markets as s
-00004c10: 7472 696e 670a 2020 2020 2020 2020 2020  tring.          
-00004c20: 2020 2020 2020 636f 6e74 7261 6374 5f73        contract_s
-00004c30: 697a 6520 3d20 666c 6f61 7428 6d61 726b  ize = float(mark
-00004c40: 6574 5b27 636f 6e74 7261 6374 5369 7a65  et['contractSize
-00004c50: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-00004c60: 7265 7475 726e 2063 6f6e 7472 6163 745f  return contract_
-00004c70: 7369 7a65 0a20 2020 2020 2020 2065 6c73  size.        els
-00004c80: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00004c90: 6574 7572 6e20 310a 0a20 2020 2064 6566  eturn 1..    def
-00004ca0: 205f 7472 6164 6573 5f63 6f6e 7472 6163   _trades_contrac
-00004cb0: 7473 5f74 6f5f 616d 6f75 6e74 2873 656c  ts_to_amount(sel
-00004cc0: 662c 2074 7261 6465 733a 204c 6973 7429  f, trades: List)
-00004cd0: 202d 3e20 4c69 7374 3a0a 2020 2020 2020   -> List:.      
-00004ce0: 2020 6966 206c 656e 2874 7261 6465 7329    if len(trades)
-00004cf0: 203e 2030 2061 6e64 2027 7379 6d62 6f6c   > 0 and 'symbol
-00004d00: 2720 696e 2074 7261 6465 735b 305d 3a0a  ' in trades[0]:.
-00004d10: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00004d20: 7261 6374 5f73 697a 6520 3d20 7365 6c66  ract_size = self
-00004d30: 2e67 6574 5f63 6f6e 7472 6163 745f 7369  .get_contract_si
-00004d40: 7a65 2874 7261 6465 735b 305d 5b27 7379  ze(trades[0]['sy
-00004d50: 6d62 6f6c 275d 290a 2020 2020 2020 2020  mbol']).        
-00004d60: 2020 2020 6966 2063 6f6e 7472 6163 745f      if contract_
-00004d70: 7369 7a65 2021 3d20 313a 0a20 2020 2020  size != 1:.     
-00004d80: 2020 2020 2020 2020 2020 2066 6f72 2074             for t
-00004d90: 7261 6465 2069 6e20 7472 6164 6573 3a0a  rade in trades:.
-00004da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004db0: 2020 2020 7472 6164 655b 2761 6d6f 756e      trade['amoun
-00004dc0: 7427 5d20 3d20 7472 6164 655b 2761 6d6f  t'] = trade['amo
-00004dd0: 756e 7427 5d20 2a20 636f 6e74 7261 6374  unt'] * contract
-00004de0: 5f73 697a 650a 2020 2020 2020 2020 7265  _size.        re
-00004df0: 7475 726e 2074 7261 6465 730a 0a20 2020  turn trades..   
-00004e00: 2064 6566 205f 6f72 6465 725f 636f 6e74   def _order_cont
-00004e10: 7261 6374 735f 746f 5f61 6d6f 756e 7428  racts_to_amount(
-00004e20: 7365 6c66 2c20 6f72 6465 723a 2044 6963  self, order: Dic
-00004e30: 7429 202d 3e20 4469 6374 3a0a 2020 2020  t) -> Dict:.    
-00004e40: 2020 2020 6966 2027 7379 6d62 6f6c 2720      if 'symbol' 
-00004e50: 696e 206f 7264 6572 2061 6e64 206f 7264  in order and ord
-00004e60: 6572 5b27 7379 6d62 6f6c 275d 2069 7320  er['symbol'] is 
-00004e70: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00004e80: 2020 2020 2020 636f 6e74 7261 6374 5f73        contract_s
-00004e90: 697a 6520 3d20 7365 6c66 2e67 6574 5f63  ize = self.get_c
-00004ea0: 6f6e 7472 6163 745f 7369 7a65 286f 7264  ontract_size(ord
-00004eb0: 6572 5b27 7379 6d62 6f6c 275d 290a 2020  er['symbol']).  
-00004ec0: 2020 2020 2020 2020 2020 6966 2063 6f6e            if con
-00004ed0: 7472 6163 745f 7369 7a65 2021 3d20 313a  tract_size != 1:
-00004ee0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004ef0: 2066 6f72 2070 726f 7020 696e 2073 656c   for prop in sel
-00004f00: 662e 5f66 745f 6861 732e 6765 7428 276f  f._ft_has.get('o
-00004f10: 7264 6572 5f70 726f 7073 5f69 6e5f 636f  rder_props_in_co
-00004f20: 6e74 7261 6374 7327 2c20 5b5d 293a 0a20  ntracts', []):. 
-00004f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004f40: 2020 2069 6620 7072 6f70 2069 6e20 6f72     if prop in or
-00004f50: 6465 7220 616e 6420 6f72 6465 725b 7072  der and order[pr
-00004f60: 6f70 5d20 6973 206e 6f74 204e 6f6e 653a  op] is not None:
-00004f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004f80: 2020 2020 2020 2020 206f 7264 6572 5b70           order[p
-00004f90: 726f 705d 203d 206f 7264 6572 5b70 726f  rop] = order[pro
-00004fa0: 705d 202a 2063 6f6e 7472 6163 745f 7369  p] * contract_si
-00004fb0: 7a65 0a20 2020 2020 2020 2072 6574 7572  ze.        retur
-00004fc0: 6e20 6f72 6465 720a 0a20 2020 2064 6566  n order..    def
-00004fd0: 205f 616d 6f75 6e74 5f74 6f5f 636f 6e74   _amount_to_cont
-00004fe0: 7261 6374 7328 7365 6c66 2c20 7061 6972  racts(self, pair
-00004ff0: 3a20 7374 722c 2061 6d6f 756e 743a 2066  : str, amount: f
-00005000: 6c6f 6174 2920 2d3e 2066 6c6f 6174 3a0a  loat) -> float:.
-00005010: 0a20 2020 2020 2020 2063 6f6e 7472 6163  .        contrac
-00005020: 745f 7369 7a65 203d 2073 656c 662e 6765  t_size = self.ge
-00005030: 745f 636f 6e74 7261 6374 5f73 697a 6528  t_contract_size(
-00005040: 7061 6972 290a 2020 2020 2020 2020 7265  pair).        re
-00005050: 7475 726e 2061 6d6f 756e 745f 746f 5f63  turn amount_to_c
-00005060: 6f6e 7472 6163 7473 2861 6d6f 756e 742c  ontracts(amount,
-00005070: 2063 6f6e 7472 6163 745f 7369 7a65 290a   contract_size).
-00005080: 0a20 2020 2064 6566 205f 636f 6e74 7261  .    def _contra
-00005090: 6374 735f 746f 5f61 6d6f 756e 7428 7365  cts_to_amount(se
-000050a0: 6c66 2c20 7061 6972 3a20 7374 722c 206e  lf, pair: str, n
-000050b0: 756d 5f63 6f6e 7472 6163 7473 3a20 666c  um_contracts: fl
-000050c0: 6f61 7429 202d 3e20 666c 6f61 743a 0a0a  oat) -> float:..
-000050d0: 2020 2020 2020 2020 636f 6e74 7261 6374          contract
-000050e0: 5f73 697a 6520 3d20 7365 6c66 2e67 6574  _size = self.get
-000050f0: 5f63 6f6e 7472 6163 745f 7369 7a65 2870  _contract_size(p
-00005100: 6169 7229 0a20 2020 2020 2020 2072 6574  air).        ret
-00005110: 7572 6e20 636f 6e74 7261 6374 735f 746f  urn contracts_to
-00005120: 5f61 6d6f 756e 7428 6e75 6d5f 636f 6e74  _amount(num_cont
-00005130: 7261 6374 732c 2063 6f6e 7472 6163 745f  racts, contract_
-00005140: 7369 7a65 290a 0a20 2020 2064 6566 2061  size)..    def a
-00005150: 6d6f 756e 745f 746f 5f63 6f6e 7472 6163  mount_to_contrac
-00005160: 745f 7072 6563 6973 696f 6e28 7365 6c66  t_precision(self
-00005170: 2c20 7061 6972 3a20 7374 722c 2061 6d6f  , pair: str, amo
-00005180: 756e 743a 2066 6c6f 6174 2920 2d3e 2066  unt: float) -> f
-00005190: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
-000051a0: 220a 2020 2020 2020 2020 4865 6c70 6572  ".        Helper
-000051b0: 2077 7261 7070 6572 2061 726f 756e 6420   wrapper around 
-000051c0: 616d 6f75 6e74 5f74 6f5f 636f 6e74 7261  amount_to_contra
-000051d0: 6374 5f70 7265 6369 7369 6f6e 0a20 2020  ct_precision.   
-000051e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000051f0: 2063 6f6e 7472 6163 745f 7369 7a65 203d   contract_size =
-00005200: 2073 656c 662e 6765 745f 636f 6e74 7261   self.get_contra
-00005210: 6374 5f73 697a 6528 7061 6972 290a 0a20  ct_size(pair).. 
-00005220: 2020 2020 2020 2072 6574 7572 6e20 616d         return am
-00005230: 6f75 6e74 5f74 6f5f 636f 6e74 7261 6374  ount_to_contract
-00005240: 5f70 7265 6369 7369 6f6e 2861 6d6f 756e  _precision(amoun
-00005250: 742c 2073 656c 662e 6765 745f 7072 6563  t, self.get_prec
-00005260: 6973 696f 6e5f 616d 6f75 6e74 2870 6169  ision_amount(pai
-00005270: 7229 2c0a 2020 2020 2020 2020 2020 2020  r),.            
-00005280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052a0: 7365 6c66 2e70 7265 6369 7369 6f6e 4d6f  self.precisionMo
-000052b0: 6465 2c20 636f 6e74 7261 6374 5f73 697a  de, contract_siz
-000052c0: 6529 0a0a 2020 2020 6465 6620 5f6c 6f61  e)..    def _loa
-000052d0: 645f 6173 796e 635f 6d61 726b 6574 7328  d_async_markets(
-000052e0: 7365 6c66 2c20 7265 6c6f 6164 3a20 626f  self, reload: bo
-000052f0: 6f6c 203d 2046 616c 7365 2920 2d3e 204e  ol = False) -> N
-00005300: 6f6e 653a 0a20 2020 2020 2020 2074 7279  one:.        try
-00005310: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00005320: 2073 656c 662e 5f61 7069 5f61 7379 6e63   self._api_async
-00005330: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00005340: 2020 7365 6c66 2e6c 6f6f 702e 7275 6e5f    self.loop.run_
-00005350: 756e 7469 6c5f 636f 6d70 6c65 7465 280a  until_complete(.
-00005360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005370: 2020 2020 7365 6c66 2e5f 6170 695f 6173      self._api_as
-00005380: 796e 632e 6c6f 6164 5f6d 6172 6b65 7473  ync.load_markets
-00005390: 2872 656c 6f61 643d 7265 6c6f 6164 2c20  (reload=reload, 
-000053a0: 7061 7261 6d73 3d7b 7d29 290a 0a20 2020  params={}))..   
-000053b0: 2020 2020 2065 7863 6570 7420 2861 7379       except (asy
-000053c0: 6e63 696f 2e54 696d 656f 7574 4572 726f  ncio.TimeoutErro
-000053d0: 722c 2063 6378 742e 4261 7365 4572 726f  r, ccxt.BaseErro
-000053e0: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-000053f0: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
-00005400: 696e 6728 2743 6f75 6c64 206e 6f74 206c  ing('Could not l
-00005410: 6f61 6420 6173 796e 6320 6d61 726b 6574  oad async market
-00005420: 732e 2052 6561 736f 6e3a 2025 7327 2c20  s. Reason: %s', 
-00005430: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
-00005440: 6574 7572 6e0a 0a20 2020 2064 6566 205f  eturn..    def _
-00005450: 6c6f 6164 5f6d 6172 6b65 7473 2873 656c  load_markets(sel
-00005460: 6629 202d 3e20 4e6f 6e65 3a0a 2020 2020  f) -> None:.    
-00005470: 2020 2020 2222 2220 496e 6974 6961 6c69      """ Initiali
-00005480: 7a65 206d 6172 6b65 7473 2062 6f74 6820  ze markets both 
-00005490: 7379 6e63 2061 6e64 2061 7379 6e63 2022  sync and async "
-000054a0: 2222 0a20 2020 2020 2020 2074 7279 3a0a  "".        try:.
-000054b0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000054c0: 2e5f 6d61 726b 6574 7320 3d20 7365 6c66  ._markets = self
-000054d0: 2e5f 6170 692e 6c6f 6164 5f6d 6172 6b65  ._api.load_marke
-000054e0: 7473 2870 6172 616d 733d 7b7d 290a 2020  ts(params={}).  
-000054f0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00005500: 6c6f 6164 5f61 7379 6e63 5f6d 6172 6b65  load_async_marke
-00005510: 7473 2829 0a20 2020 2020 2020 2020 2020  ts().           
-00005520: 2073 656c 662e 5f6c 6173 745f 6d61 726b   self._last_mark
-00005530: 6574 735f 7265 6672 6573 6820 3d20 6474  ets_refresh = dt
-00005540: 5f74 7328 290a 2020 2020 2020 2020 2020  _ts().          
-00005550: 2020 6966 2073 656c 662e 5f66 745f 6861    if self._ft_ha
-00005560: 735b 276e 6565 6473 5f74 7261 6469 6e67  s['needs_trading
-00005570: 5f66 6565 7327 5d3a 0a20 2020 2020 2020  _fees']:.       
-00005580: 2020 2020 2020 2020 2073 656c 662e 5f74           self._t
-00005590: 7261 6469 6e67 5f66 6565 7320 3d20 7365  rading_fees = se
-000055a0: 6c66 2e66 6574 6368 5f74 7261 6469 6e67  lf.fetch_trading
-000055b0: 5f66 6565 7328 290a 0a20 2020 2020 2020  _fees()..       
-000055c0: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-000055d0: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-000055e0: 2020 2020 6c6f 6767 6572 2e65 7863 6570      logger.excep
-000055f0: 7469 6f6e 2827 556e 6162 6c65 2074 6f20  tion('Unable to 
-00005600: 696e 6974 6961 6c69 7a65 206d 6172 6b65  initialize marke
-00005610: 7473 2e27 290a 0a20 2020 2064 6566 2072  ts.')..    def r
-00005620: 656c 6f61 645f 6d61 726b 6574 7328 7365  eload_markets(se
-00005630: 6c66 2c20 666f 7263 653a 2062 6f6f 6c20  lf, force: bool 
-00005640: 3d20 4661 6c73 6529 202d 3e20 4e6f 6e65  = False) -> None
-00005650: 3a0a 2020 2020 2020 2020 2222 2252 656c  :.        """Rel
-00005660: 6f61 6420 6d61 726b 6574 7320 626f 7468  oad markets both
-00005670: 2073 796e 6320 616e 6420 6173 796e 6320   sync and async 
-00005680: 6966 2072 6566 7265 7368 2069 6e74 6572  if refresh inter
-00005690: 7661 6c20 6861 7320 7061 7373 6564 2022  val has passed "
-000056a0: 2222 0a20 2020 2020 2020 2023 2043 6865  "".        # Che
-000056b0: 636b 2077 6865 7468 6572 206d 6172 6b65  ck whether marke
-000056c0: 7473 2068 6176 6520 746f 2062 6520 7265  ts have to be re
-000056d0: 6c6f 6164 6564 0a20 2020 2020 2020 2069  loaded.        i
-000056e0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-000056f0: 6e6f 7420 666f 7263 650a 2020 2020 2020  not force.      
-00005700: 2020 2020 2020 616e 6420 7365 6c66 2e5f        and self._
-00005710: 6c61 7374 5f6d 6172 6b65 7473 5f72 6566  last_markets_ref
-00005720: 7265 7368 203e 2030 0a20 2020 2020 2020  resh > 0.       
-00005730: 2020 2020 2061 6e64 2028 7365 6c66 2e5f       and (self._
-00005740: 6c61 7374 5f6d 6172 6b65 7473 5f72 6566  last_markets_ref
-00005750: 7265 7368 202b 2073 656c 662e 6d61 726b  resh + self.mark
-00005760: 6574 735f 7265 6672 6573 685f 696e 7465  ets_refresh_inte
-00005770: 7276 616c 203e 2064 745f 7473 2829 290a  rval > dt_ts()).
-00005780: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-00005790: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-000057a0: 6e65 0a20 2020 2020 2020 206c 6f67 6765  ne.        logge
-000057b0: 722e 6465 6275 6728 2250 6572 666f 726d  r.debug("Perform
-000057c0: 696e 6720 7363 6865 6475 6c65 6420 6d61  ing scheduled ma
-000057d0: 726b 6574 2072 656c 6f61 642e 2e22 290a  rket reload..").
-000057e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000057f0: 2020 2020 2020 2020 2073 656c 662e 5f6d           self._m
-00005800: 6172 6b65 7473 203d 2073 656c 662e 5f61  arkets = self._a
-00005810: 7069 2e6c 6f61 645f 6d61 726b 6574 7328  pi.load_markets(
-00005820: 7265 6c6f 6164 3d54 7275 652c 2070 6172  reload=True, par
-00005830: 616d 733d 7b7d 290a 2020 2020 2020 2020  ams={}).        
-00005840: 2020 2020 2320 416c 736f 2072 656c 6f61      # Also reloa
-00005850: 6420 6173 796e 6320 6d61 726b 6574 7320  d async markets 
-00005860: 746f 2061 766f 6964 2069 7373 7565 7320  to avoid issues 
-00005870: 7769 7468 206e 6577 6c79 206c 6973 7465  with newly liste
-00005880: 6420 7061 6972 730a 2020 2020 2020 2020  d pairs.        
-00005890: 2020 2020 7365 6c66 2e5f 6c6f 6164 5f61      self._load_a
-000058a0: 7379 6e63 5f6d 6172 6b65 7473 2872 656c  sync_markets(rel
-000058b0: 6f61 643d 5472 7565 290a 2020 2020 2020  oad=True).      
-000058c0: 2020 2020 2020 7365 6c66 2e5f 6c61 7374        self._last
-000058d0: 5f6d 6172 6b65 7473 5f72 6566 7265 7368  _markets_refresh
-000058e0: 203d 2064 745f 7473 2829 0a20 2020 2020   = dt_ts().     
-000058f0: 2020 2020 2020 2073 656c 662e 6669 6c6c         self.fill
-00005900: 5f6c 6576 6572 6167 655f 7469 6572 7328  _leverage_tiers(
-00005910: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-00005920: 2063 6378 742e 4261 7365 4572 726f 723a   ccxt.BaseError:
-00005930: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
-00005940: 6765 722e 6578 6365 7074 696f 6e28 2243  ger.exception("C
-00005950: 6f75 6c64 206e 6f74 2072 656c 6f61 6420  ould not reload 
-00005960: 6d61 726b 6574 732e 2229 0a0a 2020 2020  markets.")..    
-00005970: 6465 6620 7661 6c69 6461 7465 5f73 7461  def validate_sta
-00005980: 6b65 6375 7272 656e 6379 2873 656c 662c  kecurrency(self,
-00005990: 2073 7461 6b65 5f63 7572 7265 6e63 793a   stake_currency:
-000059a0: 2073 7472 2920 2d3e 204e 6f6e 653a 0a20   str) -> None:. 
-000059b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000059c0: 2020 2043 6865 636b 7320 7374 616b 652d     Checks stake-
-000059d0: 6375 7272 656e 6379 2061 6761 696e 7374  currency against
-000059e0: 2061 7661 696c 6162 6c65 2063 7572 7265   available curre
-000059f0: 6e63 6965 7320 6f6e 2074 6865 2065 7863  ncies on the exc
-00005a00: 6861 6e67 652e 0a20 2020 2020 2020 204f  hange..        O
-00005a10: 6e6c 7920 7275 6e73 206f 6e20 7374 6172  nly runs on star
-00005a20: 7475 702e 2049 6620 6d61 726b 6574 7320  tup. If markets 
-00005a30: 6861 7665 206e 6f74 2062 6565 6e20 6c6f  have not been lo
-00005a40: 6164 6564 2c20 7468 6572 6527 7320 6265  aded, there's be
-00005a50: 656e 2061 2070 726f 626c 656d 2077 6974  en a problem wit
-00005a60: 680a 2020 2020 2020 2020 7468 6520 636f  h.        the co
-00005a70: 6e6e 6563 7469 6f6e 2074 6f20 7468 6520  nnection to the 
-00005a80: 6578 6368 616e 6765 2e0a 2020 2020 2020  exchange..      
-00005a90: 2020 3a70 6172 616d 2073 7461 6b65 5f63    :param stake_c
-00005aa0: 7572 7265 6e63 793a 2053 7461 6b65 2d63  urrency: Stake-c
-00005ab0: 7572 7265 6e63 7920 746f 2076 616c 6964  urrency to valid
-00005ac0: 6174 650a 2020 2020 2020 2020 3a72 6169  ate.        :rai
-00005ad0: 7365 3a20 4f70 6572 6174 696f 6e61 6c45  se: OperationalE
-00005ae0: 7863 6570 7469 6f6e 2069 6620 7374 616b  xception if stak
-00005af0: 652d 6375 7272 656e 6379 2069 7320 6e6f  e-currency is no
-00005b00: 7420 6176 6169 6c61 626c 652e 0a20 2020  t available..   
-00005b10: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00005b20: 2069 6620 6e6f 7420 7365 6c66 2e5f 6d61   if not self._ma
-00005b30: 726b 6574 733a 0a20 2020 2020 2020 2020  rkets:.         
-00005b40: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00005b50: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
-00005b60: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00005b70: 436f 756c 6420 6e6f 7420 6c6f 6164 206d  Could not load m
-00005b80: 6172 6b65 7473 2c20 7468 6572 6566 6f72  arkets, therefor
-00005b90: 6520 6361 6e6e 6f74 2073 7461 7274 2e20  e cannot start. 
-00005ba0: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00005bb0: 2020 2750 6c65 6173 6520 696e 7665 7374    'Please invest
-00005bc0: 6967 6174 6520 7468 6520 6162 6f76 6520  igate the above 
-00005bd0: 6572 726f 7220 666f 7220 6d6f 7265 2064  error for more d
-00005be0: 6574 6169 6c73 2e27 0a20 2020 2020 2020  etails.'.       
-00005bf0: 2020 2020 2029 0a20 2020 2020 2020 2071       ).        q
-00005c00: 756f 7465 5f63 7572 7265 6e63 6965 7320  uote_currencies 
-00005c10: 3d20 7365 6c66 2e67 6574 5f71 756f 7465  = self.get_quote
-00005c20: 5f63 7572 7265 6e63 6965 7328 290a 2020  _currencies().  
-00005c30: 2020 2020 2020 6966 2073 7461 6b65 5f63        if stake_c
-00005c40: 7572 7265 6e63 7920 6e6f 7420 696e 2071  urrency not in q
-00005c50: 756f 7465 5f63 7572 7265 6e63 6965 733a  uote_currencies:
-00005c60: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00005c70: 7365 2043 6f6e 6669 6775 7261 7469 6f6e  se Configuration
-00005c80: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00005c90: 2020 2020 2020 2066 227b 7374 616b 655f         f"{stake_
-00005ca0: 6375 7272 656e 6379 7d20 6973 206e 6f74  currency} is not
-00005cb0: 2061 7661 696c 6162 6c65 2061 7320 7374   available as st
-00005cc0: 616b 6520 6f6e 207b 7365 6c66 2e6e 616d  ake on {self.nam
-00005cd0: 657d 2e20 220a 2020 2020 2020 2020 2020  e}. ".          
-00005ce0: 2020 2020 2020 6622 4176 6169 6c61 626c        f"Availabl
-00005cf0: 6520 6375 7272 656e 6369 6573 2061 7265  e currencies are
-00005d00: 3a20 7b27 2c20 272e 6a6f 696e 2871 756f  : {', '.join(quo
-00005d10: 7465 5f63 7572 7265 6e63 6965 7329 7d22  te_currencies)}"
-00005d20: 290a 0a20 2020 2064 6566 2076 616c 6964  )..    def valid
-00005d30: 6174 655f 7061 6972 7328 7365 6c66 2c20  ate_pairs(self, 
-00005d40: 7061 6972 733a 204c 6973 745b 7374 725d  pairs: List[str]
-00005d50: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
-00005d60: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-00005d70: 6865 636b 7320 6966 2061 6c6c 2067 6976  hecks if all giv
-00005d80: 656e 2070 6169 7273 2061 7265 2074 7261  en pairs are tra
-00005d90: 6461 626c 6520 6f6e 2074 6865 2063 7572  dable on the cur
-00005da0: 7265 6e74 2065 7863 6861 6e67 652e 0a20  rent exchange.. 
-00005db0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-00005dc0: 6972 733a 206c 6973 7420 6f66 2070 6169  irs: list of pai
-00005dd0: 7273 0a20 2020 2020 2020 203a 7261 6973  rs.        :rais
-00005de0: 653a 204f 7065 7261 7469 6f6e 616c 4578  e: OperationalEx
-00005df0: 6365 7074 696f 6e20 6966 206f 6e65 2070  ception if one p
-00005e00: 6169 7220 6973 206e 6f74 2061 7661 696c  air is not avail
-00005e10: 6162 6c65 0a20 2020 2020 2020 203a 7265  able.        :re
-00005e20: 7475 726e 3a20 4e6f 6e65 0a20 2020 2020  turn: None.     
-00005e30: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00005e40: 6966 206e 6f74 2073 656c 662e 6d61 726b  if not self.mark
-00005e50: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-00005e60: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-00005e70: 2755 6e61 626c 6520 746f 2076 616c 6964  'Unable to valid
-00005e80: 6174 6520 7061 6972 7320 2861 7373 756d  ate pairs (assum
-00005e90: 696e 6720 7468 6579 2061 7265 2063 6f72  ing they are cor
-00005ea0: 7265 6374 292e 2729 0a20 2020 2020 2020  rect).').       
-00005eb0: 2020 2020 2072 6574 7572 6e0a 2020 2020       return.    
-00005ec0: 2020 2020 6578 7465 6e64 6564 5f70 6169      extended_pai
-00005ed0: 7273 203d 2065 7870 616e 645f 7061 6972  rs = expand_pair
-00005ee0: 6c69 7374 2870 6169 7273 2c20 6c69 7374  list(pairs, list
-00005ef0: 2873 656c 662e 6d61 726b 6574 7329 2c20  (self.markets), 
-00005f00: 6b65 6570 5f69 6e76 616c 6964 3d54 7275  keep_invalid=Tru
-00005f10: 6529 0a20 2020 2020 2020 2069 6e76 616c  e).        inval
-00005f20: 6964 5f70 6169 7273 203d 205b 5d0a 2020  id_pairs = [].  
-00005f30: 2020 2020 2020 666f 7220 7061 6972 2069        for pair i
-00005f40: 6e20 6578 7465 6e64 6564 5f70 6169 7273  n extended_pairs
-00005f50: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-00005f60: 4e6f 7465 3a20 6363 7874 2068 6173 2042  Note: ccxt has B
-00005f70: 6173 6543 7572 7265 6e63 792f 5175 6f74  aseCurrency/Quot
-00005f80: 6543 7572 7265 6e63 7920 666f 726d 6174  eCurrency format
-00005f90: 2066 6f72 2070 6169 7273 0a20 2020 2020   for pairs.     
-00005fa0: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
-00005fb0: 6172 6b65 7473 2061 6e64 2070 6169 7220  arkets and pair 
-00005fc0: 6e6f 7420 696e 2073 656c 662e 6d61 726b  not in self.mark
-00005fd0: 6574 733a 0a20 2020 2020 2020 2020 2020  ets:.           
-00005fe0: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-00005ff0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-00006000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006010: 2020 2020 2066 2750 6169 7220 7b70 6169       f'Pair {pai
-00006020: 727d 2069 7320 6e6f 7420 6176 6169 6c61  r} is not availa
-00006030: 626c 6520 6f6e 207b 7365 6c66 2e6e 616d  ble on {self.nam
-00006040: 657d 207b 7365 6c66 2e74 7261 6469 6e67  e} {self.trading
-00006050: 5f6d 6f64 652e 7661 6c75 657d 2e20 270a  _mode.value}. '.
-00006060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006070: 2020 2020 6627 506c 6561 7365 2072 656d      f'Please rem
-00006080: 6f76 6520 7b70 6169 727d 2066 726f 6d20  ove {pair} from 
-00006090: 796f 7572 2077 6869 7465 6c69 7374 2e27  your whitelist.'
-000060a0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-000060b0: 2020 2023 2046 726f 6d20 6363 7874 2044     # From ccxt D
-000060c0: 6f63 756d 656e 7461 7469 6f6e 3a0a 2020  ocumentation:.  
-000060d0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000060e0: 6d61 726b 6574 732e 696e 666f 3a20 416e  markets.info: An
-000060f0: 2061 7373 6f63 6961 7469 7665 2061 7272   associative arr
-00006100: 6179 206f 6620 6e6f 6e2d 636f 6d6d 6f6e  ay of non-common
-00006110: 206d 6172 6b65 7420 7072 6f70 6572 7469   market properti
-00006120: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
-00006130: 2020 2020 2320 696e 636c 7564 696e 6720      # including 
-00006140: 6665 6573 2c20 7261 7465 732c 206c 696d  fees, rates, lim
-00006150: 6974 7320 616e 6420 6f74 6865 7220 6765  its and other ge
-00006160: 6e65 7261 6c20 6d61 726b 6574 2069 6e66  neral market inf
-00006170: 6f72 6d61 7469 6f6e 2e0a 2020 2020 2020  ormation..      
-00006180: 2020 2020 2020 2020 2020 2320 5468 6520            # The 
-00006190: 696e 7465 726e 616c 2069 6e66 6f20 6172  internal info ar
-000061a0: 7261 7920 6973 2064 6966 6665 7265 6e74  ray is different
-000061b0: 2066 6f72 2065 6163 6820 7061 7274 6963   for each partic
-000061c0: 756c 6172 206d 6172 6b65 742c 0a20 2020  ular market,.   
-000061d0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
-000061e0: 7473 2063 6f6e 7465 6e74 7320 6465 7065  ts contents depe
-000061f0: 6e64 206f 6e20 7468 6520 6578 6368 616e  nd on the exchan
-00006200: 6765 2e0a 2020 2020 2020 2020 2020 2020  ge..            
-00006210: 2020 2020 2320 4974 2063 616e 2061 6c73      # It can als
-00006220: 6f20 6265 2061 2073 7472 696e 6720 6f72  o be a string or
-00006230: 2073 696d 696c 6172 202e 2e2e 2073 6f20   similar ... so 
-00006240: 7765 206e 6565 6420 746f 2076 6572 6966  we need to verif
-00006250: 7920 7468 6174 2066 6972 7374 2e0a 2020  y that first..  
-00006260: 2020 2020 2020 2020 2020 656c 6966 2028            elif (
-00006270: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
-00006280: 6d61 726b 6574 735b 7061 6972 5d2e 6765  markets[pair].ge
-00006290: 7428 2769 6e66 6f27 292c 2064 6963 7429  t('info'), dict)
-000062a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000062b0: 2020 2061 6e64 2073 656c 662e 6d61 726b     and self.mark
-000062c0: 6574 735b 7061 6972 5d2e 6765 7428 2769  ets[pair].get('i
-000062d0: 6e66 6f27 2c20 7b7d 292e 6765 7428 2770  nfo', {}).get('p
-000062e0: 726f 6869 6269 7465 6449 6e27 2c20 4661  rohibitedIn', Fa
-000062f0: 6c73 6529 293a 0a20 2020 2020 2020 2020  lse)):.         
-00006300: 2020 2020 2020 2023 2057 6172 6e20 7573         # Warn us
-00006310: 6572 7320 6162 6f75 7420 7265 7374 7269  ers about restri
-00006320: 6374 6564 2070 6169 7273 2069 6e20 7768  cted pairs in wh
-00006330: 6974 656c 6973 742e 0a20 2020 2020 2020  itelist..       
-00006340: 2020 2020 2020 2020 2023 2057 6520 6361           # We ca
-00006350: 6e6e 6f74 2064 6574 6572 6d69 6e65 2072  nnot determine r
-00006360: 656c 6961 626c 7920 6966 2055 7365 7273  eliably if Users
-00006370: 2061 7265 2061 6666 6563 7465 642e 0a20   are affected.. 
-00006380: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00006390: 6f67 6765 722e 7761 726e 696e 6728 6622  ogger.warning(f"
-000063a0: 5061 6972 207b 7061 6972 7d20 6973 2072  Pair {pair} is r
-000063b0: 6573 7472 6963 7465 6420 666f 7220 736f  estricted for so
-000063c0: 6d65 2075 7365 7273 206f 6e20 7468 6973  me users on this
-000063d0: 2065 7863 6861 6e67 652e 220a 2020 2020   exchange.".    
-000063e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000063f0: 2020 2020 2020 2020 2020 2066 2250 6c65             f"Ple
-00006400: 6173 6520 6368 6563 6b20 6966 2079 6f75  ase check if you
-00006410: 2061 7265 2069 6d70 6163 7465 6420 6279   are impacted by
-00006420: 2074 6869 7320 7265 7374 7269 6374 696f   this restrictio
-00006430: 6e20 220a 2020 2020 2020 2020 2020 2020  n ".            
-00006440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006450: 2020 2066 226f 6e20 7468 6520 6578 6368     f"on the exch
-00006460: 616e 6765 2061 6e64 2065 7665 6e74 7561  ange and eventua
-00006470: 6c6c 7920 7265 6d6f 7665 207b 7061 6972  lly remove {pair
-00006480: 7d20 6672 6f6d 2079 6f75 7220 7768 6974  } from your whit
-00006490: 656c 6973 742e 2229 0a20 2020 2020 2020  elist.").       
-000064a0: 2020 2020 2069 6620 2873 656c 662e 5f63       if (self._c
-000064b0: 6f6e 6669 675b 2773 7461 6b65 5f63 7572  onfig['stake_cur
-000064c0: 7265 6e63 7927 5d20 616e 640a 2020 2020  rency'] and.    
-000064d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000064e0: 7365 6c66 2e67 6574 5f70 6169 725f 7175  self.get_pair_qu
-000064f0: 6f74 655f 6375 7272 656e 6379 2870 6169  ote_currency(pai
-00006500: 7229 2021 3d20 7365 6c66 2e5f 636f 6e66  r) != self._conf
-00006510: 6967 5b27 7374 616b 655f 6375 7272 656e  ig['stake_curren
-00006520: 6379 275d 293a 0a20 2020 2020 2020 2020  cy']):.         
-00006530: 2020 2020 2020 2069 6e76 616c 6964 5f70         invalid_p
-00006540: 6169 7273 2e61 7070 656e 6428 7061 6972  airs.append(pair
-00006550: 290a 2020 2020 2020 2020 6966 2069 6e76  ).        if inv
-00006560: 616c 6964 5f70 6169 7273 3a0a 2020 2020  alid_pairs:.    
-00006570: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-00006580: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-00006590: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-000065a0: 2020 2020 6622 5374 616b 652d 6375 7272      f"Stake-curr
-000065b0: 656e 6379 2027 7b73 656c 662e 5f63 6f6e  ency '{self._con
-000065c0: 6669 675b 2773 7461 6b65 5f63 7572 7265  fig['stake_curre
-000065d0: 6e63 7927 5d7d 2720 6e6f 7420 636f 6d70  ncy']}' not comp
-000065e0: 6174 6962 6c65 2077 6974 6820 220a 2020  atible with ".  
-000065f0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00006600: 7061 6972 2d77 6869 7465 6c69 7374 2e20  pair-whitelist. 
-00006610: 506c 6561 7365 2072 656d 6f76 6520 7468  Please remove th
-00006620: 6520 666f 6c6c 6f77 696e 6720 7061 6972  e following pair
-00006630: 733a 207b 696e 7661 6c69 645f 7061 6972  s: {invalid_pair
-00006640: 737d 2229 0a0a 2020 2020 6465 6620 6765  s}")..    def ge
-00006650: 745f 7661 6c69 645f 7061 6972 5f63 6f6d  t_valid_pair_com
-00006660: 6269 6e61 7469 6f6e 2873 656c 662c 2063  bination(self, c
-00006670: 7572 725f 313a 2073 7472 2c20 6375 7272  urr_1: str, curr
-00006680: 5f32 3a20 7374 7229 202d 3e20 7374 723a  _2: str) -> str:
-00006690: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000066a0: 2020 2020 2047 6574 2076 616c 6964 2070       Get valid p
-000066b0: 6169 7220 636f 6d62 696e 6174 696f 6e20  air combination 
-000066c0: 6f66 2063 7572 725f 3120 616e 6420 6375  of curr_1 and cu
-000066d0: 7272 5f32 2062 7920 7472 7969 6e67 2062  rr_2 by trying b
-000066e0: 6f74 6820 636f 6d62 696e 6174 696f 6e73  oth combinations
-000066f0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00006700: 2020 2020 2020 666f 7220 7061 6972 2069        for pair i
-00006710: 6e20 5b66 227b 6375 7272 5f31 7d2f 7b63  n [f"{curr_1}/{c
-00006720: 7572 725f 327d 222c 2066 227b 6375 7272  urr_2}", f"{curr
-00006730: 5f32 7d2f 7b63 7572 725f 317d 225d 3a0a  _2}/{curr_1}"]:.
-00006740: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00006750: 6169 7220 696e 2073 656c 662e 6d61 726b  air in self.mark
-00006760: 6574 7320 616e 6420 7365 6c66 2e6d 6172  ets and self.mar
-00006770: 6b65 7473 5b70 6169 725d 2e67 6574 2827  kets[pair].get('
-00006780: 6163 7469 7665 2729 3a0a 2020 2020 2020  active'):.      
-00006790: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000067a0: 2070 6169 720a 2020 2020 2020 2020 7261   pair.        ra
-000067b0: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-000067c0: 2243 6f75 6c64 206e 6f74 2063 6f6d 6269  "Could not combi
-000067d0: 6e65 207b 6375 7272 5f31 7d20 616e 6420  ne {curr_1} and 
-000067e0: 7b63 7572 725f 327d 2074 6f20 6765 7420  {curr_2} to get 
-000067f0: 6120 7661 6c69 6420 7061 6972 2e22 290a  a valid pair.").
-00006800: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
-00006810: 655f 7469 6d65 6672 616d 6573 2873 656c  e_timeframes(sel
-00006820: 662c 2074 696d 6566 7261 6d65 3a20 4f70  f, timeframe: Op
-00006830: 7469 6f6e 616c 5b73 7472 5d29 202d 3e20  tional[str]) -> 
-00006840: 4e6f 6e65 3a0a 2020 2020 2020 2020 2222  None:.        ""
-00006850: 220a 2020 2020 2020 2020 4368 6563 6b20  ".        Check 
-00006860: 6966 2074 696d 6566 7261 6d65 2066 726f  if timeframe fro
-00006870: 6d20 636f 6e66 6967 2069 7320 6120 7375  m config is a su
-00006880: 7070 6f72 7465 6420 7469 6d65 6672 616d  pported timefram
-00006890: 6520 6f6e 2074 6865 2065 7863 6861 6e67  e on the exchang
-000068a0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
-000068b0: 2020 2020 2020 6966 206e 6f74 2068 6173        if not has
-000068c0: 6174 7472 2873 656c 662e 5f61 7069 2c20  attr(self._api, 
-000068d0: 2274 696d 6566 7261 6d65 7322 2920 6f72  "timeframes") or
-000068e0: 2073 656c 662e 5f61 7069 2e74 696d 6566   self._api.timef
-000068f0: 7261 6d65 7320 6973 204e 6f6e 653a 0a20  rames is None:. 
-00006900: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-00006910: 7469 6d65 6672 616d 6573 2061 7474 7269  timeframes attri
-00006920: 6275 7465 2069 7320 6d69 7373 696e 6720  bute is missing 
-00006930: 286f 7220 6973 204e 6f6e 6529 2c20 7468  (or is None), th
-00006940: 6520 6578 6368 616e 6765 2070 726f 6261  e exchange proba
-00006950: 626c 790a 2020 2020 2020 2020 2020 2020  bly.            
-00006960: 2320 6861 7320 6e6f 2066 6574 6368 4f48  # has no fetchOH
-00006970: 4c43 5620 6d65 7468 6f64 2e0a 2020 2020  LCV method..    
-00006980: 2020 2020 2020 2020 2320 5468 6572 6566          # Theref
-00006990: 6f72 6520 7765 2061 6c73 6f20 7368 6f77  ore we also show
-000069a0: 2074 6861 742e 0a20 2020 2020 2020 2020   that..         
-000069b0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-000069c0: 6f6e 616c 4578 6365 7074 696f 6e28 0a20  onalException(. 
-000069d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000069e0: 2254 6865 2063 6378 7420 6c69 6272 6172  "The ccxt librar
-000069f0: 7920 646f 6573 206e 6f74 2070 726f 7669  y does not provi
-00006a00: 6465 2074 6865 206c 6973 7420 6f66 2074  de the list of t
-00006a10: 696d 6566 7261 6d65 7320 220a 2020 2020  imeframes ".    
-00006a20: 2020 2020 2020 2020 2020 2020 6622 666f              f"fo
-00006a30: 7220 7468 6520 6578 6368 616e 6765 207b  r the exchange {
-00006a40: 7365 6c66 2e6e 616d 657d 2061 6e64 2074  self.name} and t
-00006a50: 6869 7320 6578 6368 616e 6765 2022 0a20  his exchange ". 
-00006a60: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00006a70: 2269 7320 7468 6572 6566 6f72 6520 6e6f  "is therefore no
-00006a80: 7420 7375 7070 6f72 7465 642e 2063 6378  t supported. ccx
-00006a90: 7420 6665 7463 684f 484c 4356 3a20 7b73  t fetchOHLCV: {s
-00006aa0: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
-00006ab0: 2827 6665 7463 684f 484c 4356 2729 7d22  ('fetchOHLCV')}"
-00006ac0: 290a 0a20 2020 2020 2020 2069 6620 7469  )..        if ti
-00006ad0: 6d65 6672 616d 6520 616e 6420 2874 696d  meframe and (tim
-00006ae0: 6566 7261 6d65 206e 6f74 2069 6e20 7365  eframe not in se
-00006af0: 6c66 2e74 696d 6566 7261 6d65 7329 3a0a  lf.timeframes):.
-00006b00: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006b10: 6520 436f 6e66 6967 7572 6174 696f 6e45  e ConfigurationE
-00006b20: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00006b30: 2020 2020 2020 6622 496e 7661 6c69 6420        f"Invalid 
-00006b40: 7469 6d65 6672 616d 6520 277b 7469 6d65  timeframe '{time
-00006b50: 6672 616d 657d 272e 2054 6869 7320 6578  frame}'. This ex
-00006b60: 6368 616e 6765 2073 7570 706f 7274 733a  change supports:
-00006b70: 207b 7365 6c66 2e74 696d 6566 7261 6d65   {self.timeframe
-00006b80: 737d 2229 0a0a 2020 2020 2020 2020 6966  s}")..        if
-00006b90: 2028 0a20 2020 2020 2020 2020 2020 2074   (.            t
-00006ba0: 696d 6566 7261 6d65 0a20 2020 2020 2020  imeframe.       
-00006bb0: 2020 2020 2061 6e64 2073 656c 662e 5f63       and self._c
-00006bc0: 6f6e 6669 675b 2772 756e 6d6f 6465 275d  onfig['runmode']
-00006bd0: 2021 3d20 5275 6e4d 6f64 652e 5554 494c   != RunMode.UTIL
-00006be0: 5f45 5843 4841 4e47 450a 2020 2020 2020  _EXCHANGE.      
-00006bf0: 2020 2020 2020 616e 6420 7469 6d65 6672        and timefr
-00006c00: 616d 655f 746f 5f6d 696e 7574 6573 2874  ame_to_minutes(t
-00006c10: 696d 6566 7261 6d65 2920 3c20 310a 2020  imeframe) < 1.  
-00006c20: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00006c30: 2020 2020 2072 6169 7365 2043 6f6e 6669       raise Confi
-00006c40: 6775 7261 7469 6f6e 4572 726f 7228 2254  gurationError("T
-00006c50: 696d 6566 7261 6d65 7320 3c20 316d 2061  imeframes < 1m a
-00006c60: 7265 2063 7572 7265 6e74 6c79 206e 6f74  re currently not
-00006c70: 2073 7570 706f 7274 6564 2062 7920 4672   supported by Fr
-00006c80: 6571 7472 6164 652e 2229 0a0a 2020 2020  eqtrade.")..    
-00006c90: 6465 6620 7661 6c69 6461 7465 5f6f 7264  def validate_ord
-00006ca0: 6572 7479 7065 7328 7365 6c66 2c20 6f72  ertypes(self, or
-00006cb0: 6465 725f 7479 7065 733a 2044 6963 7429  der_types: Dict)
-00006cc0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00006cd0: 2020 2222 220a 2020 2020 2020 2020 4368    """.        Ch
-00006ce0: 6563 6b73 2069 6620 6f72 6465 722d 7479  ecks if order-ty
-00006cf0: 7065 7320 636f 6e66 6967 7572 6564 2069  pes configured i
-00006d00: 6e20 7374 7261 7465 6779 2f63 6f6e 6669  n strategy/confi
-00006d10: 6720 6172 6520 7375 7070 6f72 7465 640a  g are supported.
-00006d20: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00006d30: 2020 2020 6966 2061 6e79 2876 203d 3d20      if any(v == 
-00006d40: 276d 6172 6b65 7427 2066 6f72 206b 2c20  'market' for k, 
-00006d50: 7620 696e 206f 7264 6572 5f74 7970 6573  v in order_types
-00006d60: 2e69 7465 6d73 2829 293a 0a20 2020 2020  .items()):.     
-00006d70: 2020 2020 2020 2069 6620 6e6f 7420 7365         if not se
-00006d80: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
-00006d90: 2763 7265 6174 654d 6172 6b65 744f 7264  'createMarketOrd
-00006da0: 6572 2729 3a0a 2020 2020 2020 2020 2020  er'):.          
-00006db0: 2020 2020 2020 7261 6973 6520 436f 6e66        raise Conf
-00006dc0: 6967 7572 6174 696f 6e45 7272 6f72 280a  igurationError(.
-00006dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006de0: 2020 2020 6627 4578 6368 616e 6765 207b      f'Exchange {
-00006df0: 7365 6c66 2e6e 616d 657d 2064 6f65 7320  self.name} does 
-00006e00: 6e6f 7420 7375 7070 6f72 7420 6d61 726b  not support mark
-00006e10: 6574 206f 7264 6572 732e 2729 0a20 2020  et orders.').   
-00006e20: 2020 2020 2073 656c 662e 7661 6c69 6461       self.valida
-00006e30: 7465 5f73 746f 705f 6f72 6465 7274 7970  te_stop_ordertyp
-00006e40: 6573 286f 7264 6572 5f74 7970 6573 290a  es(order_types).
-00006e50: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
-00006e60: 655f 7374 6f70 5f6f 7264 6572 7479 7065  e_stop_ordertype
-00006e70: 7328 7365 6c66 2c20 6f72 6465 725f 7479  s(self, order_ty
-00006e80: 7065 733a 2044 6963 7429 202d 3e20 4e6f  pes: Dict) -> No
-00006e90: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
-00006ea0: 2020 2020 2020 2020 5661 6c69 6461 7465          Validate
-00006eb0: 2073 746f 706c 6f73 7320 6f72 6465 7220   stoploss order 
-00006ec0: 7479 7065 730a 2020 2020 2020 2020 2222  types.        ""
-00006ed0: 220a 2020 2020 2020 2020 6966 2028 6f72  ".        if (or
-00006ee0: 6465 725f 7479 7065 732e 6765 7428 2273  der_types.get("s
-00006ef0: 746f 706c 6f73 735f 6f6e 5f65 7863 6861  toploss_on_excha
-00006f00: 6e67 6522 290a 2020 2020 2020 2020 2020  nge").          
-00006f10: 2020 2020 2020 616e 6420 6e6f 7420 7365        and not se
-00006f20: 6c66 2e5f 6674 5f68 6173 2e67 6574 2822  lf._ft_has.get("
-00006f30: 7374 6f70 6c6f 7373 5f6f 6e5f 6578 6368  stoploss_on_exch
-00006f40: 616e 6765 222c 2046 616c 7365 2929 3a0a  ange", False)):.
-00006f50: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00006f60: 6520 436f 6e66 6967 7572 6174 696f 6e45  e ConfigurationE
-00006f70: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00006f80: 2020 2020 2020 6627 4f6e 2065 7863 6861        f'On excha
-00006f90: 6e67 6520 7374 6f70 6c6f 7373 2069 7320  nge stoploss is 
-00006fa0: 6e6f 7420 7375 7070 6f72 7465 6420 666f  not supported fo
-00006fb0: 7220 7b73 656c 662e 6e61 6d65 7d2e 270a  r {self.name}.'.
-00006fc0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00006fd0: 2020 2020 2020 6966 2073 656c 662e 7472        if self.tr
-00006fe0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
-00006ff0: 6164 696e 674d 6f64 652e 4655 5455 5245  adingMode.FUTURE
-00007000: 533a 0a20 2020 2020 2020 2020 2020 2070  S:.            p
-00007010: 7269 6365 5f6d 6170 7069 6e67 203d 2073  rice_mapping = s
-00007020: 656c 662e 5f66 745f 6861 732e 6765 7428  elf._ft_has.get(
-00007030: 2773 746f 705f 7072 6963 655f 7479 7065  'stop_price_type
-00007040: 5f76 616c 7565 5f6d 6170 7069 6e67 272c  _value_mapping',
-00007050: 207b 7d29 2e6b 6579 7328 290a 2020 2020   {}).keys().    
-00007060: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-00007070: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-00007080: 6572 5f74 7970 6573 2e67 6574 2822 7374  er_types.get("st
-00007090: 6f70 6c6f 7373 5f6f 6e5f 6578 6368 616e  oploss_on_exchan
-000070a0: 6765 222c 2046 616c 7365 2920 6973 2054  ge", False) is T
-000070b0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-000070c0: 2020 2020 616e 6420 2773 746f 706c 6f73      and 'stoplos
-000070d0: 735f 7072 6963 655f 7479 7065 2720 696e  s_price_type' in
-000070e0: 206f 7264 6572 5f74 7970 6573 0a20 2020   order_types.   
-000070f0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
-00007100: 206f 7264 6572 5f74 7970 6573 5b27 7374   order_types['st
-00007110: 6f70 6c6f 7373 5f70 7269 6365 5f74 7970  oploss_price_typ
-00007120: 6527 5d20 6e6f 7420 696e 2070 7269 6365  e'] not in price
-00007130: 5f6d 6170 7069 6e67 0a20 2020 2020 2020  _mapping.       
-00007140: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
-00007150: 2020 2020 2020 2020 7261 6973 6520 436f          raise Co
-00007160: 6e66 6967 7572 6174 696f 6e45 7272 6f72  nfigurationError
-00007170: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00007180: 2020 2020 2020 6627 4f6e 2065 7863 6861        f'On excha
-00007190: 6e67 6520 7374 6f70 6c6f 7373 2070 7269  nge stoploss pri
-000071a0: 6365 2074 7970 6520 6973 206e 6f74 2073  ce type is not s
-000071b0: 7570 706f 7274 6564 2066 6f72 207b 7365  upported for {se
-000071c0: 6c66 2e6e 616d 657d 2e27 0a20 2020 2020  lf.name}.'.     
-000071d0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-000071e0: 2020 6465 6620 7661 6c69 6461 7465 5f70    def validate_p
-000071f0: 7269 6369 6e67 2873 656c 662c 2070 7269  ricing(self, pri
-00007200: 6369 6e67 3a20 4469 6374 2920 2d3e 204e  cing: Dict) -> N
-00007210: 6f6e 653a 0a20 2020 2020 2020 2069 6620  one:.        if 
-00007220: 7072 6963 696e 672e 6765 7428 2775 7365  pricing.get('use
-00007230: 5f6f 7264 6572 5f62 6f6f 6b27 2c20 4661  _order_book', Fa
-00007240: 6c73 6529 2061 6e64 206e 6f74 2073 656c  lse) and not sel
-00007250: 662e 6578 6368 616e 6765 5f68 6173 2827  f.exchange_has('
-00007260: 6665 7463 684c 324f 7264 6572 426f 6f6b  fetchL2OrderBook
-00007270: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-00007280: 7261 6973 6520 436f 6e66 6967 7572 6174  raise Configurat
-00007290: 696f 6e45 7272 6f72 2866 274f 7264 6572  ionError(f'Order
-000072a0: 626f 6f6b 206e 6f74 2061 7661 696c 6162  book not availab
-000072b0: 6c65 2066 6f72 207b 7365 6c66 2e6e 616d  le for {self.nam
-000072c0: 657d 2e27 290a 2020 2020 2020 2020 6966  e}.').        if
-000072d0: 2028 6e6f 7420 7072 6963 696e 672e 6765   (not pricing.ge
-000072e0: 7428 2775 7365 5f6f 7264 6572 5f62 6f6f  t('use_order_boo
-000072f0: 6b27 2c20 4661 6c73 6529 2061 6e64 2028  k', False) and (
-00007300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007310: 206e 6f74 2073 656c 662e 6578 6368 616e   not self.exchan
-00007320: 6765 5f68 6173 2827 6665 7463 6854 6963  ge_has('fetchTic
-00007330: 6b65 7227 290a 2020 2020 2020 2020 2020  ker').          
-00007340: 2020 2020 2020 6f72 206e 6f74 2073 656c        or not sel
-00007350: 662e 5f66 745f 6861 735b 2774 6963 6b65  f._ft_has['ticke
-00007360: 7273 5f68 6176 655f 7072 6963 6527 5d29  rs_have_price'])
-00007370: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00007380: 6169 7365 2043 6f6e 6669 6775 7261 7469  aise Configurati
-00007390: 6f6e 4572 726f 7228 6627 5469 636b 6572  onError(f'Ticker
-000073a0: 2070 7269 6369 6e67 206e 6f74 2061 7661   pricing not ava
-000073b0: 696c 6162 6c65 2066 6f72 207b 7365 6c66  ilable for {self
-000073c0: 2e6e 616d 657d 2e27 290a 0a20 2020 2064  .name}.')..    d
-000073d0: 6566 2076 616c 6964 6174 655f 6f72 6465  ef validate_orde
-000073e0: 725f 7469 6d65 5f69 6e5f 666f 7263 6528  r_time_in_force(
-000073f0: 7365 6c66 2c20 6f72 6465 725f 7469 6d65  self, order_time
-00007400: 5f69 6e5f 666f 7263 653a 2044 6963 7429  _in_force: Dict)
-00007410: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
-00007420: 2020 2222 220a 2020 2020 2020 2020 4368    """.        Ch
-00007430: 6563 6b73 2069 6620 6f72 6465 7220 7469  ecks if order ti
-00007440: 6d65 2069 6e20 666f 7263 6520 636f 6e66  me in force conf
-00007450: 6967 7572 6564 2069 6e20 7374 7261 7465  igured in strate
-00007460: 6779 2f63 6f6e 6669 6720 6172 6520 7375  gy/config are su
-00007470: 7070 6f72 7465 640a 2020 2020 2020 2020  pported.        
-00007480: 2222 220a 2020 2020 2020 2020 6966 2061  """.        if a
-00007490: 6e79 2876 2e75 7070 6572 2829 206e 6f74  ny(v.upper() not
-000074a0: 2069 6e20 7365 6c66 2e5f 6674 5f68 6173   in self._ft_has
-000074b0: 5b22 6f72 6465 725f 7469 6d65 5f69 6e5f  ["order_time_in_
-000074c0: 666f 7263 6522 5d0a 2020 2020 2020 2020  force"].        
-000074d0: 2020 2020 2020 2066 6f72 206b 2c20 7620         for k, v 
-000074e0: 696e 206f 7264 6572 5f74 696d 655f 696e  in order_time_in
-000074f0: 5f66 6f72 6365 2e69 7465 6d73 2829 293a  _force.items()):
-00007500: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00007510: 7365 2043 6f6e 6669 6775 7261 7469 6f6e  se Configuration
-00007520: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00007530: 2020 2020 2020 2066 2754 696d 6520 696e         f'Time in
-00007540: 2066 6f72 6365 2070 6f6c 6963 6965 7320   force policies 
-00007550: 6172 6520 6e6f 7420 7375 7070 6f72 7465  are not supporte
-00007560: 6420 666f 7220 7b73 656c 662e 6e61 6d65  d for {self.name
-00007570: 7d20 7965 742e 2729 0a0a 2020 2020 6465  } yet.')..    de
-00007580: 6620 7661 6c69 6461 7465 5f72 6571 7569  f validate_requi
-00007590: 7265 645f 7374 6172 7475 705f 6361 6e64  red_startup_cand
-000075a0: 6c65 7328 7365 6c66 2c20 7374 6172 7475  les(self, startu
-000075b0: 705f 6361 6e64 6c65 733a 2069 6e74 2c20  p_candles: int, 
-000075c0: 7469 6d65 6672 616d 653a 2073 7472 2920  timeframe: str) 
-000075d0: 2d3e 2069 6e74 3a0a 2020 2020 2020 2020  -> int:.        
-000075e0: 2222 220a 2020 2020 2020 2020 4368 6563  """.        Chec
-000075f0: 6b73 2069 6620 7265 7175 6972 6564 2073  ks if required s
-00007600: 7461 7274 7570 5f63 616e 646c 6573 2069  tartup_candles i
-00007610: 7320 6d6f 7265 2074 6861 6e20 6f68 6c63  s more than ohlc
-00007620: 765f 6361 6e64 6c65 5f6c 696d 6974 2829  v_candle_limit()
-00007630: 2e0a 2020 2020 2020 2020 5265 7175 6972  ..        Requir
-00007640: 6573 2061 2067 7261 6365 2d70 6572 696f  es a grace-perio
-00007650: 6420 6f66 2035 2063 616e 646c 6573 202d  d of 5 candles -
-00007660: 2073 6f20 6120 7374 6172 7475 702d 7065   so a startup-pe
-00007670: 7269 6f64 2075 7020 746f 2034 3934 2069  riod up to 494 i
-00007680: 7320 616c 6c6f 7765 6420 6279 2064 6566  s allowed by def
-00007690: 6175 6c74 2e0a 2020 2020 2020 2020 2222  ault..        ""
-000076a0: 220a 0a20 2020 2020 2020 2063 616e 646c  "..        candl
-000076b0: 655f 6c69 6d69 7420 3d20 7365 6c66 2e6f  e_limit = self.o
-000076c0: 686c 6376 5f63 616e 646c 655f 6c69 6d69  hlcv_candle_limi
-000076d0: 7428 0a20 2020 2020 2020 2020 2020 2074  t(.            t
-000076e0: 696d 6566 7261 6d65 2c20 7365 6c66 2e5f  imeframe, self._
-000076f0: 636f 6e66 6967 5b27 6361 6e64 6c65 5f74  config['candle_t
-00007700: 7970 655f 6465 6627 5d2c 0a20 2020 2020  ype_def'],.     
-00007710: 2020 2020 2020 2064 745f 7473 2864 6174         dt_ts(dat
-00007720: 655f 6d69 6e75 735f 6361 6e64 6c65 7328  e_minus_candles(
-00007730: 7469 6d65 6672 616d 652c 2073 7461 7274  timeframe, start
-00007740: 7570 5f63 616e 646c 6573 2929 0a20 2020  up_candles)).   
-00007750: 2020 2020 2020 2020 2069 6620 7469 6d65           if time
-00007760: 6672 616d 6520 656c 7365 204e 6f6e 6529  frame else None)
-00007770: 0a20 2020 2020 2020 2023 2052 6571 7569  .        # Requi
-00007780: 7265 206f 6e65 206d 6f72 6520 6361 6e64  re one more cand
-00007790: 6c65 202d 2074 6f20 6163 636f 756e 7420  le - to account 
-000077a0: 666f 7220 7468 6520 7374 696c 6c20 6f70  for the still op
-000077b0: 656e 2063 616e 646c 652e 0a20 2020 2020  en candle..     
-000077c0: 2020 2063 616e 646c 655f 636f 756e 7420     candle_count 
-000077d0: 3d20 7374 6172 7475 705f 6361 6e64 6c65  = startup_candle
-000077e0: 7320 2b20 310a 2020 2020 2020 2020 2320  s + 1.        # 
-000077f0: 416c 6c6f 7720 3520 6361 6c6c 7320 746f  Allow 5 calls to
-00007800: 2074 6865 2065 7863 6861 6e67 6520 7065   the exchange pe
-00007810: 7220 7061 6972 0a20 2020 2020 2020 2072  r pair.        r
-00007820: 6571 7569 7265 645f 6361 6e64 6c65 5f63  equired_candle_c
-00007830: 616c 6c5f 636f 756e 7420 3d20 696e 7428  all_count = int(
-00007840: 0a20 2020 2020 2020 2020 2020 2028 6361  .            (ca
-00007850: 6e64 6c65 5f63 6f75 6e74 202f 2063 616e  ndle_count / can
-00007860: 646c 655f 6c69 6d69 7429 202b 2028 3020  dle_limit) + (0 
-00007870: 6966 2063 616e 646c 655f 636f 756e 7420  if candle_count 
-00007880: 2520 6361 6e64 6c65 5f6c 696d 6974 203d  % candle_limit =
-00007890: 3d20 3020 656c 7365 2031 2929 0a20 2020  = 0 else 1)).   
-000078a0: 2020 2020 2069 6620 7365 6c66 2e5f 6674       if self._ft
-000078b0: 5f68 6173 5b27 6f68 6c63 765f 6861 735f  _has['ohlcv_has_
-000078c0: 6869 7374 6f72 7927 5d3a 0a0a 2020 2020  history']:..    
-000078d0: 2020 2020 2020 2020 6966 2072 6571 7569          if requi
-000078e0: 7265 645f 6361 6e64 6c65 5f63 616c 6c5f  red_candle_call_
-000078f0: 636f 756e 7420 3e20 353a 0a20 2020 2020  count > 5:.     
-00007900: 2020 2020 2020 2020 2020 2023 204f 6e6c             # Onl
-00007910: 7920 616c 6c6f 7720 3520 6361 6c6c 7320  y allow 5 calls 
-00007920: 7065 7220 7061 6972 2074 6f20 736f 6d65  per pair to some
-00007930: 7768 6174 206c 696d 6974 2074 6865 2069  what limit the i
-00007940: 6d70 6163 740a 2020 2020 2020 2020 2020  mpact.          
-00007950: 2020 2020 2020 7261 6973 6520 436f 6e66        raise Conf
-00007960: 6967 7572 6174 696f 6e45 7272 6f72 280a  igurationError(.
-00007970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007980: 2020 2020 6622 5468 6973 2073 7472 6174      f"This strat
-00007990: 6567 7920 7265 7175 6972 6573 207b 7374  egy requires {st
-000079a0: 6172 7475 705f 6361 6e64 6c65 737d 2063  artup_candles} c
-000079b0: 616e 646c 6573 2074 6f20 7374 6172 742c  andles to start,
-000079c0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000079d0: 2020 2020 2020 2022 7768 6963 6820 6973         "which is
-000079e0: 206d 6f72 6520 7468 616e 2035 7820 220a   more than 5x ".
+00002410: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00002420: 6378 745f 6173 796e 635f 636f 6e66 6967  cxt_async_config
+00002430: 290a 2020 2020 2020 2020 7365 6c66 2e5f  ).        self._
+00002440: 6170 695f 6173 796e 6320 3d20 7365 6c66  api_async = self
+00002450: 2e5f 696e 6974 5f63 6378 7428 0a20 2020  ._init_ccxt(.   
+00002460: 2020 2020 2020 2020 2065 7863 6861 6e67           exchang
+00002470: 655f 636f 6e66 2c20 6363 7874 5f61 7379  e_conf, ccxt_asy
+00002480: 6e63 2c20 6363 7874 5f6b 7761 7267 733d  nc, ccxt_kwargs=
+00002490: 6363 7874 5f61 7379 6e63 5f63 6f6e 6669  ccxt_async_confi
+000024a0: 6729 0a0a 2020 2020 2020 2020 6c6f 6767  g)..        logg
+000024b0: 6572 2e69 6e66 6f28 6627 5573 696e 6720  er.info(f'Using 
+000024c0: 4578 6368 616e 6765 2022 7b73 656c 662e  Exchange "{self.
+000024d0: 6e61 6d65 7d22 2729 0a20 2020 2020 2020  name}"').       
+000024e0: 2073 656c 662e 7265 7175 6972 6564 5f63   self.required_c
+000024f0: 616e 646c 655f 6361 6c6c 5f63 6f75 6e74  andle_call_count
+00002500: 203d 2031 0a20 2020 2020 2020 2069 6620   = 1.        if 
+00002510: 7661 6c69 6461 7465 3a0a 2020 2020 2020  validate:.      
+00002520: 2020 2020 2020 2320 496e 6974 6961 6c20        # Initial 
+00002530: 6d61 726b 6574 7320 6c6f 6164 0a20 2020  markets load.   
+00002540: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
+00002550: 6f61 645f 6d61 726b 6574 7328 290a 2020  oad_markets().  
+00002560: 2020 2020 2020 2020 2020 7365 6c66 2e76            self.v
+00002570: 616c 6964 6174 655f 636f 6e66 6967 2863  alidate_config(c
+00002580: 6f6e 6669 6729 0a20 2020 2020 2020 2020  onfig).         
+00002590: 2020 2073 656c 662e 5f73 7461 7274 7570     self._startup
+000025a0: 5f63 616e 646c 655f 636f 756e 743a 2069  _candle_count: i
+000025b0: 6e74 203d 2063 6f6e 6669 672e 6765 7428  nt = config.get(
+000025c0: 2773 7461 7274 7570 5f63 616e 646c 655f  'startup_candle_
+000025d0: 636f 756e 7427 2c20 3029 0a20 2020 2020  count', 0).     
+000025e0: 2020 2020 2020 2073 656c 662e 7265 7175         self.requ
+000025f0: 6972 6564 5f63 616e 646c 655f 6361 6c6c  ired_candle_call
+00002600: 5f63 6f75 6e74 203d 2073 656c 662e 7661  _count = self.va
+00002610: 6c69 6461 7465 5f72 6571 7569 7265 645f  lidate_required_
+00002620: 7374 6172 7475 705f 6361 6e64 6c65 7328  startup_candles(
+00002630: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00002640: 2073 656c 662e 5f73 7461 7274 7570 5f63   self._startup_c
+00002650: 616e 646c 655f 636f 756e 742c 2063 6f6e  andle_count, con
+00002660: 6669 672e 6765 7428 2774 696d 6566 7261  fig.get('timefra
+00002670: 6d65 272c 2027 2729 290a 0a20 2020 2020  me', ''))..     
+00002680: 2020 2023 2043 6f6e 7665 7274 7320 7468     # Converts th
+00002690: 6520 696e 7465 7276 616c 2070 726f 7669  e interval provi
+000026a0: 6465 6420 696e 206d 696e 7574 6573 2069  ded in minutes i
+000026b0: 6e20 636f 6e66 6967 2074 6f20 7365 636f  n config to seco
+000026c0: 6e64 730a 2020 2020 2020 2020 7365 6c66  nds.        self
+000026d0: 2e6d 6172 6b65 7473 5f72 6566 7265 7368  .markets_refresh
+000026e0: 5f69 6e74 6572 7661 6c3a 2069 6e74 203d  _interval: int =
+000026f0: 2065 7863 6861 6e67 655f 636f 6e66 2e67   exchange_conf.g
+00002700: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
+00002710: 226d 6172 6b65 7473 5f72 6566 7265 7368  "markets_refresh
+00002720: 5f69 6e74 6572 7661 6c22 2c20 3630 2920  _interval", 60) 
+00002730: 2a20 3630 202a 2031 3030 300a 0a20 2020  * 60 * 1000..   
+00002740: 2020 2020 2069 6620 7365 6c66 2e74 7261       if self.tra
+00002750: 6469 6e67 5f6d 6f64 6520 213d 2054 7261  ding_mode != Tra
+00002760: 6469 6e67 4d6f 6465 2e53 504f 5420 616e  dingMode.SPOT an
+00002770: 6420 6c6f 6164 5f6c 6576 6572 6167 655f  d load_leverage_
+00002780: 7469 6572 733a 0a20 2020 2020 2020 2020  tiers:.         
+00002790: 2020 2073 656c 662e 6669 6c6c 5f6c 6576     self.fill_lev
+000027a0: 6572 6167 655f 7469 6572 7328 290a 2020  erage_tiers().  
+000027b0: 2020 2020 2020 7365 6c66 2e61 6464 6974        self.addit
+000027c0: 696f 6e61 6c5f 6578 6368 616e 6765 5f69  ional_exchange_i
+000027d0: 6e69 7428 290a 0a20 2020 2064 6566 205f  nit()..    def _
+000027e0: 5f64 656c 5f5f 2873 656c 6629 3a0a 2020  _del__(self):.  
+000027f0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00002800: 2020 4465 7374 7275 6374 6f72 202d 2063    Destructor - c
+00002810: 6c65 616e 2075 7020 6173 796e 6320 7374  lean up async st
+00002820: 7566 660a 2020 2020 2020 2020 2222 220a  uff.        """.
+00002830: 2020 2020 2020 2020 7365 6c66 2e63 6c6f          self.clo
+00002840: 7365 2829 0a0a 2020 2020 6465 6620 636c  se()..    def cl
+00002850: 6f73 6528 7365 6c66 293a 0a20 2020 2020  ose(self):.     
+00002860: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+00002870: 2245 7863 6861 6e67 6520 6f62 6a65 6374  "Exchange object
+00002880: 2064 6573 7472 6f79 6564 2c20 636c 6f73   destroyed, clos
+00002890: 696e 6720 6173 796e 6320 6c6f 6f70 2229  ing async loop")
+000028a0: 0a20 2020 2020 2020 2069 6620 2873 656c  .        if (sel
+000028b0: 662e 5f61 7069 5f61 7379 6e63 2061 6e64  f._api_async and
+000028c0: 2069 6e73 7065 6374 2e69 7363 6f72 6f75   inspect.iscorou
+000028d0: 7469 6e65 6675 6e63 7469 6f6e 2873 656c  tinefunction(sel
+000028e0: 662e 5f61 7069 5f61 7379 6e63 2e63 6c6f  f._api_async.clo
+000028f0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+00002900: 2020 2020 616e 6420 7365 6c66 2e5f 6170      and self._ap
+00002910: 695f 6173 796e 632e 7365 7373 696f 6e29  i_async.session)
+00002920: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00002930: 6767 6572 2e64 6562 7567 2822 436c 6f73  gger.debug("Clos
+00002940: 696e 6720 6173 796e 6320 6363 7874 2073  ing async ccxt s
+00002950: 6573 7369 6f6e 2e22 290a 2020 2020 2020  ession.").      
+00002960: 2020 2020 2020 7365 6c66 2e6c 6f6f 702e        self.loop.
+00002970: 7275 6e5f 756e 7469 6c5f 636f 6d70 6c65  run_until_comple
+00002980: 7465 2873 656c 662e 5f61 7069 5f61 7379  te(self._api_asy
+00002990: 6e63 2e63 6c6f 7365 2829 290a 2020 2020  nc.close()).    
+000029a0: 2020 2020 6966 2073 656c 662e 6c6f 6f70      if self.loop
+000029b0: 2061 6e64 206e 6f74 2073 656c 662e 6c6f   and not self.lo
+000029c0: 6f70 2e69 735f 636c 6f73 6564 2829 3a0a  op.is_closed():.
+000029d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000029e0: 2e6c 6f6f 702e 636c 6f73 6528 290a 0a20  .loop.close().. 
+000029f0: 2020 2064 6566 205f 696e 6974 5f61 7379     def _init_asy
+00002a00: 6e63 5f6c 6f6f 7028 7365 6c66 2920 2d3e  nc_loop(self) ->
+00002a10: 2061 7379 6e63 696f 2e41 6273 7472 6163   asyncio.Abstrac
+00002a20: 7445 7665 6e74 4c6f 6f70 3a0a 2020 2020  tEventLoop:.    
+00002a30: 2020 2020 6c6f 6f70 203d 2061 7379 6e63      loop = async
+00002a40: 696f 2e6e 6577 5f65 7665 6e74 5f6c 6f6f  io.new_event_loo
+00002a50: 7028 290a 2020 2020 2020 2020 6173 796e  p().        asyn
+00002a60: 6369 6f2e 7365 745f 6576 656e 745f 6c6f  cio.set_event_lo
+00002a70: 6f70 286c 6f6f 7029 0a20 2020 2020 2020  op(loop).       
+00002a80: 2072 6574 7572 6e20 6c6f 6f70 0a0a 2020   return loop..  
+00002a90: 2020 6465 6620 7661 6c69 6461 7465 5f63    def validate_c
+00002aa0: 6f6e 6669 6728 7365 6c66 2c20 636f 6e66  onfig(self, conf
+00002ab0: 6967 293a 0a20 2020 2020 2020 2023 2043  ig):.        # C
+00002ac0: 6865 636b 2069 6620 7469 6d65 6672 616d  heck if timefram
+00002ad0: 6520 6973 2061 7661 696c 6162 6c65 0a20  e is available. 
+00002ae0: 2020 2020 2020 2073 656c 662e 7661 6c69         self.vali
+00002af0: 6461 7465 5f74 696d 6566 7261 6d65 7328  date_timeframes(
+00002b00: 636f 6e66 6967 2e67 6574 2827 7469 6d65  config.get('time
+00002b10: 6672 616d 6527 2929 0a0a 2020 2020 2020  frame'))..      
+00002b20: 2020 2320 4368 6563 6b20 6966 2061 6c6c    # Check if all
+00002b30: 2070 6169 7273 2061 7265 2061 7661 696c   pairs are avail
+00002b40: 6162 6c65 0a20 2020 2020 2020 2073 656c  able.        sel
+00002b50: 662e 7661 6c69 6461 7465 5f73 7461 6b65  f.validate_stake
+00002b60: 6375 7272 656e 6379 2863 6f6e 6669 675b  currency(config[
+00002b70: 2773 7461 6b65 5f63 7572 7265 6e63 7927  'stake_currency'
+00002b80: 5d29 0a20 2020 2020 2020 2069 6620 6e6f  ]).        if no
+00002b90: 7420 636f 6e66 6967 5b27 6578 6368 616e  t config['exchan
+00002ba0: 6765 275d 2e67 6574 2827 736b 6970 5f70  ge'].get('skip_p
+00002bb0: 6169 725f 7661 6c69 6461 7469 6f6e 2729  air_validation')
+00002bc0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00002bd0: 6c66 2e76 616c 6964 6174 655f 7061 6972  lf.validate_pair
+00002be0: 7328 636f 6e66 6967 5b27 6578 6368 616e  s(config['exchan
+00002bf0: 6765 275d 5b27 7061 6972 5f77 6869 7465  ge']['pair_white
+00002c00: 6c69 7374 275d 290a 2020 2020 2020 2020  list']).        
+00002c10: 7365 6c66 2e76 616c 6964 6174 655f 6f72  self.validate_or
+00002c20: 6465 7274 7970 6573 2863 6f6e 6669 672e  dertypes(config.
+00002c30: 6765 7428 276f 7264 6572 5f74 7970 6573  get('order_types
+00002c40: 272c 207b 7d29 290a 2020 2020 2020 2020  ', {})).        
+00002c50: 7365 6c66 2e76 616c 6964 6174 655f 6f72  self.validate_or
+00002c60: 6465 725f 7469 6d65 5f69 6e5f 666f 7263  der_time_in_forc
+00002c70: 6528 636f 6e66 6967 2e67 6574 2827 6f72  e(config.get('or
+00002c80: 6465 725f 7469 6d65 5f69 6e5f 666f 7263  der_time_in_forc
+00002c90: 6527 2c20 7b7d 2929 0a20 2020 2020 2020  e', {})).       
+00002ca0: 2073 656c 662e 7661 6c69 6461 7465 5f74   self.validate_t
+00002cb0: 7261 6469 6e67 5f6d 6f64 655f 616e 645f  rading_mode_and_
+00002cc0: 6d61 7267 696e 5f6d 6f64 6528 7365 6c66  margin_mode(self
+00002cd0: 2e74 7261 6469 6e67 5f6d 6f64 652c 2073  .trading_mode, s
+00002ce0: 656c 662e 6d61 7267 696e 5f6d 6f64 6529  elf.margin_mode)
+00002cf0: 0a20 2020 2020 2020 2073 656c 662e 7661  .        self.va
+00002d00: 6c69 6461 7465 5f70 7269 6369 6e67 2863  lidate_pricing(c
+00002d10: 6f6e 6669 675b 2765 7869 745f 7072 6963  onfig['exit_pric
+00002d20: 696e 6727 5d29 0a20 2020 2020 2020 2073  ing']).        s
+00002d30: 656c 662e 7661 6c69 6461 7465 5f70 7269  elf.validate_pri
+00002d40: 6369 6e67 2863 6f6e 6669 675b 2765 6e74  cing(config['ent
+00002d50: 7279 5f70 7269 6369 6e67 275d 290a 0a20  ry_pricing']).. 
+00002d60: 2020 2064 6566 205f 696e 6974 5f63 6378     def _init_ccx
+00002d70: 7428 7365 6c66 2c20 6578 6368 616e 6765  t(self, exchange
+00002d80: 5f63 6f6e 6669 673a 2044 6963 745b 7374  _config: Dict[st
+00002d90: 722c 2041 6e79 5d2c 2063 6378 745f 6d6f  r, Any], ccxt_mo
+00002da0: 6475 6c65 3a20 4363 7874 4d6f 6475 6c65  dule: CcxtModule
+00002db0: 5479 7065 203d 2063 6378 742c 202a 2c0a  Type = ccxt, *,.
+00002dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002dd0: 2020 2063 6378 745f 6b77 6172 6773 3a20     ccxt_kwargs: 
+00002de0: 4469 6374 2920 2d3e 2063 6378 742e 4578  Dict) -> ccxt.Ex
+00002df0: 6368 616e 6765 3a0a 2020 2020 2020 2020  change:.        
+00002e00: 2222 220a 2020 2020 2020 2020 496e 6974  """.        Init
+00002e10: 6961 6c69 7a65 2063 6378 7420 7769 7468  ialize ccxt with
+00002e20: 2067 6976 656e 2063 6f6e 6669 6720 616e   given config an
+00002e30: 6420 7265 7475 726e 2076 616c 6964 0a20  d return valid. 
+00002e40: 2020 2020 2020 2063 6378 7420 696e 7374         ccxt inst
+00002e50: 616e 6365 2e0a 2020 2020 2020 2020 2222  ance..        ""
+00002e60: 220a 2020 2020 2020 2020 2320 4669 6e64  ".        # Find
+00002e70: 206d 6174 6368 696e 6720 636c 6173 7320   matching class 
+00002e80: 666f 7220 7468 6520 6769 7665 6e20 6578  for the given ex
+00002e90: 6368 616e 6765 206e 616d 650a 2020 2020  change name.    
+00002ea0: 2020 2020 6e61 6d65 203d 2065 7863 6861      name = excha
+00002eb0: 6e67 655f 636f 6e66 6967 5b27 6e61 6d65  nge_config['name
+00002ec0: 275d 0a0a 2020 2020 2020 2020 6966 206e  ']..        if n
+00002ed0: 6f74 2069 735f 6578 6368 616e 6765 5f6b  ot is_exchange_k
+00002ee0: 6e6f 776e 5f63 6378 7428 6e61 6d65 2c20  nown_ccxt(name, 
+00002ef0: 6363 7874 5f6d 6f64 756c 6529 3a0a 2020  ccxt_module):.  
+00002f00: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00002f10: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
+00002f20: 7469 6f6e 2866 2745 7863 6861 6e67 6520  tion(f'Exchange 
+00002f30: 7b6e 616d 657d 2069 7320 6e6f 7420 7375  {name} is not su
+00002f40: 7070 6f72 7465 6420 6279 2063 6378 7427  pported by ccxt'
+00002f50: 290a 0a20 2020 2020 2020 2065 785f 636f  )..        ex_co
+00002f60: 6e66 6967 203d 207b 0a20 2020 2020 2020  nfig = {.       
+00002f70: 2020 2020 2027 6170 694b 6579 273a 2065       'apiKey': e
+00002f80: 7863 6861 6e67 655f 636f 6e66 6967 2e67  xchange_config.g
+00002f90: 6574 2827 6b65 7927 292c 0a20 2020 2020  et('key'),.     
+00002fa0: 2020 2020 2020 2027 7365 6372 6574 273a         'secret':
+00002fb0: 2065 7863 6861 6e67 655f 636f 6e66 6967   exchange_config
+00002fc0: 2e67 6574 2827 7365 6372 6574 2729 2c0a  .get('secret'),.
+00002fd0: 2020 2020 2020 2020 2020 2020 2770 6173              'pas
+00002fe0: 7377 6f72 6427 3a20 6578 6368 616e 6765  sword': exchange
+00002ff0: 5f63 6f6e 6669 672e 6765 7428 2770 6173  _config.get('pas
+00003000: 7377 6f72 6427 292c 0a20 2020 2020 2020  sword'),.       
+00003010: 2020 2020 2027 7569 6427 3a20 6578 6368       'uid': exch
+00003020: 616e 6765 5f63 6f6e 6669 672e 6765 7428  ange_config.get(
+00003030: 2775 6964 272c 2027 2729 2c0a 2020 2020  'uid', ''),.    
+00003040: 2020 2020 7d0a 2020 2020 2020 2020 6966      }.        if
+00003050: 2063 6378 745f 6b77 6172 6773 3a0a 2020   ccxt_kwargs:.  
+00003060: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00003070: 2e69 6e66 6f28 2741 7070 6c79 696e 6720  .info('Applying 
+00003080: 6164 6469 7469 6f6e 616c 2063 6378 7420  additional ccxt 
+00003090: 636f 6e66 6967 3a20 2573 272c 2063 6378  config: %s', ccx
+000030a0: 745f 6b77 6172 6773 290a 2020 2020 2020  t_kwargs).      
+000030b0: 2020 6966 2073 656c 662e 5f63 6378 745f    if self._ccxt_
+000030c0: 7061 7261 6d73 3a0a 2020 2020 2020 2020  params:.        
+000030d0: 2020 2020 2320 496e 6a65 6374 2073 7461      # Inject sta
+000030e0: 7469 6320 6f70 7469 6f6e 7320 6166 7465  tic options afte
+000030f0: 7220 7468 6520 6162 6f76 6520 6f75 7470  r the above outp
+00003100: 7574 2074 6f20 6e6f 7420 636f 6e66 7573  ut to not confus
+00003110: 6520 7573 6572 732e 0a20 2020 2020 2020  e users..       
+00003120: 2020 2020 2063 6378 745f 6b77 6172 6773       ccxt_kwargs
+00003130: 203d 2064 6565 705f 6d65 7267 655f 6469   = deep_merge_di
+00003140: 6374 7328 7365 6c66 2e5f 6363 7874 5f70  cts(self._ccxt_p
+00003150: 6172 616d 732c 2063 6378 745f 6b77 6172  arams, ccxt_kwar
+00003160: 6773 290a 2020 2020 2020 2020 6966 2063  gs).        if c
+00003170: 6378 745f 6b77 6172 6773 3a0a 2020 2020  cxt_kwargs:.    
+00003180: 2020 2020 2020 2020 6578 5f63 6f6e 6669          ex_confi
+00003190: 672e 7570 6461 7465 2863 6378 745f 6b77  g.update(ccxt_kw
+000031a0: 6172 6773 290a 2020 2020 2020 2020 7472  args).        tr
+000031b0: 793a 0a0a 2020 2020 2020 2020 2020 2020  y:..            
+000031c0: 6170 6920 3d20 6765 7461 7474 7228 6363  api = getattr(cc
+000031d0: 7874 5f6d 6f64 756c 652c 206e 616d 652e  xt_module, name.
+000031e0: 6c6f 7765 7228 2929 2865 785f 636f 6e66  lower())(ex_conf
+000031f0: 6967 290a 2020 2020 2020 2020 6578 6365  ig).        exce
+00003200: 7074 2028 4b65 7945 7272 6f72 2c20 4174  pt (KeyError, At
+00003210: 7472 6962 7574 6545 7272 6f72 2920 6173  tributeError) as
+00003220: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00003230: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00003240: 6c45 7863 6570 7469 6f6e 2866 2745 7863  lException(f'Exc
+00003250: 6861 6e67 6520 7b6e 616d 657d 2069 7320  hange {name} is 
+00003260: 6e6f 7420 7375 7070 6f72 7465 6427 2920  not supported') 
+00003270: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+00003280: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
+00003290: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
+000032a0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
+000032b0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+000032c0: 6e28 6622 496e 6974 6961 6c69 7a61 7469  n(f"Initializati
+000032d0: 6f6e 206f 6620 6363 7874 2066 6169 6c65  on of ccxt faile
+000032e0: 642e 2052 6561 736f 6e3a 207b 657d 2229  d. Reason: {e}")
+000032f0: 2066 726f 6d20 650a 0a20 2020 2020 2020   from e..       
+00003300: 2072 6574 7572 6e20 6170 690a 0a20 2020   return api..   
+00003310: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00003320: 6566 205f 6363 7874 5f63 6f6e 6669 6728  ef _ccxt_config(
+00003330: 7365 6c66 2920 2d3e 2044 6963 743a 0a20  self) -> Dict:. 
+00003340: 2020 2020 2020 2023 2050 6172 616d 6574         # Paramet
+00003350: 6572 7320 746f 2061 6464 2064 6972 6563  ers to add direc
+00003360: 746c 7920 746f 2063 6378 7420 7379 6e63  tly to ccxt sync
+00003370: 2f61 7379 6e63 2069 6e69 7469 616c 697a  /async initializ
+00003380: 6174 696f 6e2e 0a20 2020 2020 2020 2069  ation..        i
+00003390: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
+000033a0: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
+000033b0: 6465 2e4d 4152 4749 4e3a 0a20 2020 2020  de.MARGIN:.     
+000033c0: 2020 2020 2020 2072 6574 7572 6e20 7b0a         return {.
+000033d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000033e0: 226f 7074 696f 6e73 223a 207b 0a20 2020  "options": {.   
+000033f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003400: 2022 6465 6661 756c 7454 7970 6522 3a20   "defaultType": 
+00003410: 226d 6172 6769 6e22 0a20 2020 2020 2020  "margin".       
+00003420: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
+00003430: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00003440: 2065 6c69 6620 7365 6c66 2e74 7261 6469   elif self.tradi
+00003450: 6e67 5f6d 6f64 6520 3d3d 2054 7261 6469  ng_mode == Tradi
+00003460: 6e67 4d6f 6465 2e46 5554 5552 4553 3a0a  ngMode.FUTURES:.
+00003470: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003480: 726e 207b 0a20 2020 2020 2020 2020 2020  rn {.           
+00003490: 2020 2020 2022 6f70 7469 6f6e 7322 3a20       "options": 
+000034a0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+000034b0: 2020 2020 2020 2264 6566 6175 6c74 5479        "defaultTy
+000034c0: 7065 223a 2073 656c 662e 5f66 745f 6861  pe": self._ft_ha
+000034d0: 735b 2263 6378 745f 6675 7475 7265 735f  s["ccxt_futures_
+000034e0: 6e61 6d65 225d 0a20 2020 2020 2020 2020  name"].         
+000034f0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00003500: 2020 2020 207d 0a20 2020 2020 2020 2065       }.        e
+00003510: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00003520: 2072 6574 7572 6e20 7b7d 0a0a 2020 2020   return {}..    
+00003530: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+00003540: 6620 6e61 6d65 2873 656c 6629 202d 3e20  f name(self) -> 
+00003550: 7374 723a 0a20 2020 2020 2020 2022 2222  str:.        """
+00003560: 6578 6368 616e 6765 204e 616d 6520 2866  exchange Name (f
+00003570: 726f 6d20 6363 7874 2922 2222 0a20 2020  rom ccxt)""".   
+00003580: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00003590: 2e5f 6170 692e 6e61 6d65 0a0a 2020 2020  ._api.name..    
+000035a0: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+000035b0: 6620 6964 2873 656c 6629 202d 3e20 7374  f id(self) -> st
+000035c0: 723a 0a20 2020 2020 2020 2022 2222 6578  r:.        """ex
+000035d0: 6368 616e 6765 2063 6378 7420 6964 2222  change ccxt id""
+000035e0: 220a 2020 2020 2020 2020 7265 7475 726e  ".        return
+000035f0: 2073 656c 662e 5f61 7069 2e69 640a 0a20   self._api.id.. 
+00003600: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+00003610: 2064 6566 2074 696d 6566 7261 6d65 7328   def timeframes(
+00003620: 7365 6c66 2920 2d3e 204c 6973 745b 7374  self) -> List[st
+00003630: 725d 3a0a 2020 2020 2020 2020 7265 7475  r]:.        retu
+00003640: 726e 206c 6973 7428 2873 656c 662e 5f61  rn list((self._a
+00003650: 7069 2e74 696d 6566 7261 6d65 7320 6f72  pi.timeframes or
+00003660: 207b 7d29 2e6b 6579 7328 2929 0a0a 2020   {}).keys())..  
+00003670: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+00003680: 6465 6620 6d61 726b 6574 7328 7365 6c66  def markets(self
+00003690: 2920 2d3e 2044 6963 745b 7374 722c 2041  ) -> Dict[str, A
+000036a0: 6e79 5d3a 0a20 2020 2020 2020 2022 2222  ny]:.        """
+000036b0: 6578 6368 616e 6765 2063 6378 7420 6d61  exchange ccxt ma
+000036c0: 726b 6574 7322 2222 0a20 2020 2020 2020  rkets""".       
+000036d0: 2069 6620 6e6f 7420 7365 6c66 2e5f 6d61   if not self._ma
+000036e0: 726b 6574 733a 0a20 2020 2020 2020 2020  rkets:.         
+000036f0: 2020 206c 6f67 6765 722e 696e 666f 2822     logger.info("
+00003700: 4d61 726b 6574 7320 7765 7265 206e 6f74  Markets were not
+00003710: 206c 6f61 6465 642e 204c 6f61 6469 6e67   loaded. Loading
+00003720: 2074 6865 6d20 6e6f 772e 2e22 290a 2020   them now..").  
+00003730: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00003740: 6c6f 6164 5f6d 6172 6b65 7473 2829 0a20  load_markets(). 
+00003750: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00003760: 6c66 2e5f 6d61 726b 6574 730a 0a20 2020  lf._markets..   
+00003770: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
+00003780: 6566 2070 7265 6369 7369 6f6e 4d6f 6465  ef precisionMode
+00003790: 2873 656c 6629 202d 3e20 696e 743a 0a20  (self) -> int:. 
+000037a0: 2020 2020 2020 2022 2222 6578 6368 616e         """exchan
+000037b0: 6765 2063 6378 7420 7072 6563 6973 696f  ge ccxt precisio
+000037c0: 6e4d 6f64 6522 2222 0a20 2020 2020 2020  nMode""".       
+000037d0: 2072 6574 7572 6e20 7365 6c66 2e5f 6170   return self._ap
+000037e0: 692e 7072 6563 6973 696f 6e4d 6f64 650a  i.precisionMode.
+000037f0: 0a20 2020 2064 6566 2061 6464 6974 696f  .    def additio
+00003800: 6e61 6c5f 6578 6368 616e 6765 5f69 6e69  nal_exchange_ini
+00003810: 7428 7365 6c66 2920 2d3e 204e 6f6e 653a  t(self) -> None:
+00003820: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00003830: 2020 2020 2041 6464 6974 696f 6e61 6c20       Additional 
+00003840: 6578 6368 616e 6765 2069 6e69 7469 616c  exchange initial
+00003850: 697a 6174 696f 6e20 6c6f 6769 632e 0a20  ization logic.. 
+00003860: 2020 2020 2020 202e 6170 6920 7769 6c6c         .api will
+00003870: 2062 6520 6176 6169 6c61 626c 6520 6174   be available at
+00003880: 2074 6869 7320 706f 696e 742e 0a20 2020   this point..   
+00003890: 2020 2020 204d 7573 7420 6265 206f 7665       Must be ove
+000038a0: 7272 6964 6465 6e20 696e 2063 6869 6c64  rridden in child
+000038b0: 206d 6574 686f 6473 2069 6620 7265 7175   methods if requ
+000038c0: 6972 6564 2e0a 2020 2020 2020 2020 2222  ired..        ""
+000038d0: 220a 2020 2020 2020 2020 7061 7373 0a0a  ".        pass..
+000038e0: 2020 2020 6465 6620 5f6c 6f67 5f65 7863      def _log_exc
+000038f0: 6861 6e67 655f 7265 7370 6f6e 7365 2873  hange_response(s
+00003900: 656c 662c 2065 6e64 706f 696e 743a 2073  elf, endpoint: s
+00003910: 7472 2c20 7265 7370 6f6e 7365 2c20 2a2c  tr, response, *,
+00003920: 2061 6464 5f69 6e66 6f3d 4e6f 6e65 2920   add_info=None) 
+00003930: 2d3e 204e 6f6e 653a 0a20 2020 2020 2020  -> None:.       
+00003940: 2022 2222 204c 6f67 2065 7863 6861 6e67   """ Log exchang
+00003950: 6520 7265 7370 6f6e 7365 7320 2222 220a  e responses """.
+00003960: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00003970: 6c6f 675f 7265 7370 6f6e 7365 733a 0a20  log_responses:. 
+00003980: 2020 2020 2020 2020 2020 2061 6464 5f69             add_i
+00003990: 6e66 6f5f 7374 7220 3d20 2222 2069 6620  nfo_str = "" if 
+000039a0: 6164 645f 696e 666f 2069 7320 4e6f 6e65  add_info is None
+000039b0: 2065 6c73 6520 6622 207b 6164 645f 696e   else f" {add_in
+000039c0: 666f 7d3a 2022 0a20 2020 2020 2020 2020  fo}: ".         
+000039d0: 2020 206c 6f67 6765 722e 696e 666f 2866     logger.info(f
+000039e0: 2241 5049 207b 656e 6470 6f69 6e74 7d3a  "API {endpoint}:
+000039f0: 207b 6164 645f 696e 666f 5f73 7472 7d7b   {add_info_str}{
+00003a00: 7265 7370 6f6e 7365 7d22 290a 0a20 2020  response}")..   
+00003a10: 2064 6566 206f 686c 6376 5f63 616e 646c   def ohlcv_candl
+00003a20: 655f 6c69 6d69 7428 0a20 2020 2020 2020  e_limit(.       
+00003a30: 2020 2020 2073 656c 662c 2074 696d 6566       self, timef
+00003a40: 7261 6d65 3a20 7374 722c 2063 616e 646c  rame: str, candl
+00003a50: 655f 7479 7065 3a20 4361 6e64 6c65 5479  e_type: CandleTy
+00003a60: 7065 2c20 7369 6e63 655f 6d73 3a20 4f70  pe, since_ms: Op
+00003a70: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
+00003a80: 6e65 2920 2d3e 2069 6e74 3a0a 2020 2020  ne) -> int:.    
+00003a90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00003aa0: 4578 6368 616e 6765 206f 686c 6376 2063  Exchange ohlcv c
+00003ab0: 616e 646c 6520 6c69 6d69 740a 2020 2020  andle limit.    
+00003ac0: 2020 2020 5573 6573 206f 686c 6376 5f63      Uses ohlcv_c
+00003ad0: 616e 646c 655f 6c69 6d69 745f 7065 725f  andle_limit_per_
+00003ae0: 7469 6d65 6672 616d 6520 6966 2074 6865  timeframe if the
+00003af0: 2065 7863 6861 6e67 6520 6861 7320 6469   exchange has di
+00003b00: 6666 6572 656e 7420 6c69 6d69 7473 0a20  fferent limits. 
+00003b10: 2020 2020 2020 2070 6572 2074 696d 6566         per timef
+00003b20: 7261 6d65 2028 652e 672e 2062 6974 7472  rame (e.g. bittr
+00003b30: 6578 292c 206f 7468 6572 7769 7365 2066  ex), otherwise f
+00003b40: 616c 6c73 2062 6163 6b20 746f 206f 686c  alls back to ohl
+00003b50: 6376 5f63 616e 646c 655f 6c69 6d69 740a  cv_candle_limit.
+00003b60: 2020 2020 2020 2020 544f 444f 3a20 7468          TODO: th
+00003b70: 6973 2069 7320 6d6f 7374 206c 696b 656c  is is most likel
+00003b80: 7920 6e6f 206c 6f6e 6765 7220 6e65 6564  y no longer need
+00003b90: 6564 2073 696e 6365 206f 6e6c 7920 6269  ed since only bi
+00003ba0: 7474 7265 7820 6e65 6564 6564 2074 6869  ttrex needed thi
+00003bb0: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+00003bc0: 6d20 7469 6d65 6672 616d 653a 2054 696d  m timeframe: Tim
+00003bd0: 6566 7261 6d65 2074 6f20 6368 6563 6b0a  eframe to check.
+00003be0: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
+00003bf0: 616e 646c 655f 7479 7065 3a20 4361 6e64  andle_type: Cand
+00003c00: 6c65 2d74 7970 650a 2020 2020 2020 2020  le-type.        
+00003c10: 3a70 6172 616d 2073 696e 6365 5f6d 733a  :param since_ms:
+00003c20: 2053 7461 7274 696e 6720 7469 6d65 7374   Starting timest
+00003c30: 616d 700a 2020 2020 2020 2020 3a72 6574  amp.        :ret
+00003c40: 7572 6e3a 2043 616e 646c 6520 6c69 6d69  urn: Candle limi
+00003c50: 7420 6173 2069 6e74 6567 6572 0a20 2020  t as integer.   
+00003c60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00003c70: 2072 6574 7572 6e20 696e 7428 7365 6c66   return int(self
+00003c80: 2e5f 6674 5f68 6173 2e67 6574 2827 6f68  ._ft_has.get('oh
+00003c90: 6c63 765f 6361 6e64 6c65 5f6c 696d 6974  lcv_candle_limit
+00003ca0: 5f70 6572 5f74 696d 6566 7261 6d65 272c  _per_timeframe',
+00003cb0: 207b 7d29 2e67 6574 280a 2020 2020 2020   {}).get(.      
+00003cc0: 2020 2020 2020 7469 6d65 6672 616d 652c        timeframe,
+00003cd0: 2073 656c 662e 5f66 745f 6861 732e 6765   self._ft_has.ge
+00003ce0: 7428 276f 686c 6376 5f63 616e 646c 655f  t('ohlcv_candle_
+00003cf0: 6c69 6d69 7427 2929 290a 0a20 2020 2064  limit')))..    d
+00003d00: 6566 2067 6574 5f6d 6172 6b65 7473 280a  ef get_markets(.
+00003d10: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00003d20: 2c0a 2020 2020 2020 2020 2020 2020 6261  ,.            ba
+00003d30: 7365 5f63 7572 7265 6e63 6965 733a 204f  se_currencies: O
+00003d40: 7074 696f 6e61 6c5b 4c69 7374 5b73 7472  ptional[List[str
+00003d50: 5d5d 203d 204e 6f6e 652c 0a20 2020 2020  ]] = None,.     
+00003d60: 2020 2020 2020 2071 756f 7465 5f63 7572         quote_cur
+00003d70: 7265 6e63 6965 733a 204f 7074 696f 6e61  rencies: Optiona
+00003d80: 6c5b 4c69 7374 5b73 7472 5d5d 203d 204e  l[List[str]] = N
+00003d90: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+00003da0: 2073 706f 745f 6f6e 6c79 3a20 626f 6f6c   spot_only: bool
+00003db0: 203d 2046 616c 7365 2c20 6d61 7267 696e   = False, margin
+00003dc0: 5f6f 6e6c 793a 2062 6f6f 6c20 3d20 4661  _only: bool = Fa
+00003dd0: 6c73 652c 2066 7574 7572 6573 5f6f 6e6c  lse, futures_onl
+00003de0: 793a 2062 6f6f 6c20 3d20 4661 6c73 652c  y: bool = False,
+00003df0: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00003e00: 6461 626c 655f 6f6e 6c79 3a20 626f 6f6c  dable_only: bool
+00003e10: 203d 2054 7275 652c 0a20 2020 2020 2020   = True,.       
+00003e20: 2020 2020 2061 6374 6976 655f 6f6e 6c79       active_only
+00003e30: 3a20 626f 6f6c 203d 2046 616c 7365 2920  : bool = False) 
+00003e40: 2d3e 2044 6963 745b 7374 722c 2041 6e79  -> Dict[str, Any
+00003e50: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+00003e60: 2020 2020 2020 2052 6574 7572 6e20 6578         Return ex
+00003e70: 6368 616e 6765 2063 6378 7420 6d61 726b  change ccxt mark
+00003e80: 6574 732c 2066 696c 7465 7265 6420 6f75  ets, filtered ou
+00003e90: 7420 6279 2062 6173 6520 6375 7272 656e  t by base curren
+00003ea0: 6379 2061 6e64 2071 756f 7465 2063 7572  cy and quote cur
+00003eb0: 7265 6e63 790a 2020 2020 2020 2020 6966  rency.        if
+00003ec0: 2074 6869 7320 7761 7320 7265 7175 6573   this was reques
+00003ed0: 7465 6420 696e 2070 6172 616d 6574 6572  ted in parameter
+00003ee0: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+00003ef0: 2020 2020 2020 206d 6172 6b65 7473 203d         markets =
+00003f00: 2073 656c 662e 6d61 726b 6574 730a 2020   self.markets.  
+00003f10: 2020 2020 2020 6966 206e 6f74 206d 6172        if not mar
+00003f20: 6b65 7473 3a0a 2020 2020 2020 2020 2020  kets:.          
+00003f30: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+00003f40: 6e61 6c45 7863 6570 7469 6f6e 2822 4d61  nalException("Ma
+00003f50: 726b 6574 7320 7765 7265 206e 6f74 206c  rkets were not l
+00003f60: 6f61 6465 642e 2229 0a0a 2020 2020 2020  oaded.")..      
+00003f70: 2020 6966 2062 6173 655f 6375 7272 656e    if base_curren
+00003f80: 6369 6573 3a0a 2020 2020 2020 2020 2020  cies:.          
+00003f90: 2020 6d61 726b 6574 7320 3d20 7b6b 3a20    markets = {k: 
+00003fa0: 7620 666f 7220 6b2c 2076 2069 6e20 6d61  v for k, v in ma
+00003fb0: 726b 6574 732e 6974 656d 7328 2920 6966  rkets.items() if
+00003fc0: 2076 5b27 6261 7365 275d 2069 6e20 6261   v['base'] in ba
+00003fd0: 7365 5f63 7572 7265 6e63 6965 737d 0a20  se_currencies}. 
+00003fe0: 2020 2020 2020 2069 6620 7175 6f74 655f         if quote_
+00003ff0: 6375 7272 656e 6369 6573 3a0a 2020 2020  currencies:.    
+00004000: 2020 2020 2020 2020 6d61 726b 6574 7320          markets 
+00004010: 3d20 7b6b 3a20 7620 666f 7220 6b2c 2076  = {k: v for k, v
+00004020: 2069 6e20 6d61 726b 6574 732e 6974 656d   in markets.item
+00004030: 7328 2920 6966 2076 5b27 7175 6f74 6527  s() if v['quote'
+00004040: 5d20 696e 2071 756f 7465 5f63 7572 7265  ] in quote_curre
+00004050: 6e63 6965 737d 0a20 2020 2020 2020 2069  ncies}.        i
+00004060: 6620 7472 6164 6162 6c65 5f6f 6e6c 793a  f tradable_only:
+00004070: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
+00004080: 6b65 7473 203d 207b 6b3a 2076 2066 6f72  kets = {k: v for
+00004090: 206b 2c20 7620 696e 206d 6172 6b65 7473   k, v in markets
+000040a0: 2e69 7465 6d73 2829 2069 6620 7365 6c66  .items() if self
+000040b0: 2e6d 6172 6b65 745f 6973 5f74 7261 6461  .market_is_trada
+000040c0: 626c 6528 7629 7d0a 2020 2020 2020 2020  ble(v)}.        
+000040d0: 6966 2073 706f 745f 6f6e 6c79 3a0a 2020  if spot_only:.  
+000040e0: 2020 2020 2020 2020 2020 6d61 726b 6574            market
+000040f0: 7320 3d20 7b6b 3a20 7620 666f 7220 6b2c  s = {k: v for k,
+00004100: 2076 2069 6e20 6d61 726b 6574 732e 6974   v in markets.it
+00004110: 656d 7328 2920 6966 2073 656c 662e 6d61  ems() if self.ma
+00004120: 726b 6574 5f69 735f 7370 6f74 2876 297d  rket_is_spot(v)}
+00004130: 0a20 2020 2020 2020 2069 6620 6d61 7267  .        if marg
+00004140: 696e 5f6f 6e6c 793a 0a20 2020 2020 2020  in_only:.       
+00004150: 2020 2020 206d 6172 6b65 7473 203d 207b       markets = {
+00004160: 6b3a 2076 2066 6f72 206b 2c20 7620 696e  k: v for k, v in
+00004170: 206d 6172 6b65 7473 2e69 7465 6d73 2829   markets.items()
+00004180: 2069 6620 7365 6c66 2e6d 6172 6b65 745f   if self.market_
+00004190: 6973 5f6d 6172 6769 6e28 7629 7d0a 2020  is_margin(v)}.  
+000041a0: 2020 2020 2020 6966 2066 7574 7572 6573        if futures
+000041b0: 5f6f 6e6c 793a 0a20 2020 2020 2020 2020  _only:.         
+000041c0: 2020 206d 6172 6b65 7473 203d 207b 6b3a     markets = {k:
+000041d0: 2076 2066 6f72 206b 2c20 7620 696e 206d   v for k, v in m
+000041e0: 6172 6b65 7473 2e69 7465 6d73 2829 2069  arkets.items() i
+000041f0: 6620 7365 6c66 2e6d 6172 6b65 745f 6973  f self.market_is
+00004200: 5f66 7574 7572 6528 7629 7d0a 2020 2020  _future(v)}.    
+00004210: 2020 2020 6966 2061 6374 6976 655f 6f6e      if active_on
+00004220: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+00004230: 6d61 726b 6574 7320 3d20 7b6b 3a20 7620  markets = {k: v 
+00004240: 666f 7220 6b2c 2076 2069 6e20 6d61 726b  for k, v in mark
+00004250: 6574 732e 6974 656d 7328 2920 6966 206d  ets.items() if m
+00004260: 6172 6b65 745f 6973 5f61 6374 6976 6528  arket_is_active(
+00004270: 7629 7d0a 2020 2020 2020 2020 7265 7475  v)}.        retu
+00004280: 726e 206d 6172 6b65 7473 0a0a 2020 2020  rn markets..    
+00004290: 6465 6620 6765 745f 7175 6f74 655f 6375  def get_quote_cu
+000042a0: 7272 656e 6369 6573 2873 656c 6629 202d  rrencies(self) -
+000042b0: 3e20 4c69 7374 5b73 7472 5d3a 0a20 2020  > List[str]:.   
+000042c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000042d0: 2052 6574 7572 6e20 6120 6c69 7374 206f   Return a list o
+000042e0: 6620 7375 7070 6f72 7465 6420 7175 6f74  f supported quot
+000042f0: 6520 6375 7272 656e 6369 6573 0a20 2020  e currencies.   
+00004300: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00004310: 206d 6172 6b65 7473 203d 2073 656c 662e   markets = self.
+00004320: 6d61 726b 6574 730a 2020 2020 2020 2020  markets.        
+00004330: 7265 7475 726e 2073 6f72 7465 6428 7365  return sorted(se
+00004340: 7428 5b78 5b27 7175 6f74 6527 5d20 666f  t([x['quote'] fo
+00004350: 7220 5f2c 2078 2069 6e20 6d61 726b 6574  r _, x in market
+00004360: 732e 6974 656d 7328 295d 2929 0a0a 2020  s.items()]))..  
+00004370: 2020 6465 6620 6765 745f 7061 6972 5f71    def get_pair_q
+00004380: 756f 7465 5f63 7572 7265 6e63 7928 7365  uote_currency(se
+00004390: 6c66 2c20 7061 6972 3a20 7374 7229 202d  lf, pair: str) -
+000043a0: 3e20 7374 723a 0a20 2020 2020 2020 2022  > str:.        "
+000043b0: 2222 2052 6574 7572 6e20 6120 7061 6972  "" Return a pair
+000043c0: 2773 2071 756f 7465 2063 7572 7265 6e63  's quote currenc
+000043d0: 7920 2862 6173 652f 7175 6f74 653a 7365  y (base/quote:se
+000043e0: 7474 6c65 6d65 6e74 2920 2222 220a 2020  ttlement) """.  
+000043f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00004400: 662e 6d61 726b 6574 732e 6765 7428 7061  f.markets.get(pa
+00004410: 6972 2c20 7b7d 292e 6765 7428 2771 756f  ir, {}).get('quo
+00004420: 7465 272c 2027 2729 0a0a 2020 2020 6465  te', '')..    de
+00004430: 6620 6765 745f 7061 6972 5f62 6173 655f  f get_pair_base_
+00004440: 6375 7272 656e 6379 2873 656c 662c 2070  currency(self, p
+00004450: 6169 723a 2073 7472 2920 2d3e 2073 7472  air: str) -> str
+00004460: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
+00004470: 7475 726e 2061 2070 6169 7227 7320 6261  turn a pair's ba
+00004480: 7365 2063 7572 7265 6e63 7920 2862 6173  se currency (bas
+00004490: 652f 7175 6f74 653a 7365 7474 6c65 6d65  e/quote:settleme
+000044a0: 6e74 2920 2222 220a 2020 2020 2020 2020  nt) """.        
+000044b0: 7265 7475 726e 2073 656c 662e 6d61 726b  return self.mark
+000044c0: 6574 732e 6765 7428 7061 6972 2c20 7b7d  ets.get(pair, {}
+000044d0: 292e 6765 7428 2762 6173 6527 2c20 2727  ).get('base', ''
+000044e0: 290a 0a20 2020 2064 6566 206d 6172 6b65  )..    def marke
+000044f0: 745f 6973 5f66 7574 7572 6528 7365 6c66  t_is_future(self
+00004500: 2c20 6d61 726b 6574 3a20 4469 6374 5b73  , market: Dict[s
+00004510: 7472 2c20 416e 795d 2920 2d3e 2062 6f6f  tr, Any]) -> boo
+00004520: 6c3a 0a20 2020 2020 2020 2072 6574 7572  l:.        retur
+00004530: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
+00004540: 6d61 726b 6574 2e67 6574 2873 656c 662e  market.get(self.
+00004550: 5f66 745f 6861 735b 2263 6378 745f 6675  _ft_has["ccxt_fu
+00004560: 7475 7265 735f 6e61 6d65 225d 2c20 4661  tures_name"], Fa
+00004570: 6c73 6529 2069 7320 5472 7565 2061 6e64  lse) is True and
+00004580: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
+00004590: 6b65 742e 6765 7428 276c 696e 6561 7227  ket.get('linear'
+000045a0: 2c20 4661 6c73 6529 2069 7320 5472 7565  , False) is True
+000045b0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+000045c0: 6465 6620 6d61 726b 6574 5f69 735f 7370  def market_is_sp
+000045d0: 6f74 2873 656c 662c 206d 6172 6b65 743a  ot(self, market:
+000045e0: 2044 6963 745b 7374 722c 2041 6e79 5d29   Dict[str, Any])
+000045f0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+00004600: 2020 7265 7475 726e 206d 6172 6b65 742e    return market.
+00004610: 6765 7428 2773 706f 7427 2c20 4661 6c73  get('spot', Fals
+00004620: 6529 2069 7320 5472 7565 0a0a 2020 2020  e) is True..    
+00004630: 6465 6620 6d61 726b 6574 5f69 735f 6d61  def market_is_ma
+00004640: 7267 696e 2873 656c 662c 206d 6172 6b65  rgin(self, marke
+00004650: 743a 2044 6963 745b 7374 722c 2041 6e79  t: Dict[str, Any
+00004660: 5d29 202d 3e20 626f 6f6c 3a0a 2020 2020  ]) -> bool:.    
+00004670: 2020 2020 7265 7475 726e 206d 6172 6b65      return marke
+00004680: 742e 6765 7428 276d 6172 6769 6e27 2c20  t.get('margin', 
+00004690: 4661 6c73 6529 2069 7320 5472 7565 0a0a  False) is True..
+000046a0: 2020 2020 6465 6620 6d61 726b 6574 5f69      def market_i
+000046b0: 735f 7472 6164 6162 6c65 2873 656c 662c  s_tradable(self,
+000046c0: 206d 6172 6b65 743a 2044 6963 745b 7374   market: Dict[st
+000046d0: 722c 2041 6e79 5d29 202d 3e20 626f 6f6c  r, Any]) -> bool
+000046e0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000046f0: 2020 2020 2020 4368 6563 6b20 6966 2074        Check if t
+00004700: 6865 206d 6172 6b65 7420 7379 6d62 6f6c  he market symbol
+00004710: 2069 7320 7472 6164 6162 6c65 2062 7920   is tradable by 
+00004720: 4672 6571 7472 6164 652e 0a20 2020 2020  Freqtrade..     
+00004730: 2020 2045 6e73 7572 6573 2074 6861 7420     Ensures that 
+00004740: 436f 6e66 6967 7572 6564 206d 6f64 6520  Configured mode 
+00004750: 616c 6967 6e73 2074 6f0a 2020 2020 2020  aligns to.      
+00004760: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00004770: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+00004780: 2020 206d 6172 6b65 742e 6765 7428 2771     market.get('q
+00004790: 756f 7465 272c 204e 6f6e 6529 2069 7320  uote', None) is 
+000047a0: 6e6f 7420 4e6f 6e65 0a20 2020 2020 2020  not None.       
+000047b0: 2020 2020 2061 6e64 206d 6172 6b65 742e       and market.
+000047c0: 6765 7428 2762 6173 6527 2c20 4e6f 6e65  get('base', None
+000047d0: 2920 6973 206e 6f74 204e 6f6e 650a 2020  ) is not None.  
+000047e0: 2020 2020 2020 2020 2020 616e 6420 2873            and (s
+000047f0: 656c 662e 7072 6563 6973 696f 6e4d 6f64  elf.precisionMod
+00004800: 6520 213d 2054 4943 4b5f 5349 5a45 0a20  e != TICK_SIZE. 
+00004810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004820: 2320 546f 6f20 6c6f 7720 7072 6563 6973  # Too low precis
+00004830: 696f 6e20 7769 6c6c 2066 616c 7369 6679  ion will falsify
+00004840: 2063 616c 6375 6c61 7469 6f6e 730a 2020   calculations.  
+00004850: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00004860: 7220 6d61 726b 6574 2e67 6574 2827 7072  r market.get('pr
+00004870: 6563 6973 696f 6e27 2c20 7b7d 292e 6765  ecision', {}).ge
+00004880: 7428 2770 7269 6365 2729 203e 2031 652d  t('price') > 1e-
+00004890: 3131 290a 2020 2020 2020 2020 2020 2020  11).            
+000048a0: 616e 6420 2828 7365 6c66 2e74 7261 6469  and ((self.tradi
+000048b0: 6e67 5f6d 6f64 6520 3d3d 2054 7261 6469  ng_mode == Tradi
+000048c0: 6e67 4d6f 6465 2e53 504f 5420 616e 6420  ngMode.SPOT and 
+000048d0: 7365 6c66 2e6d 6172 6b65 745f 6973 5f73  self.market_is_s
+000048e0: 706f 7428 6d61 726b 6574 2929 0a20 2020  pot(market)).   
+000048f0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00004900: 2028 7365 6c66 2e74 7261 6469 6e67 5f6d   (self.trading_m
+00004910: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
+00004920: 6465 2e4d 4152 4749 4e20 616e 6420 7365  de.MARGIN and se
+00004930: 6c66 2e6d 6172 6b65 745f 6973 5f6d 6172  lf.market_is_mar
+00004940: 6769 6e28 6d61 726b 6574 2929 0a20 2020  gin(market)).   
+00004950: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00004960: 2028 7365 6c66 2e74 7261 6469 6e67 5f6d   (self.trading_m
+00004970: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
+00004980: 6465 2e46 5554 5552 4553 2061 6e64 2073  de.FUTURES and s
+00004990: 656c 662e 6d61 726b 6574 5f69 735f 6675  elf.market_is_fu
+000049a0: 7475 7265 286d 6172 6b65 7429 2929 0a20  ture(market))). 
+000049b0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+000049c0: 6620 6b6c 696e 6573 2873 656c 662c 2070  f klines(self, p
+000049d0: 6169 725f 696e 7465 7276 616c 3a20 5061  air_interval: Pa
+000049e0: 6972 5769 7468 5469 6d65 6672 616d 652c  irWithTimeframe,
+000049f0: 2063 6f70 793a 2062 6f6f 6c20 3d20 5472   copy: bool = Tr
+00004a00: 7565 2920 2d3e 2044 6174 6146 7261 6d65  ue) -> DataFrame
+00004a10: 3a0a 2020 2020 2020 2020 6966 2070 6169  :.        if pai
+00004a20: 725f 696e 7465 7276 616c 2069 6e20 7365  r_interval in se
+00004a30: 6c66 2e5f 6b6c 696e 6573 3a0a 2020 2020  lf._klines:.    
+00004a40: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00004a50: 656c 662e 5f6b 6c69 6e65 735b 7061 6972  elf._klines[pair
+00004a60: 5f69 6e74 6572 7661 6c5d 2e63 6f70 7928  _interval].copy(
+00004a70: 2920 6966 2063 6f70 7920 656c 7365 2073  ) if copy else s
+00004a80: 656c 662e 5f6b 6c69 6e65 735b 7061 6972  elf._klines[pair
+00004a90: 5f69 6e74 6572 7661 6c5d 0a20 2020 2020  _interval].     
+00004aa0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00004ab0: 2020 2020 2072 6574 7572 6e20 4461 7461       return Data
+00004ac0: 4672 616d 6528 290a 0a20 2020 2064 6566  Frame()..    def
+00004ad0: 2067 6574 5f63 6f6e 7472 6163 745f 7369   get_contract_si
+00004ae0: 7a65 2873 656c 662c 2070 6169 723a 2073  ze(self, pair: s
+00004af0: 7472 2920 2d3e 204f 7074 696f 6e61 6c5b  tr) -> Optional[
+00004b00: 666c 6f61 745d 3a0a 2020 2020 2020 2020  float]:.        
+00004b10: 6966 2073 656c 662e 7472 6164 696e 675f  if self.trading_
+00004b20: 6d6f 6465 203d 3d20 5472 6164 696e 674d  mode == TradingM
+00004b30: 6f64 652e 4655 5455 5245 533a 0a20 2020  ode.FUTURES:.   
+00004b40: 2020 2020 2020 2020 206d 6172 6b65 7420           market 
+00004b50: 3d20 7365 6c66 2e6d 6172 6b65 7473 2e67  = self.markets.g
+00004b60: 6574 2870 6169 722c 207b 7d29 0a20 2020  et(pair, {}).   
+00004b70: 2020 2020 2020 2020 2063 6f6e 7472 6163           contrac
+00004b80: 745f 7369 7a65 3a20 666c 6f61 7420 3d20  t_size: float = 
+00004b90: 312e 300a 2020 2020 2020 2020 2020 2020  1.0.            
+00004ba0: 6966 206e 6f74 206d 6172 6b65 743a 0a20  if not market:. 
+00004bb0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00004bc0: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+00004bd0: 2020 2020 2020 2069 6620 6d61 726b 6574         if market
+00004be0: 2e67 6574 2827 636f 6e74 7261 6374 5369  .get('contractSi
+00004bf0: 7a65 2729 2069 7320 6e6f 7420 4e6f 6e65  ze') is not None
+00004c00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004c10: 2020 2320 6363 7874 2068 6173 2063 6f6e    # ccxt has con
+00004c20: 7472 6163 7453 697a 6520 696e 206d 6172  tractSize in mar
+00004c30: 6b65 7473 2061 7320 7374 7269 6e67 0a20  kets as string. 
+00004c40: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00004c50: 6f6e 7472 6163 745f 7369 7a65 203d 2066  ontract_size = f
+00004c60: 6c6f 6174 286d 6172 6b65 745b 2763 6f6e  loat(market['con
+00004c70: 7472 6163 7453 697a 6527 5d29 0a20 2020  tractSize']).   
+00004c80: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00004c90: 636f 6e74 7261 6374 5f73 697a 650a 2020  contract_size.  
+00004ca0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00004cb0: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
+00004cc0: 0a0a 2020 2020 6465 6620 5f74 7261 6465  ..    def _trade
+00004cd0: 735f 636f 6e74 7261 6374 735f 746f 5f61  s_contracts_to_a
+00004ce0: 6d6f 756e 7428 7365 6c66 2c20 7472 6164  mount(self, trad
+00004cf0: 6573 3a20 4c69 7374 2920 2d3e 204c 6973  es: List) -> Lis
+00004d00: 743a 0a20 2020 2020 2020 2069 6620 6c65  t:.        if le
+00004d10: 6e28 7472 6164 6573 2920 3e20 3020 616e  n(trades) > 0 an
+00004d20: 6420 2773 796d 626f 6c27 2069 6e20 7472  d 'symbol' in tr
+00004d30: 6164 6573 5b30 5d3a 0a20 2020 2020 2020  ades[0]:.       
+00004d40: 2020 2020 2063 6f6e 7472 6163 745f 7369       contract_si
+00004d50: 7a65 203d 2073 656c 662e 6765 745f 636f  ze = self.get_co
+00004d60: 6e74 7261 6374 5f73 697a 6528 7472 6164  ntract_size(trad
+00004d70: 6573 5b30 5d5b 2773 796d 626f 6c27 5d29  es[0]['symbol'])
+00004d80: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00004d90: 636f 6e74 7261 6374 5f73 697a 6520 213d  contract_size !=
+00004da0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
+00004db0: 2020 2020 666f 7220 7472 6164 6520 696e      for trade in
+00004dc0: 2074 7261 6465 733a 0a20 2020 2020 2020   trades:.       
+00004dd0: 2020 2020 2020 2020 2020 2020 2074 7261               tra
+00004de0: 6465 5b27 616d 6f75 6e74 275d 203d 2074  de['amount'] = t
+00004df0: 7261 6465 5b27 616d 6f75 6e74 275d 202a  rade['amount'] *
+00004e00: 2063 6f6e 7472 6163 745f 7369 7a65 0a20   contract_size. 
+00004e10: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
+00004e20: 6164 6573 0a0a 2020 2020 6465 6620 5f6f  ades..    def _o
+00004e30: 7264 6572 5f63 6f6e 7472 6163 7473 5f74  rder_contracts_t
+00004e40: 6f5f 616d 6f75 6e74 2873 656c 662c 206f  o_amount(self, o
+00004e50: 7264 6572 3a20 4469 6374 2920 2d3e 2044  rder: Dict) -> D
+00004e60: 6963 743a 0a20 2020 2020 2020 2069 6620  ict:.        if 
+00004e70: 2773 796d 626f 6c27 2069 6e20 6f72 6465  'symbol' in orde
+00004e80: 7220 616e 6420 6f72 6465 725b 2773 796d  r and order['sym
+00004e90: 626f 6c27 5d20 6973 206e 6f74 204e 6f6e  bol'] is not Non
+00004ea0: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
+00004eb0: 6f6e 7472 6163 745f 7369 7a65 203d 2073  ontract_size = s
+00004ec0: 656c 662e 6765 745f 636f 6e74 7261 6374  elf.get_contract
+00004ed0: 5f73 697a 6528 6f72 6465 725b 2773 796d  _size(order['sym
+00004ee0: 626f 6c27 5d29 0a20 2020 2020 2020 2020  bol']).         
+00004ef0: 2020 2069 6620 636f 6e74 7261 6374 5f73     if contract_s
+00004f00: 697a 6520 213d 2031 3a0a 2020 2020 2020  ize != 1:.      
+00004f10: 2020 2020 2020 2020 2020 666f 7220 7072            for pr
+00004f20: 6f70 2069 6e20 7365 6c66 2e5f 6674 5f68  op in self._ft_h
+00004f30: 6173 2e67 6574 2827 6f72 6465 725f 7072  as.get('order_pr
+00004f40: 6f70 735f 696e 5f63 6f6e 7472 6163 7473  ops_in_contracts
+00004f50: 272c 205b 5d29 3a0a 2020 2020 2020 2020  ', []):.        
+00004f60: 2020 2020 2020 2020 2020 2020 6966 2070              if p
+00004f70: 726f 7020 696e 206f 7264 6572 2061 6e64  rop in order and
+00004f80: 206f 7264 6572 5b70 726f 705d 2069 7320   order[prop] is 
+00004f90: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00004fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004fb0: 2020 6f72 6465 725b 7072 6f70 5d20 3d20    order[prop] = 
+00004fc0: 6f72 6465 725b 7072 6f70 5d20 2a20 636f  order[prop] * co
+00004fd0: 6e74 7261 6374 5f73 697a 650a 2020 2020  ntract_size.    
+00004fe0: 2020 2020 7265 7475 726e 206f 7264 6572      return order
+00004ff0: 0a0a 2020 2020 6465 6620 5f61 6d6f 756e  ..    def _amoun
+00005000: 745f 746f 5f63 6f6e 7472 6163 7473 2873  t_to_contracts(s
+00005010: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
+00005020: 616d 6f75 6e74 3a20 666c 6f61 7429 202d  amount: float) -
+00005030: 3e20 666c 6f61 743a 0a0a 2020 2020 2020  > float:..      
+00005040: 2020 636f 6e74 7261 6374 5f73 697a 6520    contract_size 
+00005050: 3d20 7365 6c66 2e67 6574 5f63 6f6e 7472  = self.get_contr
+00005060: 6163 745f 7369 7a65 2870 6169 7229 0a20  act_size(pair). 
+00005070: 2020 2020 2020 2072 6574 7572 6e20 616d         return am
+00005080: 6f75 6e74 5f74 6f5f 636f 6e74 7261 6374  ount_to_contract
+00005090: 7328 616d 6f75 6e74 2c20 636f 6e74 7261  s(amount, contra
+000050a0: 6374 5f73 697a 6529 0a0a 2020 2020 6465  ct_size)..    de
+000050b0: 6620 5f63 6f6e 7472 6163 7473 5f74 6f5f  f _contracts_to_
+000050c0: 616d 6f75 6e74 2873 656c 662c 2070 6169  amount(self, pai
+000050d0: 723a 2073 7472 2c20 6e75 6d5f 636f 6e74  r: str, num_cont
+000050e0: 7261 6374 733a 2066 6c6f 6174 2920 2d3e  racts: float) ->
+000050f0: 2066 6c6f 6174 3a0a 0a20 2020 2020 2020   float:..       
+00005100: 2063 6f6e 7472 6163 745f 7369 7a65 203d   contract_size =
+00005110: 2073 656c 662e 6765 745f 636f 6e74 7261   self.get_contra
+00005120: 6374 5f73 697a 6528 7061 6972 290a 2020  ct_size(pair).  
+00005130: 2020 2020 2020 7265 7475 726e 2063 6f6e        return con
+00005140: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
+00005150: 286e 756d 5f63 6f6e 7472 6163 7473 2c20  (num_contracts, 
+00005160: 636f 6e74 7261 6374 5f73 697a 6529 0a0a  contract_size)..
+00005170: 2020 2020 6465 6620 616d 6f75 6e74 5f74      def amount_t
+00005180: 6f5f 636f 6e74 7261 6374 5f70 7265 6369  o_contract_preci
+00005190: 7369 6f6e 2873 656c 662c 2070 6169 723a  sion(self, pair:
+000051a0: 2073 7472 2c20 616d 6f75 6e74 3a20 666c   str, amount: fl
+000051b0: 6f61 7429 202d 3e20 666c 6f61 743a 0a20  oat) -> float:. 
+000051c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000051d0: 2020 2048 656c 7065 7220 7772 6170 7065     Helper wrappe
+000051e0: 7220 6172 6f75 6e64 2061 6d6f 756e 745f  r around amount_
+000051f0: 746f 5f63 6f6e 7472 6163 745f 7072 6563  to_contract_prec
+00005200: 6973 696f 6e0a 2020 2020 2020 2020 2222  ision.        ""
+00005210: 220a 2020 2020 2020 2020 636f 6e74 7261  ".        contra
+00005220: 6374 5f73 697a 6520 3d20 7365 6c66 2e67  ct_size = self.g
+00005230: 6574 5f63 6f6e 7472 6163 745f 7369 7a65  et_contract_size
+00005240: 2870 6169 7229 0a0a 2020 2020 2020 2020  (pair)..        
+00005250: 7265 7475 726e 2061 6d6f 756e 745f 746f  return amount_to
+00005260: 5f63 6f6e 7472 6163 745f 7072 6563 6973  _contract_precis
+00005270: 696f 6e28 616d 6f75 6e74 2c20 7365 6c66  ion(amount, self
+00005280: 2e67 6574 5f70 7265 6369 7369 6f6e 5f61  .get_precision_a
+00005290: 6d6f 756e 7428 7061 6972 292c 0a20 2020  mount(pair),.   
+000052a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000052c0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+000052d0: 6563 6973 696f 6e4d 6f64 652c 2063 6f6e  ecisionMode, con
+000052e0: 7472 6163 745f 7369 7a65 290a 0a20 2020  tract_size)..   
+000052f0: 2064 6566 205f 6c6f 6164 5f61 7379 6e63   def _load_async
+00005300: 5f6d 6172 6b65 7473 2873 656c 662c 2072  _markets(self, r
+00005310: 656c 6f61 643a 2062 6f6f 6c20 3d20 4661  eload: bool = Fa
+00005320: 6c73 6529 202d 3e20 4e6f 6e65 3a0a 2020  lse) -> None:.  
+00005330: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00005340: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00005350: 6170 695f 6173 796e 633a 0a20 2020 2020  api_async:.     
+00005360: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005370: 6c6f 6f70 2e72 756e 5f75 6e74 696c 5f63  loop.run_until_c
+00005380: 6f6d 706c 6574 6528 0a20 2020 2020 2020  omplete(.       
+00005390: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+000053a0: 662e 5f61 7069 5f61 7379 6e63 2e6c 6f61  f._api_async.loa
+000053b0: 645f 6d61 726b 6574 7328 7265 6c6f 6164  d_markets(reload
+000053c0: 3d72 656c 6f61 642c 2070 6172 616d 733d  =reload, params=
+000053d0: 7b7d 2929 0a0a 2020 2020 2020 2020 6578  {}))..        ex
+000053e0: 6365 7074 2028 6173 796e 6369 6f2e 5469  cept (asyncio.Ti
+000053f0: 6d65 6f75 7445 7272 6f72 2c20 6363 7874  meoutError, ccxt
+00005400: 2e42 6173 6545 7272 6f72 2920 6173 2065  .BaseError) as e
+00005410: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00005420: 6767 6572 2e77 6172 6e69 6e67 2827 436f  gger.warning('Co
+00005430: 756c 6420 6e6f 7420 6c6f 6164 2061 7379  uld not load asy
+00005440: 6e63 206d 6172 6b65 7473 2e20 5265 6173  nc markets. Reas
+00005450: 6f6e 3a20 2573 272c 2065 290a 2020 2020  on: %s', e).    
+00005460: 2020 2020 2020 2020 7265 7475 726e 0a0a          return..
+00005470: 2020 2020 6465 6620 5f6c 6f61 645f 6d61      def _load_ma
+00005480: 726b 6574 7328 7365 6c66 2920 2d3e 204e  rkets(self) -> N
+00005490: 6f6e 653a 0a20 2020 2020 2020 2022 2222  one:.        """
+000054a0: 2049 6e69 7469 616c 697a 6520 6d61 726b   Initialize mark
+000054b0: 6574 7320 626f 7468 2073 796e 6320 616e  ets both sync an
+000054c0: 6420 6173 796e 6320 2222 220a 2020 2020  d async """.    
+000054d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+000054e0: 2020 2020 2073 656c 662e 5f6d 6172 6b65       self._marke
+000054f0: 7473 203d 2073 656c 662e 5f61 7069 2e6c  ts = self._api.l
+00005500: 6f61 645f 6d61 726b 6574 7328 7061 7261  oad_markets(para
+00005510: 6d73 3d7b 7d29 0a20 2020 2020 2020 2020  ms={}).         
+00005520: 2020 2073 656c 662e 5f6c 6f61 645f 6173     self._load_as
+00005530: 796e 635f 6d61 726b 6574 7328 290a 2020  ync_markets().  
+00005540: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00005550: 6c61 7374 5f6d 6172 6b65 7473 5f72 6566  last_markets_ref
+00005560: 7265 7368 203d 2064 745f 7473 2829 0a20  resh = dt_ts(). 
+00005570: 2020 2020 2020 2020 2020 2069 6620 7365             if se
+00005580: 6c66 2e5f 6674 5f68 6173 5b27 6e65 6564  lf._ft_has['need
+00005590: 735f 7472 6164 696e 675f 6665 6573 275d  s_trading_fees']
+000055a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000055b0: 2020 7365 6c66 2e5f 7472 6164 696e 675f    self._trading_
+000055c0: 6665 6573 203d 2073 656c 662e 6665 7463  fees = self.fetc
+000055d0: 685f 7472 6164 696e 675f 6665 6573 2829  h_trading_fees()
+000055e0: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+000055f0: 2063 6378 742e 4261 7365 4572 726f 723a   ccxt.BaseError:
+00005600: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+00005610: 6765 722e 6578 6365 7074 696f 6e28 2755  ger.exception('U
+00005620: 6e61 626c 6520 746f 2069 6e69 7469 616c  nable to initial
+00005630: 697a 6520 6d61 726b 6574 732e 2729 0a0a  ize markets.')..
+00005640: 2020 2020 6465 6620 7265 6c6f 6164 5f6d      def reload_m
+00005650: 6172 6b65 7473 2873 656c 662c 2066 6f72  arkets(self, for
+00005660: 6365 3a20 626f 6f6c 203d 2046 616c 7365  ce: bool = False
+00005670: 2920 2d3e 204e 6f6e 653a 0a20 2020 2020  ) -> None:.     
+00005680: 2020 2022 2222 5265 6c6f 6164 206d 6172     """Reload mar
+00005690: 6b65 7473 2062 6f74 6820 7379 6e63 2061  kets both sync a
+000056a0: 6e64 2061 7379 6e63 2069 6620 7265 6672  nd async if refr
+000056b0: 6573 6820 696e 7465 7276 616c 2068 6173  esh interval has
+000056c0: 2070 6173 7365 6420 2222 220a 2020 2020   passed """.    
+000056d0: 2020 2020 2320 4368 6563 6b20 7768 6574      # Check whet
+000056e0: 6865 7220 6d61 726b 6574 7320 6861 7665  her markets have
+000056f0: 2074 6f20 6265 2072 656c 6f61 6465 640a   to be reloaded.
+00005700: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+00005710: 2020 2020 2020 2020 206e 6f74 2066 6f72           not for
+00005720: 6365 0a20 2020 2020 2020 2020 2020 2061  ce.            a
+00005730: 6e64 2073 656c 662e 5f6c 6173 745f 6d61  nd self._last_ma
+00005740: 726b 6574 735f 7265 6672 6573 6820 3e20  rkets_refresh > 
+00005750: 300a 2020 2020 2020 2020 2020 2020 616e  0.            an
+00005760: 6420 2873 656c 662e 5f6c 6173 745f 6d61  d (self._last_ma
+00005770: 726b 6574 735f 7265 6672 6573 6820 2b20  rkets_refresh + 
+00005780: 7365 6c66 2e6d 6172 6b65 7473 5f72 6566  self.markets_ref
+00005790: 7265 7368 5f69 6e74 6572 7661 6c20 3e20  resh_interval > 
+000057a0: 6474 5f74 7328 2929 0a20 2020 2020 2020  dt_ts()).       
+000057b0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+000057c0: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
+000057d0: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
+000057e0: 2822 5065 7266 6f72 6d69 6e67 2073 6368  ("Performing sch
+000057f0: 6564 756c 6564 206d 6172 6b65 7420 7265  eduled market re
+00005800: 6c6f 6164 2e2e 2229 0a20 2020 2020 2020  load..").       
+00005810: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00005820: 2020 7365 6c66 2e5f 6d61 726b 6574 7320    self._markets 
+00005830: 3d20 7365 6c66 2e5f 6170 692e 6c6f 6164  = self._api.load
+00005840: 5f6d 6172 6b65 7473 2872 656c 6f61 643d  _markets(reload=
+00005850: 5472 7565 2c20 7061 7261 6d73 3d7b 7d29  True, params={})
+00005860: 0a20 2020 2020 2020 2020 2020 2023 2041  .            # A
+00005870: 6c73 6f20 7265 6c6f 6164 2061 7379 6e63  lso reload async
+00005880: 206d 6172 6b65 7473 2074 6f20 6176 6f69   markets to avoi
+00005890: 6420 6973 7375 6573 2077 6974 6820 6e65  d issues with ne
+000058a0: 776c 7920 6c69 7374 6564 2070 6169 7273  wly listed pairs
+000058b0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+000058c0: 662e 5f6c 6f61 645f 6173 796e 635f 6d61  f._load_async_ma
+000058d0: 726b 6574 7328 7265 6c6f 6164 3d54 7275  rkets(reload=Tru
+000058e0: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+000058f0: 656c 662e 5f6c 6173 745f 6d61 726b 6574  elf._last_market
+00005900: 735f 7265 6672 6573 6820 3d20 6474 5f74  s_refresh = dt_t
+00005910: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+00005920: 7365 6c66 2e66 696c 6c5f 6c65 7665 7261  self.fill_levera
+00005930: 6765 5f74 6965 7273 2829 0a20 2020 2020  ge_tiers().     
+00005940: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
+00005950: 6173 6545 7272 6f72 3a0a 2020 2020 2020  aseError:.      
+00005960: 2020 2020 2020 6c6f 6767 6572 2e65 7863        logger.exc
+00005970: 6570 7469 6f6e 2822 436f 756c 6420 6e6f  eption("Could no
+00005980: 7420 7265 6c6f 6164 206d 6172 6b65 7473  t reload markets
+00005990: 2e22 290a 0a20 2020 2064 6566 2076 616c  .")..    def val
+000059a0: 6964 6174 655f 7374 616b 6563 7572 7265  idate_stakecurre
+000059b0: 6e63 7928 7365 6c66 2c20 7374 616b 655f  ncy(self, stake_
+000059c0: 6375 7272 656e 6379 3a20 7374 7229 202d  currency: str) -
+000059d0: 3e20 4e6f 6e65 3a0a 2020 2020 2020 2020  > None:.        
+000059e0: 2222 220a 2020 2020 2020 2020 4368 6563  """.        Chec
+000059f0: 6b73 2073 7461 6b65 2d63 7572 7265 6e63  ks stake-currenc
+00005a00: 7920 6167 6169 6e73 7420 6176 6169 6c61  y against availa
+00005a10: 626c 6520 6375 7272 656e 6369 6573 206f  ble currencies o
+00005a20: 6e20 7468 6520 6578 6368 616e 6765 2e0a  n the exchange..
+00005a30: 2020 2020 2020 2020 4f6e 6c79 2072 756e          Only run
+00005a40: 7320 6f6e 2073 7461 7274 7570 2e20 4966  s on startup. If
+00005a50: 206d 6172 6b65 7473 2068 6176 6520 6e6f   markets have no
+00005a60: 7420 6265 656e 206c 6f61 6465 642c 2074  t been loaded, t
+00005a70: 6865 7265 2773 2062 6565 6e20 6120 7072  here's been a pr
+00005a80: 6f62 6c65 6d20 7769 7468 0a20 2020 2020  oblem with.     
+00005a90: 2020 2074 6865 2063 6f6e 6e65 6374 696f     the connectio
+00005aa0: 6e20 746f 2074 6865 2065 7863 6861 6e67  n to the exchang
+00005ab0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+00005ac0: 6d20 7374 616b 655f 6375 7272 656e 6379  m stake_currency
+00005ad0: 3a20 5374 616b 652d 6375 7272 656e 6379  : Stake-currency
+00005ae0: 2074 6f20 7661 6c69 6461 7465 0a20 2020   to validate.   
+00005af0: 2020 2020 203a 7261 6973 653a 204f 7065       :raise: Ope
+00005b00: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
+00005b10: 6e20 6966 2073 7461 6b65 2d63 7572 7265  n if stake-curre
+00005b20: 6e63 7920 6973 206e 6f74 2061 7661 696c  ncy is not avail
+00005b30: 6162 6c65 2e0a 2020 2020 2020 2020 2222  able..        ""
+00005b40: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
+00005b50: 2073 656c 662e 5f6d 6172 6b65 7473 3a0a   self._markets:.
+00005b60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00005b70: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+00005b80: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+00005b90: 2020 2020 2020 2020 2743 6f75 6c64 206e          'Could n
+00005ba0: 6f74 206c 6f61 6420 6d61 726b 6574 732c  ot load markets,
+00005bb0: 2074 6865 7265 666f 7265 2063 616e 6e6f   therefore canno
+00005bc0: 7420 7374 6172 742e 2027 0a20 2020 2020  t start. '.     
+00005bd0: 2020 2020 2020 2020 2020 2027 506c 6561             'Plea
+00005be0: 7365 2069 6e76 6573 7469 6761 7465 2074  se investigate t
+00005bf0: 6865 2061 626f 7665 2065 7272 6f72 2066  he above error f
+00005c00: 6f72 206d 6f72 6520 6465 7461 696c 732e  or more details.
+00005c10: 270a 2020 2020 2020 2020 2020 2020 290a  '.            ).
+00005c20: 2020 2020 2020 2020 7175 6f74 655f 6375          quote_cu
+00005c30: 7272 656e 6369 6573 203d 2073 656c 662e  rrencies = self.
+00005c40: 6765 745f 7175 6f74 655f 6375 7272 656e  get_quote_curren
+00005c50: 6369 6573 2829 0a20 2020 2020 2020 2069  cies().        i
+00005c60: 6620 7374 616b 655f 6375 7272 656e 6379  f stake_currency
+00005c70: 206e 6f74 2069 6e20 7175 6f74 655f 6375   not in quote_cu
+00005c80: 7272 656e 6369 6573 3a0a 2020 2020 2020  rrencies:.      
+00005c90: 2020 2020 2020 7261 6973 6520 436f 6e66        raise Conf
+00005ca0: 6967 7572 6174 696f 6e45 7272 6f72 280a  igurationError(.
+00005cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005cc0: 6622 7b73 7461 6b65 5f63 7572 7265 6e63  f"{stake_currenc
+00005cd0: 797d 2069 7320 6e6f 7420 6176 6169 6c61  y} is not availa
+00005ce0: 626c 6520 6173 2073 7461 6b65 206f 6e20  ble as stake on 
+00005cf0: 7b73 656c 662e 6e61 6d65 7d2e 2022 0a20  {self.name}. ". 
+00005d00: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00005d10: 2241 7661 696c 6162 6c65 2063 7572 7265  "Available curre
+00005d20: 6e63 6965 7320 6172 653a 207b 272c 2027  ncies are: {', '
+00005d30: 2e6a 6f69 6e28 7175 6f74 655f 6375 7272  .join(quote_curr
+00005d40: 656e 6369 6573 297d 2229 0a0a 2020 2020  encies)}")..    
+00005d50: 6465 6620 7661 6c69 6461 7465 5f70 6169  def validate_pai
+00005d60: 7273 2873 656c 662c 2070 6169 7273 3a20  rs(self, pairs: 
+00005d70: 4c69 7374 5b73 7472 5d29 202d 3e20 4e6f  List[str]) -> No
+00005d80: 6e65 3a0a 2020 2020 2020 2020 2222 220a  ne:.        """.
+00005d90: 2020 2020 2020 2020 4368 6563 6b73 2069          Checks i
+00005da0: 6620 616c 6c20 6769 7665 6e20 7061 6972  f all given pair
+00005db0: 7320 6172 6520 7472 6164 6162 6c65 206f  s are tradable o
+00005dc0: 6e20 7468 6520 6375 7272 656e 7420 6578  n the current ex
+00005dd0: 6368 616e 6765 2e0a 2020 2020 2020 2020  change..        
+00005de0: 3a70 6172 616d 2070 6169 7273 3a20 6c69  :param pairs: li
+00005df0: 7374 206f 6620 7061 6972 730a 2020 2020  st of pairs.    
+00005e00: 2020 2020 3a72 6169 7365 3a20 4f70 6572      :raise: Oper
+00005e10: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+00005e20: 2069 6620 6f6e 6520 7061 6972 2069 7320   if one pair is 
+00005e30: 6e6f 7420 6176 6169 6c61 626c 650a 2020  not available.  
+00005e40: 2020 2020 2020 3a72 6574 7572 6e3a 204e        :return: N
+00005e50: 6f6e 650a 2020 2020 2020 2020 2222 220a  one.        """.
+00005e60: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00005e70: 7365 6c66 2e6d 6172 6b65 7473 3a0a 2020  self.markets:.  
+00005e80: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00005e90: 2e77 6172 6e69 6e67 2827 556e 6162 6c65  .warning('Unable
+00005ea0: 2074 6f20 7661 6c69 6461 7465 2070 6169   to validate pai
+00005eb0: 7273 2028 6173 7375 6d69 6e67 2074 6865  rs (assuming the
+00005ec0: 7920 6172 6520 636f 7272 6563 7429 2e27  y are correct).'
+00005ed0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00005ee0: 7475 726e 0a20 2020 2020 2020 2065 7874  turn.        ext
+00005ef0: 656e 6465 645f 7061 6972 7320 3d20 6578  ended_pairs = ex
+00005f00: 7061 6e64 5f70 6169 726c 6973 7428 7061  pand_pairlist(pa
+00005f10: 6972 732c 206c 6973 7428 7365 6c66 2e6d  irs, list(self.m
+00005f20: 6172 6b65 7473 292c 206b 6565 705f 696e  arkets), keep_in
+00005f30: 7661 6c69 643d 5472 7565 290a 2020 2020  valid=True).    
+00005f40: 2020 2020 696e 7661 6c69 645f 7061 6972      invalid_pair
+00005f50: 7320 3d20 5b5d 0a20 2020 2020 2020 2066  s = [].        f
+00005f60: 6f72 2070 6169 7220 696e 2065 7874 656e  or pair in exten
+00005f70: 6465 645f 7061 6972 733a 0a20 2020 2020  ded_pairs:.     
+00005f80: 2020 2020 2020 2023 204e 6f74 653a 2063         # Note: c
+00005f90: 6378 7420 6861 7320 4261 7365 4375 7272  cxt has BaseCurr
+00005fa0: 656e 6379 2f51 756f 7465 4375 7272 656e  ency/QuoteCurren
+00005fb0: 6379 2066 6f72 6d61 7420 666f 7220 7061  cy format for pa
+00005fc0: 6972 730a 2020 2020 2020 2020 2020 2020  irs.            
+00005fd0: 6966 2073 656c 662e 6d61 726b 6574 7320  if self.markets 
+00005fe0: 616e 6420 7061 6972 206e 6f74 2069 6e20  and pair not in 
+00005ff0: 7365 6c66 2e6d 6172 6b65 7473 3a0a 2020  self.markets:.  
+00006000: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00006010: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+00006020: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+00006030: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+00006040: 5061 6972 207b 7061 6972 7d20 6973 206e  Pair {pair} is n
+00006050: 6f74 2061 7661 696c 6162 6c65 206f 6e20  ot available on 
+00006060: 7b73 656c 662e 6e61 6d65 7d20 7b73 656c  {self.name} {sel
+00006070: 662e 7472 6164 696e 675f 6d6f 6465 2e76  f.trading_mode.v
+00006080: 616c 7565 7d2e 2027 0a20 2020 2020 2020  alue}. '.       
+00006090: 2020 2020 2020 2020 2020 2020 2066 2750               f'P
+000060a0: 6c65 6173 6520 7265 6d6f 7665 207b 7061  lease remove {pa
+000060b0: 6972 7d20 6672 6f6d 2079 6f75 7220 7768  ir} from your wh
+000060c0: 6974 656c 6973 742e 2729 0a0a 2020 2020  itelist.')..    
+000060d0: 2020 2020 2020 2020 2020 2020 2320 4672              # Fr
+000060e0: 6f6d 2063 6378 7420 446f 6375 6d65 6e74  om ccxt Document
+000060f0: 6174 696f 6e3a 0a20 2020 2020 2020 2020  ation:.         
+00006100: 2020 2020 2020 2023 206d 6172 6b65 7473         # markets
+00006110: 2e69 6e66 6f3a 2041 6e20 6173 736f 6369  .info: An associ
+00006120: 6174 6976 6520 6172 7261 7920 6f66 206e  ative array of n
+00006130: 6f6e 2d63 6f6d 6d6f 6e20 6d61 726b 6574  on-common market
+00006140: 2070 726f 7065 7274 6965 732c 0a20 2020   properties,.   
+00006150: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+00006160: 6e63 6c75 6469 6e67 2066 6565 732c 2072  ncluding fees, r
+00006170: 6174 6573 2c20 6c69 6d69 7473 2061 6e64  ates, limits and
+00006180: 206f 7468 6572 2067 656e 6572 616c 206d   other general m
+00006190: 6172 6b65 7420 696e 666f 726d 6174 696f  arket informatio
+000061a0: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
+000061b0: 2020 2023 2054 6865 2069 6e74 6572 6e61     # The interna
+000061c0: 6c20 696e 666f 2061 7272 6179 2069 7320  l info array is 
+000061d0: 6469 6666 6572 656e 7420 666f 7220 6561  different for ea
+000061e0: 6368 2070 6172 7469 6375 6c61 7220 6d61  ch particular ma
+000061f0: 726b 6574 2c0a 2020 2020 2020 2020 2020  rket,.          
+00006200: 2020 2020 2020 2320 6974 7320 636f 6e74        # its cont
+00006210: 656e 7473 2064 6570 656e 6420 6f6e 2074  ents depend on t
+00006220: 6865 2065 7863 6861 6e67 652e 0a20 2020  he exchange..   
+00006230: 2020 2020 2020 2020 2020 2020 2023 2049               # I
+00006240: 7420 6361 6e20 616c 736f 2062 6520 6120  t can also be a 
+00006250: 7374 7269 6e67 206f 7220 7369 6d69 6c61  string or simila
+00006260: 7220 2e2e 2e20 736f 2077 6520 6e65 6564  r ... so we need
+00006270: 2074 6f20 7665 7269 6679 2074 6861 7420   to verify that 
+00006280: 6669 7273 742e 0a20 2020 2020 2020 2020  first..         
+00006290: 2020 2065 6c69 6620 2869 7369 6e73 7461     elif (isinsta
+000062a0: 6e63 6528 7365 6c66 2e6d 6172 6b65 7473  nce(self.markets
+000062b0: 5b70 6169 725d 2e67 6574 2827 696e 666f  [pair].get('info
+000062c0: 2729 2c20 6469 6374 290a 2020 2020 2020  '), dict).      
+000062d0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+000062e0: 7365 6c66 2e6d 6172 6b65 7473 5b70 6169  self.markets[pai
+000062f0: 725d 2e67 6574 2827 696e 666f 272c 207b  r].get('info', {
+00006300: 7d29 2e67 6574 2827 7072 6f68 6962 6974  }).get('prohibit
+00006310: 6564 496e 272c 2046 616c 7365 2929 3a0a  edIn', False)):.
+00006320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006330: 2320 5761 726e 2075 7365 7273 2061 626f  # Warn users abo
+00006340: 7574 2072 6573 7472 6963 7465 6420 7061  ut restricted pa
+00006350: 6972 7320 696e 2077 6869 7465 6c69 7374  irs in whitelist
+00006360: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
+00006370: 2020 2320 5765 2063 616e 6e6f 7420 6465    # We cannot de
+00006380: 7465 726d 696e 6520 7265 6c69 6162 6c79  termine reliably
+00006390: 2069 6620 5573 6572 7320 6172 6520 6166   if Users are af
+000063a0: 6665 6374 6564 2e0a 2020 2020 2020 2020  fected..        
+000063b0: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+000063c0: 6172 6e69 6e67 2866 2250 6169 7220 7b70  arning(f"Pair {p
+000063d0: 6169 727d 2069 7320 7265 7374 7269 6374  air} is restrict
+000063e0: 6564 2066 6f72 2073 6f6d 6520 7573 6572  ed for some user
+000063f0: 7320 6f6e 2074 6869 7320 6578 6368 616e  s on this exchan
+00006400: 6765 2e22 0a20 2020 2020 2020 2020 2020  ge.".           
+00006410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006420: 2020 2020 6622 506c 6561 7365 2063 6865      f"Please che
+00006430: 636b 2069 6620 796f 7520 6172 6520 696d  ck if you are im
+00006440: 7061 6374 6564 2062 7920 7468 6973 2072  pacted by this r
+00006450: 6573 7472 6963 7469 6f6e 2022 0a20 2020  estriction ".   
+00006460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006470: 2020 2020 2020 2020 2020 2020 6622 6f6e              f"on
+00006480: 2074 6865 2065 7863 6861 6e67 6520 616e   the exchange an
+00006490: 6420 6576 656e 7475 616c 6c79 2072 656d  d eventually rem
+000064a0: 6f76 6520 7b70 6169 727d 2066 726f 6d20  ove {pair} from 
+000064b0: 796f 7572 2077 6869 7465 6c69 7374 2e22  your whitelist."
+000064c0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+000064d0: 2028 7365 6c66 2e5f 636f 6e66 6967 5b27   (self._config['
+000064e0: 7374 616b 655f 6375 7272 656e 6379 275d  stake_currency']
+000064f0: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
+00006500: 2020 2020 2020 2020 2073 656c 662e 6765           self.ge
+00006510: 745f 7061 6972 5f71 756f 7465 5f63 7572  t_pair_quote_cur
+00006520: 7265 6e63 7928 7061 6972 2920 213d 2073  rency(pair) != s
+00006530: 656c 662e 5f63 6f6e 6669 675b 2773 7461  elf._config['sta
+00006540: 6b65 5f63 7572 7265 6e63 7927 5d29 3a0a  ke_currency']):.
+00006550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006560: 696e 7661 6c69 645f 7061 6972 732e 6170  invalid_pairs.ap
+00006570: 7065 6e64 2870 6169 7229 0a20 2020 2020  pend(pair).     
+00006580: 2020 2069 6620 696e 7661 6c69 645f 7061     if invalid_pa
+00006590: 6972 733a 0a20 2020 2020 2020 2020 2020  irs:.           
+000065a0: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+000065b0: 616c 4578 6365 7074 696f 6e28 0a20 2020  alException(.   
+000065c0: 2020 2020 2020 2020 2020 2020 2066 2253               f"S
+000065d0: 7461 6b65 2d63 7572 7265 6e63 7920 277b  take-currency '{
+000065e0: 7365 6c66 2e5f 636f 6e66 6967 5b27 7374  self._config['st
+000065f0: 616b 655f 6375 7272 656e 6379 275d 7d27  ake_currency']}'
+00006600: 206e 6f74 2063 6f6d 7061 7469 626c 6520   not compatible 
+00006610: 7769 7468 2022 0a20 2020 2020 2020 2020  with ".         
+00006620: 2020 2020 2020 2066 2270 6169 722d 7768         f"pair-wh
+00006630: 6974 656c 6973 742e 2050 6c65 6173 6520  itelist. Please 
+00006640: 7265 6d6f 7665 2074 6865 2066 6f6c 6c6f  remove the follo
+00006650: 7769 6e67 2070 6169 7273 3a20 7b69 6e76  wing pairs: {inv
+00006660: 616c 6964 5f70 6169 7273 7d22 290a 0a20  alid_pairs}").. 
+00006670: 2020 2064 6566 2067 6574 5f76 616c 6964     def get_valid
+00006680: 5f70 6169 725f 636f 6d62 696e 6174 696f  _pair_combinatio
+00006690: 6e28 7365 6c66 2c20 6375 7272 5f31 3a20  n(self, curr_1: 
+000066a0: 7374 722c 2063 7572 725f 323a 2073 7472  str, curr_2: str
+000066b0: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+000066c0: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
+000066d0: 7420 7661 6c69 6420 7061 6972 2063 6f6d  t valid pair com
+000066e0: 6269 6e61 7469 6f6e 206f 6620 6375 7272  bination of curr
+000066f0: 5f31 2061 6e64 2063 7572 725f 3220 6279  _1 and curr_2 by
+00006700: 2074 7279 696e 6720 626f 7468 2063 6f6d   trying both com
+00006710: 6269 6e61 7469 6f6e 732e 0a20 2020 2020  binations..     
+00006720: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00006730: 6f72 2070 6169 7220 696e 205b 6622 7b63  or pair in [f"{c
+00006740: 7572 725f 317d 2f7b 6375 7272 5f32 7d22  urr_1}/{curr_2}"
+00006750: 2c20 6622 7b63 7572 725f 327d 2f7b 6375  , f"{curr_2}/{cu
+00006760: 7272 5f31 7d22 5d3a 0a20 2020 2020 2020  rr_1}"]:.       
+00006770: 2020 2020 2069 6620 7061 6972 2069 6e20       if pair in 
+00006780: 7365 6c66 2e6d 6172 6b65 7473 2061 6e64  self.markets and
+00006790: 2073 656c 662e 6d61 726b 6574 735b 7061   self.markets[pa
+000067a0: 6972 5d2e 6765 7428 2761 6374 6976 6527  ir].get('active'
+000067b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+000067c0: 2020 2072 6574 7572 6e20 7061 6972 0a20     return pair. 
+000067d0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+000067e0: 7565 4572 726f 7228 6622 436f 756c 6420  ueError(f"Could 
+000067f0: 6e6f 7420 636f 6d62 696e 6520 7b63 7572  not combine {cur
+00006800: 725f 317d 2061 6e64 207b 6375 7272 5f32  r_1} and {curr_2
+00006810: 7d20 746f 2067 6574 2061 2076 616c 6964  } to get a valid
+00006820: 2070 6169 722e 2229 0a0a 2020 2020 6465   pair.")..    de
+00006830: 6620 7661 6c69 6461 7465 5f74 696d 6566  f validate_timef
+00006840: 7261 6d65 7328 7365 6c66 2c20 7469 6d65  rames(self, time
+00006850: 6672 616d 653a 204f 7074 696f 6e61 6c5b  frame: Optional[
+00006860: 7374 725d 2920 2d3e 204e 6f6e 653a 0a20  str]) -> None:. 
+00006870: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00006880: 2020 2043 6865 636b 2069 6620 7469 6d65     Check if time
+00006890: 6672 616d 6520 6672 6f6d 2063 6f6e 6669  frame from confi
+000068a0: 6720 6973 2061 2073 7570 706f 7274 6564  g is a supported
+000068b0: 2074 696d 6566 7261 6d65 206f 6e20 7468   timeframe on th
+000068c0: 6520 6578 6368 616e 6765 0a20 2020 2020  e exchange.     
+000068d0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
+000068e0: 6620 6e6f 7420 6861 7361 7474 7228 7365  f not hasattr(se
+000068f0: 6c66 2e5f 6170 692c 2022 7469 6d65 6672  lf._api, "timefr
+00006900: 616d 6573 2229 206f 7220 7365 6c66 2e5f  ames") or self._
+00006910: 6170 692e 7469 6d65 6672 616d 6573 2069  api.timeframes i
+00006920: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00006930: 2020 2020 2320 4966 2074 696d 6566 7261      # If timefra
+00006940: 6d65 7320 6174 7472 6962 7574 6520 6973  mes attribute is
+00006950: 206d 6973 7369 6e67 2028 6f72 2069 7320   missing (or is 
+00006960: 4e6f 6e65 292c 2074 6865 2065 7863 6861  None), the excha
+00006970: 6e67 6520 7072 6f62 6162 6c79 0a20 2020  nge probably.   
+00006980: 2020 2020 2020 2020 2023 2068 6173 206e           # has n
+00006990: 6f20 6665 7463 684f 484c 4356 206d 6574  o fetchOHLCV met
+000069a0: 686f 642e 0a20 2020 2020 2020 2020 2020  hod..           
+000069b0: 2023 2054 6865 7265 666f 7265 2077 6520   # Therefore we 
+000069c0: 616c 736f 2073 686f 7720 7468 6174 2e0a  also show that..
+000069d0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000069e0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+000069f0: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+00006a00: 2020 2020 2020 2020 6622 5468 6520 6363          f"The cc
+00006a10: 7874 206c 6962 7261 7279 2064 6f65 7320  xt library does 
+00006a20: 6e6f 7420 7072 6f76 6964 6520 7468 6520  not provide the 
+00006a30: 6c69 7374 206f 6620 7469 6d65 6672 616d  list of timefram
+00006a40: 6573 2022 0a20 2020 2020 2020 2020 2020  es ".           
+00006a50: 2020 2020 2066 2266 6f72 2074 6865 2065       f"for the e
+00006a60: 7863 6861 6e67 6520 7b73 656c 662e 6e61  xchange {self.na
+00006a70: 6d65 7d20 616e 6420 7468 6973 2065 7863  me} and this exc
+00006a80: 6861 6e67 6520 220a 2020 2020 2020 2020  hange ".        
+00006a90: 2020 2020 2020 2020 6622 6973 2074 6865          f"is the
+00006aa0: 7265 666f 7265 206e 6f74 2073 7570 706f  refore not suppo
+00006ab0: 7274 6564 2e20 6363 7874 2066 6574 6368  rted. ccxt fetch
+00006ac0: 4f48 4c43 563a 207b 7365 6c66 2e65 7863  OHLCV: {self.exc
+00006ad0: 6861 6e67 655f 6861 7328 2766 6574 6368  hange_has('fetch
+00006ae0: 4f48 4c43 5627 297d 2229 0a0a 2020 2020  OHLCV')}")..    
+00006af0: 2020 2020 6966 2074 696d 6566 7261 6d65      if timeframe
+00006b00: 2061 6e64 2028 7469 6d65 6672 616d 6520   and (timeframe 
+00006b10: 6e6f 7420 696e 2073 656c 662e 7469 6d65  not in self.time
+00006b20: 6672 616d 6573 293a 0a20 2020 2020 2020  frames):.       
+00006b30: 2020 2020 2072 6169 7365 2043 6f6e 6669       raise Confi
+00006b40: 6775 7261 7469 6f6e 4572 726f 7228 0a20  gurationError(. 
+00006b50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00006b60: 2249 6e76 616c 6964 2074 696d 6566 7261  "Invalid timefra
+00006b70: 6d65 2027 7b74 696d 6566 7261 6d65 7d27  me '{timeframe}'
+00006b80: 2e20 5468 6973 2065 7863 6861 6e67 6520  . This exchange 
+00006b90: 7375 7070 6f72 7473 3a20 7b73 656c 662e  supports: {self.
+00006ba0: 7469 6d65 6672 616d 6573 7d22 290a 0a20  timeframes}").. 
+00006bb0: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
+00006bc0: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
+00006bd0: 650a 2020 2020 2020 2020 2020 2020 616e  e.            an
+00006be0: 6420 7365 6c66 2e5f 636f 6e66 6967 5b27  d self._config['
+00006bf0: 7275 6e6d 6f64 6527 5d20 213d 2052 756e  runmode'] != Run
+00006c00: 4d6f 6465 2e55 5449 4c5f 4558 4348 414e  Mode.UTIL_EXCHAN
+00006c10: 4745 0a20 2020 2020 2020 2020 2020 2061  GE.            a
+00006c20: 6e64 2074 696d 6566 7261 6d65 5f74 6f5f  nd timeframe_to_
+00006c30: 6d69 6e75 7465 7328 7469 6d65 6672 616d  minutes(timefram
+00006c40: 6529 203c 2031 0a20 2020 2020 2020 2029  e) < 1.        )
+00006c50: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00006c60: 6973 6520 436f 6e66 6967 7572 6174 696f  ise Configuratio
+00006c70: 6e45 7272 6f72 2822 5469 6d65 6672 616d  nError("Timefram
+00006c80: 6573 203c 2031 6d20 6172 6520 6375 7272  es < 1m are curr
+00006c90: 656e 746c 7920 6e6f 7420 7375 7070 6f72  ently not suppor
+00006ca0: 7465 6420 6279 2046 7265 7174 7261 6465  ted by Freqtrade
+00006cb0: 2e22 290a 0a20 2020 2064 6566 2076 616c  .")..    def val
+00006cc0: 6964 6174 655f 6f72 6465 7274 7970 6573  idate_ordertypes
+00006cd0: 2873 656c 662c 206f 7264 6572 5f74 7970  (self, order_typ
+00006ce0: 6573 3a20 4469 6374 2920 2d3e 204e 6f6e  es: Dict) -> Non
+00006cf0: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00006d00: 2020 2020 2020 2043 6865 636b 7320 6966         Checks if
+00006d10: 206f 7264 6572 2d74 7970 6573 2063 6f6e   order-types con
+00006d20: 6669 6775 7265 6420 696e 2073 7472 6174  figured in strat
+00006d30: 6567 792f 636f 6e66 6967 2061 7265 2073  egy/config are s
+00006d40: 7570 706f 7274 6564 0a20 2020 2020 2020  upported.       
+00006d50: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00006d60: 616e 7928 7620 3d3d 2027 6d61 726b 6574  any(v == 'market
+00006d70: 2720 666f 7220 6b2c 2076 2069 6e20 6f72  ' for k, v in or
+00006d80: 6465 725f 7479 7065 732e 6974 656d 7328  der_types.items(
+00006d90: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+00006da0: 6966 206e 6f74 2073 656c 662e 6578 6368  if not self.exch
+00006db0: 616e 6765 5f68 6173 2827 6372 6561 7465  ange_has('create
+00006dc0: 4d61 726b 6574 4f72 6465 7227 293a 0a20  MarketOrder'):. 
+00006dd0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00006de0: 6169 7365 2043 6f6e 6669 6775 7261 7469  aise Configurati
+00006df0: 6f6e 4572 726f 7228 0a20 2020 2020 2020  onError(.       
+00006e00: 2020 2020 2020 2020 2020 2020 2066 2745               f'E
+00006e10: 7863 6861 6e67 6520 7b73 656c 662e 6e61  xchange {self.na
+00006e20: 6d65 7d20 646f 6573 206e 6f74 2073 7570  me} does not sup
+00006e30: 706f 7274 206d 6172 6b65 7420 6f72 6465  port market orde
+00006e40: 7273 2e27 290a 2020 2020 2020 2020 7365  rs.').        se
+00006e50: 6c66 2e76 616c 6964 6174 655f 7374 6f70  lf.validate_stop
+00006e60: 5f6f 7264 6572 7479 7065 7328 6f72 6465  _ordertypes(orde
+00006e70: 725f 7479 7065 7329 0a0a 2020 2020 6465  r_types)..    de
+00006e80: 6620 7661 6c69 6461 7465 5f73 746f 705f  f validate_stop_
+00006e90: 6f72 6465 7274 7970 6573 2873 656c 662c  ordertypes(self,
+00006ea0: 206f 7264 6572 5f74 7970 6573 3a20 4469   order_types: Di
+00006eb0: 6374 2920 2d3e 204e 6f6e 653a 0a20 2020  ct) -> None:.   
+00006ec0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00006ed0: 2056 616c 6964 6174 6520 7374 6f70 6c6f   Validate stoplo
+00006ee0: 7373 206f 7264 6572 2074 7970 6573 0a20  ss order types. 
+00006ef0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00006f00: 2020 2069 6620 286f 7264 6572 5f74 7970     if (order_typ
+00006f10: 6573 2e67 6574 2822 7374 6f70 6c6f 7373  es.get("stoploss
+00006f20: 5f6f 6e5f 6578 6368 616e 6765 2229 0a20  _on_exchange"). 
+00006f30: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+00006f40: 6e64 206e 6f74 2073 656c 662e 5f66 745f  nd not self._ft_
+00006f50: 6861 732e 6765 7428 2273 746f 706c 6f73  has.get("stoplos
+00006f60: 735f 6f6e 5f65 7863 6861 6e67 6522 2c20  s_on_exchange", 
+00006f70: 4661 6c73 6529 293a 0a20 2020 2020 2020  False)):.       
+00006f80: 2020 2020 2072 6169 7365 2043 6f6e 6669       raise Confi
+00006f90: 6775 7261 7469 6f6e 4572 726f 7228 0a20  gurationError(. 
+00006fa0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00006fb0: 274f 6e20 6578 6368 616e 6765 2073 746f  'On exchange sto
+00006fc0: 706c 6f73 7320 6973 206e 6f74 2073 7570  ploss is not sup
+00006fd0: 706f 7274 6564 2066 6f72 207b 7365 6c66  ported for {self
+00006fe0: 2e6e 616d 657d 2e27 0a20 2020 2020 2020  .name}.'.       
+00006ff0: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
+00007000: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
+00007010: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
+00007020: 6465 2e46 5554 5552 4553 3a0a 2020 2020  de.FUTURES:.    
+00007030: 2020 2020 2020 2020 7072 6963 655f 6d61          price_ma
+00007040: 7070 696e 6720 3d20 7365 6c66 2e5f 6674  pping = self._ft
+00007050: 5f68 6173 2e67 6574 2827 7374 6f70 5f70  _has.get('stop_p
+00007060: 7269 6365 5f74 7970 655f 7661 6c75 655f  rice_type_value_
+00007070: 6d61 7070 696e 6727 2c20 7b7d 292e 6b65  mapping', {}).ke
+00007080: 7973 2829 0a20 2020 2020 2020 2020 2020  ys().           
+00007090: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+000070a0: 2020 2020 2020 6f72 6465 725f 7479 7065        order_type
+000070b0: 732e 6765 7428 2273 746f 706c 6f73 735f  s.get("stoploss_
+000070c0: 6f6e 5f65 7863 6861 6e67 6522 2c20 4661  on_exchange", Fa
+000070d0: 6c73 6529 2069 7320 5472 7565 0a20 2020  lse) is True.   
+000070e0: 2020 2020 2020 2020 2020 2020 2061 6e64               and
+000070f0: 2027 7374 6f70 6c6f 7373 5f70 7269 6365   'stoploss_price
+00007100: 5f74 7970 6527 2069 6e20 6f72 6465 725f  _type' in order_
+00007110: 7479 7065 730a 2020 2020 2020 2020 2020  types.          
+00007120: 2020 2020 2020 616e 6420 6f72 6465 725f        and order_
+00007130: 7479 7065 735b 2773 746f 706c 6f73 735f  types['stoploss_
+00007140: 7072 6963 655f 7479 7065 275d 206e 6f74  price_type'] not
+00007150: 2069 6e20 7072 6963 655f 6d61 7070 696e   in price_mappin
+00007160: 670a 2020 2020 2020 2020 2020 2020 293a  g.            ):
+00007170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007180: 2072 6169 7365 2043 6f6e 6669 6775 7261   raise Configura
+00007190: 7469 6f6e 4572 726f 7228 0a20 2020 2020  tionError(.     
+000071a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000071b0: 274f 6e20 6578 6368 616e 6765 2073 746f  'On exchange sto
+000071c0: 706c 6f73 7320 7072 6963 6520 7479 7065  ploss price type
+000071d0: 2069 7320 6e6f 7420 7375 7070 6f72 7465   is not supporte
+000071e0: 6420 666f 7220 7b73 656c 662e 6e61 6d65  d for {self.name
+000071f0: 7d2e 270a 2020 2020 2020 2020 2020 2020  }.'.            
+00007200: 2020 2020 290a 0a20 2020 2064 6566 2076      )..    def v
+00007210: 616c 6964 6174 655f 7072 6963 696e 6728  alidate_pricing(
+00007220: 7365 6c66 2c20 7072 6963 696e 673a 2044  self, pricing: D
+00007230: 6963 7429 202d 3e20 4e6f 6e65 3a0a 2020  ict) -> None:.  
+00007240: 2020 2020 2020 6966 2070 7269 6369 6e67        if pricing
+00007250: 2e67 6574 2827 7573 655f 6f72 6465 725f  .get('use_order_
+00007260: 626f 6f6b 272c 2046 616c 7365 2920 616e  book', False) an
+00007270: 6420 6e6f 7420 7365 6c66 2e65 7863 6861  d not self.excha
+00007280: 6e67 655f 6861 7328 2766 6574 6368 4c32  nge_has('fetchL2
+00007290: 4f72 6465 7242 6f6f 6b27 293a 0a20 2020  OrderBook'):.   
+000072a0: 2020 2020 2020 2020 2072 6169 7365 2043           raise C
+000072b0: 6f6e 6669 6775 7261 7469 6f6e 4572 726f  onfigurationErro
+000072c0: 7228 6627 4f72 6465 7262 6f6f 6b20 6e6f  r(f'Orderbook no
+000072d0: 7420 6176 6169 6c61 626c 6520 666f 7220  t available for 
+000072e0: 7b73 656c 662e 6e61 6d65 7d2e 2729 0a20  {self.name}.'). 
+000072f0: 2020 2020 2020 2069 6620 286e 6f74 2070         if (not p
+00007300: 7269 6369 6e67 2e67 6574 2827 7573 655f  ricing.get('use_
+00007310: 6f72 6465 725f 626f 6f6b 272c 2046 616c  order_book', Fal
+00007320: 7365 2920 616e 6420 280a 2020 2020 2020  se) and (.      
+00007330: 2020 2020 2020 2020 2020 6e6f 7420 7365            not se
+00007340: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
+00007350: 2766 6574 6368 5469 636b 6572 2729 0a20  'fetchTicker'). 
+00007360: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00007370: 7220 6e6f 7420 7365 6c66 2e5f 6674 5f68  r not self._ft_h
+00007380: 6173 5b27 7469 636b 6572 735f 6861 7665  as['tickers_have
+00007390: 5f70 7269 6365 275d 2929 3a0a 2020 2020  _price'])):.    
+000073a0: 2020 2020 2020 2020 7261 6973 6520 436f          raise Co
+000073b0: 6e66 6967 7572 6174 696f 6e45 7272 6f72  nfigurationError
+000073c0: 2866 2754 6963 6b65 7220 7072 6963 696e  (f'Ticker pricin
+000073d0: 6720 6e6f 7420 6176 6169 6c61 626c 6520  g not available 
+000073e0: 666f 7220 7b73 656c 662e 6e61 6d65 7d2e  for {self.name}.
+000073f0: 2729 0a0a 2020 2020 6465 6620 7661 6c69  ')..    def vali
+00007400: 6461 7465 5f6f 7264 6572 5f74 696d 655f  date_order_time_
+00007410: 696e 5f66 6f72 6365 2873 656c 662c 206f  in_force(self, o
+00007420: 7264 6572 5f74 696d 655f 696e 5f66 6f72  rder_time_in_for
+00007430: 6365 3a20 4469 6374 2920 2d3e 204e 6f6e  ce: Dict) -> Non
+00007440: 653a 0a20 2020 2020 2020 2022 2222 0a20  e:.        """. 
+00007450: 2020 2020 2020 2043 6865 636b 7320 6966         Checks if
+00007460: 206f 7264 6572 2074 696d 6520 696e 2066   order time in f
+00007470: 6f72 6365 2063 6f6e 6669 6775 7265 6420  orce configured 
+00007480: 696e 2073 7472 6174 6567 792f 636f 6e66  in strategy/conf
+00007490: 6967 2061 7265 2073 7570 706f 7274 6564  ig are supported
+000074a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+000074b0: 2020 2020 2069 6620 616e 7928 762e 7570       if any(v.up
+000074c0: 7065 7228 2920 6e6f 7420 696e 2073 656c  per() not in sel
+000074d0: 662e 5f66 745f 6861 735b 226f 7264 6572  f._ft_has["order
+000074e0: 5f74 696d 655f 696e 5f66 6f72 6365 225d  _time_in_force"]
+000074f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007500: 666f 7220 6b2c 2076 2069 6e20 6f72 6465  for k, v in orde
+00007510: 725f 7469 6d65 5f69 6e5f 666f 7263 652e  r_time_in_force.
+00007520: 6974 656d 7328 2929 3a0a 2020 2020 2020  items()):.      
+00007530: 2020 2020 2020 7261 6973 6520 436f 6e66        raise Conf
+00007540: 6967 7572 6174 696f 6e45 7272 6f72 280a  igurationError(.
+00007550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007560: 6627 5469 6d65 2069 6e20 666f 7263 6520  f'Time in force 
+00007570: 706f 6c69 6369 6573 2061 7265 206e 6f74  policies are not
+00007580: 2073 7570 706f 7274 6564 2066 6f72 207b   supported for {
+00007590: 7365 6c66 2e6e 616d 657d 2079 6574 2e27  self.name} yet.'
+000075a0: 290a 0a20 2020 2064 6566 2076 616c 6964  )..    def valid
+000075b0: 6174 655f 7265 7175 6972 6564 5f73 7461  ate_required_sta
+000075c0: 7274 7570 5f63 616e 646c 6573 2873 656c  rtup_candles(sel
+000075d0: 662c 2073 7461 7274 7570 5f63 616e 646c  f, startup_candl
+000075e0: 6573 3a20 696e 742c 2074 696d 6566 7261  es: int, timefra
+000075f0: 6d65 3a20 7374 7229 202d 3e20 696e 743a  me: str) -> int:
+00007600: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00007610: 2020 2020 2043 6865 636b 7320 6966 2072       Checks if r
+00007620: 6571 7569 7265 6420 7374 6172 7475 705f  equired startup_
+00007630: 6361 6e64 6c65 7320 6973 206d 6f72 6520  candles is more 
+00007640: 7468 616e 206f 686c 6376 5f63 616e 646c  than ohlcv_candl
+00007650: 655f 6c69 6d69 7428 292e 0a20 2020 2020  e_limit()..     
+00007660: 2020 2052 6571 7569 7265 7320 6120 6772     Requires a gr
+00007670: 6163 652d 7065 7269 6f64 206f 6620 3520  ace-period of 5 
+00007680: 6361 6e64 6c65 7320 2d20 736f 2061 2073  candles - so a s
+00007690: 7461 7274 7570 2d70 6572 696f 6420 7570  tartup-period up
+000076a0: 2074 6f20 3439 3420 6973 2061 6c6c 6f77   to 494 is allow
+000076b0: 6564 2062 7920 6465 6661 756c 742e 0a20  ed by default.. 
+000076c0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+000076d0: 2020 2020 6361 6e64 6c65 5f6c 696d 6974      candle_limit
+000076e0: 203d 2073 656c 662e 6f68 6c63 765f 6361   = self.ohlcv_ca
+000076f0: 6e64 6c65 5f6c 696d 6974 280a 2020 2020  ndle_limit(.    
+00007700: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
+00007710: 652c 2073 656c 662e 5f63 6f6e 6669 675b  e, self._config[
+00007720: 2763 616e 646c 655f 7479 7065 5f64 6566  'candle_type_def
+00007730: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+00007740: 6474 5f74 7328 6461 7465 5f6d 696e 7573  dt_ts(date_minus
+00007750: 5f63 616e 646c 6573 2874 696d 6566 7261  _candles(timefra
+00007760: 6d65 2c20 7374 6172 7475 705f 6361 6e64  me, startup_cand
+00007770: 6c65 7329 290a 2020 2020 2020 2020 2020  les)).          
+00007780: 2020 6966 2074 696d 6566 7261 6d65 2065    if timeframe e
+00007790: 6c73 6520 4e6f 6e65 290a 2020 2020 2020  lse None).      
+000077a0: 2020 2320 5265 7175 6972 6520 6f6e 6520    # Require one 
+000077b0: 6d6f 7265 2063 616e 646c 6520 2d20 746f  more candle - to
+000077c0: 2061 6363 6f75 6e74 2066 6f72 2074 6865   account for the
+000077d0: 2073 7469 6c6c 206f 7065 6e20 6361 6e64   still open cand
+000077e0: 6c65 2e0a 2020 2020 2020 2020 6361 6e64  le..        cand
+000077f0: 6c65 5f63 6f75 6e74 203d 2073 7461 7274  le_count = start
+00007800: 7570 5f63 616e 646c 6573 202b 2031 0a20  up_candles + 1. 
+00007810: 2020 2020 2020 2023 2041 6c6c 6f77 2035         # Allow 5
+00007820: 2063 616c 6c73 2074 6f20 7468 6520 6578   calls to the ex
+00007830: 6368 616e 6765 2070 6572 2070 6169 720a  change per pair.
+00007840: 2020 2020 2020 2020 7265 7175 6972 6564          required
+00007850: 5f63 616e 646c 655f 6361 6c6c 5f63 6f75  _candle_call_cou
+00007860: 6e74 203d 2069 6e74 280a 2020 2020 2020  nt = int(.      
+00007870: 2020 2020 2020 2863 616e 646c 655f 636f        (candle_co
+00007880: 756e 7420 2f20 6361 6e64 6c65 5f6c 696d  unt / candle_lim
+00007890: 6974 2920 2b20 2830 2069 6620 6361 6e64  it) + (0 if cand
+000078a0: 6c65 5f63 6f75 6e74 2025 2063 616e 646c  le_count % candl
+000078b0: 655f 6c69 6d69 7420 3d3d 2030 2065 6c73  e_limit == 0 els
+000078c0: 6520 3129 290a 2020 2020 2020 2020 6966  e 1)).        if
+000078d0: 2073 656c 662e 5f66 745f 6861 735b 276f   self._ft_has['o
+000078e0: 686c 6376 5f68 6173 5f68 6973 746f 7279  hlcv_has_history
+000078f0: 275d 3a0a 0a20 2020 2020 2020 2020 2020  ']:..           
+00007900: 2069 6620 7265 7175 6972 6564 5f63 616e   if required_can
+00007910: 646c 655f 6361 6c6c 5f63 6f75 6e74 203e  dle_call_count >
+00007920: 2035 3a0a 2020 2020 2020 2020 2020 2020   5:.            
+00007930: 2020 2020 2320 4f6e 6c79 2061 6c6c 6f77      # Only allow
+00007940: 2035 2063 616c 6c73 2070 6572 2070 6169   5 calls per pai
+00007950: 7220 746f 2073 6f6d 6577 6861 7420 6c69  r to somewhat li
+00007960: 6d69 7420 7468 6520 696d 7061 6374 0a20  mit the impact. 
+00007970: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00007980: 6169 7365 2043 6f6e 6669 6775 7261 7469  aise Configurati
+00007990: 6f6e 4572 726f 7228 0a20 2020 2020 2020  onError(.       
+000079a0: 2020 2020 2020 2020 2020 2020 2066 2254               f"T
+000079b0: 6869 7320 7374 7261 7465 6779 2072 6571  his strategy req
+000079c0: 7569 7265 7320 7b73 7461 7274 7570 5f63  uires {startup_c
+000079d0: 616e 646c 6573 7d20 6361 6e64 6c65 7320  andles} candles 
+000079e0: 746f 2073 7461 7274 2c20 220a 2020 2020  to start, ".    
 000079f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a00: 2020 2020 6622 7468 6520 616d 6f75 6e74      f"the amount
-00007a10: 206f 6620 6361 6e64 6c65 7320 7b73 656c   of candles {sel
-00007a20: 662e 6e61 6d65 7d20 7072 6f76 6964 6573  f.name} provides
-00007a30: 2066 6f72 207b 7469 6d65 6672 616d 657d   for {timeframe}
-00007a40: 2e22 290a 2020 2020 2020 2020 656c 6966  .").        elif
-00007a50: 2072 6571 7569 7265 645f 6361 6e64 6c65   required_candle
-00007a60: 5f63 616c 6c5f 636f 756e 7420 3e20 313a  _call_count > 1:
-00007a70: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00007a80: 7365 2043 6f6e 6669 6775 7261 7469 6f6e  se Configuration
-00007a90: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-00007aa0: 2020 2020 2020 2066 2254 6869 7320 7374         f"This st
-00007ab0: 7261 7465 6779 2072 6571 7569 7265 7320  rategy requires 
-00007ac0: 7b73 7461 7274 7570 5f63 616e 646c 6573  {startup_candles
-00007ad0: 7d20 6361 6e64 6c65 7320 746f 2073 7461  } candles to sta
-00007ae0: 7274 2c20 7768 6963 6820 6973 206d 6f72  rt, which is mor
-00007af0: 6520 7468 616e 2022 0a20 2020 2020 2020  e than ".       
-00007b00: 2020 2020 2020 2020 2066 2274 6865 2061           f"the a
-00007b10: 6d6f 756e 7420 6f66 2063 616e 646c 6573  mount of candles
-00007b20: 207b 7365 6c66 2e6e 616d 657d 2070 726f   {self.name} pro
-00007b30: 7669 6465 7320 666f 7220 7b74 696d 6566  vides for {timef
-00007b40: 7261 6d65 7d2e 2229 0a20 2020 2020 2020  rame}.").       
-00007b50: 2069 6620 7265 7175 6972 6564 5f63 616e   if required_can
-00007b60: 646c 655f 6361 6c6c 5f63 6f75 6e74 203e  dle_call_count >
-00007b70: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00007b80: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
-00007b90: 2255 7369 6e67 207b 7265 7175 6972 6564  "Using {required
-00007ba0: 5f63 616e 646c 655f 6361 6c6c 5f63 6f75  _candle_call_cou
-00007bb0: 6e74 7d20 6361 6c6c 7320 746f 2067 6574  nt} calls to get
-00007bc0: 204f 484c 4356 2e20 220a 2020 2020 2020   OHLCV. ".      
-00007bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007be0: 2020 2020 2066 2254 6869 7320 6361 6e20       f"This can 
-00007bf0: 7265 7375 6c74 2069 6e20 736c 6f77 6572  result in slower
-00007c00: 206f 7065 7261 7469 6f6e 7320 666f 7220   operations for 
-00007c10: 7468 6520 626f 742e 2050 6c65 6173 6520  the bot. Please 
-00007c20: 6368 6563 6b20 220a 2020 2020 2020 2020  check ".        
-00007c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007c40: 2020 2066 2269 6620 796f 7520 7265 616c     f"if you real
-00007c50: 6c79 206e 6565 6420 7b73 7461 7274 7570  ly need {startup
-00007c60: 5f63 616e 646c 6573 7d20 6361 6e64 6c65  _candles} candle
-00007c70: 7320 666f 7220 796f 7572 2073 7472 6174  s for your strat
-00007c80: 6567 7922 290a 2020 2020 2020 2020 7265  egy").        re
-00007c90: 7475 726e 2072 6571 7569 7265 645f 6361  turn required_ca
-00007ca0: 6e64 6c65 5f63 616c 6c5f 636f 756e 740a  ndle_call_count.
-00007cb0: 0a20 2020 2064 6566 2076 616c 6964 6174  .    def validat
-00007cc0: 655f 7472 6164 696e 675f 6d6f 6465 5f61  e_trading_mode_a
-00007cd0: 6e64 5f6d 6172 6769 6e5f 6d6f 6465 280a  nd_margin_mode(.
-00007ce0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00007cf0: 2020 2020 2020 7472 6164 696e 675f 6d6f        trading_mo
-00007d00: 6465 3a20 5472 6164 696e 674d 6f64 652c  de: TradingMode,
-00007d10: 0a20 2020 2020 2020 206d 6172 6769 6e5f  .        margin_
-00007d20: 6d6f 6465 3a20 4f70 7469 6f6e 616c 5b4d  mode: Optional[M
-00007d30: 6172 6769 6e4d 6f64 655d 2020 2320 4f6e  arginMode]  # On
-00007d40: 6c79 204e 6f6e 6520 7768 656e 2074 7261  ly None when tra
-00007d50: 6469 6e67 5f6d 6f64 6520 3d20 5472 6164  ding_mode = Trad
-00007d60: 696e 674d 6f64 652e 5350 4f54 0a20 2020  ingMode.SPOT.   
-00007d70: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
-00007d80: 2020 2020 2020 2020 4368 6563 6b73 2069          Checks i
-00007d90: 6620 6672 6571 7472 6164 6520 6361 6e20  f freqtrade can 
-00007da0: 7065 7266 6f72 6d20 7472 6164 6573 2075  perform trades u
-00007db0: 7369 6e67 2074 6865 2063 6f6e 6669 6775  sing the configu
-00007dc0: 7265 640a 2020 2020 2020 2020 7472 6164  red.        trad
-00007dd0: 696e 6720 6d6f 6465 284d 6172 6769 6e2c  ing mode(Margin,
-00007de0: 2046 7574 7572 6573 2920 616e 6420 4d61   Futures) and Ma
-00007df0: 7267 696e 4d6f 6465 2843 726f 7373 2c20  rginMode(Cross, 
-00007e00: 4973 6f6c 6174 6564 290a 2020 2020 2020  Isolated).      
-00007e10: 2020 5468 726f 7773 204f 7065 7261 7469    Throws Operati
-00007e20: 6f6e 616c 4578 6365 7074 696f 6e3a 0a20  onalException:. 
-00007e30: 2020 2020 2020 2020 2020 2049 6620 7468             If th
-00007e40: 6520 7472 6164 696e 675f 6d6f 6465 2f6d  e trading_mode/m
-00007e50: 6172 6769 6e5f 6d6f 6465 2074 7970 6520  argin_mode type 
-00007e60: 6172 6520 6e6f 7420 7375 7070 6f72 7465  are not supporte
-00007e70: 6420 6279 2066 7265 7174 7261 6465 206f  d by freqtrade o
-00007e80: 6e20 7468 6973 2065 7863 6861 6e67 650a  n this exchange.
-00007e90: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00007ea0: 2020 2020 6966 2074 7261 6469 6e67 5f6d      if trading_m
-00007eb0: 6f64 6520 213d 2054 7261 6469 6e67 4d6f  ode != TradingMo
-00007ec0: 6465 2e53 504f 5420 616e 6420 280a 2020  de.SPOT and (.  
-00007ed0: 2020 2020 2020 2020 2020 2874 7261 6469            (tradi
-00007ee0: 6e67 5f6d 6f64 652c 206d 6172 6769 6e5f  ng_mode, margin_
-00007ef0: 6d6f 6465 2920 6e6f 7420 696e 2073 656c  mode) not in sel
-00007f00: 662e 5f73 7570 706f 7274 6564 5f74 7261  f._supported_tra
-00007f10: 6469 6e67 5f6d 6f64 655f 6d61 7267 696e  ding_mode_margin
-00007f20: 5f70 6169 7273 0a20 2020 2020 2020 2029  _pairs.        )
-00007f30: 3a0a 2020 2020 2020 2020 2020 2020 6d6d  :.            mm
-00007f40: 5f76 616c 7565 203d 206d 6172 6769 6e5f  _value = margin_
-00007f50: 6d6f 6465 2061 6e64 206d 6172 6769 6e5f  mode and margin_
-00007f60: 6d6f 6465 2e76 616c 7565 0a20 2020 2020  mode.value.     
-00007f70: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-00007f80: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-00007f90: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00007fa0: 2020 2066 2246 7265 7174 7261 6465 2064     f"Freqtrade d
-00007fb0: 6f65 7320 6e6f 7420 7375 7070 6f72 7420  oes not support 
-00007fc0: 7b6d 6d5f 7661 6c75 657d 207b 7472 6164  {mm_value} {trad
-00007fd0: 696e 675f 6d6f 6465 2e76 616c 7565 7d20  ing_mode.value} 
-00007fe0: 6f6e 207b 7365 6c66 2e6e 616d 657d 220a  on {self.name}".
-00007ff0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00008000: 2020 2064 6566 2067 6574 5f6f 7074 696f     def get_optio
-00008010: 6e28 7365 6c66 2c20 7061 7261 6d3a 2073  n(self, param: s
-00008020: 7472 2c20 6465 6661 756c 743a 204f 7074  tr, default: Opt
-00008030: 696f 6e61 6c5b 416e 795d 203d 204e 6f6e  ional[Any] = Non
-00008040: 6529 202d 3e20 416e 793a 0a20 2020 2020  e) -> Any:.     
-00008050: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
-00008060: 6574 2070 6172 616d 6574 6572 2076 616c  et parameter val
-00008070: 7565 2066 726f 6d20 5f66 745f 6861 730a  ue from _ft_has.
-00008080: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00008090: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-000080a0: 5f66 745f 6861 732e 6765 7428 7061 7261  _ft_has.get(para
-000080b0: 6d2c 2064 6566 6175 6c74 290a 0a20 2020  m, default)..   
-000080c0: 2064 6566 2065 7863 6861 6e67 655f 6861   def exchange_ha
-000080d0: 7328 7365 6c66 2c20 656e 6470 6f69 6e74  s(self, endpoint
-000080e0: 3a20 7374 7229 202d 3e20 626f 6f6c 3a0a  : str) -> bool:.
-000080f0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00008100: 2020 2020 4368 6563 6b73 2069 6620 6578      Checks if ex
-00008110: 6368 616e 6765 2069 6d70 6c65 6d65 6e74  change implement
-00008120: 7320 6120 7370 6563 6966 6963 2041 5049  s a specific API
-00008130: 2065 6e64 706f 696e 742e 0a20 2020 2020   endpoint..     
-00008140: 2020 2057 7261 7070 6572 2061 726f 756e     Wrapper aroun
-00008150: 6420 6363 7874 2027 6861 7327 2061 7474  d ccxt 'has' att
-00008160: 7269 6275 7465 0a20 2020 2020 2020 203a  ribute.        :
-00008170: 7061 7261 6d20 656e 6470 6f69 6e74 3a20  param endpoint: 
-00008180: 4e61 6d65 206f 6620 656e 6470 6f69 6e74  Name of endpoint
-00008190: 2028 652e 672e 2027 6665 7463 684f 484c   (e.g. 'fetchOHL
-000081a0: 4356 272c 2027 6665 7463 6854 6963 6b65  CV', 'fetchTicke
-000081b0: 7273 2729 0a20 2020 2020 2020 203a 7265  rs').        :re
-000081c0: 7475 726e 3a20 626f 6f6c 0a20 2020 2020  turn: bool.     
-000081d0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-000081e0: 6620 656e 6470 6f69 6e74 2069 6e20 7365  f endpoint in se
-000081f0: 6c66 2e5f 6674 5f68 6173 2e67 6574 2827  lf._ft_has.get('
-00008200: 6578 6368 616e 6765 5f68 6173 5f6f 7665  exchange_has_ove
-00008210: 7272 6964 6573 272c 207b 7d29 3a0a 2020  rrides', {}):.  
-00008220: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00008230: 2073 656c 662e 5f66 745f 6861 735b 2765   self._ft_has['e
-00008240: 7863 6861 6e67 655f 6861 735f 6f76 6572  xchange_has_over
-00008250: 7269 6465 7327 5d5b 656e 6470 6f69 6e74  rides'][endpoint
-00008260: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
-00008270: 2065 6e64 706f 696e 7420 696e 2073 656c   endpoint in sel
-00008280: 662e 5f61 7069 2e68 6173 2061 6e64 2073  f._api.has and s
-00008290: 656c 662e 5f61 7069 2e68 6173 5b65 6e64  elf._api.has[end
-000082a0: 706f 696e 745d 0a0a 2020 2020 6465 6620  point]..    def 
-000082b0: 6765 745f 7072 6563 6973 696f 6e5f 616d  get_precision_am
-000082c0: 6f75 6e74 2873 656c 662c 2070 6169 723a  ount(self, pair:
-000082d0: 2073 7472 2920 2d3e 204f 7074 696f 6e61   str) -> Optiona
-000082e0: 6c5b 666c 6f61 745d 3a0a 2020 2020 2020  l[float]:.      
-000082f0: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00008300: 7475 726e 7320 7468 6520 616d 6f75 6e74  turns the amount
-00008310: 2070 7265 6369 7369 6f6e 206f 6620 7468   precision of th
-00008320: 6520 6578 6368 616e 6765 2e0a 2020 2020  e exchange..    
-00008330: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-00008340: 2050 6169 7220 746f 2067 6574 2070 7265   Pair to get pre
-00008350: 6369 7369 6f6e 2066 6f72 0a20 2020 2020  cision for.     
-00008360: 2020 203a 7265 7475 726e 3a20 7072 6563     :return: prec
-00008370: 6973 696f 6e20 666f 7220 616d 6f75 6e74  ision for amount
-00008380: 206f 7220 4e6f 6e65 2e20 4d75 7374 2062   or None. Must b
-00008390: 6520 7573 6564 2069 6e20 636f 6d62 696e  e used in combin
-000083a0: 6174 696f 6e20 7769 7468 2070 7265 6369  ation with preci
-000083b0: 7369 6f6e 4d6f 6465 0a20 2020 2020 2020  sionMode.       
-000083c0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-000083d0: 7572 6e20 7365 6c66 2e6d 6172 6b65 7473  urn self.markets
-000083e0: 2e67 6574 2870 6169 722c 207b 7d29 2e67  .get(pair, {}).g
-000083f0: 6574 2827 7072 6563 6973 696f 6e27 2c20  et('precision', 
-00008400: 7b7d 292e 6765 7428 2761 6d6f 756e 7427  {}).get('amount'
-00008410: 2c20 4e6f 6e65 290a 0a20 2020 2064 6566  , None)..    def
-00008420: 2067 6574 5f70 7265 6369 7369 6f6e 5f70   get_precision_p
-00008430: 7269 6365 2873 656c 662c 2070 6169 723a  rice(self, pair:
-00008440: 2073 7472 2920 2d3e 204f 7074 696f 6e61   str) -> Optiona
-00008450: 6c5b 666c 6f61 745d 3a0a 2020 2020 2020  l[float]:.      
-00008460: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
-00008470: 7475 726e 7320 7468 6520 7072 6963 6520  turns the price 
-00008480: 7072 6563 6973 696f 6e20 6f66 2074 6865  precision of the
-00008490: 2065 7863 6861 6e67 652e 0a20 2020 2020   exchange..     
-000084a0: 2020 203a 7061 7261 6d20 7061 6972 3a20     :param pair: 
-000084b0: 5061 6972 2074 6f20 6765 7420 7072 6563  Pair to get prec
-000084c0: 6973 696f 6e20 666f 720a 2020 2020 2020  ision for.      
-000084d0: 2020 3a72 6574 7572 6e3a 2070 7265 6369    :return: preci
-000084e0: 7369 6f6e 2066 6f72 2070 7269 6365 206f  sion for price o
-000084f0: 7220 4e6f 6e65 2e20 4d75 7374 2062 6520  r None. Must be 
-00008500: 7573 6564 2069 6e20 636f 6d62 696e 6174  used in combinat
-00008510: 696f 6e20 7769 7468 2070 7265 6369 7369  ion with precisi
-00008520: 6f6e 4d6f 6465 0a20 2020 2020 2020 2022  onMode.        "
-00008530: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00008540: 6e20 7365 6c66 2e6d 6172 6b65 7473 2e67  n self.markets.g
-00008550: 6574 2870 6169 722c 207b 7d29 2e67 6574  et(pair, {}).get
-00008560: 2827 7072 6563 6973 696f 6e27 2c20 7b7d  ('precision', {}
-00008570: 292e 6765 7428 2770 7269 6365 272c 204e  ).get('price', N
-00008580: 6f6e 6529 0a0a 2020 2020 6465 6620 616d  one)..    def am
-00008590: 6f75 6e74 5f74 6f5f 7072 6563 6973 696f  ount_to_precisio
-000085a0: 6e28 7365 6c66 2c20 7061 6972 3a20 7374  n(self, pair: st
-000085b0: 722c 2061 6d6f 756e 743a 2066 6c6f 6174  r, amount: float
-000085c0: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
-000085d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000085e0: 5265 7475 726e 7320 7468 6520 616d 6f75  Returns the amou
-000085f0: 6e74 2074 6f20 6275 7920 6f72 2073 656c  nt to buy or sel
-00008600: 6c20 746f 2061 2070 7265 6369 7369 6f6e  l to a precision
-00008610: 2074 6865 2045 7863 6861 6e67 6520 6163   the Exchange ac
-00008620: 6365 7074 730a 0a20 2020 2020 2020 2022  cepts..        "
-00008630: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00008640: 6e20 616d 6f75 6e74 5f74 6f5f 7072 6563  n amount_to_prec
-00008650: 6973 696f 6e28 616d 6f75 6e74 2c20 7365  ision(amount, se
-00008660: 6c66 2e67 6574 5f70 7265 6369 7369 6f6e  lf.get_precision
-00008670: 5f61 6d6f 756e 7428 7061 6972 292c 2073  _amount(pair), s
-00008680: 656c 662e 7072 6563 6973 696f 6e4d 6f64  elf.precisionMod
-00008690: 6529 0a0a 2020 2020 6465 6620 7072 6963  e)..    def pric
-000086a0: 655f 746f 5f70 7265 6369 7369 6f6e 2873  e_to_precision(s
-000086b0: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
-000086c0: 7072 6963 653a 2066 6c6f 6174 2c20 2a2c  price: float, *,
-000086d0: 2072 6f75 6e64 696e 675f 6d6f 6465 3a20   rounding_mode: 
-000086e0: 696e 7420 3d20 524f 554e 4429 202d 3e20  int = ROUND) -> 
-000086f0: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
-00008700: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
-00008710: 6e73 2074 6865 2070 7269 6365 2072 6f75  ns the price rou
-00008720: 6e64 6564 2074 6f20 7468 6520 7072 6563  nded to the prec
-00008730: 6973 696f 6e20 7468 6520 4578 6368 616e  ision the Exchan
-00008740: 6765 2061 6363 6570 7473 2e0a 2020 2020  ge accepts..    
-00008750: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
-00008760: 7072 6963 655f 726f 756e 6469 6e67 5f6d  price_rounding_m
-00008770: 6f64 6520 696e 2063 6f6e 6620 6973 2052  ode in conf is R
-00008780: 4f55 4e44 2e0a 2020 2020 2020 2020 466f  OUND..        Fo
-00008790: 7220 7374 6f70 6c6f 7373 2063 616c 6375  r stoploss calcu
-000087a0: 6c61 7469 6f6e 732c 206d 7573 7420 7573  lations, must us
-000087b0: 6520 524f 554e 445f 5550 2066 6f72 206c  e ROUND_UP for l
-000087c0: 6f6e 6773 2c20 616e 6420 524f 554e 445f  ongs, and ROUND_
-000087d0: 444f 574e 2066 6f72 2073 686f 7274 732e  DOWN for shorts.
-000087e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000087f0: 2020 2020 2072 6574 7572 6e20 7072 6963       return pric
-00008800: 655f 746f 5f70 7265 6369 7369 6f6e 2870  e_to_precision(p
-00008810: 7269 6365 2c20 7365 6c66 2e67 6574 5f70  rice, self.get_p
-00008820: 7265 6369 7369 6f6e 5f70 7269 6365 2870  recision_price(p
-00008830: 6169 7229 2c0a 2020 2020 2020 2020 2020  air),.          
-00008840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008850: 2020 2020 2020 2020 7365 6c66 2e70 7265          self.pre
-00008860: 6369 7369 6f6e 4d6f 6465 2c20 726f 756e  cisionMode, roun
-00008870: 6469 6e67 5f6d 6f64 653d 726f 756e 6469  ding_mode=roundi
-00008880: 6e67 5f6d 6f64 6529 0a0a 2020 2020 6465  ng_mode)..    de
-00008890: 6620 7072 6963 655f 6765 745f 6f6e 655f  f price_get_one_
-000088a0: 7069 7028 7365 6c66 2c20 7061 6972 3a20  pip(self, pair: 
-000088b0: 7374 722c 2070 7269 6365 3a20 666c 6f61  str, price: floa
-000088c0: 7429 202d 3e20 666c 6f61 743a 0a20 2020  t) -> float:.   
-000088d0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000088e0: 2047 6574 2773 2074 6865 2022 3120 7069   Get's the "1 pi
-000088f0: 7022 2076 616c 7565 2066 6f72 2074 6869  p" value for thi
-00008900: 7320 7061 6972 2e0a 2020 2020 2020 2020  s pair..        
-00008910: 5573 6564 2069 6e20 5072 6963 6546 696c  Used in PriceFil
-00008920: 7465 7220 746f 2063 616c 6375 6c61 7465  ter to calculate
-00008930: 2074 6865 2031 7069 7020 6d6f 7665 6d65   the 1pip moveme
-00008940: 6e74 732e 0a20 2020 2020 2020 2022 2222  nts..        """
-00008950: 0a20 2020 2020 2020 2070 7265 6369 7369  .        precisi
-00008960: 6f6e 203d 2073 656c 662e 6d61 726b 6574  on = self.market
-00008970: 735b 7061 6972 5d5b 2770 7265 6369 7369  s[pair]['precisi
-00008980: 6f6e 275d 5b27 7072 6963 6527 5d0a 2020  on']['price'].  
-00008990: 2020 2020 2020 6966 2073 656c 662e 7072        if self.pr
-000089a0: 6563 6973 696f 6e4d 6f64 6520 3d3d 2054  ecisionMode == T
-000089b0: 4943 4b5f 5349 5a45 3a0a 2020 2020 2020  ICK_SIZE:.      
-000089c0: 2020 2020 2020 7265 7475 726e 2070 7265        return pre
-000089d0: 6369 7369 6f6e 0a20 2020 2020 2020 2065  cision.        e
-000089e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-000089f0: 2072 6574 7572 6e20 3120 2f20 706f 7728   return 1 / pow(
-00008a00: 3130 2c20 7072 6563 6973 696f 6e29 0a0a  10, precision)..
-00008a10: 2020 2020 6465 6620 6765 745f 6d69 6e5f      def get_min_
-00008a20: 7061 6972 5f73 7461 6b65 5f61 6d6f 756e  pair_stake_amoun
-00008a30: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
-00008a40: 0a20 2020 2020 2020 2070 6169 723a 2073  .        pair: s
-00008a50: 7472 2c0a 2020 2020 2020 2020 7072 6963  tr,.        pric
-00008a60: 653a 2066 6c6f 6174 2c0a 2020 2020 2020  e: float,.      
-00008a70: 2020 7374 6f70 6c6f 7373 3a20 666c 6f61    stoploss: floa
-00008a80: 742c 0a20 2020 2020 2020 206c 6576 6572  t,.        lever
-00008a90: 6167 653a 204f 7074 696f 6e61 6c5b 666c  age: Optional[fl
-00008aa0: 6f61 745d 203d 2031 2e30 0a20 2020 2029  oat] = 1.0.    )
-00008ab0: 202d 3e20 4f70 7469 6f6e 616c 5b66 6c6f   -> Optional[flo
-00008ac0: 6174 5d3a 0a20 2020 2020 2020 2072 6574  at]:.        ret
-00008ad0: 7572 6e20 7365 6c66 2e5f 6765 745f 7374  urn self._get_st
-00008ae0: 616b 655f 616d 6f75 6e74 5f6c 696d 6974  ake_amount_limit
-00008af0: 2870 6169 722c 2070 7269 6365 2c20 7374  (pair, price, st
-00008b00: 6f70 6c6f 7373 2c20 276d 696e 272c 206c  oploss, 'min', l
-00008b10: 6576 6572 6167 6529 0a0a 2020 2020 6465  everage)..    de
-00008b20: 6620 6765 745f 6d61 785f 7061 6972 5f73  f get_max_pair_s
-00008b30: 7461 6b65 5f61 6d6f 756e 7428 7365 6c66  take_amount(self
-00008b40: 2c20 7061 6972 3a20 7374 722c 2070 7269  , pair: str, pri
-00008b50: 6365 3a20 666c 6f61 742c 206c 6576 6572  ce: float, lever
-00008b60: 6167 653a 2066 6c6f 6174 203d 2031 2e30  age: float = 1.0
-00008b70: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
-00008b80: 2020 2020 6d61 785f 7374 616b 655f 616d      max_stake_am
-00008b90: 6f75 6e74 203d 2073 656c 662e 5f67 6574  ount = self._get
-00008ba0: 5f73 7461 6b65 5f61 6d6f 756e 745f 6c69  _stake_amount_li
-00008bb0: 6d69 7428 7061 6972 2c20 7072 6963 652c  mit(pair, price,
-00008bc0: 2030 2e30 2c20 276d 6178 272c 206c 6576   0.0, 'max', lev
-00008bd0: 6572 6167 6529 0a20 2020 2020 2020 2069  erage).        i
-00008be0: 6620 6d61 785f 7374 616b 655f 616d 6f75  f max_stake_amou
-00008bf0: 6e74 2069 7320 4e6f 6e65 3a0a 2020 2020  nt is None:.    
-00008c00: 2020 2020 2020 2020 2320 2a20 5368 6f75          # * Shou
-00008c10: 6c64 206e 6576 6572 2062 6520 6578 6563  ld never be exec
-00008c20: 7574 6564 0a20 2020 2020 2020 2020 2020  uted.           
-00008c30: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
-00008c40: 616c 4578 6365 7074 696f 6e28 6627 7b73  alException(f'{s
-00008c50: 656c 662e 6e61 6d65 7d2e 6765 745f 6d61  elf.name}.get_ma
-00008c60: 785f 7061 6972 5f73 7461 6b65 5f61 6d6f  x_pair_stake_amo
-00008c70: 756e 7420 7368 6f75 6c64 270a 2020 2020  unt should'.    
-00008c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008ca0: 2020 2027 6e65 7665 7220 7365 7420 6d61     'never set ma
-00008cb0: 785f 7374 616b 655f 616d 6f75 6e74 2074  x_stake_amount t
-00008cc0: 6f20 4e6f 6e65 2729 0a20 2020 2020 2020  o None').       
-00008cd0: 2072 6574 7572 6e20 6d61 785f 7374 616b   return max_stak
-00008ce0: 655f 616d 6f75 6e74 0a0a 2020 2020 6465  e_amount..    de
-00008cf0: 6620 5f67 6574 5f73 7461 6b65 5f61 6d6f  f _get_stake_amo
-00008d00: 756e 745f 6c69 6d69 7428 0a20 2020 2020  unt_limit(.     
-00008d10: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00008d20: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
-00008d30: 2020 2020 7072 6963 653a 2066 6c6f 6174      price: float
-00008d40: 2c0a 2020 2020 2020 2020 7374 6f70 6c6f  ,.        stoplo
-00008d50: 7373 3a20 666c 6f61 742c 0a20 2020 2020  ss: float,.     
-00008d60: 2020 206c 696d 6974 3a20 4c69 7465 7261     limit: Litera
-00008d70: 6c5b 276d 696e 272c 2027 6d61 7827 5d2c  l['min', 'max'],
-00008d80: 0a20 2020 2020 2020 206c 6576 6572 6167  .        leverag
-00008d90: 653a 204f 7074 696f 6e61 6c5b 666c 6f61  e: Optional[floa
-00008da0: 745d 203d 2031 2e30 0a20 2020 2029 202d  t] = 1.0.    ) -
-00008db0: 3e20 4f70 7469 6f6e 616c 5b66 6c6f 6174  > Optional[float
-00008dc0: 5d3a 0a0a 2020 2020 2020 2020 6973 4d69  ]:..        isMi
-00008dd0: 6e20 3d20 6c69 6d69 7420 3d3d 2027 6d69  n = limit == 'mi
-00008de0: 6e27 0a0a 2020 2020 2020 2020 7472 793a  n'..        try:
-00008df0: 0a20 2020 2020 2020 2020 2020 206d 6172  .            mar
-00008e00: 6b65 7420 3d20 7365 6c66 2e6d 6172 6b65  ket = self.marke
-00008e10: 7473 5b70 6169 725d 0a20 2020 2020 2020  ts[pair].       
-00008e20: 2065 7863 6570 7420 4b65 7945 7272 6f72   except KeyError
-00008e30: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00008e40: 6973 6520 5661 6c75 6545 7272 6f72 2866  ise ValueError(f
-00008e50: 2243 616e 2774 2067 6574 206d 6172 6b65  "Can't get marke
-00008e60: 7420 696e 666f 726d 6174 696f 6e20 666f  t information fo
-00008e70: 7220 7379 6d62 6f6c 207b 7061 6972 7d22  r symbol {pair}"
-00008e80: 290a 0a20 2020 2020 2020 2069 6620 6973  )..        if is
-00008e90: 4d69 6e3a 0a20 2020 2020 2020 2020 2020  Min:.           
-00008ea0: 2023 2072 6573 6572 7665 2073 6f6d 6520   # reserve some 
-00008eb0: 7065 7263 656e 7420 6465 6669 6e65 6420  percent defined 
-00008ec0: 696e 2063 6f6e 6669 6720 2835 2520 6465  in config (5% de
-00008ed0: 6661 756c 7429 202b 2073 746f 706c 6f73  fault) + stoplos
-00008ee0: 730a 2020 2020 2020 2020 2020 2020 6d61  s.            ma
-00008ef0: 7267 696e 5f72 6573 6572 7665 3a20 666c  rgin_reserve: fl
-00008f00: 6f61 7420 3d20 312e 3020 2b20 7365 6c66  oat = 1.0 + self
-00008f10: 2e5f 636f 6e66 6967 2e67 6574 2827 616d  ._config.get('am
-00008f20: 6f75 6e74 5f72 6573 6572 7665 5f70 6572  ount_reserve_per
-00008f30: 6365 6e74 272c 0a20 2020 2020 2020 2020  cent',.         
-00008f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007a00: 2277 6869 6368 2069 7320 6d6f 7265 2074  "which is more t
+00007a10: 6861 6e20 3578 2022 0a20 2020 2020 2020  han 5x ".       
+00007a20: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
+00007a30: 6865 2061 6d6f 756e 7420 6f66 2063 616e  he amount of can
+00007a40: 646c 6573 207b 7365 6c66 2e6e 616d 657d  dles {self.name}
+00007a50: 2070 726f 7669 6465 7320 666f 7220 7b74   provides for {t
+00007a60: 696d 6566 7261 6d65 7d2e 2229 0a20 2020  imeframe}.").   
+00007a70: 2020 2020 2065 6c69 6620 7265 7175 6972       elif requir
+00007a80: 6564 5f63 616e 646c 655f 6361 6c6c 5f63  ed_candle_call_c
+00007a90: 6f75 6e74 203e 2031 3a0a 2020 2020 2020  ount > 1:.      
+00007aa0: 2020 2020 2020 7261 6973 6520 436f 6e66        raise Conf
+00007ab0: 6967 7572 6174 696f 6e45 7272 6f72 280a  igurationError(.
+00007ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ad0: 6622 5468 6973 2073 7472 6174 6567 7920  f"This strategy 
+00007ae0: 7265 7175 6972 6573 207b 7374 6172 7475  requires {startu
+00007af0: 705f 6361 6e64 6c65 737d 2063 616e 646c  p_candles} candl
+00007b00: 6573 2074 6f20 7374 6172 742c 2077 6869  es to start, whi
+00007b10: 6368 2069 7320 6d6f 7265 2074 6861 6e20  ch is more than 
+00007b20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00007b30: 2020 6622 7468 6520 616d 6f75 6e74 206f    f"the amount o
+00007b40: 6620 6361 6e64 6c65 7320 7b73 656c 662e  f candles {self.
+00007b50: 6e61 6d65 7d20 7072 6f76 6964 6573 2066  name} provides f
+00007b60: 6f72 207b 7469 6d65 6672 616d 657d 2e22  or {timeframe}."
+00007b70: 290a 2020 2020 2020 2020 6966 2072 6571  ).        if req
+00007b80: 7569 7265 645f 6361 6e64 6c65 5f63 616c  uired_candle_cal
+00007b90: 6c5f 636f 756e 7420 3e20 313a 0a20 2020  l_count > 1:.   
+00007ba0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+00007bb0: 7761 726e 696e 6728 6622 5573 696e 6720  warning(f"Using 
+00007bc0: 7b72 6571 7569 7265 645f 6361 6e64 6c65  {required_candle
+00007bd0: 5f63 616c 6c5f 636f 756e 747d 2063 616c  _call_count} cal
+00007be0: 6c73 2074 6f20 6765 7420 4f48 4c43 562e  ls to get OHLCV.
+00007bf0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00007c00: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+00007c10: 5468 6973 2063 616e 2072 6573 756c 7420  This can result 
+00007c20: 696e 2073 6c6f 7765 7220 6f70 6572 6174  in slower operat
+00007c30: 696f 6e73 2066 6f72 2074 6865 2062 6f74  ions for the bot
+00007c40: 2e20 506c 6561 7365 2063 6865 636b 2022  . Please check "
+00007c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007c60: 2020 2020 2020 2020 2020 2020 6622 6966              f"if
+00007c70: 2079 6f75 2072 6561 6c6c 7920 6e65 6564   you really need
+00007c80: 207b 7374 6172 7475 705f 6361 6e64 6c65   {startup_candle
+00007c90: 737d 2063 616e 646c 6573 2066 6f72 2079  s} candles for y
+00007ca0: 6f75 7220 7374 7261 7465 6779 2229 0a20  our strategy"). 
+00007cb0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00007cc0: 7175 6972 6564 5f63 616e 646c 655f 6361  quired_candle_ca
+00007cd0: 6c6c 5f63 6f75 6e74 0a0a 2020 2020 6465  ll_count..    de
+00007ce0: 6620 7661 6c69 6461 7465 5f74 7261 6469  f validate_tradi
+00007cf0: 6e67 5f6d 6f64 655f 616e 645f 6d61 7267  ng_mode_and_marg
+00007d00: 696e 5f6d 6f64 6528 0a20 2020 2020 2020  in_mode(.       
+00007d10: 2073 656c 662c 0a20 2020 2020 2020 2074   self,.        t
+00007d20: 7261 6469 6e67 5f6d 6f64 653a 2054 7261  rading_mode: Tra
+00007d30: 6469 6e67 4d6f 6465 2c0a 2020 2020 2020  dingMode,.      
+00007d40: 2020 6d61 7267 696e 5f6d 6f64 653a 204f    margin_mode: O
+00007d50: 7074 696f 6e61 6c5b 4d61 7267 696e 4d6f  ptional[MarginMo
+00007d60: 6465 5d20 2023 204f 6e6c 7920 4e6f 6e65  de]  # Only None
+00007d70: 2077 6865 6e20 7472 6164 696e 675f 6d6f   when trading_mo
+00007d80: 6465 203d 2054 7261 6469 6e67 4d6f 6465  de = TradingMode
+00007d90: 2e53 504f 540a 2020 2020 293a 0a20 2020  .SPOT.    ):.   
+00007da0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00007db0: 2043 6865 636b 7320 6966 2066 7265 7174   Checks if freqt
+00007dc0: 7261 6465 2063 616e 2070 6572 666f 726d  rade can perform
+00007dd0: 2074 7261 6465 7320 7573 696e 6720 7468   trades using th
+00007de0: 6520 636f 6e66 6967 7572 6564 0a20 2020  e configured.   
+00007df0: 2020 2020 2074 7261 6469 6e67 206d 6f64       trading mod
+00007e00: 6528 4d61 7267 696e 2c20 4675 7475 7265  e(Margin, Future
+00007e10: 7329 2061 6e64 204d 6172 6769 6e4d 6f64  s) and MarginMod
+00007e20: 6528 4372 6f73 732c 2049 736f 6c61 7465  e(Cross, Isolate
+00007e30: 6429 0a20 2020 2020 2020 2054 6872 6f77  d).        Throw
+00007e40: 7320 4f70 6572 6174 696f 6e61 6c45 7863  s OperationalExc
+00007e50: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+00007e60: 2020 2020 4966 2074 6865 2074 7261 6469      If the tradi
+00007e70: 6e67 5f6d 6f64 652f 6d61 7267 696e 5f6d  ng_mode/margin_m
+00007e80: 6f64 6520 7479 7065 2061 7265 206e 6f74  ode type are not
+00007e90: 2073 7570 706f 7274 6564 2062 7920 6672   supported by fr
+00007ea0: 6571 7472 6164 6520 6f6e 2074 6869 7320  eqtrade on this 
+00007eb0: 6578 6368 616e 6765 0a20 2020 2020 2020  exchange.       
+00007ec0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+00007ed0: 7472 6164 696e 675f 6d6f 6465 2021 3d20  trading_mode != 
+00007ee0: 5472 6164 696e 674d 6f64 652e 5350 4f54  TradingMode.SPOT
+00007ef0: 2061 6e64 2028 0a20 2020 2020 2020 2020   and (.         
+00007f00: 2020 2028 7472 6164 696e 675f 6d6f 6465     (trading_mode
+00007f10: 2c20 6d61 7267 696e 5f6d 6f64 6529 206e  , margin_mode) n
+00007f20: 6f74 2069 6e20 7365 6c66 2e5f 7375 7070  ot in self._supp
+00007f30: 6f72 7465 645f 7472 6164 696e 675f 6d6f  orted_trading_mo
+00007f40: 6465 5f6d 6172 6769 6e5f 7061 6972 730a  de_margin_pairs.
+00007f50: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00007f60: 2020 2020 2020 206d 6d5f 7661 6c75 6520         mm_value 
+00007f70: 3d20 6d61 7267 696e 5f6d 6f64 6520 616e  = margin_mode an
+00007f80: 6420 6d61 7267 696e 5f6d 6f64 652e 7661  d margin_mode.va
+00007f90: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+00007fa0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00007fb0: 6c45 7863 6570 7469 6f6e 280a 2020 2020  lException(.    
+00007fc0: 2020 2020 2020 2020 2020 2020 6622 4672              f"Fr
+00007fd0: 6571 7472 6164 6520 646f 6573 206e 6f74  eqtrade does not
+00007fe0: 2073 7570 706f 7274 207b 6d6d 5f76 616c   support {mm_val
+00007ff0: 7565 7d20 7b74 7261 6469 6e67 5f6d 6f64  ue} {trading_mod
+00008000: 652e 7661 6c75 657d 206f 6e20 7b73 656c  e.value} on {sel
+00008010: 662e 6e61 6d65 7d22 0a20 2020 2020 2020  f.name}".       
+00008020: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
+00008030: 6765 745f 6f70 7469 6f6e 2873 656c 662c  get_option(self,
+00008040: 2070 6172 616d 3a20 7374 722c 2064 6566   param: str, def
+00008050: 6175 6c74 3a20 4f70 7469 6f6e 616c 5b41  ault: Optional[A
+00008060: 6e79 5d20 3d20 4e6f 6e65 2920 2d3e 2041  ny] = None) -> A
+00008070: 6e79 3a0a 2020 2020 2020 2020 2222 220a  ny:.        """.
+00008080: 2020 2020 2020 2020 4765 7420 7061 7261          Get para
+00008090: 6d65 7465 7220 7661 6c75 6520 6672 6f6d  meter value from
+000080a0: 205f 6674 5f68 6173 0a20 2020 2020 2020   _ft_has.       
+000080b0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+000080c0: 7572 6e20 7365 6c66 2e5f 6674 5f68 6173  urn self._ft_has
+000080d0: 2e67 6574 2870 6172 616d 2c20 6465 6661  .get(param, defa
+000080e0: 756c 7429 0a0a 2020 2020 6465 6620 6578  ult)..    def ex
+000080f0: 6368 616e 6765 5f68 6173 2873 656c 662c  change_has(self,
+00008100: 2065 6e64 706f 696e 743a 2073 7472 2920   endpoint: str) 
+00008110: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+00008120: 2022 2222 0a20 2020 2020 2020 2043 6865   """.        Che
+00008130: 636b 7320 6966 2065 7863 6861 6e67 6520  cks if exchange 
+00008140: 696d 706c 656d 656e 7473 2061 2073 7065  implements a spe
+00008150: 6369 6669 6320 4150 4920 656e 6470 6f69  cific API endpoi
+00008160: 6e74 2e0a 2020 2020 2020 2020 5772 6170  nt..        Wrap
+00008170: 7065 7220 6172 6f75 6e64 2063 6378 7420  per around ccxt 
+00008180: 2768 6173 2720 6174 7472 6962 7574 650a  'has' attribute.
+00008190: 2020 2020 2020 2020 3a70 6172 616d 2065          :param e
+000081a0: 6e64 706f 696e 743a 204e 616d 6520 6f66  ndpoint: Name of
+000081b0: 2065 6e64 706f 696e 7420 2865 2e67 2e20   endpoint (e.g. 
+000081c0: 2766 6574 6368 4f48 4c43 5627 2c20 2766  'fetchOHLCV', 'f
+000081d0: 6574 6368 5469 636b 6572 7327 290a 2020  etchTickers').  
+000081e0: 2020 2020 2020 3a72 6574 7572 6e3a 2062        :return: b
+000081f0: 6f6f 6c0a 2020 2020 2020 2020 2222 220a  ool.        """.
+00008200: 2020 2020 2020 2020 6966 2065 6e64 706f          if endpo
+00008210: 696e 7420 696e 2073 656c 662e 5f66 745f  int in self._ft_
+00008220: 6861 732e 6765 7428 2765 7863 6861 6e67  has.get('exchang
+00008230: 655f 6861 735f 6f76 6572 7269 6465 7327  e_has_overrides'
+00008240: 2c20 7b7d 293a 0a20 2020 2020 2020 2020  , {}):.         
+00008250: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00008260: 6674 5f68 6173 5b27 6578 6368 616e 6765  ft_has['exchange
+00008270: 5f68 6173 5f6f 7665 7272 6964 6573 275d  _has_overrides']
+00008280: 5b65 6e64 706f 696e 745d 0a20 2020 2020  [endpoint].     
+00008290: 2020 2072 6574 7572 6e20 656e 6470 6f69     return endpoi
+000082a0: 6e74 2069 6e20 7365 6c66 2e5f 6170 692e  nt in self._api.
+000082b0: 6861 7320 616e 6420 7365 6c66 2e5f 6170  has and self._ap
+000082c0: 692e 6861 735b 656e 6470 6f69 6e74 5d0a  i.has[endpoint].
+000082d0: 0a20 2020 2064 6566 2067 6574 5f70 7265  .    def get_pre
+000082e0: 6369 7369 6f6e 5f61 6d6f 756e 7428 7365  cision_amount(se
+000082f0: 6c66 2c20 7061 6972 3a20 7374 7229 202d  lf, pair: str) -
+00008300: 3e20 4f70 7469 6f6e 616c 5b66 6c6f 6174  > Optional[float
+00008310: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+00008320: 2020 2020 2020 2052 6574 7572 6e73 2074         Returns t
+00008330: 6865 2061 6d6f 756e 7420 7072 6563 6973  he amount precis
+00008340: 696f 6e20 6f66 2074 6865 2065 7863 6861  ion of the excha
+00008350: 6e67 652e 0a20 2020 2020 2020 203a 7061  nge..        :pa
+00008360: 7261 6d20 7061 6972 3a20 5061 6972 2074  ram pair: Pair t
+00008370: 6f20 6765 7420 7072 6563 6973 696f 6e20  o get precision 
+00008380: 666f 720a 2020 2020 2020 2020 3a72 6574  for.        :ret
+00008390: 7572 6e3a 2070 7265 6369 7369 6f6e 2066  urn: precision f
+000083a0: 6f72 2061 6d6f 756e 7420 6f72 204e 6f6e  or amount or Non
+000083b0: 652e 204d 7573 7420 6265 2075 7365 6420  e. Must be used 
+000083c0: 696e 2063 6f6d 6269 6e61 7469 6f6e 2077  in combination w
+000083d0: 6974 6820 7072 6563 6973 696f 6e4d 6f64  ith precisionMod
+000083e0: 650a 2020 2020 2020 2020 2222 220a 2020  e.        """.  
+000083f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+00008400: 662e 6d61 726b 6574 732e 6765 7428 7061  f.markets.get(pa
+00008410: 6972 2c20 7b7d 292e 6765 7428 2770 7265  ir, {}).get('pre
+00008420: 6369 7369 6f6e 272c 207b 7d29 2e67 6574  cision', {}).get
+00008430: 2827 616d 6f75 6e74 272c 204e 6f6e 6529  ('amount', None)
+00008440: 0a0a 2020 2020 6465 6620 6765 745f 7072  ..    def get_pr
+00008450: 6563 6973 696f 6e5f 7072 6963 6528 7365  ecision_price(se
+00008460: 6c66 2c20 7061 6972 3a20 7374 7229 202d  lf, pair: str) -
+00008470: 3e20 4f70 7469 6f6e 616c 5b66 6c6f 6174  > Optional[float
+00008480: 5d3a 0a20 2020 2020 2020 2022 2222 0a20  ]:.        """. 
+00008490: 2020 2020 2020 2052 6574 7572 6e73 2074         Returns t
+000084a0: 6865 2070 7269 6365 2070 7265 6369 7369  he price precisi
+000084b0: 6f6e 206f 6620 7468 6520 6578 6368 616e  on of the exchan
+000084c0: 6765 2e0a 2020 2020 2020 2020 3a70 6172  ge..        :par
+000084d0: 616d 2070 6169 723a 2050 6169 7220 746f  am pair: Pair to
+000084e0: 2067 6574 2070 7265 6369 7369 6f6e 2066   get precision f
+000084f0: 6f72 0a20 2020 2020 2020 203a 7265 7475  or.        :retu
+00008500: 726e 3a20 7072 6563 6973 696f 6e20 666f  rn: precision fo
+00008510: 7220 7072 6963 6520 6f72 204e 6f6e 652e  r price or None.
+00008520: 204d 7573 7420 6265 2075 7365 6420 696e   Must be used in
+00008530: 2063 6f6d 6269 6e61 7469 6f6e 2077 6974   combination wit
+00008540: 6820 7072 6563 6973 696f 6e4d 6f64 650a  h precisionMode.
+00008550: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00008560: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00008570: 6d61 726b 6574 732e 6765 7428 7061 6972  markets.get(pair
+00008580: 2c20 7b7d 292e 6765 7428 2770 7265 6369  , {}).get('preci
+00008590: 7369 6f6e 272c 207b 7d29 2e67 6574 2827  sion', {}).get('
+000085a0: 7072 6963 6527 2c20 4e6f 6e65 290a 0a20  price', None).. 
+000085b0: 2020 2064 6566 2061 6d6f 756e 745f 746f     def amount_to
+000085c0: 5f70 7265 6369 7369 6f6e 2873 656c 662c  _precision(self,
+000085d0: 2070 6169 723a 2073 7472 2c20 616d 6f75   pair: str, amou
+000085e0: 6e74 3a20 666c 6f61 7429 202d 3e20 666c  nt: float) -> fl
+000085f0: 6f61 743a 0a20 2020 2020 2020 2022 2222  oat:.        """
+00008600: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
+00008610: 2074 6865 2061 6d6f 756e 7420 746f 2062   the amount to b
+00008620: 7579 206f 7220 7365 6c6c 2074 6f20 6120  uy or sell to a 
+00008630: 7072 6563 6973 696f 6e20 7468 6520 4578  precision the Ex
+00008640: 6368 616e 6765 2061 6363 6570 7473 0a0a  change accepts..
+00008650: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00008660: 2020 2020 7265 7475 726e 2061 6d6f 756e      return amoun
+00008670: 745f 746f 5f70 7265 6369 7369 6f6e 2861  t_to_precision(a
+00008680: 6d6f 756e 742c 2073 656c 662e 6765 745f  mount, self.get_
+00008690: 7072 6563 6973 696f 6e5f 616d 6f75 6e74  precision_amount
+000086a0: 2870 6169 7229 2c20 7365 6c66 2e70 7265  (pair), self.pre
+000086b0: 6369 7369 6f6e 4d6f 6465 290a 0a20 2020  cisionMode)..   
+000086c0: 2064 6566 2070 7269 6365 5f74 6f5f 7072   def price_to_pr
+000086d0: 6563 6973 696f 6e28 7365 6c66 2c20 7061  ecision(self, pa
+000086e0: 6972 3a20 7374 722c 2070 7269 6365 3a20  ir: str, price: 
+000086f0: 666c 6f61 742c 202a 2c20 726f 756e 6469  float, *, roundi
+00008700: 6e67 5f6d 6f64 653a 2069 6e74 203d 2052  ng_mode: int = R
+00008710: 4f55 4e44 2920 2d3e 2066 6c6f 6174 3a0a  OUND) -> float:.
+00008720: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00008730: 2020 2020 5265 7475 726e 7320 7468 6520      Returns the 
+00008740: 7072 6963 6520 726f 756e 6465 6420 746f  price rounded to
+00008750: 2074 6865 2070 7265 6369 7369 6f6e 2074   the precision t
+00008760: 6865 2045 7863 6861 6e67 6520 6163 6365  he Exchange acce
+00008770: 7074 732e 0a20 2020 2020 2020 2054 6865  pts..        The
+00008780: 2064 6566 6175 6c74 2070 7269 6365 5f72   default price_r
+00008790: 6f75 6e64 696e 675f 6d6f 6465 2069 6e20  ounding_mode in 
+000087a0: 636f 6e66 2069 7320 524f 554e 442e 0a20  conf is ROUND.. 
+000087b0: 2020 2020 2020 2046 6f72 2073 746f 706c         For stopl
+000087c0: 6f73 7320 6361 6c63 756c 6174 696f 6e73  oss calculations
+000087d0: 2c20 6d75 7374 2075 7365 2052 4f55 4e44  , must use ROUND
+000087e0: 5f55 5020 666f 7220 6c6f 6e67 732c 2061  _UP for longs, a
+000087f0: 6e64 2052 4f55 4e44 5f44 4f57 4e20 666f  nd ROUND_DOWN fo
+00008800: 7220 7368 6f72 7473 2e0a 2020 2020 2020  r shorts..      
+00008810: 2020 2222 220a 2020 2020 2020 2020 7265    """.        re
+00008820: 7475 726e 2070 7269 6365 5f74 6f5f 7072  turn price_to_pr
+00008830: 6563 6973 696f 6e28 7072 6963 652c 2073  ecision(price, s
+00008840: 656c 662e 6765 745f 7072 6563 6973 696f  elf.get_precisio
+00008850: 6e5f 7072 6963 6528 7061 6972 292c 0a20  n_price(pair),. 
+00008860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008880: 2073 656c 662e 7072 6563 6973 696f 6e4d   self.precisionM
+00008890: 6f64 652c 2072 6f75 6e64 696e 675f 6d6f  ode, rounding_mo
+000088a0: 6465 3d72 6f75 6e64 696e 675f 6d6f 6465  de=rounding_mode
+000088b0: 290a 0a20 2020 2064 6566 2070 7269 6365  )..    def price
+000088c0: 5f67 6574 5f6f 6e65 5f70 6970 2873 656c  _get_one_pip(sel
+000088d0: 662c 2070 6169 723a 2073 7472 2c20 7072  f, pair: str, pr
+000088e0: 6963 653a 2066 6c6f 6174 2920 2d3e 2066  ice: float) -> f
+000088f0: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
+00008900: 220a 2020 2020 2020 2020 4765 7473 2074  ".        Gets t
+00008910: 6865 2022 3120 7069 7022 2076 616c 7565  he "1 pip" value
+00008920: 2066 6f72 2074 6869 7320 7061 6972 2e0a   for this pair..
+00008930: 2020 2020 2020 2020 5573 6564 2069 6e20          Used in 
+00008940: 5072 6963 6546 696c 7465 7220 746f 2063  PriceFilter to c
+00008950: 616c 6375 6c61 7465 2074 6865 2031 7069  alculate the 1pi
+00008960: 7020 6d6f 7665 6d65 6e74 732e 0a20 2020  p movements..   
+00008970: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00008980: 2070 7265 6369 7369 6f6e 203d 2073 656c   precision = sel
+00008990: 662e 6d61 726b 6574 735b 7061 6972 5d5b  f.markets[pair][
+000089a0: 2770 7265 6369 7369 6f6e 275d 5b27 7072  'precision']['pr
+000089b0: 6963 6527 5d0a 2020 2020 2020 2020 6966  ice'].        if
+000089c0: 2073 656c 662e 7072 6563 6973 696f 6e4d   self.precisionM
+000089d0: 6f64 6520 3d3d 2054 4943 4b5f 5349 5a45  ode == TICK_SIZE
+000089e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000089f0: 7475 726e 2070 7265 6369 7369 6f6e 0a20  turn precision. 
+00008a00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00008a10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00008a20: 3120 2f20 706f 7728 3130 2c20 7072 6563  1 / pow(10, prec
+00008a30: 6973 696f 6e29 0a0a 2020 2020 6465 6620  ision)..    def 
+00008a40: 6765 745f 6d69 6e5f 7061 6972 5f73 7461  get_min_pair_sta
+00008a50: 6b65 5f61 6d6f 756e 7428 0a20 2020 2020  ke_amount(.     
+00008a60: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00008a70: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
+00008a80: 2020 2020 7072 6963 653a 2066 6c6f 6174      price: float
+00008a90: 2c0a 2020 2020 2020 2020 7374 6f70 6c6f  ,.        stoplo
+00008aa0: 7373 3a20 666c 6f61 742c 0a20 2020 2020  ss: float,.     
+00008ab0: 2020 206c 6576 6572 6167 653a 204f 7074     leverage: Opt
+00008ac0: 696f 6e61 6c5b 666c 6f61 745d 203d 2031  ional[float] = 1
+00008ad0: 2e30 0a20 2020 2029 202d 3e20 4f70 7469  .0.    ) -> Opti
+00008ae0: 6f6e 616c 5b66 6c6f 6174 5d3a 0a20 2020  onal[float]:.   
+00008af0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+00008b00: 2e5f 6765 745f 7374 616b 655f 616d 6f75  ._get_stake_amou
+00008b10: 6e74 5f6c 696d 6974 2870 6169 722c 2070  nt_limit(pair, p
+00008b20: 7269 6365 2c20 7374 6f70 6c6f 7373 2c20  rice, stoploss, 
+00008b30: 276d 696e 272c 206c 6576 6572 6167 6529  'min', leverage)
+00008b40: 0a0a 2020 2020 6465 6620 6765 745f 6d61  ..    def get_ma
+00008b50: 785f 7061 6972 5f73 7461 6b65 5f61 6d6f  x_pair_stake_amo
+00008b60: 756e 7428 7365 6c66 2c20 7061 6972 3a20  unt(self, pair: 
+00008b70: 7374 722c 2070 7269 6365 3a20 666c 6f61  str, price: floa
+00008b80: 742c 206c 6576 6572 6167 653a 2066 6c6f  t, leverage: flo
+00008b90: 6174 203d 2031 2e30 2920 2d3e 2066 6c6f  at = 1.0) -> flo
+00008ba0: 6174 3a0a 2020 2020 2020 2020 6d61 785f  at:.        max_
+00008bb0: 7374 616b 655f 616d 6f75 6e74 203d 2073  stake_amount = s
+00008bc0: 656c 662e 5f67 6574 5f73 7461 6b65 5f61  elf._get_stake_a
+00008bd0: 6d6f 756e 745f 6c69 6d69 7428 7061 6972  mount_limit(pair
+00008be0: 2c20 7072 6963 652c 2030 2e30 2c20 276d  , price, 0.0, 'm
+00008bf0: 6178 272c 206c 6576 6572 6167 6529 0a20  ax', leverage). 
+00008c00: 2020 2020 2020 2069 6620 6d61 785f 7374         if max_st
+00008c10: 616b 655f 616d 6f75 6e74 2069 7320 4e6f  ake_amount is No
+00008c20: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00008c30: 2320 2a20 5368 6f75 6c64 206e 6576 6572  # * Should never
+00008c40: 2062 6520 6578 6563 7574 6564 0a20 2020   be executed.   
+00008c50: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+00008c60: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00008c70: 696f 6e28 6627 7b73 656c 662e 6e61 6d65  ion(f'{self.name
+00008c80: 7d2e 6765 745f 6d61 785f 7061 6972 5f73  }.get_max_pair_s
+00008c90: 7461 6b65 5f61 6d6f 756e 7420 7368 6f75  take_amount shou
+00008ca0: 6c64 270a 2020 2020 2020 2020 2020 2020  ld'.            
+00008cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008cc0: 2020 2020 2020 2020 2020 2027 6e65 7665             'neve
+00008cd0: 7220 7365 7420 6d61 785f 7374 616b 655f  r set max_stake_
+00008ce0: 616d 6f75 6e74 2074 6f20 4e6f 6e65 2729  amount to None')
+00008cf0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00008d00: 6d61 785f 7374 616b 655f 616d 6f75 6e74  max_stake_amount
+00008d10: 0a0a 2020 2020 6465 6620 5f67 6574 5f73  ..    def _get_s
+00008d20: 7461 6b65 5f61 6d6f 756e 745f 6c69 6d69  take_amount_limi
+00008d30: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
+00008d40: 0a20 2020 2020 2020 2070 6169 723a 2073  .        pair: s
+00008d50: 7472 2c0a 2020 2020 2020 2020 7072 6963  tr,.        pric
+00008d60: 653a 2066 6c6f 6174 2c0a 2020 2020 2020  e: float,.      
+00008d70: 2020 7374 6f70 6c6f 7373 3a20 666c 6f61    stoploss: floa
+00008d80: 742c 0a20 2020 2020 2020 206c 696d 6974  t,.        limit
+00008d90: 3a20 4c69 7465 7261 6c5b 276d 696e 272c  : Literal['min',
+00008da0: 2027 6d61 7827 5d2c 0a20 2020 2020 2020   'max'],.       
+00008db0: 206c 6576 6572 6167 653a 204f 7074 696f   leverage: Optio
+00008dc0: 6e61 6c5b 666c 6f61 745d 203d 2031 2e30  nal[float] = 1.0
+00008dd0: 0a20 2020 2029 202d 3e20 4f70 7469 6f6e  .    ) -> Option
+00008de0: 616c 5b66 6c6f 6174 5d3a 0a0a 2020 2020  al[float]:..    
+00008df0: 2020 2020 6973 4d69 6e20 3d20 6c69 6d69      isMin = limi
+00008e00: 7420 3d3d 2027 6d69 6e27 0a0a 2020 2020  t == 'min'..    
+00008e10: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00008e20: 2020 2020 206d 6172 6b65 7420 3d20 7365       market = se
+00008e30: 6c66 2e6d 6172 6b65 7473 5b70 6169 725d  lf.markets[pair]
+00008e40: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00008e50: 4b65 7945 7272 6f72 3a0a 2020 2020 2020  KeyError:.      
+00008e60: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00008e70: 6545 7272 6f72 2866 2243 616e 2774 2067  eError(f"Can't g
+00008e80: 6574 206d 6172 6b65 7420 696e 666f 726d  et market inform
+00008e90: 6174 696f 6e20 666f 7220 7379 6d62 6f6c  ation for symbol
+00008ea0: 207b 7061 6972 7d22 290a 0a20 2020 2020   {pair}")..     
+00008eb0: 2020 2069 6620 6973 4d69 6e3a 0a20 2020     if isMin:.   
+00008ec0: 2020 2020 2020 2020 2023 2072 6573 6572           # reser
+00008ed0: 7665 2073 6f6d 6520 7065 7263 656e 7420  ve some percent 
+00008ee0: 6465 6669 6e65 6420 696e 2063 6f6e 6669  defined in confi
+00008ef0: 6720 2835 2520 6465 6661 756c 7429 202b  g (5% default) +
+00008f00: 2073 746f 706c 6f73 730a 2020 2020 2020   stoploss.      
+00008f10: 2020 2020 2020 6d61 7267 696e 5f72 6573        margin_res
+00008f20: 6572 7665 3a20 666c 6f61 7420 3d20 312e  erve: float = 1.
+00008f30: 3020 2b20 7365 6c66 2e5f 636f 6e66 6967  0 + self._config
+00008f40: 2e67 6574 2827 616d 6f75 6e74 5f72 6573  .get('amount_res
+00008f50: 6572 7665 5f70 6572 6365 6e74 272c 0a20  erve_percent',. 
 00008f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f70: 2020 4445 4641 554c 545f 414d 4f55 4e54    DEFAULT_AMOUNT
-00008f80: 5f52 4553 4552 5645 5f50 4552 4345 4e54  _RESERVE_PERCENT
-00008f90: 290a 2020 2020 2020 2020 2020 2020 7374  ).            st
-00008fa0: 6f70 6c6f 7373 5f72 6573 6572 7665 203d  oploss_reserve =
-00008fb0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-00008fc0: 2020 206d 6172 6769 6e5f 7265 7365 7276     margin_reserv
-00008fd0: 6520 2f20 2831 202d 2061 6273 2873 746f  e / (1 - abs(sto
-00008fe0: 706c 6f73 7329 2920 6966 2061 6273 2873  ploss)) if abs(s
-00008ff0: 746f 706c 6f73 7329 2021 3d20 3120 656c  toploss) != 1 el
-00009000: 7365 2031 2e35 0a20 2020 2020 2020 2020  se 1.5.         
-00009010: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00009020: 2023 2069 7420 7368 6f75 6c64 206e 6f74   # it should not
-00009030: 2062 6520 6d6f 7265 2074 6861 6e20 3530   be more than 50
-00009040: 250a 2020 2020 2020 2020 2020 2020 7374  %.            st
-00009050: 6f70 6c6f 7373 5f72 6573 6572 7665 203d  oploss_reserve =
-00009060: 206d 6178 286d 696e 2873 746f 706c 6f73   max(min(stoplos
-00009070: 735f 7265 7365 7276 652c 2031 2e35 292c  s_reserve, 1.5),
-00009080: 2031 290a 2020 2020 2020 2020 656c 7365   1).        else
-00009090: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-000090a0: 7267 696e 5f72 6573 6572 7665 203d 2031  rgin_reserve = 1
-000090b0: 2e30 0a20 2020 2020 2020 2020 2020 2073  .0.            s
-000090c0: 746f 706c 6f73 735f 7265 7365 7276 6520  toploss_reserve 
-000090d0: 3d20 312e 300a 0a20 2020 2020 2020 2073  = 1.0..        s
-000090e0: 7461 6b65 5f6c 696d 6974 7320 3d20 5b5d  take_limits = []
-000090f0: 0a20 2020 2020 2020 206c 696d 6974 7320  .        limits 
-00009100: 3d20 6d61 726b 6574 5b27 6c69 6d69 7473  = market['limits
-00009110: 275d 0a20 2020 2020 2020 2069 6620 286c  '].        if (l
-00009120: 696d 6974 735b 2763 6f73 7427 5d5b 6c69  imits['cost'][li
-00009130: 6d69 745d 2069 7320 6e6f 7420 4e6f 6e65  mit] is not None
-00009140: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00009150: 7461 6b65 5f6c 696d 6974 732e 6170 7065  take_limits.appe
-00009160: 6e64 280a 2020 2020 2020 2020 2020 2020  nd(.            
-00009170: 2020 2020 7365 6c66 2e5f 636f 6e74 7261      self._contra
-00009180: 6374 735f 746f 5f61 6d6f 756e 7428 7061  cts_to_amount(pa
-00009190: 6972 2c20 6c69 6d69 7473 5b27 636f 7374  ir, limits['cost
-000091a0: 275d 5b6c 696d 6974 5d29 202a 2073 746f  '][limit]) * sto
-000091b0: 706c 6f73 735f 7265 7365 7276 650a 2020  ploss_reserve.  
-000091c0: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-000091d0: 2020 2020 2069 6620 286c 696d 6974 735b       if (limits[
-000091e0: 2761 6d6f 756e 7427 5d5b 6c69 6d69 745d  'amount'][limit]
-000091f0: 2069 7320 6e6f 7420 4e6f 6e65 293a 0a20   is not None):. 
-00009200: 2020 2020 2020 2020 2020 2073 7461 6b65             stake
-00009210: 5f6c 696d 6974 732e 6170 7065 6e64 280a  _limits.append(.
-00009220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009230: 7365 6c66 2e5f 636f 6e74 7261 6374 735f  self._contracts_
-00009240: 746f 5f61 6d6f 756e 7428 7061 6972 2c20  to_amount(pair, 
-00009250: 6c69 6d69 7473 5b27 616d 6f75 6e74 275d  limits['amount']
-00009260: 5b6c 696d 6974 5d29 202a 2070 7269 6365  [limit]) * price
-00009270: 202a 206d 6172 6769 6e5f 7265 7365 7276   * margin_reserv
-00009280: 650a 2020 2020 2020 2020 2020 2020 290a  e.            ).
-00009290: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-000092a0: 7374 616b 655f 6c69 6d69 7473 3a0a 2020  stake_limits:.  
-000092b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000092c0: 204e 6f6e 6520 6966 2069 734d 696e 2065   None if isMin e
-000092d0: 6c73 6520 666c 6f61 7428 2769 6e66 2729  lse float('inf')
-000092e0: 0a0a 2020 2020 2020 2020 2320 5468 6520  ..        # The 
-000092f0: 7661 6c75 6520 7265 7475 726e 6564 2073  value returned s
-00009300: 686f 756c 6420 7361 7469 7366 7920 626f  hould satisfy bo
-00009310: 7468 206c 696d 6974 733a 2066 6f72 2061  th limits: for a
-00009320: 6d6f 756e 7420 2862 6173 6520 6375 7272  mount (base curr
-00009330: 656e 6379 2920 616e 640a 2020 2020 2020  ency) and.      
-00009340: 2020 2320 666f 7220 636f 7374 2028 7175    # for cost (qu
-00009350: 6f74 652c 2073 7461 6b65 2063 7572 7265  ote, stake curre
-00009360: 6e63 7929 2c20 736f 206d 6178 2829 2069  ncy), so max() i
-00009370: 7320 7573 6564 2068 6572 652e 0a20 2020  s used here..   
-00009380: 2020 2020 2023 2053 6565 2061 6c73 6f20       # See also 
-00009390: 2332 3537 3520 6174 2067 6974 6875 622e  #2575 at github.
-000093a0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000093b0: 7365 6c66 2e5f 6765 745f 7374 616b 655f  self._get_stake_
-000093c0: 616d 6f75 6e74 5f63 6f6e 7369 6465 7269  amount_consideri
-000093d0: 6e67 5f6c 6576 6572 6167 6528 0a20 2020  ng_leverage(.   
-000093e0: 2020 2020 2020 2020 206d 6178 2873 7461           max(sta
-000093f0: 6b65 5f6c 696d 6974 7329 2069 6620 6973  ke_limits) if is
-00009400: 4d69 6e20 656c 7365 206d 696e 2873 7461  Min else min(sta
-00009410: 6b65 5f6c 696d 6974 7329 2c0a 2020 2020  ke_limits),.    
-00009420: 2020 2020 2020 2020 6c65 7665 7261 6765          leverage
-00009430: 206f 7220 312e 300a 2020 2020 2020 2020   or 1.0.        
-00009440: 290a 0a20 2020 2064 6566 205f 6765 745f  )..    def _get_
-00009450: 7374 616b 655f 616d 6f75 6e74 5f63 6f6e  stake_amount_con
-00009460: 7369 6465 7269 6e67 5f6c 6576 6572 6167  sidering_leverag
-00009470: 6528 7365 6c66 2c20 7374 616b 655f 616d  e(self, stake_am
-00009480: 6f75 6e74 3a20 666c 6f61 742c 206c 6576  ount: float, lev
-00009490: 6572 6167 653a 2066 6c6f 6174 2920 2d3e  erage: float) ->
-000094a0: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
-000094b0: 2222 220a 2020 2020 2020 2020 5461 6b65  """.        Take
-000094c0: 7320 7468 6520 6d69 6e69 6d75 6d20 7374  s the minimum st
-000094d0: 616b 6520 616d 6f75 6e74 2066 6f72 2061  ake amount for a
-000094e0: 2070 6169 7220 7769 7468 206e 6f20 6c65   pair with no le
-000094f0: 7665 7261 6765 2061 6e64 2072 6574 7572  verage and retur
-00009500: 6e73 2074 6865 206d 696e 696d 756d 0a20  ns the minimum. 
-00009510: 2020 2020 2020 2073 7461 6b65 2061 6d6f         stake amo
-00009520: 756e 7420 7768 656e 206c 6576 6572 6167  unt when leverag
-00009530: 6520 6973 2063 6f6e 7369 6465 7265 640a  e is considered.
-00009540: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-00009550: 7461 6b65 5f61 6d6f 756e 743a 2054 6865  take_amount: The
-00009560: 2073 7461 6b65 2061 6d6f 756e 7420 666f   stake amount fo
-00009570: 7220 6120 7061 6972 2062 6566 6f72 6520  r a pair before 
-00009580: 6c65 7665 7261 6765 2069 7320 636f 6e73  leverage is cons
-00009590: 6964 6572 6564 0a20 2020 2020 2020 203a  idered.        :
-000095a0: 7061 7261 6d20 6c65 7665 7261 6765 3a20  param leverage: 
-000095b0: 5468 6520 616d 6f75 6e74 206f 6620 6c65  The amount of le
-000095c0: 7665 7261 6765 2062 6569 6e67 2075 7365  verage being use
-000095d0: 6420 6f6e 2074 6865 2063 7572 7265 6e74  d on the current
-000095e0: 2074 7261 6465 0a20 2020 2020 2020 2022   trade.        "
-000095f0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00009600: 6e20 7374 616b 655f 616d 6f75 6e74 202f  n stake_amount /
-00009610: 206c 6576 6572 6167 650a 0a20 2020 2023   leverage..    #
-00009620: 2044 7279 2d72 756e 206d 6574 686f 6473   Dry-run methods
-00009630: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
-00009640: 5f64 7279 5f72 756e 5f6f 7264 6572 2873  _dry_run_order(s
-00009650: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
-00009660: 6f72 6465 7274 7970 653a 2073 7472 2c20  ordertype: str, 
-00009670: 7369 6465 3a20 7374 722c 2061 6d6f 756e  side: str, amoun
-00009680: 743a 2066 6c6f 6174 2c0a 2020 2020 2020  t: float,.      
-00009690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096a0: 2020 2020 2020 2072 6174 653a 2066 6c6f         rate: flo
-000096b0: 6174 2c20 6c65 7665 7261 6765 3a20 666c  at, leverage: fl
-000096c0: 6f61 742c 2070 6172 616d 733a 2044 6963  oat, params: Dic
-000096d0: 7420 3d20 7b7d 2c0a 2020 2020 2020 2020  t = {},.        
-000096e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000096f0: 2020 2020 2073 746f 705f 6c6f 7373 3a20       stop_loss: 
-00009700: 626f 6f6c 203d 2046 616c 7365 2920 2d3e  bool = False) ->
-00009710: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
-00009720: 0a20 2020 2020 2020 206e 6f77 203d 2064  .        now = d
-00009730: 745f 6e6f 7728 290a 2020 2020 2020 2020  t_now().        
-00009740: 6f72 6465 725f 6964 203d 2066 2764 7279  order_id = f'dry
-00009750: 5f72 756e 5f7b 7369 6465 7d5f 7b70 6169  _run_{side}_{pai
-00009760: 727d 5f7b 6e6f 772e 7469 6d65 7374 616d  r}_{now.timestam
-00009770: 7028 297d 270a 2020 2020 2020 2020 2320  p()}'.        # 
-00009780: 526f 756e 6469 6e67 2068 6572 6520 6d75  Rounding here mu
-00009790: 7374 2072 6573 7065 6374 2074 6f20 636f  st respect to co
-000097a0: 6e74 7261 6374 2073 697a 6573 0a20 2020  ntract sizes.   
-000097b0: 2020 2020 205f 616d 6f75 6e74 203d 2073       _amount = s
-000097c0: 656c 662e 5f63 6f6e 7472 6163 7473 5f74  elf._contracts_t
-000097d0: 6f5f 616d 6f75 6e74 280a 2020 2020 2020  o_amount(.      
-000097e0: 2020 2020 2020 7061 6972 2c20 7365 6c66        pair, self
-000097f0: 2e61 6d6f 756e 745f 746f 5f70 7265 6369  .amount_to_preci
-00009800: 7369 6f6e 2870 6169 722c 2073 656c 662e  sion(pair, self.
-00009810: 5f61 6d6f 756e 745f 746f 5f63 6f6e 7472  _amount_to_contr
-00009820: 6163 7473 2870 6169 722c 2061 6d6f 756e  acts(pair, amoun
-00009830: 7429 2929 0a20 2020 2020 2020 2064 7279  t))).        dry
-00009840: 5f6f 7264 6572 3a20 4469 6374 5b73 7472  _order: Dict[str
-00009850: 2c20 416e 795d 203d 207b 0a20 2020 2020  , Any] = {.     
-00009860: 2020 2020 2020 2027 6964 273a 206f 7264         'id': ord
-00009870: 6572 5f69 642c 0a20 2020 2020 2020 2020  er_id,.         
-00009880: 2020 2027 7379 6d62 6f6c 273a 2070 6169     'symbol': pai
-00009890: 722c 0a20 2020 2020 2020 2020 2020 2027  r,.            '
-000098a0: 7072 6963 6527 3a20 7261 7465 2c0a 2020  price': rate,.  
-000098b0: 2020 2020 2020 2020 2020 2761 7665 7261            'avera
-000098c0: 6765 273a 2072 6174 652c 0a20 2020 2020  ge': rate,.     
-000098d0: 2020 2020 2020 2027 616d 6f75 6e74 273a         'amount':
-000098e0: 205f 616d 6f75 6e74 2c0a 2020 2020 2020   _amount,.      
-000098f0: 2020 2020 2020 2763 6f73 7427 3a20 5f61        'cost': _a
-00009900: 6d6f 756e 7420 2a20 7261 7465 2c0a 2020  mount * rate,.  
-00009910: 2020 2020 2020 2020 2020 2774 7970 6527            'type'
-00009920: 3a20 6f72 6465 7274 7970 652c 0a20 2020  : ordertype,.   
-00009930: 2020 2020 2020 2020 2027 7369 6465 273a           'side':
-00009940: 2073 6964 652c 0a20 2020 2020 2020 2020   side,.         
-00009950: 2020 2027 6669 6c6c 6564 273a 2030 2c0a     'filled': 0,.
-00009960: 2020 2020 2020 2020 2020 2020 2772 656d              'rem
-00009970: 6169 6e69 6e67 273a 205f 616d 6f75 6e74  aining': _amount
-00009980: 2c0a 2020 2020 2020 2020 2020 2020 2764  ,.            'd
-00009990: 6174 6574 696d 6527 3a20 6e6f 772e 7374  atetime': now.st
-000099a0: 7266 7469 6d65 2827 2559 2d25 6d2d 2564  rftime('%Y-%m-%d
-000099b0: 5425 483a 254d 3a25 532e 2566 5a27 292c  T%H:%M:%S.%fZ'),
-000099c0: 0a20 2020 2020 2020 2020 2020 2027 7469  .            'ti
-000099d0: 6d65 7374 616d 7027 3a20 6474 5f74 7328  mestamp': dt_ts(
-000099e0: 6e6f 7729 2c0a 2020 2020 2020 2020 2020  now),.          
-000099f0: 2020 2773 7461 7475 7327 3a20 226f 7065    'status': "ope
-00009a00: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
-00009a10: 2766 6565 273a 204e 6f6e 652c 0a20 2020  'fee': None,.   
-00009a20: 2020 2020 2020 2020 2027 696e 666f 273a           'info':
-00009a30: 207b 7d2c 0a20 2020 2020 2020 2020 2020   {},.           
-00009a40: 2027 6c65 7665 7261 6765 273a 206c 6576   'leverage': lev
-00009a50: 6572 6167 650a 2020 2020 2020 2020 7d0a  erage.        }.
-00009a60: 2020 2020 2020 2020 6966 2073 746f 705f          if stop_
-00009a70: 6c6f 7373 3a0a 2020 2020 2020 2020 2020  loss:.          
-00009a80: 2020 6472 795f 6f72 6465 725b 2269 6e66    dry_order["inf
-00009a90: 6f22 5d20 3d20 7b22 7374 6f70 5072 6963  o"] = {"stopPric
-00009aa0: 6522 3a20 6472 795f 6f72 6465 725b 2270  e": dry_order["p
-00009ab0: 7269 6365 225d 7d0a 2020 2020 2020 2020  rice"]}.        
-00009ac0: 2020 2020 6472 795f 6f72 6465 725b 7365      dry_order[se
-00009ad0: 6c66 2e5f 6674 5f68 6173 5b27 7374 6f70  lf._ft_has['stop
-00009ae0: 5f70 7269 6365 5f70 726f 7027 5d5d 203d  _price_prop']] =
-00009af0: 2064 7279 5f6f 7264 6572 5b22 7072 6963   dry_order["pric
-00009b00: 6522 5d0a 2020 2020 2020 2020 2020 2020  e"].            
-00009b10: 2320 576f 726b 6172 6f75 6e64 2074 6f20  # Workaround to 
-00009b20: 6176 6f69 6420 6669 6c6c 696e 6720 7374  avoid filling st
-00009b30: 6f70 6c6f 7373 206f 7264 6572 7320 696d  oploss orders im
-00009b40: 6d65 6469 6174 656c 790a 2020 2020 2020  mediately.      
-00009b50: 2020 2020 2020 6472 795f 6f72 6465 725b        dry_order[
-00009b60: 2266 745f 6f72 6465 725f 7479 7065 225d  "ft_order_type"]
-00009b70: 203d 2022 7374 6f70 6c6f 7373 220a 2020   = "stoploss".  
-00009b80: 2020 2020 2020 6f72 6465 7262 6f6f 6b3a        orderbook:
-00009b90: 204f 7074 696f 6e61 6c5b 4f72 6465 7242   Optional[OrderB
-00009ba0: 6f6f 6b5d 203d 204e 6f6e 650a 2020 2020  ook] = None.    
-00009bb0: 2020 2020 6966 2073 656c 662e 6578 6368      if self.exch
-00009bc0: 616e 6765 5f68 6173 2827 6665 7463 684c  ange_has('fetchL
-00009bd0: 324f 7264 6572 426f 6f6b 2729 3a0a 2020  2OrderBook'):.  
-00009be0: 2020 2020 2020 2020 2020 6f72 6465 7262            orderb
-00009bf0: 6f6f 6b20 3d20 7365 6c66 2e66 6574 6368  ook = self.fetch
-00009c00: 5f6c 325f 6f72 6465 725f 626f 6f6b 2870  _l2_order_book(p
-00009c10: 6169 722c 2032 3029 0a20 2020 2020 2020  air, 20).       
-00009c20: 2069 6620 6f72 6465 7274 7970 6520 3d3d   if ordertype ==
-00009c30: 2022 6c69 6d69 7422 2061 6e64 206f 7264   "limit" and ord
-00009c40: 6572 626f 6f6b 3a0a 2020 2020 2020 2020  erbook:.        
-00009c50: 2020 2020 2320 416c 6c6f 7720 6120 3125      # Allow a 1%
-00009c60: 2070 7269 6365 2064 6966 6665 7265 6e63   price differenc
-00009c70: 650a 2020 2020 2020 2020 2020 2020 616c  e.            al
-00009c80: 6c6f 7765 645f 6469 6666 203d 2030 2e30  lowed_diff = 0.0
-00009c90: 310a 2020 2020 2020 2020 2020 2020 6966  1.            if
-00009ca0: 2073 656c 662e 5f64 7279 5f69 735f 7072   self._dry_is_pr
-00009cb0: 6963 655f 6372 6f73 7365 6428 7061 6972  ice_crossed(pair
-00009cc0: 2c20 7369 6465 2c20 7261 7465 2c20 6f72  , side, rate, or
-00009cd0: 6465 7262 6f6f 6b2c 2061 6c6c 6f77 6564  derbook, allowed
-00009ce0: 5f64 6966 6629 3a0a 2020 2020 2020 2020  _diff):.        
-00009cf0: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
-00009d00: 6e66 6f28 0a20 2020 2020 2020 2020 2020  nfo(.           
-00009d10: 2020 2020 2020 2020 2066 2243 6f6e 7665           f"Conve
-00009d20: 7274 6564 206f 7264 6572 207b 7061 6972  rted order {pair
-00009d30: 7d20 746f 206d 6172 6b65 7420 6f72 6465  } to market orde
-00009d40: 7220 6475 6520 746f 2070 7269 6365 207b  r due to price {
-00009d50: 7261 7465 7d20 6372 6f73 7369 6e67 2073  rate} crossing s
-00009d60: 7072 6561 6420 220a 2020 2020 2020 2020  pread ".        
-00009d70: 2020 2020 2020 2020 2020 2020 6622 6279              f"by
-00009d80: 206d 6f72 6520 7468 616e 207b 616c 6c6f   more than {allo
-00009d90: 7765 645f 6469 6666 3a2e 3225 7d2e 2229  wed_diff:.2%}.")
-00009da0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009db0: 2064 7279 5f6f 7264 6572 5b22 7479 7065   dry_order["type
-00009dc0: 225d 203d 2022 6d61 726b 6574 220a 0a20  "] = "market".. 
-00009dd0: 2020 2020 2020 2069 6620 6472 795f 6f72         if dry_or
-00009de0: 6465 725b 2274 7970 6522 5d20 3d3d 2022  der["type"] == "
-00009df0: 6d61 726b 6574 2220 616e 6420 6e6f 7420  market" and not 
-00009e00: 6472 795f 6f72 6465 722e 6765 7428 2266  dry_order.get("f
-00009e10: 745f 6f72 6465 725f 7479 7065 2229 3a0a  t_order_type"):.
-00009e20: 2020 2020 2020 2020 2020 2020 2320 5570              # Up
-00009e30: 6461 7465 206d 6172 6b65 7420 6f72 6465  date market orde
-00009e40: 7220 7072 6963 696e 670a 2020 2020 2020  r pricing.      
-00009e50: 2020 2020 2020 6176 6572 6167 6520 3d20        average = 
-00009e60: 7365 6c66 2e67 6574 5f64 7279 5f6d 6172  self.get_dry_mar
-00009e70: 6b65 745f 6669 6c6c 5f70 7269 6365 2870  ket_fill_price(p
-00009e80: 6169 722c 2073 6964 652c 2061 6d6f 756e  air, side, amoun
-00009e90: 742c 2072 6174 652c 206f 7264 6572 626f  t, rate, orderbo
-00009ea0: 6f6b 290a 2020 2020 2020 2020 2020 2020  ok).            
-00009eb0: 6472 795f 6f72 6465 722e 7570 6461 7465  dry_order.update
-00009ec0: 287b 0a20 2020 2020 2020 2020 2020 2020  ({.             
-00009ed0: 2020 2027 6176 6572 6167 6527 3a20 6176     'average': av
-00009ee0: 6572 6167 652c 0a20 2020 2020 2020 2020  erage,.         
-00009ef0: 2020 2020 2020 2027 6669 6c6c 6564 273a         'filled':
-00009f00: 205f 616d 6f75 6e74 2c0a 2020 2020 2020   _amount,.      
-00009f10: 2020 2020 2020 2020 2020 2772 656d 6169            'remai
-00009f20: 6e69 6e67 273a 2030 2e30 2c0a 2020 2020  ning': 0.0,.    
-00009f30: 2020 2020 2020 2020 2020 2020 2773 7461              'sta
-00009f40: 7475 7327 3a20 2263 6c6f 7365 6422 2c0a  tus': "closed",.
-00009f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009f60: 2763 6f73 7427 3a20 2864 7279 5f6f 7264  'cost': (dry_ord
-00009f70: 6572 5b27 616d 6f75 6e74 275d 202a 2061  er['amount'] * a
-00009f80: 7665 7261 6765 290a 2020 2020 2020 2020  verage).        
-00009f90: 2020 2020 7d29 0a20 2020 2020 2020 2020      }).         
-00009fa0: 2020 2023 206d 6172 6b65 7420 6f72 6465     # market orde
-00009fb0: 7273 2077 696c 6c20 616c 7761 7973 2069  rs will always i
-00009fc0: 6e63 7572 7220 7461 6b65 7220 6665 6573  ncurr taker fees
-00009fd0: 0a20 2020 2020 2020 2020 2020 2064 7279  .            dry
-00009fe0: 5f6f 7264 6572 203d 2073 656c 662e 6164  _order = self.ad
-00009ff0: 645f 6472 795f 6f72 6465 725f 6665 6528  d_dry_order_fee(
-0000a000: 7061 6972 2c20 6472 795f 6f72 6465 722c  pair, dry_order,
-0000a010: 2027 7461 6b65 7227 290a 0a20 2020 2020   'taker')..     
-0000a020: 2020 2064 7279 5f6f 7264 6572 203d 2073     dry_order = s
-0000a030: 656c 662e 6368 6563 6b5f 6472 795f 6c69  elf.check_dry_li
-0000a040: 6d69 745f 6f72 6465 725f 6669 6c6c 6564  mit_order_filled
-0000a050: 280a 2020 2020 2020 2020 2020 2020 6472  (.            dr
-0000a060: 795f 6f72 6465 722c 2069 6d6d 6564 6961  y_order, immedia
-0000a070: 7465 3d54 7275 652c 206f 7264 6572 626f  te=True, orderbo
-0000a080: 6f6b 3d6f 7264 6572 626f 6f6b 290a 0a20  ok=orderbook).. 
-0000a090: 2020 2020 2020 2073 656c 662e 5f64 7279         self._dry
-0000a0a0: 5f72 756e 5f6f 7065 6e5f 6f72 6465 7273  _run_open_orders
-0000a0b0: 5b64 7279 5f6f 7264 6572 5b22 6964 225d  [dry_order["id"]
-0000a0c0: 5d20 3d20 6472 795f 6f72 6465 720a 2020  ] = dry_order.  
-0000a0d0: 2020 2020 2020 2320 436f 7079 206f 7264        # Copy ord
-0000a0e0: 6572 2061 6e64 2063 6c6f 7365 2069 7420  er and close it 
-0000a0f0: 2d20 736f 2074 6865 2072 6574 7572 6e65  - so the returne
-0000a100: 6420 6f72 6465 7220 6973 206f 7065 6e20  d order is open 
-0000a110: 756e 6c65 7373 2069 7427 7320 6120 6d61  unless it's a ma
-0000a120: 726b 6574 206f 7264 6572 0a20 2020 2020  rket order.     
-0000a130: 2020 2072 6574 7572 6e20 6472 795f 6f72     return dry_or
-0000a140: 6465 720a 0a20 2020 2064 6566 2061 6464  der..    def add
-0000a150: 5f64 7279 5f6f 7264 6572 5f66 6565 280a  _dry_order_fee(.
-0000a160: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000a170: 2020 2020 2020 7061 6972 3a20 7374 722c        pair: str,
-0000a180: 0a20 2020 2020 2020 2064 7279 5f6f 7264  .        dry_ord
-0000a190: 6572 3a20 4469 6374 5b73 7472 2c20 416e  er: Dict[str, An
-0000a1a0: 795d 2c0a 2020 2020 2020 2020 7461 6b65  y],.        take
-0000a1b0: 725f 6f72 5f6d 616b 6572 3a20 4d61 6b65  r_or_maker: Make
-0000a1c0: 7254 616b 6572 2c0a 2020 2020 2920 2d3e  rTaker,.    ) ->
-0000a1d0: 2044 6963 745b 7374 722c 2041 6e79 5d3a   Dict[str, Any]:
-0000a1e0: 0a20 2020 2020 2020 2066 6565 203d 2073  .        fee = s
-0000a1f0: 656c 662e 6765 745f 6665 6528 7061 6972  elf.get_fee(pair
-0000a200: 2c20 7461 6b65 725f 6f72 5f6d 616b 6572  , taker_or_maker
-0000a210: 3d74 616b 6572 5f6f 725f 6d61 6b65 7229  =taker_or_maker)
-0000a220: 0a20 2020 2020 2020 2064 7279 5f6f 7264  .        dry_ord
-0000a230: 6572 2e75 7064 6174 6528 7b0a 2020 2020  er.update({.    
-0000a240: 2020 2020 2020 2020 2766 6565 273a 207b          'fee': {
-0000a250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a260: 2027 6375 7272 656e 6379 273a 2073 656c   'currency': sel
-0000a270: 662e 6765 745f 7061 6972 5f71 756f 7465  f.get_pair_quote
-0000a280: 5f63 7572 7265 6e63 7928 7061 6972 292c  _currency(pair),
-0000a290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a2a0: 2027 636f 7374 273a 2064 7279 5f6f 7264   'cost': dry_ord
-0000a2b0: 6572 5b27 636f 7374 275d 202a 2066 6565  er['cost'] * fee
-0000a2c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000a2d0: 2020 2772 6174 6527 3a20 6665 650a 2020    'rate': fee.  
-0000a2e0: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-0000a2f0: 2020 2020 7d29 0a20 2020 2020 2020 2072      }).        r
-0000a300: 6574 7572 6e20 6472 795f 6f72 6465 720a  eturn dry_order.
-0000a310: 0a20 2020 2064 6566 2067 6574 5f64 7279  .    def get_dry
-0000a320: 5f6d 6172 6b65 745f 6669 6c6c 5f70 7269  _market_fill_pri
-0000a330: 6365 2873 656c 662c 2070 6169 723a 2073  ce(self, pair: s
-0000a340: 7472 2c20 7369 6465 3a20 7374 722c 2061  tr, side: str, a
-0000a350: 6d6f 756e 743a 2066 6c6f 6174 2c20 7261  mount: float, ra
-0000a360: 7465 3a20 666c 6f61 742c 0a20 2020 2020  te: float,.     
-0000a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a380: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-0000a390: 6572 626f 6f6b 3a20 4f70 7469 6f6e 616c  erbook: Optional
-0000a3a0: 5b4f 7264 6572 426f 6f6b 5d29 202d 3e20  [OrderBook]) -> 
-0000a3b0: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
-0000a3c0: 2222 0a20 2020 2020 2020 2047 6574 2074  "".        Get t
-0000a3d0: 6865 206d 6172 6b65 7420 6f72 6465 7220  he market order 
-0000a3e0: 6669 6c6c 2070 7269 6365 2062 6173 6564  fill price based
-0000a3f0: 206f 6e20 6f72 6465 7262 6f6f 6b20 696e   on orderbook in
-0000a400: 7465 7270 6f6c 6174 696f 6e0a 2020 2020  terpolation.    
-0000a410: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000a420: 6966 2073 656c 662e 6578 6368 616e 6765  if self.exchange
-0000a430: 5f68 6173 2827 6665 7463 684c 324f 7264  _has('fetchL2Ord
-0000a440: 6572 426f 6f6b 2729 3a0a 2020 2020 2020  erBook'):.      
-0000a450: 2020 2020 2020 6966 206e 6f74 206f 7264        if not ord
-0000a460: 6572 626f 6f6b 3a0a 2020 2020 2020 2020  erbook:.        
-0000a470: 2020 2020 2020 2020 6f72 6465 7262 6f6f          orderboo
-0000a480: 6b20 3d20 7365 6c66 2e66 6574 6368 5f6c  k = self.fetch_l
-0000a490: 325f 6f72 6465 725f 626f 6f6b 2870 6169  2_order_book(pai
-0000a4a0: 722c 2032 3029 0a20 2020 2020 2020 2020  r, 20).         
-0000a4b0: 2020 206f 625f 7479 7065 3a20 4f42 4c69     ob_type: OBLi
-0000a4c0: 7465 7261 6c20 3d20 2761 736b 7327 2069  teral = 'asks' i
-0000a4d0: 6620 7369 6465 203d 3d20 2762 7579 2720  f side == 'buy' 
-0000a4e0: 656c 7365 2027 6269 6473 270a 2020 2020  else 'bids'.    
-0000a4f0: 2020 2020 2020 2020 736c 6970 7061 6765          slippage
-0000a500: 203d 2030 2e30 350a 2020 2020 2020 2020   = 0.05.        
-0000a510: 2020 2020 6d61 785f 736c 6970 7061 6765      max_slippage
-0000a520: 5f76 616c 203d 2072 6174 6520 2a20 2828  _val = rate * ((
-0000a530: 3120 2b20 736c 6970 7061 6765 2920 6966  1 + slippage) if
-0000a540: 2073 6964 6520 3d3d 2027 6275 7927 2065   side == 'buy' e
-0000a550: 6c73 6520 2831 202d 2073 6c69 7070 6167  lse (1 - slippag
-0000a560: 6529 290a 0a20 2020 2020 2020 2020 2020  e))..           
-0000a570: 2072 656d 6169 6e69 6e67 5f61 6d6f 756e   remaining_amoun
-0000a580: 7420 3d20 616d 6f75 6e74 0a20 2020 2020  t = amount.     
-0000a590: 2020 2020 2020 2066 696c 6c65 645f 7661         filled_va
-0000a5a0: 6c75 6520 3d20 302e 300a 2020 2020 2020  lue = 0.0.      
-0000a5b0: 2020 2020 2020 626f 6f6b 5f65 6e74 7279        book_entry
-0000a5c0: 5f70 7269 6365 203d 2030 2e30 0a20 2020  _price = 0.0.   
-0000a5d0: 2020 2020 2020 2020 2066 6f72 2062 6f6f           for boo
-0000a5e0: 6b5f 656e 7472 7920 696e 206f 7264 6572  k_entry in order
-0000a5f0: 626f 6f6b 5b6f 625f 7479 7065 5d3a 0a20  book[ob_type]:. 
-0000a600: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000a610: 6f6f 6b5f 656e 7472 795f 7072 6963 6520  ook_entry_price 
-0000a620: 3d20 626f 6f6b 5f65 6e74 7279 5b30 5d0a  = book_entry[0].
-0000a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a640: 626f 6f6b 5f65 6e74 7279 5f63 6f69 6e5f  book_entry_coin_
-0000a650: 766f 6c75 6d65 203d 2062 6f6f 6b5f 656e  volume = book_en
-0000a660: 7472 795b 315d 0a20 2020 2020 2020 2020  try[1].         
-0000a670: 2020 2020 2020 2069 6620 7265 6d61 696e         if remain
-0000a680: 696e 675f 616d 6f75 6e74 203e 2030 3a0a  ing_amount > 0:.
-0000a690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a6a0: 2020 2020 6966 2072 656d 6169 6e69 6e67      if remaining
-0000a6b0: 5f61 6d6f 756e 7420 3c20 626f 6f6b 5f65  _amount < book_e
-0000a6c0: 6e74 7279 5f63 6f69 6e5f 766f 6c75 6d65  ntry_coin_volume
-0000a6d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a6e0: 2020 2020 2020 2020 2020 2320 4f72 6465            # Orde
-0000a6f0: 7262 6f6f 6b20 6174 2074 6869 7320 736c  rbook at this sl
-0000a700: 6f74 2062 6967 6765 7220 7468 616e 2072  ot bigger than r
-0000a710: 656d 6169 6e69 6e67 2061 6d6f 756e 740a  emaining amount.
-0000a720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a730: 2020 2020 2020 2020 6669 6c6c 6564 5f76          filled_v
-0000a740: 616c 7565 202b 3d20 7265 6d61 696e 696e  alue += remainin
-0000a750: 675f 616d 6f75 6e74 202a 2062 6f6f 6b5f  g_amount * book_
-0000a760: 656e 7472 795f 7072 6963 650a 2020 2020  entry_price.    
-0000a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a780: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0000a790: 2020 2020 2020 2020 2020 2020 2020 656c                el
-0000a7a0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000a7b0: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
-0000a7c0: 6564 5f76 616c 7565 202b 3d20 626f 6f6b  ed_value += book
-0000a7d0: 5f65 6e74 7279 5f63 6f69 6e5f 766f 6c75  _entry_coin_volu
-0000a7e0: 6d65 202a 2062 6f6f 6b5f 656e 7472 795f  me * book_entry_
-0000a7f0: 7072 6963 650a 2020 2020 2020 2020 2020  price.          
-0000a800: 2020 2020 2020 2020 2020 7265 6d61 696e            remain
-0000a810: 696e 675f 616d 6f75 6e74 202d 3d20 626f  ing_amount -= bo
-0000a820: 6f6b 5f65 6e74 7279 5f63 6f69 6e5f 766f  ok_entry_coin_vo
-0000a830: 6c75 6d65 0a20 2020 2020 2020 2020 2020  lume.           
-0000a840: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000a850: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000a860: 7265 616b 0a20 2020 2020 2020 2020 2020  reak.           
-0000a870: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a880: 2020 2020 2020 2023 2049 6620 7265 6d61         # If rema
-0000a890: 696e 696e 675f 616d 6f75 6e74 2077 6173  ining_amount was
-0000a8a0: 6e27 7420 636f 6e73 756d 6564 2063 6f6d  n't consumed com
-0000a8b0: 706c 6574 656c 7920 2862 7265 616b 2077  pletely (break w
-0000a8c0: 6173 206e 6f74 2063 616c 6c65 6429 0a20  as not called). 
-0000a8d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000a8e0: 696c 6c65 645f 7661 6c75 6520 2b3d 2072  illed_value += r
-0000a8f0: 656d 6169 6e69 6e67 5f61 6d6f 756e 7420  emaining_amount 
-0000a900: 2a20 626f 6f6b 5f65 6e74 7279 5f70 7269  * book_entry_pri
-0000a910: 6365 0a20 2020 2020 2020 2020 2020 2066  ce.            f
-0000a920: 6f72 6563 6173 745f 6176 675f 6669 6c6c  orecast_avg_fill
-0000a930: 6564 5f70 7269 6365 203d 206d 6178 2866  ed_price = max(f
-0000a940: 696c 6c65 645f 7661 6c75 652c 2030 2920  illed_value, 0) 
-0000a950: 2f20 616d 6f75 6e74 0a20 2020 2020 2020  / amount.       
-0000a960: 2020 2020 2023 204c 696d 6974 206d 6178       # Limit max
-0000a970: 2e20 736c 6970 7061 6765 2074 6f20 7370  . slippage to sp
-0000a980: 6563 6966 6965 6420 7661 6c75 650a 2020  ecified value.  
-0000a990: 2020 2020 2020 2020 2020 6966 2073 6964            if sid
-0000a9a0: 6520 3d3d 2027 6275 7927 3a0a 2020 2020  e == 'buy':.    
-0000a9b0: 2020 2020 2020 2020 2020 2020 666f 7265              fore
-0000a9c0: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
-0000a9d0: 7072 6963 6520 3d20 6d69 6e28 666f 7265  price = min(fore
-0000a9e0: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
-0000a9f0: 7072 6963 652c 206d 6178 5f73 6c69 7070  price, max_slipp
-0000aa00: 6167 655f 7661 6c29 0a0a 2020 2020 2020  age_val)..      
-0000aa10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000aa20: 2020 2020 2020 2020 2020 2020 666f 7265              fore
-0000aa30: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
-0000aa40: 7072 6963 6520 3d20 6d61 7828 666f 7265  price = max(fore
-0000aa50: 6361 7374 5f61 7667 5f66 696c 6c65 645f  cast_avg_filled_
-0000aa60: 7072 6963 652c 206d 6178 5f73 6c69 7070  price, max_slipp
-0000aa70: 6167 655f 7661 6c29 0a0a 2020 2020 2020  age_val)..      
-0000aa80: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000aa90: 662e 7072 6963 655f 746f 5f70 7265 6369  f.price_to_preci
-0000aaa0: 7369 6f6e 2870 6169 722c 2066 6f72 6563  sion(pair, forec
-0000aab0: 6173 745f 6176 675f 6669 6c6c 6564 5f70  ast_avg_filled_p
-0000aac0: 7269 6365 290a 0a20 2020 2020 2020 2072  rice)..        r
-0000aad0: 6574 7572 6e20 7261 7465 0a0a 2020 2020  eturn rate..    
-0000aae0: 6465 6620 5f64 7279 5f69 735f 7072 6963  def _dry_is_pric
-0000aaf0: 655f 6372 6f73 7365 6428 7365 6c66 2c20  e_crossed(self, 
-0000ab00: 7061 6972 3a20 7374 722c 2073 6964 653a  pair: str, side:
-0000ab10: 2073 7472 2c20 6c69 6d69 743a 2066 6c6f   str, limit: flo
-0000ab20: 6174 2c0a 2020 2020 2020 2020 2020 2020  at,.            
-0000ab30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ab40: 2020 6f72 6465 7262 6f6f 6b3a 204f 7074    orderbook: Opt
-0000ab50: 696f 6e61 6c5b 4f72 6465 7242 6f6f 6b5d  ional[OrderBook]
-0000ab60: 203d 204e 6f6e 652c 206f 6666 7365 743a   = None, offset:
-0000ab70: 2066 6c6f 6174 203d 2030 2e30 2920 2d3e   float = 0.0) ->
-0000ab80: 2062 6f6f 6c3a 0a20 2020 2020 2020 2069   bool:.        i
-0000ab90: 6620 6e6f 7420 7365 6c66 2e65 7863 6861  f not self.excha
-0000aba0: 6e67 655f 6861 7328 2766 6574 6368 4c32  nge_has('fetchL2
-0000abb0: 4f72 6465 7242 6f6f 6b27 293a 0a20 2020  OrderBook'):.   
-0000abc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000abd0: 5472 7565 0a20 2020 2020 2020 2069 6620  True.        if 
-0000abe0: 6e6f 7420 6f72 6465 7262 6f6f 6b3a 0a20  not orderbook:. 
-0000abf0: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000ac00: 626f 6f6b 203d 2073 656c 662e 6665 7463  book = self.fetc
-0000ac10: 685f 6c32 5f6f 7264 6572 5f62 6f6f 6b28  h_l2_order_book(
-0000ac20: 7061 6972 2c20 3129 0a20 2020 2020 2020  pair, 1).       
-0000ac30: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000ac40: 2020 6966 2073 6964 6520 3d3d 2027 6275    if side == 'bu
-0000ac50: 7927 3a0a 2020 2020 2020 2020 2020 2020  y':.            
-0000ac60: 2020 2020 7072 6963 6520 3d20 6f72 6465      price = orde
-0000ac70: 7262 6f6f 6b5b 2761 736b 7327 5d5b 305d  rbook['asks'][0]
-0000ac80: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
-0000ac90: 2020 2020 6966 206c 696d 6974 202a 2028      if limit * (
-0000aca0: 3120 2d20 6f66 6673 6574 2920 3e3d 2070  1 - offset) >= p
-0000acb0: 7269 6365 3a0a 2020 2020 2020 2020 2020  rice:.          
-0000acc0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000acd0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0000ace0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000acf0: 2020 2020 2020 2020 7072 6963 6520 3d20          price = 
-0000ad00: 6f72 6465 7262 6f6f 6b5b 2762 6964 7327  orderbook['bids'
-0000ad10: 5d5b 305d 5b30 5d0a 2020 2020 2020 2020  ][0][0].        
-0000ad20: 2020 2020 2020 2020 6966 206c 696d 6974          if limit
-0000ad30: 202a 2028 3120 2b20 6f66 6673 6574 2920   * (1 + offset) 
-0000ad40: 3c3d 2070 7269 6365 3a0a 2020 2020 2020  <= price:.      
-0000ad50: 2020 2020 2020 2020 2020 2020 2020 7265                re
-0000ad60: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0000ad70: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
-0000ad80: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0000ad90: 2023 2049 676e 6f72 6520 656d 7074 7920   # Ignore empty 
-0000ada0: 6f72 6465 7262 6f6f 6b73 2077 6865 6e20  orderbooks when 
-0000adb0: 6669 6c6c 696e 6720 2d20 6361 6e20 6265  filling - can be
-0000adc0: 2066 696c 6c65 6420 7769 7468 2074 6865   filled with the
-0000add0: 206e 6578 7420 6974 6572 6174 696f 6e2e   next iteration.
-0000ade0: 0a20 2020 2020 2020 2020 2020 2070 6173  .            pas
-0000adf0: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
-0000ae00: 2046 616c 7365 0a0a 2020 2020 6465 6620   False..    def 
-0000ae10: 6368 6563 6b5f 6472 795f 6c69 6d69 745f  check_dry_limit_
-0000ae20: 6f72 6465 725f 6669 6c6c 6564 280a 2020  order_filled(.  
-0000ae30: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
-0000ae40: 6f72 6465 723a 2044 6963 745b 7374 722c  order: Dict[str,
-0000ae50: 2041 6e79 5d2c 2069 6d6d 6564 6961 7465   Any], immediate
-0000ae60: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-0000ae70: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000ae80: 7262 6f6f 6b3a 204f 7074 696f 6e61 6c5b  rbook: Optional[
-0000ae90: 4f72 6465 7242 6f6f 6b5d 203d 204e 6f6e  OrderBook] = Non
-0000aea0: 6529 202d 3e20 4469 6374 5b73 7472 2c20  e) -> Dict[str, 
-0000aeb0: 416e 795d 3a0a 2020 2020 2020 2020 2222  Any]:.        ""
-0000aec0: 220a 2020 2020 2020 2020 4368 6563 6b20  ".        Check 
-0000aed0: 6472 792d 7275 6e20 6c69 6d69 7420 6f72  dry-run limit or
-0000aee0: 6465 7220 6669 6c6c 2061 6e64 2075 7064  der fill and upd
-0000aef0: 6174 6520 6665 6520 2869 6620 6974 2066  ate fee (if it f
-0000af00: 696c 6c65 6429 2e0a 2020 2020 2020 2020  illed)..        
-0000af10: 2222 220a 2020 2020 2020 2020 6966 2028  """.        if (
-0000af20: 6f72 6465 725b 2773 7461 7475 7327 5d20  order['status'] 
-0000af30: 213d 2022 636c 6f73 6564 220a 2020 2020  != "closed".    
-0000af40: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000af50: 6f72 6465 725b 2774 7970 6527 5d20 696e  order['type'] in
-0000af60: 205b 226c 696d 6974 225d 0a20 2020 2020   ["limit"].     
-0000af70: 2020 2020 2020 2020 2020 2061 6e64 206e             and n
-0000af80: 6f74 206f 7264 6572 2e67 6574 2827 6674  ot order.get('ft
-0000af90: 5f6f 7264 6572 5f74 7970 6527 2929 3a0a  _order_type')):.
-0000afa0: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-0000afb0: 203d 206f 7264 6572 5b27 7379 6d62 6f6c   = order['symbol
-0000afc0: 275d 0a20 2020 2020 2020 2020 2020 2069  '].            i
-0000afd0: 6620 7365 6c66 2e5f 6472 795f 6973 5f70  f self._dry_is_p
-0000afe0: 7269 6365 5f63 726f 7373 6564 2870 6169  rice_crossed(pai
-0000aff0: 722c 206f 7264 6572 5b27 7369 6465 275d  r, order['side']
-0000b000: 2c20 6f72 6465 725b 2770 7269 6365 275d  , order['price']
-0000b010: 2c20 6f72 6465 7262 6f6f 6b29 3a0a 2020  , orderbook):.  
-0000b020: 2020 2020 2020 2020 2020 2020 2020 6f72                or
-0000b030: 6465 722e 7570 6461 7465 287b 0a20 2020  der.update({.   
-0000b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b050: 2027 7374 6174 7573 273a 2027 636c 6f73   'status': 'clos
-0000b060: 6564 272c 0a20 2020 2020 2020 2020 2020  ed',.           
-0000b070: 2020 2020 2020 2020 2027 6669 6c6c 6564           'filled
-0000b080: 273a 206f 7264 6572 5b27 616d 6f75 6e74  ': order['amount
-0000b090: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-0000b0a0: 2020 2020 2020 2020 2772 656d 6169 6e69          'remaini
-0000b0b0: 6e67 273a 2030 2c0a 2020 2020 2020 2020  ng': 0,.        
-0000b0c0: 2020 2020 2020 2020 7d29 0a0a 2020 2020          })..    
-0000b0d0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b0e0: 2e61 6464 5f64 7279 5f6f 7264 6572 5f66  .add_dry_order_f
-0000b0f0: 6565 280a 2020 2020 2020 2020 2020 2020  ee(.            
-0000b100: 2020 2020 2020 2020 7061 6972 2c0a 2020          pair,.  
-0000b110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b120: 2020 6f72 6465 722c 0a20 2020 2020 2020    order,.       
-0000b130: 2020 2020 2020 2020 2020 2020 2027 7461               'ta
-0000b140: 6b65 7227 2069 6620 696d 6d65 6469 6174  ker' if immediat
-0000b150: 6520 656c 7365 2027 6d61 6b65 7227 2c0a  e else 'maker',.
+00008f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f90: 2020 2020 2020 2020 2020 4445 4641 554c            DEFAUL
+00008fa0: 545f 414d 4f55 4e54 5f52 4553 4552 5645  T_AMOUNT_RESERVE
+00008fb0: 5f50 4552 4345 4e54 290a 2020 2020 2020  _PERCENT).      
+00008fc0: 2020 2020 2020 7374 6f70 6c6f 7373 5f72        stoploss_r
+00008fd0: 6573 6572 7665 203d 2028 0a20 2020 2020  eserve = (.     
+00008fe0: 2020 2020 2020 2020 2020 206d 6172 6769             margi
+00008ff0: 6e5f 7265 7365 7276 6520 2f20 2831 202d  n_reserve / (1 -
+00009000: 2061 6273 2873 746f 706c 6f73 7329 2920   abs(stoploss)) 
+00009010: 6966 2061 6273 2873 746f 706c 6f73 7329  if abs(stoploss)
+00009020: 2021 3d20 3120 656c 7365 2031 2e35 0a20   != 1 else 1.5. 
+00009030: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00009040: 2020 2020 2020 2020 2023 2069 7420 7368           # it sh
+00009050: 6f75 6c64 206e 6f74 2062 6520 6d6f 7265  ould not be more
+00009060: 2074 6861 6e20 3530 250a 2020 2020 2020   than 50%.      
+00009070: 2020 2020 2020 7374 6f70 6c6f 7373 5f72        stoploss_r
+00009080: 6573 6572 7665 203d 206d 6178 286d 696e  eserve = max(min
+00009090: 2873 746f 706c 6f73 735f 7265 7365 7276  (stoploss_reserv
+000090a0: 652c 2031 2e35 292c 2031 290a 2020 2020  e, 1.5), 1).    
+000090b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000090c0: 2020 2020 2020 6d61 7267 696e 5f72 6573        margin_res
+000090d0: 6572 7665 203d 2031 2e30 0a20 2020 2020  erve = 1.0.     
+000090e0: 2020 2020 2020 2073 746f 706c 6f73 735f         stoploss_
+000090f0: 7265 7365 7276 6520 3d20 312e 300a 0a20  reserve = 1.0.. 
+00009100: 2020 2020 2020 2073 7461 6b65 5f6c 696d         stake_lim
+00009110: 6974 7320 3d20 5b5d 0a20 2020 2020 2020  its = [].       
+00009120: 206c 696d 6974 7320 3d20 6d61 726b 6574   limits = market
+00009130: 5b27 6c69 6d69 7473 275d 0a20 2020 2020  ['limits'].     
+00009140: 2020 2069 6620 286c 696d 6974 735b 2763     if (limits['c
+00009150: 6f73 7427 5d5b 6c69 6d69 745d 2069 7320  ost'][limit] is 
+00009160: 6e6f 7420 4e6f 6e65 293a 0a20 2020 2020  not None):.     
+00009170: 2020 2020 2020 2073 7461 6b65 5f6c 696d         stake_lim
+00009180: 6974 732e 6170 7065 6e64 280a 2020 2020  its.append(.    
+00009190: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000091a0: 2e5f 636f 6e74 7261 6374 735f 746f 5f61  ._contracts_to_a
+000091b0: 6d6f 756e 7428 7061 6972 2c20 6c69 6d69  mount(pair, limi
+000091c0: 7473 5b27 636f 7374 275d 5b6c 696d 6974  ts['cost'][limit
+000091d0: 5d29 202a 2073 746f 706c 6f73 735f 7265  ]) * stoploss_re
+000091e0: 7365 7276 650a 2020 2020 2020 2020 2020  serve.          
+000091f0: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+00009200: 286c 696d 6974 735b 2761 6d6f 756e 7427  (limits['amount'
+00009210: 5d5b 6c69 6d69 745d 2069 7320 6e6f 7420  ][limit] is not 
+00009220: 4e6f 6e65 293a 0a20 2020 2020 2020 2020  None):.         
+00009230: 2020 2073 7461 6b65 5f6c 696d 6974 732e     stake_limits.
+00009240: 6170 7065 6e64 280a 2020 2020 2020 2020  append(.        
+00009250: 2020 2020 2020 2020 7365 6c66 2e5f 636f          self._co
+00009260: 6e74 7261 6374 735f 746f 5f61 6d6f 756e  ntracts_to_amoun
+00009270: 7428 7061 6972 2c20 6c69 6d69 7473 5b27  t(pair, limits['
+00009280: 616d 6f75 6e74 275d 5b6c 696d 6974 5d29  amount'][limit])
+00009290: 202a 2070 7269 6365 202a 206d 6172 6769   * price * margi
+000092a0: 6e5f 7265 7365 7276 650a 2020 2020 2020  n_reserve.      
+000092b0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+000092c0: 2069 6620 6e6f 7420 7374 616b 655f 6c69   if not stake_li
+000092d0: 6d69 7473 3a0a 2020 2020 2020 2020 2020  mits:.          
+000092e0: 2020 7265 7475 726e 204e 6f6e 6520 6966    return None if
+000092f0: 2069 734d 696e 2065 6c73 6520 666c 6f61   isMin else floa
+00009300: 7428 2769 6e66 2729 0a0a 2020 2020 2020  t('inf')..      
+00009310: 2020 2320 5468 6520 7661 6c75 6520 7265    # The value re
+00009320: 7475 726e 6564 2073 686f 756c 6420 7361  turned should sa
+00009330: 7469 7366 7920 626f 7468 206c 696d 6974  tisfy both limit
+00009340: 733a 2066 6f72 2061 6d6f 756e 7420 2862  s: for amount (b
+00009350: 6173 6520 6375 7272 656e 6379 2920 616e  ase currency) an
+00009360: 640a 2020 2020 2020 2020 2320 666f 7220  d.        # for 
+00009370: 636f 7374 2028 7175 6f74 652c 2073 7461  cost (quote, sta
+00009380: 6b65 2063 7572 7265 6e63 7929 2c20 736f  ke currency), so
+00009390: 206d 6178 2829 2069 7320 7573 6564 2068   max() is used h
+000093a0: 6572 652e 0a20 2020 2020 2020 2023 2053  ere..        # S
+000093b0: 6565 2061 6c73 6f20 2332 3537 3520 6174  ee also #2575 at
+000093c0: 2067 6974 6875 622e 0a20 2020 2020 2020   github..       
+000093d0: 2072 6574 7572 6e20 7365 6c66 2e5f 6765   return self._ge
+000093e0: 745f 7374 616b 655f 616d 6f75 6e74 5f63  t_stake_amount_c
+000093f0: 6f6e 7369 6465 7269 6e67 5f6c 6576 6572  onsidering_lever
+00009400: 6167 6528 0a20 2020 2020 2020 2020 2020  age(.           
+00009410: 206d 6178 2873 7461 6b65 5f6c 696d 6974   max(stake_limit
+00009420: 7329 2069 6620 6973 4d69 6e20 656c 7365  s) if isMin else
+00009430: 206d 696e 2873 7461 6b65 5f6c 696d 6974   min(stake_limit
+00009440: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
+00009450: 6c65 7665 7261 6765 206f 7220 312e 300a  leverage or 1.0.
+00009460: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00009470: 6566 205f 6765 745f 7374 616b 655f 616d  ef _get_stake_am
+00009480: 6f75 6e74 5f63 6f6e 7369 6465 7269 6e67  ount_considering
+00009490: 5f6c 6576 6572 6167 6528 7365 6c66 2c20  _leverage(self, 
+000094a0: 7374 616b 655f 616d 6f75 6e74 3a20 666c  stake_amount: fl
+000094b0: 6f61 742c 206c 6576 6572 6167 653a 2066  oat, leverage: f
+000094c0: 6c6f 6174 2920 2d3e 2066 6c6f 6174 3a0a  loat) -> float:.
+000094d0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000094e0: 2020 2020 5461 6b65 7320 7468 6520 6d69      Takes the mi
+000094f0: 6e69 6d75 6d20 7374 616b 6520 616d 6f75  nimum stake amou
+00009500: 6e74 2066 6f72 2061 2070 6169 7220 7769  nt for a pair wi
+00009510: 7468 206e 6f20 6c65 7665 7261 6765 2061  th no leverage a
+00009520: 6e64 2072 6574 7572 6e73 2074 6865 206d  nd returns the m
+00009530: 696e 696d 756d 0a20 2020 2020 2020 2073  inimum.        s
+00009540: 7461 6b65 2061 6d6f 756e 7420 7768 656e  take amount when
+00009550: 206c 6576 6572 6167 6520 6973 2063 6f6e   leverage is con
+00009560: 7369 6465 7265 640a 2020 2020 2020 2020  sidered.        
+00009570: 3a70 6172 616d 2073 7461 6b65 5f61 6d6f  :param stake_amo
+00009580: 756e 743a 2054 6865 2073 7461 6b65 2061  unt: The stake a
+00009590: 6d6f 756e 7420 666f 7220 6120 7061 6972  mount for a pair
+000095a0: 2062 6566 6f72 6520 6c65 7665 7261 6765   before leverage
+000095b0: 2069 7320 636f 6e73 6964 6572 6564 0a20   is considered. 
+000095c0: 2020 2020 2020 203a 7061 7261 6d20 6c65         :param le
+000095d0: 7665 7261 6765 3a20 5468 6520 616d 6f75  verage: The amou
+000095e0: 6e74 206f 6620 6c65 7665 7261 6765 2062  nt of leverage b
+000095f0: 6569 6e67 2075 7365 6420 6f6e 2074 6865  eing used on the
+00009600: 2063 7572 7265 6e74 2074 7261 6465 0a20   current trade. 
+00009610: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00009620: 2020 2072 6574 7572 6e20 7374 616b 655f     return stake_
+00009630: 616d 6f75 6e74 202f 206c 6576 6572 6167  amount / leverag
+00009640: 650a 0a20 2020 2023 2044 7279 2d72 756e  e..    # Dry-run
+00009650: 206d 6574 686f 6473 0a0a 2020 2020 6465   methods..    de
+00009660: 6620 6372 6561 7465 5f64 7279 5f72 756e  f create_dry_run
+00009670: 5f6f 7264 6572 2873 656c 662c 2070 6169  _order(self, pai
+00009680: 723a 2073 7472 2c20 6f72 6465 7274 7970  r: str, ordertyp
+00009690: 653a 2073 7472 2c20 7369 6465 3a20 7374  e: str, side: st
+000096a0: 722c 2061 6d6f 756e 743a 2066 6c6f 6174  r, amount: float
+000096b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000096c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000096d0: 6174 653a 2066 6c6f 6174 2c20 6c65 7665  ate: float, leve
+000096e0: 7261 6765 3a20 666c 6f61 742c 2070 6172  rage: float, par
+000096f0: 616d 733a 204f 7074 696f 6e61 6c5b 4469  ams: Optional[Di
+00009700: 6374 5d20 3d20 4e6f 6e65 2c0a 2020 2020  ct] = None,.    
+00009710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009720: 2020 2020 2020 2020 2073 746f 705f 6c6f           stop_lo
+00009730: 7373 3a20 626f 6f6c 203d 2046 616c 7365  ss: bool = False
+00009740: 2920 2d3e 2044 6963 745b 7374 722c 2041  ) -> Dict[str, A
+00009750: 6e79 5d3a 0a20 2020 2020 2020 206e 6f77  ny]:.        now
+00009760: 203d 2064 745f 6e6f 7728 290a 2020 2020   = dt_now().    
+00009770: 2020 2020 6f72 6465 725f 6964 203d 2066      order_id = f
+00009780: 2764 7279 5f72 756e 5f7b 7369 6465 7d5f  'dry_run_{side}_
+00009790: 7b70 6169 727d 5f7b 6e6f 772e 7469 6d65  {pair}_{now.time
+000097a0: 7374 616d 7028 297d 270a 2020 2020 2020  stamp()}'.      
+000097b0: 2020 2320 526f 756e 6469 6e67 2068 6572    # Rounding her
+000097c0: 6520 6d75 7374 2072 6573 7065 6374 2074  e must respect t
+000097d0: 6f20 636f 6e74 7261 6374 2073 697a 6573  o contract sizes
+000097e0: 0a20 2020 2020 2020 205f 616d 6f75 6e74  .        _amount
+000097f0: 203d 2073 656c 662e 5f63 6f6e 7472 6163   = self._contrac
+00009800: 7473 5f74 6f5f 616d 6f75 6e74 280a 2020  ts_to_amount(.  
+00009810: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
+00009820: 7365 6c66 2e61 6d6f 756e 745f 746f 5f70  self.amount_to_p
+00009830: 7265 6369 7369 6f6e 2870 6169 722c 2073  recision(pair, s
+00009840: 656c 662e 5f61 6d6f 756e 745f 746f 5f63  elf._amount_to_c
+00009850: 6f6e 7472 6163 7473 2870 6169 722c 2061  ontracts(pair, a
+00009860: 6d6f 756e 7429 2929 0a20 2020 2020 2020  mount))).       
+00009870: 2064 7279 5f6f 7264 6572 3a20 4469 6374   dry_order: Dict
+00009880: 5b73 7472 2c20 416e 795d 203d 207b 0a20  [str, Any] = {. 
+00009890: 2020 2020 2020 2020 2020 2027 6964 273a             'id':
+000098a0: 206f 7264 6572 5f69 642c 0a20 2020 2020   order_id,.     
+000098b0: 2020 2020 2020 2027 7379 6d62 6f6c 273a         'symbol':
+000098c0: 2070 6169 722c 0a20 2020 2020 2020 2020   pair,.         
+000098d0: 2020 2027 7072 6963 6527 3a20 7261 7465     'price': rate
+000098e0: 2c0a 2020 2020 2020 2020 2020 2020 2761  ,.            'a
+000098f0: 7665 7261 6765 273a 2072 6174 652c 0a20  verage': rate,. 
+00009900: 2020 2020 2020 2020 2020 2027 616d 6f75             'amou
+00009910: 6e74 273a 205f 616d 6f75 6e74 2c0a 2020  nt': _amount,.  
+00009920: 2020 2020 2020 2020 2020 2763 6f73 7427            'cost'
+00009930: 3a20 5f61 6d6f 756e 7420 2a20 7261 7465  : _amount * rate
+00009940: 2c0a 2020 2020 2020 2020 2020 2020 2774  ,.            't
+00009950: 7970 6527 3a20 6f72 6465 7274 7970 652c  ype': ordertype,
+00009960: 0a20 2020 2020 2020 2020 2020 2027 7369  .            'si
+00009970: 6465 273a 2073 6964 652c 0a20 2020 2020  de': side,.     
+00009980: 2020 2020 2020 2027 6669 6c6c 6564 273a         'filled':
+00009990: 2030 2c0a 2020 2020 2020 2020 2020 2020   0,.            
+000099a0: 2772 656d 6169 6e69 6e67 273a 205f 616d  'remaining': _am
+000099b0: 6f75 6e74 2c0a 2020 2020 2020 2020 2020  ount,.          
+000099c0: 2020 2764 6174 6574 696d 6527 3a20 6e6f    'datetime': no
+000099d0: 772e 7374 7266 7469 6d65 2827 2559 2d25  w.strftime('%Y-%
+000099e0: 6d2d 2564 5425 483a 254d 3a25 532e 2566  m-%dT%H:%M:%S.%f
+000099f0: 5a27 292c 0a20 2020 2020 2020 2020 2020  Z'),.           
+00009a00: 2027 7469 6d65 7374 616d 7027 3a20 6474   'timestamp': dt
+00009a10: 5f74 7328 6e6f 7729 2c0a 2020 2020 2020  _ts(now),.      
+00009a20: 2020 2020 2020 2773 7461 7475 7327 3a20        'status': 
+00009a30: 226f 7065 6e22 2c0a 2020 2020 2020 2020  "open",.        
+00009a40: 2020 2020 2766 6565 273a 204e 6f6e 652c      'fee': None,
+00009a50: 0a20 2020 2020 2020 2020 2020 2027 696e  .            'in
+00009a60: 666f 273a 207b 7d2c 0a20 2020 2020 2020  fo': {},.       
+00009a70: 2020 2020 2027 6c65 7665 7261 6765 273a       'leverage':
+00009a80: 206c 6576 6572 6167 650a 2020 2020 2020   leverage.      
+00009a90: 2020 7d0a 2020 2020 2020 2020 6966 2073    }.        if s
+00009aa0: 746f 705f 6c6f 7373 3a0a 2020 2020 2020  top_loss:.      
+00009ab0: 2020 2020 2020 6472 795f 6f72 6465 725b        dry_order[
+00009ac0: 2269 6e66 6f22 5d20 3d20 7b22 7374 6f70  "info"] = {"stop
+00009ad0: 5072 6963 6522 3a20 6472 795f 6f72 6465  Price": dry_orde
+00009ae0: 725b 2270 7269 6365 225d 7d0a 2020 2020  r["price"]}.    
+00009af0: 2020 2020 2020 2020 6472 795f 6f72 6465          dry_orde
+00009b00: 725b 7365 6c66 2e5f 6674 5f68 6173 5b27  r[self._ft_has['
+00009b10: 7374 6f70 5f70 7269 6365 5f70 726f 7027  stop_price_prop'
+00009b20: 5d5d 203d 2064 7279 5f6f 7264 6572 5b22  ]] = dry_order["
+00009b30: 7072 6963 6522 5d0a 2020 2020 2020 2020  price"].        
+00009b40: 2020 2020 2320 576f 726b 6172 6f75 6e64      # Workaround
+00009b50: 2074 6f20 6176 6f69 6420 6669 6c6c 696e   to avoid fillin
+00009b60: 6720 7374 6f70 6c6f 7373 206f 7264 6572  g stoploss order
+00009b70: 7320 696d 6d65 6469 6174 656c 790a 2020  s immediately.  
+00009b80: 2020 2020 2020 2020 2020 6472 795f 6f72            dry_or
+00009b90: 6465 725b 2266 745f 6f72 6465 725f 7479  der["ft_order_ty
+00009ba0: 7065 225d 203d 2022 7374 6f70 6c6f 7373  pe"] = "stoploss
+00009bb0: 220a 2020 2020 2020 2020 6f72 6465 7262  ".        orderb
+00009bc0: 6f6f 6b3a 204f 7074 696f 6e61 6c5b 4f72  ook: Optional[Or
+00009bd0: 6465 7242 6f6f 6b5d 203d 204e 6f6e 650a  derBook] = None.
+00009be0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00009bf0: 6578 6368 616e 6765 5f68 6173 2827 6665  exchange_has('fe
+00009c00: 7463 684c 324f 7264 6572 426f 6f6b 2729  tchL2OrderBook')
+00009c10: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
+00009c20: 6465 7262 6f6f 6b20 3d20 7365 6c66 2e66  derbook = self.f
+00009c30: 6574 6368 5f6c 325f 6f72 6465 725f 626f  etch_l2_order_bo
+00009c40: 6f6b 2870 6169 722c 2032 3029 0a20 2020  ok(pair, 20).   
+00009c50: 2020 2020 2069 6620 6f72 6465 7274 7970       if ordertyp
+00009c60: 6520 3d3d 2022 6c69 6d69 7422 2061 6e64  e == "limit" and
+00009c70: 206f 7264 6572 626f 6f6b 3a0a 2020 2020   orderbook:.    
+00009c80: 2020 2020 2020 2020 2320 416c 6c6f 7720          # Allow 
+00009c90: 6120 3125 2070 7269 6365 2064 6966 6665  a 1% price diffe
+00009ca0: 7265 6e63 650a 2020 2020 2020 2020 2020  rence.          
+00009cb0: 2020 616c 6c6f 7765 645f 6469 6666 203d    allowed_diff =
+00009cc0: 2030 2e30 310a 2020 2020 2020 2020 2020   0.01.          
+00009cd0: 2020 6966 2073 656c 662e 5f64 7279 5f69    if self._dry_i
+00009ce0: 735f 7072 6963 655f 6372 6f73 7365 6428  s_price_crossed(
+00009cf0: 7061 6972 2c20 7369 6465 2c20 7261 7465  pair, side, rate
+00009d00: 2c20 6f72 6465 7262 6f6f 6b2c 2061 6c6c  , orderbook, all
+00009d10: 6f77 6564 5f64 6966 6629 3a0a 2020 2020  owed_diff):.    
+00009d20: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+00009d30: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
+00009d40: 2020 2020 2020 2020 2020 2020 2066 2243               f"C
+00009d50: 6f6e 7665 7274 6564 206f 7264 6572 207b  onverted order {
+00009d60: 7061 6972 7d20 746f 206d 6172 6b65 7420  pair} to market 
+00009d70: 6f72 6465 7220 6475 6520 746f 2070 7269  order due to pri
+00009d80: 6365 207b 7261 7465 7d20 6372 6f73 7369  ce {rate} crossi
+00009d90: 6e67 2073 7072 6561 6420 220a 2020 2020  ng spread ".    
+00009da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009db0: 6622 6279 206d 6f72 6520 7468 616e 207b  f"by more than {
+00009dc0: 616c 6c6f 7765 645f 6469 6666 3a2e 3225  allowed_diff:.2%
+00009dd0: 7d2e 2229 0a20 2020 2020 2020 2020 2020  }.").           
+00009de0: 2020 2020 2064 7279 5f6f 7264 6572 5b22       dry_order["
+00009df0: 7479 7065 225d 203d 2022 6d61 726b 6574  type"] = "market
+00009e00: 220a 0a20 2020 2020 2020 2069 6620 6472  "..        if dr
+00009e10: 795f 6f72 6465 725b 2274 7970 6522 5d20  y_order["type"] 
+00009e20: 3d3d 2022 6d61 726b 6574 2220 616e 6420  == "market" and 
+00009e30: 6e6f 7420 6472 795f 6f72 6465 722e 6765  not dry_order.ge
+00009e40: 7428 2266 745f 6f72 6465 725f 7479 7065  t("ft_order_type
+00009e50: 2229 3a0a 2020 2020 2020 2020 2020 2020  "):.            
+00009e60: 2320 5570 6461 7465 206d 6172 6b65 7420  # Update market 
+00009e70: 6f72 6465 7220 7072 6963 696e 670a 2020  order pricing.  
+00009e80: 2020 2020 2020 2020 2020 6176 6572 6167            averag
+00009e90: 6520 3d20 7365 6c66 2e67 6574 5f64 7279  e = self.get_dry
+00009ea0: 5f6d 6172 6b65 745f 6669 6c6c 5f70 7269  _market_fill_pri
+00009eb0: 6365 2870 6169 722c 2073 6964 652c 2061  ce(pair, side, a
+00009ec0: 6d6f 756e 742c 2072 6174 652c 206f 7264  mount, rate, ord
+00009ed0: 6572 626f 6f6b 290a 2020 2020 2020 2020  erbook).        
+00009ee0: 2020 2020 6472 795f 6f72 6465 722e 7570      dry_order.up
+00009ef0: 6461 7465 287b 0a20 2020 2020 2020 2020  date({.         
+00009f00: 2020 2020 2020 2027 6176 6572 6167 6527         'average'
+00009f10: 3a20 6176 6572 6167 652c 0a20 2020 2020  : average,.     
+00009f20: 2020 2020 2020 2020 2020 2027 6669 6c6c             'fill
+00009f30: 6564 273a 205f 616d 6f75 6e74 2c0a 2020  ed': _amount,.  
+00009f40: 2020 2020 2020 2020 2020 2020 2020 2772                'r
+00009f50: 656d 6169 6e69 6e67 273a 2030 2e30 2c0a  emaining': 0.0,.
+00009f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009f70: 2773 7461 7475 7327 3a20 2263 6c6f 7365  'status': "close
+00009f80: 6422 2c0a 2020 2020 2020 2020 2020 2020  d",.            
+00009f90: 2020 2020 2763 6f73 7427 3a20 2864 7279      'cost': (dry
+00009fa0: 5f6f 7264 6572 5b27 616d 6f75 6e74 275d  _order['amount']
+00009fb0: 202a 2061 7665 7261 6765 290a 2020 2020   * average).    
+00009fc0: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
+00009fd0: 2020 2020 2020 2023 206d 6172 6b65 7420         # market 
+00009fe0: 6f72 6465 7273 2077 696c 6c20 616c 7761  orders will alwa
+00009ff0: 7973 2069 6e63 7572 7220 7461 6b65 7220  ys incurr taker 
+0000a000: 6665 6573 0a20 2020 2020 2020 2020 2020  fees.           
+0000a010: 2064 7279 5f6f 7264 6572 203d 2073 656c   dry_order = sel
+0000a020: 662e 6164 645f 6472 795f 6f72 6465 725f  f.add_dry_order_
+0000a030: 6665 6528 7061 6972 2c20 6472 795f 6f72  fee(pair, dry_or
+0000a040: 6465 722c 2027 7461 6b65 7227 290a 0a20  der, 'taker').. 
+0000a050: 2020 2020 2020 2064 7279 5f6f 7264 6572         dry_order
+0000a060: 203d 2073 656c 662e 6368 6563 6b5f 6472   = self.check_dr
+0000a070: 795f 6c69 6d69 745f 6f72 6465 725f 6669  y_limit_order_fi
+0000a080: 6c6c 6564 280a 2020 2020 2020 2020 2020  lled(.          
+0000a090: 2020 6472 795f 6f72 6465 722c 2069 6d6d    dry_order, imm
+0000a0a0: 6564 6961 7465 3d54 7275 652c 206f 7264  ediate=True, ord
+0000a0b0: 6572 626f 6f6b 3d6f 7264 6572 626f 6f6b  erbook=orderbook
+0000a0c0: 290a 0a20 2020 2020 2020 2073 656c 662e  )..        self.
+0000a0d0: 5f64 7279 5f72 756e 5f6f 7065 6e5f 6f72  _dry_run_open_or
+0000a0e0: 6465 7273 5b64 7279 5f6f 7264 6572 5b22  ders[dry_order["
+0000a0f0: 6964 225d 5d20 3d20 6472 795f 6f72 6465  id"]] = dry_orde
+0000a100: 720a 2020 2020 2020 2020 2320 436f 7079  r.        # Copy
+0000a110: 206f 7264 6572 2061 6e64 2063 6c6f 7365   order and close
+0000a120: 2069 7420 2d20 736f 2074 6865 2072 6574   it - so the ret
+0000a130: 7572 6e65 6420 6f72 6465 7220 6973 206f  urned order is o
+0000a140: 7065 6e20 756e 6c65 7373 2069 7427 7320  pen unless it's 
+0000a150: 6120 6d61 726b 6574 206f 7264 6572 0a20  a market order. 
+0000a160: 2020 2020 2020 2072 6574 7572 6e20 6472         return dr
+0000a170: 795f 6f72 6465 720a 0a20 2020 2064 6566  y_order..    def
+0000a180: 2061 6464 5f64 7279 5f6f 7264 6572 5f66   add_dry_order_f
+0000a190: 6565 280a 2020 2020 2020 2020 7365 6c66  ee(.        self
+0000a1a0: 2c0a 2020 2020 2020 2020 7061 6972 3a20  ,.        pair: 
+0000a1b0: 7374 722c 0a20 2020 2020 2020 2064 7279  str,.        dry
+0000a1c0: 5f6f 7264 6572 3a20 4469 6374 5b73 7472  _order: Dict[str
+0000a1d0: 2c20 416e 795d 2c0a 2020 2020 2020 2020  , Any],.        
+0000a1e0: 7461 6b65 725f 6f72 5f6d 616b 6572 3a20  taker_or_maker: 
+0000a1f0: 4d61 6b65 7254 616b 6572 2c0a 2020 2020  MakerTaker,.    
+0000a200: 2920 2d3e 2044 6963 745b 7374 722c 2041  ) -> Dict[str, A
+0000a210: 6e79 5d3a 0a20 2020 2020 2020 2066 6565  ny]:.        fee
+0000a220: 203d 2073 656c 662e 6765 745f 6665 6528   = self.get_fee(
+0000a230: 7061 6972 2c20 7461 6b65 725f 6f72 5f6d  pair, taker_or_m
+0000a240: 616b 6572 3d74 616b 6572 5f6f 725f 6d61  aker=taker_or_ma
+0000a250: 6b65 7229 0a20 2020 2020 2020 2064 7279  ker).        dry
+0000a260: 5f6f 7264 6572 2e75 7064 6174 6528 7b0a  _order.update({.
+0000a270: 2020 2020 2020 2020 2020 2020 2766 6565              'fee
+0000a280: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
+0000a290: 2020 2020 2027 6375 7272 656e 6379 273a       'currency':
+0000a2a0: 2073 656c 662e 6765 745f 7061 6972 5f71   self.get_pair_q
+0000a2b0: 756f 7465 5f63 7572 7265 6e63 7928 7061  uote_currency(pa
+0000a2c0: 6972 292c 0a20 2020 2020 2020 2020 2020  ir),.           
+0000a2d0: 2020 2020 2027 636f 7374 273a 2064 7279       'cost': dry
+0000a2e0: 5f6f 7264 6572 5b27 636f 7374 275d 202a  _order['cost'] *
+0000a2f0: 2066 6565 2c0a 2020 2020 2020 2020 2020   fee,.          
+0000a300: 2020 2020 2020 2772 6174 6527 3a20 6665        'rate': fe
+0000a310: 650a 2020 2020 2020 2020 2020 2020 7d0a  e.            }.
+0000a320: 2020 2020 2020 2020 7d29 0a20 2020 2020          }).     
+0000a330: 2020 2072 6574 7572 6e20 6472 795f 6f72     return dry_or
+0000a340: 6465 720a 0a20 2020 2064 6566 2067 6574  der..    def get
+0000a350: 5f64 7279 5f6d 6172 6b65 745f 6669 6c6c  _dry_market_fill
+0000a360: 5f70 7269 6365 2873 656c 662c 2070 6169  _price(self, pai
+0000a370: 723a 2073 7472 2c20 7369 6465 3a20 7374  r: str, side: st
+0000a380: 722c 2061 6d6f 756e 743a 2066 6c6f 6174  r, amount: float
+0000a390: 2c20 7261 7465 3a20 666c 6f61 742c 0a20  , rate: float,. 
+0000a3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a3c0: 206f 7264 6572 626f 6f6b 3a20 4f70 7469   orderbook: Opti
+0000a3d0: 6f6e 616c 5b4f 7264 6572 426f 6f6b 5d29  onal[OrderBook])
+0000a3e0: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
+0000a3f0: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
+0000a400: 6574 2074 6865 206d 6172 6b65 7420 6f72  et the market or
+0000a410: 6465 7220 6669 6c6c 2070 7269 6365 2062  der fill price b
+0000a420: 6173 6564 206f 6e20 6f72 6465 7262 6f6f  ased on orderboo
+0000a430: 6b20 696e 7465 7270 6f6c 6174 696f 6e0a  k interpolation.
+0000a440: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000a450: 2020 2020 6966 2073 656c 662e 6578 6368      if self.exch
+0000a460: 616e 6765 5f68 6173 2827 6665 7463 684c  ange_has('fetchL
+0000a470: 324f 7264 6572 426f 6f6b 2729 3a0a 2020  2OrderBook'):.  
+0000a480: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000a490: 206f 7264 6572 626f 6f6b 3a0a 2020 2020   orderbook:.    
+0000a4a0: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000a4b0: 7262 6f6f 6b20 3d20 7365 6c66 2e66 6574  rbook = self.fet
+0000a4c0: 6368 5f6c 325f 6f72 6465 725f 626f 6f6b  ch_l2_order_book
+0000a4d0: 2870 6169 722c 2032 3029 0a20 2020 2020  (pair, 20).     
+0000a4e0: 2020 2020 2020 206f 625f 7479 7065 3a20         ob_type: 
+0000a4f0: 4f42 4c69 7465 7261 6c20 3d20 2761 736b  OBLiteral = 'ask
+0000a500: 7327 2069 6620 7369 6465 203d 3d20 2762  s' if side == 'b
+0000a510: 7579 2720 656c 7365 2027 6269 6473 270a  uy' else 'bids'.
+0000a520: 2020 2020 2020 2020 2020 2020 736c 6970              slip
+0000a530: 7061 6765 203d 2030 2e30 350a 2020 2020  page = 0.05.    
+0000a540: 2020 2020 2020 2020 6d61 785f 736c 6970          max_slip
+0000a550: 7061 6765 5f76 616c 203d 2072 6174 6520  page_val = rate 
+0000a560: 2a20 2828 3120 2b20 736c 6970 7061 6765  * ((1 + slippage
+0000a570: 2920 6966 2073 6964 6520 3d3d 2027 6275  ) if side == 'bu
+0000a580: 7927 2065 6c73 6520 2831 202d 2073 6c69  y' else (1 - sli
+0000a590: 7070 6167 6529 290a 0a20 2020 2020 2020  ppage))..       
+0000a5a0: 2020 2020 2072 656d 6169 6e69 6e67 5f61       remaining_a
+0000a5b0: 6d6f 756e 7420 3d20 616d 6f75 6e74 0a20  mount = amount. 
+0000a5c0: 2020 2020 2020 2020 2020 2066 696c 6c65             fille
+0000a5d0: 645f 7661 6c75 6520 3d20 302e 300a 2020  d_value = 0.0.  
+0000a5e0: 2020 2020 2020 2020 2020 626f 6f6b 5f65            book_e
+0000a5f0: 6e74 7279 5f70 7269 6365 203d 2030 2e30  ntry_price = 0.0
+0000a600: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000a610: 2062 6f6f 6b5f 656e 7472 7920 696e 206f   book_entry in o
+0000a620: 7264 6572 626f 6f6b 5b6f 625f 7479 7065  rderbook[ob_type
+0000a630: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+0000a640: 2020 2062 6f6f 6b5f 656e 7472 795f 7072     book_entry_pr
+0000a650: 6963 6520 3d20 626f 6f6b 5f65 6e74 7279  ice = book_entry
+0000a660: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0000a670: 2020 2020 626f 6f6b 5f65 6e74 7279 5f63      book_entry_c
+0000a680: 6f69 6e5f 766f 6c75 6d65 203d 2062 6f6f  oin_volume = boo
+0000a690: 6b5f 656e 7472 795b 315d 0a20 2020 2020  k_entry[1].     
+0000a6a0: 2020 2020 2020 2020 2020 2069 6620 7265             if re
+0000a6b0: 6d61 696e 696e 675f 616d 6f75 6e74 203e  maining_amount >
+0000a6c0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000a6d0: 2020 2020 2020 2020 6966 2072 656d 6169          if remai
+0000a6e0: 6e69 6e67 5f61 6d6f 756e 7420 3c20 626f  ning_amount < bo
+0000a6f0: 6f6b 5f65 6e74 7279 5f63 6f69 6e5f 766f  ok_entry_coin_vo
+0000a700: 6c75 6d65 3a0a 2020 2020 2020 2020 2020  lume:.          
+0000a710: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000a720: 4f72 6465 7262 6f6f 6b20 6174 2074 6869  Orderbook at thi
+0000a730: 7320 736c 6f74 2062 6967 6765 7220 7468  s slot bigger th
+0000a740: 616e 2072 656d 6169 6e69 6e67 2061 6d6f  an remaining amo
+0000a750: 756e 740a 2020 2020 2020 2020 2020 2020  unt.            
+0000a760: 2020 2020 2020 2020 2020 2020 6669 6c6c              fill
+0000a770: 6564 5f76 616c 7565 202b 3d20 7265 6d61  ed_value += rema
+0000a780: 696e 696e 675f 616d 6f75 6e74 202a 2062  ining_amount * b
+0000a790: 6f6f 6b5f 656e 7472 795f 7072 6963 650a  ook_entry_price.
+0000a7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7b0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+0000a7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+0000a7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a7f0: 6669 6c6c 6564 5f76 616c 7565 202b 3d20  filled_value += 
+0000a800: 626f 6f6b 5f65 6e74 7279 5f63 6f69 6e5f  book_entry_coin_
+0000a810: 766f 6c75 6d65 202a 2062 6f6f 6b5f 656e  volume * book_en
+0000a820: 7472 795f 7072 6963 650a 2020 2020 2020  try_price.      
+0000a830: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000a840: 6d61 696e 696e 675f 616d 6f75 6e74 202d  maining_amount -
+0000a850: 3d20 626f 6f6b 5f65 6e74 7279 5f63 6f69  = book_entry_coi
+0000a860: 6e5f 766f 6c75 6d65 0a20 2020 2020 2020  n_volume.       
+0000a870: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0000a880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a890: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0000a8a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000a8b0: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
+0000a8c0: 7265 6d61 696e 696e 675f 616d 6f75 6e74  remaining_amount
+0000a8d0: 2077 6173 6e27 7420 636f 6e73 756d 6564   wasn't consumed
+0000a8e0: 2063 6f6d 706c 6574 656c 7920 2862 7265   completely (bre
+0000a8f0: 616b 2077 6173 206e 6f74 2063 616c 6c65  ak was not calle
+0000a900: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+0000a910: 2020 2066 696c 6c65 645f 7661 6c75 6520     filled_value 
+0000a920: 2b3d 2072 656d 6169 6e69 6e67 5f61 6d6f  += remaining_amo
+0000a930: 756e 7420 2a20 626f 6f6b 5f65 6e74 7279  unt * book_entry
+0000a940: 5f70 7269 6365 0a20 2020 2020 2020 2020  _price.         
+0000a950: 2020 2066 6f72 6563 6173 745f 6176 675f     forecast_avg_
+0000a960: 6669 6c6c 6564 5f70 7269 6365 203d 206d  filled_price = m
+0000a970: 6178 2866 696c 6c65 645f 7661 6c75 652c  ax(filled_value,
+0000a980: 2030 2920 2f20 616d 6f75 6e74 0a20 2020   0) / amount.   
+0000a990: 2020 2020 2020 2020 2023 204c 696d 6974           # Limit
+0000a9a0: 206d 6178 2e20 736c 6970 7061 6765 2074   max. slippage t
+0000a9b0: 6f20 7370 6563 6966 6965 6420 7661 6c75  o specified valu
+0000a9c0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+0000a9d0: 2073 6964 6520 3d3d 2027 6275 7927 3a0a   side == 'buy':.
+0000a9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a9f0: 666f 7265 6361 7374 5f61 7667 5f66 696c  forecast_avg_fil
+0000aa00: 6c65 645f 7072 6963 6520 3d20 6d69 6e28  led_price = min(
+0000aa10: 666f 7265 6361 7374 5f61 7667 5f66 696c  forecast_avg_fil
+0000aa20: 6c65 645f 7072 6963 652c 206d 6178 5f73  led_price, max_s
+0000aa30: 6c69 7070 6167 655f 7661 6c29 0a0a 2020  lippage_val)..  
+0000aa40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000aa50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000aa60: 666f 7265 6361 7374 5f61 7667 5f66 696c  forecast_avg_fil
+0000aa70: 6c65 645f 7072 6963 6520 3d20 6d61 7828  led_price = max(
+0000aa80: 666f 7265 6361 7374 5f61 7667 5f66 696c  forecast_avg_fil
+0000aa90: 6c65 645f 7072 6963 652c 206d 6178 5f73  led_price, max_s
+0000aaa0: 6c69 7070 6167 655f 7661 6c29 0a0a 2020  lippage_val)..  
+0000aab0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000aac0: 2073 656c 662e 7072 6963 655f 746f 5f70   self.price_to_p
+0000aad0: 7265 6369 7369 6f6e 2870 6169 722c 2066  recision(pair, f
+0000aae0: 6f72 6563 6173 745f 6176 675f 6669 6c6c  orecast_avg_fill
+0000aaf0: 6564 5f70 7269 6365 290a 0a20 2020 2020  ed_price)..     
+0000ab00: 2020 2072 6574 7572 6e20 7261 7465 0a0a     return rate..
+0000ab10: 2020 2020 6465 6620 5f64 7279 5f69 735f      def _dry_is_
+0000ab20: 7072 6963 655f 6372 6f73 7365 6428 7365  price_crossed(se
+0000ab30: 6c66 2c20 7061 6972 3a20 7374 722c 2073  lf, pair: str, s
+0000ab40: 6964 653a 2073 7472 2c20 6c69 6d69 743a  ide: str, limit:
+0000ab50: 2066 6c6f 6174 2c0a 2020 2020 2020 2020   float,.        
+0000ab60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ab70: 2020 2020 2020 6f72 6465 7262 6f6f 6b3a        orderbook:
+0000ab80: 204f 7074 696f 6e61 6c5b 4f72 6465 7242   Optional[OrderB
+0000ab90: 6f6f 6b5d 203d 204e 6f6e 652c 206f 6666  ook] = None, off
+0000aba0: 7365 743a 2066 6c6f 6174 203d 2030 2e30  set: float = 0.0
+0000abb0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
+0000abc0: 2020 2069 6620 6e6f 7420 7365 6c66 2e65     if not self.e
+0000abd0: 7863 6861 6e67 655f 6861 7328 2766 6574  xchange_has('fet
+0000abe0: 6368 4c32 4f72 6465 7242 6f6f 6b27 293a  chL2OrderBook'):
+0000abf0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000ac00: 7572 6e20 5472 7565 0a20 2020 2020 2020  urn True.       
+0000ac10: 2069 6620 6e6f 7420 6f72 6465 7262 6f6f   if not orderboo
+0000ac20: 6b3a 0a20 2020 2020 2020 2020 2020 206f  k:.            o
+0000ac30: 7264 6572 626f 6f6b 203d 2073 656c 662e  rderbook = self.
+0000ac40: 6665 7463 685f 6c32 5f6f 7264 6572 5f62  fetch_l2_order_b
+0000ac50: 6f6f 6b28 7061 6972 2c20 3129 0a20 2020  ook(pair, 1).   
+0000ac60: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000ac70: 2020 2020 2020 6966 2073 6964 6520 3d3d        if side ==
+0000ac80: 2027 6275 7927 3a0a 2020 2020 2020 2020   'buy':.        
+0000ac90: 2020 2020 2020 2020 7072 6963 6520 3d20          price = 
+0000aca0: 6f72 6465 7262 6f6f 6b5b 2761 736b 7327  orderbook['asks'
+0000acb0: 5d5b 305d 5b30 5d0a 2020 2020 2020 2020  ][0][0].        
+0000acc0: 2020 2020 2020 2020 6966 206c 696d 6974          if limit
+0000acd0: 202a 2028 3120 2d20 6f66 6673 6574 2920   * (1 - offset) 
+0000ace0: 3e3d 2070 7269 6365 3a0a 2020 2020 2020  >= price:.      
+0000acf0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000ad00: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
+0000ad10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000ad20: 2020 2020 2020 2020 2020 2020 7072 6963              pric
+0000ad30: 6520 3d20 6f72 6465 7262 6f6f 6b5b 2762  e = orderbook['b
+0000ad40: 6964 7327 5d5b 305d 5b30 5d0a 2020 2020  ids'][0][0].    
+0000ad50: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000ad60: 696d 6974 202a 2028 3120 2b20 6f66 6673  imit * (1 + offs
+0000ad70: 6574 2920 3c3d 2070 7269 6365 3a0a 2020  et) <= price:.  
+0000ad80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ad90: 2020 7265 7475 726e 2054 7275 650a 2020    return True.  
+0000ada0: 2020 2020 2020 6578 6365 7074 2049 6e64        except Ind
+0000adb0: 6578 4572 726f 723a 0a20 2020 2020 2020  exError:.       
+0000adc0: 2020 2020 2023 2049 676e 6f72 6520 656d       # Ignore em
+0000add0: 7074 7920 6f72 6465 7262 6f6f 6b73 2077  pty orderbooks w
+0000ade0: 6865 6e20 6669 6c6c 696e 6720 2d20 6361  hen filling - ca
+0000adf0: 6e20 6265 2066 696c 6c65 6420 7769 7468  n be filled with
+0000ae00: 2074 6865 206e 6578 7420 6974 6572 6174   the next iterat
+0000ae10: 696f 6e2e 0a20 2020 2020 2020 2020 2020  ion..           
+0000ae20: 2070 6173 730a 2020 2020 2020 2020 7265   pass.        re
+0000ae30: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
+0000ae40: 6465 6620 6368 6563 6b5f 6472 795f 6c69  def check_dry_li
+0000ae50: 6d69 745f 6f72 6465 725f 6669 6c6c 6564  mit_order_filled
+0000ae60: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000ae70: 6c66 2c20 6f72 6465 723a 2044 6963 745b  lf, order: Dict[
+0000ae80: 7374 722c 2041 6e79 5d2c 2069 6d6d 6564  str, Any], immed
+0000ae90: 6961 7465 3a20 626f 6f6c 203d 2046 616c  iate: bool = Fal
+0000aea0: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
+0000aeb0: 6f72 6465 7262 6f6f 6b3a 204f 7074 696f  orderbook: Optio
+0000aec0: 6e61 6c5b 4f72 6465 7242 6f6f 6b5d 203d  nal[OrderBook] =
+0000aed0: 204e 6f6e 6529 202d 3e20 4469 6374 5b73   None) -> Dict[s
+0000aee0: 7472 2c20 416e 795d 3a0a 2020 2020 2020  tr, Any]:.      
+0000aef0: 2020 2222 220a 2020 2020 2020 2020 4368    """.        Ch
+0000af00: 6563 6b20 6472 792d 7275 6e20 6c69 6d69  eck dry-run limi
+0000af10: 7420 6f72 6465 7220 6669 6c6c 2061 6e64  t order fill and
+0000af20: 2075 7064 6174 6520 6665 6520 2869 6620   update fee (if 
+0000af30: 6974 2066 696c 6c65 6429 2e0a 2020 2020  it filled)..    
+0000af40: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000af50: 6966 2028 6f72 6465 725b 2773 7461 7475  if (order['statu
+0000af60: 7327 5d20 213d 2022 636c 6f73 6564 220a  s'] != "closed".
+0000af70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000af80: 616e 6420 6f72 6465 725b 2774 7970 6527  and order['type'
+0000af90: 5d20 696e 205b 226c 696d 6974 225d 0a20  ] in ["limit"]. 
+0000afa0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+0000afb0: 6e64 206e 6f74 206f 7264 6572 2e67 6574  nd not order.get
+0000afc0: 2827 6674 5f6f 7264 6572 5f74 7970 6527  ('ft_order_type'
+0000afd0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+0000afe0: 7061 6972 203d 206f 7264 6572 5b27 7379  pair = order['sy
+0000aff0: 6d62 6f6c 275d 0a20 2020 2020 2020 2020  mbol'].         
+0000b000: 2020 2069 6620 7365 6c66 2e5f 6472 795f     if self._dry_
+0000b010: 6973 5f70 7269 6365 5f63 726f 7373 6564  is_price_crossed
+0000b020: 2870 6169 722c 206f 7264 6572 5b27 7369  (pair, order['si
+0000b030: 6465 275d 2c20 6f72 6465 725b 2770 7269  de'], order['pri
+0000b040: 6365 275d 2c20 6f72 6465 7262 6f6f 6b29  ce'], orderbook)
+0000b050: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b060: 2020 6f72 6465 722e 7570 6461 7465 287b    order.update({
+0000b070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b080: 2020 2020 2027 7374 6174 7573 273a 2027       'status': '
+0000b090: 636c 6f73 6564 272c 0a20 2020 2020 2020  closed',.       
+0000b0a0: 2020 2020 2020 2020 2020 2020 2027 6669               'fi
+0000b0b0: 6c6c 6564 273a 206f 7264 6572 5b27 616d  lled': order['am
+0000b0c0: 6f75 6e74 275d 2c0a 2020 2020 2020 2020  ount'],.        
+0000b0d0: 2020 2020 2020 2020 2020 2020 2772 656d              'rem
+0000b0e0: 6169 6e69 6e67 273a 2030 2c0a 2020 2020  aining': 0,.    
+0000b0f0: 2020 2020 2020 2020 2020 2020 7d29 0a0a              })..
+0000b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b110: 7365 6c66 2e61 6464 5f64 7279 5f6f 7264  self.add_dry_ord
+0000b120: 6572 5f66 6565 280a 2020 2020 2020 2020  er_fee(.        
+0000b130: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+0000b140: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b150: 2020 2020 2020 6f72 6465 722c 0a20 2020        order,.   
 0000b160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b170: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0000b180: 6e20 6f72 6465 720a 0a20 2020 2064 6566  n order..    def
-0000b190: 2066 6574 6368 5f64 7279 5f72 756e 5f6f   fetch_dry_run_o
-0000b1a0: 7264 6572 2873 656c 662c 206f 7264 6572  rder(self, order
-0000b1b0: 5f69 6429 202d 3e20 4469 6374 5b73 7472  _id) -> Dict[str
-0000b1c0: 2c20 416e 795d 3a0a 2020 2020 2020 2020  , Any]:.        
-0000b1d0: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-0000b1e0: 726e 2064 7279 2d72 756e 206f 7264 6572  rn dry-run order
-0000b1f0: 0a20 2020 2020 2020 204f 6e6c 7920 6361  .        Only ca
-0000b200: 6c6c 2069 6620 7275 6e6e 696e 6720 696e  ll if running in
-0000b210: 2064 7279 2d72 756e 206d 6f64 652e 0a20   dry-run mode.. 
-0000b220: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000b230: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000b240: 2020 2020 6f72 6465 7220 3d20 7365 6c66      order = self
-0000b250: 2e5f 6472 795f 7275 6e5f 6f70 656e 5f6f  ._dry_run_open_o
-0000b260: 7264 6572 735b 6f72 6465 725f 6964 5d0a  rders[order_id].
-0000b270: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000b280: 7220 3d20 7365 6c66 2e63 6865 636b 5f64  r = self.check_d
-0000b290: 7279 5f6c 696d 6974 5f6f 7264 6572 5f66  ry_limit_order_f
-0000b2a0: 696c 6c65 6428 6f72 6465 7229 0a20 2020  illed(order).   
-0000b2b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000b2c0: 6f72 6465 720a 2020 2020 2020 2020 6578  order.        ex
-0000b2d0: 6365 7074 204b 6579 4572 726f 7220 6173  cept KeyError as
-0000b2e0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000b2f0: 6672 6f6d 2066 7265 7174 7261 6465 2e70  from freqtrade.p
-0000b300: 6572 7369 7374 656e 6365 2069 6d70 6f72  ersistence impor
-0000b310: 7420 4f72 6465 720a 2020 2020 2020 2020  t Order.        
-0000b320: 2020 2020 6f72 6465 7220 3d20 4f72 6465      order = Orde
-0000b330: 722e 6f72 6465 725f 6279 5f69 6428 6f72  r.order_by_id(or
-0000b340: 6465 725f 6964 290a 2020 2020 2020 2020  der_id).        
-0000b350: 2020 2020 6966 206f 7264 6572 3a0a 2020      if order:.  
-0000b360: 2020 2020 2020 2020 2020 2020 2020 6363                cc
-0000b370: 7874 5f6f 7264 6572 203d 206f 7264 6572  xt_order = order
-0000b380: 2e74 6f5f 6363 7874 5f6f 626a 6563 7428  .to_ccxt_object(
-0000b390: 7365 6c66 2e5f 6674 5f68 6173 5b27 7374  self._ft_has['st
-0000b3a0: 6f70 5f70 7269 6365 5f70 726f 7027 5d29  op_price_prop'])
-0000b3b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b3c0: 2073 656c 662e 5f64 7279 5f72 756e 5f6f   self._dry_run_o
-0000b3d0: 7065 6e5f 6f72 6465 7273 5b6f 7264 6572  pen_orders[order
-0000b3e0: 5f69 645d 203d 2063 6378 745f 6f72 6465  _id] = ccxt_orde
-0000b3f0: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-0000b400: 2020 7265 7475 726e 2063 6378 745f 6f72    return ccxt_or
-0000b410: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
-0000b420: 2320 4772 6163 6566 756c 6c79 2068 616e  # Gracefully han
-0000b430: 646c 6520 6572 726f 7273 2077 6974 6820  dle errors with 
-0000b440: 6472 792d 7275 6e20 6f72 6465 7273 2e0a  dry-run orders..
-0000b450: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000b460: 6520 496e 7661 6c69 644f 7264 6572 4578  e InvalidOrderEx
-0000b470: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
-0000b480: 2020 2020 2020 2020 2066 2754 7269 6564           f'Tried
-0000b490: 2074 6f20 6765 7420 616e 2069 6e76 616c   to get an inval
-0000b4a0: 6964 2064 7279 2d72 756e 2d6f 7264 6572  id dry-run-order
-0000b4b0: 2028 6964 3a20 7b6f 7264 6572 5f69 647d   (id: {order_id}
-0000b4c0: 292e 204d 6573 7361 6765 3a20 7b65 7d27  ). Message: {e}'
-0000b4d0: 2920 6672 6f6d 2065 0a0a 2020 2020 2320  ) from e..    # 
-0000b4e0: 4f72 6465 7220 6861 6e64 6c69 6e67 0a0a  Order handling..
-0000b4f0: 2020 2020 6465 6620 5f6c 6576 5f70 7265      def _lev_pre
-0000b500: 7028 7365 6c66 2c20 7061 6972 3a20 7374  p(self, pair: st
-0000b510: 722c 206c 6576 6572 6167 653a 2066 6c6f  r, leverage: flo
-0000b520: 6174 2c20 7369 6465 3a20 4275 7953 656c  at, side: BuySel
-0000b530: 6c2c 2061 6363 6570 745f 6661 696c 3a20  l, accept_fail: 
-0000b540: 626f 6f6c 203d 2046 616c 7365 293a 0a20  bool = False):. 
-0000b550: 2020 2020 2020 2069 6620 7365 6c66 2e74         if self.t
-0000b560: 7261 6469 6e67 5f6d 6f64 6520 213d 2054  rading_mode != T
-0000b570: 7261 6469 6e67 4d6f 6465 2e53 504f 543a  radingMode.SPOT:
-0000b580: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000b590: 662e 7365 745f 6d61 7267 696e 5f6d 6f64  f.set_margin_mod
-0000b5a0: 6528 7061 6972 2c20 7365 6c66 2e6d 6172  e(pair, self.mar
-0000b5b0: 6769 6e5f 6d6f 6465 2c20 6163 6365 7074  gin_mode, accept
-0000b5c0: 5f66 6169 6c29 0a20 2020 2020 2020 2020  _fail).         
-0000b5d0: 2020 2073 656c 662e 5f73 6574 5f6c 6576     self._set_lev
-0000b5e0: 6572 6167 6528 6c65 7665 7261 6765 2c20  erage(leverage, 
-0000b5f0: 7061 6972 2c20 6163 6365 7074 5f66 6169  pair, accept_fai
-0000b600: 6c29 0a0a 2020 2020 6465 6620 5f67 6574  l)..    def _get
-0000b610: 5f70 6172 616d 7328 0a20 2020 2020 2020  _params(.       
-0000b620: 2073 656c 662c 0a20 2020 2020 2020 2073   self,.        s
-0000b630: 6964 653a 2042 7579 5365 6c6c 2c0a 2020  ide: BuySell,.  
-0000b640: 2020 2020 2020 6f72 6465 7274 7970 653a        ordertype:
-0000b650: 2073 7472 2c0a 2020 2020 2020 2020 6c65   str,.        le
-0000b660: 7665 7261 6765 3a20 666c 6f61 742c 0a20  verage: float,. 
-0000b670: 2020 2020 2020 2072 6564 7563 654f 6e6c         reduceOnl
-0000b680: 793a 2062 6f6f 6c2c 0a20 2020 2020 2020  y: bool,.       
-0000b690: 2074 696d 655f 696e 5f66 6f72 6365 3a20   time_in_force: 
-0000b6a0: 7374 7220 3d20 2747 5443 272c 0a20 2020  str = 'GTC',.   
-0000b6b0: 2029 202d 3e20 4469 6374 3a0a 2020 2020   ) -> Dict:.    
-0000b6c0: 2020 2020 7061 7261 6d73 203d 2073 656c      params = sel
-0000b6d0: 662e 5f70 6172 616d 732e 636f 7079 2829  f._params.copy()
-0000b6e0: 0a20 2020 2020 2020 2069 6620 7469 6d65  .        if time
-0000b6f0: 5f69 6e5f 666f 7263 6520 213d 2027 4754  _in_force != 'GT
-0000b700: 4327 2061 6e64 206f 7264 6572 7479 7065  C' and ordertype
-0000b710: 2021 3d20 276d 6172 6b65 7427 3a0a 2020   != 'market':.  
-0000b720: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000b730: 2e75 7064 6174 6528 7b27 7469 6d65 496e  .update({'timeIn
-0000b740: 466f 7263 6527 3a20 7469 6d65 5f69 6e5f  Force': time_in_
-0000b750: 666f 7263 652e 7570 7065 7228 297d 290a  force.upper()}).
-0000b760: 2020 2020 2020 2020 6966 2072 6564 7563          if reduc
-0000b770: 654f 6e6c 793a 0a20 2020 2020 2020 2020  eOnly:.         
-0000b780: 2020 2070 6172 616d 732e 7570 6461 7465     params.update
-0000b790: 287b 2772 6564 7563 654f 6e6c 7927 3a20  ({'reduceOnly': 
-0000b7a0: 5472 7565 7d29 0a20 2020 2020 2020 2072  True}).        r
-0000b7b0: 6574 7572 6e20 7061 7261 6d73 0a0a 2020  eturn params..  
-0000b7c0: 2020 6465 6620 5f6f 7264 6572 5f6e 6565    def _order_nee
-0000b7d0: 6473 5f70 7269 6365 2873 656c 662c 206f  ds_price(self, o
-0000b7e0: 7264 6572 7479 7065 3a20 7374 7229 202d  rdertype: str) -
-0000b7f0: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
-0000b800: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-0000b810: 2020 2020 206f 7264 6572 7479 7065 2021       ordertype !
-0000b820: 3d20 276d 6172 6b65 7427 0a20 2020 2020  = 'market'.     
-0000b830: 2020 2020 2020 206f 7220 7365 6c66 2e5f         or self._
-0000b840: 6170 692e 6f70 7469 6f6e 732e 6765 7428  api.options.get(
-0000b850: 2263 7265 6174 654d 6172 6b65 7442 7579  "createMarketBuy
-0000b860: 4f72 6465 7252 6571 7569 7265 7350 7269  OrderRequiresPri
-0000b870: 6365 222c 2046 616c 7365 290a 2020 2020  ce", False).    
-0000b880: 2020 2020 2020 2020 6f72 2073 656c 662e          or self.
-0000b890: 5f66 745f 6861 732e 6765 7428 276d 6172  _ft_has.get('mar
-0000b8a0: 6b65 744f 7264 6572 5265 7175 6972 6573  ketOrderRequires
-0000b8b0: 5072 6963 6527 2c20 4661 6c73 6529 0a20  Price', False). 
-0000b8c0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0000b8d0: 6620 6372 6561 7465 5f6f 7264 6572 280a  f create_order(.
-0000b8e0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000b8f0: 2020 2020 2020 2a2c 0a20 2020 2020 2020        *,.       
-0000b900: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
-0000b910: 2020 2020 6f72 6465 7274 7970 653a 2073      ordertype: s
-0000b920: 7472 2c0a 2020 2020 2020 2020 7369 6465  tr,.        side
-0000b930: 3a20 4275 7953 656c 6c2c 0a20 2020 2020  : BuySell,.     
-0000b940: 2020 2061 6d6f 756e 743a 2066 6c6f 6174     amount: float
-0000b950: 2c0a 2020 2020 2020 2020 7261 7465 3a20  ,.        rate: 
-0000b960: 666c 6f61 742c 0a20 2020 2020 2020 206c  float,.        l
-0000b970: 6576 6572 6167 653a 2066 6c6f 6174 2c0a  everage: float,.
-0000b980: 2020 2020 2020 2020 7265 6475 6365 4f6e          reduceOn
-0000b990: 6c79 3a20 626f 6f6c 203d 2046 616c 7365  ly: bool = False
-0000b9a0: 2c0a 2020 2020 2020 2020 7469 6d65 5f69  ,.        time_i
-0000b9b0: 6e5f 666f 7263 653a 2073 7472 203d 2027  n_force: str = '
-0000b9c0: 4754 4327 2c0a 2020 2020 2920 2d3e 2044  GTC',.    ) -> D
-0000b9d0: 6963 743a 0a20 2020 2020 2020 2069 6620  ict:.        if 
-0000b9e0: 7365 6c66 2e5f 636f 6e66 6967 5b27 6472  self._config['dr
-0000b9f0: 795f 7275 6e27 5d3a 0a20 2020 2020 2020  y_run']:.       
-0000ba00: 2020 2020 2064 7279 5f6f 7264 6572 203d       dry_order =
-0000ba10: 2073 656c 662e 6372 6561 7465 5f64 7279   self.create_dry
-0000ba20: 5f72 756e 5f6f 7264 6572 280a 2020 2020  _run_order(.    
-0000ba30: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-0000ba40: 2c20 6f72 6465 7274 7970 652c 2073 6964  , ordertype, sid
-0000ba50: 652c 2061 6d6f 756e 742c 2073 656c 662e  e, amount, self.
-0000ba60: 7072 6963 655f 746f 5f70 7265 6369 7369  price_to_precisi
-0000ba70: 6f6e 2870 6169 722c 2072 6174 6529 2c20  on(pair, rate), 
-0000ba80: 6c65 7665 7261 6765 290a 2020 2020 2020  leverage).      
-0000ba90: 2020 2020 2020 7265 7475 726e 2064 7279        return dry
-0000baa0: 5f6f 7264 6572 0a0a 2020 2020 2020 2020  _order..        
-0000bab0: 7061 7261 6d73 203d 2073 656c 662e 5f67  params = self._g
-0000bac0: 6574 5f70 6172 616d 7328 7369 6465 2c20  et_params(side, 
-0000bad0: 6f72 6465 7274 7970 652c 206c 6576 6572  ordertype, lever
-0000bae0: 6167 652c 2072 6564 7563 654f 6e6c 792c  age, reduceOnly,
-0000baf0: 2074 696d 655f 696e 5f66 6f72 6365 290a   time_in_force).
-0000bb00: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000bb10: 2020 2020 2020 2020 2020 2320 5365 7420            # Set 
-0000bb20: 7468 6520 7072 6563 6973 696f 6e20 666f  the precision fo
-0000bb30: 7220 616d 6f75 6e74 2061 6e64 2070 7269  r amount and pri
-0000bb40: 6365 2872 6174 6529 2061 7320 6163 6365  ce(rate) as acce
-0000bb50: 7074 6564 2062 7920 7468 6520 6578 6368  pted by the exch
-0000bb60: 616e 6765 0a20 2020 2020 2020 2020 2020  ange.           
-0000bb70: 2061 6d6f 756e 7420 3d20 7365 6c66 2e61   amount = self.a
-0000bb80: 6d6f 756e 745f 746f 5f70 7265 6369 7369  mount_to_precisi
-0000bb90: 6f6e 2870 6169 722c 2073 656c 662e 5f61  on(pair, self._a
-0000bba0: 6d6f 756e 745f 746f 5f63 6f6e 7472 6163  mount_to_contrac
-0000bbb0: 7473 2870 6169 722c 2061 6d6f 756e 7429  ts(pair, amount)
-0000bbc0: 290a 2020 2020 2020 2020 2020 2020 6e65  ).            ne
-0000bbd0: 6564 735f 7072 6963 6520 3d20 7365 6c66  eds_price = self
-0000bbe0: 2e5f 6f72 6465 725f 6e65 6564 735f 7072  ._order_needs_pr
-0000bbf0: 6963 6528 6f72 6465 7274 7970 6529 0a20  ice(ordertype). 
-0000bc00: 2020 2020 2020 2020 2020 2072 6174 655f             rate_
-0000bc10: 666f 725f 6f72 6465 7220 3d20 7365 6c66  for_order = self
-0000bc20: 2e70 7269 6365 5f74 6f5f 7072 6563 6973  .price_to_precis
-0000bc30: 696f 6e28 7061 6972 2c20 7261 7465 2920  ion(pair, rate) 
-0000bc40: 6966 206e 6565 6473 5f70 7269 6365 2065  if needs_price e
-0000bc50: 6c73 6520 4e6f 6e65 0a0a 2020 2020 2020  lse None..      
-0000bc60: 2020 2020 2020 6966 206e 6f74 2072 6564        if not red
-0000bc70: 7563 654f 6e6c 793a 0a20 2020 2020 2020  uceOnly:.       
-0000bc80: 2020 2020 2020 2020 2073 656c 662e 5f6c           self._l
-0000bc90: 6576 5f70 7265 7028 7061 6972 2c20 6c65  ev_prep(pair, le
-0000bca0: 7665 7261 6765 2c20 7369 6465 290a 0a20  verage, side).. 
-0000bcb0: 2020 2020 2020 2020 2020 206f 7264 6572             order
-0000bcc0: 203d 2073 656c 662e 5f61 7069 2e63 7265   = self._api.cre
-0000bcd0: 6174 655f 6f72 6465 7228 0a20 2020 2020  ate_order(.     
-0000bce0: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-0000bcf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bd00: 206f 7264 6572 7479 7065 2c0a 2020 2020   ordertype,.    
-0000bd10: 2020 2020 2020 2020 2020 2020 7369 6465              side
-0000bd20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000bd30: 2020 616d 6f75 6e74 2c0a 2020 2020 2020    amount,.      
-0000bd40: 2020 2020 2020 2020 2020 7261 7465 5f66            rate_f
-0000bd50: 6f72 5f6f 7264 6572 2c0a 2020 2020 2020  or_order,.      
-0000bd60: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-0000bd70: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0000bd80: 2020 2020 2020 2020 2020 2020 6966 206f              if o
-0000bd90: 7264 6572 2e67 6574 2827 7374 6174 7573  rder.get('status
-0000bda0: 2729 2069 7320 4e6f 6e65 3a0a 2020 2020  ') is None:.    
-0000bdb0: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
-0000bdc0: 7020 656d 7074 7920 7374 6174 7573 2074  p empty status t
-0000bdd0: 6f20 6f70 656e 2e0a 2020 2020 2020 2020  o open..        
-0000bde0: 2020 2020 2020 2020 6f72 6465 725b 2773          order['s
-0000bdf0: 7461 7475 7327 5d20 3d20 276f 7065 6e27  tatus'] = 'open'
-0000be00: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0000be10: 206f 7264 6572 2e67 6574 2827 7479 7065   order.get('type
-0000be20: 2729 2069 7320 4e6f 6e65 3a0a 2020 2020  ') is None:.    
-0000be30: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
-0000be40: 725b 2774 7970 6527 5d20 3d20 6f72 6465  r['type'] = orde
-0000be50: 7274 7970 650a 0a20 2020 2020 2020 2020  rtype..         
-0000be60: 2020 2073 656c 662e 5f6c 6f67 5f65 7863     self._log_exc
-0000be70: 6861 6e67 655f 7265 7370 6f6e 7365 2827  hange_response('
-0000be80: 6372 6561 7465 5f6f 7264 6572 272c 206f  create_order', o
-0000be90: 7264 6572 290a 2020 2020 2020 2020 2020  rder).          
-0000bea0: 2020 6f72 6465 7220 3d20 7365 6c66 2e5f    order = self._
-0000beb0: 6f72 6465 725f 636f 6e74 7261 6374 735f  order_contracts_
-0000bec0: 746f 5f61 6d6f 756e 7428 6f72 6465 7229  to_amount(order)
-0000bed0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000bee0: 7572 6e20 6f72 6465 720a 0a20 2020 2020  urn order..     
-0000bef0: 2020 2065 7863 6570 7420 6363 7874 2e49     except ccxt.I
-0000bf00: 6e73 7566 6669 6369 656e 7446 756e 6473  nsufficientFunds
-0000bf10: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0000bf20: 2020 2072 6169 7365 2049 6e73 7566 6669     raise Insuffi
-0000bf30: 6369 656e 7446 756e 6473 4572 726f 7228  cientFundsError(
-0000bf40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bf50: 2066 2749 6e73 7566 6669 6369 656e 7420   f'Insufficient 
-0000bf60: 6675 6e64 7320 746f 2063 7265 6174 6520  funds to create 
-0000bf70: 7b6f 7264 6572 7479 7065 7d20 7b73 6964  {ordertype} {sid
-0000bf80: 657d 206f 7264 6572 206f 6e20 6d61 726b  e} order on mark
-0000bf90: 6574 207b 7061 6972 7d2e 2027 0a20 2020  et {pair}. '.   
-0000bfa0: 2020 2020 2020 2020 2020 2020 2066 2754               f'T
-0000bfb0: 7269 6564 2074 6f20 7b73 6964 657d 2061  ried to {side} a
-0000bfc0: 6d6f 756e 7420 7b61 6d6f 756e 747d 2061  mount {amount} a
-0000bfd0: 7420 7261 7465 207b 7261 7465 7d2e 270a  t rate {rate}.'.
-0000bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bff0: 6627 4d65 7373 6167 653a 207b 657d 2729  f'Message: {e}')
-0000c000: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0000c010: 6578 6365 7074 2063 6378 742e 496e 7661  except ccxt.Inva
-0000c020: 6c69 644f 7264 6572 2061 7320 653a 0a20  lidOrder as e:. 
-0000c030: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000c040: 2049 6e76 616c 6964 4f72 6465 7245 7863   InvalidOrderExc
-0000c050: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
-0000c060: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
-0000c070: 6e6f 7420 6372 6561 7465 207b 6f72 6465  not create {orde
-0000c080: 7274 7970 657d 207b 7369 6465 7d20 6f72  rtype} {side} or
-0000c090: 6465 7220 6f6e 206d 6172 6b65 7420 7b70  der on market {p
-0000c0a0: 6169 727d 2e20 270a 2020 2020 2020 2020  air}. '.        
-0000c0b0: 2020 2020 2020 2020 6627 5472 6965 6420          f'Tried 
-0000c0c0: 746f 207b 7369 6465 7d20 616d 6f75 6e74  to {side} amount
-0000c0d0: 207b 616d 6f75 6e74 7d20 6174 2072 6174   {amount} at rat
-0000c0e0: 6520 7b72 6174 657d 2e20 270a 2020 2020  e {rate}. '.    
-0000c0f0: 2020 2020 2020 2020 2020 2020 6627 4d65              f'Me
-0000c100: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
-0000c110: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0000c120: 7074 2063 6378 742e 4444 6f53 5072 6f74  pt ccxt.DDoSProt
-0000c130: 6563 7469 6f6e 2061 7320 653a 0a20 2020  ection as e:.   
-0000c140: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
-0000c150: 446f 7350 726f 7465 6374 696f 6e28 6529  DosProtection(e)
-0000c160: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0000c170: 6578 6365 7074 2028 6363 7874 2e4e 6574  except (ccxt.Net
-0000c180: 776f 726b 4572 726f 722c 2063 6378 742e  workError, ccxt.
-0000c190: 4578 6368 616e 6765 4572 726f 7229 2061  ExchangeError) a
-0000c1a0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000c1b0: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
-0000c1c0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
-0000c1d0: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
-0000c1e0: 6f74 2070 6c61 6365 207b 7369 6465 7d20  ot place {side} 
-0000c1f0: 6f72 6465 7220 6475 6520 746f 207b 652e  order due to {e.
-0000c200: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0000c210: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
-0000c220: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
-0000c230: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
-0000c240: 6173 6545 7272 6f72 2061 7320 653a 0a20  aseError as e:. 
-0000c250: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000c260: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-0000c270: 7074 696f 6e28 6529 2066 726f 6d20 650a  ption(e) from e.
-0000c280: 0a20 2020 2064 6566 2073 746f 706c 6f73  .    def stoplos
-0000c290: 735f 6164 6a75 7374 2873 656c 662c 2073  s_adjust(self, s
-0000c2a0: 746f 705f 6c6f 7373 3a20 666c 6f61 742c  top_loss: float,
-0000c2b0: 206f 7264 6572 3a20 4469 6374 2c20 7369   order: Dict, si
-0000c2c0: 6465 3a20 7374 7229 202d 3e20 626f 6f6c  de: str) -> bool
-0000c2d0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0000c2e0: 2020 2020 2020 5665 7269 6679 2073 746f        Verify sto
-0000c2f0: 705f 6c6f 7373 2061 6761 696e 7374 2073  p_loss against s
-0000c300: 746f 706c 6f73 732d 6f72 6465 7220 7661  toploss-order va
-0000c310: 6c75 6520 286c 696d 6974 206f 7220 7072  lue (limit or pr
-0000c320: 6963 6529 0a20 2020 2020 2020 2052 6574  ice).        Ret
-0000c330: 7572 6e73 2054 7275 6520 6966 2061 646a  urns True if adj
-0000c340: 7573 746d 656e 7420 6973 206e 6563 6573  ustment is neces
-0000c350: 7361 7279 2e0a 2020 2020 2020 2020 2222  sary..        ""
-0000c360: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-0000c370: 2073 656c 662e 5f66 745f 6861 732e 6765   self._ft_has.ge
-0000c380: 7428 2773 746f 706c 6f73 735f 6f6e 5f65  t('stoploss_on_e
-0000c390: 7863 6861 6e67 6527 293a 0a20 2020 2020  xchange'):.     
-0000c3a0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-0000c3b0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-0000c3c0: 6e28 6622 7374 6f70 6c6f 7373 2069 7320  n(f"stoploss is 
-0000c3d0: 6e6f 7420 696d 706c 656d 656e 7465 6420  not implemented 
-0000c3e0: 666f 7220 7b73 656c 662e 6e61 6d65 7d2e  for {self.name}.
-0000c3f0: 2229 0a20 2020 2020 2020 2070 7269 6365  ").        price
-0000c400: 5f70 6172 616d 203d 2073 656c 662e 5f66  _param = self._f
-0000c410: 745f 6861 735b 2773 746f 705f 7072 6963  t_has['stop_pric
-0000c420: 655f 7072 6f70 275d 0a20 2020 2020 2020  e_prop'].       
-0000c430: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
-0000c440: 2020 2020 2020 6f72 6465 722e 6765 7428        order.get(
-0000c450: 7072 6963 655f 7061 7261 6d2c 204e 6f6e  price_param, Non
-0000c460: 6529 2069 7320 4e6f 6e65 0a20 2020 2020  e) is None.     
-0000c470: 2020 2020 2020 206f 7220 2828 7369 6465         or ((side
-0000c480: 203d 3d20 2273 656c 6c22 2061 6e64 2073   == "sell" and s
-0000c490: 746f 705f 6c6f 7373 203e 2066 6c6f 6174  top_loss > float
-0000c4a0: 286f 7264 6572 5b70 7269 6365 5f70 6172  (order[price_par
-0000c4b0: 616d 5d29 2920 6f72 0a20 2020 2020 2020  am])) or.       
-0000c4c0: 2020 2020 2020 2020 2028 7369 6465 203d           (side =
-0000c4d0: 3d20 2262 7579 2220 616e 6420 7374 6f70  = "buy" and stop
-0000c4e0: 5f6c 6f73 7320 3c20 666c 6f61 7428 6f72  _loss < float(or
-0000c4f0: 6465 725b 7072 6963 655f 7061 7261 6d5d  der[price_param]
-0000c500: 2929 290a 2020 2020 2020 2020 290a 0a20  ))).        ).. 
-0000c510: 2020 2064 6566 205f 6765 745f 7374 6f70     def _get_stop
-0000c520: 5f6f 7264 6572 5f74 7970 6528 7365 6c66  _order_type(self
-0000c530: 2c20 7573 6572 5f6f 7264 6572 5f74 7970  , user_order_typ
-0000c540: 6529 202d 3e20 5475 706c 655b 7374 722c  e) -> Tuple[str,
-0000c550: 2073 7472 5d3a 0a0a 2020 2020 2020 2020   str]:..        
-0000c560: 6176 6169 6c61 626c 655f 6f72 6465 725f  available_order_
-0000c570: 5479 7065 733a 2044 6963 745b 7374 722c  Types: Dict[str,
-0000c580: 2073 7472 5d20 3d20 7365 6c66 2e5f 6674   str] = self._ft
-0000c590: 5f68 6173 5b22 7374 6f70 6c6f 7373 5f6f  _has["stoploss_o
-0000c5a0: 7264 6572 5f74 7970 6573 225d 0a0a 2020  rder_types"]..  
-0000c5b0: 2020 2020 2020 6966 2075 7365 725f 6f72        if user_or
-0000c5c0: 6465 725f 7479 7065 2069 6e20 6176 6169  der_type in avai
-0000c5d0: 6c61 626c 655f 6f72 6465 725f 5479 7065  lable_order_Type
-0000c5e0: 732e 6b65 7973 2829 3a0a 2020 2020 2020  s.keys():.      
-0000c5f0: 2020 2020 2020 6f72 6465 7274 7970 6520        ordertype 
-0000c600: 3d20 6176 6169 6c61 626c 655f 6f72 6465  = available_orde
-0000c610: 725f 5479 7065 735b 7573 6572 5f6f 7264  r_Types[user_ord
-0000c620: 6572 5f74 7970 655d 0a20 2020 2020 2020  er_type].       
-0000c630: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000c640: 2020 2023 204f 7468 6572 7769 7365 2070     # Otherwise p
-0000c650: 6963 6b20 6f6e 6c79 206f 6e65 2061 7661  ick only one ava
-0000c660: 696c 6162 6c65 0a20 2020 2020 2020 2020  ilable.         
-0000c670: 2020 206f 7264 6572 7479 7065 203d 206c     ordertype = l
-0000c680: 6973 7428 6176 6169 6c61 626c 655f 6f72  ist(available_or
-0000c690: 6465 725f 5479 7065 732e 7661 6c75 6573  der_Types.values
-0000c6a0: 2829 295b 305d 0a20 2020 2020 2020 2020  ())[0].         
-0000c6b0: 2020 2075 7365 725f 6f72 6465 725f 7479     user_order_ty
-0000c6c0: 7065 203d 206c 6973 7428 6176 6169 6c61  pe = list(availa
-0000c6d0: 626c 655f 6f72 6465 725f 5479 7065 732e  ble_order_Types.
-0000c6e0: 6b65 7973 2829 295b 305d 0a20 2020 2020  keys())[0].     
-0000c6f0: 2020 2072 6574 7572 6e20 6f72 6465 7274     return ordert
-0000c700: 7970 652c 2075 7365 725f 6f72 6465 725f  ype, user_order_
-0000c710: 7479 7065 0a0a 2020 2020 6465 6620 5f67  type..    def _g
-0000c720: 6574 5f73 746f 705f 6c69 6d69 745f 7261  et_stop_limit_ra
-0000c730: 7465 2873 656c 662c 2073 746f 705f 7072  te(self, stop_pr
-0000c740: 6963 653a 2066 6c6f 6174 2c20 6f72 6465  ice: float, orde
-0000c750: 725f 7479 7065 733a 2044 6963 742c 2073  r_types: Dict, s
-0000c760: 6964 653a 2073 7472 2920 2d3e 2066 6c6f  ide: str) -> flo
-0000c770: 6174 3a0a 2020 2020 2020 2020 2320 4c69  at:.        # Li
-0000c780: 6d69 7420 7072 6963 6520 7468 7265 7368  mit price thresh
-0000c790: 6f6c 643a 2041 7320 6c69 6d69 7420 7072  old: As limit pr
-0000c7a0: 6963 6520 7368 6f75 6c64 2061 6c77 6179  ice should alway
-0000c7b0: 7320 6265 2062 656c 6f77 2073 746f 702d  s be below stop-
-0000c7c0: 7072 6963 650a 2020 2020 2020 2020 6c69  price.        li
-0000c7d0: 6d69 745f 7072 6963 655f 7063 7420 3d20  mit_price_pct = 
-0000c7e0: 6f72 6465 725f 7479 7065 732e 6765 7428  order_types.get(
-0000c7f0: 2773 746f 706c 6f73 735f 6f6e 5f65 7863  'stoploss_on_exc
-0000c800: 6861 6e67 655f 6c69 6d69 745f 7261 7469  hange_limit_rati
-0000c810: 6f27 2c20 302e 3939 290a 2020 2020 2020  o', 0.99).      
-0000c820: 2020 6966 2073 6964 6520 3d3d 2022 7365    if side == "se
-0000c830: 6c6c 223a 0a20 2020 2020 2020 2020 2020  ll":.           
-0000c840: 206c 696d 6974 5f72 6174 6520 3d20 7374   limit_rate = st
-0000c850: 6f70 5f70 7269 6365 202a 206c 696d 6974  op_price * limit
-0000c860: 5f70 7269 6365 5f70 6374 0a20 2020 2020  _price_pct.     
-0000c870: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000c880: 2020 2020 206c 696d 6974 5f72 6174 6520       limit_rate 
-0000c890: 3d20 7374 6f70 5f70 7269 6365 202a 2028  = stop_price * (
-0000c8a0: 3220 2d20 6c69 6d69 745f 7072 6963 655f  2 - limit_price_
-0000c8b0: 7063 7429 0a0a 2020 2020 2020 2020 6261  pct)..        ba
-0000c8c0: 645f 7374 6f70 5f70 7269 6365 203d 2028  d_stop_price = (
-0000c8d0: 2873 746f 705f 7072 6963 6520 3c20 6c69  (stop_price < li
-0000c8e0: 6d69 745f 7261 7465 2920 6966 2073 6964  mit_rate) if sid
-0000c8f0: 6520 3d3d 0a20 2020 2020 2020 2020 2020  e ==.           
-0000c900: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000c910: 7365 6c6c 2220 656c 7365 2028 7374 6f70  sell" else (stop
-0000c920: 5f70 7269 6365 203e 206c 696d 6974 5f72  _price > limit_r
-0000c930: 6174 6529 290a 2020 2020 2020 2020 2320  ate)).        # 
-0000c940: 456e 7375 7265 2072 6174 6520 6973 206c  Ensure rate is l
-0000c950: 6573 7320 7468 616e 2073 746f 7020 7072  ess than stop pr
-0000c960: 6963 650a 2020 2020 2020 2020 6966 2062  ice.        if b
-0000c970: 6164 5f73 746f 705f 7072 6963 653a 0a20  ad_stop_price:. 
-0000c980: 2020 2020 2020 2020 2020 2023 2054 6869             # Thi
-0000c990: 7320 6361 6e20 666f 7220 6578 616d 706c  s can for exampl
-0000c9a0: 6520 6861 7070 656e 2069 6620 7468 6520  e happen if the 
-0000c9b0: 7374 6f70 202f 206c 6971 7569 6461 7469  stop / liquidati
-0000c9c0: 6f6e 2070 7269 6365 2069 7320 7365 7420  on price is set 
-0000c9d0: 746f 2030 0a20 2020 2020 2020 2020 2020  to 0.           
-0000c9e0: 2023 2057 6869 6368 2069 7320 706f 7373   # Which is poss
-0000c9f0: 6962 6c65 2069 6620 6120 6d61 726b 6574  ible if a market
-0000ca00: 2d6f 7264 6572 2063 6c6f 7365 7320 7269  -order closes ri
-0000ca10: 6768 7420 6177 6179 2e0a 2020 2020 2020  ght away..      
-0000ca20: 2020 2020 2020 2320 5468 6520 496e 7661        # The Inva
-0000ca30: 6c69 644f 7264 6572 4578 6365 7074 696f  lidOrderExceptio
-0000ca40: 6e20 7769 6c6c 2062 7562 626c 6520 7570  n will bubble up
-0000ca50: 2074 6f20 6578 6974 5f70 6f73 6974 696f   to exit_positio
-0000ca60: 6e73 2c20 7768 6572 6520 6974 2077 696c  ns, where it wil
-0000ca70: 6c20 6265 0a20 2020 2020 2020 2020 2020  l be.           
-0000ca80: 2023 2068 616e 646c 6564 2067 7261 6365   # handled grace
-0000ca90: 6675 6c6c 792e 0a20 2020 2020 2020 2020  fully..         
-0000caa0: 2020 2072 6169 7365 2049 6e76 616c 6964     raise Invalid
-0000cab0: 4f72 6465 7245 7863 6570 7469 6f6e 280a  OrderException(.
-0000cac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cad0: 2249 6e20 7374 6f70 6c6f 7373 206c 696d  "In stoploss lim
-0000cae0: 6974 206f 7264 6572 2c20 7374 6f70 2070  it order, stop p
-0000caf0: 7269 6365 2073 686f 756c 6420 6265 206d  rice should be m
-0000cb00: 6f72 6520 7468 616e 206c 696d 6974 2070  ore than limit p
-0000cb10: 7269 6365 2e20 220a 2020 2020 2020 2020  rice. ".        
-0000cb20: 2020 2020 2020 2020 6622 5374 6f70 2070          f"Stop p
-0000cb30: 7269 6365 3a20 7b73 746f 705f 7072 6963  rice: {stop_pric
-0000cb40: 657d 2c20 4c69 6d69 7420 7072 6963 653a  e}, Limit price:
-0000cb50: 207b 6c69 6d69 745f 7261 7465 7d2c 2022   {limit_rate}, "
-0000cb60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cb70: 2066 224c 696d 6974 2050 7269 6365 2070   f"Limit Price p
-0000cb80: 6374 3a20 7b6c 696d 6974 5f70 7269 6365  ct: {limit_price
-0000cb90: 5f70 6374 7d22 0a20 2020 2020 2020 2020  _pct}".         
-0000cba0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000cbb0: 2072 6574 7572 6e20 6c69 6d69 745f 7261   return limit_ra
-0000cbc0: 7465 0a0a 2020 2020 6465 6620 5f67 6574  te..    def _get
-0000cbd0: 5f73 746f 705f 7061 7261 6d73 2873 656c  _stop_params(sel
-0000cbe0: 662c 2073 6964 653a 2042 7579 5365 6c6c  f, side: BuySell
-0000cbf0: 2c20 6f72 6465 7274 7970 653a 2073 7472  , ordertype: str
-0000cc00: 2c20 7374 6f70 5f70 7269 6365 3a20 666c  , stop_price: fl
-0000cc10: 6f61 7429 202d 3e20 4469 6374 3a0a 2020  oat) -> Dict:.  
-0000cc20: 2020 2020 2020 7061 7261 6d73 203d 2073        params = s
-0000cc30: 656c 662e 5f70 6172 616d 732e 636f 7079  elf._params.copy
-0000cc40: 2829 0a20 2020 2020 2020 2023 2056 6572  ().        # Ver
-0000cc50: 6966 7920 6966 2073 746f 7050 7269 6365  ify if stopPrice
-0000cc60: 2077 6f72 6b73 2066 6f72 2079 6f75 7220   works for your 
-0000cc70: 6578 6368 616e 6765 2c20 656c 7365 2063  exchange, else c
-0000cc80: 6f6e 6669 6775 7265 2073 746f 705f 7072  onfigure stop_pr
-0000cc90: 6963 655f 7061 7261 6d0a 2020 2020 2020  ice_param.      
-0000cca0: 2020 7061 7261 6d73 2e75 7064 6174 6528    params.update(
-0000ccb0: 7b73 656c 662e 5f66 745f 6861 735b 2773  {self._ft_has['s
-0000ccc0: 746f 705f 7072 6963 655f 7061 7261 6d27  top_price_param'
-0000ccd0: 5d3a 2073 746f 705f 7072 6963 657d 290a  ]: stop_price}).
-0000cce0: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-0000ccf0: 6172 616d 730a 0a20 2020 2040 7265 7472  arams..    @retr
-0000cd00: 6965 7228 7265 7472 6965 733d 3029 0a20  ier(retries=0). 
-0000cd10: 2020 2064 6566 2063 7265 6174 655f 7374     def create_st
-0000cd20: 6f70 6c6f 7373 2873 656c 662c 2070 6169  oploss(self, pai
-0000cd30: 723a 2073 7472 2c20 616d 6f75 6e74 3a20  r: str, amount: 
-0000cd40: 666c 6f61 742c 2073 746f 705f 7072 6963  float, stop_pric
-0000cd50: 653a 2066 6c6f 6174 2c20 6f72 6465 725f  e: float, order_
-0000cd60: 7479 7065 733a 2044 6963 742c 0a20 2020  types: Dict,.   
-0000cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cd80: 2020 2020 2073 6964 653a 2042 7579 5365       side: BuySe
-0000cd90: 6c6c 2c20 6c65 7665 7261 6765 3a20 666c  ll, leverage: fl
-0000cda0: 6f61 7429 202d 3e20 4469 6374 3a0a 2020  oat) -> Dict:.  
-0000cdb0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000cdc0: 2020 6372 6561 7465 7320 6120 7374 6f70    creates a stop
-0000cdd0: 6c6f 7373 206f 7264 6572 2e0a 2020 2020  loss order..    
-0000cde0: 2020 2020 7265 7175 6972 6573 2060 5f66      requires `_f
-0000cdf0: 745f 6861 735b 2773 746f 706c 6f73 735f  t_has['stoploss_
-0000ce00: 6f72 6465 725f 7479 7065 7327 5d60 2074  order_types']` t
-0000ce10: 6f20 6265 2073 6574 2061 7320 6120 6469  o be set as a di
-0000ce20: 6374 206d 6170 7069 6e67 206c 696d 6974  ct mapping limit
-0000ce30: 2061 6e64 206d 6172 6b65 740a 2020 2020   and market.    
-0000ce40: 2020 2020 2020 2020 746f 2074 6865 2063          to the c
-0000ce50: 6f72 7265 7370 6f6e 6469 6e67 2065 7863  orresponding exc
-0000ce60: 6861 6e67 6520 7479 7065 2e0a 0a20 2020  hange type...   
-0000ce70: 2020 2020 2054 6865 2070 7265 6369 7365       The precise
-0000ce80: 206f 7264 6572 7479 7065 2069 7320 6465   ordertype is de
-0000ce90: 7465 726d 696e 6564 2062 7920 7468 6520  termined by the 
-0000cea0: 6f72 6465 725f 7479 7065 7320 6469 6374  order_types dict
-0000ceb0: 206f 7220 6578 6368 616e 6765 2064 6566   or exchange def
-0000cec0: 6175 6c74 2e0a 0a20 2020 2020 2020 2054  ault...        T
-0000ced0: 6865 2065 7863 6570 7469 6f6e 2062 656c  he exception bel
-0000cee0: 6f77 2073 686f 756c 6420 6e65 7665 7220  ow should never 
-0000cef0: 7261 6973 652c 2073 696e 6365 2077 6520  raise, since we 
-0000cf00: 6469 7361 6c6c 6f77 0a20 2020 2020 2020  disallow.       
-0000cf10: 2073 7461 7274 696e 6720 7468 6520 626f   starting the bo
-0000cf20: 7420 696e 2076 616c 6964 6174 655f 6f72  t in validate_or
-0000cf30: 6465 7274 7970 6573 2829 0a0a 2020 2020  dertypes()..    
-0000cf40: 2020 2020 5468 6973 206d 6179 2077 6f72      This may wor
-0000cf50: 6b20 7769 7468 2061 206c 696d 6974 6564  k with a limited
-0000cf60: 206e 756d 6265 7220 6f66 206f 7468 6572   number of other
-0000cf70: 2065 7863 6861 6e67 6573 2c20 6275 7420   exchanges, but 
-0000cf80: 636f 7272 6563 7420 776f 726b 696e 670a  correct working.
-0000cf90: 2020 2020 2020 2020 2020 2020 6e65 6564              need
-0000cfa0: 7320 746f 2062 6520 7465 7374 6564 2069  s to be tested i
-0000cfb0: 6e64 6976 6964 7561 6c6c 792e 0a20 2020  ndividually..   
-0000cfc0: 2020 2020 2057 4152 4e49 4e47 3a20 7365       WARNING: se
-0000cfd0: 7474 696e 6720 6073 746f 706c 6f73 735f  tting `stoploss_
-0000cfe0: 6f6e 5f65 7863 6861 6e67 6560 2074 6f20  on_exchange` to 
-0000cff0: 5472 7565 2077 696c 6c20 4e4f 5420 6175  True will NOT au
-0000d000: 746f 2d65 6e61 626c 6520 7374 6f70 6c6f  to-enable stoplo
-0000d010: 7373 206f 6e20 6578 6368 616e 6765 2e0a  ss on exchange..
-0000d020: 2020 2020 2020 2020 2020 2020 6073 746f              `sto
-0000d030: 706c 6f73 735f 6164 6a75 7374 6020 6d75  ploss_adjust` mu
-0000d040: 7374 2073 7469 6c6c 2062 6520 696d 706c  st still be impl
-0000d050: 656d 656e 7465 6420 666f 7220 7468 6973  emented for this
-0000d060: 2074 6f20 776f 726b 2e0a 2020 2020 2020   to work..      
-0000d070: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-0000d080: 206e 6f74 2073 656c 662e 5f66 745f 6861   not self._ft_ha
-0000d090: 735b 2773 746f 706c 6f73 735f 6f6e 5f65  s['stoploss_on_e
-0000d0a0: 7863 6861 6e67 6527 5d3a 0a20 2020 2020  xchange']:.     
-0000d0b0: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-0000d0c0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-0000d0d0: 6e28 6622 7374 6f70 6c6f 7373 2069 7320  n(f"stoploss is 
-0000d0e0: 6e6f 7420 696d 706c 656d 656e 7465 6420  not implemented 
-0000d0f0: 666f 7220 7b73 656c 662e 6e61 6d65 7d2e  for {self.name}.
-0000d100: 2229 0a0a 2020 2020 2020 2020 7573 6572  ")..        user
-0000d110: 5f6f 7264 6572 5f74 7970 6520 3d20 6f72  _order_type = or
-0000d120: 6465 725f 7479 7065 732e 6765 7428 2773  der_types.get('s
-0000d130: 746f 706c 6f73 7327 2c20 276d 6172 6b65  toploss', 'marke
-0000d140: 7427 290a 2020 2020 2020 2020 6f72 6465  t').        orde
-0000d150: 7274 7970 652c 2075 7365 725f 6f72 6465  rtype, user_orde
-0000d160: 725f 7479 7065 203d 2073 656c 662e 5f67  r_type = self._g
-0000d170: 6574 5f73 746f 705f 6f72 6465 725f 7479  et_stop_order_ty
-0000d180: 7065 2875 7365 725f 6f72 6465 725f 7479  pe(user_order_ty
-0000d190: 7065 290a 2020 2020 2020 2020 726f 756e  pe).        roun
-0000d1a0: 645f 6d6f 6465 203d 2052 4f55 4e44 5f44  d_mode = ROUND_D
-0000d1b0: 4f57 4e20 6966 2073 6964 6520 3d3d 2027  OWN if side == '
-0000d1c0: 6275 7927 2065 6c73 6520 524f 554e 445f  buy' else ROUND_
-0000d1d0: 5550 0a20 2020 2020 2020 2073 746f 705f  UP.        stop_
-0000d1e0: 7072 6963 655f 6e6f 726d 203d 2073 656c  price_norm = sel
-0000d1f0: 662e 7072 6963 655f 746f 5f70 7265 6369  f.price_to_preci
-0000d200: 7369 6f6e 2870 6169 722c 2073 746f 705f  sion(pair, stop_
-0000d210: 7072 6963 652c 2072 6f75 6e64 696e 675f  price, rounding_
-0000d220: 6d6f 6465 3d72 6f75 6e64 5f6d 6f64 6529  mode=round_mode)
-0000d230: 0a20 2020 2020 2020 206c 696d 6974 5f72  .        limit_r
-0000d240: 6174 6520 3d20 4e6f 6e65 0a20 2020 2020  ate = None.     
-0000d250: 2020 2069 6620 7573 6572 5f6f 7264 6572     if user_order
-0000d260: 5f74 7970 6520 3d3d 2027 6c69 6d69 7427  _type == 'limit'
-0000d270: 3a0a 2020 2020 2020 2020 2020 2020 6c69  :.            li
-0000d280: 6d69 745f 7261 7465 203d 2073 656c 662e  mit_rate = self.
-0000d290: 5f67 6574 5f73 746f 705f 6c69 6d69 745f  _get_stop_limit_
-0000d2a0: 7261 7465 2873 746f 705f 7072 6963 652c  rate(stop_price,
-0000d2b0: 206f 7264 6572 5f74 7970 6573 2c20 7369   order_types, si
-0000d2c0: 6465 290a 2020 2020 2020 2020 2020 2020  de).            
-0000d2d0: 6c69 6d69 745f 7261 7465 203d 2073 656c  limit_rate = sel
-0000d2e0: 662e 7072 6963 655f 746f 5f70 7265 6369  f.price_to_preci
-0000d2f0: 7369 6f6e 2870 6169 722c 206c 696d 6974  sion(pair, limit
-0000d300: 5f72 6174 652c 2072 6f75 6e64 696e 675f  _rate, rounding_
-0000d310: 6d6f 6465 3d72 6f75 6e64 5f6d 6f64 6529  mode=round_mode)
-0000d320: 0a0a 2020 2020 2020 2020 6966 2073 656c  ..        if sel
-0000d330: 662e 5f63 6f6e 6669 675b 2764 7279 5f72  f._config['dry_r
-0000d340: 756e 275d 3a0a 2020 2020 2020 2020 2020  un']:.          
-0000d350: 2020 6472 795f 6f72 6465 7220 3d20 7365    dry_order = se
-0000d360: 6c66 2e63 7265 6174 655f 6472 795f 7275  lf.create_dry_ru
-0000d370: 6e5f 6f72 6465 7228 0a20 2020 2020 2020  n_order(.       
-0000d380: 2020 2020 2020 2020 2070 6169 722c 0a20           pair,. 
-0000d390: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-0000d3a0: 7264 6572 7479 7065 2c0a 2020 2020 2020  rdertype,.      
-0000d3b0: 2020 2020 2020 2020 2020 7369 6465 2c0a            side,.
-0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3d0: 616d 6f75 6e74 2c0a 2020 2020 2020 2020  amount,.        
-0000d3e0: 2020 2020 2020 2020 7374 6f70 5f70 7269          stop_pri
-0000d3f0: 6365 5f6e 6f72 6d2c 0a20 2020 2020 2020  ce_norm,.       
-0000d400: 2020 2020 2020 2020 2073 746f 705f 6c6f           stop_lo
-0000d410: 7373 3d54 7275 652c 0a20 2020 2020 2020  ss=True,.       
-0000d420: 2020 2020 2020 2020 206c 6576 6572 6167           leverag
-0000d430: 653d 6c65 7665 7261 6765 2c0a 2020 2020  e=leverage,.    
-0000d440: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000d450: 2020 2020 2020 7265 7475 726e 2064 7279        return dry
-0000d460: 5f6f 7264 6572 0a0a 2020 2020 2020 2020  _order..        
-0000d470: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000d480: 2070 6172 616d 7320 3d20 7365 6c66 2e5f   params = self._
-0000d490: 6765 745f 7374 6f70 5f70 6172 616d 7328  get_stop_params(
-0000d4a0: 7369 6465 3d73 6964 652c 206f 7264 6572  side=side, order
-0000d4b0: 7479 7065 3d6f 7264 6572 7479 7065 2c0a  type=ordertype,.
-0000d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d4e0: 2020 2020 2020 2020 2020 2073 746f 705f             stop_
-0000d4f0: 7072 6963 653d 7374 6f70 5f70 7269 6365  price=stop_price
-0000d500: 5f6e 6f72 6d29 0a20 2020 2020 2020 2020  _norm).         
-0000d510: 2020 2069 6620 7365 6c66 2e74 7261 6469     if self.tradi
-0000d520: 6e67 5f6d 6f64 6520 3d3d 2054 7261 6469  ng_mode == Tradi
-0000d530: 6e67 4d6f 6465 2e46 5554 5552 4553 3a0a  ngMode.FUTURES:.
-0000d540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d550: 7061 7261 6d73 5b27 7265 6475 6365 4f6e  params['reduceOn
-0000d560: 6c79 275d 203d 2054 7275 650a 2020 2020  ly'] = True.    
-0000d570: 2020 2020 2020 2020 2020 2020 6966 2027              if '
-0000d580: 7374 6f70 6c6f 7373 5f70 7269 6365 5f74  stoploss_price_t
-0000d590: 7970 6527 2069 6e20 6f72 6465 725f 7479  ype' in order_ty
-0000d5a0: 7065 7320 616e 6420 2773 746f 705f 7072  pes and 'stop_pr
-0000d5b0: 6963 655f 7479 7065 5f66 6965 6c64 2720  ice_type_field' 
-0000d5c0: 696e 2073 656c 662e 5f66 745f 6861 733a  in self._ft_has:
-0000d5d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d5e0: 2020 2020 2070 7269 6365 5f74 7970 6520       price_type 
-0000d5f0: 3d20 7365 6c66 2e5f 6674 5f68 6173 5b27  = self._ft_has['
-0000d600: 7374 6f70 5f70 7269 6365 5f74 7970 655f  stop_price_type_
-0000d610: 7661 6c75 655f 6d61 7070 696e 6727 5d5b  value_mapping'][
-0000d620: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d630: 2020 2020 2020 2020 206f 7264 6572 5f74           order_t
-0000d640: 7970 6573 2e67 6574 2827 7374 6f70 6c6f  ypes.get('stoplo
-0000d650: 7373 5f70 7269 6365 5f74 7970 6527 2c20  ss_price_type', 
-0000d660: 5072 6963 6554 7970 652e 4c41 5354 295d  PriceType.LAST)]
-0000d670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d680: 2020 2020 2070 6172 616d 735b 7365 6c66       params[self
-0000d690: 2e5f 6674 5f68 6173 5b27 7374 6f70 5f70  ._ft_has['stop_p
-0000d6a0: 7269 6365 5f74 7970 655f 6669 656c 6427  rice_type_field'
-0000d6b0: 5d5d 203d 2070 7269 6365 5f74 7970 650a  ]] = price_type.
-0000d6c0: 0a20 2020 2020 2020 2020 2020 2061 6d6f  .            amo
-0000d6d0: 756e 7420 3d20 7365 6c66 2e61 6d6f 756e  unt = self.amoun
-0000d6e0: 745f 746f 5f70 7265 6369 7369 6f6e 2870  t_to_precision(p
-0000d6f0: 6169 722c 2073 656c 662e 5f61 6d6f 756e  air, self._amoun
-0000d700: 745f 746f 5f63 6f6e 7472 6163 7473 2870  t_to_contracts(p
-0000d710: 6169 722c 2061 6d6f 756e 7429 290a 0a20  air, amount)).. 
-0000d720: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000d730: 5f6c 6576 5f70 7265 7028 7061 6972 2c20  _lev_prep(pair, 
-0000d740: 6c65 7665 7261 6765 2c20 7369 6465 2c20  leverage, side, 
-0000d750: 6163 6365 7074 5f66 6169 6c3d 5472 7565  accept_fail=True
-0000d760: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
-0000d770: 6465 7220 3d20 7365 6c66 2e5f 6170 692e  der = self._api.
-0000d780: 6372 6561 7465 5f6f 7264 6572 2873 796d  create_order(sym
-0000d790: 626f 6c3d 7061 6972 2c20 7479 7065 3d6f  bol=pair, type=o
-0000d7a0: 7264 6572 7479 7065 2c20 7369 6465 3d73  rdertype, side=s
-0000d7b0: 6964 652c 0a20 2020 2020 2020 2020 2020  ide,.           
-0000d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7e0: 616d 6f75 6e74 3d61 6d6f 756e 742c 2070  amount=amount, p
-0000d7f0: 7269 6365 3d6c 696d 6974 5f72 6174 652c  rice=limit_rate,
-0000d800: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
-0000d810: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000d820: 2e5f 6c6f 675f 6578 6368 616e 6765 5f72  ._log_exchange_r
-0000d830: 6573 706f 6e73 6528 2763 7265 6174 655f  esponse('create_
-0000d840: 7374 6f70 6c6f 7373 5f6f 7264 6572 272c  stoploss_order',
-0000d850: 206f 7264 6572 290a 2020 2020 2020 2020   order).        
-0000d860: 2020 2020 6f72 6465 7220 3d20 7365 6c66      order = self
-0000d870: 2e5f 6f72 6465 725f 636f 6e74 7261 6374  ._order_contract
-0000d880: 735f 746f 5f61 6d6f 756e 7428 6f72 6465  s_to_amount(orde
-0000d890: 7229 0a20 2020 2020 2020 2020 2020 206c  r).            l
-0000d8a0: 6f67 6765 722e 696e 666f 2866 2273 746f  ogger.info(f"sto
-0000d8b0: 706c 6f73 7320 7b75 7365 725f 6f72 6465  ploss {user_orde
-0000d8c0: 725f 7479 7065 7d20 6f72 6465 7220 6164  r_type} order ad
-0000d8d0: 6465 6420 666f 7220 7b70 6169 727d 2e20  ded for {pair}. 
-0000d8e0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000d8f0: 2020 2020 2020 2020 2020 6622 7374 6f70            f"stop
-0000d900: 2070 7269 6365 3a20 7b73 746f 705f 7072   price: {stop_pr
-0000d910: 6963 657d 2e20 6c69 6d69 743a 207b 6c69  ice}. limit: {li
-0000d920: 6d69 745f 7261 7465 7d22 290a 2020 2020  mit_rate}").    
-0000d930: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0000d940: 7264 6572 0a20 2020 2020 2020 2065 7863  rder.        exc
-0000d950: 6570 7420 6363 7874 2e49 6e73 7566 6669  ept ccxt.Insuffi
-0000d960: 6369 656e 7446 756e 6473 2061 7320 653a  cientFunds as e:
-0000d970: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000d980: 7365 2049 6e73 7566 6669 6369 656e 7446  se InsufficientF
-0000d990: 756e 6473 4572 726f 7228 0a20 2020 2020  undsError(.     
-0000d9a0: 2020 2020 2020 2020 2020 2066 2749 6e73             f'Ins
-0000d9b0: 7566 6669 6369 656e 7420 6675 6e64 7320  ufficient funds 
-0000d9c0: 746f 2063 7265 6174 6520 7b6f 7264 6572  to create {order
-0000d9d0: 7479 7065 7d20 7b73 6964 657d 206f 7264  type} {side} ord
-0000d9e0: 6572 206f 6e20 6d61 726b 6574 207b 7061  er on market {pa
-0000d9f0: 6972 7d2e 2027 0a20 2020 2020 2020 2020  ir}. '.         
-0000da00: 2020 2020 2020 2066 2754 7269 6564 2074         f'Tried t
-0000da10: 6f20 7b73 6964 657d 2061 6d6f 756e 7420  o {side} amount 
-0000da20: 7b61 6d6f 756e 747d 2061 7420 7261 7465  {amount} at rate
-0000da30: 207b 6c69 6d69 745f 7261 7465 7d20 7769   {limit_rate} wi
-0000da40: 7468 2027 0a20 2020 2020 2020 2020 2020  th '.           
-0000da50: 2020 2020 2066 2773 746f 702d 7072 6963       f'stop-pric
-0000da60: 6520 7b73 746f 705f 7072 6963 655f 6e6f  e {stop_price_no
-0000da70: 726d 7d2e 204d 6573 7361 6765 3a20 7b65  rm}. Message: {e
-0000da80: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
-0000da90: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
-0000daa0: 496e 7661 6c69 644f 7264 6572 2c20 6363  InvalidOrder, cc
-0000dab0: 7874 2e42 6164 5265 7175 6573 742c 2063  xt.BadRequest, c
-0000dac0: 6378 742e 4f70 6572 6174 696f 6e52 656a  cxt.OperationRej
-0000dad0: 6563 7465 6429 2061 7320 653a 0a20 2020  ected) as e:.   
-0000dae0: 2020 2020 2020 2020 2023 2045 7272 6f72           # Error
-0000daf0: 733a 0a20 2020 2020 2020 2020 2020 2023  s:.            #
-0000db00: 2060 4f72 6465 7220 776f 756c 6420 7472   `Order would tr
-0000db10: 6967 6765 7220 696d 6d65 6469 6174 656c  igger immediatel
-0000db20: 792e 600a 2020 2020 2020 2020 2020 2020  y.`.            
-0000db30: 7261 6973 6520 496e 7661 6c69 644f 7264  raise InvalidOrd
-0000db40: 6572 4578 6365 7074 696f 6e28 0a20 2020  erException(.   
-0000db50: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
-0000db60: 6f75 6c64 206e 6f74 2063 7265 6174 6520  ould not create 
-0000db70: 7b6f 7264 6572 7479 7065 7d20 7b73 6964  {ordertype} {sid
-0000db80: 657d 206f 7264 6572 206f 6e20 6d61 726b  e} order on mark
-0000db90: 6574 207b 7061 6972 7d2e 2027 0a20 2020  et {pair}. '.   
-0000dba0: 2020 2020 2020 2020 2020 2020 2066 2754               f'T
-0000dbb0: 7269 6564 2074 6f20 7b73 6964 657d 2061  ried to {side} a
-0000dbc0: 6d6f 756e 7420 7b61 6d6f 756e 747d 2061  mount {amount} a
-0000dbd0: 7420 7261 7465 207b 6c69 6d69 745f 7261  t rate {limit_ra
-0000dbe0: 7465 7d20 7769 7468 2027 0a20 2020 2020  te} with '.     
-0000dbf0: 2020 2020 2020 2020 2020 2066 2773 746f             f'sto
-0000dc00: 702d 7072 6963 6520 7b73 746f 705f 7072  p-price {stop_pr
-0000dc10: 6963 655f 6e6f 726d 7d2e 204d 6573 7361  ice_norm}. Messa
-0000dc20: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
-0000dc30: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000dc40: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
-0000dc50: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-0000dc60: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
-0000dc70: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
-0000dc80: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
-0000dc90: 6570 7420 2863 6378 742e 4e65 7477 6f72  ept (ccxt.Networ
-0000dca0: 6b45 7272 6f72 2c20 6363 7874 2e45 7863  kError, ccxt.Exc
-0000dcb0: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
-0000dcc0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000dcd0: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
-0000dce0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000dcf0: 2020 2020 6622 436f 756c 6420 6e6f 7420      f"Could not 
-0000dd00: 706c 6163 6520 7374 6f70 6c6f 7373 206f  place stoploss o
-0000dd10: 7264 6572 2064 7565 2074 6f20 7b65 2e5f  rder due to {e._
-0000dd20: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-0000dd30: 5f7d 2e20 220a 2020 2020 2020 2020 2020  _}. ".          
-0000dd40: 2020 2020 2020 6622 4d65 7373 6167 653a        f"Message:
-0000dd50: 207b 657d 2229 2066 726f 6d20 650a 2020   {e}") from e.  
-0000dd60: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000dd70: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-0000dd80: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000dd90: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-0000dda0: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-0000ddb0: 2065 0a0a 2020 2020 6465 6620 6665 7463   e..    def fetc
-0000ddc0: 685f 6f72 6465 725f 656d 756c 6174 6564  h_order_emulated
-0000ddd0: 2873 656c 662c 206f 7264 6572 5f69 643a  (self, order_id:
-0000dde0: 2073 7472 2c20 7061 6972 3a20 7374 722c   str, pair: str,
-0000ddf0: 2070 6172 616d 733a 2044 6963 7429 202d   params: Dict) -
-0000de00: 3e20 4469 6374 3a0a 2020 2020 2020 2020  > Dict:.        
-0000de10: 2222 220a 2020 2020 2020 2020 456d 756c  """.        Emul
-0000de20: 6174 6564 2066 6574 6368 5f6f 7264 6572  ated fetch_order
-0000de30: 2069 6620 7468 6520 6578 6368 616e 6765   if the exchange
-0000de40: 2064 6f65 736e 2774 2073 7570 706f 7274   doesn't support
-0000de50: 2066 6574 6368 5f6f 7264 6572 2c20 6275   fetch_order, bu
-0000de60: 7420 7265 7175 6972 6573 2073 6570 6172  t requires separ
-0000de70: 6174 650a 2020 2020 2020 2020 6361 6c6c  ate.        call
-0000de80: 7320 666f 7220 6f70 656e 2061 6e64 2063  s for open and c
-0000de90: 6c6f 7365 6420 6f72 6465 7273 2e0a 2020  losed orders..  
-0000dea0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000deb0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000dec0: 2020 206f 7264 6572 203d 2073 656c 662e     order = self.
-0000ded0: 5f61 7069 2e66 6574 6368 5f6f 7065 6e5f  _api.fetch_open_
-0000dee0: 6f72 6465 7228 6f72 6465 725f 6964 2c20  order(order_id, 
-0000def0: 7061 6972 2c20 7061 7261 6d73 3d70 6172  pair, params=par
-0000df00: 616d 7329 0a20 2020 2020 2020 2020 2020  ams).           
-0000df10: 2073 656c 662e 5f6c 6f67 5f65 7863 6861   self._log_excha
-0000df20: 6e67 655f 7265 7370 6f6e 7365 2827 6665  nge_response('fe
-0000df30: 7463 685f 6f70 656e 5f6f 7264 6572 272c  tch_open_order',
-0000df40: 206f 7264 6572 290a 2020 2020 2020 2020   order).        
-0000df50: 2020 2020 6f72 6465 7220 3d20 7365 6c66      order = self
-0000df60: 2e5f 6f72 6465 725f 636f 6e74 7261 6374  ._order_contract
-0000df70: 735f 746f 5f61 6d6f 756e 7428 6f72 6465  s_to_amount(orde
-0000df80: 7229 0a20 2020 2020 2020 2020 2020 2072  r).            r
-0000df90: 6574 7572 6e20 6f72 6465 720a 2020 2020  eturn order.    
-0000dfa0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
-0000dfb0: 4f72 6465 724e 6f74 466f 756e 643a 0a20  OrderNotFound:. 
-0000dfc0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000dfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfe0: 6f72 6465 7220 3d20 7365 6c66 2e5f 6170  order = self._ap
-0000dff0: 692e 6665 7463 685f 636c 6f73 6564 5f6f  i.fetch_closed_o
-0000e000: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
-0000e010: 6169 722c 2070 6172 616d 733d 7061 7261  air, params=para
-0000e020: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
-0000e030: 2020 2020 7365 6c66 2e5f 6c6f 675f 6578      self._log_ex
-0000e040: 6368 616e 6765 5f72 6573 706f 6e73 6528  change_response(
-0000e050: 2766 6574 6368 5f63 6c6f 7365 645f 6f72  'fetch_closed_or
-0000e060: 6465 7227 2c20 6f72 6465 7229 0a20 2020  der', order).   
-0000e070: 2020 2020 2020 2020 2020 2020 206f 7264               ord
-0000e080: 6572 203d 2073 656c 662e 5f6f 7264 6572  er = self._order
-0000e090: 5f63 6f6e 7472 6163 7473 5f74 6f5f 616d  _contracts_to_am
-0000e0a0: 6f75 6e74 286f 7264 6572 290a 2020 2020  ount(order).    
-0000e0b0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000e0c0: 726e 206f 7264 6572 0a20 2020 2020 2020  rn order.       
-0000e0d0: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-0000e0e0: 2e4f 7264 6572 4e6f 7446 6f75 6e64 2061  .OrderNotFound a
-0000e0f0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000e100: 2020 2020 2072 6169 7365 2052 6574 7279       raise Retry
-0000e110: 6162 6c65 4f72 6465 7245 7272 6f72 280a  ableOrderError(.
-0000e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e130: 2020 2020 6627 4f72 6465 7220 6e6f 7420      f'Order not 
-0000e140: 666f 756e 6420 2870 6169 723a 207b 7061  found (pair: {pa
-0000e150: 6972 7d20 6964 3a20 7b6f 7264 6572 5f69  ir} id: {order_i
-0000e160: 647d 292e 204d 6573 7361 6765 3a20 7b65  d}). Message: {e
-0000e170: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
-0000e180: 2020 2065 7863 6570 7420 6363 7874 2e49     except ccxt.I
-0000e190: 6e76 616c 6964 4f72 6465 7220 6173 2065  nvalidOrder as e
-0000e1a0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000e1b0: 6973 6520 496e 7661 6c69 644f 7264 6572  ise InvalidOrder
-0000e1c0: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
-0000e1d0: 2020 2020 2020 2020 2020 2066 2754 7269             f'Tri
-0000e1e0: 6564 2074 6f20 6765 7420 616e 2069 6e76  ed to get an inv
-0000e1f0: 616c 6964 206f 7264 6572 2028 7061 6972  alid order (pair
-0000e200: 3a20 7b70 6169 727d 2069 643a 207b 6f72  : {pair} id: {or
-0000e210: 6465 725f 6964 7d29 2e20 4d65 7373 6167  der_id}). Messag
-0000e220: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-0000e230: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-0000e240: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
-0000e250: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-0000e260: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
-0000e270: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
-0000e280: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0000e290: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
-0000e2a0: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
-0000e2b0: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
-0000e2c0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000e2d0: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
-0000e2e0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0000e2f0: 2020 2066 2743 6f75 6c64 206e 6f74 2067     f'Could not g
-0000e300: 6574 206f 7264 6572 2064 7565 2074 6f20  et order due to 
-0000e310: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-0000e320: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-0000e330: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-0000e340: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000e350: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-0000e360: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000e370: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-0000e380: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-0000e390: 2065 0a0a 2020 2020 4072 6574 7269 6572   e..    @retrier
-0000e3a0: 2872 6574 7269 6573 3d41 5049 5f46 4554  (retries=API_FET
-0000e3b0: 4348 5f4f 5244 4552 5f52 4554 5259 5f43  CH_ORDER_RETRY_C
-0000e3c0: 4f55 4e54 290a 2020 2020 6465 6620 6665  OUNT).    def fe
-0000e3d0: 7463 685f 6f72 6465 7228 7365 6c66 2c20  tch_order(self, 
-0000e3e0: 6f72 6465 725f 6964 3a20 7374 722c 2070  order_id: str, p
-0000e3f0: 6169 723a 2073 7472 2c20 7061 7261 6d73  air: str, params
-0000e400: 3a20 4469 6374 203d 207b 7d29 202d 3e20  : Dict = {}) -> 
-0000e410: 4469 6374 3a0a 2020 2020 2020 2020 6966  Dict:.        if
-0000e420: 2073 656c 662e 5f63 6f6e 6669 675b 2764   self._config['d
-0000e430: 7279 5f72 756e 275d 3a0a 2020 2020 2020  ry_run']:.      
-0000e440: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000e450: 662e 6665 7463 685f 6472 795f 7275 6e5f  f.fetch_dry_run_
-0000e460: 6f72 6465 7228 6f72 6465 725f 6964 290a  order(order_id).
-0000e470: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000e480: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-0000e490: 7365 6c66 2e65 7863 6861 6e67 655f 6861  self.exchange_ha
-0000e4a0: 7328 2766 6574 6368 4f72 6465 7227 293a  s('fetchOrder'):
-0000e4b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e4c0: 2072 6574 7572 6e20 7365 6c66 2e66 6574   return self.fet
-0000e4d0: 6368 5f6f 7264 6572 5f65 6d75 6c61 7465  ch_order_emulate
-0000e4e0: 6428 6f72 6465 725f 6964 2c20 7061 6972  d(order_id, pair
-0000e4f0: 2c20 7061 7261 6d73 290a 2020 2020 2020  , params).      
-0000e500: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
-0000e510: 6c66 2e5f 6170 692e 6665 7463 685f 6f72  lf._api.fetch_or
-0000e520: 6465 7228 6f72 6465 725f 6964 2c20 7061  der(order_id, pa
-0000e530: 6972 2c20 7061 7261 6d73 3d70 6172 616d  ir, params=param
-0000e540: 7329 0a20 2020 2020 2020 2020 2020 2073  s).            s
-0000e550: 656c 662e 5f6c 6f67 5f65 7863 6861 6e67  elf._log_exchang
-0000e560: 655f 7265 7370 6f6e 7365 2827 6665 7463  e_response('fetc
-0000e570: 685f 6f72 6465 7227 2c20 6f72 6465 7229  h_order', order)
-0000e580: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-0000e590: 6572 203d 2073 656c 662e 5f6f 7264 6572  er = self._order
-0000e5a0: 5f63 6f6e 7472 6163 7473 5f74 6f5f 616d  _contracts_to_am
-0000e5b0: 6f75 6e74 286f 7264 6572 290a 2020 2020  ount(order).    
-0000e5c0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0000e5d0: 7264 6572 0a20 2020 2020 2020 2065 7863  rder.        exc
-0000e5e0: 6570 7420 6363 7874 2e4f 7264 6572 4e6f  ept ccxt.OrderNo
-0000e5f0: 7446 6f75 6e64 2061 7320 653a 0a20 2020  tFound as e:.   
-0000e600: 2020 2020 2020 2020 2072 6169 7365 2052           raise R
-0000e610: 6574 7279 6162 6c65 4f72 6465 7245 7272  etryableOrderErr
-0000e620: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000e630: 2020 2020 6627 4f72 6465 7220 6e6f 7420      f'Order not 
-0000e640: 666f 756e 6420 2870 6169 723a 207b 7061  found (pair: {pa
-0000e650: 6972 7d20 6964 3a20 7b6f 7264 6572 5f69  ir} id: {order_i
-0000e660: 647d 292e 204d 6573 7361 6765 3a20 7b65  d}). Message: {e
-0000e670: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
-0000e680: 2020 2065 7863 6570 7420 6363 7874 2e49     except ccxt.I
-0000e690: 6e76 616c 6964 4f72 6465 7220 6173 2065  nvalidOrder as e
-0000e6a0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000e6b0: 6973 6520 496e 7661 6c69 644f 7264 6572  ise InvalidOrder
-0000e6c0: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
-0000e6d0: 2020 2020 2020 2020 2020 2066 2754 7269             f'Tri
-0000e6e0: 6564 2074 6f20 6765 7420 616e 2069 6e76  ed to get an inv
-0000e6f0: 616c 6964 206f 7264 6572 2028 7061 6972  alid order (pair
-0000e700: 3a20 7b70 6169 727d 2069 643a 207b 6f72  : {pair} id: {or
-0000e710: 6465 725f 6964 7d29 2e20 4d65 7373 6167  der_id}). Messag
-0000e720: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-0000e730: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-0000e740: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
-0000e750: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
-0000e760: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
-0000e770: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
-0000e780: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-0000e790: 7074 2028 6363 7874 2e4e 6574 776f 726b  pt (ccxt.Network
-0000e7a0: 4572 726f 722c 2063 6378 742e 4578 6368  Error, ccxt.Exch
-0000e7b0: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
-0000e7c0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0000e7d0: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
-0000e7e0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0000e7f0: 2020 2066 2743 6f75 6c64 206e 6f74 2067     f'Could not g
-0000e800: 6574 206f 7264 6572 2064 7565 2074 6f20  et order due to 
-0000e810: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-0000e820: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-0000e830: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-0000e840: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-0000e850: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-0000e860: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-0000e870: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-0000e880: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-0000e890: 2065 0a0a 2020 2020 6465 6620 6665 7463   e..    def fetc
-0000e8a0: 685f 7374 6f70 6c6f 7373 5f6f 7264 6572  h_stoploss_order
-0000e8b0: 2873 656c 662c 206f 7264 6572 5f69 643a  (self, order_id:
-0000e8c0: 2073 7472 2c20 7061 6972 3a20 7374 722c   str, pair: str,
-0000e8d0: 2070 6172 616d 733a 2044 6963 7420 3d20   params: Dict = 
-0000e8e0: 7b7d 2920 2d3e 2044 6963 743a 0a20 2020  {}) -> Dict:.   
-0000e8f0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000e900: 2e66 6574 6368 5f6f 7264 6572 286f 7264  .fetch_order(ord
-0000e910: 6572 5f69 642c 2070 6169 722c 2070 6172  er_id, pair, par
-0000e920: 616d 7329 0a0a 2020 2020 6465 6620 6665  ams)..    def fe
-0000e930: 7463 685f 6f72 6465 725f 6f72 5f73 746f  tch_order_or_sto
-0000e940: 706c 6f73 735f 6f72 6465 7228 7365 6c66  ploss_order(self
-0000e950: 2c20 6f72 6465 725f 6964 3a20 7374 722c  , order_id: str,
-0000e960: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
-0000e970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e990: 2020 7374 6f70 6c6f 7373 5f6f 7264 6572    stoploss_order
-0000e9a0: 3a20 626f 6f6c 203d 2046 616c 7365 2920  : bool = False) 
-0000e9b0: 2d3e 2044 6963 743a 0a20 2020 2020 2020  -> Dict:.       
-0000e9c0: 2022 2222 0a20 2020 2020 2020 2053 696d   """.        Sim
-0000e9d0: 706c 6520 7772 6170 7065 7220 6361 6c6c  ple wrapper call
-0000e9e0: 696e 6720 6569 7468 6572 2066 6574 6368  ing either fetch
-0000e9f0: 5f6f 7264 6572 206f 7220 6665 7463 685f  _order or fetch_
-0000ea00: 7374 6f70 6c6f 7373 5f6f 7264 6572 2064  stoploss_order d
-0000ea10: 6570 656e 6469 6e67 206f 6e0a 2020 2020  epending on.    
-0000ea20: 2020 2020 7468 6520 7374 6f70 6c6f 7373      the stoploss
-0000ea30: 5f6f 7264 6572 2070 6172 616d 6574 6572  _order parameter
-0000ea40: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000ea50: 6f72 6465 725f 6964 3a20 4f72 6465 7249  order_id: OrderI
-0000ea60: 6420 746f 2066 6574 6368 206f 7264 6572  d to fetch order
-0000ea70: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000ea80: 7061 6972 3a20 5061 6972 2063 6f72 7265  pair: Pair corre
-0000ea90: 7370 6f6e 6469 6e67 2074 6f20 6f72 6465  sponding to orde
-0000eaa0: 725f 6964 0a20 2020 2020 2020 203a 7061  r_id.        :pa
-0000eab0: 7261 6d20 7374 6f70 6c6f 7373 5f6f 7264  ram stoploss_ord
-0000eac0: 6572 3a20 4966 2074 7275 652c 2075 7365  er: If true, use
-0000ead0: 7320 6665 7463 685f 7374 6f70 6c6f 7373  s fetch_stoploss
-0000eae0: 5f6f 7264 6572 2c20 6f74 6865 7277 6973  _order, otherwis
-0000eaf0: 6520 6665 7463 685f 6f72 6465 722e 0a20  e fetch_order.. 
-0000eb00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000eb10: 2020 2069 6620 7374 6f70 6c6f 7373 5f6f     if stoploss_o
-0000eb20: 7264 6572 3a0a 2020 2020 2020 2020 2020  rder:.          
-0000eb30: 2020 7265 7475 726e 2073 656c 662e 6665    return self.fe
-0000eb40: 7463 685f 7374 6f70 6c6f 7373 5f6f 7264  tch_stoploss_ord
-0000eb50: 6572 286f 7264 6572 5f69 642c 2070 6169  er(order_id, pai
-0000eb60: 7229 0a20 2020 2020 2020 2072 6574 7572  r).        retur
-0000eb70: 6e20 7365 6c66 2e66 6574 6368 5f6f 7264  n self.fetch_ord
-0000eb80: 6572 286f 7264 6572 5f69 642c 2070 6169  er(order_id, pai
-0000eb90: 7229 0a0a 2020 2020 6465 6620 6368 6563  r)..    def chec
-0000eba0: 6b5f 6f72 6465 725f 6361 6e63 656c 6564  k_order_canceled
-0000ebb0: 5f65 6d70 7479 2873 656c 662c 206f 7264  _empty(self, ord
-0000ebc0: 6572 3a20 4469 6374 2920 2d3e 2062 6f6f  er: Dict) -> boo
-0000ebd0: 6c3a 0a20 2020 2020 2020 2022 2222 0a20  l:.        """. 
-0000ebe0: 2020 2020 2020 2056 6572 6966 7920 6966         Verify if
-0000ebf0: 2061 6e20 6f72 6465 7220 6861 7320 6265   an order has be
-0000ec00: 656e 2063 616e 6365 6c6c 6564 2077 6974  en cancelled wit
-0000ec10: 686f 7574 2062 6569 6e67 2070 6172 7469  hout being parti
-0000ec20: 616c 6c79 2066 696c 6c65 640a 2020 2020  ally filled.    
-0000ec30: 2020 2020 3a70 6172 616d 206f 7264 6572      :param order
-0000ec40: 3a20 4f72 6465 7220 6469 6374 2061 7320  : Order dict as 
-0000ec50: 7265 7475 726e 6564 2066 726f 6d20 6665  returned from fe
-0000ec60: 7463 685f 6f72 6465 7228 290a 2020 2020  tch_order().    
-0000ec70: 2020 2020 3a72 6574 7572 6e3a 2054 7275      :return: Tru
-0000ec80: 6520 6966 206f 7264 6572 2068 6173 2062  e if order has b
-0000ec90: 6565 6e20 6361 6e63 656c 6c65 6420 7769  een cancelled wi
-0000eca0: 7468 6f75 7420 6265 696e 6720 6669 6c6c  thout being fill
-0000ecb0: 6564 2c20 4661 6c73 6520 6f74 6865 7277  ed, False otherw
-0000ecc0: 6973 652e 0a20 2020 2020 2020 2022 2222  ise..        """
-0000ecd0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000ece0: 286f 7264 6572 2e67 6574 2827 7374 6174  (order.get('stat
-0000ecf0: 7573 2729 2069 6e20 4e4f 4e5f 4f50 454e  us') in NON_OPEN
-0000ed00: 5f45 5843 4841 4e47 455f 5354 4154 4553  _EXCHANGE_STATES
-0000ed10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ed20: 2061 6e64 206f 7264 6572 2e67 6574 2827   and order.get('
-0000ed30: 6669 6c6c 6564 2729 203d 3d20 302e 3029  filled') == 0.0)
-0000ed40: 0a0a 2020 2020 4072 6574 7269 6572 0a20  ..    @retrier. 
-0000ed50: 2020 2064 6566 2063 616e 6365 6c5f 6f72     def cancel_or
-0000ed60: 6465 7228 7365 6c66 2c20 6f72 6465 725f  der(self, order_
-0000ed70: 6964 3a20 7374 722c 2070 6169 723a 2073  id: str, pair: s
-0000ed80: 7472 2c20 7061 7261 6d73 3a20 4469 6374  tr, params: Dict
-0000ed90: 203d 207b 7d29 202d 3e20 4469 6374 3a0a   = {}) -> Dict:.
-0000eda0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000edb0: 5f63 6f6e 6669 675b 2764 7279 5f72 756e  _config['dry_run
-0000edc0: 275d 3a0a 2020 2020 2020 2020 2020 2020  ']:.            
-0000edd0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0000ede0: 2020 2020 206f 7264 6572 203d 2073 656c       order = sel
-0000edf0: 662e 6665 7463 685f 6472 795f 7275 6e5f  f.fetch_dry_run_
-0000ee00: 6f72 6465 7228 6f72 6465 725f 6964 290a  order(order_id).
-0000ee10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000ee20: 206f 7264 6572 2e75 7064 6174 6528 7b27   order.update({'
-0000ee30: 7374 6174 7573 273a 2027 6361 6e63 656c  status': 'cancel
-0000ee40: 6564 272c 2027 6669 6c6c 6564 273a 2030  ed', 'filled': 0
-0000ee50: 2e30 2c20 2772 656d 6169 6e69 6e67 273a  .0, 'remaining':
-0000ee60: 206f 7264 6572 5b27 616d 6f75 6e74 275d   order['amount']
-0000ee70: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
-0000ee80: 2020 2072 6574 7572 6e20 6f72 6465 720a     return order.
-0000ee90: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000eea0: 7074 2049 6e76 616c 6964 4f72 6465 7245  pt InvalidOrderE
-0000eeb0: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-0000eec0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000eed0: 207b 7d0a 0a20 2020 2020 2020 2074 7279   {}..        try
-0000eee0: 3a0a 2020 2020 2020 2020 2020 2020 6f72  :.            or
-0000eef0: 6465 7220 3d20 7365 6c66 2e5f 6170 692e  der = self._api.
-0000ef00: 6361 6e63 656c 5f6f 7264 6572 286f 7264  cancel_order(ord
-0000ef10: 6572 5f69 642c 2070 6169 722c 2070 6172  er_id, pair, par
-0000ef20: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
-0000ef30: 2020 2020 2020 2020 7365 6c66 2e5f 6c6f          self._lo
-0000ef40: 675f 6578 6368 616e 6765 5f72 6573 706f  g_exchange_respo
-0000ef50: 6e73 6528 2763 616e 6365 6c5f 6f72 6465  nse('cancel_orde
-0000ef60: 7227 2c20 6f72 6465 7229 0a20 2020 2020  r', order).     
-0000ef70: 2020 2020 2020 206f 7264 6572 203d 2073         order = s
-0000ef80: 656c 662e 5f6f 7264 6572 5f63 6f6e 7472  elf._order_contr
-0000ef90: 6163 7473 5f74 6f5f 616d 6f75 6e74 286f  acts_to_amount(o
-0000efa0: 7264 6572 290a 2020 2020 2020 2020 2020  rder).          
-0000efb0: 2020 7265 7475 726e 206f 7264 6572 0a20    return order. 
-0000efc0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0000efd0: 7874 2e49 6e76 616c 6964 4f72 6465 7220  xt.InvalidOrder 
-0000efe0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000eff0: 2020 7261 6973 6520 496e 7661 6c69 644f    raise InvalidO
-0000f000: 7264 6572 4578 6365 7074 696f 6e28 0a20  rderException(. 
-0000f010: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000f020: 2743 6f75 6c64 206e 6f74 2063 616e 6365  'Could not cance
-0000f030: 6c20 6f72 6465 722e 204d 6573 7361 6765  l order. Message
-0000f040: 3a20 7b65 7d27 2920 6672 6f6d 2065 0a20  : {e}') from e. 
-0000f050: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0000f060: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
-0000f070: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-0000f080: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
-0000f090: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
-0000f0a0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-0000f0b0: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
-0000f0c0: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
-0000f0d0: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
-0000f0e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f0f0: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
-0000f100: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000f110: 2020 6627 436f 756c 6420 6e6f 7420 6361    f'Could not ca
-0000f120: 6e63 656c 206f 7264 6572 2064 7565 2074  ncel order due t
-0000f130: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
-0000f140: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
-0000f150: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-0000f160: 2020 2020 2020 2020 6578 6365 7074 2063          except c
-0000f170: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
-0000f180: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-0000f190: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-0000f1a0: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
-0000f1b0: 6f6d 2065 0a0a 2020 2020 6465 6620 6361  om e..    def ca
-0000f1c0: 6e63 656c 5f73 746f 706c 6f73 735f 6f72  ncel_stoploss_or
-0000f1d0: 6465 7228 7365 6c66 2c20 6f72 6465 725f  der(self, order_
-0000f1e0: 6964 3a20 7374 722c 2070 6169 723a 2073  id: str, pair: s
-0000f1f0: 7472 2c20 7061 7261 6d73 3a20 4469 6374  tr, params: Dict
-0000f200: 203d 207b 7d29 202d 3e20 4469 6374 3a0a   = {}) -> Dict:.
-0000f210: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000f220: 656c 662e 6361 6e63 656c 5f6f 7264 6572  elf.cancel_order
-0000f230: 286f 7264 6572 5f69 642c 2070 6169 722c  (order_id, pair,
-0000f240: 2070 6172 616d 7329 0a0a 2020 2020 6465   params)..    de
-0000f250: 6620 6973 5f63 616e 6365 6c5f 6f72 6465  f is_cancel_orde
-0000f260: 725f 7265 7375 6c74 5f73 7569 7461 626c  r_result_suitabl
-0000f270: 6528 7365 6c66 2c20 636f 7264 6572 2920  e(self, corder) 
-0000f280: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-0000f290: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
-0000f2a0: 6365 2863 6f72 6465 722c 2064 6963 7429  ce(corder, dict)
-0000f2b0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000f2c0: 7475 726e 2046 616c 7365 0a0a 2020 2020  turn False..    
-0000f2d0: 2020 2020 7265 7175 6972 6564 203d 2028      required = (
-0000f2e0: 2766 6565 272c 2027 7374 6174 7573 272c  'fee', 'status',
-0000f2f0: 2027 616d 6f75 6e74 2729 0a20 2020 2020   'amount').     
-0000f300: 2020 2072 6574 7572 6e20 616c 6c28 636f     return all(co
-0000f310: 7264 6572 2e67 6574 286b 2c20 4e6f 6e65  rder.get(k, None
-0000f320: 2920 6973 206e 6f74 204e 6f6e 6520 666f  ) is not None fo
-0000f330: 7220 6b20 696e 2072 6571 7569 7265 6429  r k in required)
-0000f340: 0a0a 2020 2020 6465 6620 6361 6e63 656c  ..    def cancel
-0000f350: 5f6f 7264 6572 5f77 6974 685f 7265 7375  _order_with_resu
-0000f360: 6c74 2873 656c 662c 206f 7264 6572 5f69  lt(self, order_i
-0000f370: 643a 2073 7472 2c20 7061 6972 3a20 7374  d: str, pair: st
-0000f380: 722c 2061 6d6f 756e 743a 2066 6c6f 6174  r, amount: float
-0000f390: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
-0000f3a0: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-0000f3b0: 616e 6365 6c20 6f72 6465 7220 7265 7475  ancel order retu
-0000f3c0: 726e 696e 6720 6120 7265 7375 6c74 2e0a  rning a result..
-0000f3d0: 2020 2020 2020 2020 4372 6561 7465 7320          Creates 
-0000f3e0: 6120 6661 6b65 2072 6573 756c 7420 6966  a fake result if
-0000f3f0: 2063 616e 6365 6c20 6f72 6465 7220 7265   cancel order re
-0000f400: 7475 726e 7320 6120 6e6f 6e2d 7573 6162  turns a non-usab
-0000f410: 6c65 2072 6573 756c 740a 2020 2020 2020  le result.      
-0000f420: 2020 616e 6420 6665 7463 685f 6f72 6465    and fetch_orde
-0000f430: 7220 646f 6573 206e 6f74 2077 6f72 6b20  r does not work 
-0000f440: 2863 6572 7461 696e 2065 7863 6861 6e67  (certain exchang
-0000f450: 6573 2064 6f6e 2774 2072 6574 7572 6e20  es don't return 
-0000f460: 6361 6e63 656c 6c65 6420 6f72 6465 7273  cancelled orders
-0000f470: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
-0000f480: 206f 7264 6572 5f69 643a 204f 7264 6572   order_id: Order
-0000f490: 6964 2074 6f20 6361 6e63 656c 0a20 2020  id to cancel.   
-0000f4a0: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
-0000f4b0: 3a20 5061 6972 2063 6f72 7265 7370 6f6e  : Pair correspon
-0000f4c0: 6469 6e67 2074 6f20 6f72 6465 725f 6964  ding to order_id
-0000f4d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000f4e0: 616d 6f75 6e74 3a20 416d 6f75 6e74 2074  amount: Amount t
-0000f4f0: 6f20 7573 6520 666f 7220 6661 6b65 2072  o use for fake r
-0000f500: 6573 706f 6e73 650a 2020 2020 2020 2020  esponse.        
-0000f510: 3a72 6574 7572 6e3a 2052 6573 756c 7420  :return: Result 
-0000f520: 6672 6f6d 2065 6974 6865 7220 6361 6e63  from either canc
-0000f530: 656c 5f6f 7264 6572 2069 6620 7573 6162  el_order if usab
-0000f540: 6c65 2c20 6f72 2066 6574 6368 5f6f 7264  le, or fetch_ord
-0000f550: 6572 0a20 2020 2020 2020 2022 2222 0a20  er.        """. 
-0000f560: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000f570: 2020 2020 2020 2020 636f 7264 6572 203d          corder =
-0000f580: 2073 656c 662e 6361 6e63 656c 5f6f 7264   self.cancel_ord
-0000f590: 6572 286f 7264 6572 5f69 642c 2070 6169  er(order_id, pai
-0000f5a0: 7229 0a20 2020 2020 2020 2020 2020 2069  r).            i
-0000f5b0: 6620 7365 6c66 2e69 735f 6361 6e63 656c  f self.is_cancel
-0000f5c0: 5f6f 7264 6572 5f72 6573 756c 745f 7375  _order_result_su
-0000f5d0: 6974 6162 6c65 2863 6f72 6465 7229 3a0a  itable(corder):.
-0000f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f5f0: 7265 7475 726e 2063 6f72 6465 720a 2020  return corder.  
-0000f600: 2020 2020 2020 6578 6365 7074 2049 6e76        except Inv
-0000f610: 616c 6964 4f72 6465 7245 7863 6570 7469  alidOrderExcepti
-0000f620: 6f6e 3a0a 2020 2020 2020 2020 2020 2020  on:.            
-0000f630: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
-0000f640: 2243 6f75 6c64 206e 6f74 2063 616e 6365  "Could not cance
-0000f650: 6c20 6f72 6465 7220 7b6f 7264 6572 5f69  l order {order_i
-0000f660: 647d 2066 6f72 207b 7061 6972 7d2e 2229  d} for {pair}.")
-0000f670: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000f680: 2020 2020 2020 2020 2020 6f72 6465 7220            order 
-0000f690: 3d20 7365 6c66 2e66 6574 6368 5f6f 7264  = self.fetch_ord
-0000f6a0: 6572 286f 7264 6572 5f69 642c 2070 6169  er(order_id, pai
-0000f6b0: 7229 0a20 2020 2020 2020 2065 7863 6570  r).        excep
-0000f6c0: 7420 496e 7661 6c69 644f 7264 6572 4578  t InvalidOrderEx
-0000f6d0: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-0000f6e0: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
-0000f6f0: 696e 6728 6622 436f 756c 6420 6e6f 7420  ing(f"Could not 
-0000f700: 6665 7463 6820 6361 6e63 656c 6c65 6420  fetch cancelled 
-0000f710: 6f72 6465 7220 7b6f 7264 6572 5f69 647d  order {order_id}
-0000f720: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0000f730: 6f72 6465 7220 3d20 7b0a 2020 2020 2020  order = {.      
-0000f740: 2020 2020 2020 2020 2020 2769 6427 3a20            'id': 
-0000f750: 6f72 6465 725f 6964 2c0a 2020 2020 2020  order_id,.      
-0000f760: 2020 2020 2020 2020 2020 2773 7461 7475            'statu
-0000f770: 7327 3a20 2763 616e 6365 6c65 6427 2c0a  s': 'canceled',.
-0000f780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f790: 2761 6d6f 756e 7427 3a20 616d 6f75 6e74  'amount': amount
-0000f7a0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f7b0: 2020 2766 696c 6c65 6427 3a20 302e 302c    'filled': 0.0,
-0000f7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000f7d0: 2027 6665 6527 3a20 7b7d 2c0a 2020 2020   'fee': {},.    
-0000f7e0: 2020 2020 2020 2020 2020 2020 2769 6e66              'inf
-0000f7f0: 6f27 3a20 7b7d 0a20 2020 2020 2020 2020  o': {}.         
-0000f800: 2020 207d 0a0a 2020 2020 2020 2020 7265     }..        re
-0000f810: 7475 726e 206f 7264 6572 0a0a 2020 2020  turn order..    
-0000f820: 6465 6620 6361 6e63 656c 5f73 746f 706c  def cancel_stopl
-0000f830: 6f73 735f 6f72 6465 725f 7769 7468 5f72  oss_order_with_r
-0000f840: 6573 756c 7428 7365 6c66 2c20 6f72 6465  esult(self, orde
-0000f850: 725f 6964 3a20 7374 722c 2070 6169 723a  r_id: str, pair:
-0000f860: 2073 7472 2c20 616d 6f75 6e74 3a20 666c   str, amount: fl
-0000f870: 6f61 7429 202d 3e20 4469 6374 3a0a 2020  oat) -> Dict:.  
-0000f880: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000f890: 2020 4361 6e63 656c 2073 746f 706c 6f73    Cancel stoplos
-0000f8a0: 7320 6f72 6465 7220 7265 7475 726e 696e  s order returnin
-0000f8b0: 6720 6120 7265 7375 6c74 2e0a 2020 2020  g a result..    
-0000f8c0: 2020 2020 4372 6561 7465 7320 6120 6661      Creates a fa
-0000f8d0: 6b65 2072 6573 756c 7420 6966 2063 616e  ke result if can
-0000f8e0: 6365 6c20 6f72 6465 7220 7265 7475 726e  cel order return
-0000f8f0: 7320 6120 6e6f 6e2d 7573 6162 6c65 2072  s a non-usable r
-0000f900: 6573 756c 740a 2020 2020 2020 2020 616e  esult.        an
-0000f910: 6420 6665 7463 685f 6f72 6465 7220 646f  d fetch_order do
-0000f920: 6573 206e 6f74 2077 6f72 6b20 2863 6572  es not work (cer
-0000f930: 7461 696e 2065 7863 6861 6e67 6573 2064  tain exchanges d
-0000f940: 6f6e 2774 2072 6574 7572 6e20 6361 6e63  on't return canc
-0000f950: 656c 6c65 6420 6f72 6465 7273 290a 2020  elled orders).  
-0000f960: 2020 2020 2020 3a70 6172 616d 206f 7264        :param ord
-0000f970: 6572 5f69 643a 2073 746f 706c 6f73 732d  er_id: stoploss-
-0000f980: 6f72 6465 722d 6964 2074 6f20 6361 6e63  order-id to canc
-0000f990: 656c 0a20 2020 2020 2020 203a 7061 7261  el.        :para
-0000f9a0: 6d20 7061 6972 3a20 5061 6972 2063 6f72  m pair: Pair cor
-0000f9b0: 7265 7370 6f6e 6469 6e67 2074 6f20 6f72  responding to or
-0000f9c0: 6465 725f 6964 0a20 2020 2020 2020 203a  der_id.        :
-0000f9d0: 7061 7261 6d20 616d 6f75 6e74 3a20 416d  param amount: Am
-0000f9e0: 6f75 6e74 2074 6f20 7573 6520 666f 7220  ount to use for 
-0000f9f0: 6661 6b65 2072 6573 706f 6e73 650a 2020  fake response.  
-0000fa00: 2020 2020 2020 3a72 6574 7572 6e3a 2052        :return: R
-0000fa10: 6573 756c 7420 6672 6f6d 2065 6974 6865  esult from eithe
-0000fa20: 7220 6361 6e63 656c 5f6f 7264 6572 2069  r cancel_order i
-0000fa30: 6620 7573 6162 6c65 2c20 6f72 2066 6574  f usable, or fet
-0000fa40: 6368 5f6f 7264 6572 0a20 2020 2020 2020  ch_order.       
-0000fa50: 2022 2222 0a20 2020 2020 2020 2063 6f72   """.        cor
-0000fa60: 6465 7220 3d20 7365 6c66 2e63 616e 6365  der = self.cance
-0000fa70: 6c5f 7374 6f70 6c6f 7373 5f6f 7264 6572  l_stoploss_order
-0000fa80: 286f 7264 6572 5f69 642c 2070 6169 7229  (order_id, pair)
-0000fa90: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000faa0: 2e69 735f 6361 6e63 656c 5f6f 7264 6572  .is_cancel_order
-0000fab0: 5f72 6573 756c 745f 7375 6974 6162 6c65  _result_suitable
-0000fac0: 2863 6f72 6465 7229 3a0a 2020 2020 2020  (corder):.      
-0000fad0: 2020 2020 2020 7265 7475 726e 2063 6f72        return cor
-0000fae0: 6465 720a 2020 2020 2020 2020 7472 793a  der.        try:
-0000faf0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-0000fb00: 6572 203d 2073 656c 662e 6665 7463 685f  er = self.fetch_
-0000fb10: 7374 6f70 6c6f 7373 5f6f 7264 6572 286f  stoploss_order(o
-0000fb20: 7264 6572 5f69 642c 2070 6169 7229 0a20  rder_id, pair). 
-0000fb30: 2020 2020 2020 2065 7863 6570 7420 496e         except In
-0000fb40: 7661 6c69 644f 7264 6572 4578 6365 7074  validOrderExcept
-0000fb50: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-0000fb60: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-0000fb70: 6622 436f 756c 6420 6e6f 7420 6665 7463  f"Could not fetc
-0000fb80: 6820 6361 6e63 656c 6c65 6420 7374 6f70  h cancelled stop
-0000fb90: 6c6f 7373 206f 7264 6572 207b 6f72 6465  loss order {orde
-0000fba0: 725f 6964 7d2e 2229 0a20 2020 2020 2020  r_id}.").       
-0000fbb0: 2020 2020 206f 7264 6572 203d 207b 2769       order = {'i
-0000fbc0: 6427 3a20 6f72 6465 725f 6964 2c20 2766  d': order_id, 'f
-0000fbd0: 6565 273a 207b 7d2c 2027 7374 6174 7573  ee': {}, 'status
-0000fbe0: 273a 2027 6361 6e63 656c 6564 272c 2027  ': 'canceled', '
-0000fbf0: 616d 6f75 6e74 273a 2061 6d6f 756e 742c  amount': amount,
-0000fc00: 2027 696e 666f 273a 207b 7d7d 0a0a 2020   'info': {}}..  
-0000fc10: 2020 2020 2020 7265 7475 726e 206f 7264        return ord
-0000fc20: 6572 0a0a 2020 2020 4072 6574 7269 6572  er..    @retrier
-0000fc30: 0a20 2020 2064 6566 2067 6574 5f62 616c  .    def get_bal
-0000fc40: 616e 6365 7328 7365 6c66 2920 2d3e 2064  ances(self) -> d
-0000fc50: 6963 743a 0a0a 2020 2020 2020 2020 7472  ict:..        tr
-0000fc60: 793a 0a20 2020 2020 2020 2020 2020 2062  y:.            b
-0000fc70: 616c 616e 6365 7320 3d20 7365 6c66 2e5f  alances = self._
-0000fc80: 6170 692e 6665 7463 685f 6261 6c61 6e63  api.fetch_balanc
-0000fc90: 6528 290a 2020 2020 2020 2020 2020 2020  e().            
-0000fca0: 2320 5265 6d6f 7665 2061 6464 6974 696f  # Remove additio
-0000fcb0: 6e61 6c20 696e 666f 2066 726f 6d20 6363  nal info from cc
-0000fcc0: 7874 2072 6573 756c 7473 0a20 2020 2020  xt results.     
-0000fcd0: 2020 2020 2020 2062 616c 616e 6365 732e         balances.
-0000fce0: 706f 7028 2269 6e66 6f22 2c20 4e6f 6e65  pop("info", None
-0000fcf0: 290a 2020 2020 2020 2020 2020 2020 6261  ).            ba
-0000fd00: 6c61 6e63 6573 2e70 6f70 2822 6672 6565  lances.pop("free
-0000fd10: 222c 204e 6f6e 6529 0a20 2020 2020 2020  ", None).       
-0000fd20: 2020 2020 2062 616c 616e 6365 732e 706f       balances.po
-0000fd30: 7028 2274 6f74 616c 222c 204e 6f6e 6529  p("total", None)
-0000fd40: 0a20 2020 2020 2020 2020 2020 2062 616c  .            bal
-0000fd50: 616e 6365 732e 706f 7028 2275 7365 6422  ances.pop("used"
-0000fd60: 2c20 4e6f 6e65 290a 0a20 2020 2020 2020  , None)..       
-0000fd70: 2020 2020 2072 6574 7572 6e20 6261 6c61       return bala
-0000fd80: 6e63 6573 0a20 2020 2020 2020 2065 7863  nces.        exc
-0000fd90: 6570 7420 6363 7874 2e44 446f 5350 726f  ept ccxt.DDoSPro
-0000fda0: 7465 6374 696f 6e20 6173 2065 3a0a 2020  tection as e:.  
-0000fdb0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000fdc0: 4444 6f73 5072 6f74 6563 7469 6f6e 2865  DDosProtection(e
-0000fdd0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-0000fde0: 2065 7863 6570 7420 2863 6378 742e 4e65   except (ccxt.Ne
-0000fdf0: 7477 6f72 6b45 7272 6f72 2c20 6363 7874  tworkError, ccxt
-0000fe00: 2e45 7863 6861 6e67 6545 7272 6f72 2920  .ExchangeError) 
-0000fe10: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0000fe20: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
-0000fe30: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
-0000fe40: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
-0000fe50: 6e6f 7420 6765 7420 6261 6c61 6e63 6520  not get balance 
-0000fe60: 6475 6520 746f 207b 652e 5f5f 636c 6173  due to {e.__clas
-0000fe70: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d  s__.__name__}. M
-0000fe80: 6573 7361 6765 3a20 7b65 7d27 2920 6672  essage: {e}') fr
-0000fe90: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
-0000fea0: 6570 7420 6363 7874 2e42 6173 6545 7272  ept ccxt.BaseErr
-0000feb0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
-0000fec0: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-0000fed0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-0000fee0: 6529 2066 726f 6d20 650a 0a20 2020 2040  e) from e..    @
-0000fef0: 7265 7472 6965 720a 2020 2020 6465 6620  retrier.    def 
-0000ff00: 6665 7463 685f 706f 7369 7469 6f6e 7328  fetch_positions(
-0000ff10: 7365 6c66 2c20 7061 6972 3a20 4f70 7469  self, pair: Opti
-0000ff20: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
-0000ff30: 2920 2d3e 204c 6973 745b 4469 6374 5d3a  ) -> List[Dict]:
-0000ff40: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0000ff50: 2020 2020 2046 6574 6368 2070 6f73 6974       Fetch posit
-0000ff60: 696f 6e73 2066 726f 6d20 7468 6520 6578  ions from the ex
-0000ff70: 6368 616e 6765 2e0a 2020 2020 2020 2020  change..        
-0000ff80: 4966 206e 6f20 7061 6972 2069 7320 6769  If no pair is gi
-0000ff90: 7665 6e2c 2061 6c6c 2070 6f73 6974 696f  ven, all positio
-0000ffa0: 6e73 2061 7265 2072 6574 7572 6e65 642e  ns are returned.
-0000ffb0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000ffc0: 7061 6972 3a20 5061 6972 2066 6f72 2074  pair: Pair for t
-0000ffd0: 6865 2071 7565 7279 0a20 2020 2020 2020  he query.       
-0000ffe0: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0000fff0: 7365 6c66 2e5f 636f 6e66 6967 5b27 6472  self._config['dr
-00010000: 795f 7275 6e27 5d20 6f72 2073 656c 662e  y_run'] or self.
-00010010: 7472 6164 696e 675f 6d6f 6465 2021 3d20  trading_mode != 
-00010020: 5472 6164 696e 674d 6f64 652e 4655 5455  TradingMode.FUTU
-00010030: 5245 533a 0a20 2020 2020 2020 2020 2020  RES:.           
-00010040: 2072 6574 7572 6e20 5b5d 0a20 2020 2020   return [].     
-00010050: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00010060: 2020 2020 7379 6d62 6f6c 7320 3d20 5b5d      symbols = []
-00010070: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00010080: 7061 6972 3a0a 2020 2020 2020 2020 2020  pair:.          
-00010090: 2020 2020 2020 7379 6d62 6f6c 732e 6170        symbols.ap
-000100a0: 7065 6e64 2870 6169 7229 0a20 2020 2020  pend(pair).     
-000100b0: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
-000100c0: 3a20 4c69 7374 5b44 6963 745d 203d 2073  : List[Dict] = s
-000100d0: 656c 662e 5f61 7069 2e66 6574 6368 5f70  elf._api.fetch_p
-000100e0: 6f73 6974 696f 6e73 2873 796d 626f 6c73  ositions(symbols
-000100f0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00010100: 6c66 2e5f 6c6f 675f 6578 6368 616e 6765  lf._log_exchange
-00010110: 5f72 6573 706f 6e73 6528 2766 6574 6368  _response('fetch
-00010120: 5f70 6f73 6974 696f 6e73 272c 2070 6f73  _positions', pos
-00010130: 6974 696f 6e73 290a 2020 2020 2020 2020  itions).        
-00010140: 2020 2020 7265 7475 726e 2070 6f73 6974      return posit
-00010150: 696f 6e73 0a20 2020 2020 2020 2065 7863  ions.        exc
-00010160: 6570 7420 6363 7874 2e44 446f 5350 726f  ept ccxt.DDoSPro
-00010170: 7465 6374 696f 6e20 6173 2065 3a0a 2020  tection as e:.  
-00010180: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00010190: 4444 6f73 5072 6f74 6563 7469 6f6e 2865  DDosProtection(e
-000101a0: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-000101b0: 2065 7863 6570 7420 2863 6378 742e 4e65   except (ccxt.Ne
-000101c0: 7477 6f72 6b45 7272 6f72 2c20 6363 7874  tworkError, ccxt
-000101d0: 2e45 7863 6861 6e67 6545 7272 6f72 2920  .ExchangeError) 
-000101e0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-000101f0: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
-00010200: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
-00010210: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
-00010220: 6e6f 7420 6765 7420 706f 7369 7469 6f6e  not get position
-00010230: 7320 6475 6520 746f 207b 652e 5f5f 636c  s due to {e.__cl
-00010240: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e  ass__.__name__}.
-00010250: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
-00010260: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-00010270: 7863 6570 7420 6363 7874 2e42 6173 6545  xcept ccxt.BaseE
-00010280: 7272 6f72 2061 7320 653a 0a20 2020 2020  rror as e:.     
-00010290: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-000102a0: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-000102b0: 6e28 6529 2066 726f 6d20 650a 0a20 2020  n(e) from e..   
-000102c0: 2064 6566 205f 6665 7463 685f 6f72 6465   def _fetch_orde
-000102d0: 7273 5f65 6d75 6c61 7465 2873 656c 662c  rs_emulate(self,
-000102e0: 2070 6169 723a 2073 7472 2c20 7369 6e63   pair: str, sinc
-000102f0: 655f 6d73 3a20 696e 7429 202d 3e20 4c69  e_ms: int) -> Li
-00010300: 7374 5b44 6963 745d 3a0a 2020 2020 2020  st[Dict]:.      
-00010310: 2020 6f72 6465 7273 203d 205b 5d0a 2020    orders = [].  
-00010320: 2020 2020 2020 6966 2073 656c 662e 6578        if self.ex
-00010330: 6368 616e 6765 5f68 6173 2827 6665 7463  change_has('fetc
-00010340: 6843 6c6f 7365 644f 7264 6572 7327 293a  hClosedOrders'):
-00010350: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
-00010360: 6572 7320 3d20 7365 6c66 2e5f 6170 692e  ers = self._api.
-00010370: 6665 7463 685f 636c 6f73 6564 5f6f 7264  fetch_closed_ord
-00010380: 6572 7328 7061 6972 2c20 7369 6e63 653d  ers(pair, since=
-00010390: 7369 6e63 655f 6d73 290a 2020 2020 2020  since_ms).      
-000103a0: 2020 2020 2020 6966 2073 656c 662e 6578        if self.ex
-000103b0: 6368 616e 6765 5f68 6173 2827 6665 7463  change_has('fetc
-000103c0: 684f 7065 6e4f 7264 6572 7327 293a 0a20  hOpenOrders'):. 
-000103d0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-000103e0: 7264 6572 735f 6f70 656e 203d 2073 656c  rders_open = sel
-000103f0: 662e 5f61 7069 2e66 6574 6368 5f6f 7065  f._api.fetch_ope
-00010400: 6e5f 6f72 6465 7273 2870 6169 722c 2073  n_orders(pair, s
-00010410: 696e 6365 3d73 696e 6365 5f6d 7329 0a20  ince=since_ms). 
-00010420: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00010430: 7264 6572 732e 6578 7465 6e64 286f 7264  rders.extend(ord
-00010440: 6572 735f 6f70 656e 290a 2020 2020 2020  ers_open).      
-00010450: 2020 7265 7475 726e 206f 7264 6572 730a    return orders.
-00010460: 0a20 2020 2040 7265 7472 6965 7228 7265  .    @retrier(re
-00010470: 7472 6965 733d 3029 0a20 2020 2064 6566  tries=0).    def
-00010480: 2066 6574 6368 5f6f 7264 6572 7328 7365   fetch_orders(se
-00010490: 6c66 2c20 7061 6972 3a20 7374 722c 2073  lf, pair: str, s
-000104a0: 696e 6365 3a20 6461 7465 7469 6d65 2c20  ince: datetime, 
-000104b0: 7061 7261 6d73 3a20 4f70 7469 6f6e 616c  params: Optional
-000104c0: 5b44 6963 745d 203d 204e 6f6e 6529 202d  [Dict] = None) -
-000104d0: 3e20 4c69 7374 5b44 6963 745d 3a0a 2020  > List[Dict]:.  
-000104e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000104f0: 2020 4665 7463 6820 616c 6c20 6f72 6465    Fetch all orde
-00010500: 7273 2066 6f72 2061 2070 6169 7220 2273  rs for a pair "s
-00010510: 696e 6365 220a 2020 2020 2020 2020 3a70  ince".        :p
-00010520: 6172 616d 2070 6169 723a 2050 6169 7220  aram pair: Pair 
-00010530: 666f 7220 7468 6520 7175 6572 790a 2020  for the query.  
-00010540: 2020 2020 2020 3a70 6172 616d 2073 696e        :param sin
-00010550: 6365 3a20 5374 6172 7469 6e67 2074 696d  ce: Starting tim
-00010560: 6520 666f 7220 7468 6520 7175 6572 790a  e for the query.
-00010570: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00010580: 2020 2020 6966 2073 656c 662e 5f63 6f6e      if self._con
-00010590: 6669 675b 2764 7279 5f72 756e 275d 3a0a  fig['dry_run']:.
-000105a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000105b0: 726e 205b 5d0a 0a20 2020 2020 2020 2074  rn []..        t
-000105c0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-000105d0: 7369 6e63 655f 6d73 203d 2069 6e74 2828  since_ms = int((
-000105e0: 7369 6e63 652e 7469 6d65 7374 616d 7028  since.timestamp(
-000105f0: 2920 2d20 3130 2920 2a20 3130 3030 290a  ) - 10) * 1000).
-00010600: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00010610: 7365 6c66 2e65 7863 6861 6e67 655f 6861  self.exchange_ha
-00010620: 7328 2766 6574 6368 4f72 6465 7273 2729  s('fetchOrders')
-00010630: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010640: 2020 6966 206e 6f74 2070 6172 616d 733a    if not params:
-00010650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010660: 2020 2020 2070 6172 616d 7320 3d20 7b7d       params = {}
-00010670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010680: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00010690: 2020 2020 2020 2020 2020 6f72 6465 7273            orders
-000106a0: 3a20 4c69 7374 5b44 6963 745d 203d 2073  : List[Dict] = s
-000106b0: 656c 662e 5f61 7069 2e66 6574 6368 5f6f  elf._api.fetch_o
-000106c0: 7264 6572 7328 7061 6972 2c20 7369 6e63  rders(pair, sinc
-000106d0: 653d 7369 6e63 655f 6d73 2c20 7061 7261  e=since_ms, para
-000106e0: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
-000106f0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00010700: 7420 6363 7874 2e4e 6f74 5375 7070 6f72  t ccxt.NotSuppor
-00010710: 7465 643a 0a20 2020 2020 2020 2020 2020  ted:.           
-00010720: 2020 2020 2020 2020 2023 2053 6f6d 6520           # Some 
-00010730: 6578 6368 616e 6765 7320 646f 6e27 7420  exchanges don't 
-00010740: 7375 7070 6f72 7420 6665 7463 684f 7264  support fetchOrd
-00010750: 6572 730a 2020 2020 2020 2020 2020 2020  ers.            
-00010760: 2020 2020 2020 2020 2320 6174 7465 6d70          # attemp
-00010770: 7420 746f 2066 6574 6368 206f 7065 6e20  t to fetch open 
-00010780: 616e 6420 636c 6f73 6564 206f 7264 6572  and closed order
-00010790: 7320 7365 7061 7261 7465 6c79 0a20 2020  s separately.   
-000107a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000107b0: 206f 7264 6572 7320 3d20 7365 6c66 2e5f   orders = self._
-000107c0: 6665 7463 685f 6f72 6465 7273 5f65 6d75  fetch_orders_emu
-000107d0: 6c61 7465 2870 6169 722c 2073 696e 6365  late(pair, since
-000107e0: 5f6d 7329 0a20 2020 2020 2020 2020 2020  _ms).           
-000107f0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00010800: 2020 2020 2020 206f 7264 6572 7320 3d20         orders = 
-00010810: 7365 6c66 2e5f 6665 7463 685f 6f72 6465  self._fetch_orde
-00010820: 7273 5f65 6d75 6c61 7465 2870 6169 722c  rs_emulate(pair,
-00010830: 2073 696e 6365 5f6d 7329 0a20 2020 2020   since_ms).     
-00010840: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
-00010850: 5f65 7863 6861 6e67 655f 7265 7370 6f6e  _exchange_respon
-00010860: 7365 2827 6665 7463 685f 6f72 6465 7273  se('fetch_orders
-00010870: 272c 206f 7264 6572 7329 0a20 2020 2020  ', orders).     
-00010880: 2020 2020 2020 206f 7264 6572 7320 3d20         orders = 
-00010890: 5b73 656c 662e 5f6f 7264 6572 5f63 6f6e  [self._order_con
-000108a0: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
-000108b0: 286f 2920 666f 7220 6f20 696e 206f 7264  (o) for o in ord
-000108c0: 6572 735d 0a20 2020 2020 2020 2020 2020  ers].           
-000108d0: 2072 6574 7572 6e20 6f72 6465 7273 0a20   return orders. 
-000108e0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-000108f0: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
-00010900: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
-00010910: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
-00010920: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
-00010930: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00010940: 7420 2863 6378 742e 4e65 7477 6f72 6b45  t (ccxt.NetworkE
-00010950: 7272 6f72 2c20 6363 7874 2e45 7863 6861  rror, ccxt.Excha
-00010960: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
-00010970: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00010980: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
-00010990: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000109a0: 2020 6627 436f 756c 6420 6e6f 7420 6665    f'Could not fe
-000109b0: 7463 6820 706f 7369 7469 6f6e 7320 6475  tch positions du
-000109c0: 6520 746f 207b 652e 5f5f 636c 6173 735f  e to {e.__class_
-000109d0: 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d 6573  _.__name__}. Mes
-000109e0: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
-000109f0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-00010a00: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
-00010a10: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00010a20: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-00010a30: 6f6e 616c 4578 6365 7074 696f 6e28 6529  onalException(e)
-00010a40: 2066 726f 6d20 650a 0a20 2020 2040 7265   from e..    @re
-00010a50: 7472 6965 720a 2020 2020 6465 6620 6665  trier.    def fe
-00010a60: 7463 685f 7472 6164 696e 675f 6665 6573  tch_trading_fees
-00010a70: 2873 656c 6629 202d 3e20 4469 6374 5b73  (self) -> Dict[s
-00010a80: 7472 2c20 416e 795d 3a0a 2020 2020 2020  tr, Any]:.      
-00010a90: 2020 2222 220a 2020 2020 2020 2020 4665    """.        Fe
-00010aa0: 7463 6820 7573 6572 2061 6363 6f75 6e74  tch user account
-00010ab0: 2074 7261 6469 6e67 2066 6565 730a 2020   trading fees.  
-00010ac0: 2020 2020 2020 4361 6e20 6265 2063 6163        Can be cac
-00010ad0: 6865 642c 2073 686f 756c 6420 6e6f 7420  hed, should not 
-00010ae0: 7570 6461 7465 206f 6674 656e 2e0a 2020  update often..  
-00010af0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010b00: 2020 6966 2028 7365 6c66 2e5f 636f 6e66    if (self._conf
-00010b10: 6967 5b27 6472 795f 7275 6e27 5d20 6f72  ig['dry_run'] or
-00010b20: 2073 656c 662e 7472 6164 696e 675f 6d6f   self.trading_mo
-00010b30: 6465 2021 3d20 5472 6164 696e 674d 6f64  de != TradingMod
-00010b40: 652e 4655 5455 5245 530a 2020 2020 2020  e.FUTURES.      
-00010b50: 2020 2020 2020 2020 2020 6f72 206e 6f74            or not
-00010b60: 2073 656c 662e 6578 6368 616e 6765 5f68   self.exchange_h
-00010b70: 6173 2827 6665 7463 6854 7261 6469 6e67  as('fetchTrading
-00010b80: 4665 6573 2729 293a 0a20 2020 2020 2020  Fees')):.       
-00010b90: 2020 2020 2072 6574 7572 6e20 7b7d 0a20       return {}. 
-00010ba0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00010bb0: 2020 2020 2020 2020 7472 6164 696e 675f          trading_
-00010bc0: 6665 6573 3a20 4469 6374 5b73 7472 2c20  fees: Dict[str, 
-00010bd0: 416e 795d 203d 2073 656c 662e 5f61 7069  Any] = self._api
-00010be0: 2e66 6574 6368 5f74 7261 6469 6e67 5f66  .fetch_trading_f
-00010bf0: 6565 7328 290a 2020 2020 2020 2020 2020  ees().          
-00010c00: 2020 7365 6c66 2e5f 6c6f 675f 6578 6368    self._log_exch
-00010c10: 616e 6765 5f72 6573 706f 6e73 6528 2766  ange_response('f
-00010c20: 6574 6368 5f74 7261 6469 6e67 5f66 6565  etch_trading_fee
-00010c30: 7327 2c20 7472 6164 696e 675f 6665 6573  s', trading_fees
-00010c40: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00010c50: 7475 726e 2074 7261 6469 6e67 5f66 6565  turn trading_fee
-00010c60: 730a 2020 2020 2020 2020 6578 6365 7074  s.        except
-00010c70: 2063 6378 742e 4444 6f53 5072 6f74 6563   ccxt.DDoSProtec
-00010c80: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-00010c90: 2020 2020 2020 2072 6169 7365 2044 446f         raise DDo
-00010ca0: 7350 726f 7465 6374 696f 6e28 6529 2066  sProtection(e) f
-00010cb0: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
-00010cc0: 6365 7074 2028 6363 7874 2e4e 6574 776f  cept (ccxt.Netwo
-00010cd0: 726b 4572 726f 722c 2063 6378 742e 4578  rkError, ccxt.Ex
-00010ce0: 6368 616e 6765 4572 726f 7229 2061 7320  changeError) as 
-00010cf0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00010d00: 6169 7365 2054 656d 706f 7261 7279 4572  aise TemporaryEr
-00010d10: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00010d20: 2020 2020 2066 2743 6f75 6c64 206e 6f74       f'Could not
-00010d30: 2066 6574 6368 2074 7261 6469 6e67 2066   fetch trading f
-00010d40: 6565 7320 6475 6520 746f 207b 652e 5f5f  ees due to {e.__
-00010d50: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
-00010d60: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
-00010d70: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-00010d80: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
-00010d90: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-00010da0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-00010db0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-00010dc0: 696f 6e28 6529 2066 726f 6d20 650a 0a20  ion(e) from e.. 
-00010dd0: 2020 2040 7265 7472 6965 720a 2020 2020     @retrier.    
-00010de0: 6465 6620 6665 7463 685f 6269 6473 5f61  def fetch_bids_a
-00010df0: 736b 7328 7365 6c66 2c20 7379 6d62 6f6c  sks(self, symbol
-00010e00: 733a 204f 7074 696f 6e61 6c5b 4c69 7374  s: Optional[List
-00010e10: 5b73 7472 5d5d 203d 204e 6f6e 652c 2063  [str]] = None, c
-00010e20: 6163 6865 643a 2062 6f6f 6c20 3d20 4661  ached: bool = Fa
-00010e30: 6c73 6529 202d 3e20 4469 6374 3a0a 2020  lse) -> Dict:.  
-00010e40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010e50: 2020 3a70 6172 616d 2073 796d 626f 6c73    :param symbols
-00010e60: 3a20 4c69 7374 206f 6620 7379 6d62 6f6c  : List of symbol
-00010e70: 7320 746f 2066 6574 6368 0a20 2020 2020  s to fetch.     
-00010e80: 2020 203a 7061 7261 6d20 6361 6368 6564     :param cached
-00010e90: 3a20 416c 6c6f 7720 6361 6368 6564 2072  : Allow cached r
-00010ea0: 6573 756c 740a 2020 2020 2020 2020 3a72  esult.        :r
-00010eb0: 6574 7572 6e3a 2066 6574 6368 5f62 6964  eturn: fetch_bid
-00010ec0: 735f 6173 6b73 2072 6573 756c 740a 2020  s_asks result.  
-00010ed0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00010ee0: 2020 6966 206e 6f74 2073 656c 662e 6578    if not self.ex
-00010ef0: 6368 616e 6765 5f68 6173 2827 6665 7463  change_has('fetc
-00010f00: 6842 6964 7341 736b 7327 293a 0a20 2020  hBidsAsks'):.   
-00010f10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00010f20: 7b7d 0a20 2020 2020 2020 2069 6620 6361  {}.        if ca
-00010f30: 6368 6564 3a0a 2020 2020 2020 2020 2020  ched:.          
-00010f40: 2020 7769 7468 2073 656c 662e 5f63 6163    with self._cac
-00010f50: 6865 5f6c 6f63 6b3a 0a20 2020 2020 2020  he_lock:.       
-00010f60: 2020 2020 2020 2020 2074 6963 6b65 7273           tickers
-00010f70: 203d 2073 656c 662e 5f66 6574 6368 5f74   = self._fetch_t
-00010f80: 6963 6b65 7273 5f63 6163 6865 2e67 6574  ickers_cache.get
-00010f90: 2827 6665 7463 685f 6269 6473 5f61 736b  ('fetch_bids_ask
-00010fa0: 7327 290a 2020 2020 2020 2020 2020 2020  s').            
-00010fb0: 6966 2074 6963 6b65 7273 3a0a 2020 2020  if tickers:.    
-00010fc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00010fd0: 726e 2074 6963 6b65 7273 0a20 2020 2020  rn tickers.     
-00010fe0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00010ff0: 2020 2020 7469 636b 6572 7320 3d20 7365      tickers = se
-00011000: 6c66 2e5f 6170 692e 6665 7463 685f 6269  lf._api.fetch_bi
-00011010: 6473 5f61 736b 7328 7379 6d62 6f6c 7329  ds_asks(symbols)
-00011020: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
-00011030: 6820 7365 6c66 2e5f 6361 6368 655f 6c6f  h self._cache_lo
-00011040: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
-00011050: 2020 2020 7365 6c66 2e5f 6665 7463 685f      self._fetch_
-00011060: 7469 636b 6572 735f 6361 6368 655b 2766  tickers_cache['f
-00011070: 6574 6368 5f62 6964 735f 6173 6b73 275d  etch_bids_asks']
-00011080: 203d 2074 6963 6b65 7273 0a20 2020 2020   = tickers.     
-00011090: 2020 2020 2020 2072 6574 7572 6e20 7469         return ti
-000110a0: 636b 6572 730a 2020 2020 2020 2020 6578  ckers.        ex
-000110b0: 6365 7074 2063 6378 742e 4e6f 7453 7570  cept ccxt.NotSup
-000110c0: 706f 7274 6564 2061 7320 653a 0a20 2020  ported as e:.   
-000110d0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
-000110e0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
-000110f0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-00011100: 2020 2020 2066 2745 7863 6861 6e67 6520       f'Exchange 
-00011110: 7b73 656c 662e 5f61 7069 2e6e 616d 657d  {self._api.name}
-00011120: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
-00011130: 7420 6665 7463 6869 6e67 2062 6964 732f  t fetching bids/
-00011140: 6173 6b73 2069 6e20 6261 7463 682e 2027  asks in batch. '
-00011150: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011160: 2066 274d 6573 7361 6765 3a20 7b65 7d27   f'Message: {e}'
-00011170: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-00011180: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
-00011190: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
-000111a0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000111b0: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
-000111c0: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
-000111d0: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
-000111e0: 742e 4e65 7477 6f72 6b45 7272 6f72 2c20  t.NetworkError, 
-000111f0: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
-00011200: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
-00011210: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
-00011220: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
-00011230: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
-00011240: 756c 6420 6e6f 7420 6c6f 6164 2062 6964  uld not load bid
-00011250: 732f 6173 6b73 2064 7565 2074 6f20 7b65  s/asks due to {e
-00011260: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
-00011270: 655f 5f7d 2e20 4d65 7373 6167 653a 207b  e__}. Message: {
-00011280: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
-00011290: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
-000112a0: 4261 7365 4572 726f 7220 6173 2065 3a0a  BaseError as e:.
-000112b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-000112c0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-000112d0: 6570 7469 6f6e 2865 2920 6672 6f6d 2065  eption(e) from e
-000112e0: 0a0a 2020 2020 4072 6574 7269 6572 0a20  ..    @retrier. 
-000112f0: 2020 2064 6566 2067 6574 5f74 6963 6b65     def get_ticke
-00011300: 7273 2873 656c 662c 2073 796d 626f 6c73  rs(self, symbols
-00011310: 3a20 4f70 7469 6f6e 616c 5b4c 6973 745b  : Optional[List[
-00011320: 7374 725d 5d20 3d20 4e6f 6e65 2c20 6361  str]] = None, ca
-00011330: 6368 6564 3a20 626f 6f6c 203d 2046 616c  ched: bool = Fal
-00011340: 7365 2920 2d3e 2054 6963 6b65 7273 3a0a  se) -> Tickers:.
-00011350: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00011360: 2020 2020 3a70 6172 616d 2063 6163 6865      :param cache
-00011370: 643a 2041 6c6c 6f77 2063 6163 6865 6420  d: Allow cached 
-00011380: 7265 7375 6c74 0a20 2020 2020 2020 203a  result.        :
-00011390: 7265 7475 726e 3a20 6665 7463 685f 7469  return: fetch_ti
-000113a0: 636b 6572 7320 7265 7375 6c74 0a20 2020  ckers result.   
-000113b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000113c0: 2074 6963 6b65 7273 3a20 5469 636b 6572   tickers: Ticker
-000113d0: 730a 2020 2020 2020 2020 6966 206e 6f74  s.        if not
-000113e0: 2073 656c 662e 6578 6368 616e 6765 5f68   self.exchange_h
-000113f0: 6173 2827 6665 7463 6854 6963 6b65 7273  as('fetchTickers
-00011400: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
-00011410: 7265 7475 726e 207b 7d0a 2020 2020 2020  return {}.      
-00011420: 2020 6966 2063 6163 6865 643a 0a20 2020    if cached:.   
-00011430: 2020 2020 2020 2020 2077 6974 6820 7365           with se
-00011440: 6c66 2e5f 6361 6368 655f 6c6f 636b 3a0a  lf._cache_lock:.
-00011450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011460: 7469 636b 6572 7320 3d20 7365 6c66 2e5f  tickers = self._
-00011470: 6665 7463 685f 7469 636b 6572 735f 6361  fetch_tickers_ca
-00011480: 6368 652e 6765 7428 2766 6574 6368 5f74  che.get('fetch_t
-00011490: 6963 6b65 7273 2729 2020 2320 7479 7065  ickers')  # type
-000114a0: 3a20 6967 6e6f 7265 0a20 2020 2020 2020  : ignore.       
-000114b0: 2020 2020 2069 6620 7469 636b 6572 733a       if tickers:
-000114c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000114d0: 2072 6574 7572 6e20 7469 636b 6572 730a   return tickers.
-000114e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000114f0: 2020 2020 2020 2020 2074 6963 6b65 7273           tickers
-00011500: 203d 2073 656c 662e 5f61 7069 2e66 6574   = self._api.fet
-00011510: 6368 5f74 6963 6b65 7273 2873 796d 626f  ch_tickers(symbo
-00011520: 6c73 290a 2020 2020 2020 2020 2020 2020  ls).            
-00011530: 7769 7468 2073 656c 662e 5f63 6163 6865  with self._cache
-00011540: 5f6c 6f63 6b3a 0a20 2020 2020 2020 2020  _lock:.         
-00011550: 2020 2020 2020 2073 656c 662e 5f66 6574         self._fet
-00011560: 6368 5f74 6963 6b65 7273 5f63 6163 6865  ch_tickers_cache
-00011570: 5b27 6665 7463 685f 7469 636b 6572 7327  ['fetch_tickers'
-00011580: 5d20 3d20 7469 636b 6572 730a 2020 2020  ] = tickers.    
-00011590: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-000115a0: 6963 6b65 7273 0a20 2020 2020 2020 2065  ickers.        e
-000115b0: 7863 6570 7420 6363 7874 2e4e 6f74 5375  xcept ccxt.NotSu
-000115c0: 7070 6f72 7465 6420 6173 2065 3a0a 2020  pported as e:.  
-000115d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000115e0: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-000115f0: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00011600: 2020 2020 2020 6627 4578 6368 616e 6765        f'Exchange
-00011610: 207b 7365 6c66 2e5f 6170 692e 6e61 6d65   {self._api.name
-00011620: 7d20 646f 6573 206e 6f74 2073 7570 706f  } does not suppo
-00011630: 7274 2066 6574 6368 696e 6720 7469 636b  rt fetching tick
-00011640: 6572 7320 696e 2062 6174 6368 2e20 270a  ers in batch. '.
-00011650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011660: 6627 4d65 7373 6167 653a 207b 657d 2729  f'Message: {e}')
-00011670: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-00011680: 6578 6365 7074 2063 6378 742e 4261 6453  except ccxt.BadS
-00011690: 796d 626f 6c20 6173 2065 3a0a 2020 2020  ymbol as e:.    
-000116a0: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-000116b0: 6172 6e69 6e67 2866 2243 6f75 6c64 206e  arning(f"Could n
-000116c0: 6f74 206c 6f61 6420 7469 636b 6572 7320  ot load tickers 
-000116d0: 6475 6520 746f 207b 652e 5f5f 636c 6173  due to {e.__clas
-000116e0: 735f 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d  s__.__name__}. M
-000116f0: 6573 7361 6765 3a20 7b65 7d20 2e22 0a20  essage: {e} .". 
-00011700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011710: 2020 2020 2020 2020 2020 2252 656c 6f61            "Reloa
-00011720: 6469 6e67 206d 6172 6b65 7473 2e22 290a  ding markets.").
-00011730: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00011740: 2e72 656c 6f61 645f 6d61 726b 6574 7328  .reload_markets(
-00011750: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
-00011760: 2020 2320 5265 2d72 6169 7365 2065 7863    # Re-raise exc
-00011770: 6570 7469 6f6e 2074 6f20 7265 7065 6174  eption to repeat
-00011780: 2074 6865 2063 616c 6c2e 0a20 2020 2020   the call..     
-00011790: 2020 2020 2020 2072 6169 7365 2054 656d         raise Tem
-000117a0: 706f 7261 7279 4572 726f 7220 6672 6f6d  poraryError from
-000117b0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-000117c0: 7420 6363 7874 2e44 446f 5350 726f 7465  t ccxt.DDoSProte
-000117d0: 6374 696f 6e20 6173 2065 3a0a 2020 2020  ction as e:.    
-000117e0: 2020 2020 2020 2020 7261 6973 6520 4444          raise DD
-000117f0: 6f73 5072 6f74 6563 7469 6f6e 2865 2920  osProtection(e) 
-00011800: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-00011810: 7863 6570 7420 2863 6378 742e 4e65 7477  xcept (ccxt.Netw
-00011820: 6f72 6b45 7272 6f72 2c20 6363 7874 2e45  orkError, ccxt.E
-00011830: 7863 6861 6e67 6545 7272 6f72 2920 6173  xchangeError) as
-00011840: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-00011850: 7261 6973 6520 5465 6d70 6f72 6172 7945  raise TemporaryE
-00011860: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00011870: 2020 2020 2020 6627 436f 756c 6420 6e6f        f'Could no
-00011880: 7420 6c6f 6164 2074 6963 6b65 7273 2064  t load tickers d
-00011890: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
-000118a0: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
-000118b0: 7373 6167 653a 207b 657d 2729 2066 726f  ssage: {e}') fro
-000118c0: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
-000118d0: 7074 2063 6378 742e 4261 7365 4572 726f  pt ccxt.BaseErro
-000118e0: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
-000118f0: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-00011900: 696f 6e61 6c45 7863 6570 7469 6f6e 2865  ionalException(e
-00011910: 2920 6672 6f6d 2065 0a0a 2020 2020 2320  ) from e..    # 
-00011920: 5072 6963 696e 6720 696e 666f 0a0a 2020  Pricing info..  
-00011930: 2020 4072 6574 7269 6572 0a20 2020 2064    @retrier.    d
-00011940: 6566 2066 6574 6368 5f74 6963 6b65 7228  ef fetch_ticker(
-00011950: 7365 6c66 2c20 7061 6972 3a20 7374 7229  self, pair: str)
-00011960: 202d 3e20 5469 636b 6572 3a0a 2020 2020   -> Ticker:.    
-00011970: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00011980: 2020 2020 2069 6620 2870 6169 7220 6e6f       if (pair no
-00011990: 7420 696e 2073 656c 662e 6d61 726b 6574  t in self.market
-000119a0: 7320 6f72 0a20 2020 2020 2020 2020 2020  s or.           
-000119b0: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
-000119c0: 726b 6574 735b 7061 6972 5d2e 6765 7428  rkets[pair].get(
-000119d0: 2761 6374 6976 6527 2c20 4661 6c73 6529  'active', False)
-000119e0: 2069 7320 4661 6c73 6529 3a0a 2020 2020   is False):.    
-000119f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00011a00: 6520 4578 6368 616e 6765 4572 726f 7228  e ExchangeError(
-00011a10: 6622 5061 6972 207b 7061 6972 7d20 6e6f  f"Pair {pair} no
-00011a20: 7420 6176 6169 6c61 626c 6522 290a 2020  t available").  
-00011a30: 2020 2020 2020 2020 2020 6461 7461 3a20            data: 
-00011a40: 5469 636b 6572 203d 2073 656c 662e 5f61  Ticker = self._a
-00011a50: 7069 2e66 6574 6368 5f74 6963 6b65 7228  pi.fetch_ticker(
-00011a60: 7061 6972 290a 2020 2020 2020 2020 2020  pair).          
-00011a70: 2020 7265 7475 726e 2064 6174 610a 2020    return data.  
-00011a80: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-00011a90: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
-00011aa0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-00011ab0: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
-00011ac0: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
-00011ad0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00011ae0: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
-00011af0: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
-00011b00: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
-00011b10: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00011b20: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
-00011b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011b40: 2066 2743 6f75 6c64 206e 6f74 206c 6f61   f'Could not loa
-00011b50: 6420 7469 636b 6572 2064 7565 2074 6f20  d ticker due to 
-00011b60: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-00011b70: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
-00011b80: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
-00011b90: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
-00011ba0: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
-00011bb0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00011bc0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-00011bd0: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
-00011be0: 2065 0a0a 2020 2020 4073 7461 7469 636d   e..    @staticm
-00011bf0: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
-00011c00: 745f 6e65 7874 5f6c 696d 6974 5f69 6e5f  t_next_limit_in_
-00011c10: 6c69 7374 286c 696d 6974 3a20 696e 742c  list(limit: int,
-00011c20: 206c 696d 6974 5f72 616e 6765 3a20 4f70   limit_range: Op
-00011c30: 7469 6f6e 616c 5b4c 6973 745b 696e 745d  tional[List[int]
-00011c40: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-00011c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011c60: 2020 7261 6e67 655f 7265 7175 6972 6564    range_required
-00011c70: 3a20 626f 6f6c 203d 2054 7275 6529 3a0a  : bool = True):.
-00011c80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00011c90: 2020 2020 4765 7420 6e65 7874 2067 7265      Get next gre
-00011ca0: 6174 6572 2076 616c 7565 2069 6e20 7468  ater value in th
-00011cb0: 6520 6c69 7374 2e0a 2020 2020 2020 2020  e list..        
-00011cc0: 5573 6564 2062 7920 6665 7463 685f 6c32  Used by fetch_l2
-00011cd0: 5f6f 7264 6572 5f62 6f6f 6b20 6966 2074  _order_book if t
-00011ce0: 6865 2061 7069 206f 6e6c 7920 7375 7070  he api only supp
-00011cf0: 6f72 7473 2061 206c 696d 6974 6564 2072  orts a limited r
-00011d00: 616e 6765 0a20 2020 2020 2020 2022 2222  ange.        """
-00011d10: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00011d20: 6c69 6d69 745f 7261 6e67 653a 0a20 2020  limit_range:.   
-00011d30: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011d40: 6c69 6d69 740a 0a20 2020 2020 2020 2072  limit..        r
-00011d50: 6573 756c 7420 3d20 6d69 6e28 5b78 2066  esult = min([x f
-00011d60: 6f72 2078 2069 6e20 6c69 6d69 745f 7261  or x in limit_ra
-00011d70: 6e67 6520 6966 206c 696d 6974 203c 3d20  nge if limit <= 
-00011d80: 785d 202b 205b 6d61 7828 6c69 6d69 745f  x] + [max(limit_
-00011d90: 7261 6e67 6529 5d29 0a20 2020 2020 2020  range)]).       
-00011da0: 2069 6620 6e6f 7420 7261 6e67 655f 7265   if not range_re
-00011db0: 7175 6972 6564 2061 6e64 206c 696d 6974  quired and limit
-00011dc0: 203e 2072 6573 756c 743a 0a20 2020 2020   > result:.     
-00011dd0: 2020 2020 2020 2023 2052 616e 6765 2069         # Range i
-00011de0: 7320 6e6f 7420 7265 7175 6972 6564 202d  s not required -
-00011df0: 2077 6520 6361 6e20 7573 6520 4e6f 6e65   we can use None
-00011e00: 2061 7320 7061 7261 6d65 7465 722e 0a20   as parameter.. 
-00011e10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00011e20: 6e20 4e6f 6e65 0a20 2020 2020 2020 2072  n None.        r
-00011e30: 6574 7572 6e20 7265 7375 6c74 0a0a 2020  eturn result..  
-00011e40: 2020 4072 6574 7269 6572 0a20 2020 2064    @retrier.    d
-00011e50: 6566 2066 6574 6368 5f6c 325f 6f72 6465  ef fetch_l2_orde
-00011e60: 725f 626f 6f6b 2873 656c 662c 2070 6169  r_book(self, pai
-00011e70: 723a 2073 7472 2c20 6c69 6d69 743a 2069  r: str, limit: i
-00011e80: 6e74 203d 2031 3030 2920 2d3e 204f 7264  nt = 100) -> Ord
-00011e90: 6572 426f 6f6b 3a0a 2020 2020 2020 2020  erBook:.        
-00011ea0: 2222 220a 2020 2020 2020 2020 4765 7420  """.        Get 
-00011eb0: 4c32 206f 7264 6572 2062 6f6f 6b20 6672  L2 order book fr
-00011ec0: 6f6d 2065 7863 6861 6e67 652e 0a20 2020  om exchange..   
-00011ed0: 2020 2020 2043 616e 2062 6520 6c69 6d69       Can be limi
-00011ee0: 7465 6420 746f 2061 2063 6572 7461 696e  ted to a certain
-00011ef0: 2061 6d6f 756e 7420 2869 6620 7375 7070   amount (if supp
-00011f00: 6f72 7465 6429 2e0a 2020 2020 2020 2020  orted)..        
-00011f10: 5265 7475 726e 7320 6120 6469 6374 2069  Returns a dict i
-00011f20: 6e20 7468 6520 666f 726d 6174 0a20 2020  n the format.   
-00011f30: 2020 2020 207b 2761 736b 7327 3a20 5b70       {'asks': [p
-00011f40: 7269 6365 2c20 766f 6c75 6d65 5d2c 2027  rice, volume], '
-00011f50: 6269 6473 273a 205b 7072 6963 652c 2076  bids': [price, v
-00011f60: 6f6c 756d 655d 7d0a 2020 2020 2020 2020  olume]}.        
-00011f70: 2222 220a 2020 2020 2020 2020 6c69 6d69  """.        limi
-00011f80: 7431 203d 2073 656c 662e 6765 745f 6e65  t1 = self.get_ne
-00011f90: 7874 5f6c 696d 6974 5f69 6e5f 6c69 7374  xt_limit_in_list
-00011fa0: 286c 696d 6974 2c20 7365 6c66 2e5f 6674  (limit, self._ft
-00011fb0: 5f68 6173 5b27 6c32 5f6c 696d 6974 5f72  _has['l2_limit_r
-00011fc0: 616e 6765 275d 2c0a 2020 2020 2020 2020  ange'],.        
-00011fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ff0: 2020 2020 2073 656c 662e 5f66 745f 6861       self._ft_ha
-00012000: 735b 276c 325f 6c69 6d69 745f 7261 6e67  s['l2_limit_rang
-00012010: 655f 7265 7175 6972 6564 275d 290a 2020  e_required']).  
-00012020: 2020 2020 2020 7472 793a 0a0a 2020 2020        try:..    
-00012030: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00012040: 656c 662e 5f61 7069 2e66 6574 6368 5f6c  elf._api.fetch_l
-00012050: 325f 6f72 6465 725f 626f 6f6b 2870 6169  2_order_book(pai
-00012060: 722c 206c 696d 6974 3129 0a20 2020 2020  r, limit1).     
-00012070: 2020 2065 7863 6570 7420 6363 7874 2e4e     except ccxt.N
-00012080: 6f74 5375 7070 6f72 7465 6420 6173 2065  otSupported as e
-00012090: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000120a0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
-000120b0: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
-000120c0: 2020 2020 2020 2020 2020 6627 4578 6368            f'Exch
-000120d0: 616e 6765 207b 7365 6c66 2e5f 6170 692e  ange {self._api.
-000120e0: 6e61 6d65 7d20 646f 6573 206e 6f74 2073  name} does not s
-000120f0: 7570 706f 7274 2066 6574 6368 696e 6720  upport fetching 
-00012100: 6f72 6465 7220 626f 6f6b 2e27 0a20 2020  order book.'.   
-00012110: 2020 2020 2020 2020 2020 2020 2066 274d               f'M
-00012120: 6573 7361 6765 3a20 7b65 7d27 2920 6672  essage: {e}') fr
-00012130: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
-00012140: 6570 7420 6363 7874 2e44 446f 5350 726f  ept ccxt.DDoSPro
-00012150: 7465 6374 696f 6e20 6173 2065 3a0a 2020  tection as e:.  
-00012160: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00012170: 4444 6f73 5072 6f74 6563 7469 6f6e 2865  DDosProtection(e
-00012180: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-00012190: 2065 7863 6570 7420 2863 6378 742e 4e65   except (ccxt.Ne
-000121a0: 7477 6f72 6b45 7272 6f72 2c20 6363 7874  tworkError, ccxt
-000121b0: 2e45 7863 6861 6e67 6545 7272 6f72 2920  .ExchangeError) 
-000121c0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-000121d0: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
-000121e0: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
-000121f0: 2020 2020 2020 2020 6627 436f 756c 6420          f'Could 
-00012200: 6e6f 7420 6765 7420 6f72 6465 7220 626f  not get order bo
-00012210: 6f6b 2064 7565 2074 6f20 7b65 2e5f 5f63  ok due to {e.__c
-00012220: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
-00012230: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
-00012240: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-00012250: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
-00012260: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
-00012270: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-00012280: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-00012290: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
-000122a0: 2020 6465 6620 5f67 6574 5f70 7269 6365    def _get_price
-000122b0: 5f73 6964 6528 7365 6c66 2c20 7369 6465  _side(self, side
-000122c0: 3a20 7374 722c 2069 735f 7368 6f72 743a  : str, is_short:
-000122d0: 2062 6f6f 6c2c 2063 6f6e 665f 7374 7261   bool, conf_stra
-000122e0: 7465 6779 3a20 4469 6374 2920 2d3e 2042  tegy: Dict) -> B
-000122f0: 6964 4173 6b3a 0a20 2020 2020 2020 2070  idAsk:.        p
-00012300: 7269 6365 5f73 6964 6520 3d20 636f 6e66  rice_side = conf
-00012310: 5f73 7472 6174 6567 795b 2770 7269 6365  _strategy['price
-00012320: 5f73 6964 6527 5d0a 0a20 2020 2020 2020  _side']..       
-00012330: 2069 6620 7072 6963 655f 7369 6465 2069   if price_side i
-00012340: 6e20 2827 7361 6d65 272c 2027 6f74 6865  n ('same', 'othe
-00012350: 7227 293a 0a20 2020 2020 2020 2020 2020  r'):.           
-00012360: 2070 7269 6365 5f6d 6170 203d 207b 0a20   price_map = {. 
-00012370: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-00012380: 2765 6e74 7279 272c 2027 6c6f 6e67 272c  'entry', 'long',
-00012390: 2027 7361 6d65 2729 3a20 2762 6964 272c   'same'): 'bid',
-000123a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000123b0: 2028 2765 6e74 7279 272c 2027 6c6f 6e67   ('entry', 'long
-000123c0: 272c 2027 6f74 6865 7227 293a 2027 6173  ', 'other'): 'as
-000123d0: 6b27 2c0a 2020 2020 2020 2020 2020 2020  k',.            
-000123e0: 2020 2020 2827 656e 7472 7927 2c20 2773      ('entry', 's
-000123f0: 686f 7274 272c 2027 7361 6d65 2729 3a20  hort', 'same'): 
-00012400: 2761 736b 272c 0a20 2020 2020 2020 2020  'ask',.         
-00012410: 2020 2020 2020 2028 2765 6e74 7279 272c         ('entry',
-00012420: 2027 7368 6f72 7427 2c20 276f 7468 6572   'short', 'other
-00012430: 2729 3a20 2762 6964 272c 0a20 2020 2020  '): 'bid',.     
-00012440: 2020 2020 2020 2020 2020 2028 2765 7869             ('exi
-00012450: 7427 2c20 276c 6f6e 6727 2c20 2773 616d  t', 'long', 'sam
-00012460: 6527 293a 2027 6173 6b27 2c0a 2020 2020  e'): 'ask',.    
-00012470: 2020 2020 2020 2020 2020 2020 2827 6578              ('ex
-00012480: 6974 272c 2027 6c6f 6e67 272c 2027 6f74  it', 'long', 'ot
-00012490: 6865 7227 293a 2027 6269 6427 2c0a 2020  her'): 'bid',.  
-000124a0: 2020 2020 2020 2020 2020 2020 2020 2827                ('
-000124b0: 6578 6974 272c 2027 7368 6f72 7427 2c20  exit', 'short', 
-000124c0: 2773 616d 6527 293a 2027 6269 6427 2c0a  'same'): 'bid',.
-000124d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000124e0: 2827 6578 6974 272c 2027 7368 6f72 7427  ('exit', 'short'
-000124f0: 2c20 276f 7468 6572 2729 3a20 2761 736b  , 'other'): 'ask
-00012500: 272c 0a20 2020 2020 2020 2020 2020 207d  ',.            }
-00012510: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00012520: 6365 5f73 6964 6520 3d20 7072 6963 655f  ce_side = price_
-00012530: 6d61 705b 2873 6964 652c 2027 7368 6f72  map[(side, 'shor
-00012540: 7427 2069 6620 6973 5f73 686f 7274 2065  t' if is_short e
-00012550: 6c73 6520 276c 6f6e 6727 2c20 7072 6963  lse 'long', pric
-00012560: 655f 7369 6465 295d 0a20 2020 2020 2020  e_side)].       
-00012570: 2072 6574 7572 6e20 7072 6963 655f 7369   return price_si
-00012580: 6465 0a0a 2020 2020 6465 6620 6765 745f  de..    def get_
-00012590: 7261 7465 2873 656c 662c 2070 6169 723a  rate(self, pair:
-000125a0: 2073 7472 2c20 7265 6672 6573 683a 2062   str, refresh: b
-000125b0: 6f6f 6c2c 0a20 2020 2020 2020 2020 2020  ool,.           
-000125c0: 2020 2020 2020 7369 6465 3a20 456e 7472        side: Entr
-000125d0: 7945 7869 742c 2069 735f 7368 6f72 743a  yExit, is_short:
-000125e0: 2062 6f6f 6c2c 0a20 2020 2020 2020 2020   bool,.         
-000125f0: 2020 2020 2020 2020 6f72 6465 725f 626f          order_bo
-00012600: 6f6b 3a20 4f70 7469 6f6e 616c 5b4f 7264  ok: Optional[Ord
-00012610: 6572 426f 6f6b 5d20 3d20 4e6f 6e65 2c20  erBook] = None, 
-00012620: 7469 636b 6572 3a20 4f70 7469 6f6e 616c  ticker: Optional
-00012630: 5b54 6963 6b65 725d 203d 204e 6f6e 6529  [Ticker] = None)
-00012640: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
-00012650: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-00012660: 616c 6375 6c61 7465 7320 6269 642f 6173  alculates bid/as
-00012670: 6b20 7461 7267 6574 0a20 2020 2020 2020  k target.       
-00012680: 2062 6964 2072 6174 6520 2d20 6265 7477   bid rate - betw
-00012690: 6565 6e20 6375 7272 656e 7420 6173 6b20  een current ask 
-000126a0: 7072 6963 6520 616e 6420 6c61 7374 2070  price and last p
-000126b0: 7269 6365 0a20 2020 2020 2020 2061 736b  rice.        ask
-000126c0: 2072 6174 6520 2d20 6569 7468 6572 2075   rate - either u
-000126d0: 7369 6e67 2074 6963 6b65 7220 6269 6420  sing ticker bid 
-000126e0: 6f72 2066 6972 7374 2062 6964 2062 6173  or first bid bas
-000126f0: 6564 206f 6e20 6f72 6465 7262 6f6f 6b0a  ed on orderbook.
-00012700: 2020 2020 2020 2020 6f72 2072 656d 6169          or remai
-00012710: 6e20 7374 6174 6963 2069 6e20 616e 7920  n static in any 
-00012720: 6f74 6865 7220 6361 7365 2073 696e 6365  other case since
-00012730: 2069 7427 7320 6e6f 7420 7570 6461 7469   it's not updati
-00012740: 6e67 2e0a 2020 2020 2020 2020 3a70 6172  ng..        :par
-00012750: 616d 2070 6169 723a 2050 6169 7220 746f  am pair: Pair to
-00012760: 2067 6574 2072 6174 6520 666f 720a 2020   get rate for.  
-00012770: 2020 2020 2020 3a70 6172 616d 2072 6566        :param ref
-00012780: 7265 7368 3a20 616c 6c6f 7720 6361 6368  resh: allow cach
-00012790: 6564 2064 6174 610a 2020 2020 2020 2020  ed data.        
-000127a0: 3a70 6172 616d 2073 6964 653a 2022 6275  :param side: "bu
-000127b0: 7922 206f 7220 2273 656c 6c22 0a20 2020  y" or "sell".   
-000127c0: 2020 2020 203a 7265 7475 726e 3a20 666c       :return: fl
-000127d0: 6f61 743a 2050 7269 6365 0a20 2020 2020  oat: Price.     
-000127e0: 2020 203a 7261 6973 6573 2050 7269 6369     :raises Prici
-000127f0: 6e67 4572 726f 7220 6966 206f 7264 6572  ngError if order
-00012800: 626f 6f6b 2070 7269 6365 2063 6f75 6c64  book price could
-00012810: 206e 6f74 2062 6520 6465 7465 726d 696e   not be determin
-00012820: 6564 2e0a 2020 2020 2020 2020 2222 220a  ed..        """.
-00012830: 2020 2020 2020 2020 6e61 6d65 203d 2073          name = s
-00012840: 6964 652e 6361 7069 7461 6c69 7a65 2829  ide.capitalize()
-00012850: 0a20 2020 2020 2020 2073 7472 6174 5f6e  .        strat_n
-00012860: 616d 6520 3d20 2765 6e74 7279 5f70 7269  ame = 'entry_pri
-00012870: 6369 6e67 2720 6966 2073 6964 6520 3d3d  cing' if side ==
-00012880: 2022 656e 7472 7922 2065 6c73 6520 2765   "entry" else 'e
-00012890: 7869 745f 7072 6963 696e 6727 0a0a 2020  xit_pricing'..  
-000128a0: 2020 2020 2020 6361 6368 655f 7261 7465        cache_rate
-000128b0: 3a20 5454 4c43 6163 6865 203d 2073 656c  : TTLCache = sel
-000128c0: 662e 5f65 6e74 7279 5f72 6174 655f 6361  f._entry_rate_ca
-000128d0: 6368 6520 6966 2073 6964 6520 3d3d 2022  che if side == "
-000128e0: 656e 7472 7922 2065 6c73 6520 7365 6c66  entry" else self
-000128f0: 2e5f 6578 6974 5f72 6174 655f 6361 6368  ._exit_rate_cach
-00012900: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-00012910: 2072 6566 7265 7368 3a0a 2020 2020 2020   refresh:.      
-00012920: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-00012930: 5f63 6163 6865 5f6c 6f63 6b3a 0a20 2020  _cache_lock:.   
-00012940: 2020 2020 2020 2020 2020 2020 2072 6174               rat
-00012950: 6520 3d20 6361 6368 655f 7261 7465 2e67  e = cache_rate.g
-00012960: 6574 2870 6169 7229 0a20 2020 2020 2020  et(pair).       
-00012970: 2020 2020 2023 2043 6865 636b 2069 6620       # Check if 
-00012980: 6361 6368 6520 6861 7320 6265 656e 2069  cache has been i
-00012990: 6e76 616c 6964 6174 6564 0a20 2020 2020  nvalidated.     
-000129a0: 2020 2020 2020 2069 6620 7261 7465 3a0a         if rate:.
-000129b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000129c0: 6c6f 6767 6572 2e64 6562 7567 2866 2255  logger.debug(f"U
-000129d0: 7369 6e67 2063 6163 6865 6420 7b73 6964  sing cached {sid
-000129e0: 657d 2072 6174 6520 666f 7220 7b70 6169  e} rate for {pai
-000129f0: 727d 2e22 290a 2020 2020 2020 2020 2020  r}.").          
-00012a00: 2020 2020 2020 7265 7475 726e 2072 6174        return rat
-00012a10: 650a 0a20 2020 2020 2020 2063 6f6e 665f  e..        conf_
-00012a20: 7374 7261 7465 6779 203d 2073 656c 662e  strategy = self.
-00012a30: 5f63 6f6e 6669 672e 6765 7428 7374 7261  _config.get(stra
-00012a40: 745f 6e61 6d65 2c20 7b7d 290a 0a20 2020  t_name, {})..   
-00012a50: 2020 2020 2070 7269 6365 5f73 6964 6520       price_side 
-00012a60: 3d20 7365 6c66 2e5f 6765 745f 7072 6963  = self._get_pric
-00012a70: 655f 7369 6465 2873 6964 652c 2069 735f  e_side(side, is_
-00012a80: 7368 6f72 742c 2063 6f6e 665f 7374 7261  short, conf_stra
-00012a90: 7465 6779 290a 0a20 2020 2020 2020 2069  tegy)..        i
-00012aa0: 6620 636f 6e66 5f73 7472 6174 6567 792e  f conf_strategy.
-00012ab0: 6765 7428 2775 7365 5f6f 7264 6572 5f62  get('use_order_b
-00012ac0: 6f6f 6b27 2c20 4661 6c73 6529 3a0a 0a20  ook', False):.. 
-00012ad0: 2020 2020 2020 2020 2020 206f 7264 6572             order
-00012ae0: 5f62 6f6f 6b5f 746f 7020 3d20 636f 6e66  _book_top = conf
-00012af0: 5f73 7472 6174 6567 792e 6765 7428 276f  _strategy.get('o
-00012b00: 7264 6572 5f62 6f6f 6b5f 746f 7027 2c20  rder_book_top', 
-00012b10: 3129 0a20 2020 2020 2020 2020 2020 2069  1).            i
-00012b20: 6620 6f72 6465 725f 626f 6f6b 2069 7320  f order_book is 
-00012b30: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00012b40: 2020 2020 2020 6f72 6465 725f 626f 6f6b        order_book
-00012b50: 203d 2073 656c 662e 6665 7463 685f 6c32   = self.fetch_l2
-00012b60: 5f6f 7264 6572 5f62 6f6f 6b28 7061 6972  _order_book(pair
-00012b70: 2c20 6f72 6465 725f 626f 6f6b 5f74 6f70  , order_book_top
-00012b80: 290a 2020 2020 2020 2020 2020 2020 7261  ).            ra
-00012b90: 7465 203d 2073 656c 662e 5f67 6574 5f72  te = self._get_r
-00012ba0: 6174 655f 6672 6f6d 5f6f 6228 7061 6972  ate_from_ob(pair
-00012bb0: 2c20 7369 6465 2c20 6f72 6465 725f 626f  , side, order_bo
-00012bc0: 6f6b 2c20 6e61 6d65 2c20 7072 6963 655f  ok, name, price_
-00012bd0: 7369 6465 2c0a 2020 2020 2020 2020 2020  side,.          
-00012be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c00: 6f72 6465 725f 626f 6f6b 5f74 6f70 290a  order_book_top).
-00012c10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00012c20: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00012c30: 2e64 6562 7567 2866 2255 7369 6e67 204c  .debug(f"Using L
-00012c40: 6173 7420 7b70 7269 6365 5f73 6964 652e  ast {price_side.
-00012c50: 6361 7069 7461 6c69 7a65 2829 7d20 2f20  capitalize()} / 
-00012c60: 4c61 7374 2050 7269 6365 2229 0a20 2020  Last Price").   
-00012c70: 2020 2020 2020 2020 2069 6620 7469 636b           if tick
-00012c80: 6572 2069 7320 4e6f 6e65 3a0a 2020 2020  er is None:.    
-00012c90: 2020 2020 2020 2020 2020 2020 7469 636b              tick
-00012ca0: 6572 203d 2073 656c 662e 6665 7463 685f  er = self.fetch_
-00012cb0: 7469 636b 6572 2870 6169 7229 0a20 2020  ticker(pair).   
-00012cc0: 2020 2020 2020 2020 2072 6174 6520 3d20           rate = 
-00012cd0: 7365 6c66 2e5f 6765 745f 7261 7465 5f66  self._get_rate_f
-00012ce0: 726f 6d5f 7469 636b 6572 2873 6964 652c  rom_ticker(side,
-00012cf0: 2074 6963 6b65 722c 2063 6f6e 665f 7374   ticker, conf_st
-00012d00: 7261 7465 6779 2c20 7072 6963 655f 7369  rategy, price_si
-00012d10: 6465 290a 0a20 2020 2020 2020 2069 6620  de)..        if 
-00012d20: 7261 7465 2069 7320 4e6f 6e65 3a0a 2020  rate is None:.  
-00012d30: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00012d40: 5072 6963 696e 6745 7272 6f72 2866 227b  PricingError(f"{
-00012d50: 6e61 6d65 7d2d 5261 7465 2066 6f72 207b  name}-Rate for {
-00012d60: 7061 6972 7d20 7761 7320 656d 7074 792e  pair} was empty.
-00012d70: 2229 0a20 2020 2020 2020 2077 6974 6820  ").        with 
-00012d80: 7365 6c66 2e5f 6361 6368 655f 6c6f 636b  self._cache_lock
-00012d90: 3a0a 2020 2020 2020 2020 2020 2020 6361  :.            ca
-00012da0: 6368 655f 7261 7465 5b70 6169 725d 203d  che_rate[pair] =
-00012db0: 2072 6174 650a 0a20 2020 2020 2020 2072   rate..        r
-00012dc0: 6574 7572 6e20 7261 7465 0a0a 2020 2020  eturn rate..    
-00012dd0: 6465 6620 5f67 6574 5f72 6174 655f 6672  def _get_rate_fr
-00012de0: 6f6d 5f74 6963 6b65 7228 7365 6c66 2c20  om_ticker(self, 
-00012df0: 7369 6465 3a20 456e 7472 7945 7869 742c  side: EntryExit,
-00012e00: 2074 6963 6b65 723a 2054 6963 6b65 722c   ticker: Ticker,
-00012e10: 2063 6f6e 665f 7374 7261 7465 6779 3a20   conf_strategy: 
-00012e20: 4469 6374 5b73 7472 2c20 416e 795d 2c0a  Dict[str, Any],.
-00012e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012e40: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00012e50: 6963 655f 7369 6465 3a20 4269 6441 736b  ice_side: BidAsk
-00012e60: 2920 2d3e 204f 7074 696f 6e61 6c5b 666c  ) -> Optional[fl
-00012e70: 6f61 745d 3a0a 2020 2020 2020 2020 2222  oat]:.        ""
-00012e80: 220a 2020 2020 2020 2020 4765 7420 7261  ".        Get ra
-00012e90: 7465 2066 726f 6d20 7469 636b 6572 2e0a  te from ticker..
-00012ea0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012eb0: 2020 2020 7469 636b 6572 5f72 6174 6520      ticker_rate 
-00012ec0: 3d20 7469 636b 6572 5b70 7269 6365 5f73  = ticker[price_s
-00012ed0: 6964 655d 0a20 2020 2020 2020 2069 6620  ide].        if 
-00012ee0: 7469 636b 6572 5b27 6c61 7374 275d 2061  ticker['last'] a
-00012ef0: 6e64 2074 6963 6b65 725f 7261 7465 3a0a  nd ticker_rate:.
-00012f00: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00012f10: 6964 6520 3d3d 2027 656e 7472 7927 2061  ide == 'entry' a
-00012f20: 6e64 2074 6963 6b65 725f 7261 7465 203e  nd ticker_rate >
-00012f30: 2074 6963 6b65 725b 276c 6173 7427 5d3a   ticker['last']:
-00012f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012f50: 2062 616c 616e 6365 203d 2063 6f6e 665f   balance = conf_
-00012f60: 7374 7261 7465 6779 2e67 6574 2827 7072  strategy.get('pr
-00012f70: 6963 655f 6c61 7374 5f62 616c 616e 6365  ice_last_balance
-00012f80: 272c 2030 2e30 290a 2020 2020 2020 2020  ', 0.0).        
-00012f90: 2020 2020 2020 2020 7469 636b 6572 5f72          ticker_r
-00012fa0: 6174 6520 3d20 7469 636b 6572 5f72 6174  ate = ticker_rat
-00012fb0: 6520 2b20 6261 6c61 6e63 6520 2a20 2874  e + balance * (t
-00012fc0: 6963 6b65 725b 276c 6173 7427 5d20 2d20  icker['last'] - 
-00012fd0: 7469 636b 6572 5f72 6174 6529 0a20 2020  ticker_rate).   
-00012fe0: 2020 2020 2020 2020 2065 6c69 6620 7369           elif si
-00012ff0: 6465 203d 3d20 2765 7869 7427 2061 6e64  de == 'exit' and
-00013000: 2074 6963 6b65 725f 7261 7465 203c 2074   ticker_rate < t
-00013010: 6963 6b65 725b 276c 6173 7427 5d3a 0a20  icker['last']:. 
-00013020: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-00013030: 616c 616e 6365 203d 2063 6f6e 665f 7374  alance = conf_st
-00013040: 7261 7465 6779 2e67 6574 2827 7072 6963  rategy.get('pric
-00013050: 655f 6c61 7374 5f62 616c 616e 6365 272c  e_last_balance',
-00013060: 2030 2e30 290a 2020 2020 2020 2020 2020   0.0).          
-00013070: 2020 2020 2020 7469 636b 6572 5f72 6174        ticker_rat
-00013080: 6520 3d20 7469 636b 6572 5f72 6174 6520  e = ticker_rate 
-00013090: 2d20 6261 6c61 6e63 6520 2a20 2874 6963  - balance * (tic
-000130a0: 6b65 725f 7261 7465 202d 2074 6963 6b65  ker_rate - ticke
-000130b0: 725b 276c 6173 7427 5d29 0a20 2020 2020  r['last']).     
-000130c0: 2020 2072 6174 6520 3d20 7469 636b 6572     rate = ticker
-000130d0: 5f72 6174 650a 2020 2020 2020 2020 7265  _rate.        re
-000130e0: 7475 726e 2072 6174 650a 0a20 2020 2064  turn rate..    d
-000130f0: 6566 205f 6765 745f 7261 7465 5f66 726f  ef _get_rate_fro
-00013100: 6d5f 6f62 2873 656c 662c 2070 6169 723a  m_ob(self, pair:
-00013110: 2073 7472 2c20 7369 6465 3a20 456e 7472   str, side: Entr
-00013120: 7945 7869 742c 206f 7264 6572 5f62 6f6f  yExit, order_boo
-00013130: 6b3a 204f 7264 6572 426f 6f6b 2c20 6e61  k: OrderBook, na
-00013140: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
-00013150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013160: 2020 2070 7269 6365 5f73 6964 653a 2042     price_side: B
-00013170: 6964 4173 6b2c 206f 7264 6572 5f62 6f6f  idAsk, order_boo
-00013180: 6b5f 746f 703a 2069 6e74 2920 2d3e 2066  k_top: int) -> f
-00013190: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
-000131a0: 220a 2020 2020 2020 2020 4765 7420 7261  ".        Get ra
-000131b0: 7465 2066 726f 6d20 6f72 6465 7262 6f6f  te from orderboo
-000131c0: 6b0a 2020 2020 2020 2020 3a72 6169 7365  k.        :raise
-000131d0: 733a 2050 7269 6369 6e67 4572 726f 7220  s: PricingError 
-000131e0: 6966 2072 6174 6520 636f 756c 6420 6e6f  if rate could no
-000131f0: 7420 6265 2064 6574 6572 6d69 6e65 642e  t be determined.
-00013200: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00013210: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
-00013220: 6728 276f 7264 6572 5f62 6f6f 6b20 2573  g('order_book %s
-00013230: 272c 206f 7264 6572 5f62 6f6f 6b29 0a20  ', order_book). 
-00013240: 2020 2020 2020 2023 2074 6f70 2031 203d         # top 1 =
-00013250: 2069 6e64 6578 2030 0a20 2020 2020 2020   index 0.       
-00013260: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00013270: 2020 6f62 7369 6465 3a20 4f42 4c69 7465    obside: OBLite
-00013280: 7261 6c20 3d20 2762 6964 7327 2069 6620  ral = 'bids' if 
-00013290: 7072 6963 655f 7369 6465 203d 3d20 2762  price_side == 'b
-000132a0: 6964 2720 656c 7365 2027 6173 6b73 270a  id' else 'asks'.
-000132b0: 2020 2020 2020 2020 2020 2020 7261 7465              rate
-000132c0: 203d 206f 7264 6572 5f62 6f6f 6b5b 6f62   = order_book[ob
-000132d0: 7369 6465 5d5b 6f72 6465 725f 626f 6f6b  side][order_book
-000132e0: 5f74 6f70 202d 2031 5d5b 305d 0a20 2020  _top - 1][0].   
-000132f0: 2020 2020 2065 7863 6570 7420 2849 6e64       except (Ind
-00013300: 6578 4572 726f 722c 204b 6579 4572 726f  exError, KeyErro
-00013310: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
-00013320: 2020 2020 206c 6f67 6765 722e 7761 726e       logger.warn
-00013330: 696e 6728 0a20 2020 2020 2020 2020 2020  ing(.           
-00013340: 2020 2020 2020 2020 2066 227b 7061 6972           f"{pair
-00013350: 7d20 2d20 7b6e 616d 657d 2050 7269 6365  } - {name} Price
-00013360: 2061 7420 6c6f 6361 7469 6f6e 207b 6f72   at location {or
-00013370: 6465 725f 626f 6f6b 5f74 6f70 7d20 6672  der_book_top} fr
-00013380: 6f6d 206f 7264 6572 626f 6f6b 2022 0a20  om orderbook ". 
-00013390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133a0: 2020 2066 2263 6f75 6c64 206e 6f74 2062     f"could not b
-000133b0: 6520 6465 7465 726d 696e 6564 2e20 4f72  e determined. Or
-000133c0: 6465 7262 6f6f 6b3a 207b 6f72 6465 725f  derbook: {order_
-000133d0: 626f 6f6b 7d22 0a20 2020 2020 2020 2020  book}".         
-000133e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000133f0: 2020 2020 2072 6169 7365 2050 7269 6369       raise Prici
-00013400: 6e67 4572 726f 7220 6672 6f6d 2065 0a20  ngError from e. 
-00013410: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
-00013420: 6275 6728 6622 7b70 6169 727d 202d 207b  bug(f"{pair} - {
-00013430: 6e61 6d65 7d20 7072 6963 6520 6672 6f6d  name} price from
-00013440: 206f 7264 6572 626f 6f6b 207b 7072 6963   orderbook {pric
-00013450: 655f 7369 6465 2e63 6170 6974 616c 697a  e_side.capitaliz
-00013460: 6528 297d 220a 2020 2020 2020 2020 2020  e()}".          
-00013470: 2020 2020 2020 2020 2020 2066 2273 6964             f"sid
-00013480: 6520 2d20 746f 7020 7b6f 7264 6572 5f62  e - top {order_b
-00013490: 6f6f 6b5f 746f 707d 206f 7264 6572 2062  ook_top} order b
-000134a0: 6f6f 6b20 7b73 6964 657d 2072 6174 6520  ook {side} rate 
-000134b0: 7b72 6174 653a 2e38 667d 2229 0a20 2020  {rate:.8f}").   
-000134c0: 2020 2020 2072 6574 7572 6e20 7261 7465       return rate
-000134d0: 0a0a 2020 2020 6465 6620 6765 745f 7261  ..    def get_ra
-000134e0: 7465 7328 7365 6c66 2c20 7061 6972 3a20  tes(self, pair: 
-000134f0: 7374 722c 2072 6566 7265 7368 3a20 626f  str, refresh: bo
-00013500: 6f6c 2c20 6973 5f73 686f 7274 3a20 626f  ol, is_short: bo
-00013510: 6f6c 2920 2d3e 2054 7570 6c65 5b66 6c6f  ol) -> Tuple[flo
-00013520: 6174 2c20 666c 6f61 745d 3a0a 2020 2020  at, float]:.    
-00013530: 2020 2020 656e 7472 795f 7261 7465 203d      entry_rate =
-00013540: 204e 6f6e 650a 2020 2020 2020 2020 6578   None.        ex
-00013550: 6974 5f72 6174 6520 3d20 4e6f 6e65 0a20  it_rate = None. 
-00013560: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
-00013570: 6672 6573 683a 0a20 2020 2020 2020 2020  fresh:.         
-00013580: 2020 2077 6974 6820 7365 6c66 2e5f 6361     with self._ca
-00013590: 6368 655f 6c6f 636b 3a0a 2020 2020 2020  che_lock:.      
-000135a0: 2020 2020 2020 2020 2020 656e 7472 795f            entry_
-000135b0: 7261 7465 203d 2073 656c 662e 5f65 6e74  rate = self._ent
-000135c0: 7279 5f72 6174 655f 6361 6368 652e 6765  ry_rate_cache.ge
-000135d0: 7428 7061 6972 290a 2020 2020 2020 2020  t(pair).        
-000135e0: 2020 2020 2020 2020 6578 6974 5f72 6174          exit_rat
-000135f0: 6520 3d20 7365 6c66 2e5f 6578 6974 5f72  e = self._exit_r
-00013600: 6174 655f 6361 6368 652e 6765 7428 7061  ate_cache.get(pa
-00013610: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
-00013620: 6966 2065 6e74 7279 5f72 6174 653a 0a20  if entry_rate:. 
-00013630: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00013640: 6f67 6765 722e 6465 6275 6728 6622 5573  ogger.debug(f"Us
-00013650: 696e 6720 6361 6368 6564 2062 7579 2072  ing cached buy r
-00013660: 6174 6520 666f 7220 7b70 6169 727d 2e22  ate for {pair}."
-00013670: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00013680: 2065 7869 745f 7261 7465 3a0a 2020 2020   exit_rate:.    
-00013690: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-000136a0: 6572 2e64 6562 7567 2866 2255 7369 6e67  er.debug(f"Using
-000136b0: 2063 6163 6865 6420 7365 6c6c 2072 6174   cached sell rat
-000136c0: 6520 666f 7220 7b70 6169 727d 2e22 290a  e for {pair}.").
-000136d0: 0a20 2020 2020 2020 2065 6e74 7279 5f70  .        entry_p
-000136e0: 7269 6369 6e67 203d 2073 656c 662e 5f63  ricing = self._c
-000136f0: 6f6e 6669 672e 6765 7428 2765 6e74 7279  onfig.get('entry
-00013700: 5f70 7269 6369 6e67 272c 207b 7d29 0a20  _pricing', {}). 
-00013710: 2020 2020 2020 2065 7869 745f 7072 6963         exit_pric
-00013720: 696e 6720 3d20 7365 6c66 2e5f 636f 6e66  ing = self._conf
-00013730: 6967 2e67 6574 2827 6578 6974 5f70 7269  ig.get('exit_pri
-00013740: 6369 6e67 272c 207b 7d29 0a20 2020 2020  cing', {}).     
-00013750: 2020 206f 7264 6572 5f62 6f6f 6b20 3d20     order_book = 
-00013760: 7469 636b 6572 203d 204e 6f6e 650a 2020  ticker = None.  
-00013770: 2020 2020 2020 6966 206e 6f74 2065 6e74        if not ent
-00013780: 7279 5f72 6174 6520 616e 6420 656e 7472  ry_rate and entr
-00013790: 795f 7072 6963 696e 672e 6765 7428 2775  y_pricing.get('u
-000137a0: 7365 5f6f 7264 6572 5f62 6f6f 6b27 2c20  se_order_book', 
-000137b0: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-000137c0: 2020 2020 6f72 6465 725f 626f 6f6b 5f74      order_book_t
-000137d0: 6f70 203d 206d 6178 2865 6e74 7279 5f70  op = max(entry_p
-000137e0: 7269 6369 6e67 2e67 6574 2827 6f72 6465  ricing.get('orde
-000137f0: 725f 626f 6f6b 5f74 6f70 272c 2031 292c  r_book_top', 1),
-00013800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013820: 2020 6578 6974 5f70 7269 6369 6e67 2e67    exit_pricing.g
-00013830: 6574 2827 6f72 6465 725f 626f 6f6b 5f74  et('order_book_t
-00013840: 6f70 272c 2031 2929 0a20 2020 2020 2020  op', 1)).       
-00013850: 2020 2020 206f 7264 6572 5f62 6f6f 6b20       order_book 
-00013860: 3d20 7365 6c66 2e66 6574 6368 5f6c 325f  = self.fetch_l2_
-00013870: 6f72 6465 725f 626f 6f6b 2870 6169 722c  order_book(pair,
-00013880: 206f 7264 6572 5f62 6f6f 6b5f 746f 7029   order_book_top)
-00013890: 0a20 2020 2020 2020 2020 2020 2065 6e74  .            ent
-000138a0: 7279 5f72 6174 6520 3d20 7365 6c66 2e67  ry_rate = self.g
-000138b0: 6574 5f72 6174 6528 7061 6972 2c20 7265  et_rate(pair, re
-000138c0: 6672 6573 682c 2027 656e 7472 7927 2c20  fresh, 'entry', 
-000138d0: 6973 5f73 686f 7274 2c20 6f72 6465 725f  is_short, order_
-000138e0: 626f 6f6b 3d6f 7264 6572 5f62 6f6f 6b29  book=order_book)
-000138f0: 0a20 2020 2020 2020 2065 6c69 6620 6e6f  .        elif no
-00013900: 7420 656e 7472 795f 7261 7465 3a0a 2020  t entry_rate:.  
-00013910: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
-00013920: 203d 2073 656c 662e 6665 7463 685f 7469   = self.fetch_ti
-00013930: 636b 6572 2870 6169 7229 0a20 2020 2020  cker(pair).     
-00013940: 2020 2020 2020 2065 6e74 7279 5f72 6174         entry_rat
-00013950: 6520 3d20 7365 6c66 2e67 6574 5f72 6174  e = self.get_rat
-00013960: 6528 7061 6972 2c20 7265 6672 6573 682c  e(pair, refresh,
-00013970: 2027 656e 7472 7927 2c20 6973 5f73 686f   'entry', is_sho
-00013980: 7274 2c20 7469 636b 6572 3d74 6963 6b65  rt, ticker=ticke
-00013990: 7229 0a20 2020 2020 2020 2069 6620 6e6f  r).        if no
-000139a0: 7420 6578 6974 5f72 6174 653a 0a20 2020  t exit_rate:.   
-000139b0: 2020 2020 2020 2020 2065 7869 745f 7261           exit_ra
-000139c0: 7465 203d 2073 656c 662e 6765 745f 7261  te = self.get_ra
-000139d0: 7465 2870 6169 722c 2072 6566 7265 7368  te(pair, refresh
-000139e0: 2c20 2765 7869 7427 2c0a 2020 2020 2020  , 'exit',.      
-000139f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a10: 6973 5f73 686f 7274 2c20 6f72 6465 725f  is_short, order_
-00013a20: 626f 6f6b 3d6f 7264 6572 5f62 6f6f 6b2c  book=order_book,
-00013a30: 2074 6963 6b65 723d 7469 636b 6572 290a   ticker=ticker).
-00013a40: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00013a50: 6e74 7279 5f72 6174 652c 2065 7869 745f  ntry_rate, exit_
-00013a60: 7261 7465 0a0a 2020 2020 2320 4665 6520  rate..    # Fee 
-00013a70: 6861 6e64 6c69 6e67 0a0a 2020 2020 4072  handling..    @r
-00013a80: 6574 7269 6572 0a20 2020 2064 6566 2067  etrier.    def g
-00013a90: 6574 5f74 7261 6465 735f 666f 725f 6f72  et_trades_for_or
-00013aa0: 6465 7228 7365 6c66 2c20 6f72 6465 725f  der(self, order_
-00013ab0: 6964 3a20 7374 722c 2070 6169 723a 2073  id: str, pair: s
-00013ac0: 7472 2c20 7369 6e63 653a 2064 6174 6574  tr, since: datet
-00013ad0: 696d 652c 0a20 2020 2020 2020 2020 2020  ime,.           
-00013ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013af0: 2020 7061 7261 6d73 3a20 4f70 7469 6f6e    params: Option
-00013b00: 616c 5b44 6963 745d 203d 204e 6f6e 6529  al[Dict] = None)
-00013b10: 202d 3e20 4c69 7374 3a0a 2020 2020 2020   -> List:.      
-00013b20: 2020 2222 220a 2020 2020 2020 2020 4665    """.        Fe
-00013b30: 7463 6820 4f72 6465 7273 2075 7369 6e67  tch Orders using
-00013b40: 2074 6865 2022 6665 7463 685f 6d79 5f74   the "fetch_my_t
-00013b50: 7261 6465 7322 2065 6e64 706f 696e 7420  rades" endpoint 
-00013b60: 616e 6420 6669 6c74 6572 2074 6865 6d20  and filter them 
-00013b70: 6279 206f 7264 6572 2d69 642e 0a20 2020  by order-id..   
-00013b80: 2020 2020 2054 6865 2022 7369 6e63 6522       The "since"
-00013b90: 2061 7267 756d 656e 7420 7061 7373 6564   argument passed
-00013ba0: 2069 6e20 6973 2063 6f6d 696e 6720 6672   in is coming fr
-00013bb0: 6f6d 2074 6865 2064 6174 6162 6173 6520  om the database 
-00013bc0: 616e 6420 6973 2069 6e20 5554 432c 0a20  and is in UTC,. 
-00013bd0: 2020 2020 2020 2061 7320 7469 6d65 7a6f         as timezo
-00013be0: 6e65 2d6e 6174 6976 6520 6461 7465 7469  ne-native dateti
-00013bf0: 6d65 206f 626a 6563 742e 0a20 2020 2020  me object..     
-00013c00: 2020 2046 726f 6d20 7468 6520 7079 7468     From the pyth
-00013c10: 6f6e 2064 6f63 756d 656e 7461 7469 6f6e  on documentation
-00013c20: 3a0a 2020 2020 2020 2020 2020 2020 3e20  :.            > 
-00013c30: 4e61 6976 6520 6461 7465 7469 6d65 2069  Naive datetime i
-00013c40: 6e73 7461 6e63 6573 2061 7265 2061 7373  nstances are ass
-00013c50: 756d 6564 2074 6f20 7265 7072 6573 656e  umed to represen
-00013c60: 7420 6c6f 6361 6c20 7469 6d65 0a20 2020  t local time.   
-00013c70: 2020 2020 2054 6865 7265 666f 7265 2c20       Therefore, 
-00013c80: 6361 6c6c 696e 6720 2273 696e 6365 2e74  calling "since.t
-00013c90: 696d 6573 7461 6d70 2829 2220 7769 6c6c  imestamp()" will
-00013ca0: 2067 6574 2074 6865 2055 5443 2074 696d   get the UTC tim
-00013cb0: 6573 7461 6d70 2c20 6166 7465 7220 6170  estamp, after ap
-00013cc0: 706c 7969 6e67 2074 6865 0a20 2020 2020  plying the.     
-00013cd0: 2020 2074 7261 6e73 666f 726d 6174 696f     transformatio
-00013ce0: 6e20 6672 6f6d 206c 6f63 616c 2074 696d  n from local tim
-00013cf0: 657a 6f6e 6520 746f 2055 5443 2e0a 2020  ezone to UTC..  
-00013d00: 2020 2020 2020 5468 6973 2077 6f72 6b73        This works
-00013d10: 2066 6f72 2074 696d 657a 6f6e 6573 2055   for timezones U
-00013d20: 5443 2b20 7369 6e63 6520 7468 656e 2074  TC+ since then t
-00013d30: 6865 2072 6573 756c 7420 7769 6c6c 2063  he result will c
-00013d40: 6f6e 7461 696e 2074 7261 6465 7320 6672  ontain trades fr
-00013d50: 6f6d 2061 2066 6577 2068 6f75 7273 0a20  om a few hours. 
-00013d60: 2020 2020 2020 2069 6e73 7465 6164 206f         instead o
-00013d70: 6620 6672 6f6d 2074 6865 206c 6173 7420  f from the last 
-00013d80: 3520 7365 636f 6e64 732c 2068 6f77 6576  5 seconds, howev
-00013d90: 6572 2066 6169 6c73 2066 6f72 2055 5443  er fails for UTC
-00013da0: 2d20 7469 6d65 7a6f 6e65 732c 0a20 2020  - timezones,.   
-00013db0: 2020 2020 2073 696e 6365 2077 6527 7265       since we're
-00013dc0: 2074 6865 6e20 6173 6b69 6e67 2066 6f72   then asking for
-00013dd0: 2074 7261 6465 7320 7769 7468 2061 2022   trades with a "
-00013de0: 7369 6e63 6522 2061 7267 756d 656e 7420  since" argument 
-00013df0: 696e 2074 6865 2066 7574 7572 652e 0a0a  in the future...
-00013e00: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
-00013e10: 7264 6572 5f69 6420 6f72 6465 725f 6964  rder_id order_id
-00013e20: 3a20 4f72 6465 722d 6964 2061 7320 6769  : Order-id as gi
-00013e30: 7665 6e20 7768 656e 2063 7265 6174 696e  ven when creatin
-00013e40: 6720 7468 6520 6f72 6465 720a 2020 2020  g the order.    
-00013e50: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
-00013e60: 2050 6169 7220 7468 6520 6f72 6465 7220   Pair the order 
-00013e70: 6973 2066 6f72 0a20 2020 2020 2020 203a  is for.        :
-00013e80: 7061 7261 6d20 7369 6e63 653a 2064 6174  param since: dat
-00013e90: 6574 696d 6520 6f62 6a65 6374 206f 6620  etime object of 
-00013ea0: 7468 6520 6f72 6465 7220 6372 6561 7469  the order creati
-00013eb0: 6f6e 2074 696d 652e 2041 7373 756d 6573  on time. Assumes
-00013ec0: 206f 626a 6563 7420 6973 2069 6e20 5554   object is in UT
-00013ed0: 432e 0a20 2020 2020 2020 2022 2222 0a20  C..        """. 
-00013ee0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00013ef0: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
-00013f00: 5d3a 0a20 2020 2020 2020 2020 2020 2072  ]:.            r
-00013f10: 6574 7572 6e20 5b5d 0a20 2020 2020 2020  eturn [].       
-00013f20: 2069 6620 6e6f 7420 7365 6c66 2e65 7863   if not self.exc
-00013f30: 6861 6e67 655f 6861 7328 2766 6574 6368  hange_has('fetch
-00013f40: 4d79 5472 6164 6573 2729 3a0a 2020 2020  MyTrades'):.    
-00013f50: 2020 2020 2020 2020 7265 7475 726e 205b          return [
-00013f60: 5d0a 2020 2020 2020 2020 7472 793a 0a20  ].        try:. 
-00013f70: 2020 2020 2020 2020 2020 2023 2041 6c6c             # All
-00013f80: 6f77 2035 7320 6f66 6673 6574 2074 6f20  ow 5s offset to 
-00013f90: 6361 7463 6820 736c 6967 6874 2074 696d  catch slight tim
-00013fa0: 6520 6f66 6673 6574 7320 2864 6973 636f  e offsets (disco
-00013fb0: 7665 7265 6420 696e 2023 3131 3835 290a  vered in #1185).
-00013fc0: 2020 2020 2020 2020 2020 2020 2320 7369              # si
-00013fd0: 6e63 6520 6e65 6564 7320 746f 2062 6520  nce needs to be 
-00013fe0: 696e 7420 696e 206d 696c 6c69 7365 636f  int in milliseco
-00013ff0: 6e64 730a 2020 2020 2020 2020 2020 2020  nds.            
-00014000: 5f70 6172 616d 7320 3d20 7061 7261 6d73  _params = params
-00014010: 2069 6620 7061 7261 6d73 2065 6c73 6520   if params else 
-00014020: 7b7d 0a20 2020 2020 2020 2020 2020 206d  {}.            m
-00014030: 795f 7472 6164 6573 203d 2073 656c 662e  y_trades = self.
-00014040: 5f61 7069 2e66 6574 6368 5f6d 795f 7472  _api.fetch_my_tr
-00014050: 6164 6573 280a 2020 2020 2020 2020 2020  ades(.          
-00014060: 2020 2020 2020 7061 6972 2c20 696e 7428        pair, int(
-00014070: 2873 696e 6365 2e72 6570 6c61 6365 2874  (since.replace(t
-00014080: 7a69 6e66 6f3d 7469 6d65 7a6f 6e65 2e75  zinfo=timezone.u
-00014090: 7463 292e 7469 6d65 7374 616d 7028 2920  tc).timestamp() 
-000140a0: 2d20 3529 202a 2031 3030 3029 2c0a 2020  - 5) * 1000),.  
-000140b0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-000140c0: 7261 6d73 3d5f 7061 7261 6d73 290a 2020  rams=_params).  
-000140d0: 2020 2020 2020 2020 2020 6d61 7463 6865            matche
-000140e0: 645f 7472 6164 6573 203d 205b 7472 6164  d_trades = [trad
-000140f0: 6520 666f 7220 7472 6164 6520 696e 206d  e for trade in m
-00014100: 795f 7472 6164 6573 2069 6620 7472 6164  y_trades if trad
-00014110: 655b 276f 7264 6572 275d 203d 3d20 6f72  e['order'] == or
-00014120: 6465 725f 6964 5d0a 0a20 2020 2020 2020  der_id]..       
-00014130: 2020 2020 2073 656c 662e 5f6c 6f67 5f65       self._log_e
-00014140: 7863 6861 6e67 655f 7265 7370 6f6e 7365  xchange_response
-00014150: 2827 6765 745f 7472 6164 6573 5f66 6f72  ('get_trades_for
-00014160: 5f6f 7264 6572 272c 206d 6174 6368 6564  _order', matched
-00014170: 5f74 7261 6465 7329 0a0a 2020 2020 2020  _trades)..      
-00014180: 2020 2020 2020 6d61 7463 6865 645f 7472        matched_tr
-00014190: 6164 6573 203d 2073 656c 662e 5f74 7261  ades = self._tra
-000141a0: 6465 735f 636f 6e74 7261 6374 735f 746f  des_contracts_to
-000141b0: 5f61 6d6f 756e 7428 6d61 7463 6865 645f  _amount(matched_
-000141c0: 7472 6164 6573 290a 0a20 2020 2020 2020  trades)..       
-000141d0: 2020 2020 2072 6574 7572 6e20 6d61 7463       return matc
-000141e0: 6865 645f 7472 6164 6573 0a20 2020 2020  hed_trades.     
-000141f0: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
-00014200: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
-00014210: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
-00014220: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
-00014230: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
-00014240: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
-00014250: 6378 742e 4e65 7477 6f72 6b45 7272 6f72  cxt.NetworkError
-00014260: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
-00014270: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
-00014280: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
-00014290: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
-000142a0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
-000142b0: 436f 756c 6420 6e6f 7420 6765 7420 7472  Could not get tr
-000142c0: 6164 6573 2064 7565 2074 6f20 7b65 2e5f  ades due to {e._
-000142d0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
-000142e0: 5f7d 2e20 4d65 7373 6167 653a 207b 657d  _}. Message: {e}
-000142f0: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
-00014300: 2020 6578 6365 7074 2063 6378 742e 4261    except ccxt.Ba
-00014310: 7365 4572 726f 7220 6173 2065 3a0a 2020  seError as e:.  
-00014320: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00014330: 4f70 6572 6174 696f 6e61 6c45 7863 6570  OperationalExcep
-00014340: 7469 6f6e 2865 2920 6672 6f6d 2065 0a0a  tion(e) from e..
-00014350: 2020 2020 6465 6620 6765 745f 6f72 6465      def get_orde
-00014360: 725f 6964 5f63 6f6e 6469 7469 6f6e 616c  r_id_conditional
-00014370: 2873 656c 662c 206f 7264 6572 3a20 4469  (self, order: Di
-00014380: 6374 5b73 7472 2c20 416e 795d 2920 2d3e  ct[str, Any]) ->
-00014390: 2073 7472 3a0a 2020 2020 2020 2020 7265   str:.        re
-000143a0: 7475 726e 206f 7264 6572 5b27 6964 275d  turn order['id']
-000143b0: 0a0a 2020 2020 4072 6574 7269 6572 0a20  ..    @retrier. 
-000143c0: 2020 2064 6566 2067 6574 5f66 6565 2873     def get_fee(s
-000143d0: 656c 662c 2073 796d 626f 6c3a 2073 7472  elf, symbol: str
-000143e0: 2c20 7479 7065 3a20 7374 7220 3d20 2727  , type: str = ''
-000143f0: 2c20 7369 6465 3a20 7374 7220 3d20 2727  , side: str = ''
-00014400: 2c20 616d 6f75 6e74 3a20 666c 6f61 7420  , amount: float 
-00014410: 3d20 312c 0a20 2020 2020 2020 2020 2020  = 1,.           
-00014420: 2020 2020 2070 7269 6365 3a20 666c 6f61       price: floa
-00014430: 7420 3d20 312c 2074 616b 6572 5f6f 725f  t = 1, taker_or_
-00014440: 6d61 6b65 723a 204d 616b 6572 5461 6b65  maker: MakerTake
-00014450: 7220 3d20 276d 616b 6572 2729 202d 3e20  r = 'maker') -> 
-00014460: 666c 6f61 743a 0a20 2020 2020 2020 2022  float:.        "
-00014470: 2222 0a20 2020 2020 2020 2052 6574 7269  "".        Retri
-00014480: 6576 6520 6665 6520 6672 6f6d 2065 7863  eve fee from exc
-00014490: 6861 6e67 650a 2020 2020 2020 2020 3a70  hange.        :p
-000144a0: 6172 616d 2073 796d 626f 6c3a 2050 6169  aram symbol: Pai
-000144b0: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
-000144c0: 2074 7970 653a 2054 7970 6520 6f66 206f   type: Type of o
-000144d0: 7264 6572 2028 6d61 726b 6574 2c20 6c69  rder (market, li
-000144e0: 6d69 742c 202e 2e2e 290a 2020 2020 2020  mit, ...).      
-000144f0: 2020 3a70 6172 616d 2073 6964 653a 2053    :param side: S
-00014500: 6964 6520 6f66 206f 7264 6572 2028 6275  ide of order (bu
-00014510: 792c 2073 656c 6c29 0a20 2020 2020 2020  y, sell).       
-00014520: 203a 7061 7261 6d20 616d 6f75 6e74 3a20   :param amount: 
-00014530: 416d 6f75 6e74 206f 6620 6f72 6465 720a  Amount of order.
-00014540: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00014550: 7269 6365 3a20 5072 6963 6520 6f66 206f  rice: Price of o
-00014560: 7264 6572 0a20 2020 2020 2020 203a 7061  rder.        :pa
-00014570: 7261 6d20 7461 6b65 725f 6f72 5f6d 616b  ram taker_or_mak
-00014580: 6572 3a20 276d 616b 6572 2720 6f72 2027  er: 'maker' or '
-00014590: 7461 6b65 7227 2028 6967 6e6f 7265 6420  taker' (ignored 
-000145a0: 6966 2022 7479 7065 2220 6973 2070 726f  if "type" is pro
-000145b0: 7669 6465 6429 0a20 2020 2020 2020 2022  vided).        "
-000145c0: 2222 0a20 2020 2020 2020 2069 6620 7479  "".        if ty
-000145d0: 7065 2061 6e64 2074 7970 6520 3d3d 2027  pe and type == '
-000145e0: 6d61 726b 6574 273a 0a20 2020 2020 2020  market':.       
-000145f0: 2020 2020 2074 616b 6572 5f6f 725f 6d61       taker_or_ma
-00014600: 6b65 7220 3d20 2774 616b 6572 270a 2020  ker = 'taker'.  
-00014610: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-00014620: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
-00014630: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
-00014640: 5d20 616e 6420 7365 6c66 2e5f 636f 6e66  ] and self._conf
-00014650: 6967 2e67 6574 2827 6665 6527 2c20 4e6f  ig.get('fee', No
-00014660: 6e65 2920 6973 206e 6f74 204e 6f6e 653a  ne) is not None:
-00014670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014680: 2072 6574 7572 6e20 7365 6c66 2e5f 636f   return self._co
-00014690: 6e66 6967 5b27 6665 6527 5d0a 2020 2020  nfig['fee'].    
-000146a0: 2020 2020 2020 2020 2320 7661 6c69 6461          # valida
-000146b0: 7465 2074 6861 7420 6d61 726b 6574 7320  te that markets 
-000146c0: 6172 6520 6c6f 6164 6564 2062 6566 6f72  are loaded befor
-000146d0: 6520 7472 7969 6e67 2074 6f20 6765 7420  e trying to get 
-000146e0: 6665 650a 2020 2020 2020 2020 2020 2020  fee.            
-000146f0: 6966 2073 656c 662e 5f61 7069 2e6d 6172  if self._api.mar
-00014700: 6b65 7473 2069 7320 4e6f 6e65 206f 7220  kets is None or 
-00014710: 6c65 6e28 7365 6c66 2e5f 6170 692e 6d61  len(self._api.ma
-00014720: 726b 6574 7329 203d 3d20 303a 0a20 2020  rkets) == 0:.   
-00014730: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00014740: 662e 5f61 7069 2e6c 6f61 645f 6d61 726b  f._api.load_mark
-00014750: 6574 7328 7061 7261 6d73 3d7b 7d29 0a0a  ets(params={})..
-00014760: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00014770: 726e 2073 656c 662e 5f61 7069 2e63 616c  rn self._api.cal
-00014780: 6375 6c61 7465 5f66 6565 2873 796d 626f  culate_fee(symbo
-00014790: 6c3d 7379 6d62 6f6c 2c20 7479 7065 3d74  l=symbol, type=t
-000147a0: 7970 652c 2073 6964 653d 7369 6465 2c20  ype, side=side, 
-000147b0: 616d 6f75 6e74 3d61 6d6f 756e 742c 0a20  amount=amount,. 
-000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000147e0: 2020 2020 2020 2020 2020 7072 6963 653d            price=
-000147f0: 7072 6963 652c 2074 616b 6572 4f72 4d61  price, takerOrMa
-00014800: 6b65 723d 7461 6b65 725f 6f72 5f6d 616b  ker=taker_or_mak
-00014810: 6572 295b 2772 6174 6527 5d0a 2020 2020  er)['rate'].    
-00014820: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
-00014830: 4444 6f53 5072 6f74 6563 7469 6f6e 2061  DDoSProtection a
-00014840: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-00014850: 2072 6169 7365 2044 446f 7350 726f 7465   raise DDosProte
-00014860: 6374 696f 6e28 6529 2066 726f 6d20 650a  ction(e) from e.
-00014870: 2020 2020 2020 2020 6578 6365 7074 2028          except (
-00014880: 6363 7874 2e4e 6574 776f 726b 4572 726f  ccxt.NetworkErro
-00014890: 722c 2063 6378 742e 4578 6368 616e 6765  r, ccxt.Exchange
-000148a0: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
-000148b0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-000148c0: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
-000148d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000148e0: 2743 6f75 6c64 206e 6f74 2067 6574 2066  'Could not get f
-000148f0: 6565 2069 6e66 6f20 6475 6520 746f 207b  ee info due to {
-00014900: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00014910: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-00014920: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-00014930: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-00014940: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-00014950: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00014960: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-00014970: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-00014980: 650a 0a20 2020 2040 7374 6174 6963 6d65  e..    @staticme
-00014990: 7468 6f64 0a20 2020 2064 6566 206f 7264  thod.    def ord
-000149a0: 6572 5f68 6173 5f66 6565 286f 7264 6572  er_has_fee(order
-000149b0: 3a20 4469 6374 2920 2d3e 2062 6f6f 6c3a  : Dict) -> bool:
-000149c0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000149d0: 2020 2020 2056 6572 6966 6965 7320 6966       Verifies if
-000149e0: 2074 6865 2070 6173 7365 6420 696e 206f   the passed in o
-000149f0: 7264 6572 2064 6963 7420 6861 7320 7468  rder dict has th
-00014a00: 6520 6e65 6564 6564 206b 6579 7320 746f  e needed keys to
-00014a10: 2065 7874 7261 6374 2066 6565 732c 0a20   extract fees,. 
-00014a20: 2020 2020 2020 2061 6e64 2074 6861 7420         and that 
-00014a30: 7468 6573 6520 6b65 7973 2028 6375 7272  these keys (curr
-00014a40: 656e 6379 2c20 636f 7374 2920 6172 6520  ency, cost) are 
-00014a50: 6e6f 7420 656d 7074 792e 0a20 2020 2020  not empty..     
-00014a60: 2020 203a 7061 7261 6d20 6f72 6465 723a     :param order:
-00014a70: 204f 7264 6572 206f 7220 7472 6164 6520   Order or trade 
-00014a80: 286f 6e65 2074 7261 6465 2920 6469 6374  (one trade) dict
-00014a90: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00014aa0: 3a20 5472 7565 2069 6620 7468 6520 6665  : True if the fe
-00014ab0: 6520 7375 6273 7472 7563 7475 7265 2063  e substructure c
-00014ac0: 6f6e 7461 696e 7320 6375 7272 656e 6379  ontains currency
-00014ad0: 2061 6e64 2063 6f73 742c 2066 616c 7365   and cost, false
-00014ae0: 206f 7468 6572 7769 7365 0a20 2020 2020   otherwise.     
-00014af0: 2020 2022 2222 0a20 2020 2020 2020 2069     """.        i
-00014b00: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-00014b10: 286f 7264 6572 2c20 6469 6374 293a 0a20  (order, dict):. 
-00014b20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00014b30: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
-00014b40: 7265 7475 726e 2028 2766 6565 2720 696e  return ('fee' in
-00014b50: 206f 7264 6572 2061 6e64 206f 7264 6572   order and order
-00014b60: 5b27 6665 6527 5d20 6973 206e 6f74 204e  ['fee'] is not N
-00014b70: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00014b80: 2020 2020 616e 6420 286f 7264 6572 5b27      and (order['
-00014b90: 6665 6527 5d2e 6b65 7973 2829 203e 3d20  fee'].keys() >= 
-00014ba0: 7b27 6375 7272 656e 6379 272c 2027 636f  {'currency', 'co
-00014bb0: 7374 277d 290a 2020 2020 2020 2020 2020  st'}).          
-00014bc0: 2020 2020 2020 616e 6420 6f72 6465 725b        and order[
-00014bd0: 2766 6565 275d 5b27 6375 7272 656e 6379  'fee']['currency
-00014be0: 275d 2069 7320 6e6f 7420 4e6f 6e65 0a20  '] is not None. 
-00014bf0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00014c00: 6e64 206f 7264 6572 5b27 6665 6527 5d5b  nd order['fee'][
-00014c10: 2763 6f73 7427 5d20 6973 206e 6f74 204e  'cost'] is not N
-00014c20: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-00014c30: 2020 2020 290a 0a20 2020 2064 6566 2063      )..    def c
-00014c40: 616c 6375 6c61 7465 5f66 6565 5f72 6174  alculate_fee_rat
-00014c50: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
-00014c60: 656c 662c 2066 6565 3a20 4469 6374 2c20  elf, fee: Dict, 
-00014c70: 7379 6d62 6f6c 3a20 7374 722c 2063 6f73  symbol: str, cos
-00014c80: 743a 2066 6c6f 6174 2c20 616d 6f75 6e74  t: float, amount
-00014c90: 3a20 666c 6f61 7429 202d 3e20 4f70 7469  : float) -> Opti
-00014ca0: 6f6e 616c 5b66 6c6f 6174 5d3a 0a20 2020  onal[float]:.   
-00014cb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00014cc0: 2043 616c 6375 6c61 7465 2066 6565 2072   Calculate fee r
-00014cd0: 6174 6520 6966 2069 7427 7320 6e6f 7420  ate if it's not 
-00014ce0: 6769 7665 6e20 6279 2074 6865 2065 7863  given by the exc
-00014cf0: 6861 6e67 652e 0a20 2020 2020 2020 203a  hange..        :
-00014d00: 7061 7261 6d20 6665 653a 2063 6378 7420  param fee: ccxt 
-00014d10: 4665 6520 6469 6374 202d 206d 7573 7420  Fee dict - must 
-00014d20: 636f 6e74 6169 6e20 636f 7374 202f 2063  contain cost / c
-00014d30: 7572 7265 6e63 7920 2f20 7261 7465 0a20  urrency / rate. 
-00014d40: 2020 2020 2020 203a 7061 7261 6d20 7379         :param sy
-00014d50: 6d62 6f6c 3a20 5379 6d62 6f6c 206f 6620  mbol: Symbol of 
-00014d60: 7468 6520 6f72 6465 720a 2020 2020 2020  the order.      
-00014d70: 2020 3a70 6172 616d 2063 6f73 743a 2054    :param cost: T
-00014d80: 6f74 616c 2063 6f73 7420 6f66 2074 6865  otal cost of the
-00014d90: 206f 7264 6572 0a20 2020 2020 2020 203a   order.        :
-00014da0: 7061 7261 6d20 616d 6f75 6e74 3a20 416d  param amount: Am
-00014db0: 6f75 6e74 206f 6620 7468 6520 6f72 6465  ount of the orde
-00014dc0: 720a 2020 2020 2020 2020 2222 220a 2020  r.        """.  
-00014dd0: 2020 2020 2020 6966 2066 6565 2e67 6574        if fee.get
-00014de0: 2827 7261 7465 2729 2069 7320 6e6f 7420  ('rate') is not 
-00014df0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00014e00: 2020 7265 7475 726e 2066 6565 2e67 6574    return fee.get
-00014e10: 2827 7261 7465 2729 0a20 2020 2020 2020  ('rate').       
-00014e20: 2066 6565 5f63 7572 7220 3d20 6665 652e   fee_curr = fee.
-00014e30: 6765 7428 2763 7572 7265 6e63 7927 290a  get('currency').
-00014e40: 2020 2020 2020 2020 6966 2066 6565 5f63          if fee_c
-00014e50: 7572 7220 6973 204e 6f6e 653a 0a20 2020  urr is None:.   
-00014e60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00014e70: 4e6f 6e65 0a20 2020 2020 2020 2066 6565  None.        fee
-00014e80: 5f63 6f73 7420 3d20 666c 6f61 7428 6665  _cost = float(fe
-00014e90: 655b 2763 6f73 7427 5d29 0a0a 2020 2020  e['cost'])..    
-00014ea0: 2020 2020 2320 4361 6c63 756c 6174 6520      # Calculate 
-00014eb0: 6665 6520 6261 7365 6420 6f6e 206f 7264  fee based on ord
-00014ec0: 6572 2064 6574 6169 6c73 0a20 2020 2020  er details.     
-00014ed0: 2020 2069 6620 6665 655f 6375 7272 203d     if fee_curr =
-00014ee0: 3d20 7365 6c66 2e67 6574 5f70 6169 725f  = self.get_pair_
-00014ef0: 6261 7365 5f63 7572 7265 6e63 7928 7379  base_currency(sy
-00014f00: 6d62 6f6c 293a 0a20 2020 2020 2020 2020  mbol):.         
-00014f10: 2020 2023 2042 6173 6520 6375 7272 656e     # Base curren
-00014f20: 6379 202d 2064 6976 6964 6520 6279 2061  cy - divide by a
-00014f30: 6d6f 756e 740a 2020 2020 2020 2020 2020  mount.          
-00014f40: 2020 7265 7475 726e 2072 6f75 6e64 2866    return round(f
-00014f50: 6565 5f63 6f73 7420 2f20 616d 6f75 6e74  ee_cost / amount
-00014f60: 2c20 3829 0a20 2020 2020 2020 2065 6c69  , 8).        eli
-00014f70: 6620 6665 655f 6375 7272 203d 3d20 7365  f fee_curr == se
-00014f80: 6c66 2e67 6574 5f70 6169 725f 7175 6f74  lf.get_pair_quot
-00014f90: 655f 6375 7272 656e 6379 2873 796d 626f  e_currency(symbo
-00014fa0: 6c29 3a0a 2020 2020 2020 2020 2020 2020  l):.            
-00014fb0: 2320 5175 6f74 6520 6375 7272 656e 6379  # Quote currency
-00014fc0: 202d 2064 6976 6964 6520 6279 2063 6f73   - divide by cos
-00014fd0: 740a 2020 2020 2020 2020 2020 2020 7265  t.            re
-00014fe0: 7475 726e 2072 6f75 6e64 2866 6565 5f63  turn round(fee_c
-00014ff0: 6f73 7420 2f20 636f 7374 2c20 3829 2069  ost / cost, 8) i
-00015000: 6620 636f 7374 2065 6c73 6520 4e6f 6e65  f cost else None
-00015010: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00015020: 2020 2020 2020 2020 2020 2023 2049 6620             # If 
-00015030: 4665 6520 6375 7272 656e 6379 2069 7320  Fee currency is 
-00015040: 6120 6469 6666 6572 656e 7420 6375 7272  a different curr
-00015050: 656e 6379 0a20 2020 2020 2020 2020 2020  ency.           
-00015060: 2069 6620 6e6f 7420 636f 7374 3a0a 2020   if not cost:.  
-00015070: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00015080: 4966 2063 6f73 7420 6973 204e 6f6e 6520  If cost is None 
-00015090: 6f72 2030 2e30 202d 3e20 6661 6c73 792c  or 0.0 -> falsy,
-000150a0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-000150b0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000150c0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-000150d0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-000150e0: 2020 2020 2020 2020 2020 636f 6d62 203d            comb =
-000150f0: 2073 656c 662e 6765 745f 7661 6c69 645f   self.get_valid_
-00015100: 7061 6972 5f63 6f6d 6269 6e61 7469 6f6e  pair_combination
-00015110: 2866 6565 5f63 7572 722c 2073 656c 662e  (fee_curr, self.
-00015120: 5f63 6f6e 6669 675b 2773 7461 6b65 5f63  _config['stake_c
-00015130: 7572 7265 6e63 7927 5d29 0a20 2020 2020  urrency']).     
-00015140: 2020 2020 2020 2020 2020 2074 6963 6b20             tick 
-00015150: 3d20 7365 6c66 2e66 6574 6368 5f74 6963  = self.fetch_tic
-00015160: 6b65 7228 636f 6d62 290a 0a20 2020 2020  ker(comb)..     
-00015170: 2020 2020 2020 2020 2020 2066 6565 5f74             fee_t
-00015180: 6f5f 7175 6f74 655f 7261 7465 203d 2073  o_quote_rate = s
-00015190: 6166 655f 7661 6c75 655f 6661 6c6c 6261  afe_value_fallba
-000151a0: 636b 3228 7469 636b 2c20 7469 636b 2c20  ck2(tick, tick, 
-000151b0: 276c 6173 7427 2c20 2761 736b 2729 0a20  'last', 'ask'). 
-000151c0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000151d0: 7420 2856 616c 7565 4572 726f 722c 2045  t (ValueError, E
-000151e0: 7863 6861 6e67 6545 7272 6f72 293a 0a20  xchangeError):. 
-000151f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00015200: 6565 5f74 6f5f 7175 6f74 655f 7261 7465  ee_to_quote_rate
-00015210: 203d 2073 656c 662e 5f63 6f6e 6669 675b   = self._config[
-00015220: 2765 7863 6861 6e67 6527 5d2e 6765 7428  'exchange'].get(
-00015230: 2775 6e6b 6e6f 776e 5f66 6565 5f72 6174  'unknown_fee_rat
-00015240: 6527 2c20 4e6f 6e65 290a 2020 2020 2020  e', None).      
-00015250: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00015260: 2066 6565 5f74 6f5f 7175 6f74 655f 7261   fee_to_quote_ra
-00015270: 7465 3a0a 2020 2020 2020 2020 2020 2020  te:.            
-00015280: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-00015290: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000152a0: 7265 7475 726e 2072 6f75 6e64 2828 6665  return round((fe
-000152b0: 655f 636f 7374 202a 2066 6565 5f74 6f5f  e_cost * fee_to_
-000152c0: 7175 6f74 655f 7261 7465 2920 2f20 636f  quote_rate) / co
-000152d0: 7374 2c20 3829 0a0a 2020 2020 6465 6620  st, 8)..    def 
-000152e0: 6578 7472 6163 745f 636f 7374 5f63 7572  extract_cost_cur
-000152f0: 725f 7261 7465 2873 656c 662c 2066 6565  r_rate(self, fee
-00015300: 3a20 4469 6374 2c20 7379 6d62 6f6c 3a20  : Dict, symbol: 
-00015310: 7374 722c 2063 6f73 743a 2066 6c6f 6174  str, cost: float
-00015320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015340: 2061 6d6f 756e 743a 2066 6c6f 6174 2920   amount: float) 
-00015350: 2d3e 2054 7570 6c65 5b66 6c6f 6174 2c20  -> Tuple[float, 
-00015360: 7374 722c 204f 7074 696f 6e61 6c5b 666c  str, Optional[fl
-00015370: 6f61 745d 5d3a 0a20 2020 2020 2020 2022  oat]]:.        "
-00015380: 2222 0a20 2020 2020 2020 2045 7874 7261  "".        Extra
-00015390: 6374 2074 7570 6c65 206f 6620 636f 7374  ct tuple of cost
-000153a0: 2c20 6375 7272 656e 6379 2c20 7261 7465  , currency, rate
-000153b0: 2e0a 2020 2020 2020 2020 5265 7175 6972  ..        Requir
-000153c0: 6573 206f 7264 6572 5f68 6173 5f66 6565  es order_has_fee
-000153d0: 2074 6f20 7275 6e20 6669 7273 7421 0a20   to run first!. 
-000153e0: 2020 2020 2020 203a 7061 7261 6d20 6665         :param fe
-000153f0: 653a 2063 6378 7420 4665 6520 6469 6374  e: ccxt Fee dict
-00015400: 202d 206d 7573 7420 636f 6e74 6169 6e20   - must contain 
-00015410: 636f 7374 202f 2063 7572 7265 6e63 7920  cost / currency 
-00015420: 2f20 7261 7465 0a20 2020 2020 2020 203a  / rate.        :
-00015430: 7061 7261 6d20 7379 6d62 6f6c 3a20 5379  param symbol: Sy
-00015440: 6d62 6f6c 206f 6620 7468 6520 6f72 6465  mbol of the orde
-00015450: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
-00015460: 2063 6f73 743a 2054 6f74 616c 2063 6f73   cost: Total cos
-00015470: 7420 6f66 2074 6865 206f 7264 6572 0a20  t of the order. 
-00015480: 2020 2020 2020 203a 7061 7261 6d20 616d         :param am
-00015490: 6f75 6e74 3a20 416d 6f75 6e74 206f 6620  ount: Amount of 
-000154a0: 7468 6520 6f72 6465 720a 2020 2020 2020  the order.      
-000154b0: 2020 3a72 6574 7572 6e3a 2054 7570 6c65    :return: Tuple
-000154c0: 2077 6974 6820 636f 7374 2c20 6375 7272   with cost, curr
-000154d0: 656e 6379 2c20 7261 7465 206f 6620 7468  ency, rate of th
-000154e0: 6520 6769 7665 6e20 6665 6520 6469 6374  e given fee dict
-000154f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00015500: 2020 2020 2072 6574 7572 6e20 2866 6c6f       return (flo
-00015510: 6174 2866 6565 5b27 636f 7374 275d 292c  at(fee['cost']),
-00015520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015530: 2066 6565 5b27 6375 7272 656e 6379 275d   fee['currency']
-00015540: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015550: 2020 7365 6c66 2e63 616c 6375 6c61 7465    self.calculate
-00015560: 5f66 6565 5f72 6174 6528 0a20 2020 2020  _fee_rate(.     
-00015570: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00015580: 6565 2c0a 2020 2020 2020 2020 2020 2020  ee,.            
-00015590: 2020 2020 2020 2020 7379 6d62 6f6c 2c0a          symbol,.
-000155a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155b0: 2020 2020 636f 7374 2c0a 2020 2020 2020      cost,.      
-000155c0: 2020 2020 2020 2020 2020 2020 2020 616d                am
-000155d0: 6f75 6e74 0a20 2020 2020 2020 2020 2020  ount.           
-000155e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000155f0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-00015600: 2020 2320 4869 7374 6f72 6963 2064 6174    # Historic dat
-00015610: 610a 0a20 2020 2064 6566 2067 6574 5f68  a..    def get_h
-00015620: 6973 746f 7269 635f 6f68 6c63 7628 7365  istoric_ohlcv(se
-00015630: 6c66 2c20 7061 6972 3a20 7374 722c 2074  lf, pair: str, t
-00015640: 696d 6566 7261 6d65 3a20 7374 722c 0a20  imeframe: str,. 
-00015650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015660: 2020 2020 2020 2020 2020 7369 6e63 655f            since_
-00015670: 6d73 3a20 696e 742c 2063 616e 646c 655f  ms: int, candle_
-00015680: 7479 7065 3a20 4361 6e64 6c65 5479 7065  type: CandleType
-00015690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000156a0: 2020 2020 2020 2020 2020 2020 2069 735f               is_
-000156b0: 6e65 775f 7061 6972 3a20 626f 6f6c 203d  new_pair: bool =
-000156c0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
-000156d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156e0: 2020 2075 6e74 696c 5f6d 733a 204f 7074     until_ms: Opt
-000156f0: 696f 6e61 6c5b 696e 745d 203d 204e 6f6e  ional[int] = Non
-00015700: 6529 202d 3e20 4c69 7374 3a0a 2020 2020  e) -> List:.    
-00015710: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00015720: 4765 7420 6361 6e64 6c65 2068 6973 746f  Get candle histo
-00015730: 7279 2075 7369 6e67 2061 7379 6e63 696f  ry using asyncio
-00015740: 2061 6e64 2072 6574 7572 6e73 2074 6865   and returns the
-00015750: 206c 6973 7420 6f66 2063 616e 646c 6573   list of candles
-00015760: 2e0a 2020 2020 2020 2020 4861 6e64 6c65  ..        Handle
-00015770: 7320 616c 6c20 6173 796e 6320 776f 726b  s all async work
-00015780: 2066 6f72 2074 6869 732e 0a20 2020 2020   for this..     
-00015790: 2020 2041 7379 6e63 206f 7665 7220 6f6e     Async over on
-000157a0: 6520 7061 6972 2c20 6173 7375 6d69 6e67  e pair, assuming
-000157b0: 2077 6520 6765 7420 6073 656c 662e 6f68   we get `self.oh
-000157c0: 6c63 765f 6361 6e64 6c65 5f6c 696d 6974  lcv_candle_limit
-000157d0: 2829 6020 6361 6e64 6c65 7320 7065 7220  ()` candles per 
-000157e0: 6361 6c6c 2e0a 2020 2020 2020 2020 3a70  call..        :p
-000157f0: 6172 616d 2070 6169 723a 2050 6169 7220  aram pair: Pair 
-00015800: 746f 2064 6f77 6e6c 6f61 640a 2020 2020  to download.    
-00015810: 2020 2020 3a70 6172 616d 2074 696d 6566      :param timef
-00015820: 7261 6d65 3a20 5469 6d65 6672 616d 6520  rame: Timeframe 
-00015830: 746f 2067 6574 2064 6174 6120 666f 720a  to get data for.
-00015840: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-00015850: 696e 6365 5f6d 733a 2054 696d 6573 7461  ince_ms: Timesta
-00015860: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
-00015870: 6473 2074 6f20 6765 7420 6869 7374 6f72  ds to get histor
-00015880: 7920 6672 6f6d 0a20 2020 2020 2020 203a  y from.        :
-00015890: 7061 7261 6d20 756e 7469 6c5f 6d73 3a20  param until_ms: 
-000158a0: 5469 6d65 7374 616d 7020 696e 206d 696c  Timestamp in mil
-000158b0: 6c69 7365 636f 6e64 7320 746f 2067 6574  liseconds to get
-000158c0: 2068 6973 746f 7279 2075 7020 746f 0a20   history up to. 
-000158d0: 2020 2020 2020 203a 7061 7261 6d20 6361         :param ca
-000158e0: 6e64 6c65 5f74 7970 653a 2027 272c 206d  ndle_type: '', m
-000158f0: 6172 6b2c 2069 6e64 6578 2c20 7072 656d  ark, index, prem
-00015900: 6975 6d49 6e64 6578 2c20 6f72 2066 756e  iumIndex, or fun
-00015910: 6469 6e67 5f72 6174 650a 2020 2020 2020  ding_rate.      
-00015920: 2020 3a72 6574 7572 6e3a 204c 6973 7420    :return: List 
-00015930: 7769 7468 2063 616e 646c 6520 284f 484c  with candle (OHL
-00015940: 4356 2920 6461 7461 0a20 2020 2020 2020  CV) data.       
-00015950: 2022 2222 0a20 2020 2020 2020 2070 6169   """.        pai
-00015960: 722c 205f 2c20 5f2c 2064 6174 612c 205f  r, _, _, data, _
-00015970: 203d 2073 656c 662e 6c6f 6f70 2e72 756e   = self.loop.run
-00015980: 5f75 6e74 696c 5f63 6f6d 706c 6574 6528  _until_complete(
-00015990: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000159a0: 662e 5f61 7379 6e63 5f67 6574 5f68 6973  f._async_get_his
-000159b0: 746f 7269 635f 6f68 6c63 7628 7061 6972  toric_ohlcv(pair
-000159c0: 3d70 6169 722c 2074 696d 6566 7261 6d65  =pair, timeframe
-000159d0: 3d74 696d 6566 7261 6d65 2c0a 2020 2020  =timeframe,.    
-000159e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a00: 2020 2020 2020 2073 696e 6365 5f6d 733d         since_ms=
-00015a10: 7369 6e63 655f 6d73 2c20 756e 7469 6c5f  since_ms, until_
-00015a20: 6d73 3d75 6e74 696c 5f6d 732c 0a20 2020  ms=until_ms,.   
-00015a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a50: 2020 2020 2020 2020 6973 5f6e 6577 5f70          is_new_p
-00015a60: 6169 723d 6973 5f6e 6577 5f70 6169 722c  air=is_new_pair,
-00015a70: 2063 616e 646c 655f 7479 7065 3d63 616e   candle_type=can
-00015a80: 646c 655f 7479 7065 2929 0a20 2020 2020  dle_type)).     
-00015a90: 2020 206c 6f67 6765 722e 696e 666f 2866     logger.info(f
-00015aa0: 2244 6f77 6e6c 6f61 6465 6420 6461 7461  "Downloaded data
-00015ab0: 2066 6f72 207b 7061 6972 7d20 7769 7468   for {pair} with
-00015ac0: 206c 656e 6774 6820 7b6c 656e 2864 6174   length {len(dat
-00015ad0: 6129 7d2e 2229 0a20 2020 2020 2020 2072  a)}.").        r
-00015ae0: 6574 7572 6e20 6461 7461 0a0a 2020 2020  eturn data..    
-00015af0: 6173 796e 6320 6465 6620 5f61 7379 6e63  async def _async
-00015b00: 5f67 6574 5f68 6973 746f 7269 635f 6f68  _get_historic_oh
-00015b10: 6c63 7628 7365 6c66 2c20 7061 6972 3a20  lcv(self, pair: 
-00015b20: 7374 722c 2074 696d 6566 7261 6d65 3a20  str, timeframe: 
-00015b30: 7374 722c 0a20 2020 2020 2020 2020 2020  str,.           
+0000b170: 2027 7461 6b65 7227 2069 6620 696d 6d65   'taker' if imme
+0000b180: 6469 6174 6520 656c 7365 2027 6d61 6b65  diate else 'make
+0000b190: 7227 2c0a 2020 2020 2020 2020 2020 2020  r',.            
+0000b1a0: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
+0000b1b0: 6574 7572 6e20 6f72 6465 720a 0a20 2020  eturn order..   
+0000b1c0: 2064 6566 2066 6574 6368 5f64 7279 5f72   def fetch_dry_r
+0000b1d0: 756e 5f6f 7264 6572 2873 656c 662c 206f  un_order(self, o
+0000b1e0: 7264 6572 5f69 6429 202d 3e20 4469 6374  rder_id) -> Dict
+0000b1f0: 5b73 7472 2c20 416e 795d 3a0a 2020 2020  [str, Any]:.    
+0000b200: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000b210: 5265 7475 726e 2064 7279 2d72 756e 206f  Return dry-run o
+0000b220: 7264 6572 0a20 2020 2020 2020 204f 6e6c  rder.        Onl
+0000b230: 7920 6361 6c6c 2069 6620 7275 6e6e 696e  y call if runnin
+0000b240: 6720 696e 2064 7279 2d72 756e 206d 6f64  g in dry-run mod
+0000b250: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
+0000b260: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000b270: 2020 2020 2020 2020 6f72 6465 7220 3d20          order = 
+0000b280: 7365 6c66 2e5f 6472 795f 7275 6e5f 6f70  self._dry_run_op
+0000b290: 656e 5f6f 7264 6572 735b 6f72 6465 725f  en_orders[order_
+0000b2a0: 6964 5d0a 2020 2020 2020 2020 2020 2020  id].            
+0000b2b0: 6f72 6465 7220 3d20 7365 6c66 2e63 6865  order = self.che
+0000b2c0: 636b 5f64 7279 5f6c 696d 6974 5f6f 7264  ck_dry_limit_ord
+0000b2d0: 6572 5f66 696c 6c65 6428 6f72 6465 7229  er_filled(order)
+0000b2e0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000b2f0: 7572 6e20 6f72 6465 720a 2020 2020 2020  urn order.      
+0000b300: 2020 6578 6365 7074 204b 6579 4572 726f    except KeyErro
+0000b310: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+0000b320: 2020 2020 6672 6f6d 2066 7265 7174 7261      from freqtra
+0000b330: 6465 2e70 6572 7369 7374 656e 6365 2069  de.persistence i
+0000b340: 6d70 6f72 7420 4f72 6465 720a 2020 2020  mport Order.    
+0000b350: 2020 2020 2020 2020 6f72 6465 7220 3d20          order = 
+0000b360: 4f72 6465 722e 6f72 6465 725f 6279 5f69  Order.order_by_i
+0000b370: 6428 6f72 6465 725f 6964 290a 2020 2020  d(order_id).    
+0000b380: 2020 2020 2020 2020 6966 206f 7264 6572          if order
+0000b390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b3a0: 2020 6363 7874 5f6f 7264 6572 203d 206f    ccxt_order = o
+0000b3b0: 7264 6572 2e74 6f5f 6363 7874 5f6f 626a  rder.to_ccxt_obj
+0000b3c0: 6563 7428 7365 6c66 2e5f 6674 5f68 6173  ect(self._ft_has
+0000b3d0: 5b27 7374 6f70 5f70 7269 6365 5f70 726f  ['stop_price_pro
+0000b3e0: 7027 5d29 0a20 2020 2020 2020 2020 2020  p']).           
+0000b3f0: 2020 2020 2073 656c 662e 5f64 7279 5f72       self._dry_r
+0000b400: 756e 5f6f 7065 6e5f 6f72 6465 7273 5b6f  un_open_orders[o
+0000b410: 7264 6572 5f69 645d 203d 2063 6378 745f  rder_id] = ccxt_
+0000b420: 6f72 6465 720a 2020 2020 2020 2020 2020  order.          
+0000b430: 2020 2020 2020 7265 7475 726e 2063 6378        return ccx
+0000b440: 745f 6f72 6465 720a 2020 2020 2020 2020  t_order.        
+0000b450: 2020 2020 2320 4772 6163 6566 756c 6c79      # Gracefully
+0000b460: 2068 616e 646c 6520 6572 726f 7273 2077   handle errors w
+0000b470: 6974 6820 6472 792d 7275 6e20 6f72 6465  ith dry-run orde
+0000b480: 7273 2e0a 2020 2020 2020 2020 2020 2020  rs..            
+0000b490: 7261 6973 6520 496e 7661 6c69 644f 7264  raise InvalidOrd
+0000b4a0: 6572 4578 6365 7074 696f 6e28 0a20 2020  erException(.   
+0000b4b0: 2020 2020 2020 2020 2020 2020 2066 2754               f'T
+0000b4c0: 7269 6564 2074 6f20 6765 7420 616e 2069  ried to get an i
+0000b4d0: 6e76 616c 6964 2064 7279 2d72 756e 2d6f  nvalid dry-run-o
+0000b4e0: 7264 6572 2028 6964 3a20 7b6f 7264 6572  rder (id: {order
+0000b4f0: 5f69 647d 292e 204d 6573 7361 6765 3a20  _id}). Message: 
+0000b500: 7b65 7d27 2920 6672 6f6d 2065 0a0a 2020  {e}') from e..  
+0000b510: 2020 2320 4f72 6465 7220 6861 6e64 6c69    # Order handli
+0000b520: 6e67 0a0a 2020 2020 6465 6620 5f6c 6576  ng..    def _lev
+0000b530: 5f70 7265 7028 7365 6c66 2c20 7061 6972  _prep(self, pair
+0000b540: 3a20 7374 722c 206c 6576 6572 6167 653a  : str, leverage:
+0000b550: 2066 6c6f 6174 2c20 7369 6465 3a20 4275   float, side: Bu
+0000b560: 7953 656c 6c2c 2061 6363 6570 745f 6661  ySell, accept_fa
+0000b570: 696c 3a20 626f 6f6c 203d 2046 616c 7365  il: bool = False
+0000b580: 293a 0a20 2020 2020 2020 2069 6620 7365  ):.        if se
+0000b590: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
+0000b5a0: 213d 2054 7261 6469 6e67 4d6f 6465 2e53  != TradingMode.S
+0000b5b0: 504f 543a 0a20 2020 2020 2020 2020 2020  POT:.           
+0000b5c0: 2073 656c 662e 7365 745f 6d61 7267 696e   self.set_margin
+0000b5d0: 5f6d 6f64 6528 7061 6972 2c20 7365 6c66  _mode(pair, self
+0000b5e0: 2e6d 6172 6769 6e5f 6d6f 6465 2c20 6163  .margin_mode, ac
+0000b5f0: 6365 7074 5f66 6169 6c29 0a20 2020 2020  cept_fail).     
+0000b600: 2020 2020 2020 2073 656c 662e 5f73 6574         self._set
+0000b610: 5f6c 6576 6572 6167 6528 6c65 7665 7261  _leverage(levera
+0000b620: 6765 2c20 7061 6972 2c20 6163 6365 7074  ge, pair, accept
+0000b630: 5f66 6169 6c29 0a0a 2020 2020 6465 6620  _fail)..    def 
+0000b640: 5f67 6574 5f70 6172 616d 7328 0a20 2020  _get_params(.   
+0000b650: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000b660: 2020 2073 6964 653a 2042 7579 5365 6c6c     side: BuySell
+0000b670: 2c0a 2020 2020 2020 2020 6f72 6465 7274  ,.        ordert
+0000b680: 7970 653a 2073 7472 2c0a 2020 2020 2020  ype: str,.      
+0000b690: 2020 6c65 7665 7261 6765 3a20 666c 6f61    leverage: floa
+0000b6a0: 742c 0a20 2020 2020 2020 2072 6564 7563  t,.        reduc
+0000b6b0: 654f 6e6c 793a 2062 6f6f 6c2c 0a20 2020  eOnly: bool,.   
+0000b6c0: 2020 2020 2074 696d 655f 696e 5f66 6f72       time_in_for
+0000b6d0: 6365 3a20 7374 7220 3d20 2747 5443 272c  ce: str = 'GTC',
+0000b6e0: 0a20 2020 2029 202d 3e20 4469 6374 3a0a  .    ) -> Dict:.
+0000b6f0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+0000b700: 2073 656c 662e 5f70 6172 616d 732e 636f   self._params.co
+0000b710: 7079 2829 0a20 2020 2020 2020 2069 6620  py().        if 
+0000b720: 7469 6d65 5f69 6e5f 666f 7263 6520 213d  time_in_force !=
+0000b730: 2027 4754 4327 2061 6e64 206f 7264 6572   'GTC' and order
+0000b740: 7479 7065 2021 3d20 276d 6172 6b65 7427  type != 'market'
+0000b750: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+0000b760: 7261 6d73 2e75 7064 6174 6528 7b27 7469  rams.update({'ti
+0000b770: 6d65 496e 466f 7263 6527 3a20 7469 6d65  meInForce': time
+0000b780: 5f69 6e5f 666f 7263 652e 7570 7065 7228  _in_force.upper(
+0000b790: 297d 290a 2020 2020 2020 2020 6966 2072  )}).        if r
+0000b7a0: 6564 7563 654f 6e6c 793a 0a20 2020 2020  educeOnly:.     
+0000b7b0: 2020 2020 2020 2070 6172 616d 732e 7570         params.up
+0000b7c0: 6461 7465 287b 2772 6564 7563 654f 6e6c  date({'reduceOnl
+0000b7d0: 7927 3a20 5472 7565 7d29 0a20 2020 2020  y': True}).     
+0000b7e0: 2020 2072 6574 7572 6e20 7061 7261 6d73     return params
+0000b7f0: 0a0a 2020 2020 6465 6620 5f6f 7264 6572  ..    def _order
+0000b800: 5f6e 6565 6473 5f70 7269 6365 2873 656c  _needs_price(sel
+0000b810: 662c 206f 7264 6572 7479 7065 3a20 7374  f, ordertype: st
+0000b820: 7229 202d 3e20 626f 6f6c 3a0a 2020 2020  r) -> bool:.    
+0000b830: 2020 2020 7265 7475 726e 2028 0a20 2020      return (.   
+0000b840: 2020 2020 2020 2020 206f 7264 6572 7479           orderty
+0000b850: 7065 2021 3d20 276d 6172 6b65 7427 0a20  pe != 'market'. 
+0000b860: 2020 2020 2020 2020 2020 206f 7220 7365             or se
+0000b870: 6c66 2e5f 6170 692e 6f70 7469 6f6e 732e  lf._api.options.
+0000b880: 6765 7428 2263 7265 6174 654d 6172 6b65  get("createMarke
+0000b890: 7442 7579 4f72 6465 7252 6571 7569 7265  tBuyOrderRequire
+0000b8a0: 7350 7269 6365 222c 2046 616c 7365 290a  sPrice", False).
+0000b8b0: 2020 2020 2020 2020 2020 2020 6f72 2073              or s
+0000b8c0: 656c 662e 5f66 745f 6861 732e 6765 7428  elf._ft_has.get(
+0000b8d0: 276d 6172 6b65 744f 7264 6572 5265 7175  'marketOrderRequ
+0000b8e0: 6972 6573 5072 6963 6527 2c20 4661 6c73  iresPrice', Fals
+0000b8f0: 6529 0a20 2020 2020 2020 2029 0a0a 2020  e).        )..  
+0000b900: 2020 6465 6620 6372 6561 7465 5f6f 7264    def create_ord
+0000b910: 6572 280a 2020 2020 2020 2020 7365 6c66  er(.        self
+0000b920: 2c0a 2020 2020 2020 2020 2a2c 0a20 2020  ,.        *,.   
+0000b930: 2020 2020 2070 6169 723a 2073 7472 2c0a       pair: str,.
+0000b940: 2020 2020 2020 2020 6f72 6465 7274 7970          ordertyp
+0000b950: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
+0000b960: 7369 6465 3a20 4275 7953 656c 6c2c 0a20  side: BuySell,. 
+0000b970: 2020 2020 2020 2061 6d6f 756e 743a 2066         amount: f
+0000b980: 6c6f 6174 2c0a 2020 2020 2020 2020 7261  loat,.        ra
+0000b990: 7465 3a20 666c 6f61 742c 0a20 2020 2020  te: float,.     
+0000b9a0: 2020 206c 6576 6572 6167 653a 2066 6c6f     leverage: flo
+0000b9b0: 6174 2c0a 2020 2020 2020 2020 7265 6475  at,.        redu
+0000b9c0: 6365 4f6e 6c79 3a20 626f 6f6c 203d 2046  ceOnly: bool = F
+0000b9d0: 616c 7365 2c0a 2020 2020 2020 2020 7469  alse,.        ti
+0000b9e0: 6d65 5f69 6e5f 666f 7263 653a 2073 7472  me_in_force: str
+0000b9f0: 203d 2027 4754 4327 2c0a 2020 2020 2920   = 'GTC',.    ) 
+0000ba00: 2d3e 2044 6963 743a 0a20 2020 2020 2020  -> Dict:.       
+0000ba10: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
+0000ba20: 5b27 6472 795f 7275 6e27 5d3a 0a20 2020  ['dry_run']:.   
+0000ba30: 2020 2020 2020 2020 2064 7279 5f6f 7264           dry_ord
+0000ba40: 6572 203d 2073 656c 662e 6372 6561 7465  er = self.create
+0000ba50: 5f64 7279 5f72 756e 5f6f 7264 6572 280a  _dry_run_order(.
+0000ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba70: 7061 6972 2c20 6f72 6465 7274 7970 652c  pair, ordertype,
+0000ba80: 2073 6964 652c 2061 6d6f 756e 742c 2073   side, amount, s
+0000ba90: 656c 662e 7072 6963 655f 746f 5f70 7265  elf.price_to_pre
+0000baa0: 6369 7369 6f6e 2870 6169 722c 2072 6174  cision(pair, rat
+0000bab0: 6529 2c20 6c65 7665 7261 6765 290a 2020  e), leverage).  
+0000bac0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000bad0: 2064 7279 5f6f 7264 6572 0a0a 2020 2020   dry_order..    
+0000bae0: 2020 2020 7061 7261 6d73 203d 2073 656c      params = sel
+0000baf0: 662e 5f67 6574 5f70 6172 616d 7328 7369  f._get_params(si
+0000bb00: 6465 2c20 6f72 6465 7274 7970 652c 206c  de, ordertype, l
+0000bb10: 6576 6572 6167 652c 2072 6564 7563 654f  everage, reduceO
+0000bb20: 6e6c 792c 2074 696d 655f 696e 5f66 6f72  nly, time_in_for
+0000bb30: 6365 290a 0a20 2020 2020 2020 2074 7279  ce)..        try
+0000bb40: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+0000bb50: 5365 7420 7468 6520 7072 6563 6973 696f  Set the precisio
+0000bb60: 6e20 666f 7220 616d 6f75 6e74 2061 6e64  n for amount and
+0000bb70: 2070 7269 6365 2872 6174 6529 2061 7320   price(rate) as 
+0000bb80: 6163 6365 7074 6564 2062 7920 7468 6520  accepted by the 
+0000bb90: 6578 6368 616e 6765 0a20 2020 2020 2020  exchange.       
+0000bba0: 2020 2020 2061 6d6f 756e 7420 3d20 7365       amount = se
+0000bbb0: 6c66 2e61 6d6f 756e 745f 746f 5f70 7265  lf.amount_to_pre
+0000bbc0: 6369 7369 6f6e 2870 6169 722c 2073 656c  cision(pair, sel
+0000bbd0: 662e 5f61 6d6f 756e 745f 746f 5f63 6f6e  f._amount_to_con
+0000bbe0: 7472 6163 7473 2870 6169 722c 2061 6d6f  tracts(pair, amo
+0000bbf0: 756e 7429 290a 2020 2020 2020 2020 2020  unt)).          
+0000bc00: 2020 6e65 6564 735f 7072 6963 6520 3d20    needs_price = 
+0000bc10: 7365 6c66 2e5f 6f72 6465 725f 6e65 6564  self._order_need
+0000bc20: 735f 7072 6963 6528 6f72 6465 7274 7970  s_price(ordertyp
+0000bc30: 6529 0a20 2020 2020 2020 2020 2020 2072  e).            r
+0000bc40: 6174 655f 666f 725f 6f72 6465 7220 3d20  ate_for_order = 
+0000bc50: 7365 6c66 2e70 7269 6365 5f74 6f5f 7072  self.price_to_pr
+0000bc60: 6563 6973 696f 6e28 7061 6972 2c20 7261  ecision(pair, ra
+0000bc70: 7465 2920 6966 206e 6565 6473 5f70 7269  te) if needs_pri
+0000bc80: 6365 2065 6c73 6520 4e6f 6e65 0a0a 2020  ce else None..  
+0000bc90: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000bca0: 2072 6564 7563 654f 6e6c 793a 0a20 2020   reduceOnly:.   
+0000bcb0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000bcc0: 662e 5f6c 6576 5f70 7265 7028 7061 6972  f._lev_prep(pair
+0000bcd0: 2c20 6c65 7665 7261 6765 2c20 7369 6465  , leverage, side
+0000bce0: 290a 0a20 2020 2020 2020 2020 2020 206f  )..            o
+0000bcf0: 7264 6572 203d 2073 656c 662e 5f61 7069  rder = self._api
+0000bd00: 2e63 7265 6174 655f 6f72 6465 7228 0a20  .create_order(. 
+0000bd10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000bd20: 6169 722c 0a20 2020 2020 2020 2020 2020  air,.           
+0000bd30: 2020 2020 206f 7264 6572 7479 7065 2c0a       ordertype,.
+0000bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bd50: 7369 6465 2c0a 2020 2020 2020 2020 2020  side,.          
+0000bd60: 2020 2020 2020 616d 6f75 6e74 2c0a 2020        amount,.  
+0000bd70: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000bd80: 7465 5f66 6f72 5f6f 7264 6572 2c0a 2020  te_for_order,.  
+0000bd90: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0000bda0: 7261 6d73 2c0a 2020 2020 2020 2020 2020  rams,.          
+0000bdb0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000bdc0: 6966 206f 7264 6572 2e67 6574 2827 7374  if order.get('st
+0000bdd0: 6174 7573 2729 2069 7320 4e6f 6e65 3a0a  atus') is None:.
+0000bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bdf0: 2320 4d61 7020 656d 7074 7920 7374 6174  # Map empty stat
+0000be00: 7573 2074 6f20 6f70 656e 2e0a 2020 2020  us to open..    
+0000be10: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000be20: 725b 2773 7461 7475 7327 5d20 3d20 276f  r['status'] = 'o
+0000be30: 7065 6e27 0a0a 2020 2020 2020 2020 2020  pen'..          
+0000be40: 2020 6966 206f 7264 6572 2e67 6574 2827    if order.get('
+0000be50: 7479 7065 2729 2069 7320 4e6f 6e65 3a0a  type') is None:.
+0000be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000be70: 6f72 6465 725b 2774 7970 6527 5d20 3d20  order['type'] = 
+0000be80: 6f72 6465 7274 7970 650a 0a20 2020 2020  ordertype..     
+0000be90: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
+0000bea0: 5f65 7863 6861 6e67 655f 7265 7370 6f6e  _exchange_respon
+0000beb0: 7365 2827 6372 6561 7465 5f6f 7264 6572  se('create_order
+0000bec0: 272c 206f 7264 6572 290a 2020 2020 2020  ', order).      
+0000bed0: 2020 2020 2020 6f72 6465 7220 3d20 7365        order = se
+0000bee0: 6c66 2e5f 6f72 6465 725f 636f 6e74 7261  lf._order_contra
+0000bef0: 6374 735f 746f 5f61 6d6f 756e 7428 6f72  cts_to_amount(or
+0000bf00: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0000bf10: 2072 6574 7572 6e20 6f72 6465 720a 0a20   return order.. 
+0000bf20: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0000bf30: 7874 2e49 6e73 7566 6669 6369 656e 7446  xt.InsufficientF
+0000bf40: 756e 6473 2061 7320 653a 0a20 2020 2020  unds as e:.     
+0000bf50: 2020 2020 2020 2072 6169 7365 2049 6e73         raise Ins
+0000bf60: 7566 6669 6369 656e 7446 756e 6473 4572  ufficientFundsEr
+0000bf70: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000bf80: 2020 2020 2066 2749 6e73 7566 6669 6369       f'Insuffici
+0000bf90: 656e 7420 6675 6e64 7320 746f 2063 7265  ent funds to cre
+0000bfa0: 6174 6520 7b6f 7264 6572 7479 7065 7d20  ate {ordertype} 
+0000bfb0: 7b73 6964 657d 206f 7264 6572 206f 6e20  {side} order on 
+0000bfc0: 6d61 726b 6574 207b 7061 6972 7d2e 2027  market {pair}. '
+0000bfd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000bfe0: 2066 2754 7269 6564 2074 6f20 7b73 6964   f'Tried to {sid
+0000bff0: 657d 2061 6d6f 756e 7420 7b61 6d6f 756e  e} amount {amoun
+0000c000: 747d 2061 7420 7261 7465 207b 7261 7465  t} at rate {rate
+0000c010: 7d2e 270a 2020 2020 2020 2020 2020 2020  }.'.            
+0000c020: 2020 2020 6627 4d65 7373 6167 653a 207b      f'Message: {
+0000c030: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+0000c040: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+0000c050: 496e 7661 6c69 644f 7264 6572 2061 7320  InvalidOrder as 
+0000c060: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000c070: 6169 7365 2049 6e76 616c 6964 4f72 6465  aise InvalidOrde
+0000c080: 7245 7863 6570 7469 6f6e 280a 2020 2020  rException(.    
+0000c090: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
+0000c0a0: 756c 6420 6e6f 7420 6372 6561 7465 207b  uld not create {
+0000c0b0: 6f72 6465 7274 7970 657d 207b 7369 6465  ordertype} {side
+0000c0c0: 7d20 6f72 6465 7220 6f6e 206d 6172 6b65  } order on marke
+0000c0d0: 7420 7b70 6169 727d 2e20 270a 2020 2020  t {pair}. '.    
+0000c0e0: 2020 2020 2020 2020 2020 2020 6627 5472              f'Tr
+0000c0f0: 6965 6420 746f 207b 7369 6465 7d20 616d  ied to {side} am
+0000c100: 6f75 6e74 207b 616d 6f75 6e74 7d20 6174  ount {amount} at
+0000c110: 2072 6174 6520 7b72 6174 657d 2e20 270a   rate {rate}. '.
+0000c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c130: 6627 4d65 7373 6167 653a 207b 657d 2729  f'Message: {e}')
+0000c140: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+0000c150: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+0000c160: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+0000c170: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000c180: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+0000c190: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+0000c1a0: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+0000c1b0: 2e4f 7065 7261 7469 6f6e 4661 696c 6564  .OperationFailed
+0000c1c0: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+0000c1d0: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+0000c1e0: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+0000c1f0: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
+0000c200: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0000c210: 436f 756c 6420 6e6f 7420 706c 6163 6520  Could not place 
+0000c220: 7b73 6964 657d 206f 7264 6572 2064 7565  {side} order due
+0000c230: 2074 6f20 7b65 2e5f 5f63 6c61 7373 5f5f   to {e.__class__
+0000c240: 2e5f 5f6e 616d 655f 5f7d 2e20 4d65 7373  .__name__}. Mess
+0000c250: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+0000c260: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0000c270: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
+0000c280: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0000c290: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+0000c2a0: 6e61 6c45 7863 6570 7469 6f6e 2865 2920  nalException(e) 
+0000c2b0: 6672 6f6d 2065 0a0a 2020 2020 6465 6620  from e..    def 
+0000c2c0: 7374 6f70 6c6f 7373 5f61 646a 7573 7428  stoploss_adjust(
+0000c2d0: 7365 6c66 2c20 7374 6f70 5f6c 6f73 733a  self, stop_loss:
+0000c2e0: 2066 6c6f 6174 2c20 6f72 6465 723a 2044   float, order: D
+0000c2f0: 6963 742c 2073 6964 653a 2073 7472 2920  ict, side: str) 
+0000c300: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
+0000c310: 2022 2222 0a20 2020 2020 2020 2056 6572   """.        Ver
+0000c320: 6966 7920 7374 6f70 5f6c 6f73 7320 6167  ify stop_loss ag
+0000c330: 6169 6e73 7420 7374 6f70 6c6f 7373 2d6f  ainst stoploss-o
+0000c340: 7264 6572 2076 616c 7565 2028 6c69 6d69  rder value (limi
+0000c350: 7420 6f72 2070 7269 6365 290a 2020 2020  t or price).    
+0000c360: 2020 2020 5265 7475 726e 7320 5472 7565      Returns True
+0000c370: 2069 6620 6164 6a75 7374 6d65 6e74 2069   if adjustment i
+0000c380: 7320 6e65 6365 7373 6172 792e 0a20 2020  s necessary..   
+0000c390: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000c3a0: 2069 6620 6e6f 7420 7365 6c66 2e5f 6674   if not self._ft
+0000c3b0: 5f68 6173 2e67 6574 2827 7374 6f70 6c6f  _has.get('stoplo
+0000c3c0: 7373 5f6f 6e5f 6578 6368 616e 6765 2729  ss_on_exchange')
+0000c3d0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000c3e0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0000c3f0: 7863 6570 7469 6f6e 2866 2273 746f 706c  xception(f"stopl
+0000c400: 6f73 7320 6973 206e 6f74 2069 6d70 6c65  oss is not imple
+0000c410: 6d65 6e74 6564 2066 6f72 207b 7365 6c66  mented for {self
+0000c420: 2e6e 616d 657d 2e22 290a 2020 2020 2020  .name}.").      
+0000c430: 2020 7072 6963 655f 7061 7261 6d20 3d20    price_param = 
+0000c440: 7365 6c66 2e5f 6674 5f68 6173 5b27 7374  self._ft_has['st
+0000c450: 6f70 5f70 7269 6365 5f70 726f 7027 5d0a  op_price_prop'].
+0000c460: 2020 2020 2020 2020 7265 7475 726e 2028          return (
+0000c470: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+0000c480: 6572 2e67 6574 2870 7269 6365 5f70 6172  er.get(price_par
+0000c490: 616d 2c20 4e6f 6e65 2920 6973 204e 6f6e  am, None) is Non
+0000c4a0: 650a 2020 2020 2020 2020 2020 2020 6f72  e.            or
+0000c4b0: 2028 2873 6964 6520 3d3d 2022 7365 6c6c   ((side == "sell
+0000c4c0: 2220 616e 6420 7374 6f70 5f6c 6f73 7320  " and stop_loss 
+0000c4d0: 3e20 666c 6f61 7428 6f72 6465 725b 7072  > float(order[pr
+0000c4e0: 6963 655f 7061 7261 6d5d 2929 206f 720a  ice_param])) or.
+0000c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c500: 2873 6964 6520 3d3d 2022 6275 7922 2061  (side == "buy" a
+0000c510: 6e64 2073 746f 705f 6c6f 7373 203c 2066  nd stop_loss < f
+0000c520: 6c6f 6174 286f 7264 6572 5b70 7269 6365  loat(order[price
+0000c530: 5f70 6172 616d 5d29 2929 0a20 2020 2020  _param]))).     
+0000c540: 2020 2029 0a0a 2020 2020 6465 6620 5f67     )..    def _g
+0000c550: 6574 5f73 746f 705f 6f72 6465 725f 7479  et_stop_order_ty
+0000c560: 7065 2873 656c 662c 2075 7365 725f 6f72  pe(self, user_or
+0000c570: 6465 725f 7479 7065 2920 2d3e 2054 7570  der_type) -> Tup
+0000c580: 6c65 5b73 7472 2c20 7374 725d 3a0a 0a20  le[str, str]:.. 
+0000c590: 2020 2020 2020 2061 7661 696c 6162 6c65         available
+0000c5a0: 5f6f 7264 6572 5f54 7970 6573 3a20 4469  _order_Types: Di
+0000c5b0: 6374 5b73 7472 2c20 7374 725d 203d 2073  ct[str, str] = s
+0000c5c0: 656c 662e 5f66 745f 6861 735b 2273 746f  elf._ft_has["sto
+0000c5d0: 706c 6f73 735f 6f72 6465 725f 7479 7065  ploss_order_type
+0000c5e0: 7322 5d0a 0a20 2020 2020 2020 2069 6620  s"]..        if 
+0000c5f0: 7573 6572 5f6f 7264 6572 5f74 7970 6520  user_order_type 
+0000c600: 696e 2061 7661 696c 6162 6c65 5f6f 7264  in available_ord
+0000c610: 6572 5f54 7970 6573 2e6b 6579 7328 293a  er_Types.keys():
+0000c620: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+0000c630: 6572 7479 7065 203d 2061 7661 696c 6162  ertype = availab
+0000c640: 6c65 5f6f 7264 6572 5f54 7970 6573 5b75  le_order_Types[u
+0000c650: 7365 725f 6f72 6465 725f 7479 7065 5d0a  ser_order_type].
+0000c660: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000c670: 2020 2020 2020 2020 2020 2320 4f74 6865            # Othe
+0000c680: 7277 6973 6520 7069 636b 206f 6e6c 7920  rwise pick only 
+0000c690: 6f6e 6520 6176 6169 6c61 626c 650a 2020  one available.  
+0000c6a0: 2020 2020 2020 2020 2020 6f72 6465 7274            ordert
+0000c6b0: 7970 6520 3d20 6c69 7374 2861 7661 696c  ype = list(avail
+0000c6c0: 6162 6c65 5f6f 7264 6572 5f54 7970 6573  able_order_Types
+0000c6d0: 2e76 616c 7565 7328 2929 5b30 5d0a 2020  .values())[0].  
+0000c6e0: 2020 2020 2020 2020 2020 7573 6572 5f6f            user_o
+0000c6f0: 7264 6572 5f74 7970 6520 3d20 6c69 7374  rder_type = list
+0000c700: 2861 7661 696c 6162 6c65 5f6f 7264 6572  (available_order
+0000c710: 5f54 7970 6573 2e6b 6579 7328 2929 5b30  _Types.keys())[0
+0000c720: 5d0a 2020 2020 2020 2020 7265 7475 726e  ].        return
+0000c730: 206f 7264 6572 7479 7065 2c20 7573 6572   ordertype, user
+0000c740: 5f6f 7264 6572 5f74 7970 650a 0a20 2020  _order_type..   
+0000c750: 2064 6566 205f 6765 745f 7374 6f70 5f6c   def _get_stop_l
+0000c760: 696d 6974 5f72 6174 6528 7365 6c66 2c20  imit_rate(self, 
+0000c770: 7374 6f70 5f70 7269 6365 3a20 666c 6f61  stop_price: floa
+0000c780: 742c 206f 7264 6572 5f74 7970 6573 3a20  t, order_types: 
+0000c790: 4469 6374 2c20 7369 6465 3a20 7374 7229  Dict, side: str)
+0000c7a0: 202d 3e20 666c 6f61 743a 0a20 2020 2020   -> float:.     
+0000c7b0: 2020 2023 204c 696d 6974 2070 7269 6365     # Limit price
+0000c7c0: 2074 6872 6573 686f 6c64 3a20 4173 206c   threshold: As l
+0000c7d0: 696d 6974 2070 7269 6365 2073 686f 756c  imit price shoul
+0000c7e0: 6420 616c 7761 7973 2062 6520 6265 6c6f  d always be belo
+0000c7f0: 7720 7374 6f70 2d70 7269 6365 0a20 2020  w stop-price.   
+0000c800: 2020 2020 206c 696d 6974 5f70 7269 6365       limit_price
+0000c810: 5f70 6374 203d 206f 7264 6572 5f74 7970  _pct = order_typ
+0000c820: 6573 2e67 6574 2827 7374 6f70 6c6f 7373  es.get('stoploss
+0000c830: 5f6f 6e5f 6578 6368 616e 6765 5f6c 696d  _on_exchange_lim
+0000c840: 6974 5f72 6174 696f 272c 2030 2e39 3929  it_ratio', 0.99)
+0000c850: 0a20 2020 2020 2020 2069 6620 7369 6465  .        if side
+0000c860: 203d 3d20 2273 656c 6c22 3a0a 2020 2020   == "sell":.    
+0000c870: 2020 2020 2020 2020 6c69 6d69 745f 7261          limit_ra
+0000c880: 7465 203d 2073 746f 705f 7072 6963 6520  te = stop_price 
+0000c890: 2a20 6c69 6d69 745f 7072 6963 655f 7063  * limit_price_pc
+0000c8a0: 740a 2020 2020 2020 2020 656c 7365 3a0a  t.        else:.
+0000c8b0: 2020 2020 2020 2020 2020 2020 6c69 6d69              limi
+0000c8c0: 745f 7261 7465 203d 2073 746f 705f 7072  t_rate = stop_pr
+0000c8d0: 6963 6520 2a20 2832 202d 206c 696d 6974  ice * (2 - limit
+0000c8e0: 5f70 7269 6365 5f70 6374 290a 0a20 2020  _price_pct)..   
+0000c8f0: 2020 2020 2062 6164 5f73 746f 705f 7072       bad_stop_pr
+0000c900: 6963 6520 3d20 2828 7374 6f70 5f70 7269  ice = ((stop_pri
+0000c910: 6365 203c 206c 696d 6974 5f72 6174 6529  ce < limit_rate)
+0000c920: 2069 6620 7369 6465 203d 3d0a 2020 2020   if side ==.    
+0000c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c940: 2020 2020 2020 2273 656c 6c22 2065 6c73        "sell" els
+0000c950: 6520 2873 746f 705f 7072 6963 6520 3e20  e (stop_price > 
+0000c960: 6c69 6d69 745f 7261 7465 2929 0a20 2020  limit_rate)).   
+0000c970: 2020 2020 2023 2045 6e73 7572 6520 7261       # Ensure ra
+0000c980: 7465 2069 7320 6c65 7373 2074 6861 6e20  te is less than 
+0000c990: 7374 6f70 2070 7269 6365 0a20 2020 2020  stop price.     
+0000c9a0: 2020 2069 6620 6261 645f 7374 6f70 5f70     if bad_stop_p
+0000c9b0: 7269 6365 3a0a 2020 2020 2020 2020 2020  rice:.          
+0000c9c0: 2020 2320 5468 6973 2063 616e 2066 6f72    # This can for
+0000c9d0: 2065 7861 6d70 6c65 2068 6170 7065 6e20   example happen 
+0000c9e0: 6966 2074 6865 2073 746f 7020 2f20 6c69  if the stop / li
+0000c9f0: 7175 6964 6174 696f 6e20 7072 6963 6520  quidation price 
+0000ca00: 6973 2073 6574 2074 6f20 300a 2020 2020  is set to 0.    
+0000ca10: 2020 2020 2020 2020 2320 5768 6963 6820          # Which 
+0000ca20: 6973 2070 6f73 7369 626c 6520 6966 2061  is possible if a
+0000ca30: 206d 6172 6b65 742d 6f72 6465 7220 636c   market-order cl
+0000ca40: 6f73 6573 2072 6967 6874 2061 7761 792e  oses right away.
+0000ca50: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+0000ca60: 6865 2049 6e76 616c 6964 4f72 6465 7245  he InvalidOrderE
+0000ca70: 7863 6570 7469 6f6e 2077 696c 6c20 6275  xception will bu
+0000ca80: 6262 6c65 2075 7020 746f 2065 7869 745f  bble up to exit_
+0000ca90: 706f 7369 7469 6f6e 732c 2077 6865 7265  positions, where
+0000caa0: 2069 7420 7769 6c6c 2062 650a 2020 2020   it will be.    
+0000cab0: 2020 2020 2020 2020 2320 6861 6e64 6c65          # handle
+0000cac0: 6420 6772 6163 6566 756c 6c79 2e0a 2020  d gracefully..  
+0000cad0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000cae0: 496e 7661 6c69 644f 7264 6572 4578 6365  InvalidOrderExce
+0000caf0: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+0000cb00: 2020 2020 2020 2022 496e 2073 746f 706c         "In stopl
+0000cb10: 6f73 7320 6c69 6d69 7420 6f72 6465 722c  oss limit order,
+0000cb20: 2073 746f 7020 7072 6963 6520 7368 6f75   stop price shou
+0000cb30: 6c64 2062 6520 6d6f 7265 2074 6861 6e20  ld be more than 
+0000cb40: 6c69 6d69 7420 7072 6963 652e 2022 0a20  limit price. ". 
+0000cb50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000cb60: 2253 746f 7020 7072 6963 653a 207b 7374  "Stop price: {st
+0000cb70: 6f70 5f70 7269 6365 7d2c 204c 696d 6974  op_price}, Limit
+0000cb80: 2070 7269 6365 3a20 7b6c 696d 6974 5f72   price: {limit_r
+0000cb90: 6174 657d 2c20 220a 2020 2020 2020 2020  ate}, ".        
+0000cba0: 2020 2020 2020 2020 6622 4c69 6d69 7420          f"Limit 
+0000cbb0: 5072 6963 6520 7063 743a 207b 6c69 6d69  Price pct: {limi
+0000cbc0: 745f 7072 6963 655f 7063 747d 220a 2020  t_price_pct}".  
+0000cbd0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000cbe0: 2020 2020 2020 2020 7265 7475 726e 206c          return l
+0000cbf0: 696d 6974 5f72 6174 650a 0a20 2020 2064  imit_rate..    d
+0000cc00: 6566 205f 6765 745f 7374 6f70 5f70 6172  ef _get_stop_par
+0000cc10: 616d 7328 7365 6c66 2c20 7369 6465 3a20  ams(self, side: 
+0000cc20: 4275 7953 656c 6c2c 206f 7264 6572 7479  BuySell, orderty
+0000cc30: 7065 3a20 7374 722c 2073 746f 705f 7072  pe: str, stop_pr
+0000cc40: 6963 653a 2066 6c6f 6174 2920 2d3e 2044  ice: float) -> D
+0000cc50: 6963 743a 0a20 2020 2020 2020 2070 6172  ict:.        par
+0000cc60: 616d 7320 3d20 7365 6c66 2e5f 7061 7261  ams = self._para
+0000cc70: 6d73 2e63 6f70 7928 290a 2020 2020 2020  ms.copy().      
+0000cc80: 2020 2320 5665 7269 6679 2069 6620 7374    # Verify if st
+0000cc90: 6f70 5072 6963 6520 776f 726b 7320 666f  opPrice works fo
+0000cca0: 7220 796f 7572 2065 7863 6861 6e67 652c  r your exchange,
+0000ccb0: 2065 6c73 6520 636f 6e66 6967 7572 6520   else configure 
+0000ccc0: 7374 6f70 5f70 7269 6365 5f70 6172 616d  stop_price_param
+0000ccd0: 0a20 2020 2020 2020 2070 6172 616d 732e  .        params.
+0000cce0: 7570 6461 7465 287b 7365 6c66 2e5f 6674  update({self._ft
+0000ccf0: 5f68 6173 5b27 7374 6f70 5f70 7269 6365  _has['stop_price
+0000cd00: 5f70 6172 616d 275d 3a20 7374 6f70 5f70  _param']: stop_p
+0000cd10: 7269 6365 7d29 0a20 2020 2020 2020 2072  rice}).        r
+0000cd20: 6574 7572 6e20 7061 7261 6d73 0a0a 2020  eturn params..  
+0000cd30: 2020 4072 6574 7269 6572 2872 6574 7269    @retrier(retri
+0000cd40: 6573 3d30 290a 2020 2020 6465 6620 6372  es=0).    def cr
+0000cd50: 6561 7465 5f73 746f 706c 6f73 7328 7365  eate_stoploss(se
+0000cd60: 6c66 2c20 7061 6972 3a20 7374 722c 2061  lf, pair: str, a
+0000cd70: 6d6f 756e 743a 2066 6c6f 6174 2c20 7374  mount: float, st
+0000cd80: 6f70 5f70 7269 6365 3a20 666c 6f61 742c  op_price: float,
+0000cd90: 206f 7264 6572 5f74 7970 6573 3a20 4469   order_types: Di
+0000cda0: 6374 2c0a 2020 2020 2020 2020 2020 2020  ct,.            
+0000cdb0: 2020 2020 2020 2020 2020 2020 7369 6465              side
+0000cdc0: 3a20 4275 7953 656c 6c2c 206c 6576 6572  : BuySell, lever
+0000cdd0: 6167 653a 2066 6c6f 6174 2920 2d3e 2044  age: float) -> D
+0000cde0: 6963 743a 0a20 2020 2020 2020 2022 2222  ict:.        """
+0000cdf0: 0a20 2020 2020 2020 2063 7265 6174 6573  .        creates
+0000ce00: 2061 2073 746f 706c 6f73 7320 6f72 6465   a stoploss orde
+0000ce10: 722e 0a20 2020 2020 2020 2072 6571 7569  r..        requi
+0000ce20: 7265 7320 605f 6674 5f68 6173 5b27 7374  res `_ft_has['st
+0000ce30: 6f70 6c6f 7373 5f6f 7264 6572 5f74 7970  oploss_order_typ
+0000ce40: 6573 275d 6020 746f 2062 6520 7365 7420  es']` to be set 
+0000ce50: 6173 2061 2064 6963 7420 6d61 7070 696e  as a dict mappin
+0000ce60: 6720 6c69 6d69 7420 616e 6420 6d61 726b  g limit and mark
+0000ce70: 6574 0a20 2020 2020 2020 2020 2020 2074  et.            t
+0000ce80: 6f20 7468 6520 636f 7272 6573 706f 6e64  o the correspond
+0000ce90: 696e 6720 6578 6368 616e 6765 2074 7970  ing exchange typ
+0000cea0: 652e 0a0a 2020 2020 2020 2020 5468 6520  e...        The 
+0000ceb0: 7072 6563 6973 6520 6f72 6465 7274 7970  precise ordertyp
+0000cec0: 6520 6973 2064 6574 6572 6d69 6e65 6420  e is determined 
+0000ced0: 6279 2074 6865 206f 7264 6572 5f74 7970  by the order_typ
+0000cee0: 6573 2064 6963 7420 6f72 2065 7863 6861  es dict or excha
+0000cef0: 6e67 6520 6465 6661 756c 742e 0a0a 2020  nge default...  
+0000cf00: 2020 2020 2020 5468 6520 6578 6365 7074        The except
+0000cf10: 696f 6e20 6265 6c6f 7720 7368 6f75 6c64  ion below should
+0000cf20: 206e 6576 6572 2072 6169 7365 2c20 7369   never raise, si
+0000cf30: 6e63 6520 7765 2064 6973 616c 6c6f 770a  nce we disallow.
+0000cf40: 2020 2020 2020 2020 7374 6172 7469 6e67          starting
+0000cf50: 2074 6865 2062 6f74 2069 6e20 7661 6c69   the bot in vali
+0000cf60: 6461 7465 5f6f 7264 6572 7479 7065 7328  date_ordertypes(
+0000cf70: 290a 0a20 2020 2020 2020 2054 6869 7320  )..        This 
+0000cf80: 6d61 7920 776f 726b 2077 6974 6820 6120  may work with a 
+0000cf90: 6c69 6d69 7465 6420 6e75 6d62 6572 206f  limited number o
+0000cfa0: 6620 6f74 6865 7220 6578 6368 616e 6765  f other exchange
+0000cfb0: 732c 2062 7574 2063 6f72 7265 6374 2077  s, but correct w
+0000cfc0: 6f72 6b69 6e67 0a20 2020 2020 2020 2020  orking.         
+0000cfd0: 2020 206e 6565 6473 2074 6f20 6265 2074     needs to be t
+0000cfe0: 6573 7465 6420 696e 6469 7669 6475 616c  ested individual
+0000cff0: 6c79 2e0a 2020 2020 2020 2020 5741 524e  ly..        WARN
+0000d000: 494e 473a 2073 6574 7469 6e67 2060 7374  ING: setting `st
+0000d010: 6f70 6c6f 7373 5f6f 6e5f 6578 6368 616e  oploss_on_exchan
+0000d020: 6765 6020 746f 2054 7275 6520 7769 6c6c  ge` to True will
+0000d030: 204e 4f54 2061 7574 6f2d 656e 6162 6c65   NOT auto-enable
+0000d040: 2073 746f 706c 6f73 7320 6f6e 2065 7863   stoploss on exc
+0000d050: 6861 6e67 652e 0a20 2020 2020 2020 2020  hange..         
+0000d060: 2020 2060 7374 6f70 6c6f 7373 5f61 646a     `stoploss_adj
+0000d070: 7573 7460 206d 7573 7420 7374 696c 6c20  ust` must still 
+0000d080: 6265 2069 6d70 6c65 6d65 6e74 6564 2066  be implemented f
+0000d090: 6f72 2074 6869 7320 746f 2077 6f72 6b2e  or this to work.
+0000d0a0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000d0b0: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0000d0c0: 2e5f 6674 5f68 6173 5b27 7374 6f70 6c6f  ._ft_has['stoplo
+0000d0d0: 7373 5f6f 6e5f 6578 6368 616e 6765 275d  ss_on_exchange']
+0000d0e0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000d0f0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0000d100: 7863 6570 7469 6f6e 2866 2273 746f 706c  xception(f"stopl
+0000d110: 6f73 7320 6973 206e 6f74 2069 6d70 6c65  oss is not imple
+0000d120: 6d65 6e74 6564 2066 6f72 207b 7365 6c66  mented for {self
+0000d130: 2e6e 616d 657d 2e22 290a 0a20 2020 2020  .name}.")..     
+0000d140: 2020 2075 7365 725f 6f72 6465 725f 7479     user_order_ty
+0000d150: 7065 203d 206f 7264 6572 5f74 7970 6573  pe = order_types
+0000d160: 2e67 6574 2827 7374 6f70 6c6f 7373 272c  .get('stoploss',
+0000d170: 2027 6d61 726b 6574 2729 0a20 2020 2020   'market').     
+0000d180: 2020 206f 7264 6572 7479 7065 2c20 7573     ordertype, us
+0000d190: 6572 5f6f 7264 6572 5f74 7970 6520 3d20  er_order_type = 
+0000d1a0: 7365 6c66 2e5f 6765 745f 7374 6f70 5f6f  self._get_stop_o
+0000d1b0: 7264 6572 5f74 7970 6528 7573 6572 5f6f  rder_type(user_o
+0000d1c0: 7264 6572 5f74 7970 6529 0a20 2020 2020  rder_type).     
+0000d1d0: 2020 2072 6f75 6e64 5f6d 6f64 6520 3d20     round_mode = 
+0000d1e0: 524f 554e 445f 444f 574e 2069 6620 7369  ROUND_DOWN if si
+0000d1f0: 6465 203d 3d20 2762 7579 2720 656c 7365  de == 'buy' else
+0000d200: 2052 4f55 4e44 5f55 500a 2020 2020 2020   ROUND_UP.      
+0000d210: 2020 7374 6f70 5f70 7269 6365 5f6e 6f72    stop_price_nor
+0000d220: 6d20 3d20 7365 6c66 2e70 7269 6365 5f74  m = self.price_t
+0000d230: 6f5f 7072 6563 6973 696f 6e28 7061 6972  o_precision(pair
+0000d240: 2c20 7374 6f70 5f70 7269 6365 2c20 726f  , stop_price, ro
+0000d250: 756e 6469 6e67 5f6d 6f64 653d 726f 756e  unding_mode=roun
+0000d260: 645f 6d6f 6465 290a 2020 2020 2020 2020  d_mode).        
+0000d270: 6c69 6d69 745f 7261 7465 203d 204e 6f6e  limit_rate = Non
+0000d280: 650a 2020 2020 2020 2020 6966 2075 7365  e.        if use
+0000d290: 725f 6f72 6465 725f 7479 7065 203d 3d20  r_order_type == 
+0000d2a0: 276c 696d 6974 273a 0a20 2020 2020 2020  'limit':.       
+0000d2b0: 2020 2020 206c 696d 6974 5f72 6174 6520       limit_rate 
+0000d2c0: 3d20 7365 6c66 2e5f 6765 745f 7374 6f70  = self._get_stop
+0000d2d0: 5f6c 696d 6974 5f72 6174 6528 7374 6f70  _limit_rate(stop
+0000d2e0: 5f70 7269 6365 2c20 6f72 6465 725f 7479  _price, order_ty
+0000d2f0: 7065 732c 2073 6964 6529 0a20 2020 2020  pes, side).     
+0000d300: 2020 2020 2020 206c 696d 6974 5f72 6174         limit_rat
+0000d310: 6520 3d20 7365 6c66 2e70 7269 6365 5f74  e = self.price_t
+0000d320: 6f5f 7072 6563 6973 696f 6e28 7061 6972  o_precision(pair
+0000d330: 2c20 6c69 6d69 745f 7261 7465 2c20 726f  , limit_rate, ro
+0000d340: 756e 6469 6e67 5f6d 6f64 653d 726f 756e  unding_mode=roun
+0000d350: 645f 6d6f 6465 290a 0a20 2020 2020 2020  d_mode)..       
+0000d360: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
+0000d370: 5b27 6472 795f 7275 6e27 5d3a 0a20 2020  ['dry_run']:.   
+0000d380: 2020 2020 2020 2020 2064 7279 5f6f 7264           dry_ord
+0000d390: 6572 203d 2073 656c 662e 6372 6561 7465  er = self.create
+0000d3a0: 5f64 7279 5f72 756e 5f6f 7264 6572 280a  _dry_run_order(.
+0000d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d3c0: 7061 6972 2c0a 2020 2020 2020 2020 2020  pair,.          
+0000d3d0: 2020 2020 2020 6f72 6465 7274 7970 652c        ordertype,
+0000d3e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d3f0: 2073 6964 652c 0a20 2020 2020 2020 2020   side,.         
+0000d400: 2020 2020 2020 2061 6d6f 756e 742c 0a20         amount,. 
+0000d410: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000d420: 746f 705f 7072 6963 655f 6e6f 726d 2c0a  top_price_norm,.
+0000d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d440: 7374 6f70 5f6c 6f73 733d 5472 7565 2c0a  stop_loss=True,.
+0000d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d460: 6c65 7665 7261 6765 3d6c 6576 6572 6167  leverage=leverag
+0000d470: 652c 0a20 2020 2020 2020 2020 2020 2029  e,.            )
+0000d480: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000d490: 7572 6e20 6472 795f 6f72 6465 720a 0a20  urn dry_order.. 
+0000d4a0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000d4b0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+0000d4c0: 2073 656c 662e 5f67 6574 5f73 746f 705f   self._get_stop_
+0000d4d0: 7061 7261 6d73 2873 6964 653d 7369 6465  params(side=side
+0000d4e0: 2c20 6f72 6465 7274 7970 653d 6f72 6465  , ordertype=orde
+0000d4f0: 7274 7970 652c 0a20 2020 2020 2020 2020  rtype,.         
+0000d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d520: 2020 7374 6f70 5f70 7269 6365 3d73 746f    stop_price=sto
+0000d530: 705f 7072 6963 655f 6e6f 726d 290a 2020  p_price_norm).  
+0000d540: 2020 2020 2020 2020 2020 6966 2073 656c            if sel
+0000d550: 662e 7472 6164 696e 675f 6d6f 6465 203d  f.trading_mode =
+0000d560: 3d20 5472 6164 696e 674d 6f64 652e 4655  = TradingMode.FU
+0000d570: 5455 5245 533a 0a20 2020 2020 2020 2020  TURES:.         
+0000d580: 2020 2020 2020 2070 6172 616d 735b 2772         params['r
+0000d590: 6564 7563 654f 6e6c 7927 5d20 3d20 5472  educeOnly'] = Tr
+0000d5a0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+0000d5b0: 2020 2069 6620 2773 746f 706c 6f73 735f     if 'stoploss_
+0000d5c0: 7072 6963 655f 7479 7065 2720 696e 206f  price_type' in o
+0000d5d0: 7264 6572 5f74 7970 6573 2061 6e64 2027  rder_types and '
+0000d5e0: 7374 6f70 5f70 7269 6365 5f74 7970 655f  stop_price_type_
+0000d5f0: 6669 656c 6427 2069 6e20 7365 6c66 2e5f  field' in self._
+0000d600: 6674 5f68 6173 3a0a 2020 2020 2020 2020  ft_has:.        
+0000d610: 2020 2020 2020 2020 2020 2020 7072 6963              pric
+0000d620: 655f 7479 7065 203d 2073 656c 662e 5f66  e_type = self._f
+0000d630: 745f 6861 735b 2773 746f 705f 7072 6963  t_has['stop_pric
+0000d640: 655f 7479 7065 5f76 616c 7565 5f6d 6170  e_type_value_map
+0000d650: 7069 6e67 275d 5b0a 2020 2020 2020 2020  ping'][.        
+0000d660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d670: 6f72 6465 725f 7479 7065 732e 6765 7428  order_types.get(
+0000d680: 2773 746f 706c 6f73 735f 7072 6963 655f  'stoploss_price_
+0000d690: 7479 7065 272c 2050 7269 6365 5479 7065  type', PriceType
+0000d6a0: 2e4c 4153 5429 5d0a 2020 2020 2020 2020  .LAST)].        
+0000d6b0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+0000d6c0: 6d73 5b73 656c 662e 5f66 745f 6861 735b  ms[self._ft_has[
+0000d6d0: 2773 746f 705f 7072 6963 655f 7479 7065  'stop_price_type
+0000d6e0: 5f66 6965 6c64 275d 5d20 3d20 7072 6963  _field']] = pric
+0000d6f0: 655f 7479 7065 0a0a 2020 2020 2020 2020  e_type..        
+0000d700: 2020 2020 616d 6f75 6e74 203d 2073 656c      amount = sel
+0000d710: 662e 616d 6f75 6e74 5f74 6f5f 7072 6563  f.amount_to_prec
+0000d720: 6973 696f 6e28 7061 6972 2c20 7365 6c66  ision(pair, self
+0000d730: 2e5f 616d 6f75 6e74 5f74 6f5f 636f 6e74  ._amount_to_cont
+0000d740: 7261 6374 7328 7061 6972 2c20 616d 6f75  racts(pair, amou
+0000d750: 6e74 2929 0a0a 2020 2020 2020 2020 2020  nt))..          
+0000d760: 2020 7365 6c66 2e5f 6c65 765f 7072 6570    self._lev_prep
+0000d770: 2870 6169 722c 206c 6576 6572 6167 652c  (pair, leverage,
+0000d780: 2073 6964 652c 2061 6363 6570 745f 6661   side, accept_fa
+0000d790: 696c 3d54 7275 6529 0a20 2020 2020 2020  il=True).       
+0000d7a0: 2020 2020 206f 7264 6572 203d 2073 656c       order = sel
+0000d7b0: 662e 5f61 7069 2e63 7265 6174 655f 6f72  f._api.create_or
+0000d7c0: 6465 7228 7379 6d62 6f6c 3d70 6169 722c  der(symbol=pair,
+0000d7d0: 2074 7970 653d 6f72 6465 7274 7970 652c   type=ordertype,
+0000d7e0: 2073 6964 653d 7369 6465 2c0a 2020 2020   side=side,.    
+0000d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d810: 2020 2020 2020 2061 6d6f 756e 743d 616d         amount=am
+0000d820: 6f75 6e74 2c20 7072 6963 653d 6c69 6d69  ount, price=limi
+0000d830: 745f 7261 7465 2c20 7061 7261 6d73 3d70  t_rate, params=p
+0000d840: 6172 616d 7329 0a20 2020 2020 2020 2020  arams).         
+0000d850: 2020 2073 656c 662e 5f6c 6f67 5f65 7863     self._log_exc
+0000d860: 6861 6e67 655f 7265 7370 6f6e 7365 2827  hange_response('
+0000d870: 6372 6561 7465 5f73 746f 706c 6f73 735f  create_stoploss_
+0000d880: 6f72 6465 7227 2c20 6f72 6465 7229 0a20  order', order). 
+0000d890: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000d8a0: 203d 2073 656c 662e 5f6f 7264 6572 5f63   = self._order_c
+0000d8b0: 6f6e 7472 6163 7473 5f74 6f5f 616d 6f75  ontracts_to_amou
+0000d8c0: 6e74 286f 7264 6572 290a 2020 2020 2020  nt(order).      
+0000d8d0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+0000d8e0: 6f28 6622 7374 6f70 6c6f 7373 207b 7573  o(f"stoploss {us
+0000d8f0: 6572 5f6f 7264 6572 5f74 7970 657d 206f  er_order_type} o
+0000d900: 7264 6572 2061 6464 6564 2066 6f72 207b  rder added for {
+0000d910: 7061 6972 7d2e 2022 0a20 2020 2020 2020  pair}. ".       
+0000d920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d930: 2066 2273 746f 7020 7072 6963 653a 207b   f"stop price: {
+0000d940: 7374 6f70 5f70 7269 6365 7d2e 206c 696d  stop_price}. lim
+0000d950: 6974 3a20 7b6c 696d 6974 5f72 6174 657d  it: {limit_rate}
+0000d960: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0000d970: 6574 7572 6e20 6f72 6465 720a 2020 2020  eturn order.    
+0000d980: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+0000d990: 496e 7375 6666 6963 6965 6e74 4675 6e64  InsufficientFund
+0000d9a0: 7320 6173 2065 3a0a 2020 2020 2020 2020  s as e:.        
+0000d9b0: 2020 2020 7261 6973 6520 496e 7375 6666      raise Insuff
+0000d9c0: 6963 6965 6e74 4675 6e64 7345 7272 6f72  icientFundsError
+0000d9d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d9e0: 2020 6627 496e 7375 6666 6963 6965 6e74    f'Insufficient
+0000d9f0: 2066 756e 6473 2074 6f20 6372 6561 7465   funds to create
+0000da00: 207b 6f72 6465 7274 7970 657d 207b 7369   {ordertype} {si
+0000da10: 6465 7d20 6f72 6465 7220 6f6e 206d 6172  de} order on mar
+0000da20: 6b65 7420 7b70 6169 727d 2e20 270a 2020  ket {pair}. '.  
+0000da30: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0000da40: 5472 6965 6420 746f 207b 7369 6465 7d20  Tried to {side} 
+0000da50: 616d 6f75 6e74 207b 616d 6f75 6e74 7d20  amount {amount} 
+0000da60: 6174 2072 6174 6520 7b6c 696d 6974 5f72  at rate {limit_r
+0000da70: 6174 657d 2077 6974 6820 270a 2020 2020  ate} with '.    
+0000da80: 2020 2020 2020 2020 2020 2020 6627 7374              f'st
+0000da90: 6f70 2d70 7269 6365 207b 7374 6f70 5f70  op-price {stop_p
+0000daa0: 7269 6365 5f6e 6f72 6d7d 2e20 4d65 7373  rice_norm}. Mess
+0000dab0: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+0000dac0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+0000dad0: 2028 6363 7874 2e49 6e76 616c 6964 4f72   (ccxt.InvalidOr
+0000dae0: 6465 722c 2063 6378 742e 4261 6452 6571  der, ccxt.BadReq
+0000daf0: 7565 7374 2c20 6363 7874 2e4f 7065 7261  uest, ccxt.Opera
+0000db00: 7469 6f6e 5265 6a65 6374 6564 2920 6173  tionRejected) as
+0000db10: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000db20: 2320 4572 726f 7273 3a0a 2020 2020 2020  # Errors:.      
+0000db30: 2020 2020 2020 2320 604f 7264 6572 2077        # `Order w
+0000db40: 6f75 6c64 2074 7269 6767 6572 2069 6d6d  ould trigger imm
+0000db50: 6564 6961 7465 6c79 2e60 0a20 2020 2020  ediately.`.     
+0000db60: 2020 2020 2020 2072 6169 7365 2049 6e76         raise Inv
+0000db70: 616c 6964 4f72 6465 7245 7863 6570 7469  alidOrderExcepti
+0000db80: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
+0000db90: 2020 2020 6627 436f 756c 6420 6e6f 7420      f'Could not 
+0000dba0: 6372 6561 7465 207b 6f72 6465 7274 7970  create {ordertyp
+0000dbb0: 657d 207b 7369 6465 7d20 6f72 6465 7220  e} {side} order 
+0000dbc0: 6f6e 206d 6172 6b65 7420 7b70 6169 727d  on market {pair}
+0000dbd0: 2e20 270a 2020 2020 2020 2020 2020 2020  . '.            
+0000dbe0: 2020 2020 6627 5472 6965 6420 746f 207b      f'Tried to {
+0000dbf0: 7369 6465 7d20 616d 6f75 6e74 207b 616d  side} amount {am
+0000dc00: 6f75 6e74 7d20 6174 2072 6174 6520 7b6c  ount} at rate {l
+0000dc10: 696d 6974 5f72 6174 657d 2077 6974 6820  imit_rate} with 
+0000dc20: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
+0000dc30: 2020 6627 7374 6f70 2d70 7269 6365 207b    f'stop-price {
+0000dc40: 7374 6f70 5f70 7269 6365 5f6e 6f72 6d7d  stop_price_norm}
+0000dc50: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
+0000dc60: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+0000dc70: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+0000dc80: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+0000dc90: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000dca0: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+0000dcb0: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+0000dcc0: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+0000dcd0: 2e4f 7065 7261 7469 6f6e 4661 696c 6564  .OperationFailed
+0000dce0: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+0000dcf0: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+0000dd00: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+0000dd10: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
+0000dd20: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0000dd30: 436f 756c 6420 6e6f 7420 706c 6163 6520  Could not place 
+0000dd40: 7374 6f70 6c6f 7373 206f 7264 6572 2064  stoploss order d
+0000dd50: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
+0000dd60: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 220a  __.__name__}. ".
+0000dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd80: 6622 4d65 7373 6167 653a 207b 657d 2229  f"Message: {e}")
+0000dd90: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+0000dda0: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
+0000ddb0: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
+0000ddc0: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
+0000ddd0: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
+0000dde0: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
+0000ddf0: 2020 6465 6620 6665 7463 685f 6f72 6465    def fetch_orde
+0000de00: 725f 656d 756c 6174 6564 2873 656c 662c  r_emulated(self,
+0000de10: 206f 7264 6572 5f69 643a 2073 7472 2c20   order_id: str, 
+0000de20: 7061 6972 3a20 7374 722c 2070 6172 616d  pair: str, param
+0000de30: 733a 2044 6963 7429 202d 3e20 4469 6374  s: Dict) -> Dict
+0000de40: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0000de50: 2020 2020 2020 456d 756c 6174 6564 2066        Emulated f
+0000de60: 6574 6368 5f6f 7264 6572 2069 6620 7468  etch_order if th
+0000de70: 6520 6578 6368 616e 6765 2064 6f65 736e  e exchange doesn
+0000de80: 2774 2073 7570 706f 7274 2066 6574 6368  't support fetch
+0000de90: 5f6f 7264 6572 2c20 6275 7420 7265 7175  _order, but requ
+0000dea0: 6972 6573 2073 6570 6172 6174 650a 2020  ires separate.  
+0000deb0: 2020 2020 2020 6361 6c6c 7320 666f 7220        calls for 
+0000dec0: 6f70 656e 2061 6e64 2063 6c6f 7365 6420  open and closed 
+0000ded0: 6f72 6465 7273 2e0a 2020 2020 2020 2020  orders..        
+0000dee0: 2222 220a 2020 2020 2020 2020 7472 793a  """.        try:
+0000def0: 0a20 2020 2020 2020 2020 2020 206f 7264  .            ord
+0000df00: 6572 203d 2073 656c 662e 5f61 7069 2e66  er = self._api.f
+0000df10: 6574 6368 5f6f 7065 6e5f 6f72 6465 7228  etch_open_order(
+0000df20: 6f72 6465 725f 6964 2c20 7061 6972 2c20  order_id, pair, 
+0000df30: 7061 7261 6d73 3d70 6172 616d 7329 0a20  params=params). 
+0000df40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000df50: 5f6c 6f67 5f65 7863 6861 6e67 655f 7265  _log_exchange_re
+0000df60: 7370 6f6e 7365 2827 6665 7463 685f 6f70  sponse('fetch_op
+0000df70: 656e 5f6f 7264 6572 272c 206f 7264 6572  en_order', order
+0000df80: 290a 2020 2020 2020 2020 2020 2020 6f72  ).            or
+0000df90: 6465 7220 3d20 7365 6c66 2e5f 6f72 6465  der = self._orde
+0000dfa0: 725f 636f 6e74 7261 6374 735f 746f 5f61  r_contracts_to_a
+0000dfb0: 6d6f 756e 7428 6f72 6465 7229 0a20 2020  mount(order).   
+0000dfc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000dfd0: 6f72 6465 720a 2020 2020 2020 2020 6578  order.        ex
+0000dfe0: 6365 7074 2063 6378 742e 4f72 6465 724e  cept ccxt.OrderN
+0000dff0: 6f74 466f 756e 643a 0a20 2020 2020 2020  otFound:.       
+0000e000: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0000e010: 2020 2020 2020 2020 2020 6f72 6465 7220            order 
+0000e020: 3d20 7365 6c66 2e5f 6170 692e 6665 7463  = self._api.fetc
+0000e030: 685f 636c 6f73 6564 5f6f 7264 6572 286f  h_closed_order(o
+0000e040: 7264 6572 5f69 642c 2070 6169 722c 2070  rder_id, pair, p
+0000e050: 6172 616d 733d 7061 7261 6d73 290a 2020  arams=params).  
+0000e060: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000e070: 6c66 2e5f 6c6f 675f 6578 6368 616e 6765  lf._log_exchange
+0000e080: 5f72 6573 706f 6e73 6528 2766 6574 6368  _response('fetch
+0000e090: 5f63 6c6f 7365 645f 6f72 6465 7227 2c20  _closed_order', 
+0000e0a0: 6f72 6465 7229 0a20 2020 2020 2020 2020  order).         
+0000e0b0: 2020 2020 2020 206f 7264 6572 203d 2073         order = s
+0000e0c0: 656c 662e 5f6f 7264 6572 5f63 6f6e 7472  elf._order_contr
+0000e0d0: 6163 7473 5f74 6f5f 616d 6f75 6e74 286f  acts_to_amount(o
+0000e0e0: 7264 6572 290a 2020 2020 2020 2020 2020  rder).          
+0000e0f0: 2020 2020 2020 7265 7475 726e 206f 7264        return ord
+0000e100: 6572 0a20 2020 2020 2020 2020 2020 2065  er.            e
+0000e110: 7863 6570 7420 6363 7874 2e4f 7264 6572  xcept ccxt.Order
+0000e120: 4e6f 7446 6f75 6e64 2061 7320 653a 0a20  NotFound as e:. 
+0000e130: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000e140: 6169 7365 2052 6574 7279 6162 6c65 4f72  aise RetryableOr
+0000e150: 6465 7245 7272 6f72 280a 2020 2020 2020  derError(.      
+0000e160: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0000e170: 4f72 6465 7220 6e6f 7420 666f 756e 6420  Order not found 
+0000e180: 2870 6169 723a 207b 7061 6972 7d20 6964  (pair: {pair} id
+0000e190: 3a20 7b6f 7264 6572 5f69 647d 292e 204d  : {order_id}). M
+0000e1a0: 6573 7361 6765 3a20 7b65 7d27 2920 6672  essage: {e}') fr
+0000e1b0: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+0000e1c0: 6570 7420 6363 7874 2e49 6e76 616c 6964  ept ccxt.Invalid
+0000e1d0: 4f72 6465 7220 6173 2065 3a0a 2020 2020  Order as e:.    
+0000e1e0: 2020 2020 2020 2020 7261 6973 6520 496e          raise In
+0000e1f0: 7661 6c69 644f 7264 6572 4578 6365 7074  validOrderExcept
+0000e200: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+0000e210: 2020 2020 2066 2754 7269 6564 2074 6f20       f'Tried to 
+0000e220: 6765 7420 616e 2069 6e76 616c 6964 206f  get an invalid o
+0000e230: 7264 6572 2028 7061 6972 3a20 7b70 6169  rder (pair: {pai
+0000e240: 727d 2069 643a 207b 6f72 6465 725f 6964  r} id: {order_id
+0000e250: 7d29 2e20 4d65 7373 6167 653a 207b 657d  }). Message: {e}
+0000e260: 2729 2066 726f 6d20 650a 2020 2020 2020  ') from e.      
+0000e270: 2020 6578 6365 7074 2063 6378 742e 4444    except ccxt.DD
+0000e280: 6f53 5072 6f74 6563 7469 6f6e 2061 7320  oSProtection as 
+0000e290: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+0000e2a0: 6169 7365 2044 446f 7350 726f 7465 6374  aise DDosProtect
+0000e2b0: 696f 6e28 6529 2066 726f 6d20 650a 2020  ion(e) from e.  
+0000e2c0: 2020 2020 2020 6578 6365 7074 2028 6363        except (cc
+0000e2d0: 7874 2e4f 7065 7261 7469 6f6e 4661 696c  xt.OperationFail
+0000e2e0: 6564 2c20 6363 7874 2e45 7863 6861 6e67  ed, ccxt.Exchang
+0000e2f0: 6545 7272 6f72 2920 6173 2065 3a0a 2020  eError) as e:.  
+0000e300: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000e310: 5465 6d70 6f72 6172 7945 7272 6f72 280a  TemporaryError(.
+0000e320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e330: 6627 436f 756c 6420 6e6f 7420 6765 7420  f'Could not get 
+0000e340: 6f72 6465 7220 6475 6520 746f 207b 652e  order due to {e.
+0000e350: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+0000e360: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
+0000e370: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+0000e380: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
+0000e390: 6173 6545 7272 6f72 2061 7320 653a 0a20  aseError as e:. 
+0000e3a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000e3b0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+0000e3c0: 7074 696f 6e28 6529 2066 726f 6d20 650a  ption(e) from e.
+0000e3d0: 0a20 2020 2040 7265 7472 6965 7228 7265  .    @retrier(re
+0000e3e0: 7472 6965 733d 4150 495f 4645 5443 485f  tries=API_FETCH_
+0000e3f0: 4f52 4445 525f 5245 5452 595f 434f 554e  ORDER_RETRY_COUN
+0000e400: 5429 0a20 2020 2064 6566 2066 6574 6368  T).    def fetch
+0000e410: 5f6f 7264 6572 2873 656c 662c 206f 7264  _order(self, ord
+0000e420: 6572 5f69 643a 2073 7472 2c20 7061 6972  er_id: str, pair
+0000e430: 3a20 7374 722c 2070 6172 616d 733a 204f  : str, params: O
+0000e440: 7074 696f 6e61 6c5b 4469 6374 5d20 3d20  ptional[Dict] = 
+0000e450: 4e6f 6e65 2920 2d3e 2044 6963 743a 0a20  None) -> Dict:. 
+0000e460: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+0000e470: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
+0000e480: 5d3a 0a20 2020 2020 2020 2020 2020 2072  ]:.            r
+0000e490: 6574 7572 6e20 7365 6c66 2e66 6574 6368  eturn self.fetch
+0000e4a0: 5f64 7279 5f72 756e 5f6f 7264 6572 286f  _dry_run_order(o
+0000e4b0: 7264 6572 5f69 6429 0a20 2020 2020 2020  rder_id).       
+0000e4c0: 2069 6620 7061 7261 6d73 2069 7320 4e6f   if params is No
+0000e4d0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+0000e4e0: 7061 7261 6d73 203d 207b 7d0a 2020 2020  params = {}.    
+0000e4f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000e500: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+0000e510: 2e65 7863 6861 6e67 655f 6861 7328 2766  .exchange_has('f
+0000e520: 6574 6368 4f72 6465 7227 293a 0a20 2020  etchOrder'):.   
+0000e530: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000e540: 7572 6e20 7365 6c66 2e66 6574 6368 5f6f  urn self.fetch_o
+0000e550: 7264 6572 5f65 6d75 6c61 7465 6428 6f72  rder_emulated(or
+0000e560: 6465 725f 6964 2c20 7061 6972 2c20 7061  der_id, pair, pa
+0000e570: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
+0000e580: 2020 6f72 6465 7220 3d20 7365 6c66 2e5f    order = self._
+0000e590: 6170 692e 6665 7463 685f 6f72 6465 7228  api.fetch_order(
+0000e5a0: 6f72 6465 725f 6964 2c20 7061 6972 2c20  order_id, pair, 
+0000e5b0: 7061 7261 6d73 3d70 6172 616d 7329 0a20  params=params). 
+0000e5c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0000e5d0: 5f6c 6f67 5f65 7863 6861 6e67 655f 7265  _log_exchange_re
+0000e5e0: 7370 6f6e 7365 2827 6665 7463 685f 6f72  sponse('fetch_or
+0000e5f0: 6465 7227 2c20 6f72 6465 7229 0a20 2020  der', order).   
+0000e600: 2020 2020 2020 2020 206f 7264 6572 203d           order =
+0000e610: 2073 656c 662e 5f6f 7264 6572 5f63 6f6e   self._order_con
+0000e620: 7472 6163 7473 5f74 6f5f 616d 6f75 6e74  tracts_to_amount
+0000e630: 286f 7264 6572 290a 2020 2020 2020 2020  (order).        
+0000e640: 2020 2020 7265 7475 726e 206f 7264 6572      return order
+0000e650: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0000e660: 6363 7874 2e4f 7264 6572 4e6f 7446 6f75  ccxt.OrderNotFou
+0000e670: 6e64 2061 7320 653a 0a20 2020 2020 2020  nd as e:.       
+0000e680: 2020 2020 2072 6169 7365 2052 6574 7279       raise Retry
+0000e690: 6162 6c65 4f72 6465 7245 7272 6f72 280a  ableOrderError(.
+0000e6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e6b0: 6627 4f72 6465 7220 6e6f 7420 666f 756e  f'Order not foun
+0000e6c0: 6420 2870 6169 723a 207b 7061 6972 7d20  d (pair: {pair} 
+0000e6d0: 6964 3a20 7b6f 7264 6572 5f69 647d 292e  id: {order_id}).
+0000e6e0: 204d 6573 7361 6765 3a20 7b65 7d27 2920   Message: {e}') 
+0000e6f0: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
+0000e700: 7863 6570 7420 6363 7874 2e49 6e76 616c  xcept ccxt.Inval
+0000e710: 6964 4f72 6465 7220 6173 2065 3a0a 2020  idOrder as e:.  
+0000e720: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0000e730: 496e 7661 6c69 644f 7264 6572 4578 6365  InvalidOrderExce
+0000e740: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+0000e750: 2020 2020 2020 2066 2754 7269 6564 2074         f'Tried t
+0000e760: 6f20 6765 7420 616e 2069 6e76 616c 6964  o get an invalid
+0000e770: 206f 7264 6572 2028 7061 6972 3a20 7b70   order (pair: {p
+0000e780: 6169 727d 2069 643a 207b 6f72 6465 725f  air} id: {order_
+0000e790: 6964 7d29 2e20 4d65 7373 6167 653a 207b  id}). Message: {
+0000e7a0: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+0000e7b0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+0000e7c0: 4444 6f53 5072 6f74 6563 7469 6f6e 2061  DDoSProtection a
+0000e7d0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0000e7e0: 2072 6169 7365 2044 446f 7350 726f 7465   raise DDosProte
+0000e7f0: 6374 696f 6e28 6529 2066 726f 6d20 650a  ction(e) from e.
+0000e800: 2020 2020 2020 2020 6578 6365 7074 2028          except (
+0000e810: 6363 7874 2e4f 7065 7261 7469 6f6e 4661  ccxt.OperationFa
+0000e820: 696c 6564 2c20 6363 7874 2e45 7863 6861  iled, ccxt.Excha
+0000e830: 6e67 6545 7272 6f72 2920 6173 2065 3a0a  ngeError) as e:.
+0000e840: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000e850: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
+0000e860: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000e870: 2020 6627 436f 756c 6420 6e6f 7420 6765    f'Could not ge
+0000e880: 7420 6f72 6465 7220 6475 6520 746f 207b  t order due to {
+0000e890: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
+0000e8a0: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
+0000e8b0: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+0000e8c0: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+0000e8d0: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
+0000e8e0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000e8f0: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+0000e900: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
+0000e910: 650a 0a20 2020 2064 6566 2066 6574 6368  e..    def fetch
+0000e920: 5f73 746f 706c 6f73 735f 6f72 6465 7228  _stoploss_order(
+0000e930: 7365 6c66 2c20 6f72 6465 725f 6964 3a20  self, order_id: 
+0000e940: 7374 722c 2070 6169 723a 2073 7472 2c20  str, pair: str, 
+0000e950: 7061 7261 6d73 3a20 4f70 7469 6f6e 616c  params: Optional
+0000e960: 5b44 6963 745d 203d 204e 6f6e 6529 202d  [Dict] = None) -
+0000e970: 3e20 4469 6374 3a0a 2020 2020 2020 2020  > Dict:.        
+0000e980: 7265 7475 726e 2073 656c 662e 6665 7463  return self.fetc
+0000e990: 685f 6f72 6465 7228 6f72 6465 725f 6964  h_order(order_id
+0000e9a0: 2c20 7061 6972 2c20 7061 7261 6d73 290a  , pair, params).
+0000e9b0: 0a20 2020 2064 6566 2066 6574 6368 5f6f  .    def fetch_o
+0000e9c0: 7264 6572 5f6f 725f 7374 6f70 6c6f 7373  rder_or_stoploss
+0000e9d0: 5f6f 7264 6572 2873 656c 662c 206f 7264  _order(self, ord
+0000e9e0: 6572 5f69 643a 2073 7472 2c20 7061 6972  er_id: str, pair
+0000e9f0: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
+0000ea00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ea10: 2020 2020 2020 2020 2020 2020 2073 746f               sto
+0000ea20: 706c 6f73 735f 6f72 6465 723a 2062 6f6f  ploss_order: boo
+0000ea30: 6c20 3d20 4661 6c73 6529 202d 3e20 4469  l = False) -> Di
+0000ea40: 6374 3a0a 2020 2020 2020 2020 2222 220a  ct:.        """.
+0000ea50: 2020 2020 2020 2020 5369 6d70 6c65 2077          Simple w
+0000ea60: 7261 7070 6572 2063 616c 6c69 6e67 2065  rapper calling e
+0000ea70: 6974 6865 7220 6665 7463 685f 6f72 6465  ither fetch_orde
+0000ea80: 7220 6f72 2066 6574 6368 5f73 746f 706c  r or fetch_stopl
+0000ea90: 6f73 735f 6f72 6465 7220 6465 7065 6e64  oss_order depend
+0000eaa0: 696e 6720 6f6e 0a20 2020 2020 2020 2074  ing on.        t
+0000eab0: 6865 2073 746f 706c 6f73 735f 6f72 6465  he stoploss_orde
+0000eac0: 7220 7061 7261 6d65 7465 720a 2020 2020  r parameter.    
+0000ead0: 2020 2020 3a70 6172 616d 206f 7264 6572      :param order
+0000eae0: 5f69 643a 204f 7264 6572 4964 2074 6f20  _id: OrderId to 
+0000eaf0: 6665 7463 6820 6f72 6465 720a 2020 2020  fetch order.    
+0000eb00: 2020 2020 3a70 6172 616d 2070 6169 723a      :param pair:
+0000eb10: 2050 6169 7220 636f 7272 6573 706f 6e64   Pair correspond
+0000eb20: 696e 6720 746f 206f 7264 6572 5f69 640a  ing to order_id.
+0000eb30: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+0000eb40: 746f 706c 6f73 735f 6f72 6465 723a 2049  toploss_order: I
+0000eb50: 6620 7472 7565 2c20 7573 6573 2066 6574  f true, uses fet
+0000eb60: 6368 5f73 746f 706c 6f73 735f 6f72 6465  ch_stoploss_orde
+0000eb70: 722c 206f 7468 6572 7769 7365 2066 6574  r, otherwise fet
+0000eb80: 6368 5f6f 7264 6572 2e0a 2020 2020 2020  ch_order..      
+0000eb90: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+0000eba0: 2073 746f 706c 6f73 735f 6f72 6465 723a   stoploss_order:
+0000ebb0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000ebc0: 7572 6e20 7365 6c66 2e66 6574 6368 5f73  urn self.fetch_s
+0000ebd0: 746f 706c 6f73 735f 6f72 6465 7228 6f72  toploss_order(or
+0000ebe0: 6465 725f 6964 2c20 7061 6972 290a 2020  der_id, pair).  
+0000ebf0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000ec00: 662e 6665 7463 685f 6f72 6465 7228 6f72  f.fetch_order(or
+0000ec10: 6465 725f 6964 2c20 7061 6972 290a 0a20  der_id, pair).. 
+0000ec20: 2020 2064 6566 2063 6865 636b 5f6f 7264     def check_ord
+0000ec30: 6572 5f63 616e 6365 6c65 645f 656d 7074  er_canceled_empt
+0000ec40: 7928 7365 6c66 2c20 6f72 6465 723a 2044  y(self, order: D
+0000ec50: 6963 7429 202d 3e20 626f 6f6c 3a0a 2020  ict) -> bool:.  
+0000ec60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000ec70: 2020 5665 7269 6679 2069 6620 616e 206f    Verify if an o
+0000ec80: 7264 6572 2068 6173 2062 6565 6e20 6361  rder has been ca
+0000ec90: 6e63 656c 6c65 6420 7769 7468 6f75 7420  ncelled without 
+0000eca0: 6265 696e 6720 7061 7274 6961 6c6c 7920  being partially 
+0000ecb0: 6669 6c6c 6564 0a20 2020 2020 2020 203a  filled.        :
+0000ecc0: 7061 7261 6d20 6f72 6465 723a 204f 7264  param order: Ord
+0000ecd0: 6572 2064 6963 7420 6173 2072 6574 7572  er dict as retur
+0000ece0: 6e65 6420 6672 6f6d 2066 6574 6368 5f6f  ned from fetch_o
+0000ecf0: 7264 6572 2829 0a20 2020 2020 2020 203a  rder().        :
+0000ed00: 7265 7475 726e 3a20 5472 7565 2069 6620  return: True if 
+0000ed10: 6f72 6465 7220 6861 7320 6265 656e 2063  order has been c
+0000ed20: 616e 6365 6c6c 6564 2077 6974 686f 7574  ancelled without
+0000ed30: 2062 6569 6e67 2066 696c 6c65 642c 2046   being filled, F
+0000ed40: 616c 7365 206f 7468 6572 7769 7365 2e0a  alse otherwise..
+0000ed50: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0000ed60: 2020 2020 7265 7475 726e 2028 6f72 6465      return (orde
+0000ed70: 722e 6765 7428 2773 7461 7475 7327 2920  r.get('status') 
+0000ed80: 696e 204e 4f4e 5f4f 5045 4e5f 4558 4348  in NON_OPEN_EXCH
+0000ed90: 414e 4745 5f53 5441 5445 530a 2020 2020  ANGE_STATES.    
+0000eda0: 2020 2020 2020 2020 2020 2020 616e 6420              and 
+0000edb0: 6f72 6465 722e 6765 7428 2766 696c 6c65  order.get('fille
+0000edc0: 6427 2920 3d3d 2030 2e30 290a 0a20 2020  d') == 0.0)..   
+0000edd0: 2040 7265 7472 6965 720a 2020 2020 6465   @retrier.    de
+0000ede0: 6620 6361 6e63 656c 5f6f 7264 6572 2873  f cancel_order(s
+0000edf0: 656c 662c 206f 7264 6572 5f69 643a 2073  elf, order_id: s
+0000ee00: 7472 2c20 7061 6972 3a20 7374 722c 2070  tr, pair: str, p
+0000ee10: 6172 616d 733a 204f 7074 696f 6e61 6c5b  arams: Optional[
+0000ee20: 4469 6374 5d20 3d20 4e6f 6e65 2920 2d3e  Dict] = None) ->
+0000ee30: 2044 6963 743a 0a20 2020 2020 2020 2069   Dict:.        i
+0000ee40: 6620 7365 6c66 2e5f 636f 6e66 6967 5b27  f self._config['
+0000ee50: 6472 795f 7275 6e27 5d3a 0a20 2020 2020  dry_run']:.     
+0000ee60: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000ee70: 2020 2020 2020 2020 2020 2020 6f72 6465              orde
+0000ee80: 7220 3d20 7365 6c66 2e66 6574 6368 5f64  r = self.fetch_d
+0000ee90: 7279 5f72 756e 5f6f 7264 6572 286f 7264  ry_run_order(ord
+0000eea0: 6572 5f69 6429 0a0a 2020 2020 2020 2020  er_id)..        
+0000eeb0: 2020 2020 2020 2020 6f72 6465 722e 7570          order.up
+0000eec0: 6461 7465 287b 2773 7461 7475 7327 3a20  date({'status': 
+0000eed0: 2763 616e 6365 6c65 6427 2c20 2766 696c  'canceled', 'fil
+0000eee0: 6c65 6427 3a20 302e 302c 2027 7265 6d61  led': 0.0, 'rema
+0000eef0: 696e 696e 6727 3a20 6f72 6465 725b 2761  ining': order['a
+0000ef00: 6d6f 756e 7427 5d7d 290a 2020 2020 2020  mount']}).      
+0000ef10: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000ef20: 206f 7264 6572 0a20 2020 2020 2020 2020   order.         
+0000ef30: 2020 2065 7863 6570 7420 496e 7661 6c69     except Invali
+0000ef40: 644f 7264 6572 4578 6365 7074 696f 6e3a  dOrderException:
+0000ef50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ef60: 2072 6574 7572 6e20 7b7d 0a0a 2020 2020   return {}..    
+0000ef70: 2020 2020 6966 2070 6172 616d 7320 6973      if params is
+0000ef80: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+0000ef90: 2020 2070 6172 616d 7320 3d20 7b7d 0a20     params = {}. 
+0000efa0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000efb0: 2020 2020 2020 2020 6f72 6465 7220 3d20          order = 
+0000efc0: 7365 6c66 2e5f 6170 692e 6361 6e63 656c  self._api.cancel
+0000efd0: 5f6f 7264 6572 286f 7264 6572 5f69 642c  _order(order_id,
+0000efe0: 2070 6169 722c 2070 6172 616d 733d 7061   pair, params=pa
+0000eff0: 7261 6d73 290a 2020 2020 2020 2020 2020  rams).          
+0000f000: 2020 7365 6c66 2e5f 6c6f 675f 6578 6368    self._log_exch
+0000f010: 616e 6765 5f72 6573 706f 6e73 6528 2763  ange_response('c
+0000f020: 616e 6365 6c5f 6f72 6465 7227 2c20 6f72  ancel_order', or
+0000f030: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0000f040: 206f 7264 6572 203d 2073 656c 662e 5f6f   order = self._o
+0000f050: 7264 6572 5f63 6f6e 7472 6163 7473 5f74  rder_contracts_t
+0000f060: 6f5f 616d 6f75 6e74 286f 7264 6572 290a  o_amount(order).
+0000f070: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000f080: 726e 206f 7264 6572 0a20 2020 2020 2020  rn order.       
+0000f090: 2065 7863 6570 7420 6363 7874 2e49 6e76   except ccxt.Inv
+0000f0a0: 616c 6964 4f72 6465 7220 6173 2065 3a0a  alidOrder as e:.
+0000f0b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000f0c0: 6520 496e 7661 6c69 644f 7264 6572 4578  e InvalidOrderEx
+0000f0d0: 6365 7074 696f 6e28 0a20 2020 2020 2020  ception(.       
+0000f0e0: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
+0000f0f0: 206e 6f74 2063 616e 6365 6c20 6f72 6465   not cancel orde
+0000f100: 722e 204d 6573 7361 6765 3a20 7b65 7d27  r. Message: {e}'
+0000f110: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0000f120: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
+0000f130: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
+0000f140: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000f150: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
+0000f160: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
+0000f170: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
+0000f180: 742e 4f70 6572 6174 696f 6e46 6169 6c65  t.OperationFaile
+0000f190: 642c 2063 6378 742e 4578 6368 616e 6765  d, ccxt.Exchange
+0000f1a0: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
+0000f1b0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0000f1c0: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
+0000f1d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000f1e0: 2743 6f75 6c64 206e 6f74 2063 616e 6365  'Could not cance
+0000f1f0: 6c20 6f72 6465 7220 6475 6520 746f 207b  l order due to {
+0000f200: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
+0000f210: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
+0000f220: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+0000f230: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+0000f240: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
+0000f250: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000f260: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+0000f270: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
+0000f280: 650a 0a20 2020 2064 6566 2063 616e 6365  e..    def cance
+0000f290: 6c5f 7374 6f70 6c6f 7373 5f6f 7264 6572  l_stoploss_order
+0000f2a0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000f2b0: 6c66 2c20 6f72 6465 725f 6964 3a20 7374  lf, order_id: st
+0000f2c0: 722c 2070 6169 723a 2073 7472 2c20 7061  r, pair: str, pa
+0000f2d0: 7261 6d73 3a20 4f70 7469 6f6e 616c 5b44  rams: Optional[D
+0000f2e0: 6963 745d 203d 204e 6f6e 6529 202d 3e20  ict] = None) -> 
+0000f2f0: 4469 6374 3a0a 2020 2020 2020 2020 7265  Dict:.        re
+0000f300: 7475 726e 2073 656c 662e 6361 6e63 656c  turn self.cancel
+0000f310: 5f6f 7264 6572 286f 7264 6572 5f69 642c  _order(order_id,
+0000f320: 2070 6169 722c 2070 6172 616d 7329 0a0a   pair, params)..
+0000f330: 2020 2020 6465 6620 6973 5f63 616e 6365      def is_cance
+0000f340: 6c5f 6f72 6465 725f 7265 7375 6c74 5f73  l_order_result_s
+0000f350: 7569 7461 626c 6528 7365 6c66 2c20 636f  uitable(self, co
+0000f360: 7264 6572 2920 2d3e 2062 6f6f 6c3a 0a20  rder) -> bool:. 
+0000f370: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000f380: 696e 7374 616e 6365 2863 6f72 6465 722c  instance(corder,
+0000f390: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+0000f3a0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0000f3b0: 0a0a 2020 2020 2020 2020 7265 7175 6972  ..        requir
+0000f3c0: 6564 203d 2028 2766 6565 272c 2027 7374  ed = ('fee', 'st
+0000f3d0: 6174 7573 272c 2027 616d 6f75 6e74 2729  atus', 'amount')
+0000f3e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f3f0: 616c 6c28 636f 7264 6572 2e67 6574 286b  all(corder.get(k
+0000f400: 2c20 4e6f 6e65 2920 6973 206e 6f74 204e  , None) is not N
+0000f410: 6f6e 6520 666f 7220 6b20 696e 2072 6571  one for k in req
+0000f420: 7569 7265 6429 0a0a 2020 2020 6465 6620  uired)..    def 
+0000f430: 6361 6e63 656c 5f6f 7264 6572 5f77 6974  cancel_order_wit
+0000f440: 685f 7265 7375 6c74 2873 656c 662c 206f  h_result(self, o
+0000f450: 7264 6572 5f69 643a 2073 7472 2c20 7061  rder_id: str, pa
+0000f460: 6972 3a20 7374 722c 2061 6d6f 756e 743a  ir: str, amount:
+0000f470: 2066 6c6f 6174 2920 2d3e 2044 6963 743a   float) -> Dict:
+0000f480: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000f490: 2020 2020 2043 616e 6365 6c20 6f72 6465       Cancel orde
+0000f4a0: 7220 7265 7475 726e 696e 6720 6120 7265  r returning a re
+0000f4b0: 7375 6c74 2e0a 2020 2020 2020 2020 4372  sult..        Cr
+0000f4c0: 6561 7465 7320 6120 6661 6b65 2072 6573  eates a fake res
+0000f4d0: 756c 7420 6966 2063 616e 6365 6c20 6f72  ult if cancel or
+0000f4e0: 6465 7220 7265 7475 726e 7320 6120 6e6f  der returns a no
+0000f4f0: 6e2d 7573 6162 6c65 2072 6573 756c 740a  n-usable result.
+0000f500: 2020 2020 2020 2020 616e 6420 6665 7463          and fetc
+0000f510: 685f 6f72 6465 7220 646f 6573 206e 6f74  h_order does not
+0000f520: 2077 6f72 6b20 2863 6572 7461 696e 2065   work (certain e
+0000f530: 7863 6861 6e67 6573 2064 6f6e 2774 2072  xchanges don't r
+0000f540: 6574 7572 6e20 6361 6e63 656c 6c65 6420  eturn cancelled 
+0000f550: 6f72 6465 7273 290a 2020 2020 2020 2020  orders).        
+0000f560: 3a70 6172 616d 206f 7264 6572 5f69 643a  :param order_id:
+0000f570: 204f 7264 6572 6964 2074 6f20 6361 6e63   Orderid to canc
+0000f580: 656c 0a20 2020 2020 2020 203a 7061 7261  el.        :para
+0000f590: 6d20 7061 6972 3a20 5061 6972 2063 6f72  m pair: Pair cor
+0000f5a0: 7265 7370 6f6e 6469 6e67 2074 6f20 6f72  responding to or
+0000f5b0: 6465 725f 6964 0a20 2020 2020 2020 203a  der_id.        :
+0000f5c0: 7061 7261 6d20 616d 6f75 6e74 3a20 416d  param amount: Am
+0000f5d0: 6f75 6e74 2074 6f20 7573 6520 666f 7220  ount to use for 
+0000f5e0: 6661 6b65 2072 6573 706f 6e73 650a 2020  fake response.  
+0000f5f0: 2020 2020 2020 3a72 6574 7572 6e3a 2052        :return: R
+0000f600: 6573 756c 7420 6672 6f6d 2065 6974 6865  esult from eithe
+0000f610: 7220 6361 6e63 656c 5f6f 7264 6572 2069  r cancel_order i
+0000f620: 6620 7573 6162 6c65 2c20 6f72 2066 6574  f usable, or fet
+0000f630: 6368 5f6f 7264 6572 0a20 2020 2020 2020  ch_order.       
+0000f640: 2022 2222 0a20 2020 2020 2020 2074 7279   """.        try
+0000f650: 3a0a 2020 2020 2020 2020 2020 2020 636f  :.            co
+0000f660: 7264 6572 203d 2073 656c 662e 6361 6e63  rder = self.canc
+0000f670: 656c 5f6f 7264 6572 286f 7264 6572 5f69  el_order(order_i
+0000f680: 642c 2070 6169 7229 0a20 2020 2020 2020  d, pair).       
+0000f690: 2020 2020 2069 6620 7365 6c66 2e69 735f       if self.is_
+0000f6a0: 6361 6e63 656c 5f6f 7264 6572 5f72 6573  cancel_order_res
+0000f6b0: 756c 745f 7375 6974 6162 6c65 2863 6f72  ult_suitable(cor
+0000f6c0: 6465 7229 3a0a 2020 2020 2020 2020 2020  der):.          
+0000f6d0: 2020 2020 2020 7265 7475 726e 2063 6f72        return cor
+0000f6e0: 6465 720a 2020 2020 2020 2020 6578 6365  der.        exce
+0000f6f0: 7074 2049 6e76 616c 6964 4f72 6465 7245  pt InvalidOrderE
+0000f700: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
+0000f710: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+0000f720: 6e69 6e67 2866 2243 6f75 6c64 206e 6f74  ning(f"Could not
+0000f730: 2063 616e 6365 6c20 6f72 6465 7220 7b6f   cancel order {o
+0000f740: 7264 6572 5f69 647d 2066 6f72 207b 7061  rder_id} for {pa
+0000f750: 6972 7d2e 2229 0a20 2020 2020 2020 2074  ir}.").        t
+0000f760: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000f770: 6f72 6465 7220 3d20 7365 6c66 2e66 6574  order = self.fet
+0000f780: 6368 5f6f 7264 6572 286f 7264 6572 5f69  ch_order(order_i
+0000f790: 642c 2070 6169 7229 0a20 2020 2020 2020  d, pair).       
+0000f7a0: 2065 7863 6570 7420 496e 7661 6c69 644f   except InvalidO
+0000f7b0: 7264 6572 4578 6365 7074 696f 6e3a 0a20  rderException:. 
+0000f7c0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0000f7d0: 722e 7761 726e 696e 6728 6622 436f 756c  r.warning(f"Coul
+0000f7e0: 6420 6e6f 7420 6665 7463 6820 6361 6e63  d not fetch canc
+0000f7f0: 656c 6c65 6420 6f72 6465 7220 7b6f 7264  elled order {ord
+0000f800: 6572 5f69 647d 2e22 290a 2020 2020 2020  er_id}.").      
+0000f810: 2020 2020 2020 6f72 6465 7220 3d20 7b0a        order = {.
+0000f820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f830: 2769 6427 3a20 6f72 6465 725f 6964 2c0a  'id': order_id,.
+0000f840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f850: 2773 7461 7475 7327 3a20 2763 616e 6365  'status': 'cance
+0000f860: 6c65 6427 2c0a 2020 2020 2020 2020 2020  led',.          
+0000f870: 2020 2020 2020 2761 6d6f 756e 7427 3a20        'amount': 
+0000f880: 616d 6f75 6e74 2c0a 2020 2020 2020 2020  amount,.        
+0000f890: 2020 2020 2020 2020 2766 696c 6c65 6427          'filled'
+0000f8a0: 3a20 302e 302c 0a20 2020 2020 2020 2020  : 0.0,.         
+0000f8b0: 2020 2020 2020 2027 6665 6527 3a20 7b7d         'fee': {}
+0000f8c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000f8d0: 2020 2769 6e66 6f27 3a20 7b7d 0a20 2020    'info': {}.   
+0000f8e0: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+0000f8f0: 2020 2020 7265 7475 726e 206f 7264 6572      return order
+0000f900: 0a0a 2020 2020 6465 6620 6361 6e63 656c  ..    def cancel
+0000f910: 5f73 746f 706c 6f73 735f 6f72 6465 725f  _stoploss_order_
+0000f920: 7769 7468 5f72 6573 756c 7428 7365 6c66  with_result(self
+0000f930: 2c20 6f72 6465 725f 6964 3a20 7374 722c  , order_id: str,
+0000f940: 2070 6169 723a 2073 7472 2c20 616d 6f75   pair: str, amou
+0000f950: 6e74 3a20 666c 6f61 7429 202d 3e20 4469  nt: float) -> Di
+0000f960: 6374 3a0a 2020 2020 2020 2020 2222 220a  ct:.        """.
+0000f970: 2020 2020 2020 2020 4361 6e63 656c 2073          Cancel s
+0000f980: 746f 706c 6f73 7320 6f72 6465 7220 7265  toploss order re
+0000f990: 7475 726e 696e 6720 6120 7265 7375 6c74  turning a result
+0000f9a0: 2e0a 2020 2020 2020 2020 4372 6561 7465  ..        Create
+0000f9b0: 7320 6120 6661 6b65 2072 6573 756c 7420  s a fake result 
+0000f9c0: 6966 2063 616e 6365 6c20 6f72 6465 7220  if cancel order 
+0000f9d0: 7265 7475 726e 7320 6120 6e6f 6e2d 7573  returns a non-us
+0000f9e0: 6162 6c65 2072 6573 756c 740a 2020 2020  able result.    
+0000f9f0: 2020 2020 616e 6420 6665 7463 685f 6f72      and fetch_or
+0000fa00: 6465 7220 646f 6573 206e 6f74 2077 6f72  der does not wor
+0000fa10: 6b20 2863 6572 7461 696e 2065 7863 6861  k (certain excha
+0000fa20: 6e67 6573 2064 6f6e 2774 2072 6574 7572  nges don't retur
+0000fa30: 6e20 6361 6e63 656c 6c65 6420 6f72 6465  n cancelled orde
+0000fa40: 7273 290a 2020 2020 2020 2020 3a70 6172  rs).        :par
+0000fa50: 616d 206f 7264 6572 5f69 643a 2073 746f  am order_id: sto
+0000fa60: 706c 6f73 732d 6f72 6465 722d 6964 2074  ploss-order-id t
+0000fa70: 6f20 6361 6e63 656c 0a20 2020 2020 2020  o cancel.       
+0000fa80: 203a 7061 7261 6d20 7061 6972 3a20 5061   :param pair: Pa
+0000fa90: 6972 2063 6f72 7265 7370 6f6e 6469 6e67  ir corresponding
+0000faa0: 2074 6f20 6f72 6465 725f 6964 0a20 2020   to order_id.   
+0000fab0: 2020 2020 203a 7061 7261 6d20 616d 6f75       :param amou
+0000fac0: 6e74 3a20 416d 6f75 6e74 2074 6f20 7573  nt: Amount to us
+0000fad0: 6520 666f 7220 6661 6b65 2072 6573 706f  e for fake respo
+0000fae0: 6e73 650a 2020 2020 2020 2020 3a72 6574  nse.        :ret
+0000faf0: 7572 6e3a 2052 6573 756c 7420 6672 6f6d  urn: Result from
+0000fb00: 2065 6974 6865 7220 6361 6e63 656c 5f6f   either cancel_o
+0000fb10: 7264 6572 2069 6620 7573 6162 6c65 2c20  rder if usable, 
+0000fb20: 6f72 2066 6574 6368 5f6f 7264 6572 0a20  or fetch_order. 
+0000fb30: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000fb40: 2020 2063 6f72 6465 7220 3d20 7365 6c66     corder = self
+0000fb50: 2e63 616e 6365 6c5f 7374 6f70 6c6f 7373  .cancel_stoploss
+0000fb60: 5f6f 7264 6572 286f 7264 6572 5f69 642c  _order(order_id,
+0000fb70: 2070 6169 7229 0a20 2020 2020 2020 2069   pair).        i
+0000fb80: 6620 7365 6c66 2e69 735f 6361 6e63 656c  f self.is_cancel
+0000fb90: 5f6f 7264 6572 5f72 6573 756c 745f 7375  _order_result_su
+0000fba0: 6974 6162 6c65 2863 6f72 6465 7229 3a0a  itable(corder):.
+0000fbb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000fbc0: 726e 2063 6f72 6465 720a 2020 2020 2020  rn corder.      
+0000fbd0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000fbe0: 2020 206f 7264 6572 203d 2073 656c 662e     order = self.
+0000fbf0: 6665 7463 685f 7374 6f70 6c6f 7373 5f6f  fetch_stoploss_o
+0000fc00: 7264 6572 286f 7264 6572 5f69 642c 2070  rder(order_id, p
+0000fc10: 6169 7229 0a20 2020 2020 2020 2065 7863  air).        exc
+0000fc20: 6570 7420 496e 7661 6c69 644f 7264 6572  ept InvalidOrder
+0000fc30: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+0000fc40: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
+0000fc50: 726e 696e 6728 6622 436f 756c 6420 6e6f  rning(f"Could no
+0000fc60: 7420 6665 7463 6820 6361 6e63 656c 6c65  t fetch cancelle
+0000fc70: 6420 7374 6f70 6c6f 7373 206f 7264 6572  d stoploss order
+0000fc80: 207b 6f72 6465 725f 6964 7d2e 2229 0a20   {order_id}."). 
+0000fc90: 2020 2020 2020 2020 2020 206f 7264 6572             order
+0000fca0: 203d 207b 2769 6427 3a20 6f72 6465 725f   = {'id': order_
+0000fcb0: 6964 2c20 2766 6565 273a 207b 7d2c 2027  id, 'fee': {}, '
+0000fcc0: 7374 6174 7573 273a 2027 6361 6e63 656c  status': 'cancel
+0000fcd0: 6564 272c 2027 616d 6f75 6e74 273a 2061  ed', 'amount': a
+0000fce0: 6d6f 756e 742c 2027 696e 666f 273a 207b  mount, 'info': {
+0000fcf0: 7d7d 0a0a 2020 2020 2020 2020 7265 7475  }}..        retu
+0000fd00: 726e 206f 7264 6572 0a0a 2020 2020 4072  rn order..    @r
+0000fd10: 6574 7269 6572 0a20 2020 2064 6566 2067  etrier.    def g
+0000fd20: 6574 5f62 616c 616e 6365 7328 7365 6c66  et_balances(self
+0000fd30: 2920 2d3e 2064 6963 743a 0a0a 2020 2020  ) -> dict:..    
+0000fd40: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000fd50: 2020 2020 2062 616c 616e 6365 7320 3d20       balances = 
+0000fd60: 7365 6c66 2e5f 6170 692e 6665 7463 685f  self._api.fetch_
+0000fd70: 6261 6c61 6e63 6528 290a 2020 2020 2020  balance().      
+0000fd80: 2020 2020 2020 2320 5265 6d6f 7665 2061        # Remove a
+0000fd90: 6464 6974 696f 6e61 6c20 696e 666f 2066  dditional info f
+0000fda0: 726f 6d20 6363 7874 2072 6573 756c 7473  rom ccxt results
+0000fdb0: 0a20 2020 2020 2020 2020 2020 2062 616c  .            bal
+0000fdc0: 616e 6365 732e 706f 7028 2269 6e66 6f22  ances.pop("info"
+0000fdd0: 2c20 4e6f 6e65 290a 2020 2020 2020 2020  , None).        
+0000fde0: 2020 2020 6261 6c61 6e63 6573 2e70 6f70      balances.pop
+0000fdf0: 2822 6672 6565 222c 204e 6f6e 6529 0a20  ("free", None). 
+0000fe00: 2020 2020 2020 2020 2020 2062 616c 616e             balan
+0000fe10: 6365 732e 706f 7028 2274 6f74 616c 222c  ces.pop("total",
+0000fe20: 204e 6f6e 6529 0a20 2020 2020 2020 2020   None).         
+0000fe30: 2020 2062 616c 616e 6365 732e 706f 7028     balances.pop(
+0000fe40: 2275 7365 6422 2c20 4e6f 6e65 290a 0a20  "used", None).. 
+0000fe50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000fe60: 6e20 6261 6c61 6e63 6573 0a20 2020 2020  n balances.     
+0000fe70: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
+0000fe80: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
+0000fe90: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0000fea0: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
+0000feb0: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
+0000fec0: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
+0000fed0: 6378 742e 4f70 6572 6174 696f 6e46 6169  cxt.OperationFai
+0000fee0: 6c65 642c 2063 6378 742e 4578 6368 616e  led, ccxt.Exchan
+0000fef0: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
+0000ff00: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000ff10: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
+0000ff20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ff30: 2066 2743 6f75 6c64 206e 6f74 2067 6574   f'Could not get
+0000ff40: 2062 616c 616e 6365 2064 7565 2074 6f20   balance due to 
+0000ff50: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+0000ff60: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+0000ff70: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+0000ff80: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0000ff90: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
+0000ffa0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000ffb0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0000ffc0: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
+0000ffd0: 2065 0a0a 2020 2020 4072 6574 7269 6572   e..    @retrier
+0000ffe0: 0a20 2020 2064 6566 2066 6574 6368 5f70  .    def fetch_p
+0000fff0: 6f73 6974 696f 6e73 2873 656c 662c 2070  ositions(self, p
+00010000: 6169 723a 204f 7074 696f 6e61 6c5b 7374  air: Optional[st
+00010010: 725d 203d 204e 6f6e 6529 202d 3e20 4c69  r] = None) -> Li
+00010020: 7374 5b44 6963 745d 3a0a 2020 2020 2020  st[Dict]:.      
+00010030: 2020 2222 220a 2020 2020 2020 2020 4665    """.        Fe
+00010040: 7463 6820 706f 7369 7469 6f6e 7320 6672  tch positions fr
+00010050: 6f6d 2074 6865 2065 7863 6861 6e67 652e  om the exchange.
+00010060: 0a20 2020 2020 2020 2049 6620 6e6f 2070  .        If no p
+00010070: 6169 7220 6973 2067 6976 656e 2c20 616c  air is given, al
+00010080: 6c20 706f 7369 7469 6f6e 7320 6172 6520  l positions are 
+00010090: 7265 7475 726e 6564 2e0a 2020 2020 2020  returned..      
+000100a0: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
+000100b0: 6169 7220 666f 7220 7468 6520 7175 6572  air for the quer
+000100c0: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
+000100d0: 2020 2020 2020 6966 2073 656c 662e 5f63        if self._c
+000100e0: 6f6e 6669 675b 2764 7279 5f72 756e 275d  onfig['dry_run']
+000100f0: 206f 7220 7365 6c66 2e74 7261 6469 6e67   or self.trading
+00010100: 5f6d 6f64 6520 213d 2054 7261 6469 6e67  _mode != Trading
+00010110: 4d6f 6465 2e46 5554 5552 4553 3a0a 2020  Mode.FUTURES:.  
+00010120: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00010130: 205b 5d0a 2020 2020 2020 2020 7472 793a   [].        try:
+00010140: 0a20 2020 2020 2020 2020 2020 2073 796d  .            sym
+00010150: 626f 6c73 203d 205b 5d0a 2020 2020 2020  bols = [].      
+00010160: 2020 2020 2020 6966 2070 6169 723a 0a20        if pair:. 
+00010170: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00010180: 796d 626f 6c73 2e61 7070 656e 6428 7061  ymbols.append(pa
+00010190: 6972 290a 2020 2020 2020 2020 2020 2020  ir).            
+000101a0: 706f 7369 7469 6f6e 733a 204c 6973 745b  positions: List[
+000101b0: 4469 6374 5d20 3d20 7365 6c66 2e5f 6170  Dict] = self._ap
+000101c0: 692e 6665 7463 685f 706f 7369 7469 6f6e  i.fetch_position
+000101d0: 7328 7379 6d62 6f6c 7329 0a20 2020 2020  s(symbols).     
+000101e0: 2020 2020 2020 2073 656c 662e 5f6c 6f67         self._log
+000101f0: 5f65 7863 6861 6e67 655f 7265 7370 6f6e  _exchange_respon
+00010200: 7365 2827 6665 7463 685f 706f 7369 7469  se('fetch_positi
+00010210: 6f6e 7327 2c20 706f 7369 7469 6f6e 7329  ons', positions)
+00010220: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00010230: 7572 6e20 706f 7369 7469 6f6e 730a 2020  urn positions.  
+00010240: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+00010250: 742e 4444 6f53 5072 6f74 6563 7469 6f6e  t.DDoSProtection
+00010260: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00010270: 2020 2072 6169 7365 2044 446f 7350 726f     raise DDosPro
+00010280: 7465 6374 696f 6e28 6529 2066 726f 6d20  tection(e) from 
+00010290: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+000102a0: 2028 6363 7874 2e4f 7065 7261 7469 6f6e   (ccxt.Operation
+000102b0: 4661 696c 6564 2c20 6363 7874 2e45 7863  Failed, ccxt.Exc
+000102c0: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
+000102d0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+000102e0: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
+000102f0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00010300: 2020 2020 6627 436f 756c 6420 6e6f 7420      f'Could not 
+00010310: 6765 7420 706f 7369 7469 6f6e 7320 6475  get positions du
+00010320: 6520 746f 207b 652e 5f5f 636c 6173 735f  e to {e.__class_
+00010330: 5f2e 5f5f 6e61 6d65 5f5f 7d2e 204d 6573  _.__name__}. Mes
+00010340: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
+00010350: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
+00010360: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
+00010370: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00010380: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
+00010390: 6f6e 616c 4578 6365 7074 696f 6e28 6529  onalException(e)
+000103a0: 2066 726f 6d20 650a 0a20 2020 2064 6566   from e..    def
+000103b0: 205f 6665 7463 685f 6f72 6465 7273 5f65   _fetch_orders_e
+000103c0: 6d75 6c61 7465 2873 656c 662c 2070 6169  mulate(self, pai
+000103d0: 723a 2073 7472 2c20 7369 6e63 655f 6d73  r: str, since_ms
+000103e0: 3a20 696e 7429 202d 3e20 4c69 7374 5b44  : int) -> List[D
+000103f0: 6963 745d 3a0a 2020 2020 2020 2020 6f72  ict]:.        or
+00010400: 6465 7273 203d 205b 5d0a 2020 2020 2020  ders = [].      
+00010410: 2020 6966 2073 656c 662e 6578 6368 616e    if self.exchan
+00010420: 6765 5f68 6173 2827 6665 7463 6843 6c6f  ge_has('fetchClo
+00010430: 7365 644f 7264 6572 7327 293a 0a20 2020  sedOrders'):.   
+00010440: 2020 2020 2020 2020 206f 7264 6572 7320           orders 
+00010450: 3d20 7365 6c66 2e5f 6170 692e 6665 7463  = self._api.fetc
+00010460: 685f 636c 6f73 6564 5f6f 7264 6572 7328  h_closed_orders(
+00010470: 7061 6972 2c20 7369 6e63 653d 7369 6e63  pair, since=sinc
+00010480: 655f 6d73 290a 2020 2020 2020 2020 2020  e_ms).          
+00010490: 2020 6966 2073 656c 662e 6578 6368 616e    if self.exchan
+000104a0: 6765 5f68 6173 2827 6665 7463 684f 7065  ge_has('fetchOpe
+000104b0: 6e4f 7264 6572 7327 293a 0a20 2020 2020  nOrders'):.     
+000104c0: 2020 2020 2020 2020 2020 206f 7264 6572             order
+000104d0: 735f 6f70 656e 203d 2073 656c 662e 5f61  s_open = self._a
+000104e0: 7069 2e66 6574 6368 5f6f 7065 6e5f 6f72  pi.fetch_open_or
+000104f0: 6465 7273 2870 6169 722c 2073 696e 6365  ders(pair, since
+00010500: 3d73 696e 6365 5f6d 7329 0a20 2020 2020  =since_ms).     
+00010510: 2020 2020 2020 2020 2020 206f 7264 6572             order
+00010520: 732e 6578 7465 6e64 286f 7264 6572 735f  s.extend(orders_
+00010530: 6f70 656e 290a 2020 2020 2020 2020 7265  open).        re
+00010540: 7475 726e 206f 7264 6572 730a 0a20 2020  turn orders..   
+00010550: 2040 7265 7472 6965 7228 7265 7472 6965   @retrier(retrie
+00010560: 733d 3029 0a20 2020 2064 6566 2066 6574  s=0).    def fet
+00010570: 6368 5f6f 7264 6572 7328 7365 6c66 2c20  ch_orders(self, 
+00010580: 7061 6972 3a20 7374 722c 2073 696e 6365  pair: str, since
+00010590: 3a20 6461 7465 7469 6d65 2c20 7061 7261  : datetime, para
+000105a0: 6d73 3a20 4f70 7469 6f6e 616c 5b44 6963  ms: Optional[Dic
+000105b0: 745d 203d 204e 6f6e 6529 202d 3e20 4c69  t] = None) -> Li
+000105c0: 7374 5b44 6963 745d 3a0a 2020 2020 2020  st[Dict]:.      
+000105d0: 2020 2222 220a 2020 2020 2020 2020 4665    """.        Fe
+000105e0: 7463 6820 616c 6c20 6f72 6465 7273 2066  tch all orders f
+000105f0: 6f72 2061 2070 6169 7220 2273 696e 6365  or a pair "since
+00010600: 220a 2020 2020 2020 2020 3a70 6172 616d  ".        :param
+00010610: 2070 6169 723a 2050 6169 7220 666f 7220   pair: Pair for 
+00010620: 7468 6520 7175 6572 790a 2020 2020 2020  the query.      
+00010630: 2020 3a70 6172 616d 2073 696e 6365 3a20    :param since: 
+00010640: 5374 6172 7469 6e67 2074 696d 6520 666f  Starting time fo
+00010650: 7220 7468 6520 7175 6572 790a 2020 2020  r the query.    
+00010660: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00010670: 6966 2073 656c 662e 5f63 6f6e 6669 675b  if self._config[
+00010680: 2764 7279 5f72 756e 275d 3a0a 2020 2020  'dry_run']:.    
+00010690: 2020 2020 2020 2020 7265 7475 726e 205b          return [
+000106a0: 5d0a 0a20 2020 2020 2020 2074 7279 3a0a  ]..        try:.
+000106b0: 2020 2020 2020 2020 2020 2020 7369 6e63              sinc
+000106c0: 655f 6d73 203d 2069 6e74 2828 7369 6e63  e_ms = int((sinc
+000106d0: 652e 7469 6d65 7374 616d 7028 2920 2d20  e.timestamp() - 
+000106e0: 3130 2920 2a20 3130 3030 290a 0a20 2020  10) * 1000)..   
+000106f0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
+00010700: 2e65 7863 6861 6e67 655f 6861 7328 2766  .exchange_has('f
+00010710: 6574 6368 4f72 6465 7273 2729 3a0a 2020  etchOrders'):.  
+00010720: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010730: 206e 6f74 2070 6172 616d 733a 0a20 2020   not params:.   
+00010740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010750: 2070 6172 616d 7320 3d20 7b7d 0a20 2020   params = {}.   
+00010760: 2020 2020 2020 2020 2020 2020 2074 7279               try
+00010770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010780: 2020 2020 2020 6f72 6465 7273 3a20 4c69        orders: Li
+00010790: 7374 5b44 6963 745d 203d 2073 656c 662e  st[Dict] = self.
+000107a0: 5f61 7069 2e66 6574 6368 5f6f 7264 6572  _api.fetch_order
+000107b0: 7328 7061 6972 2c20 7369 6e63 653d 7369  s(pair, since=si
+000107c0: 6e63 655f 6d73 2c20 7061 7261 6d73 3d70  nce_ms, params=p
+000107d0: 6172 616d 7329 0a20 2020 2020 2020 2020  arams).         
+000107e0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+000107f0: 7874 2e4e 6f74 5375 7070 6f72 7465 643a  xt.NotSupported:
+00010800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010810: 2020 2020 2023 2053 6f6d 6520 6578 6368       # Some exch
+00010820: 616e 6765 7320 646f 6e27 7420 7375 7070  anges don't supp
+00010830: 6f72 7420 6665 7463 684f 7264 6572 730a  ort fetchOrders.
+00010840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010850: 2020 2020 2320 6174 7465 6d70 7420 746f      # attempt to
+00010860: 2066 6574 6368 206f 7065 6e20 616e 6420   fetch open and 
+00010870: 636c 6f73 6564 206f 7264 6572 7320 7365  closed orders se
+00010880: 7061 7261 7465 6c79 0a20 2020 2020 2020  parately.       
+00010890: 2020 2020 2020 2020 2020 2020 206f 7264               ord
+000108a0: 6572 7320 3d20 7365 6c66 2e5f 6665 7463  ers = self._fetc
+000108b0: 685f 6f72 6465 7273 5f65 6d75 6c61 7465  h_orders_emulate
+000108c0: 2870 6169 722c 2073 696e 6365 5f6d 7329  (pair, since_ms)
+000108d0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+000108e0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000108f0: 2020 206f 7264 6572 7320 3d20 7365 6c66     orders = self
+00010900: 2e5f 6665 7463 685f 6f72 6465 7273 5f65  ._fetch_orders_e
+00010910: 6d75 6c61 7465 2870 6169 722c 2073 696e  mulate(pair, sin
+00010920: 6365 5f6d 7329 0a20 2020 2020 2020 2020  ce_ms).         
+00010930: 2020 2073 656c 662e 5f6c 6f67 5f65 7863     self._log_exc
+00010940: 6861 6e67 655f 7265 7370 6f6e 7365 2827  hange_response('
+00010950: 6665 7463 685f 6f72 6465 7273 272c 206f  fetch_orders', o
+00010960: 7264 6572 7329 0a20 2020 2020 2020 2020  rders).         
+00010970: 2020 206f 7264 6572 7320 3d20 5b73 656c     orders = [sel
+00010980: 662e 5f6f 7264 6572 5f63 6f6e 7472 6163  f._order_contrac
+00010990: 7473 5f74 6f5f 616d 6f75 6e74 286f 2920  ts_to_amount(o) 
+000109a0: 666f 7220 6f20 696e 206f 7264 6572 735d  for o in orders]
+000109b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+000109c0: 7572 6e20 6f72 6465 7273 0a20 2020 2020  urn orders.     
+000109d0: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
+000109e0: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
+000109f0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00010a00: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
+00010a10: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
+00010a20: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
+00010a30: 6378 742e 4f70 6572 6174 696f 6e46 6169  cxt.OperationFai
+00010a40: 6c65 642c 2063 6378 742e 4578 6368 616e  led, ccxt.Exchan
+00010a50: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
+00010a60: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00010a70: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
+00010a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010a90: 2066 2743 6f75 6c64 206e 6f74 2066 6574   f'Could not fet
+00010aa0: 6368 2070 6f73 6974 696f 6e73 2064 7565  ch positions due
+00010ab0: 2074 6f20 7b65 2e5f 5f63 6c61 7373 5f5f   to {e.__class__
+00010ac0: 2e5f 5f6e 616d 655f 5f7d 2e20 4d65 7373  .__name__}. Mess
+00010ad0: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+00010ae0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+00010af0: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
+00010b00: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00010b10: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+00010b20: 6e61 6c45 7863 6570 7469 6f6e 2865 2920  nalException(e) 
+00010b30: 6672 6f6d 2065 0a0a 2020 2020 4072 6574  from e..    @ret
+00010b40: 7269 6572 0a20 2020 2064 6566 2066 6574  rier.    def fet
+00010b50: 6368 5f74 7261 6469 6e67 5f66 6565 7328  ch_trading_fees(
+00010b60: 7365 6c66 2920 2d3e 2044 6963 745b 7374  self) -> Dict[st
+00010b70: 722c 2041 6e79 5d3a 0a20 2020 2020 2020  r, Any]:.       
+00010b80: 2022 2222 0a20 2020 2020 2020 2046 6574   """.        Fet
+00010b90: 6368 2075 7365 7220 6163 636f 756e 7420  ch user account 
+00010ba0: 7472 6164 696e 6720 6665 6573 0a20 2020  trading fees.   
+00010bb0: 2020 2020 2043 616e 2062 6520 6361 6368       Can be cach
+00010bc0: 6564 2c20 7368 6f75 6c64 206e 6f74 2075  ed, should not u
+00010bd0: 7064 6174 6520 6f66 7465 6e2e 0a20 2020  pdate often..   
+00010be0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00010bf0: 2069 6620 2873 656c 662e 5f63 6f6e 6669   if (self._confi
+00010c00: 675b 2764 7279 5f72 756e 275d 206f 7220  g['dry_run'] or 
+00010c10: 7365 6c66 2e74 7261 6469 6e67 5f6d 6f64  self.trading_mod
+00010c20: 6520 213d 2054 7261 6469 6e67 4d6f 6465  e != TradingMode
+00010c30: 2e46 5554 5552 4553 0a20 2020 2020 2020  .FUTURES.       
+00010c40: 2020 2020 2020 2020 206f 7220 6e6f 7420           or not 
+00010c50: 7365 6c66 2e65 7863 6861 6e67 655f 6861  self.exchange_ha
+00010c60: 7328 2766 6574 6368 5472 6164 696e 6746  s('fetchTradingF
+00010c70: 6565 7327 2929 3a0a 2020 2020 2020 2020  ees')):.        
+00010c80: 2020 2020 7265 7475 726e 207b 7d0a 2020      return {}.  
+00010c90: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00010ca0: 2020 2020 2020 2074 7261 6469 6e67 5f66         trading_f
+00010cb0: 6565 733a 2044 6963 745b 7374 722c 2041  ees: Dict[str, A
+00010cc0: 6e79 5d20 3d20 7365 6c66 2e5f 6170 692e  ny] = self._api.
+00010cd0: 6665 7463 685f 7472 6164 696e 675f 6665  fetch_trading_fe
+00010ce0: 6573 2829 0a20 2020 2020 2020 2020 2020  es().           
+00010cf0: 2073 656c 662e 5f6c 6f67 5f65 7863 6861   self._log_excha
+00010d00: 6e67 655f 7265 7370 6f6e 7365 2827 6665  nge_response('fe
+00010d10: 7463 685f 7472 6164 696e 675f 6665 6573  tch_trading_fees
+00010d20: 272c 2074 7261 6469 6e67 5f66 6565 7329  ', trading_fees)
+00010d30: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00010d40: 7572 6e20 7472 6164 696e 675f 6665 6573  urn trading_fees
+00010d50: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00010d60: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
+00010d70: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00010d80: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
+00010d90: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
+00010da0: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+00010db0: 6570 7420 2863 6378 742e 4f70 6572 6174  ept (ccxt.Operat
+00010dc0: 696f 6e46 6169 6c65 642c 2063 6378 742e  ionFailed, ccxt.
+00010dd0: 4578 6368 616e 6765 4572 726f 7229 2061  ExchangeError) a
+00010de0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00010df0: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
+00010e00: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+00010e10: 2020 2020 2020 2066 2743 6f75 6c64 206e         f'Could n
+00010e20: 6f74 2066 6574 6368 2074 7261 6469 6e67  ot fetch trading
+00010e30: 2066 6565 7320 6475 6520 746f 207b 652e   fees due to {e.
+00010e40: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00010e50: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
+00010e60: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+00010e70: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
+00010e80: 6173 6545 7272 6f72 2061 7320 653a 0a20  aseError as e:. 
+00010e90: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00010ea0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+00010eb0: 7074 696f 6e28 6529 2066 726f 6d20 650a  ption(e) from e.
+00010ec0: 0a20 2020 2040 7265 7472 6965 720a 2020  .    @retrier.  
+00010ed0: 2020 6465 6620 6665 7463 685f 6269 6473    def fetch_bids
+00010ee0: 5f61 736b 7328 7365 6c66 2c20 7379 6d62  _asks(self, symb
+00010ef0: 6f6c 733a 204f 7074 696f 6e61 6c5b 4c69  ols: Optional[Li
+00010f00: 7374 5b73 7472 5d5d 203d 204e 6f6e 652c  st[str]] = None,
+00010f10: 2063 6163 6865 643a 2062 6f6f 6c20 3d20   cached: bool = 
+00010f20: 4661 6c73 6529 202d 3e20 4469 6374 3a0a  False) -> Dict:.
+00010f30: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010f40: 2020 2020 3a70 6172 616d 2073 796d 626f      :param symbo
+00010f50: 6c73 3a20 4c69 7374 206f 6620 7379 6d62  ls: List of symb
+00010f60: 6f6c 7320 746f 2066 6574 6368 0a20 2020  ols to fetch.   
+00010f70: 2020 2020 203a 7061 7261 6d20 6361 6368       :param cach
+00010f80: 6564 3a20 416c 6c6f 7720 6361 6368 6564  ed: Allow cached
+00010f90: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
+00010fa0: 3a72 6574 7572 6e3a 2066 6574 6368 5f62  :return: fetch_b
+00010fb0: 6964 735f 6173 6b73 2072 6573 756c 740a  ids_asks result.
+00010fc0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00010fd0: 2020 2020 6966 206e 6f74 2073 656c 662e      if not self.
+00010fe0: 6578 6368 616e 6765 5f68 6173 2827 6665  exchange_has('fe
+00010ff0: 7463 6842 6964 7341 736b 7327 293a 0a20  tchBidsAsks'):. 
+00011000: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011010: 6e20 7b7d 0a20 2020 2020 2020 2069 6620  n {}.        if 
+00011020: 6361 6368 6564 3a0a 2020 2020 2020 2020  cached:.        
+00011030: 2020 2020 7769 7468 2073 656c 662e 5f63      with self._c
+00011040: 6163 6865 5f6c 6f63 6b3a 0a20 2020 2020  ache_lock:.     
+00011050: 2020 2020 2020 2020 2020 2074 6963 6b65             ticke
+00011060: 7273 203d 2073 656c 662e 5f66 6574 6368  rs = self._fetch
+00011070: 5f74 6963 6b65 7273 5f63 6163 6865 2e67  _tickers_cache.g
+00011080: 6574 2827 6665 7463 685f 6269 6473 5f61  et('fetch_bids_a
+00011090: 736b 7327 290a 2020 2020 2020 2020 2020  sks').          
+000110a0: 2020 6966 2074 6963 6b65 7273 3a0a 2020    if tickers:.  
+000110b0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000110c0: 7475 726e 2074 6963 6b65 7273 0a20 2020  turn tickers.   
+000110d0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000110e0: 2020 2020 2020 7469 636b 6572 7320 3d20        tickers = 
+000110f0: 7365 6c66 2e5f 6170 692e 6665 7463 685f  self._api.fetch_
+00011100: 6269 6473 5f61 736b 7328 7379 6d62 6f6c  bids_asks(symbol
+00011110: 7329 0a20 2020 2020 2020 2020 2020 2077  s).            w
+00011120: 6974 6820 7365 6c66 2e5f 6361 6368 655f  ith self._cache_
+00011130: 6c6f 636b 3a0a 2020 2020 2020 2020 2020  lock:.          
+00011140: 2020 2020 2020 7365 6c66 2e5f 6665 7463        self._fetc
+00011150: 685f 7469 636b 6572 735f 6361 6368 655b  h_tickers_cache[
+00011160: 2766 6574 6368 5f62 6964 735f 6173 6b73  'fetch_bids_asks
+00011170: 275d 203d 2074 6963 6b65 7273 0a20 2020  '] = tickers.   
+00011180: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00011190: 7469 636b 6572 730a 2020 2020 2020 2020  tickers.        
+000111a0: 6578 6365 7074 2063 6378 742e 4e6f 7453  except ccxt.NotS
+000111b0: 7570 706f 7274 6564 2061 7320 653a 0a20  upported as e:. 
+000111c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+000111d0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+000111e0: 7074 696f 6e28 0a20 2020 2020 2020 2020  ption(.         
+000111f0: 2020 2020 2020 2066 2745 7863 6861 6e67         f'Exchang
+00011200: 6520 7b73 656c 662e 5f61 7069 2e6e 616d  e {self._api.nam
+00011210: 657d 2064 6f65 7320 6e6f 7420 7375 7070  e} does not supp
+00011220: 6f72 7420 6665 7463 6869 6e67 2062 6964  ort fetching bid
+00011230: 732f 6173 6b73 2069 6e20 6261 7463 682e  s/asks in batch.
+00011240: 2027 0a20 2020 2020 2020 2020 2020 2020   '.             
+00011250: 2020 2066 274d 6573 7361 6765 3a20 7b65     f'Message: {e
+00011260: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+00011270: 2020 2065 7863 6570 7420 6363 7874 2e44     except ccxt.D
+00011280: 446f 5350 726f 7465 6374 696f 6e20 6173  DoSProtection as
+00011290: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+000112a0: 7261 6973 6520 4444 6f73 5072 6f74 6563  raise DDosProtec
+000112b0: 7469 6f6e 2865 2920 6672 6f6d 2065 0a20  tion(e) from e. 
+000112c0: 2020 2020 2020 2065 7863 6570 7420 2863         except (c
+000112d0: 6378 742e 4f70 6572 6174 696f 6e46 6169  cxt.OperationFai
+000112e0: 6c65 642c 2063 6378 742e 4578 6368 616e  led, ccxt.Exchan
+000112f0: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
+00011300: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00011310: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
+00011320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011330: 2066 2743 6f75 6c64 206e 6f74 206c 6f61   f'Could not loa
+00011340: 6420 6269 6473 2f61 736b 7320 6475 6520  d bids/asks due 
+00011350: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
+00011360: 5f5f 6e61 6d65 5f5f 7d2e 204d 6573 7361  __name__}. Messa
+00011370: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+00011380: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00011390: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
+000113a0: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+000113b0: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+000113c0: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
+000113d0: 726f 6d20 650a 0a20 2020 2040 7265 7472  rom e..    @retr
+000113e0: 6965 720a 2020 2020 6465 6620 6765 745f  ier.    def get_
+000113f0: 7469 636b 6572 7328 7365 6c66 2c20 7379  tickers(self, sy
+00011400: 6d62 6f6c 733a 204f 7074 696f 6e61 6c5b  mbols: Optional[
+00011410: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
+00011420: 652c 2063 6163 6865 643a 2062 6f6f 6c20  e, cached: bool 
+00011430: 3d20 4661 6c73 6529 202d 3e20 5469 636b  = False) -> Tick
+00011440: 6572 733a 0a20 2020 2020 2020 2022 2222  ers:.        """
+00011450: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00011460: 6361 6368 6564 3a20 416c 6c6f 7720 6361  cached: Allow ca
+00011470: 6368 6564 2072 6573 756c 740a 2020 2020  ched result.    
+00011480: 2020 2020 3a72 6574 7572 6e3a 2066 6574      :return: fet
+00011490: 6368 5f74 6963 6b65 7273 2072 6573 756c  ch_tickers resul
+000114a0: 740a 2020 2020 2020 2020 2222 220a 2020  t.        """.  
+000114b0: 2020 2020 2020 7469 636b 6572 733a 2054        tickers: T
+000114c0: 6963 6b65 7273 0a20 2020 2020 2020 2069  ickers.        i
+000114d0: 6620 6e6f 7420 7365 6c66 2e65 7863 6861  f not self.excha
+000114e0: 6e67 655f 6861 7328 2766 6574 6368 5469  nge_has('fetchTi
+000114f0: 636b 6572 7327 293a 0a20 2020 2020 2020  ckers'):.       
+00011500: 2020 2020 2072 6574 7572 6e20 7b7d 0a20       return {}. 
+00011510: 2020 2020 2020 2069 6620 6361 6368 6564         if cached
+00011520: 3a0a 2020 2020 2020 2020 2020 2020 7769  :.            wi
+00011530: 7468 2073 656c 662e 5f63 6163 6865 5f6c  th self._cache_l
+00011540: 6f63 6b3a 0a20 2020 2020 2020 2020 2020  ock:.           
+00011550: 2020 2020 2074 6963 6b65 7273 203d 2073       tickers = s
+00011560: 656c 662e 5f66 6574 6368 5f74 6963 6b65  elf._fetch_ticke
+00011570: 7273 5f63 6163 6865 2e67 6574 2827 6665  rs_cache.get('fe
+00011580: 7463 685f 7469 636b 6572 7327 2920 2023  tch_tickers')  #
+00011590: 2074 7970 653a 2069 676e 6f72 650a 2020   type: ignore.  
+000115a0: 2020 2020 2020 2020 2020 6966 2074 6963            if tic
+000115b0: 6b65 7273 3a0a 2020 2020 2020 2020 2020  kers:.          
+000115c0: 2020 2020 2020 7265 7475 726e 2074 6963        return tic
+000115d0: 6b65 7273 0a20 2020 2020 2020 2074 7279  kers.        try
+000115e0: 3a0a 2020 2020 2020 2020 2020 2020 7469  :.            ti
+000115f0: 636b 6572 7320 3d20 7365 6c66 2e5f 6170  ckers = self._ap
+00011600: 692e 6665 7463 685f 7469 636b 6572 7328  i.fetch_tickers(
+00011610: 7379 6d62 6f6c 7329 0a20 2020 2020 2020  symbols).       
+00011620: 2020 2020 2077 6974 6820 7365 6c66 2e5f       with self._
+00011630: 6361 6368 655f 6c6f 636b 3a0a 2020 2020  cache_lock:.    
+00011640: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00011650: 2e5f 6665 7463 685f 7469 636b 6572 735f  ._fetch_tickers_
+00011660: 6361 6368 655b 2766 6574 6368 5f74 6963  cache['fetch_tic
+00011670: 6b65 7273 275d 203d 2074 6963 6b65 7273  kers'] = tickers
+00011680: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00011690: 7572 6e20 7469 636b 6572 730a 2020 2020  urn tickers.    
+000116a0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+000116b0: 4e6f 7453 7570 706f 7274 6564 2061 7320  NotSupported as 
+000116c0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+000116d0: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
+000116e0: 4578 6365 7074 696f 6e28 0a20 2020 2020  Exception(.     
+000116f0: 2020 2020 2020 2020 2020 2066 2745 7863             f'Exc
+00011700: 6861 6e67 6520 7b73 656c 662e 5f61 7069  hange {self._api
+00011710: 2e6e 616d 657d 2064 6f65 7320 6e6f 7420  .name} does not 
+00011720: 7375 7070 6f72 7420 6665 7463 6869 6e67  support fetching
+00011730: 2074 6963 6b65 7273 2069 6e20 6261 7463   tickers in batc
+00011740: 682e 2027 0a20 2020 2020 2020 2020 2020  h. '.           
+00011750: 2020 2020 2066 274d 6573 7361 6765 3a20       f'Message: 
+00011760: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+00011770: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+00011780: 2e42 6164 5379 6d62 6f6c 2061 7320 653a  .BadSymbol as e:
+00011790: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+000117a0: 6765 722e 7761 726e 696e 6728 6622 436f  ger.warning(f"Co
+000117b0: 756c 6420 6e6f 7420 6c6f 6164 2074 6963  uld not load tic
+000117c0: 6b65 7273 2064 7565 2074 6f20 7b65 2e5f  kers due to {e._
+000117d0: 5f63 6c61 7373 5f5f 2e5f 5f6e 616d 655f  _class__.__name_
+000117e0: 5f7d 2e20 4d65 7373 6167 653a 207b 657d  _}. Message: {e}
+000117f0: 202e 220a 2020 2020 2020 2020 2020 2020   .".            
+00011800: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00011810: 5265 6c6f 6164 696e 6720 6d61 726b 6574  Reloading market
+00011820: 732e 2229 0a20 2020 2020 2020 2020 2020  s.").           
+00011830: 2073 656c 662e 7265 6c6f 6164 5f6d 6172   self.reload_mar
+00011840: 6b65 7473 2854 7275 6529 0a20 2020 2020  kets(True).     
+00011850: 2020 2020 2020 2023 2052 652d 7261 6973         # Re-rais
+00011860: 6520 6578 6365 7074 696f 6e20 746f 2072  e exception to r
+00011870: 6570 6561 7420 7468 6520 6361 6c6c 2e0a  epeat the call..
+00011880: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00011890: 6520 5465 6d70 6f72 6172 7945 7272 6f72  e TemporaryError
+000118a0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+000118b0: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+000118c0: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+000118d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000118e0: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+000118f0: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+00011900: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+00011910: 2e4f 7065 7261 7469 6f6e 4661 696c 6564  .OperationFailed
+00011920: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+00011930: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+00011940: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+00011950: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
+00011960: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+00011970: 436f 756c 6420 6e6f 7420 6c6f 6164 2074  Could not load t
+00011980: 6963 6b65 7273 2064 7565 2074 6f20 7b65  ickers due to {e
+00011990: 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e 616d  .__class__.__nam
+000119a0: 655f 5f7d 2e20 4d65 7373 6167 653a 207b  e__}. Message: {
+000119b0: 657d 2729 2066 726f 6d20 650a 2020 2020  e}') from e.    
+000119c0: 2020 2020 6578 6365 7074 2063 6378 742e      except ccxt.
+000119d0: 4261 7365 4572 726f 7220 6173 2065 3a0a  BaseError as e:.
+000119e0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000119f0: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+00011a00: 6570 7469 6f6e 2865 2920 6672 6f6d 2065  eption(e) from e
+00011a10: 0a0a 2020 2020 2320 5072 6963 696e 6720  ..    # Pricing 
+00011a20: 696e 666f 0a0a 2020 2020 4072 6574 7269  info..    @retri
+00011a30: 6572 0a20 2020 2064 6566 2066 6574 6368  er.    def fetch
+00011a40: 5f74 6963 6b65 7228 7365 6c66 2c20 7061  _ticker(self, pa
+00011a50: 6972 3a20 7374 7229 202d 3e20 5469 636b  ir: str) -> Tick
+00011a60: 6572 3a0a 2020 2020 2020 2020 7472 793a  er:.        try:
+00011a70: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00011a80: 2870 6169 7220 6e6f 7420 696e 2073 656c  (pair not in sel
+00011a90: 662e 6d61 726b 6574 7320 6f72 0a20 2020  f.markets or.   
+00011aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ab0: 2073 656c 662e 6d61 726b 6574 735b 7061   self.markets[pa
+00011ac0: 6972 5d2e 6765 7428 2761 6374 6976 6527  ir].get('active'
+00011ad0: 2c20 4661 6c73 6529 2069 7320 4661 6c73  , False) is Fals
+00011ae0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+00011af0: 2020 2020 7261 6973 6520 4578 6368 616e      raise Exchan
+00011b00: 6765 4572 726f 7228 6622 5061 6972 207b  geError(f"Pair {
+00011b10: 7061 6972 7d20 6e6f 7420 6176 6169 6c61  pair} not availa
+00011b20: 626c 6522 290a 2020 2020 2020 2020 2020  ble").          
+00011b30: 2020 6461 7461 3a20 5469 636b 6572 203d    data: Ticker =
+00011b40: 2073 656c 662e 5f61 7069 2e66 6574 6368   self._api.fetch
+00011b50: 5f74 6963 6b65 7228 7061 6972 290a 2020  _ticker(pair).  
+00011b60: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00011b70: 2064 6174 610a 2020 2020 2020 2020 6578   data.        ex
+00011b80: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
+00011b90: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
+00011ba0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00011bb0: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
+00011bc0: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
+00011bd0: 2020 6578 6365 7074 2028 6363 7874 2e4f    except (ccxt.O
+00011be0: 7065 7261 7469 6f6e 4661 696c 6564 2c20  perationFailed, 
+00011bf0: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
+00011c00: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
+00011c10: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
+00011c20: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
+00011c30: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
+00011c40: 756c 6420 6e6f 7420 6c6f 6164 2074 6963  uld not load tic
+00011c50: 6b65 7220 6475 6520 746f 207b 652e 5f5f  ker due to {e.__
+00011c60: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+00011c70: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
+00011c80: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+00011c90: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
+00011ca0: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
+00011cb0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+00011cc0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+00011cd0: 696f 6e28 6529 2066 726f 6d20 650a 0a20  ion(e) from e.. 
+00011ce0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+00011cf0: 0a20 2020 2064 6566 2067 6574 5f6e 6578  .    def get_nex
+00011d00: 745f 6c69 6d69 745f 696e 5f6c 6973 7428  t_limit_in_list(
+00011d10: 6c69 6d69 743a 2069 6e74 2c20 6c69 6d69  limit: int, limi
+00011d20: 745f 7261 6e67 653a 204f 7074 696f 6e61  t_range: Optiona
+00011d30: 6c5b 4c69 7374 5b69 6e74 5d5d 2c0a 2020  l[List[int]],.  
+00011d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d50: 2020 2020 2020 2020 2020 2020 2072 616e               ran
+00011d60: 6765 5f72 6571 7569 7265 643a 2062 6f6f  ge_required: boo
+00011d70: 6c20 3d20 5472 7565 293a 0a20 2020 2020  l = True):.     
+00011d80: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
+00011d90: 6574 206e 6578 7420 6772 6561 7465 7220  et next greater 
+00011da0: 7661 6c75 6520 696e 2074 6865 206c 6973  value in the lis
+00011db0: 742e 0a20 2020 2020 2020 2055 7365 6420  t..        Used 
+00011dc0: 6279 2066 6574 6368 5f6c 325f 6f72 6465  by fetch_l2_orde
+00011dd0: 725f 626f 6f6b 2069 6620 7468 6520 6170  r_book if the ap
+00011de0: 6920 6f6e 6c79 2073 7570 706f 7274 7320  i only supports 
+00011df0: 6120 6c69 6d69 7465 6420 7261 6e67 650a  a limited range.
+00011e00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00011e10: 2020 2020 6966 206e 6f74 206c 696d 6974      if not limit
+00011e20: 5f72 616e 6765 3a0a 2020 2020 2020 2020  _range:.        
+00011e30: 2020 2020 7265 7475 726e 206c 696d 6974      return limit
+00011e40: 0a0a 2020 2020 2020 2020 7265 7375 6c74  ..        result
+00011e50: 203d 206d 696e 285b 7820 666f 7220 7820   = min([x for x 
+00011e60: 696e 206c 696d 6974 5f72 616e 6765 2069  in limit_range i
+00011e70: 6620 6c69 6d69 7420 3c3d 2078 5d20 2b20  f limit <= x] + 
+00011e80: 5b6d 6178 286c 696d 6974 5f72 616e 6765  [max(limit_range
+00011e90: 295d 290a 2020 2020 2020 2020 6966 206e  )]).        if n
+00011ea0: 6f74 2072 616e 6765 5f72 6571 7569 7265  ot range_require
+00011eb0: 6420 616e 6420 6c69 6d69 7420 3e20 7265  d and limit > re
+00011ec0: 7375 6c74 3a0a 2020 2020 2020 2020 2020  sult:.          
+00011ed0: 2020 2320 5261 6e67 6520 6973 206e 6f74    # Range is not
+00011ee0: 2072 6571 7569 7265 6420 2d20 7765 2063   required - we c
+00011ef0: 616e 2075 7365 204e 6f6e 6520 6173 2070  an use None as p
+00011f00: 6172 616d 6574 6572 2e0a 2020 2020 2020  arameter..      
+00011f10: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+00011f20: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
+00011f30: 2072 6573 756c 740a 0a20 2020 2040 7265   result..    @re
+00011f40: 7472 6965 720a 2020 2020 6465 6620 6665  trier.    def fe
+00011f50: 7463 685f 6c32 5f6f 7264 6572 5f62 6f6f  tch_l2_order_boo
+00011f60: 6b28 7365 6c66 2c20 7061 6972 3a20 7374  k(self, pair: st
+00011f70: 722c 206c 696d 6974 3a20 696e 7420 3d20  r, limit: int = 
+00011f80: 3130 3029 202d 3e20 4f72 6465 7242 6f6f  100) -> OrderBoo
+00011f90: 6b3a 0a20 2020 2020 2020 2022 2222 0a20  k:.        """. 
+00011fa0: 2020 2020 2020 2047 6574 204c 3220 6f72         Get L2 or
+00011fb0: 6465 7220 626f 6f6b 2066 726f 6d20 6578  der book from ex
+00011fc0: 6368 616e 6765 2e0a 2020 2020 2020 2020  change..        
+00011fd0: 4361 6e20 6265 206c 696d 6974 6564 2074  Can be limited t
+00011fe0: 6f20 6120 6365 7274 6169 6e20 616d 6f75  o a certain amou
+00011ff0: 6e74 2028 6966 2073 7570 706f 7274 6564  nt (if supported
+00012000: 292e 0a20 2020 2020 2020 2052 6574 7572  )..        Retur
+00012010: 6e73 2061 2064 6963 7420 696e 2074 6865  ns a dict in the
+00012020: 2066 6f72 6d61 740a 2020 2020 2020 2020   format.        
+00012030: 7b27 6173 6b73 273a 205b 7072 6963 652c  {'asks': [price,
+00012040: 2076 6f6c 756d 655d 2c20 2762 6964 7327   volume], 'bids'
+00012050: 3a20 5b70 7269 6365 2c20 766f 6c75 6d65  : [price, volume
+00012060: 5d7d 0a20 2020 2020 2020 2022 2222 0a20  ]}.        """. 
+00012070: 2020 2020 2020 206c 696d 6974 3120 3d20         limit1 = 
+00012080: 7365 6c66 2e67 6574 5f6e 6578 745f 6c69  self.get_next_li
+00012090: 6d69 745f 696e 5f6c 6973 7428 6c69 6d69  mit_in_list(limi
+000120a0: 742c 2073 656c 662e 5f66 745f 6861 735b  t, self._ft_has[
+000120b0: 276c 325f 6c69 6d69 745f 7261 6e67 6527  'l2_limit_range'
+000120c0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+000120d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000120e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000120f0: 7365 6c66 2e5f 6674 5f68 6173 5b27 6c32  self._ft_has['l2
+00012100: 5f6c 696d 6974 5f72 616e 6765 5f72 6571  _limit_range_req
+00012110: 7569 7265 6427 5d29 0a20 2020 2020 2020  uired']).       
+00012120: 2074 7279 3a0a 0a20 2020 2020 2020 2020   try:..         
+00012130: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+00012140: 6170 692e 6665 7463 685f 6c32 5f6f 7264  api.fetch_l2_ord
+00012150: 6572 5f62 6f6f 6b28 7061 6972 2c20 6c69  er_book(pair, li
+00012160: 6d69 7431 290a 2020 2020 2020 2020 6578  mit1).        ex
+00012170: 6365 7074 2063 6378 742e 4e6f 7453 7570  cept ccxt.NotSup
+00012180: 706f 7274 6564 2061 7320 653a 0a20 2020  ported as e:.   
+00012190: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+000121a0: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+000121b0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+000121c0: 2020 2020 2066 2745 7863 6861 6e67 6520       f'Exchange 
+000121d0: 7b73 656c 662e 5f61 7069 2e6e 616d 657d  {self._api.name}
+000121e0: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
+000121f0: 7420 6665 7463 6869 6e67 206f 7264 6572  t fetching order
+00012200: 2062 6f6f 6b2e 270a 2020 2020 2020 2020   book.'.        
+00012210: 2020 2020 2020 2020 6627 4d65 7373 6167          f'Messag
+00012220: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
+00012230: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+00012240: 6378 742e 4444 6f53 5072 6f74 6563 7469  cxt.DDoSProtecti
+00012250: 6f6e 2061 7320 653a 0a20 2020 2020 2020  on as e:.       
+00012260: 2020 2020 2072 6169 7365 2044 446f 7350       raise DDosP
+00012270: 726f 7465 6374 696f 6e28 6529 2066 726f  rotection(e) fro
+00012280: 6d20 650a 2020 2020 2020 2020 6578 6365  m e.        exce
+00012290: 7074 2028 6363 7874 2e4f 7065 7261 7469  pt (ccxt.Operati
+000122a0: 6f6e 4661 696c 6564 2c20 6363 7874 2e45  onFailed, ccxt.E
+000122b0: 7863 6861 6e67 6545 7272 6f72 2920 6173  xchangeError) as
+000122c0: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+000122d0: 7261 6973 6520 5465 6d70 6f72 6172 7945  raise TemporaryE
+000122e0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+000122f0: 2020 2020 2020 6627 436f 756c 6420 6e6f        f'Could no
+00012300: 7420 6765 7420 6f72 6465 7220 626f 6f6b  t get order book
+00012310: 2064 7565 2074 6f20 7b65 2e5f 5f63 6c61   due to {e.__cla
+00012320: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20  ss__.__name__}. 
+00012330: 4d65 7373 6167 653a 207b 657d 2729 2066  Message: {e}') f
+00012340: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
+00012350: 6365 7074 2063 6378 742e 4261 7365 4572  cept ccxt.BaseEr
+00012360: 726f 7220 6173 2065 3a0a 2020 2020 2020  ror as e:.      
+00012370: 2020 2020 2020 7261 6973 6520 4f70 6572        raise Oper
+00012380: 6174 696f 6e61 6c45 7863 6570 7469 6f6e  ationalException
+00012390: 2865 2920 6672 6f6d 2065 0a0a 2020 2020  (e) from e..    
+000123a0: 6465 6620 5f67 6574 5f70 7269 6365 5f73  def _get_price_s
+000123b0: 6964 6528 7365 6c66 2c20 7369 6465 3a20  ide(self, side: 
+000123c0: 7374 722c 2069 735f 7368 6f72 743a 2062  str, is_short: b
+000123d0: 6f6f 6c2c 2063 6f6e 665f 7374 7261 7465  ool, conf_strate
+000123e0: 6779 3a20 4469 6374 2920 2d3e 2042 6964  gy: Dict) -> Bid
+000123f0: 4173 6b3a 0a20 2020 2020 2020 2070 7269  Ask:.        pri
+00012400: 6365 5f73 6964 6520 3d20 636f 6e66 5f73  ce_side = conf_s
+00012410: 7472 6174 6567 795b 2770 7269 6365 5f73  trategy['price_s
+00012420: 6964 6527 5d0a 0a20 2020 2020 2020 2069  ide']..        i
+00012430: 6620 7072 6963 655f 7369 6465 2069 6e20  f price_side in 
+00012440: 2827 7361 6d65 272c 2027 6f74 6865 7227  ('same', 'other'
+00012450: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+00012460: 7269 6365 5f6d 6170 203d 207b 0a20 2020  rice_map = {.   
+00012470: 2020 2020 2020 2020 2020 2020 2028 2765               ('e
+00012480: 6e74 7279 272c 2027 6c6f 6e67 272c 2027  ntry', 'long', '
+00012490: 7361 6d65 2729 3a20 2762 6964 272c 0a20  same'): 'bid',. 
+000124a0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000124b0: 2765 6e74 7279 272c 2027 6c6f 6e67 272c  'entry', 'long',
+000124c0: 2027 6f74 6865 7227 293a 2027 6173 6b27   'other'): 'ask'
+000124d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000124e0: 2020 2827 656e 7472 7927 2c20 2773 686f    ('entry', 'sho
+000124f0: 7274 272c 2027 7361 6d65 2729 3a20 2761  rt', 'same'): 'a
+00012500: 736b 272c 0a20 2020 2020 2020 2020 2020  sk',.           
+00012510: 2020 2020 2028 2765 6e74 7279 272c 2027       ('entry', '
+00012520: 7368 6f72 7427 2c20 276f 7468 6572 2729  short', 'other')
+00012530: 3a20 2762 6964 272c 0a20 2020 2020 2020  : 'bid',.       
+00012540: 2020 2020 2020 2020 2028 2765 7869 7427           ('exit'
+00012550: 2c20 276c 6f6e 6727 2c20 2773 616d 6527  , 'long', 'same'
+00012560: 293a 2027 6173 6b27 2c0a 2020 2020 2020  ): 'ask',.      
+00012570: 2020 2020 2020 2020 2020 2827 6578 6974            ('exit
+00012580: 272c 2027 6c6f 6e67 272c 2027 6f74 6865  ', 'long', 'othe
+00012590: 7227 293a 2027 6269 6427 2c0a 2020 2020  r'): 'bid',.    
+000125a0: 2020 2020 2020 2020 2020 2020 2827 6578              ('ex
+000125b0: 6974 272c 2027 7368 6f72 7427 2c20 2773  it', 'short', 's
+000125c0: 616d 6527 293a 2027 6269 6427 2c0a 2020  ame'): 'bid',.  
+000125d0: 2020 2020 2020 2020 2020 2020 2020 2827                ('
+000125e0: 6578 6974 272c 2027 7368 6f72 7427 2c20  exit', 'short', 
+000125f0: 276f 7468 6572 2729 3a20 2761 736b 272c  'other'): 'ask',
+00012600: 0a20 2020 2020 2020 2020 2020 207d 0a20  .            }. 
+00012610: 2020 2020 2020 2020 2020 2070 7269 6365             price
+00012620: 5f73 6964 6520 3d20 7072 6963 655f 6d61  _side = price_ma
+00012630: 705b 2873 6964 652c 2027 7368 6f72 7427  p[(side, 'short'
+00012640: 2069 6620 6973 5f73 686f 7274 2065 6c73   if is_short els
+00012650: 6520 276c 6f6e 6727 2c20 7072 6963 655f  e 'long', price_
+00012660: 7369 6465 295d 0a20 2020 2020 2020 2072  side)].        r
+00012670: 6574 7572 6e20 7072 6963 655f 7369 6465  eturn price_side
+00012680: 0a0a 2020 2020 6465 6620 6765 745f 7261  ..    def get_ra
+00012690: 7465 2873 656c 662c 2070 6169 723a 2073  te(self, pair: s
+000126a0: 7472 2c20 7265 6672 6573 683a 2062 6f6f  tr, refresh: boo
+000126b0: 6c2c 0a20 2020 2020 2020 2020 2020 2020  l,.             
+000126c0: 2020 2020 7369 6465 3a20 456e 7472 7945      side: EntryE
+000126d0: 7869 742c 2069 735f 7368 6f72 743a 2062  xit, is_short: b
+000126e0: 6f6f 6c2c 0a20 2020 2020 2020 2020 2020  ool,.           
+000126f0: 2020 2020 2020 6f72 6465 725f 626f 6f6b        order_book
+00012700: 3a20 4f70 7469 6f6e 616c 5b4f 7264 6572  : Optional[Order
+00012710: 426f 6f6b 5d20 3d20 4e6f 6e65 2c20 7469  Book] = None, ti
+00012720: 636b 6572 3a20 4f70 7469 6f6e 616c 5b54  cker: Optional[T
+00012730: 6963 6b65 725d 203d 204e 6f6e 6529 202d  icker] = None) -
+00012740: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
+00012750: 2022 2222 0a20 2020 2020 2020 2043 616c   """.        Cal
+00012760: 6375 6c61 7465 7320 6269 642f 6173 6b20  culates bid/ask 
+00012770: 7461 7267 6574 0a20 2020 2020 2020 2062  target.        b
+00012780: 6964 2072 6174 6520 2d20 6265 7477 6565  id rate - betwee
+00012790: 6e20 6375 7272 656e 7420 6173 6b20 7072  n current ask pr
+000127a0: 6963 6520 616e 6420 6c61 7374 2070 7269  ice and last pri
+000127b0: 6365 0a20 2020 2020 2020 2061 736b 2072  ce.        ask r
+000127c0: 6174 6520 2d20 6569 7468 6572 2075 7369  ate - either usi
+000127d0: 6e67 2074 6963 6b65 7220 6269 6420 6f72  ng ticker bid or
+000127e0: 2066 6972 7374 2062 6964 2062 6173 6564   first bid based
+000127f0: 206f 6e20 6f72 6465 7262 6f6f 6b0a 2020   on orderbook.  
+00012800: 2020 2020 2020 6f72 2072 656d 6169 6e20        or remain 
+00012810: 7374 6174 6963 2069 6e20 616e 7920 6f74  static in any ot
+00012820: 6865 7220 6361 7365 2073 696e 6365 2069  her case since i
+00012830: 7427 7320 6e6f 7420 7570 6461 7469 6e67  t's not updating
+00012840: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00012850: 2070 6169 723a 2050 6169 7220 746f 2067   pair: Pair to g
+00012860: 6574 2072 6174 6520 666f 720a 2020 2020  et rate for.    
+00012870: 2020 2020 3a70 6172 616d 2072 6566 7265      :param refre
+00012880: 7368 3a20 616c 6c6f 7720 6361 6368 6564  sh: allow cached
+00012890: 2064 6174 610a 2020 2020 2020 2020 3a70   data.        :p
+000128a0: 6172 616d 2073 6964 653a 2022 6275 7922  aram side: "buy"
+000128b0: 206f 7220 2273 656c 6c22 0a20 2020 2020   or "sell".     
+000128c0: 2020 203a 7265 7475 726e 3a20 666c 6f61     :return: floa
+000128d0: 743a 2050 7269 6365 0a20 2020 2020 2020  t: Price.       
+000128e0: 203a 7261 6973 6573 2050 7269 6369 6e67   :raises Pricing
+000128f0: 4572 726f 7220 6966 206f 7264 6572 626f  Error if orderbo
+00012900: 6f6b 2070 7269 6365 2063 6f75 6c64 206e  ok price could n
+00012910: 6f74 2062 6520 6465 7465 726d 696e 6564  ot be determined
+00012920: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+00012930: 2020 2020 2020 6e61 6d65 203d 2073 6964        name = sid
+00012940: 652e 6361 7069 7461 6c69 7a65 2829 0a20  e.capitalize(). 
+00012950: 2020 2020 2020 2073 7472 6174 5f6e 616d         strat_nam
+00012960: 6520 3d20 2765 6e74 7279 5f70 7269 6369  e = 'entry_prici
+00012970: 6e67 2720 6966 2073 6964 6520 3d3d 2022  ng' if side == "
+00012980: 656e 7472 7922 2065 6c73 6520 2765 7869  entry" else 'exi
+00012990: 745f 7072 6963 696e 6727 0a0a 2020 2020  t_pricing'..    
+000129a0: 2020 2020 6361 6368 655f 7261 7465 3a20      cache_rate: 
+000129b0: 5454 4c43 6163 6865 203d 2073 656c 662e  TTLCache = self.
+000129c0: 5f65 6e74 7279 5f72 6174 655f 6361 6368  _entry_rate_cach
+000129d0: 6520 6966 2073 6964 6520 3d3d 2022 656e  e if side == "en
+000129e0: 7472 7922 2065 6c73 6520 7365 6c66 2e5f  try" else self._
+000129f0: 6578 6974 5f72 6174 655f 6361 6368 650a  exit_rate_cache.
+00012a00: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+00012a10: 6566 7265 7368 3a0a 2020 2020 2020 2020  efresh:.        
+00012a20: 2020 2020 7769 7468 2073 656c 662e 5f63      with self._c
+00012a30: 6163 6865 5f6c 6f63 6b3a 0a20 2020 2020  ache_lock:.     
+00012a40: 2020 2020 2020 2020 2020 2072 6174 6520             rate 
+00012a50: 3d20 6361 6368 655f 7261 7465 2e67 6574  = cache_rate.get
+00012a60: 2870 6169 7229 0a20 2020 2020 2020 2020  (pair).         
+00012a70: 2020 2023 2043 6865 636b 2069 6620 6361     # Check if ca
+00012a80: 6368 6520 6861 7320 6265 656e 2069 6e76  che has been inv
+00012a90: 616c 6964 6174 6564 0a20 2020 2020 2020  alidated.       
+00012aa0: 2020 2020 2069 6620 7261 7465 3a0a 2020       if rate:.  
+00012ab0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00012ac0: 6767 6572 2e64 6562 7567 2866 2255 7369  gger.debug(f"Usi
+00012ad0: 6e67 2063 6163 6865 6420 7b73 6964 657d  ng cached {side}
+00012ae0: 2072 6174 6520 666f 7220 7b70 6169 727d   rate for {pair}
+00012af0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
+00012b00: 2020 2020 7265 7475 726e 2072 6174 650a      return rate.
+00012b10: 0a20 2020 2020 2020 2063 6f6e 665f 7374  .        conf_st
+00012b20: 7261 7465 6779 203d 2073 656c 662e 5f63  rategy = self._c
+00012b30: 6f6e 6669 672e 6765 7428 7374 7261 745f  onfig.get(strat_
+00012b40: 6e61 6d65 2c20 7b7d 290a 0a20 2020 2020  name, {})..     
+00012b50: 2020 2070 7269 6365 5f73 6964 6520 3d20     price_side = 
+00012b60: 7365 6c66 2e5f 6765 745f 7072 6963 655f  self._get_price_
+00012b70: 7369 6465 2873 6964 652c 2069 735f 7368  side(side, is_sh
+00012b80: 6f72 742c 2063 6f6e 665f 7374 7261 7465  ort, conf_strate
+00012b90: 6779 290a 0a20 2020 2020 2020 2069 6620  gy)..        if 
+00012ba0: 636f 6e66 5f73 7472 6174 6567 792e 6765  conf_strategy.ge
+00012bb0: 7428 2775 7365 5f6f 7264 6572 5f62 6f6f  t('use_order_boo
+00012bc0: 6b27 2c20 4661 6c73 6529 3a0a 0a20 2020  k', False):..   
+00012bd0: 2020 2020 2020 2020 206f 7264 6572 5f62           order_b
+00012be0: 6f6f 6b5f 746f 7020 3d20 636f 6e66 5f73  ook_top = conf_s
+00012bf0: 7472 6174 6567 792e 6765 7428 276f 7264  trategy.get('ord
+00012c00: 6572 5f62 6f6f 6b5f 746f 7027 2c20 3129  er_book_top', 1)
+00012c10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00012c20: 6f72 6465 725f 626f 6f6b 2069 7320 4e6f  order_book is No
+00012c30: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00012c40: 2020 2020 6f72 6465 725f 626f 6f6b 203d      order_book =
+00012c50: 2073 656c 662e 6665 7463 685f 6c32 5f6f   self.fetch_l2_o
+00012c60: 7264 6572 5f62 6f6f 6b28 7061 6972 2c20  rder_book(pair, 
+00012c70: 6f72 6465 725f 626f 6f6b 5f74 6f70 290a  order_book_top).
+00012c80: 2020 2020 2020 2020 2020 2020 7261 7465              rate
+00012c90: 203d 2073 656c 662e 5f67 6574 5f72 6174   = self._get_rat
+00012ca0: 655f 6672 6f6d 5f6f 6228 7061 6972 2c20  e_from_ob(pair, 
+00012cb0: 7369 6465 2c20 6f72 6465 725f 626f 6f6b  side, order_book
+00012cc0: 2c20 6e61 6d65 2c20 7072 6963 655f 7369  , name, price_si
+00012cd0: 6465 2c0a 2020 2020 2020 2020 2020 2020  de,.            
+00012ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012cf0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00012d00: 6465 725f 626f 6f6b 5f74 6f70 290a 2020  der_book_top).  
+00012d10: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+00012d20: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
+00012d30: 6562 7567 2866 2255 7369 6e67 204c 6173  ebug(f"Using Las
+00012d40: 7420 7b70 7269 6365 5f73 6964 652e 6361  t {price_side.ca
+00012d50: 7069 7461 6c69 7a65 2829 7d20 2f20 4c61  pitalize()} / La
+00012d60: 7374 2050 7269 6365 2229 0a20 2020 2020  st Price").     
+00012d70: 2020 2020 2020 2069 6620 7469 636b 6572         if ticker
+00012d80: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00012d90: 2020 2020 2020 2020 2020 7469 636b 6572            ticker
+00012da0: 203d 2073 656c 662e 6665 7463 685f 7469   = self.fetch_ti
+00012db0: 636b 6572 2870 6169 7229 0a20 2020 2020  cker(pair).     
+00012dc0: 2020 2020 2020 2072 6174 6520 3d20 7365         rate = se
+00012dd0: 6c66 2e5f 6765 745f 7261 7465 5f66 726f  lf._get_rate_fro
+00012de0: 6d5f 7469 636b 6572 2873 6964 652c 2074  m_ticker(side, t
+00012df0: 6963 6b65 722c 2063 6f6e 665f 7374 7261  icker, conf_stra
+00012e00: 7465 6779 2c20 7072 6963 655f 7369 6465  tegy, price_side
+00012e10: 290a 0a20 2020 2020 2020 2069 6620 7261  )..        if ra
+00012e20: 7465 2069 7320 4e6f 6e65 3a0a 2020 2020  te is None:.    
+00012e30: 2020 2020 2020 2020 7261 6973 6520 5072          raise Pr
+00012e40: 6963 696e 6745 7272 6f72 2866 227b 6e61  icingError(f"{na
+00012e50: 6d65 7d2d 5261 7465 2066 6f72 207b 7061  me}-Rate for {pa
+00012e60: 6972 7d20 7761 7320 656d 7074 792e 2229  ir} was empty.")
+00012e70: 0a20 2020 2020 2020 2077 6974 6820 7365  .        with se
+00012e80: 6c66 2e5f 6361 6368 655f 6c6f 636b 3a0a  lf._cache_lock:.
+00012e90: 2020 2020 2020 2020 2020 2020 6361 6368              cach
+00012ea0: 655f 7261 7465 5b70 6169 725d 203d 2072  e_rate[pair] = r
+00012eb0: 6174 650a 0a20 2020 2020 2020 2072 6574  ate..        ret
+00012ec0: 7572 6e20 7261 7465 0a0a 2020 2020 6465  urn rate..    de
+00012ed0: 6620 5f67 6574 5f72 6174 655f 6672 6f6d  f _get_rate_from
+00012ee0: 5f74 6963 6b65 7228 7365 6c66 2c20 7369  _ticker(self, si
+00012ef0: 6465 3a20 456e 7472 7945 7869 742c 2074  de: EntryExit, t
+00012f00: 6963 6b65 723a 2054 6963 6b65 722c 2063  icker: Ticker, c
+00012f10: 6f6e 665f 7374 7261 7465 6779 3a20 4469  onf_strategy: Di
+00012f20: 6374 5b73 7472 2c20 416e 795d 2c0a 2020  ct[str, Any],.  
+00012f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f40: 2020 2020 2020 2020 2020 2020 7072 6963              pric
+00012f50: 655f 7369 6465 3a20 4269 6441 736b 2920  e_side: BidAsk) 
+00012f60: 2d3e 204f 7074 696f 6e61 6c5b 666c 6f61  -> Optional[floa
+00012f70: 745d 3a0a 2020 2020 2020 2020 2222 220a  t]:.        """.
+00012f80: 2020 2020 2020 2020 4765 7420 7261 7465          Get rate
+00012f90: 2066 726f 6d20 7469 636b 6572 2e0a 2020   from ticker..  
+00012fa0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00012fb0: 2020 7469 636b 6572 5f72 6174 6520 3d20    ticker_rate = 
+00012fc0: 7469 636b 6572 5b70 7269 6365 5f73 6964  ticker[price_sid
+00012fd0: 655d 0a20 2020 2020 2020 2069 6620 7469  e].        if ti
+00012fe0: 636b 6572 5b27 6c61 7374 275d 2061 6e64  cker['last'] and
+00012ff0: 2074 6963 6b65 725f 7261 7465 3a0a 2020   ticker_rate:.  
+00013000: 2020 2020 2020 2020 2020 6966 2073 6964            if sid
+00013010: 6520 3d3d 2027 656e 7472 7927 2061 6e64  e == 'entry' and
+00013020: 2074 6963 6b65 725f 7261 7465 203e 2074   ticker_rate > t
+00013030: 6963 6b65 725b 276c 6173 7427 5d3a 0a20  icker['last']:. 
+00013040: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+00013050: 616c 616e 6365 203d 2063 6f6e 665f 7374  alance = conf_st
+00013060: 7261 7465 6779 2e67 6574 2827 7072 6963  rategy.get('pric
+00013070: 655f 6c61 7374 5f62 616c 616e 6365 272c  e_last_balance',
+00013080: 2030 2e30 290a 2020 2020 2020 2020 2020   0.0).          
+00013090: 2020 2020 2020 7469 636b 6572 5f72 6174        ticker_rat
+000130a0: 6520 3d20 7469 636b 6572 5f72 6174 6520  e = ticker_rate 
+000130b0: 2b20 6261 6c61 6e63 6520 2a20 2874 6963  + balance * (tic
+000130c0: 6b65 725b 276c 6173 7427 5d20 2d20 7469  ker['last'] - ti
+000130d0: 636b 6572 5f72 6174 6529 0a20 2020 2020  cker_rate).     
+000130e0: 2020 2020 2020 2065 6c69 6620 7369 6465         elif side
+000130f0: 203d 3d20 2765 7869 7427 2061 6e64 2074   == 'exit' and t
+00013100: 6963 6b65 725f 7261 7465 203c 2074 6963  icker_rate < tic
+00013110: 6b65 725b 276c 6173 7427 5d3a 0a20 2020  ker['last']:.   
+00013120: 2020 2020 2020 2020 2020 2020 2062 616c               bal
+00013130: 616e 6365 203d 2063 6f6e 665f 7374 7261  ance = conf_stra
+00013140: 7465 6779 2e67 6574 2827 7072 6963 655f  tegy.get('price_
+00013150: 6c61 7374 5f62 616c 616e 6365 272c 2030  last_balance', 0
+00013160: 2e30 290a 2020 2020 2020 2020 2020 2020  .0).            
+00013170: 2020 2020 7469 636b 6572 5f72 6174 6520      ticker_rate 
+00013180: 3d20 7469 636b 6572 5f72 6174 6520 2d20  = ticker_rate - 
+00013190: 6261 6c61 6e63 6520 2a20 2874 6963 6b65  balance * (ticke
+000131a0: 725f 7261 7465 202d 2074 6963 6b65 725b  r_rate - ticker[
+000131b0: 276c 6173 7427 5d29 0a20 2020 2020 2020  'last']).       
+000131c0: 2072 6174 6520 3d20 7469 636b 6572 5f72   rate = ticker_r
+000131d0: 6174 650a 2020 2020 2020 2020 7265 7475  ate.        retu
+000131e0: 726e 2072 6174 650a 0a20 2020 2064 6566  rn rate..    def
+000131f0: 205f 6765 745f 7261 7465 5f66 726f 6d5f   _get_rate_from_
+00013200: 6f62 2873 656c 662c 2070 6169 723a 2073  ob(self, pair: s
+00013210: 7472 2c20 7369 6465 3a20 456e 7472 7945  tr, side: EntryE
+00013220: 7869 742c 206f 7264 6572 5f62 6f6f 6b3a  xit, order_book:
+00013230: 204f 7264 6572 426f 6f6b 2c20 6e61 6d65   OrderBook, name
+00013240: 3a20 7374 722c 0a20 2020 2020 2020 2020  : str,.         
+00013250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013260: 2070 7269 6365 5f73 6964 653a 2042 6964   price_side: Bid
+00013270: 4173 6b2c 206f 7264 6572 5f62 6f6f 6b5f  Ask, order_book_
+00013280: 746f 703a 2069 6e74 2920 2d3e 2066 6c6f  top: int) -> flo
+00013290: 6174 3a0a 2020 2020 2020 2020 2222 220a  at:.        """.
+000132a0: 2020 2020 2020 2020 4765 7420 7261 7465          Get rate
+000132b0: 2066 726f 6d20 6f72 6465 7262 6f6f 6b0a   from orderbook.
+000132c0: 2020 2020 2020 2020 3a72 6169 7365 733a          :raises:
+000132d0: 2050 7269 6369 6e67 4572 726f 7220 6966   PricingError if
+000132e0: 2072 6174 6520 636f 756c 6420 6e6f 7420   rate could not 
+000132f0: 6265 2064 6574 6572 6d69 6e65 642e 0a20  be determined.. 
+00013300: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00013310: 2020 206c 6f67 6765 722e 6465 6275 6728     logger.debug(
+00013320: 276f 7264 6572 5f62 6f6f 6b20 2573 272c  'order_book %s',
+00013330: 206f 7264 6572 5f62 6f6f 6b29 0a20 2020   order_book).   
+00013340: 2020 2020 2023 2074 6f70 2031 203d 2069       # top 1 = i
+00013350: 6e64 6578 2030 0a20 2020 2020 2020 2074  ndex 0.        t
+00013360: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00013370: 6f62 7369 6465 3a20 4f42 4c69 7465 7261  obside: OBLitera
+00013380: 6c20 3d20 2762 6964 7327 2069 6620 7072  l = 'bids' if pr
+00013390: 6963 655f 7369 6465 203d 3d20 2762 6964  ice_side == 'bid
+000133a0: 2720 656c 7365 2027 6173 6b73 270a 2020  ' else 'asks'.  
+000133b0: 2020 2020 2020 2020 2020 7261 7465 203d            rate =
+000133c0: 206f 7264 6572 5f62 6f6f 6b5b 6f62 7369   order_book[obsi
+000133d0: 6465 5d5b 6f72 6465 725f 626f 6f6b 5f74  de][order_book_t
+000133e0: 6f70 202d 2031 5d5b 305d 0a20 2020 2020  op - 1][0].     
+000133f0: 2020 2065 7863 6570 7420 2849 6e64 6578     except (Index
+00013400: 4572 726f 722c 204b 6579 4572 726f 7229  Error, KeyError)
+00013410: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
+00013420: 2020 206c 6f67 6765 722e 7761 726e 696e     logger.warnin
+00013430: 6728 0a20 2020 2020 2020 2020 2020 2020  g(.             
+00013440: 2020 2020 2020 2066 227b 7061 6972 7d20         f"{pair} 
+00013450: 2d20 7b6e 616d 657d 2050 7269 6365 2061  - {name} Price a
+00013460: 7420 6c6f 6361 7469 6f6e 207b 6f72 6465  t location {orde
+00013470: 725f 626f 6f6b 5f74 6f70 7d20 6672 6f6d  r_book_top} from
+00013480: 206f 7264 6572 626f 6f6b 2022 0a20 2020   orderbook ".   
+00013490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000134a0: 2066 2263 6f75 6c64 206e 6f74 2062 6520   f"could not be 
+000134b0: 6465 7465 726d 696e 6564 2e20 4f72 6465  determined. Orde
+000134c0: 7262 6f6f 6b3a 207b 6f72 6465 725f 626f  rbook: {order_bo
+000134d0: 6f6b 7d22 0a20 2020 2020 2020 2020 2020  ok}".           
+000134e0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+000134f0: 2020 2072 6169 7365 2050 7269 6369 6e67     raise Pricing
+00013500: 4572 726f 7220 6672 6f6d 2065 0a20 2020  Error from e.   
+00013510: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00013520: 6728 6622 7b70 6169 727d 202d 207b 6e61  g(f"{pair} - {na
+00013530: 6d65 7d20 7072 6963 6520 6672 6f6d 206f  me} price from o
+00013540: 7264 6572 626f 6f6b 207b 7072 6963 655f  rderbook {price_
+00013550: 7369 6465 2e63 6170 6974 616c 697a 6528  side.capitalize(
+00013560: 297d 220a 2020 2020 2020 2020 2020 2020  )}".            
+00013570: 2020 2020 2020 2020 2066 2273 6964 6520           f"side 
+00013580: 2d20 746f 7020 7b6f 7264 6572 5f62 6f6f  - top {order_boo
+00013590: 6b5f 746f 707d 206f 7264 6572 2062 6f6f  k_top} order boo
+000135a0: 6b20 7b73 6964 657d 2072 6174 6520 7b72  k {side} rate {r
+000135b0: 6174 653a 2e38 667d 2229 0a20 2020 2020  ate:.8f}").     
+000135c0: 2020 2072 6574 7572 6e20 7261 7465 0a0a     return rate..
+000135d0: 2020 2020 6465 6620 6765 745f 7261 7465      def get_rate
+000135e0: 7328 7365 6c66 2c20 7061 6972 3a20 7374  s(self, pair: st
+000135f0: 722c 2072 6566 7265 7368 3a20 626f 6f6c  r, refresh: bool
+00013600: 2c20 6973 5f73 686f 7274 3a20 626f 6f6c  , is_short: bool
+00013610: 2920 2d3e 2054 7570 6c65 5b66 6c6f 6174  ) -> Tuple[float
+00013620: 2c20 666c 6f61 745d 3a0a 2020 2020 2020  , float]:.      
+00013630: 2020 656e 7472 795f 7261 7465 203d 204e    entry_rate = N
+00013640: 6f6e 650a 2020 2020 2020 2020 6578 6974  one.        exit
+00013650: 5f72 6174 6520 3d20 4e6f 6e65 0a20 2020  _rate = None.   
+00013660: 2020 2020 2069 6620 6e6f 7420 7265 6672       if not refr
+00013670: 6573 683a 0a20 2020 2020 2020 2020 2020  esh:.           
+00013680: 2077 6974 6820 7365 6c66 2e5f 6361 6368   with self._cach
+00013690: 655f 6c6f 636b 3a0a 2020 2020 2020 2020  e_lock:.        
+000136a0: 2020 2020 2020 2020 656e 7472 795f 7261          entry_ra
+000136b0: 7465 203d 2073 656c 662e 5f65 6e74 7279  te = self._entry
+000136c0: 5f72 6174 655f 6361 6368 652e 6765 7428  _rate_cache.get(
+000136d0: 7061 6972 290a 2020 2020 2020 2020 2020  pair).          
+000136e0: 2020 2020 2020 6578 6974 5f72 6174 6520        exit_rate 
+000136f0: 3d20 7365 6c66 2e5f 6578 6974 5f72 6174  = self._exit_rat
+00013700: 655f 6361 6368 652e 6765 7428 7061 6972  e_cache.get(pair
+00013710: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00013720: 2065 6e74 7279 5f72 6174 653a 0a20 2020   entry_rate:.   
+00013730: 2020 2020 2020 2020 2020 2020 206c 6f67               log
+00013740: 6765 722e 6465 6275 6728 6622 5573 696e  ger.debug(f"Usin
+00013750: 6720 6361 6368 6564 2062 7579 2072 6174  g cached buy rat
+00013760: 6520 666f 7220 7b70 6169 727d 2e22 290a  e for {pair}.").
+00013770: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+00013780: 7869 745f 7261 7465 3a0a 2020 2020 2020  xit_rate:.      
+00013790: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+000137a0: 2e64 6562 7567 2866 2255 7369 6e67 2063  .debug(f"Using c
+000137b0: 6163 6865 6420 7365 6c6c 2072 6174 6520  ached sell rate 
+000137c0: 666f 7220 7b70 6169 727d 2e22 290a 0a20  for {pair}.").. 
+000137d0: 2020 2020 2020 2065 6e74 7279 5f70 7269         entry_pri
+000137e0: 6369 6e67 203d 2073 656c 662e 5f63 6f6e  cing = self._con
+000137f0: 6669 672e 6765 7428 2765 6e74 7279 5f70  fig.get('entry_p
+00013800: 7269 6369 6e67 272c 207b 7d29 0a20 2020  ricing', {}).   
+00013810: 2020 2020 2065 7869 745f 7072 6963 696e       exit_pricin
+00013820: 6720 3d20 7365 6c66 2e5f 636f 6e66 6967  g = self._config
+00013830: 2e67 6574 2827 6578 6974 5f70 7269 6369  .get('exit_prici
+00013840: 6e67 272c 207b 7d29 0a20 2020 2020 2020  ng', {}).       
+00013850: 206f 7264 6572 5f62 6f6f 6b20 3d20 7469   order_book = ti
+00013860: 636b 6572 203d 204e 6f6e 650a 2020 2020  cker = None.    
+00013870: 2020 2020 6966 206e 6f74 2065 6e74 7279      if not entry
+00013880: 5f72 6174 6520 616e 6420 656e 7472 795f  _rate and entry_
+00013890: 7072 6963 696e 672e 6765 7428 2775 7365  pricing.get('use
+000138a0: 5f6f 7264 6572 5f62 6f6f 6b27 2c20 4661  _order_book', Fa
+000138b0: 6c73 6529 3a0a 2020 2020 2020 2020 2020  lse):.          
+000138c0: 2020 6f72 6465 725f 626f 6f6b 5f74 6f70    order_book_top
+000138d0: 203d 206d 6178 2865 6e74 7279 5f70 7269   = max(entry_pri
+000138e0: 6369 6e67 2e67 6574 2827 6f72 6465 725f  cing.get('order_
+000138f0: 626f 6f6b 5f74 6f70 272c 2031 292c 0a20  book_top', 1),. 
+00013900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013920: 6578 6974 5f70 7269 6369 6e67 2e67 6574  exit_pricing.get
+00013930: 2827 6f72 6465 725f 626f 6f6b 5f74 6f70  ('order_book_top
+00013940: 272c 2031 2929 0a20 2020 2020 2020 2020  ', 1)).         
+00013950: 2020 206f 7264 6572 5f62 6f6f 6b20 3d20     order_book = 
+00013960: 7365 6c66 2e66 6574 6368 5f6c 325f 6f72  self.fetch_l2_or
+00013970: 6465 725f 626f 6f6b 2870 6169 722c 206f  der_book(pair, o
+00013980: 7264 6572 5f62 6f6f 6b5f 746f 7029 0a20  rder_book_top). 
+00013990: 2020 2020 2020 2020 2020 2065 6e74 7279             entry
+000139a0: 5f72 6174 6520 3d20 7365 6c66 2e67 6574  _rate = self.get
+000139b0: 5f72 6174 6528 7061 6972 2c20 7265 6672  _rate(pair, refr
+000139c0: 6573 682c 2027 656e 7472 7927 2c20 6973  esh, 'entry', is
+000139d0: 5f73 686f 7274 2c20 6f72 6465 725f 626f  _short, order_bo
+000139e0: 6f6b 3d6f 7264 6572 5f62 6f6f 6b29 0a20  ok=order_book). 
+000139f0: 2020 2020 2020 2065 6c69 6620 6e6f 7420         elif not 
+00013a00: 656e 7472 795f 7261 7465 3a0a 2020 2020  entry_rate:.    
+00013a10: 2020 2020 2020 2020 7469 636b 6572 203d          ticker =
+00013a20: 2073 656c 662e 6665 7463 685f 7469 636b   self.fetch_tick
+00013a30: 6572 2870 6169 7229 0a20 2020 2020 2020  er(pair).       
+00013a40: 2020 2020 2065 6e74 7279 5f72 6174 6520       entry_rate 
+00013a50: 3d20 7365 6c66 2e67 6574 5f72 6174 6528  = self.get_rate(
+00013a60: 7061 6972 2c20 7265 6672 6573 682c 2027  pair, refresh, '
+00013a70: 656e 7472 7927 2c20 6973 5f73 686f 7274  entry', is_short
+00013a80: 2c20 7469 636b 6572 3d74 6963 6b65 7229  , ticker=ticker)
+00013a90: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00013aa0: 6578 6974 5f72 6174 653a 0a20 2020 2020  exit_rate:.     
+00013ab0: 2020 2020 2020 2065 7869 745f 7261 7465         exit_rate
+00013ac0: 203d 2073 656c 662e 6765 745f 7261 7465   = self.get_rate
+00013ad0: 2870 6169 722c 2072 6566 7265 7368 2c20  (pair, refresh, 
+00013ae0: 2765 7869 7427 2c0a 2020 2020 2020 2020  'exit',.        
+00013af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013b00: 2020 2020 2020 2020 2020 2020 2020 6973                is
+00013b10: 5f73 686f 7274 2c20 6f72 6465 725f 626f  _short, order_bo
+00013b20: 6f6b 3d6f 7264 6572 5f62 6f6f 6b2c 2074  ok=order_book, t
+00013b30: 6963 6b65 723d 7469 636b 6572 290a 2020  icker=ticker).  
+00013b40: 2020 2020 2020 7265 7475 726e 2065 6e74        return ent
+00013b50: 7279 5f72 6174 652c 2065 7869 745f 7261  ry_rate, exit_ra
+00013b60: 7465 0a0a 2020 2020 2320 4665 6520 6861  te..    # Fee ha
+00013b70: 6e64 6c69 6e67 0a0a 2020 2020 4072 6574  ndling..    @ret
+00013b80: 7269 6572 0a20 2020 2064 6566 2067 6574  rier.    def get
+00013b90: 5f74 7261 6465 735f 666f 725f 6f72 6465  _trades_for_orde
+00013ba0: 7228 7365 6c66 2c20 6f72 6465 725f 6964  r(self, order_id
+00013bb0: 3a20 7374 722c 2070 6169 723a 2073 7472  : str, pair: str
+00013bc0: 2c20 7369 6e63 653a 2064 6174 6574 696d  , since: datetim
+00013bd0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00013be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013bf0: 7061 7261 6d73 3a20 4f70 7469 6f6e 616c  params: Optional
+00013c00: 5b44 6963 745d 203d 204e 6f6e 6529 202d  [Dict] = None) -
+00013c10: 3e20 4c69 7374 3a0a 2020 2020 2020 2020  > List:.        
+00013c20: 2222 220a 2020 2020 2020 2020 4665 7463  """.        Fetc
+00013c30: 6820 4f72 6465 7273 2075 7369 6e67 2074  h Orders using t
+00013c40: 6865 2022 6665 7463 685f 6d79 5f74 7261  he "fetch_my_tra
+00013c50: 6465 7322 2065 6e64 706f 696e 7420 616e  des" endpoint an
+00013c60: 6420 6669 6c74 6572 2074 6865 6d20 6279  d filter them by
+00013c70: 206f 7264 6572 2d69 642e 0a20 2020 2020   order-id..     
+00013c80: 2020 2054 6865 2022 7369 6e63 6522 2061     The "since" a
+00013c90: 7267 756d 656e 7420 7061 7373 6564 2069  rgument passed i
+00013ca0: 6e20 6973 2063 6f6d 696e 6720 6672 6f6d  n is coming from
+00013cb0: 2074 6865 2064 6174 6162 6173 6520 616e   the database an
+00013cc0: 6420 6973 2069 6e20 5554 432c 0a20 2020  d is in UTC,.   
+00013cd0: 2020 2020 2061 7320 7469 6d65 7a6f 6e65       as timezone
+00013ce0: 2d6e 6174 6976 6520 6461 7465 7469 6d65  -native datetime
+00013cf0: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
+00013d00: 2046 726f 6d20 7468 6520 7079 7468 6f6e   From the python
+00013d10: 2064 6f63 756d 656e 7461 7469 6f6e 3a0a   documentation:.
+00013d20: 2020 2020 2020 2020 2020 2020 3e20 4e61              > Na
+00013d30: 6976 6520 6461 7465 7469 6d65 2069 6e73  ive datetime ins
+00013d40: 7461 6e63 6573 2061 7265 2061 7373 756d  tances are assum
+00013d50: 6564 2074 6f20 7265 7072 6573 656e 7420  ed to represent 
+00013d60: 6c6f 6361 6c20 7469 6d65 0a20 2020 2020  local time.     
+00013d70: 2020 2054 6865 7265 666f 7265 2c20 6361     Therefore, ca
+00013d80: 6c6c 696e 6720 2273 696e 6365 2e74 696d  lling "since.tim
+00013d90: 6573 7461 6d70 2829 2220 7769 6c6c 2067  estamp()" will g
+00013da0: 6574 2074 6865 2055 5443 2074 696d 6573  et the UTC times
+00013db0: 7461 6d70 2c20 6166 7465 7220 6170 706c  tamp, after appl
+00013dc0: 7969 6e67 2074 6865 0a20 2020 2020 2020  ying the.       
+00013dd0: 2074 7261 6e73 666f 726d 6174 696f 6e20   transformation 
+00013de0: 6672 6f6d 206c 6f63 616c 2074 696d 657a  from local timez
+00013df0: 6f6e 6520 746f 2055 5443 2e0a 2020 2020  one to UTC..    
+00013e00: 2020 2020 5468 6973 2077 6f72 6b73 2066      This works f
+00013e10: 6f72 2074 696d 657a 6f6e 6573 2055 5443  or timezones UTC
+00013e20: 2b20 7369 6e63 6520 7468 656e 2074 6865  + since then the
+00013e30: 2072 6573 756c 7420 7769 6c6c 2063 6f6e   result will con
+00013e40: 7461 696e 2074 7261 6465 7320 6672 6f6d  tain trades from
+00013e50: 2061 2066 6577 2068 6f75 7273 0a20 2020   a few hours.   
+00013e60: 2020 2020 2069 6e73 7465 6164 206f 6620       instead of 
+00013e70: 6672 6f6d 2074 6865 206c 6173 7420 3520  from the last 5 
+00013e80: 7365 636f 6e64 732c 2068 6f77 6576 6572  seconds, however
+00013e90: 2066 6169 6c73 2066 6f72 2055 5443 2d20   fails for UTC- 
+00013ea0: 7469 6d65 7a6f 6e65 732c 0a20 2020 2020  timezones,.     
+00013eb0: 2020 2073 696e 6365 2077 6527 7265 2074     since we're t
+00013ec0: 6865 6e20 6173 6b69 6e67 2066 6f72 2074  hen asking for t
+00013ed0: 7261 6465 7320 7769 7468 2061 2022 7369  rades with a "si
+00013ee0: 6e63 6522 2061 7267 756d 656e 7420 696e  nce" argument in
+00013ef0: 2074 6865 2066 7574 7572 652e 0a0a 2020   the future...  
+00013f00: 2020 2020 2020 3a70 6172 616d 206f 7264        :param ord
+00013f10: 6572 5f69 6420 6f72 6465 725f 6964 3a20  er_id order_id: 
+00013f20: 4f72 6465 722d 6964 2061 7320 6769 7665  Order-id as give
+00013f30: 6e20 7768 656e 2063 7265 6174 696e 6720  n when creating 
+00013f40: 7468 6520 6f72 6465 720a 2020 2020 2020  the order.      
+00013f50: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
+00013f60: 6169 7220 7468 6520 6f72 6465 7220 6973  air the order is
+00013f70: 2066 6f72 0a20 2020 2020 2020 203a 7061   for.        :pa
+00013f80: 7261 6d20 7369 6e63 653a 2064 6174 6574  ram since: datet
+00013f90: 696d 6520 6f62 6a65 6374 206f 6620 7468  ime object of th
+00013fa0: 6520 6f72 6465 7220 6372 6561 7469 6f6e  e order creation
+00013fb0: 2074 696d 652e 2041 7373 756d 6573 206f   time. Assumes o
+00013fc0: 626a 6563 7420 6973 2069 6e20 5554 432e  bject is in UTC.
+00013fd0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00013fe0: 2020 2020 2069 6620 7365 6c66 2e5f 636f       if self._co
+00013ff0: 6e66 6967 5b27 6472 795f 7275 6e27 5d3a  nfig['dry_run']:
+00014000: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014010: 7572 6e20 5b5d 0a20 2020 2020 2020 2069  urn [].        i
+00014020: 6620 6e6f 7420 7365 6c66 2e65 7863 6861  f not self.excha
+00014030: 6e67 655f 6861 7328 2766 6574 6368 4d79  nge_has('fetchMy
+00014040: 5472 6164 6573 2729 3a0a 2020 2020 2020  Trades'):.      
+00014050: 2020 2020 2020 7265 7475 726e 205b 5d0a        return [].
+00014060: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00014070: 2020 2020 2020 2020 2023 2041 6c6c 6f77           # Allow
+00014080: 2035 7320 6f66 6673 6574 2074 6f20 6361   5s offset to ca
+00014090: 7463 6820 736c 6967 6874 2074 696d 6520  tch slight time 
+000140a0: 6f66 6673 6574 7320 2864 6973 636f 7665  offsets (discove
+000140b0: 7265 6420 696e 2023 3131 3835 290a 2020  red in #1185).  
+000140c0: 2020 2020 2020 2020 2020 2320 7369 6e63            # sinc
+000140d0: 6520 6e65 6564 7320 746f 2062 6520 696e  e needs to be in
+000140e0: 7420 696e 206d 696c 6c69 7365 636f 6e64  t in millisecond
+000140f0: 730a 2020 2020 2020 2020 2020 2020 5f70  s.            _p
+00014100: 6172 616d 7320 3d20 7061 7261 6d73 2069  arams = params i
+00014110: 6620 7061 7261 6d73 2065 6c73 6520 7b7d  f params else {}
+00014120: 0a20 2020 2020 2020 2020 2020 206d 795f  .            my_
+00014130: 7472 6164 6573 203d 2073 656c 662e 5f61  trades = self._a
+00014140: 7069 2e66 6574 6368 5f6d 795f 7472 6164  pi.fetch_my_trad
+00014150: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00014160: 2020 2020 7061 6972 2c20 696e 7428 2873      pair, int((s
+00014170: 696e 6365 2e72 6570 6c61 6365 2874 7a69  ince.replace(tzi
+00014180: 6e66 6f3d 7469 6d65 7a6f 6e65 2e75 7463  nfo=timezone.utc
+00014190: 292e 7469 6d65 7374 616d 7028 2920 2d20  ).timestamp() - 
+000141a0: 3529 202a 2031 3030 3029 2c0a 2020 2020  5) * 1000),.    
+000141b0: 2020 2020 2020 2020 2020 2020 7061 7261              para
+000141c0: 6d73 3d5f 7061 7261 6d73 290a 2020 2020  ms=_params).    
+000141d0: 2020 2020 2020 2020 6d61 7463 6865 645f          matched_
+000141e0: 7472 6164 6573 203d 205b 7472 6164 6520  trades = [trade 
+000141f0: 666f 7220 7472 6164 6520 696e 206d 795f  for trade in my_
+00014200: 7472 6164 6573 2069 6620 7472 6164 655b  trades if trade[
+00014210: 276f 7264 6572 275d 203d 3d20 6f72 6465  'order'] == orde
+00014220: 725f 6964 5d0a 0a20 2020 2020 2020 2020  r_id]..         
+00014230: 2020 2073 656c 662e 5f6c 6f67 5f65 7863     self._log_exc
+00014240: 6861 6e67 655f 7265 7370 6f6e 7365 2827  hange_response('
+00014250: 6765 745f 7472 6164 6573 5f66 6f72 5f6f  get_trades_for_o
+00014260: 7264 6572 272c 206d 6174 6368 6564 5f74  rder', matched_t
+00014270: 7261 6465 7329 0a0a 2020 2020 2020 2020  rades)..        
+00014280: 2020 2020 6d61 7463 6865 645f 7472 6164      matched_trad
+00014290: 6573 203d 2073 656c 662e 5f74 7261 6465  es = self._trade
+000142a0: 735f 636f 6e74 7261 6374 735f 746f 5f61  s_contracts_to_a
+000142b0: 6d6f 756e 7428 6d61 7463 6865 645f 7472  mount(matched_tr
+000142c0: 6164 6573 290a 0a20 2020 2020 2020 2020  ades)..         
+000142d0: 2020 2072 6574 7572 6e20 6d61 7463 6865     return matche
+000142e0: 645f 7472 6164 6573 0a20 2020 2020 2020  d_trades.       
+000142f0: 2065 7863 6570 7420 6363 7874 2e44 446f   except ccxt.DDo
+00014300: 5350 726f 7465 6374 696f 6e20 6173 2065  SProtection as e
+00014310: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+00014320: 6973 6520 4444 6f73 5072 6f74 6563 7469  ise DDosProtecti
+00014330: 6f6e 2865 2920 6672 6f6d 2065 0a20 2020  on(e) from e.   
+00014340: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
+00014350: 742e 4f70 6572 6174 696f 6e46 6169 6c65  t.OperationFaile
+00014360: 642c 2063 6378 742e 4578 6368 616e 6765  d, ccxt.Exchange
+00014370: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
+00014380: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+00014390: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
+000143a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000143b0: 2743 6f75 6c64 206e 6f74 2067 6574 2074  'Could not get t
+000143c0: 7261 6465 7320 6475 6520 746f 207b 652e  rades due to {e.
+000143d0: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+000143e0: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
+000143f0: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
+00014400: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
+00014410: 6173 6545 7272 6f72 2061 7320 653a 0a20  aseError as e:. 
+00014420: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00014430: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
+00014440: 7074 696f 6e28 6529 2066 726f 6d20 650a  ption(e) from e.
+00014450: 0a20 2020 2064 6566 2067 6574 5f6f 7264  .    def get_ord
+00014460: 6572 5f69 645f 636f 6e64 6974 696f 6e61  er_id_conditiona
+00014470: 6c28 7365 6c66 2c20 6f72 6465 723a 2044  l(self, order: D
+00014480: 6963 745b 7374 722c 2041 6e79 5d29 202d  ict[str, Any]) -
+00014490: 3e20 7374 723a 0a20 2020 2020 2020 2072  > str:.        r
+000144a0: 6574 7572 6e20 6f72 6465 725b 2769 6427  eturn order['id'
+000144b0: 5d0a 0a20 2020 2040 7265 7472 6965 720a  ]..    @retrier.
+000144c0: 2020 2020 6465 6620 6765 745f 6665 6528      def get_fee(
+000144d0: 7365 6c66 2c20 7379 6d62 6f6c 3a20 7374  self, symbol: st
+000144e0: 722c 2074 7970 653a 2073 7472 203d 2027  r, type: str = '
+000144f0: 272c 2073 6964 653a 2073 7472 203d 2027  ', side: str = '
+00014500: 272c 2061 6d6f 756e 743a 2066 6c6f 6174  ', amount: float
+00014510: 203d 2031 2c0a 2020 2020 2020 2020 2020   = 1,.          
+00014520: 2020 2020 2020 7072 6963 653a 2066 6c6f        price: flo
+00014530: 6174 203d 2031 2c20 7461 6b65 725f 6f72  at = 1, taker_or
+00014540: 5f6d 616b 6572 3a20 4d61 6b65 7254 616b  _maker: MakerTak
+00014550: 6572 203d 2027 6d61 6b65 7227 2920 2d3e  er = 'maker') ->
+00014560: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
+00014570: 2222 220a 2020 2020 2020 2020 5265 7472  """.        Retr
+00014580: 6965 7665 2066 6565 2066 726f 6d20 6578  ieve fee from ex
+00014590: 6368 616e 6765 0a20 2020 2020 2020 203a  change.        :
+000145a0: 7061 7261 6d20 7379 6d62 6f6c 3a20 5061  param symbol: Pa
+000145b0: 6972 0a20 2020 2020 2020 203a 7061 7261  ir.        :para
+000145c0: 6d20 7479 7065 3a20 5479 7065 206f 6620  m type: Type of 
+000145d0: 6f72 6465 7220 286d 6172 6b65 742c 206c  order (market, l
+000145e0: 696d 6974 2c20 2e2e 2e29 0a20 2020 2020  imit, ...).     
+000145f0: 2020 203a 7061 7261 6d20 7369 6465 3a20     :param side: 
+00014600: 5369 6465 206f 6620 6f72 6465 7220 2862  Side of order (b
+00014610: 7579 2c20 7365 6c6c 290a 2020 2020 2020  uy, sell).      
+00014620: 2020 3a70 6172 616d 2061 6d6f 756e 743a    :param amount:
+00014630: 2041 6d6f 756e 7420 6f66 206f 7264 6572   Amount of order
+00014640: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00014650: 7072 6963 653a 2050 7269 6365 206f 6620  price: Price of 
+00014660: 6f72 6465 720a 2020 2020 2020 2020 3a70  order.        :p
+00014670: 6172 616d 2074 616b 6572 5f6f 725f 6d61  aram taker_or_ma
+00014680: 6b65 723a 2027 6d61 6b65 7227 206f 7220  ker: 'maker' or 
+00014690: 2774 616b 6572 2720 2869 676e 6f72 6564  'taker' (ignored
+000146a0: 2069 6620 2274 7970 6522 2069 7320 7072   if "type" is pr
+000146b0: 6f76 6964 6564 290a 2020 2020 2020 2020  ovided).        
+000146c0: 2222 220a 2020 2020 2020 2020 6966 2074  """.        if t
+000146d0: 7970 6520 616e 6420 7479 7065 203d 3d20  ype and type == 
+000146e0: 276d 6172 6b65 7427 3a0a 2020 2020 2020  'market':.      
+000146f0: 2020 2020 2020 7461 6b65 725f 6f72 5f6d        taker_or_m
+00014700: 616b 6572 203d 2027 7461 6b65 7227 0a20  aker = 'taker'. 
+00014710: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00014720: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00014730: 5f63 6f6e 6669 675b 2764 7279 5f72 756e  _config['dry_run
+00014740: 275d 2061 6e64 2073 656c 662e 5f63 6f6e  '] and self._con
+00014750: 6669 672e 6765 7428 2766 6565 272c 204e  fig.get('fee', N
+00014760: 6f6e 6529 2069 7320 6e6f 7420 4e6f 6e65  one) is not None
+00014770: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00014780: 2020 7265 7475 726e 2073 656c 662e 5f63    return self._c
+00014790: 6f6e 6669 675b 2766 6565 275d 0a20 2020  onfig['fee'].   
+000147a0: 2020 2020 2020 2020 2023 2076 616c 6964           # valid
+000147b0: 6174 6520 7468 6174 206d 6172 6b65 7473  ate that markets
+000147c0: 2061 7265 206c 6f61 6465 6420 6265 666f   are loaded befo
+000147d0: 7265 2074 7279 696e 6720 746f 2067 6574  re trying to get
+000147e0: 2066 6565 0a20 2020 2020 2020 2020 2020   fee.           
+000147f0: 2069 6620 7365 6c66 2e5f 6170 692e 6d61   if self._api.ma
+00014800: 726b 6574 7320 6973 204e 6f6e 6520 6f72  rkets is None or
+00014810: 206c 656e 2873 656c 662e 5f61 7069 2e6d   len(self._api.m
+00014820: 6172 6b65 7473 2920 3d3d 2030 3a0a 2020  arkets) == 0:.  
+00014830: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00014840: 6c66 2e5f 6170 692e 6c6f 6164 5f6d 6172  lf._api.load_mar
+00014850: 6b65 7473 2870 6172 616d 733d 7b7d 290a  kets(params={}).
+00014860: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014870: 7572 6e20 7365 6c66 2e5f 6170 692e 6361  urn self._api.ca
+00014880: 6c63 756c 6174 655f 6665 6528 7379 6d62  lculate_fee(symb
+00014890: 6f6c 3d73 796d 626f 6c2c 2074 7970 653d  ol=symbol, type=
+000148a0: 7479 7065 2c20 7369 6465 3d73 6964 652c  type, side=side,
+000148b0: 2061 6d6f 756e 743d 616d 6f75 6e74 2c0a   amount=amount,.
+000148c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148e0: 2020 2020 2020 2020 2020 2070 7269 6365             price
+000148f0: 3d70 7269 6365 2c20 7461 6b65 724f 724d  =price, takerOrM
+00014900: 616b 6572 3d74 616b 6572 5f6f 725f 6d61  aker=taker_or_ma
+00014910: 6b65 7229 5b27 7261 7465 275d 0a20 2020  ker)['rate'].   
+00014920: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+00014930: 2e44 446f 5350 726f 7465 6374 696f 6e20  .DDoSProtection 
+00014940: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00014950: 2020 7261 6973 6520 4444 6f73 5072 6f74    raise DDosProt
+00014960: 6563 7469 6f6e 2865 2920 6672 6f6d 2065  ection(e) from e
+00014970: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00014980: 2863 6378 742e 4f70 6572 6174 696f 6e46  (ccxt.OperationF
+00014990: 6169 6c65 642c 2063 6378 742e 4578 6368  ailed, ccxt.Exch
+000149a0: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
+000149b0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000149c0: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
+000149d0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+000149e0: 2020 2066 2743 6f75 6c64 206e 6f74 2067     f'Could not g
+000149f0: 6574 2066 6565 2069 6e66 6f20 6475 6520  et fee info due 
+00014a00: 746f 207b 652e 5f5f 636c 6173 735f 5f2e  to {e.__class__.
+00014a10: 5f5f 6e61 6d65 5f5f 7d2e 204d 6573 7361  __name__}. Messa
+00014a20: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
+00014a30: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+00014a40: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
+00014a50: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+00014a60: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+00014a70: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
+00014a80: 726f 6d20 650a 0a20 2020 2040 7374 6174  rom e..    @stat
+00014a90: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+00014aa0: 206f 7264 6572 5f68 6173 5f66 6565 286f   order_has_fee(o
+00014ab0: 7264 6572 3a20 4469 6374 2920 2d3e 2062  rder: Dict) -> b
+00014ac0: 6f6f 6c3a 0a20 2020 2020 2020 2022 2222  ool:.        """
+00014ad0: 0a20 2020 2020 2020 2056 6572 6966 6965  .        Verifie
+00014ae0: 7320 6966 2074 6865 2070 6173 7365 6420  s if the passed 
+00014af0: 696e 206f 7264 6572 2064 6963 7420 6861  in order dict ha
+00014b00: 7320 7468 6520 6e65 6564 6564 206b 6579  s the needed key
+00014b10: 7320 746f 2065 7874 7261 6374 2066 6565  s to extract fee
+00014b20: 732c 0a20 2020 2020 2020 2061 6e64 2074  s,.        and t
+00014b30: 6861 7420 7468 6573 6520 6b65 7973 2028  hat these keys (
+00014b40: 6375 7272 656e 6379 2c20 636f 7374 2920  currency, cost) 
+00014b50: 6172 6520 6e6f 7420 656d 7074 792e 0a20  are not empty.. 
+00014b60: 2020 2020 2020 203a 7061 7261 6d20 6f72         :param or
+00014b70: 6465 723a 204f 7264 6572 206f 7220 7472  der: Order or tr
+00014b80: 6164 6520 286f 6e65 2074 7261 6465 2920  ade (one trade) 
+00014b90: 6469 6374 0a20 2020 2020 2020 203a 7265  dict.        :re
+00014ba0: 7475 726e 3a20 5472 7565 2069 6620 7468  turn: True if th
+00014bb0: 6520 6665 6520 7375 6273 7472 7563 7475  e fee substructu
+00014bc0: 7265 2063 6f6e 7461 696e 7320 6375 7272  re contains curr
+00014bd0: 656e 6379 2061 6e64 2063 6f73 742c 2066  ency and cost, f
+00014be0: 616c 7365 206f 7468 6572 7769 7365 0a20  alse otherwise. 
+00014bf0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00014c00: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
+00014c10: 616e 6365 286f 7264 6572 2c20 6469 6374  ance(order, dict
+00014c20: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00014c30: 6574 7572 6e20 4661 6c73 650a 2020 2020  eturn False.    
+00014c40: 2020 2020 7265 7475 726e 2028 2766 6565      return ('fee
+00014c50: 2720 696e 206f 7264 6572 2061 6e64 206f  ' in order and o
+00014c60: 7264 6572 5b27 6665 6527 5d20 6973 206e  rder['fee'] is n
+00014c70: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+00014c80: 2020 2020 2020 2020 616e 6420 286f 7264          and (ord
+00014c90: 6572 5b27 6665 6527 5d2e 6b65 7973 2829  er['fee'].keys()
+00014ca0: 203e 3d20 7b27 6375 7272 656e 6379 272c   >= {'currency',
+00014cb0: 2027 636f 7374 277d 290a 2020 2020 2020   'cost'}).      
+00014cc0: 2020 2020 2020 2020 2020 616e 6420 6f72            and or
+00014cd0: 6465 725b 2766 6565 275d 5b27 6375 7272  der['fee']['curr
+00014ce0: 656e 6379 275d 2069 7320 6e6f 7420 4e6f  ency'] is not No
+00014cf0: 6e65 0a20 2020 2020 2020 2020 2020 2020  ne.             
+00014d00: 2020 2061 6e64 206f 7264 6572 5b27 6665     and order['fe
+00014d10: 6527 5d5b 2763 6f73 7427 5d20 6973 206e  e']['cost'] is n
+00014d20: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
+00014d30: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00014d40: 6566 2063 616c 6375 6c61 7465 5f66 6565  ef calculate_fee
+00014d50: 5f72 6174 6528 0a20 2020 2020 2020 2020  _rate(.         
+00014d60: 2020 2073 656c 662c 2066 6565 3a20 4469     self, fee: Di
+00014d70: 6374 2c20 7379 6d62 6f6c 3a20 7374 722c  ct, symbol: str,
+00014d80: 2063 6f73 743a 2066 6c6f 6174 2c20 616d   cost: float, am
+00014d90: 6f75 6e74 3a20 666c 6f61 7429 202d 3e20  ount: float) -> 
+00014da0: 4f70 7469 6f6e 616c 5b66 6c6f 6174 5d3a  Optional[float]:
+00014db0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00014dc0: 2020 2020 2043 616c 6375 6c61 7465 2066       Calculate f
+00014dd0: 6565 2072 6174 6520 6966 2069 7427 7320  ee rate if it's 
+00014de0: 6e6f 7420 6769 7665 6e20 6279 2074 6865  not given by the
+00014df0: 2065 7863 6861 6e67 652e 0a20 2020 2020   exchange..     
+00014e00: 2020 203a 7061 7261 6d20 6665 653a 2063     :param fee: c
+00014e10: 6378 7420 4665 6520 6469 6374 202d 206d  cxt Fee dict - m
+00014e20: 7573 7420 636f 6e74 6169 6e20 636f 7374  ust contain cost
+00014e30: 202f 2063 7572 7265 6e63 7920 2f20 7261   / currency / ra
+00014e40: 7465 0a20 2020 2020 2020 203a 7061 7261  te.        :para
+00014e50: 6d20 7379 6d62 6f6c 3a20 5379 6d62 6f6c  m symbol: Symbol
+00014e60: 206f 6620 7468 6520 6f72 6465 720a 2020   of the order.  
+00014e70: 2020 2020 2020 3a70 6172 616d 2063 6f73        :param cos
+00014e80: 743a 2054 6f74 616c 2063 6f73 7420 6f66  t: Total cost of
+00014e90: 2074 6865 206f 7264 6572 0a20 2020 2020   the order.     
+00014ea0: 2020 203a 7061 7261 6d20 616d 6f75 6e74     :param amount
+00014eb0: 3a20 416d 6f75 6e74 206f 6620 7468 6520  : Amount of the 
+00014ec0: 6f72 6465 720a 2020 2020 2020 2020 2222  order.        ""
+00014ed0: 220a 2020 2020 2020 2020 6966 2066 6565  ".        if fee
+00014ee0: 2e67 6574 2827 7261 7465 2729 2069 7320  .get('rate') is 
+00014ef0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+00014f00: 2020 2020 2020 7265 7475 726e 2066 6565        return fee
+00014f10: 2e67 6574 2827 7261 7465 2729 0a20 2020  .get('rate').   
+00014f20: 2020 2020 2066 6565 5f63 7572 7220 3d20       fee_curr = 
+00014f30: 6665 652e 6765 7428 2763 7572 7265 6e63  fee.get('currenc
+00014f40: 7927 290a 2020 2020 2020 2020 6966 2066  y').        if f
+00014f50: 6565 5f63 7572 7220 6973 204e 6f6e 653a  ee_curr is None:
+00014f60: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00014f70: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+00014f80: 2066 6565 5f63 6f73 7420 3d20 666c 6f61   fee_cost = floa
+00014f90: 7428 6665 655b 2763 6f73 7427 5d29 0a0a  t(fee['cost'])..
+00014fa0: 2020 2020 2020 2020 2320 4361 6c63 756c          # Calcul
+00014fb0: 6174 6520 6665 6520 6261 7365 6420 6f6e  ate fee based on
+00014fc0: 206f 7264 6572 2064 6574 6169 6c73 0a20   order details. 
+00014fd0: 2020 2020 2020 2069 6620 6665 655f 6375         if fee_cu
+00014fe0: 7272 203d 3d20 7365 6c66 2e67 6574 5f70  rr == self.get_p
+00014ff0: 6169 725f 6261 7365 5f63 7572 7265 6e63  air_base_currenc
+00015000: 7928 7379 6d62 6f6c 293a 0a20 2020 2020  y(symbol):.     
+00015010: 2020 2020 2020 2023 2042 6173 6520 6375         # Base cu
+00015020: 7272 656e 6379 202d 2064 6976 6964 6520  rrency - divide 
+00015030: 6279 2061 6d6f 756e 740a 2020 2020 2020  by amount.      
+00015040: 2020 2020 2020 7265 7475 726e 2072 6f75        return rou
+00015050: 6e64 2866 6565 5f63 6f73 7420 2f20 616d  nd(fee_cost / am
+00015060: 6f75 6e74 2c20 3829 0a20 2020 2020 2020  ount, 8).       
+00015070: 2065 6c69 6620 6665 655f 6375 7272 203d   elif fee_curr =
+00015080: 3d20 7365 6c66 2e67 6574 5f70 6169 725f  = self.get_pair_
+00015090: 7175 6f74 655f 6375 7272 656e 6379 2873  quote_currency(s
+000150a0: 796d 626f 6c29 3a0a 2020 2020 2020 2020  ymbol):.        
+000150b0: 2020 2020 2320 5175 6f74 6520 6375 7272      # Quote curr
+000150c0: 656e 6379 202d 2064 6976 6964 6520 6279  ency - divide by
+000150d0: 2063 6f73 740a 2020 2020 2020 2020 2020   cost.          
+000150e0: 2020 7265 7475 726e 2072 6f75 6e64 2866    return round(f
+000150f0: 6565 5f63 6f73 7420 2f20 636f 7374 2c20  ee_cost / cost, 
+00015100: 3829 2069 6620 636f 7374 2065 6c73 6520  8) if cost else 
+00015110: 4e6f 6e65 0a20 2020 2020 2020 2065 6c73  None.        els
+00015120: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
+00015130: 2049 6620 4665 6520 6375 7272 656e 6379   If Fee currency
+00015140: 2069 7320 6120 6469 6666 6572 656e 7420   is a different 
+00015150: 6375 7272 656e 6379 0a20 2020 2020 2020  currency.       
+00015160: 2020 2020 2069 6620 6e6f 7420 636f 7374       if not cost
+00015170: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00015180: 2020 2320 4966 2063 6f73 7420 6973 204e    # If cost is N
+00015190: 6f6e 6520 6f72 2030 2e30 202d 3e20 6661  one or 0.0 -> fa
+000151a0: 6c73 792c 2072 6574 7572 6e20 4e6f 6e65  lsy, return None
+000151b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000151c0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+000151d0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+000151e0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000151f0: 6d62 203d 2073 656c 662e 6765 745f 7661  mb = self.get_va
+00015200: 6c69 645f 7061 6972 5f63 6f6d 6269 6e61  lid_pair_combina
+00015210: 7469 6f6e 2866 6565 5f63 7572 722c 2073  tion(fee_curr, s
+00015220: 656c 662e 5f63 6f6e 6669 675b 2773 7461  elf._config['sta
+00015230: 6b65 5f63 7572 7265 6e63 7927 5d29 0a20  ke_currency']). 
+00015240: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00015250: 6963 6b20 3d20 7365 6c66 2e66 6574 6368  ick = self.fetch
+00015260: 5f74 6963 6b65 7228 636f 6d62 290a 0a20  _ticker(comb).. 
+00015270: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00015280: 6565 5f74 6f5f 7175 6f74 655f 7261 7465  ee_to_quote_rate
+00015290: 203d 2073 6166 655f 7661 6c75 655f 6661   = safe_value_fa
+000152a0: 6c6c 6261 636b 3228 7469 636b 2c20 7469  llback2(tick, ti
+000152b0: 636b 2c20 276c 6173 7427 2c20 2761 736b  ck, 'last', 'ask
+000152c0: 2729 0a20 2020 2020 2020 2020 2020 2065  ').            e
+000152d0: 7863 6570 7420 2856 616c 7565 4572 726f  xcept (ValueErro
+000152e0: 722c 2045 7863 6861 6e67 6545 7272 6f72  r, ExchangeError
+000152f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00015300: 2020 2066 6565 5f74 6f5f 7175 6f74 655f     fee_to_quote_
+00015310: 7261 7465 203d 2073 656c 662e 5f63 6f6e  rate = self._con
+00015320: 6669 675b 2765 7863 6861 6e67 6527 5d2e  fig['exchange'].
+00015330: 6765 7428 2775 6e6b 6e6f 776e 5f66 6565  get('unknown_fee
+00015340: 5f72 6174 6527 2c20 4e6f 6e65 290a 2020  _rate', None).  
+00015350: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00015360: 206e 6f74 2066 6565 5f74 6f5f 7175 6f74   not fee_to_quot
+00015370: 655f 7261 7465 3a0a 2020 2020 2020 2020  e_rate:.        
+00015380: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00015390: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
+000153a0: 2020 2020 7265 7475 726e 2072 6f75 6e64      return round
+000153b0: 2828 6665 655f 636f 7374 202a 2066 6565  ((fee_cost * fee
+000153c0: 5f74 6f5f 7175 6f74 655f 7261 7465 2920  _to_quote_rate) 
+000153d0: 2f20 636f 7374 2c20 3829 0a0a 2020 2020  / cost, 8)..    
+000153e0: 6465 6620 6578 7472 6163 745f 636f 7374  def extract_cost
+000153f0: 5f63 7572 725f 7261 7465 2873 656c 662c  _curr_rate(self,
+00015400: 2066 6565 3a20 4469 6374 2c20 7379 6d62   fee: Dict, symb
+00015410: 6f6c 3a20 7374 722c 2063 6f73 743a 2066  ol: str, cost: f
+00015420: 6c6f 6174 2c0a 2020 2020 2020 2020 2020  loat,.          
+00015430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015440: 2020 2020 2061 6d6f 756e 743a 2066 6c6f       amount: flo
+00015450: 6174 2920 2d3e 2054 7570 6c65 5b66 6c6f  at) -> Tuple[flo
+00015460: 6174 2c20 7374 722c 204f 7074 696f 6e61  at, str, Optiona
+00015470: 6c5b 666c 6f61 745d 5d3a 0a20 2020 2020  l[float]]:.     
+00015480: 2020 2022 2222 0a20 2020 2020 2020 2045     """.        E
+00015490: 7874 7261 6374 2074 7570 6c65 206f 6620  xtract tuple of 
+000154a0: 636f 7374 2c20 6375 7272 656e 6379 2c20  cost, currency, 
+000154b0: 7261 7465 2e0a 2020 2020 2020 2020 5265  rate..        Re
+000154c0: 7175 6972 6573 206f 7264 6572 5f68 6173  quires order_has
+000154d0: 5f66 6565 2074 6f20 7275 6e20 6669 7273  _fee to run firs
+000154e0: 7421 0a20 2020 2020 2020 203a 7061 7261  t!.        :para
+000154f0: 6d20 6665 653a 2063 6378 7420 4665 6520  m fee: ccxt Fee 
+00015500: 6469 6374 202d 206d 7573 7420 636f 6e74  dict - must cont
+00015510: 6169 6e20 636f 7374 202f 2063 7572 7265  ain cost / curre
+00015520: 6e63 7920 2f20 7261 7465 0a20 2020 2020  ncy / rate.     
+00015530: 2020 203a 7061 7261 6d20 7379 6d62 6f6c     :param symbol
+00015540: 3a20 5379 6d62 6f6c 206f 6620 7468 6520  : Symbol of the 
+00015550: 6f72 6465 720a 2020 2020 2020 2020 3a70  order.        :p
+00015560: 6172 616d 2063 6f73 743a 2054 6f74 616c  aram cost: Total
+00015570: 2063 6f73 7420 6f66 2074 6865 206f 7264   cost of the ord
+00015580: 6572 0a20 2020 2020 2020 203a 7061 7261  er.        :para
+00015590: 6d20 616d 6f75 6e74 3a20 416d 6f75 6e74  m amount: Amount
+000155a0: 206f 6620 7468 6520 6f72 6465 720a 2020   of the order.  
+000155b0: 2020 2020 2020 3a72 6574 7572 6e3a 2054        :return: T
+000155c0: 7570 6c65 2077 6974 6820 636f 7374 2c20  uple with cost, 
+000155d0: 6375 7272 656e 6379 2c20 7261 7465 206f  currency, rate o
+000155e0: 6620 7468 6520 6769 7665 6e20 6665 6520  f the given fee 
+000155f0: 6469 6374 0a20 2020 2020 2020 2022 2222  dict.        """
+00015600: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00015610: 2866 6c6f 6174 2866 6565 5b27 636f 7374  (float(fee['cost
+00015620: 275d 292c 0a20 2020 2020 2020 2020 2020  ']),.           
+00015630: 2020 2020 2066 6565 5b27 6375 7272 656e       fee['curren
+00015640: 6379 275d 2c0a 2020 2020 2020 2020 2020  cy'],.          
+00015650: 2020 2020 2020 7365 6c66 2e63 616c 6375        self.calcu
+00015660: 6c61 7465 5f66 6565 5f72 6174 6528 0a20  late_fee_rate(. 
+00015670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015680: 2020 2066 6565 2c0a 2020 2020 2020 2020     fee,.        
+00015690: 2020 2020 2020 2020 2020 2020 7379 6d62              symb
+000156a0: 6f6c 2c0a 2020 2020 2020 2020 2020 2020  ol,.            
+000156b0: 2020 2020 2020 2020 636f 7374 2c0a 2020          cost,.  
+000156c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000156d0: 2020 616d 6f75 6e74 0a20 2020 2020 2020    amount.       
+000156e0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+000156f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00015700: 0a0a 2020 2020 2320 4869 7374 6f72 6963  ..    # Historic
+00015710: 2064 6174 610a 0a20 2020 2064 6566 2067   data..    def g
+00015720: 6574 5f68 6973 746f 7269 635f 6f68 6c63  et_historic_ohlc
+00015730: 7628 7365 6c66 2c20 7061 6972 3a20 7374  v(self, pair: st
+00015740: 722c 2074 696d 6566 7261 6d65 3a20 7374  r, timeframe: st
+00015750: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00015760: 2020 2020 2020 2020 2020 2020 2020 7369                si
+00015770: 6e63 655f 6d73 3a20 696e 742c 2063 616e  nce_ms: int, can
+00015780: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
+00015790: 5479 7065 2c0a 2020 2020 2020 2020 2020  Type,.          
+000157a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157b0: 2069 735f 6e65 775f 7061 6972 3a20 626f   is_new_pair: bo
+000157c0: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
+000157d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000157e0: 2020 2020 2020 2075 6e74 696c 5f6d 733a         until_ms:
+000157f0: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+00015800: 204e 6f6e 6529 202d 3e20 4c69 7374 3a0a   None) -> List:.
+00015810: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00015820: 2020 2020 4765 7420 6361 6e64 6c65 2068      Get candle h
+00015830: 6973 746f 7279 2075 7369 6e67 2061 7379  istory using asy
+00015840: 6e63 696f 2061 6e64 2072 6574 7572 6e73  ncio and returns
+00015850: 2074 6865 206c 6973 7420 6f66 2063 616e   the list of can
+00015860: 646c 6573 2e0a 2020 2020 2020 2020 4861  dles..        Ha
+00015870: 6e64 6c65 7320 616c 6c20 6173 796e 6320  ndles all async 
+00015880: 776f 726b 2066 6f72 2074 6869 732e 0a20  work for this.. 
+00015890: 2020 2020 2020 2041 7379 6e63 206f 7665         Async ove
+000158a0: 7220 6f6e 6520 7061 6972 2c20 6173 7375  r one pair, assu
+000158b0: 6d69 6e67 2077 6520 6765 7420 6073 656c  ming we get `sel
+000158c0: 662e 6f68 6c63 765f 6361 6e64 6c65 5f6c  f.ohlcv_candle_l
+000158d0: 696d 6974 2829 6020 6361 6e64 6c65 7320  imit()` candles 
+000158e0: 7065 7220 6361 6c6c 2e0a 2020 2020 2020  per call..      
+000158f0: 2020 3a70 6172 616d 2070 6169 723a 2050    :param pair: P
+00015900: 6169 7220 746f 2064 6f77 6e6c 6f61 640a  air to download.
+00015910: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
+00015920: 696d 6566 7261 6d65 3a20 5469 6d65 6672  imeframe: Timefr
+00015930: 616d 6520 746f 2067 6574 2064 6174 6120  ame to get data 
+00015940: 666f 720a 2020 2020 2020 2020 3a70 6172  for.        :par
+00015950: 616d 2073 696e 6365 5f6d 733a 2054 696d  am since_ms: Tim
+00015960: 6573 7461 6d70 2069 6e20 6d69 6c6c 6973  estamp in millis
+00015970: 6563 6f6e 6473 2074 6f20 6765 7420 6869  econds to get hi
+00015980: 7374 6f72 7920 6672 6f6d 0a20 2020 2020  story from.     
+00015990: 2020 203a 7061 7261 6d20 756e 7469 6c5f     :param until_
+000159a0: 6d73 3a20 5469 6d65 7374 616d 7020 696e  ms: Timestamp in
+000159b0: 206d 696c 6c69 7365 636f 6e64 7320 746f   milliseconds to
+000159c0: 2067 6574 2068 6973 746f 7279 2075 7020   get history up 
+000159d0: 746f 0a20 2020 2020 2020 203a 7061 7261  to.        :para
+000159e0: 6d20 6361 6e64 6c65 5f74 7970 653a 2027  m candle_type: '
+000159f0: 272c 206d 6172 6b2c 2069 6e64 6578 2c20  ', mark, index, 
+00015a00: 7072 656d 6975 6d49 6e64 6578 2c20 6f72  premiumIndex, or
+00015a10: 2066 756e 6469 6e67 5f72 6174 650a 2020   funding_rate.  
+00015a20: 2020 2020 2020 3a72 6574 7572 6e3a 204c        :return: L
+00015a30: 6973 7420 7769 7468 2063 616e 646c 6520  ist with candle 
+00015a40: 284f 484c 4356 2920 6461 7461 0a20 2020  (OHLCV) data.   
+00015a50: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00015a60: 2070 6169 722c 205f 2c20 5f2c 2064 6174   pair, _, _, dat
+00015a70: 612c 205f 203d 2073 656c 662e 6c6f 6f70  a, _ = self.loop
+00015a80: 2e72 756e 5f75 6e74 696c 5f63 6f6d 706c  .run_until_compl
+00015a90: 6574 6528 0a20 2020 2020 2020 2020 2020  ete(.           
+00015aa0: 2073 656c 662e 5f61 7379 6e63 5f67 6574   self._async_get
+00015ab0: 5f68 6973 746f 7269 635f 6f68 6c63 7628  _historic_ohlcv(
+00015ac0: 7061 6972 3d70 6169 722c 2074 696d 6566  pair=pair, timef
+00015ad0: 7261 6d65 3d74 696d 6566 7261 6d65 2c0a  rame=timeframe,.
+00015ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b00: 2020 2020 2020 2020 2020 2073 696e 6365             since
+00015b10: 5f6d 733d 7369 6e63 655f 6d73 2c20 756e  _ms=since_ms, un
+00015b20: 7469 6c5f 6d73 3d75 6e74 696c 5f6d 732c  til_ms=until_ms,
+00015b30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00015b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b50: 2020 2020 2020 2020 2020 2020 2073 696e               sin
-00015b60: 6365 5f6d 733a 2069 6e74 2c20 6361 6e64  ce_ms: int, cand
-00015b70: 6c65 5f74 7970 653a 2043 616e 646c 6554  le_type: CandleT
-00015b80: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
-00015b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ba0: 2020 2020 2020 2020 2020 2020 2069 735f               is_
-00015bb0: 6e65 775f 7061 6972 3a20 626f 6f6c 203d  new_pair: bool =
-00015bc0: 2046 616c 7365 2c20 7261 6973 655f 3a20   False, raise_: 
-00015bd0: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-00015be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c00: 2020 2020 2020 756e 7469 6c5f 6d73 3a20        until_ms: 
-00015c10: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
-00015c20: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00015c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c40: 2020 2020 2020 2020 2020 2020 2029 202d               ) -
-00015c50: 3e20 4f48 4c43 5652 6573 706f 6e73 653a  > OHLCVResponse:
-00015c60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00015c70: 2020 2020 2044 6f77 6e6c 6f61 6420 6869       Download hi
-00015c80: 7374 6f72 6963 206f 686c 6376 0a20 2020  storic ohlcv.   
-00015c90: 2020 2020 203a 7061 7261 6d20 6973 5f6e       :param is_n
-00015ca0: 6577 5f70 6169 723a 2075 7365 6420 6279  ew_pair: used by
-00015cb0: 2062 696e 616e 6365 2073 7562 636c 6173   binance subclas
-00015cc0: 7320 746f 2061 6c6c 6f77 2022 6661 7374  s to allow "fast
-00015cd0: 2220 6e65 7720 7061 6972 2064 6f77 6e6c  " new pair downl
-00015ce0: 6f61 6469 6e67 0a20 2020 2020 2020 203a  oading.        :
-00015cf0: 7061 7261 6d20 6361 6e64 6c65 5f74 7970  param candle_typ
-00015d00: 653a 2041 6e79 206f 6620 7468 6520 656e  e: Any of the en
-00015d10: 756d 2043 616e 646c 6554 7970 6520 286d  um CandleType (m
-00015d20: 7573 7420 6d61 7463 6820 7472 6164 696e  ust match tradin
-00015d30: 6720 6d6f 6465 2129 0a20 2020 2020 2020  g mode!).       
-00015d40: 2022 2222 0a0a 2020 2020 2020 2020 6f6e   """..        on
-00015d50: 655f 6361 6c6c 203d 2074 696d 6566 7261  e_call = timefra
-00015d60: 6d65 5f74 6f5f 6d73 6563 7328 7469 6d65  me_to_msecs(time
-00015d70: 6672 616d 6529 202a 2073 656c 662e 6f68  frame) * self.oh
-00015d80: 6c63 765f 6361 6e64 6c65 5f6c 696d 6974  lcv_candle_limit
-00015d90: 280a 2020 2020 2020 2020 2020 2020 7469  (.            ti
-00015da0: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
-00015db0: 7479 7065 2c20 7369 6e63 655f 6d73 290a  type, since_ms).
-00015dc0: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-00015dd0: 6562 7567 280a 2020 2020 2020 2020 2020  ebug(.          
-00015de0: 2020 226f 6e65 5f63 616c 6c3a 2025 7320    "one_call: %s 
-00015df0: 6d73 6563 7320 2825 7329 222c 0a20 2020  msecs (%s)",.   
-00015e00: 2020 2020 2020 2020 206f 6e65 5f63 616c           one_cal
-00015e10: 6c2c 0a20 2020 2020 2020 2020 2020 2064  l,.            d
-00015e20: 745f 6875 6d61 6e69 7a65 2864 745f 6e6f  t_humanize(dt_no
-00015e30: 7728 2920 2d20 7469 6d65 6465 6c74 6128  w() - timedelta(
-00015e40: 6d69 6c6c 6973 6563 6f6e 6473 3d6f 6e65  milliseconds=one
-00015e50: 5f63 616c 6c29 2c20 6f6e 6c79 5f64 6973  _call), only_dis
-00015e60: 7461 6e63 653d 5472 7565 290a 2020 2020  tance=True).    
-00015e70: 2020 2020 290a 2020 2020 2020 2020 696e      ).        in
-00015e80: 7075 745f 636f 726f 7574 696e 6573 203d  put_coroutines =
-00015e90: 205b 7365 6c66 2e5f 6173 796e 635f 6765   [self._async_ge
-00015ea0: 745f 6361 6e64 6c65 5f68 6973 746f 7279  t_candle_history
-00015eb0: 280a 2020 2020 2020 2020 2020 2020 7061  (.            pa
-00015ec0: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
-00015ed0: 616e 646c 655f 7479 7065 2c20 7369 6e63  andle_type, sinc
-00015ee0: 6529 2066 6f72 2073 696e 6365 2069 6e0a  e) for since in.
-00015ef0: 2020 2020 2020 2020 2020 2020 7261 6e67              rang
-00015f00: 6528 7369 6e63 655f 6d73 2c20 756e 7469  e(since_ms, unti
-00015f10: 6c5f 6d73 206f 7220 6474 5f74 7328 292c  l_ms or dt_ts(),
-00015f20: 206f 6e65 5f63 616c 6c29 5d0a 0a20 2020   one_call)]..   
-00015f30: 2020 2020 2064 6174 613a 204c 6973 7420       data: List 
-00015f40: 3d20 5b5d 0a20 2020 2020 2020 2023 2043  = [].        # C
-00015f50: 6875 6e6b 2072 6571 7565 7374 7320 696e  hunk requests in
-00015f60: 746f 2062 6174 6368 6573 206f 6620 3130  to batches of 10
-00015f70: 3020 746f 2061 766f 6964 206f 7665 7277  0 to avoid overw
-00015f80: 656c 6d69 6e67 2063 6378 7420 5468 726f  elming ccxt Thro
-00015f90: 7474 6c69 6e67 0a20 2020 2020 2020 2066  ttling.        f
-00015fa0: 6f72 2069 6e70 7574 5f63 6f72 6f20 696e  or input_coro in
-00015fb0: 2063 6875 6e6b 7328 696e 7075 745f 636f   chunks(input_co
-00015fc0: 726f 7574 696e 6573 2c20 3130 3029 3a0a  routines, 100):.
-00015fd0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00015fe0: 756c 7473 203d 2061 7761 6974 2061 7379  ults = await asy
-00015ff0: 6e63 696f 2e67 6174 6865 7228 2a69 6e70  ncio.gather(*inp
-00016000: 7574 5f63 6f72 6f2c 2072 6574 7572 6e5f  ut_coro, return_
-00016010: 6578 6365 7074 696f 6e73 3d54 7275 6529  exceptions=True)
-00016020: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00016030: 2072 6573 2069 6e20 7265 7375 6c74 733a   res in results:
-00016040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016050: 2069 6620 6973 696e 7374 616e 6365 2872   if isinstance(r
-00016060: 6573 2c20 4261 7365 4578 6365 7074 696f  es, BaseExceptio
-00016070: 6e29 3a0a 2020 2020 2020 2020 2020 2020  n):.            
-00016080: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
-00016090: 6172 6e69 6e67 2866 2241 7379 6e63 2063  arning(f"Async c
-000160a0: 6f64 6520 7261 6973 6564 2061 6e20 6578  ode raised an ex
-000160b0: 6365 7074 696f 6e3a 207b 7265 7072 2872  ception: {repr(r
-000160c0: 6573 297d 2229 0a20 2020 2020 2020 2020  es)}").         
-000160d0: 2020 2020 2020 2020 2020 2069 6620 7261             if ra
-000160e0: 6973 655f 3a0a 2020 2020 2020 2020 2020  ise_:.          
-000160f0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00016100: 6973 650a 2020 2020 2020 2020 2020 2020  ise.            
-00016110: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00016120: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016130: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00016140: 2020 2020 2020 2020 2020 2023 2044 6563             # Dec
-00016150: 6f6e 7374 7275 6374 2074 7570 6c65 2069  onstruct tuple i
-00016160: 6620 6974 2773 206e 6f74 2061 6e20 6578  f it's not an ex
-00016170: 6365 7074 696f 6e0a 2020 2020 2020 2020  ception.        
-00016180: 2020 2020 2020 2020 2020 2020 702c 205f              p, _
-00016190: 2c20 632c 206e 6577 5f64 6174 612c 205f  , c, new_data, _
-000161a0: 203d 2072 6573 0a20 2020 2020 2020 2020   = res.         
-000161b0: 2020 2020 2020 2020 2020 2069 6620 7020             if p 
-000161c0: 3d3d 2070 6169 7220 616e 6420 6320 3d3d  == pair and c ==
-000161d0: 2063 616e 646c 655f 7479 7065 3a0a 2020   candle_type:.  
+00015b50: 2020 2020 2020 2020 2020 2020 6973 5f6e              is_n
+00015b60: 6577 5f70 6169 723d 6973 5f6e 6577 5f70  ew_pair=is_new_p
+00015b70: 6169 722c 2063 616e 646c 655f 7479 7065  air, candle_type
+00015b80: 3d63 616e 646c 655f 7479 7065 2929 0a20  =candle_type)). 
+00015b90: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
+00015ba0: 666f 2866 2244 6f77 6e6c 6f61 6465 6420  fo(f"Downloaded 
+00015bb0: 6461 7461 2066 6f72 207b 7061 6972 7d20  data for {pair} 
+00015bc0: 7769 7468 206c 656e 6774 6820 7b6c 656e  with length {len
+00015bd0: 2864 6174 6129 7d2e 2229 0a20 2020 2020  (data)}.").     
+00015be0: 2020 2072 6574 7572 6e20 6461 7461 0a0a     return data..
+00015bf0: 2020 2020 6173 796e 6320 6465 6620 5f61      async def _a
+00015c00: 7379 6e63 5f67 6574 5f68 6973 746f 7269  sync_get_histori
+00015c10: 635f 6f68 6c63 7628 7365 6c66 2c20 7061  c_ohlcv(self, pa
+00015c20: 6972 3a20 7374 722c 2074 696d 6566 7261  ir: str, timefra
+00015c30: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
+00015c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c60: 2073 696e 6365 5f6d 733a 2069 6e74 2c20   since_ms: int, 
+00015c70: 6361 6e64 6c65 5f74 7970 653a 2043 616e  candle_type: Can
+00015c80: 646c 6554 7970 652c 0a20 2020 2020 2020  dleType,.       
+00015c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015cb0: 2069 735f 6e65 775f 7061 6972 3a20 626f   is_new_pair: bo
+00015cc0: 6f6c 203d 2046 616c 7365 2c20 7261 6973  ol = False, rais
+00015cd0: 655f 3a20 626f 6f6c 203d 2046 616c 7365  e_: bool = False
+00015ce0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00015cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d00: 2020 2020 2020 2020 2020 756e 7469 6c5f            until_
+00015d10: 6d73 3a20 4f70 7469 6f6e 616c 5b69 6e74  ms: Optional[int
+00015d20: 5d20 3d20 4e6f 6e65 0a20 2020 2020 2020  ] = None.       
+00015d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d50: 2029 202d 3e20 4f48 4c43 5652 6573 706f   ) -> OHLCVRespo
+00015d60: 6e73 653a 0a20 2020 2020 2020 2022 2222  nse:.        """
+00015d70: 0a20 2020 2020 2020 2044 6f77 6e6c 6f61  .        Downloa
+00015d80: 6420 6869 7374 6f72 6963 206f 686c 6376  d historic ohlcv
+00015d90: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00015da0: 6973 5f6e 6577 5f70 6169 723a 2075 7365  is_new_pair: use
+00015db0: 6420 6279 2062 696e 616e 6365 2073 7562  d by binance sub
+00015dc0: 636c 6173 7320 746f 2061 6c6c 6f77 2022  class to allow "
+00015dd0: 6661 7374 2220 6e65 7720 7061 6972 2064  fast" new pair d
+00015de0: 6f77 6e6c 6f61 6469 6e67 0a20 2020 2020  ownloading.     
+00015df0: 2020 203a 7061 7261 6d20 6361 6e64 6c65     :param candle
+00015e00: 5f74 7970 653a 2041 6e79 206f 6620 7468  _type: Any of th
+00015e10: 6520 656e 756d 2043 616e 646c 6554 7970  e enum CandleTyp
+00015e20: 6520 286d 7573 7420 6d61 7463 6820 7472  e (must match tr
+00015e30: 6164 696e 6720 6d6f 6465 2129 0a20 2020  ading mode!).   
+00015e40: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00015e50: 2020 6f6e 655f 6361 6c6c 203d 2074 696d    one_call = tim
+00015e60: 6566 7261 6d65 5f74 6f5f 6d73 6563 7328  eframe_to_msecs(
+00015e70: 7469 6d65 6672 616d 6529 202a 2073 656c  timeframe) * sel
+00015e80: 662e 6f68 6c63 765f 6361 6e64 6c65 5f6c  f.ohlcv_candle_l
+00015e90: 696d 6974 280a 2020 2020 2020 2020 2020  imit(.          
+00015ea0: 2020 7469 6d65 6672 616d 652c 2063 616e    timeframe, can
+00015eb0: 646c 655f 7479 7065 2c20 7369 6e63 655f  dle_type, since_
+00015ec0: 6d73 290a 2020 2020 2020 2020 6c6f 6767  ms).        logg
+00015ed0: 6572 2e64 6562 7567 280a 2020 2020 2020  er.debug(.      
+00015ee0: 2020 2020 2020 226f 6e65 5f63 616c 6c3a        "one_call:
+00015ef0: 2025 7320 6d73 6563 7320 2825 7329 222c   %s msecs (%s)",
+00015f00: 0a20 2020 2020 2020 2020 2020 206f 6e65  .            one
+00015f10: 5f63 616c 6c2c 0a20 2020 2020 2020 2020  _call,.         
+00015f20: 2020 2064 745f 6875 6d61 6e69 7a65 5f64     dt_humanize_d
+00015f30: 656c 7461 2864 745f 6e6f 7728 2920 2d20  elta(dt_now() - 
+00015f40: 7469 6d65 6465 6c74 6128 6d69 6c6c 6973  timedelta(millis
+00015f50: 6563 6f6e 6473 3d6f 6e65 5f63 616c 6c29  econds=one_call)
+00015f60: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00015f70: 2020 2020 696e 7075 745f 636f 726f 7574      input_corout
+00015f80: 696e 6573 203d 205b 7365 6c66 2e5f 6173  ines = [self._as
+00015f90: 796e 635f 6765 745f 6361 6e64 6c65 5f68  ync_get_candle_h
+00015fa0: 6973 746f 7279 280a 2020 2020 2020 2020  istory(.        
+00015fb0: 2020 2020 7061 6972 2c20 7469 6d65 6672      pair, timefr
+00015fc0: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
+00015fd0: 2c20 7369 6e63 6529 2066 6f72 2073 696e  , since) for sin
+00015fe0: 6365 2069 6e0a 2020 2020 2020 2020 2020  ce in.          
+00015ff0: 2020 7261 6e67 6528 7369 6e63 655f 6d73    range(since_ms
+00016000: 2c20 756e 7469 6c5f 6d73 206f 7220 6474  , until_ms or dt
+00016010: 5f74 7328 292c 206f 6e65 5f63 616c 6c29  _ts(), one_call)
+00016020: 5d0a 0a20 2020 2020 2020 2064 6174 613a  ]..        data:
+00016030: 204c 6973 7420 3d20 5b5d 0a20 2020 2020   List = [].     
+00016040: 2020 2023 2043 6875 6e6b 2072 6571 7565     # Chunk reque
+00016050: 7374 7320 696e 746f 2062 6174 6368 6573  sts into batches
+00016060: 206f 6620 3130 3020 746f 2061 766f 6964   of 100 to avoid
+00016070: 206f 7665 7277 6865 6c6d 696e 6720 6363   overwhelming cc
+00016080: 7874 2054 6872 6f74 746c 696e 670a 2020  xt Throttling.  
+00016090: 2020 2020 2020 666f 7220 696e 7075 745f        for input_
+000160a0: 636f 726f 2069 6e20 6368 756e 6b73 2869  coro in chunks(i
+000160b0: 6e70 7574 5f63 6f72 6f75 7469 6e65 732c  nput_coroutines,
+000160c0: 2031 3030 293a 0a0a 2020 2020 2020 2020   100):..        
+000160d0: 2020 2020 7265 7375 6c74 7320 3d20 6177      results = aw
+000160e0: 6169 7420 6173 796e 6369 6f2e 6761 7468  ait asyncio.gath
+000160f0: 6572 282a 696e 7075 745f 636f 726f 2c20  er(*input_coro, 
+00016100: 7265 7475 726e 5f65 7863 6570 7469 6f6e  return_exception
+00016110: 733d 5472 7565 290a 2020 2020 2020 2020  s=True).        
+00016120: 2020 2020 666f 7220 7265 7320 696e 2072      for res in r
+00016130: 6573 756c 7473 3a0a 2020 2020 2020 2020  esults:.        
+00016140: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00016150: 7461 6e63 6528 7265 732c 2042 6173 6545  tance(res, BaseE
+00016160: 7863 6570 7469 6f6e 293a 0a20 2020 2020  xception):.     
+00016170: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00016180: 6f67 6765 722e 7761 726e 696e 6728 6622  ogger.warning(f"
+00016190: 4173 796e 6320 636f 6465 2072 6169 7365  Async code raise
+000161a0: 6420 616e 2065 7863 6570 7469 6f6e 3a20  d an exception: 
+000161b0: 7b72 6570 7228 7265 7329 7d22 290a 2020  {repr(res)}").  
+000161c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000161d0: 2020 6966 2072 6169 7365 5f3a 0a20 2020    if raise_:.   
 000161e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000161f0: 2020 2020 2020 6461 7461 2e65 7874 656e        data.exten
-00016200: 6428 6e65 775f 6461 7461 290a 2020 2020  d(new_data).    
-00016210: 2020 2020 2320 536f 7274 2064 6174 6120      # Sort data 
-00016220: 6167 6169 6e20 6166 7465 7220 6578 7465  again after exte
-00016230: 6e64 696e 6720 7468 6520 7265 7375 6c74  nding the result
-00016240: 202d 2061 626f 7665 2063 616c 6c73 2072   - above calls r
-00016250: 6574 7572 6e20 696e 2022 6173 796e 6320  eturn in "async 
-00016260: 6f72 6465 7222 0a20 2020 2020 2020 2064  order".        d
-00016270: 6174 6120 3d20 736f 7274 6564 2864 6174  ata = sorted(dat
-00016280: 612c 206b 6579 3d6c 616d 6264 6120 783a  a, key=lambda x:
-00016290: 2078 5b30 5d29 0a20 2020 2020 2020 2072   x[0]).        r
-000162a0: 6574 7572 6e20 7061 6972 2c20 7469 6d65  eturn pair, time
-000162b0: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
-000162c0: 7065 2c20 6461 7461 2c20 7365 6c66 2e5f  pe, data, self._
-000162d0: 6f68 6c63 765f 7061 7274 6961 6c5f 6361  ohlcv_partial_ca
-000162e0: 6e64 6c65 0a0a 2020 2020 6465 6620 5f62  ndle..    def _b
-000162f0: 7569 6c64 5f63 6f72 6f75 7469 6e65 280a  uild_coroutine(.
-00016300: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016310: 2c20 7061 6972 3a20 7374 722c 2074 696d  , pair: str, tim
-00016320: 6566 7261 6d65 3a20 7374 722c 2063 616e  eframe: str, can
-00016330: 646c 655f 7479 7065 3a20 4361 6e64 6c65  dle_type: Candle
-00016340: 5479 7065 2c0a 2020 2020 2020 2020 2020  Type,.          
-00016350: 2020 7369 6e63 655f 6d73 3a20 4f70 7469    since_ms: Opti
-00016360: 6f6e 616c 5b69 6e74 5d2c 2063 6163 6865  onal[int], cache
-00016370: 3a20 626f 6f6c 2920 2d3e 2043 6f72 6f75  : bool) -> Corou
-00016380: 7469 6e65 5b41 6e79 2c20 416e 792c 204f  tine[Any, Any, O
-00016390: 484c 4356 5265 7370 6f6e 7365 5d3a 0a20  HLCVResponse]:. 
-000163a0: 2020 2020 2020 206e 6f74 5f61 6c6c 5f64         not_all_d
-000163b0: 6174 6120 3d20 6361 6368 6520 616e 6420  ata = cache and 
-000163c0: 7365 6c66 2e72 6571 7569 7265 645f 6361  self.required_ca
-000163d0: 6e64 6c65 5f63 616c 6c5f 636f 756e 7420  ndle_call_count 
-000163e0: 3e20 310a 2020 2020 2020 2020 6966 2063  > 1.        if c
-000163f0: 6163 6865 2061 6e64 2028 7061 6972 2c20  ache and (pair, 
-00016400: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
-00016410: 655f 7479 7065 2920 696e 2073 656c 662e  e_type) in self.
-00016420: 5f6b 6c69 6e65 733a 0a20 2020 2020 2020  _klines:.       
-00016430: 2020 2020 2063 616e 646c 655f 6c69 6d69       candle_limi
-00016440: 7420 3d20 7365 6c66 2e6f 686c 6376 5f63  t = self.ohlcv_c
-00016450: 616e 646c 655f 6c69 6d69 7428 7469 6d65  andle_limit(time
-00016460: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
-00016470: 7065 290a 2020 2020 2020 2020 2020 2020  pe).            
-00016480: 6d69 6e5f 6461 7465 203d 2064 6174 655f  min_date = date_
-00016490: 6d69 6e75 735f 6361 6e64 6c65 7328 7469  minus_candles(ti
-000164a0: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
-000164b0: 6c69 6d69 7420 2d20 3529 2e74 696d 6573  limit - 5).times
-000164c0: 7461 6d70 2829 0a20 2020 2020 2020 2020  tamp().         
-000164d0: 2020 2023 2043 6865 636b 2069 6620 3120     # Check if 1 
-000164e0: 6361 6c6c 2063 616e 2067 6574 2075 7320  call can get us 
-000164f0: 7570 6461 7465 6420 6361 6e64 6c65 7320  updated candles 
-00016500: 7769 7468 6f75 7420 686f 6c65 2069 6e20  without hole in 
-00016510: 7468 6520 6461 7461 2e0a 2020 2020 2020  the data..      
-00016520: 2020 2020 2020 6966 206d 696e 5f64 6174        if min_dat
-00016530: 6520 3c20 7365 6c66 2e5f 7061 6972 735f  e < self._pairs_
-00016540: 6c61 7374 5f72 6566 7265 7368 5f74 696d  last_refresh_tim
-00016550: 652e 6765 7428 2870 6169 722c 2074 696d  e.get((pair, tim
-00016560: 6566 7261 6d65 2c20 6361 6e64 6c65 5f74  eframe, candle_t
-00016570: 7970 6529 2c20 3029 3a0a 2020 2020 2020  ype), 0):.      
-00016580: 2020 2020 2020 2020 2020 2320 4361 6368            # Cach
-00016590: 6520 6361 6e20 6265 2075 7365 6420 2d20  e can be used - 
-000165a0: 646f 206f 6e65 2d6f 6666 2063 616c 6c2e  do one-off call.
-000165b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000165c0: 206e 6f74 5f61 6c6c 5f64 6174 6120 3d20   not_all_data = 
-000165d0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-000165e0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000165f0: 2020 2020 2020 2020 2320 5469 6d65 206a          # Time j
-00016600: 756d 7020 6465 7465 6374 6564 2c20 6576  ump detected, ev
-00016610: 6963 7420 6361 6368 650a 2020 2020 2020  ict cache.      
-00016620: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00016630: 2e69 6e66 6f28 0a20 2020 2020 2020 2020  .info(.         
-00016640: 2020 2020 2020 2020 2020 2066 2254 696d             f"Tim
-00016650: 6520 6a75 6d70 2064 6574 6563 7465 642e  e jump detected.
-00016660: 2045 7669 6374 696e 6720 6361 6368 6520   Evicting cache 
-00016670: 666f 7220 7b70 6169 727d 2c20 7b74 696d  for {pair}, {tim
-00016680: 6566 7261 6d65 7d2c 207b 6361 6e64 6c65  eframe}, {candle
-00016690: 5f74 7970 657d 2229 0a20 2020 2020 2020  _type}").       
-000166a0: 2020 2020 2020 2020 2064 656c 2073 656c           del sel
-000166b0: 662e 5f6b 6c69 6e65 735b 2870 6169 722c  f._klines[(pair,
-000166c0: 2074 696d 6566 7261 6d65 2c20 6361 6e64   timeframe, cand
-000166d0: 6c65 5f74 7970 6529 5d0a 0a20 2020 2020  le_type)]..     
-000166e0: 2020 2069 6620 286e 6f74 2073 696e 6365     if (not since
-000166f0: 5f6d 7320 616e 6420 2873 656c 662e 5f66  _ms and (self._f
-00016700: 745f 6861 735b 226f 686c 6376 5f72 6571  t_has["ohlcv_req
-00016710: 7569 7265 5f73 696e 6365 225d 206f 7220  uire_since"] or 
-00016720: 6e6f 745f 616c 6c5f 6461 7461 2929 3a0a  not_all_data)):.
-00016730: 2020 2020 2020 2020 2020 2020 2320 4d75              # Mu
-00016740: 6c74 6970 6c65 2063 616c 6c73 2066 6f72  ltiple calls for
-00016750: 206f 6e65 2070 6169 7220 2d20 746f 2067   one pair - to g
-00016760: 6574 206d 6f72 6520 6869 7374 6f72 790a  et more history.
-00016770: 2020 2020 2020 2020 2020 2020 6f6e 655f              one_
-00016780: 6361 6c6c 203d 2074 696d 6566 7261 6d65  call = timeframe
-00016790: 5f74 6f5f 6d73 6563 7328 7469 6d65 6672  _to_msecs(timefr
-000167a0: 616d 6529 202a 2073 656c 662e 6f68 6c63  ame) * self.ohlc
-000167b0: 765f 6361 6e64 6c65 5f6c 696d 6974 280a  v_candle_limit(.
-000167c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000167d0: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
-000167e0: 655f 7479 7065 2c20 7369 6e63 655f 6d73  e_type, since_ms
-000167f0: 290a 2020 2020 2020 2020 2020 2020 6d6f  ).            mo
-00016800: 7665 5f74 6f20 3d20 6f6e 655f 6361 6c6c  ve_to = one_call
-00016810: 202a 2073 656c 662e 7265 7175 6972 6564   * self.required
-00016820: 5f63 616e 646c 655f 6361 6c6c 5f63 6f75  _candle_call_cou
-00016830: 6e74 0a20 2020 2020 2020 2020 2020 206e  nt.            n
-00016840: 6f77 203d 2074 696d 6566 7261 6d65 5f74  ow = timeframe_t
-00016850: 6f5f 6e65 7874 5f64 6174 6528 7469 6d65  o_next_date(time
-00016860: 6672 616d 6529 0a20 2020 2020 2020 2020  frame).         
-00016870: 2020 2073 696e 6365 5f6d 7320 3d20 6474     since_ms = dt
-00016880: 5f74 7328 6e6f 7720 2d20 7469 6d65 6465  _ts(now - timede
-00016890: 6c74 6128 7365 636f 6e64 733d 6d6f 7665  lta(seconds=move
-000168a0: 5f74 6f20 2f2f 2031 3030 3029 290a 0a20  _to // 1000)).. 
-000168b0: 2020 2020 2020 2069 6620 7369 6e63 655f         if since_
-000168c0: 6d73 3a0a 2020 2020 2020 2020 2020 2020  ms:.            
-000168d0: 7265 7475 726e 2073 656c 662e 5f61 7379  return self._asy
-000168e0: 6e63 5f67 6574 5f68 6973 746f 7269 635f  nc_get_historic_
-000168f0: 6f68 6c63 7628 0a20 2020 2020 2020 2020  ohlcv(.         
-00016900: 2020 2020 2020 2070 6169 722c 2074 696d         pair, tim
-00016910: 6566 7261 6d65 2c20 7369 6e63 655f 6d73  eframe, since_ms
-00016920: 3d73 696e 6365 5f6d 732c 2072 6169 7365  =since_ms, raise
-00016930: 5f3d 5472 7565 2c20 6361 6e64 6c65 5f74  _=True, candle_t
-00016940: 7970 653d 6361 6e64 6c65 5f74 7970 6529  ype=candle_type)
-00016950: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00016960: 2020 2020 2020 2020 2020 2023 204f 6e65             # One
-00016970: 2063 616c 6c20 2e2e 2e20 2272 6567 756c   call ... "regul
-00016980: 6172 2220 7265 6672 6573 680a 2020 2020  ar" refresh.    
-00016990: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-000169a0: 656c 662e 5f61 7379 6e63 5f67 6574 5f63  elf._async_get_c
-000169b0: 616e 646c 655f 6869 7374 6f72 7928 0a20  andle_history(. 
-000169c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000169d0: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
-000169e0: 7369 6e63 655f 6d73 3d73 696e 6365 5f6d  since_ms=since_m
-000169f0: 732c 2063 616e 646c 655f 7479 7065 3d63  s, candle_type=c
-00016a00: 616e 646c 655f 7479 7065 290a 0a20 2020  andle_type)..   
-00016a10: 2064 6566 205f 6275 696c 645f 6f68 6c63   def _build_ohlc
-00016a20: 765f 646c 5f6a 6f62 7328 0a20 2020 2020  v_dl_jobs(.     
-00016a30: 2020 2020 2020 2073 656c 662c 2070 6169         self, pai
-00016a40: 725f 6c69 7374 3a20 4c69 7374 5061 6972  r_list: ListPair
-00016a50: 7357 6974 6854 696d 6566 7261 6d65 732c  sWithTimeframes,
-00016a60: 2073 696e 6365 5f6d 733a 204f 7074 696f   since_ms: Optio
-00016a70: 6e61 6c5b 696e 745d 2c0a 2020 2020 2020  nal[int],.      
-00016a80: 2020 2020 2020 6361 6368 653a 2062 6f6f        cache: boo
-00016a90: 6c29 202d 3e20 5475 706c 655b 4c69 7374  l) -> Tuple[List
-00016aa0: 5b43 6f72 6f75 7469 6e65 5d2c 204c 6973  [Coroutine], Lis
-00016ab0: 745b 5475 706c 655b 7374 722c 2073 7472  t[Tuple[str, str
-00016ac0: 2c20 4361 6e64 6c65 5479 7065 5d5d 5d3a  , CandleType]]]:
-00016ad0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016ae0: 2020 2020 2042 7569 6c64 2043 6f72 6f75       Build Corou
-00016af0: 7469 6e65 7320 746f 2065 7865 6375 7465  tines to execute
-00016b00: 2061 7320 7061 7274 206f 6620 7265 6672   as part of refr
-00016b10: 6573 685f 6c61 7465 7374 5f6f 686c 6376  esh_latest_ohlcv
-00016b20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016b30: 2020 2020 2069 6e70 7574 5f63 6f72 6f75       input_corou
-00016b40: 7469 6e65 733a 204c 6973 745b 436f 726f  tines: List[Coro
-00016b50: 7574 696e 655b 416e 792c 2041 6e79 2c20  utine[Any, Any, 
-00016b60: 4f48 4c43 5652 6573 706f 6e73 655d 5d20  OHLCVResponse]] 
-00016b70: 3d20 5b5d 0a20 2020 2020 2020 2063 6163  = [].        cac
-00016b80: 6865 645f 7061 6972 7320 3d20 5b5d 0a20  hed_pairs = []. 
-00016b90: 2020 2020 2020 2066 6f72 2070 6169 722c         for pair,
-00016ba0: 2074 696d 6566 7261 6d65 2c20 6361 6e64   timeframe, cand
-00016bb0: 6c65 5f74 7970 6520 696e 2073 6574 2870  le_type in set(p
-00016bc0: 6169 725f 6c69 7374 293a 0a20 2020 2020  air_list):.     
-00016bd0: 2020 2020 2020 2069 6620 2874 696d 6566         if (timef
-00016be0: 7261 6d65 206e 6f74 2069 6e20 7365 6c66  rame not in self
-00016bf0: 2e74 696d 6566 7261 6d65 730a 2020 2020  .timeframes.    
-00016c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c10: 616e 6420 6361 6e64 6c65 5f74 7970 6520  and candle_type 
-00016c20: 696e 2028 4361 6e64 6c65 5479 7065 2e53  in (CandleType.S
-00016c30: 504f 542c 2043 616e 646c 6554 7970 652e  POT, CandleType.
-00016c40: 4655 5455 5245 5329 293a 0a20 2020 2020  FUTURES)):.     
-00016c50: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00016c60: 722e 7761 726e 696e 6728 0a20 2020 2020  r.warning(.     
-00016c70: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00016c80: 2243 616e 6e6f 7420 646f 776e 6c6f 6164  "Cannot download
-00016c90: 2028 7b70 6169 727d 2c20 7b74 696d 6566   ({pair}, {timef
-00016ca0: 7261 6d65 7d29 2063 6f6d 6269 6e61 7469  rame}) combinati
-00016cb0: 6f6e 2061 7320 7468 6973 2074 696d 6566  on as this timef
-00016cc0: 7261 6d65 2069 7320 220a 2020 2020 2020  rame is ".      
-00016cd0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00016ce0: 6e6f 7420 6176 6169 6c61 626c 6520 6f6e  not available on
-00016cf0: 207b 7365 6c66 2e6e 616d 657d 2e20 4176   {self.name}. Av
-00016d00: 6169 6c61 626c 6520 7469 6d65 6672 616d  ailable timefram
-00016d10: 6573 2061 7265 2022 0a20 2020 2020 2020  es are ".       
-00016d20: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
-00016d30: 272c 2027 2e6a 6f69 6e28 7365 6c66 2e74  ', '.join(self.t
-00016d40: 696d 6566 7261 6d65 7329 7d2e 2229 0a20  imeframes)}."). 
-00016d50: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00016d60: 6f6e 7469 6e75 650a 0a20 2020 2020 2020  ontinue..       
-00016d70: 2020 2020 2069 6620 2828 7061 6972 2c20       if ((pair, 
-00016d80: 7469 6d65 6672 616d 652c 2063 616e 646c  timeframe, candl
-00016d90: 655f 7479 7065 2920 6e6f 7420 696e 2073  e_type) not in s
-00016da0: 656c 662e 5f6b 6c69 6e65 7320 6f72 206e  elf._klines or n
-00016db0: 6f74 2063 6163 6865 0a20 2020 2020 2020  ot cache.       
-00016dc0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-00016dd0: 7365 6c66 2e5f 6e6f 775f 6973 5f74 696d  self._now_is_tim
-00016de0: 655f 746f 5f72 6566 7265 7368 2870 6169  e_to_refresh(pai
-00016df0: 722c 2074 696d 6566 7261 6d65 2c20 6361  r, timeframe, ca
-00016e00: 6e64 6c65 5f74 7970 6529 293a 0a0a 2020  ndle_type)):..  
-00016e10: 2020 2020 2020 2020 2020 2020 2020 696e                in
-00016e20: 7075 745f 636f 726f 7574 696e 6573 2e61  put_coroutines.a
-00016e30: 7070 656e 6428 0a20 2020 2020 2020 2020  ppend(.         
-00016e40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00016e50: 5f62 7569 6c64 5f63 6f72 6f75 7469 6e65  _build_coroutine
-00016e60: 2870 6169 722c 2074 696d 6566 7261 6d65  (pair, timeframe
-00016e70: 2c20 6361 6e64 6c65 5f74 7970 652c 2073  , candle_type, s
-00016e80: 696e 6365 5f6d 732c 2063 6163 6865 2929  ince_ms, cache))
-00016e90: 0a0a 2020 2020 2020 2020 2020 2020 656c  ..            el
-00016ea0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00016eb0: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-00016ec0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00016ed0: 2020 2020 2020 6622 5573 696e 6720 6361        f"Using ca
-00016ee0: 6368 6564 2063 616e 646c 6520 284f 484c  ched candle (OHL
-00016ef0: 4356 2920 6461 7461 2066 6f72 207b 7061  CV) data for {pa
-00016f00: 6972 7d2c 207b 7469 6d65 6672 616d 657d  ir}, {timeframe}
-00016f10: 2c20 7b63 616e 646c 655f 7479 7065 7d20  , {candle_type} 
-00016f20: 2e2e 2e22 0a20 2020 2020 2020 2020 2020  ...".           
-00016f30: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00016f40: 2020 2020 2020 2063 6163 6865 645f 7061         cached_pa
-00016f50: 6972 732e 6170 7065 6e64 2828 7061 6972  irs.append((pair
-00016f60: 2c20 7469 6d65 6672 616d 652c 2063 616e  , timeframe, can
-00016f70: 646c 655f 7479 7065 2929 0a0a 2020 2020  dle_type))..    
-00016f80: 2020 2020 7265 7475 726e 2069 6e70 7574      return input
-00016f90: 5f63 6f72 6f75 7469 6e65 732c 2063 6163  _coroutines, cac
-00016fa0: 6865 645f 7061 6972 730a 0a20 2020 2064  hed_pairs..    d
-00016fb0: 6566 205f 7072 6f63 6573 735f 6f68 6c63  ef _process_ohlc
-00016fc0: 765f 6466 2873 656c 662c 2070 6169 723a  v_df(self, pair:
-00016fd0: 2073 7472 2c20 7469 6d65 6672 616d 653a   str, timeframe:
-00016fe0: 2073 7472 2c20 635f 7479 7065 3a20 4361   str, c_type: Ca
-00016ff0: 6e64 6c65 5479 7065 2c20 7469 636b 733a  ndleType, ticks:
-00017000: 204c 6973 745b 4c69 7374 5d2c 0a20 2020   List[List],.   
-00017010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017020: 2020 2020 2020 2063 6163 6865 3a20 626f         cache: bo
-00017030: 6f6c 2c20 6472 6f70 5f69 6e63 6f6d 706c  ol, drop_incompl
-00017040: 6574 653a 2062 6f6f 6c29 202d 3e20 4461  ete: bool) -> Da
-00017050: 7461 4672 616d 653a 0a20 2020 2020 2020  taFrame:.       
-00017060: 2023 206b 6565 7069 6e67 206c 6173 7420   # keeping last 
-00017070: 6361 6e64 6c65 2074 696d 6520 6173 206c  candle time as l
-00017080: 6173 7420 7265 6672 6573 6865 6420 7469  ast refreshed ti
-00017090: 6d65 206f 6620 7468 6520 7061 6972 0a20  me of the pair. 
-000170a0: 2020 2020 2020 2069 6620 7469 636b 7320         if ticks 
-000170b0: 616e 6420 6361 6368 653a 0a20 2020 2020  and cache:.     
-000170c0: 2020 2020 2020 2069 6478 203d 202d 3220         idx = -2 
-000170d0: 6966 2064 726f 705f 696e 636f 6d70 6c65  if drop_incomple
-000170e0: 7465 2061 6e64 206c 656e 2874 6963 6b73  te and len(ticks
-000170f0: 2920 3e20 3120 656c 7365 202d 310a 2020  ) > 1 else -1.  
-00017100: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00017110: 7061 6972 735f 6c61 7374 5f72 6566 7265  pairs_last_refre
-00017120: 7368 5f74 696d 655b 2870 6169 722c 2074  sh_time[(pair, t
-00017130: 696d 6566 7261 6d65 2c20 635f 7479 7065  imeframe, c_type
-00017140: 295d 203d 2074 6963 6b73 5b69 6478 5d5b  )] = ticks[idx][
-00017150: 305d 202f 2f20 3130 3030 0a20 2020 2020  0] // 1000.     
-00017160: 2020 2023 206b 6565 7069 6e67 2070 6172     # keeping par
-00017170: 7365 6420 6461 7461 6672 616d 6520 696e  sed dataframe in
-00017180: 2063 6163 6865 0a20 2020 2020 2020 206f   cache.        o
-00017190: 686c 6376 5f64 6620 3d20 6f68 6c63 765f  hlcv_df = ohlcv_
-000171a0: 746f 5f64 6174 6166 7261 6d65 2874 6963  to_dataframe(tic
-000171b0: 6b73 2c20 7469 6d65 6672 616d 652c 2070  ks, timeframe, p
-000171c0: 6169 723d 7061 6972 2c20 6669 6c6c 5f6d  air=pair, fill_m
-000171d0: 6973 7369 6e67 3d54 7275 652c 0a20 2020  issing=True,.   
-000171e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000171f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017200: 2020 2064 726f 705f 696e 636f 6d70 6c65     drop_incomple
-00017210: 7465 3d64 726f 705f 696e 636f 6d70 6c65  te=drop_incomple
-00017220: 7465 290a 2020 2020 2020 2020 6966 2063  te).        if c
-00017230: 6163 6865 3a0a 2020 2020 2020 2020 2020  ache:.          
-00017240: 2020 6966 2028 7061 6972 2c20 7469 6d65    if (pair, time
-00017250: 6672 616d 652c 2063 5f74 7970 6529 2069  frame, c_type) i
-00017260: 6e20 7365 6c66 2e5f 6b6c 696e 6573 3a0a  n self._klines:.
-00017270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017280: 6f6c 6420 3d20 7365 6c66 2e5f 6b6c 696e  old = self._klin
-00017290: 6573 5b28 7061 6972 2c20 7469 6d65 6672  es[(pair, timefr
-000172a0: 616d 652c 2063 5f74 7970 6529 5d0a 2020  ame, c_type)].  
-000172b0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-000172c0: 5265 6173 7369 676e 2073 6f20 7765 2072  Reassign so we r
-000172d0: 6574 7572 6e20 7468 6520 7570 6461 7465  eturn the update
-000172e0: 642c 2063 6f6d 6269 6e65 6420 6466 0a20  d, combined df. 
-000172f0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00017300: 686c 6376 5f64 6620 3d20 636c 6561 6e5f  hlcv_df = clean_
-00017310: 6f68 6c63 765f 6461 7461 6672 616d 6528  ohlcv_dataframe(
-00017320: 636f 6e63 6174 285b 6f6c 642c 206f 686c  concat([old, ohl
-00017330: 6376 5f64 665d 2c20 6178 6973 3d30 292c  cv_df], axis=0),
-00017340: 2074 696d 6566 7261 6d65 2c20 7061 6972   timeframe, pair
-00017350: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00017360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017380: 2020 2066 696c 6c5f 6d69 7373 696e 673d     fill_missing=
-00017390: 5472 7565 2c20 6472 6f70 5f69 6e63 6f6d  True, drop_incom
-000173a0: 706c 6574 653d 4661 6c73 6529 0a20 2020  plete=False).   
-000173b0: 2020 2020 2020 2020 2020 2020 2063 616e               can
-000173c0: 646c 655f 6c69 6d69 7420 3d20 7365 6c66  dle_limit = self
-000173d0: 2e6f 686c 6376 5f63 616e 646c 655f 6c69  .ohlcv_candle_li
-000173e0: 6d69 7428 7469 6d65 6672 616d 652c 2073  mit(timeframe, s
-000173f0: 656c 662e 5f63 6f6e 6669 675b 2763 616e  elf._config['can
-00017400: 646c 655f 7479 7065 5f64 6566 275d 290a  dle_type_def']).
-00017410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017420: 2320 4167 6520 6f75 7420 6f6c 6420 6361  # Age out old ca
-00017430: 6e64 6c65 730a 2020 2020 2020 2020 2020  ndles.          
-00017440: 2020 2020 2020 6f68 6c63 765f 6466 203d        ohlcv_df =
-00017450: 206f 686c 6376 5f64 662e 7461 696c 2863   ohlcv_df.tail(c
-00017460: 616e 646c 655f 6c69 6d69 7420 2b20 7365  andle_limit + se
-00017470: 6c66 2e5f 7374 6172 7475 705f 6361 6e64  lf._startup_cand
-00017480: 6c65 5f63 6f75 6e74 290a 2020 2020 2020  le_count).      
-00017490: 2020 2020 2020 2020 2020 6f68 6c63 765f            ohlcv_
-000174a0: 6466 203d 206f 686c 6376 5f64 662e 7265  df = ohlcv_df.re
-000174b0: 7365 745f 696e 6465 7828 6472 6f70 3d54  set_index(drop=T
-000174c0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-000174d0: 2020 2020 2073 656c 662e 5f6b 6c69 6e65       self._kline
-000174e0: 735b 2870 6169 722c 2074 696d 6566 7261  s[(pair, timefra
-000174f0: 6d65 2c20 635f 7479 7065 295d 203d 206f  me, c_type)] = o
-00017500: 686c 6376 5f64 660a 2020 2020 2020 2020  hlcv_df.        
-00017510: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00017520: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00017530: 6b6c 696e 6573 5b28 7061 6972 2c20 7469  klines[(pair, ti
-00017540: 6d65 6672 616d 652c 2063 5f74 7970 6529  meframe, c_type)
-00017550: 5d20 3d20 6f68 6c63 765f 6466 0a20 2020  ] = ohlcv_df.   
-00017560: 2020 2020 2072 6574 7572 6e20 6f68 6c63       return ohlc
-00017570: 765f 6466 0a0a 2020 2020 6465 6620 7265  v_df..    def re
-00017580: 6672 6573 685f 6c61 7465 7374 5f6f 686c  fresh_latest_ohl
-00017590: 6376 2873 656c 662c 2070 6169 725f 6c69  cv(self, pair_li
-000175a0: 7374 3a20 4c69 7374 5061 6972 7357 6974  st: ListPairsWit
-000175b0: 6854 696d 6566 7261 6d65 732c 202a 2c0a  hTimeframes, *,.
-000175c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175d0: 2020 2020 2020 2020 2020 2020 2073 696e               sin
-000175e0: 6365 5f6d 733a 204f 7074 696f 6e61 6c5b  ce_ms: Optional[
-000175f0: 696e 745d 203d 204e 6f6e 652c 2063 6163  int] = None, cac
-00017600: 6865 3a20 626f 6f6c 203d 2054 7275 652c  he: bool = True,
+000161f0: 2020 2020 2072 6169 7365 0a20 2020 2020       raise.     
+00016200: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00016210: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00016220: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00016230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016240: 2020 2320 4465 636f 6e73 7472 7563 7420    # Deconstruct 
+00016250: 7475 706c 6520 6966 2069 7427 7320 6e6f  tuple if it's no
+00016260: 7420 616e 2065 7863 6570 7469 6f6e 0a20  t an exception. 
+00016270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016280: 2020 2070 2c20 5f2c 2063 2c20 6e65 775f     p, _, c, new_
+00016290: 6461 7461 2c20 5f20 3d20 7265 730a 2020  data, _ = res.  
+000162a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000162b0: 2020 6966 2070 203d 3d20 7061 6972 2061    if p == pair a
+000162c0: 6e64 2063 203d 3d20 6361 6e64 6c65 5f74  nd c == candle_t
+000162d0: 7970 653a 0a20 2020 2020 2020 2020 2020  ype:.           
+000162e0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+000162f0: 612e 6578 7465 6e64 286e 6577 5f64 6174  a.extend(new_dat
+00016300: 6129 0a20 2020 2020 2020 2023 2053 6f72  a).        # Sor
+00016310: 7420 6461 7461 2061 6761 696e 2061 6674  t data again aft
+00016320: 6572 2065 7874 656e 6469 6e67 2074 6865  er extending the
+00016330: 2072 6573 756c 7420 2d20 6162 6f76 6520   result - above 
+00016340: 6361 6c6c 7320 7265 7475 726e 2069 6e20  calls return in 
+00016350: 2261 7379 6e63 206f 7264 6572 220a 2020  "async order".  
+00016360: 2020 2020 2020 6461 7461 203d 2073 6f72        data = sor
+00016370: 7465 6428 6461 7461 2c20 6b65 793d 6c61  ted(data, key=la
+00016380: 6d62 6461 2078 3a20 785b 305d 290a 2020  mbda x: x[0]).  
+00016390: 2020 2020 2020 7265 7475 726e 2070 6169        return pai
+000163a0: 722c 2074 696d 6566 7261 6d65 2c20 6361  r, timeframe, ca
+000163b0: 6e64 6c65 5f74 7970 652c 2064 6174 612c  ndle_type, data,
+000163c0: 2073 656c 662e 5f6f 686c 6376 5f70 6172   self._ohlcv_par
+000163d0: 7469 616c 5f63 616e 646c 650a 0a20 2020  tial_candle..   
+000163e0: 2064 6566 205f 6275 696c 645f 636f 726f   def _build_coro
+000163f0: 7574 696e 6528 0a20 2020 2020 2020 2020  utine(.         
+00016400: 2020 2073 656c 662c 2070 6169 723a 2073     self, pair: s
+00016410: 7472 2c20 7469 6d65 6672 616d 653a 2073  tr, timeframe: s
+00016420: 7472 2c20 6361 6e64 6c65 5f74 7970 653a  tr, candle_type:
+00016430: 2043 616e 646c 6554 7970 652c 0a20 2020   CandleType,.   
+00016440: 2020 2020 2020 2020 2073 696e 6365 5f6d           since_m
+00016450: 733a 204f 7074 696f 6e61 6c5b 696e 745d  s: Optional[int]
+00016460: 2c20 6361 6368 653a 2062 6f6f 6c29 202d  , cache: bool) -
+00016470: 3e20 436f 726f 7574 696e 655b 416e 792c  > Coroutine[Any,
+00016480: 2041 6e79 2c20 4f48 4c43 5652 6573 706f   Any, OHLCVRespo
+00016490: 6e73 655d 3a0a 2020 2020 2020 2020 6e6f  nse]:.        no
+000164a0: 745f 616c 6c5f 6461 7461 203d 2063 6163  t_all_data = cac
+000164b0: 6865 2061 6e64 2073 656c 662e 7265 7175  he and self.requ
+000164c0: 6972 6564 5f63 616e 646c 655f 6361 6c6c  ired_candle_call
+000164d0: 5f63 6f75 6e74 203e 2031 0a20 2020 2020  _count > 1.     
+000164e0: 2020 2069 6620 6361 6368 6520 616e 6420     if cache and 
+000164f0: 2870 6169 722c 2074 696d 6566 7261 6d65  (pair, timeframe
+00016500: 2c20 6361 6e64 6c65 5f74 7970 6529 2069  , candle_type) i
+00016510: 6e20 7365 6c66 2e5f 6b6c 696e 6573 3a0a  n self._klines:.
+00016520: 2020 2020 2020 2020 2020 2020 6361 6e64              cand
+00016530: 6c65 5f6c 696d 6974 203d 2073 656c 662e  le_limit = self.
+00016540: 6f68 6c63 765f 6361 6e64 6c65 5f6c 696d  ohlcv_candle_lim
+00016550: 6974 2874 696d 6566 7261 6d65 2c20 6361  it(timeframe, ca
+00016560: 6e64 6c65 5f74 7970 6529 0a20 2020 2020  ndle_type).     
+00016570: 2020 2020 2020 206d 696e 5f64 6174 6520         min_date 
+00016580: 3d20 6461 7465 5f6d 696e 7573 5f63 616e  = date_minus_can
+00016590: 646c 6573 2874 696d 6566 7261 6d65 2c20  dles(timeframe, 
+000165a0: 6361 6e64 6c65 5f6c 696d 6974 202d 2035  candle_limit - 5
+000165b0: 292e 7469 6d65 7374 616d 7028 290a 2020  ).timestamp().  
+000165c0: 2020 2020 2020 2020 2020 2320 4368 6563            # Chec
+000165d0: 6b20 6966 2031 2063 616c 6c20 6361 6e20  k if 1 call can 
+000165e0: 6765 7420 7573 2075 7064 6174 6564 2063  get us updated c
+000165f0: 616e 646c 6573 2077 6974 686f 7574 2068  andles without h
+00016600: 6f6c 6520 696e 2074 6865 2064 6174 612e  ole in the data.
+00016610: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00016620: 6d69 6e5f 6461 7465 203c 2073 656c 662e  min_date < self.
+00016630: 5f70 6169 7273 5f6c 6173 745f 7265 6672  _pairs_last_refr
+00016640: 6573 685f 7469 6d65 2e67 6574 2828 7061  esh_time.get((pa
+00016650: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
+00016660: 616e 646c 655f 7479 7065 292c 2030 293a  andle_type), 0):
+00016670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016680: 2023 2043 6163 6865 2063 616e 2062 6520   # Cache can be 
+00016690: 7573 6564 202d 2064 6f20 6f6e 652d 6f66  used - do one-of
+000166a0: 6620 6361 6c6c 2e0a 2020 2020 2020 2020  f call..        
+000166b0: 2020 2020 2020 2020 6e6f 745f 616c 6c5f          not_all_
+000166c0: 6461 7461 203d 2046 616c 7365 0a20 2020  data = False.   
+000166d0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000166e0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+000166f0: 2054 696d 6520 6a75 6d70 2064 6574 6563   Time jump detec
+00016700: 7465 642c 2065 7669 6374 2063 6163 6865  ted, evict cache
+00016710: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016720: 206c 6f67 6765 722e 696e 666f 280a 2020   logger.info(.  
+00016730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016740: 2020 6622 5469 6d65 206a 756d 7020 6465    f"Time jump de
+00016750: 7465 6374 6564 2e20 4576 6963 7469 6e67  tected. Evicting
+00016760: 2063 6163 6865 2066 6f72 207b 7061 6972   cache for {pair
+00016770: 7d2c 207b 7469 6d65 6672 616d 657d 2c20  }, {timeframe}, 
+00016780: 7b63 616e 646c 655f 7479 7065 7d22 290a  {candle_type}").
+00016790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000167a0: 6465 6c20 7365 6c66 2e5f 6b6c 696e 6573  del self._klines
+000167b0: 5b28 7061 6972 2c20 7469 6d65 6672 616d  [(pair, timefram
+000167c0: 652c 2063 616e 646c 655f 7479 7065 295d  e, candle_type)]
+000167d0: 0a0a 2020 2020 2020 2020 6966 2028 6e6f  ..        if (no
+000167e0: 7420 7369 6e63 655f 6d73 2061 6e64 2028  t since_ms and (
+000167f0: 7365 6c66 2e5f 6674 5f68 6173 5b22 6f68  self._ft_has["oh
+00016800: 6c63 765f 7265 7175 6972 655f 7369 6e63  lcv_require_sinc
+00016810: 6522 5d20 6f72 206e 6f74 5f61 6c6c 5f64  e"] or not_all_d
+00016820: 6174 6129 293a 0a20 2020 2020 2020 2020  ata)):.         
+00016830: 2020 2023 204d 756c 7469 706c 6520 6361     # Multiple ca
+00016840: 6c6c 7320 666f 7220 6f6e 6520 7061 6972  lls for one pair
+00016850: 202d 2074 6f20 6765 7420 6d6f 7265 2068   - to get more h
+00016860: 6973 746f 7279 0a20 2020 2020 2020 2020  istory.         
+00016870: 2020 206f 6e65 5f63 616c 6c20 3d20 7469     one_call = ti
+00016880: 6d65 6672 616d 655f 746f 5f6d 7365 6373  meframe_to_msecs
+00016890: 2874 696d 6566 7261 6d65 2920 2a20 7365  (timeframe) * se
+000168a0: 6c66 2e6f 686c 6376 5f63 616e 646c 655f  lf.ohlcv_candle_
+000168b0: 6c69 6d69 7428 0a20 2020 2020 2020 2020  limit(.         
+000168c0: 2020 2020 2020 2074 696d 6566 7261 6d65         timeframe
+000168d0: 2c20 6361 6e64 6c65 5f74 7970 652c 2073  , candle_type, s
+000168e0: 696e 6365 5f6d 7329 0a20 2020 2020 2020  ince_ms).       
+000168f0: 2020 2020 206d 6f76 655f 746f 203d 206f       move_to = o
+00016900: 6e65 5f63 616c 6c20 2a20 7365 6c66 2e72  ne_call * self.r
+00016910: 6571 7569 7265 645f 6361 6e64 6c65 5f63  equired_candle_c
+00016920: 616c 6c5f 636f 756e 740a 2020 2020 2020  all_count.      
+00016930: 2020 2020 2020 6e6f 7720 3d20 7469 6d65        now = time
+00016940: 6672 616d 655f 746f 5f6e 6578 745f 6461  frame_to_next_da
+00016950: 7465 2874 696d 6566 7261 6d65 290a 2020  te(timeframe).  
+00016960: 2020 2020 2020 2020 2020 7369 6e63 655f            since_
+00016970: 6d73 203d 2064 745f 7473 286e 6f77 202d  ms = dt_ts(now -
+00016980: 2074 696d 6564 656c 7461 2873 6563 6f6e   timedelta(secon
+00016990: 6473 3d6d 6f76 655f 746f 202f 2f20 3130  ds=move_to // 10
+000169a0: 3030 2929 0a0a 2020 2020 2020 2020 6966  00))..        if
+000169b0: 2073 696e 6365 5f6d 733a 0a20 2020 2020   since_ms:.     
+000169c0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000169d0: 6c66 2e5f 6173 796e 635f 6765 745f 6869  lf._async_get_hi
+000169e0: 7374 6f72 6963 5f6f 686c 6376 280a 2020  storic_ohlcv(.  
+000169f0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+00016a00: 6972 2c20 7469 6d65 6672 616d 652c 2073  ir, timeframe, s
+00016a10: 696e 6365 5f6d 733d 7369 6e63 655f 6d73  ince_ms=since_ms
+00016a20: 2c20 7261 6973 655f 3d54 7275 652c 2063  , raise_=True, c
+00016a30: 616e 646c 655f 7479 7065 3d63 616e 646c  andle_type=candl
+00016a40: 655f 7479 7065 290a 2020 2020 2020 2020  e_type).        
+00016a50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00016a60: 2020 2320 4f6e 6520 6361 6c6c 202e 2e2e    # One call ...
+00016a70: 2022 7265 6775 6c61 7222 2072 6566 7265   "regular" refre
+00016a80: 7368 0a20 2020 2020 2020 2020 2020 2072  sh.            r
+00016a90: 6574 7572 6e20 7365 6c66 2e5f 6173 796e  eturn self._asyn
+00016aa0: 635f 6765 745f 6361 6e64 6c65 5f68 6973  c_get_candle_his
+00016ab0: 746f 7279 280a 2020 2020 2020 2020 2020  tory(.          
+00016ac0: 2020 2020 2020 7061 6972 2c20 7469 6d65        pair, time
+00016ad0: 6672 616d 652c 2073 696e 6365 5f6d 733d  frame, since_ms=
+00016ae0: 7369 6e63 655f 6d73 2c20 6361 6e64 6c65  since_ms, candle
+00016af0: 5f74 7970 653d 6361 6e64 6c65 5f74 7970  _type=candle_typ
+00016b00: 6529 0a0a 2020 2020 6465 6620 5f62 7569  e)..    def _bui
+00016b10: 6c64 5f6f 686c 6376 5f64 6c5f 6a6f 6273  ld_ohlcv_dl_jobs
+00016b20: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00016b30: 6c66 2c20 7061 6972 5f6c 6973 743a 204c  lf, pair_list: L
+00016b40: 6973 7450 6169 7273 5769 7468 5469 6d65  istPairsWithTime
+00016b50: 6672 616d 6573 2c20 7369 6e63 655f 6d73  frames, since_ms
+00016b60: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d2c  : Optional[int],
+00016b70: 0a20 2020 2020 2020 2020 2020 2063 6163  .            cac
+00016b80: 6865 3a20 626f 6f6c 2920 2d3e 2054 7570  he: bool) -> Tup
+00016b90: 6c65 5b4c 6973 745b 436f 726f 7574 696e  le[List[Coroutin
+00016ba0: 655d 2c20 4c69 7374 5b54 7570 6c65 5b73  e], List[Tuple[s
+00016bb0: 7472 2c20 7374 722c 2043 616e 646c 6554  tr, str, CandleT
+00016bc0: 7970 655d 5d5d 3a0a 2020 2020 2020 2020  ype]]]:.        
+00016bd0: 2222 220a 2020 2020 2020 2020 4275 696c  """.        Buil
+00016be0: 6420 436f 726f 7574 696e 6573 2074 6f20  d Coroutines to 
+00016bf0: 6578 6563 7574 6520 6173 2070 6172 7420  execute as part 
+00016c00: 6f66 2072 6566 7265 7368 5f6c 6174 6573  of refresh_lates
+00016c10: 745f 6f68 6c63 760a 2020 2020 2020 2020  t_ohlcv.        
+00016c20: 2222 220a 2020 2020 2020 2020 696e 7075  """.        inpu
+00016c30: 745f 636f 726f 7574 696e 6573 3a20 4c69  t_coroutines: Li
+00016c40: 7374 5b43 6f72 6f75 7469 6e65 5b41 6e79  st[Coroutine[Any
+00016c50: 2c20 416e 792c 204f 484c 4356 5265 7370  , Any, OHLCVResp
+00016c60: 6f6e 7365 5d5d 203d 205b 5d0a 2020 2020  onse]] = [].    
+00016c70: 2020 2020 6361 6368 6564 5f70 6169 7273      cached_pairs
+00016c80: 203d 205b 5d0a 2020 2020 2020 2020 666f   = [].        fo
+00016c90: 7220 7061 6972 2c20 7469 6d65 6672 616d  r pair, timefram
+00016ca0: 652c 2063 616e 646c 655f 7479 7065 2069  e, candle_type i
+00016cb0: 6e20 7365 7428 7061 6972 5f6c 6973 7429  n set(pair_list)
+00016cc0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00016cd0: 2028 7469 6d65 6672 616d 6520 6e6f 7420   (timeframe not 
+00016ce0: 696e 2073 656c 662e 7469 6d65 6672 616d  in self.timefram
+00016cf0: 6573 0a20 2020 2020 2020 2020 2020 2020  es.             
+00016d00: 2020 2020 2020 2061 6e64 2063 616e 646c         and candl
+00016d10: 655f 7479 7065 2069 6e20 2843 616e 646c  e_type in (Candl
+00016d20: 6554 7970 652e 5350 4f54 2c20 4361 6e64  eType.SPOT, Cand
+00016d30: 6c65 5479 7065 2e46 5554 5552 4553 2929  leType.FUTURES))
+00016d40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00016d50: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
+00016d60: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00016d70: 2020 2020 2020 6622 4361 6e6e 6f74 2064        f"Cannot d
+00016d80: 6f77 6e6c 6f61 6420 287b 7061 6972 7d2c  ownload ({pair},
+00016d90: 207b 7469 6d65 6672 616d 657d 2920 636f   {timeframe}) co
+00016da0: 6d62 696e 6174 696f 6e20 6173 2074 6869  mbination as thi
+00016db0: 7320 7469 6d65 6672 616d 6520 6973 2022  s timeframe is "
+00016dc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00016dd0: 2020 2020 2066 226e 6f74 2061 7661 696c       f"not avail
+00016de0: 6162 6c65 206f 6e20 7b73 656c 662e 6e61  able on {self.na
+00016df0: 6d65 7d2e 2041 7661 696c 6162 6c65 2074  me}. Available t
+00016e00: 696d 6566 7261 6d65 7320 6172 6520 220a  imeframes are ".
+00016e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e20: 2020 2020 6622 7b27 2c20 272e 6a6f 696e      f"{', '.join
+00016e30: 2873 656c 662e 7469 6d65 6672 616d 6573  (self.timeframes
+00016e40: 297d 2e22 290a 2020 2020 2020 2020 2020  )}.").          
+00016e50: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+00016e60: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00016e70: 2870 6169 722c 2074 696d 6566 7261 6d65  (pair, timeframe
+00016e80: 2c20 6361 6e64 6c65 5f74 7970 6529 206e  , candle_type) n
+00016e90: 6f74 2069 6e20 7365 6c66 2e5f 6b6c 696e  ot in self._klin
+00016ea0: 6573 206f 7220 6e6f 7420 6361 6368 650a  es or not cache.
+00016eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ec0: 2020 2020 6f72 2073 656c 662e 5f6e 6f77      or self._now
+00016ed0: 5f69 735f 7469 6d65 5f74 6f5f 7265 6672  _is_time_to_refr
+00016ee0: 6573 6828 7061 6972 2c20 7469 6d65 6672  esh(pair, timefr
+00016ef0: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
+00016f00: 2929 3a0a 0a20 2020 2020 2020 2020 2020  )):..           
+00016f10: 2020 2020 2069 6e70 7574 5f63 6f72 6f75       input_corou
+00016f20: 7469 6e65 732e 6170 7065 6e64 280a 2020  tines.append(.  
+00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f40: 2020 7365 6c66 2e5f 6275 696c 645f 636f    self._build_co
+00016f50: 726f 7574 696e 6528 7061 6972 2c20 7469  routine(pair, ti
+00016f60: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
+00016f70: 7479 7065 2c20 7369 6e63 655f 6d73 2c20  type, since_ms, 
+00016f80: 6361 6368 6529 290a 0a20 2020 2020 2020  cache))..       
+00016f90: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00016fa0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00016fb0: 722e 6465 6275 6728 0a20 2020 2020 2020  r.debug(.       
+00016fc0: 2020 2020 2020 2020 2020 2020 2066 2255               f"U
+00016fd0: 7369 6e67 2063 6163 6865 6420 6361 6e64  sing cached cand
+00016fe0: 6c65 2028 4f48 4c43 5629 2064 6174 6120  le (OHLCV) data 
+00016ff0: 666f 7220 7b70 6169 727d 2c20 7b74 696d  for {pair}, {tim
+00017000: 6566 7261 6d65 7d2c 207b 6361 6e64 6c65  eframe}, {candle
+00017010: 5f74 7970 657d 202e 2e2e 220a 2020 2020  _type} ...".    
+00017020: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00017030: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00017040: 6368 6564 5f70 6169 7273 2e61 7070 656e  ched_pairs.appen
+00017050: 6428 2870 6169 722c 2074 696d 6566 7261  d((pair, timefra
+00017060: 6d65 2c20 6361 6e64 6c65 5f74 7970 6529  me, candle_type)
+00017070: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
+00017080: 6e20 696e 7075 745f 636f 726f 7574 696e  n input_coroutin
+00017090: 6573 2c20 6361 6368 6564 5f70 6169 7273  es, cached_pairs
+000170a0: 0a0a 2020 2020 6465 6620 5f70 726f 6365  ..    def _proce
+000170b0: 7373 5f6f 686c 6376 5f64 6628 7365 6c66  ss_ohlcv_df(self
+000170c0: 2c20 7061 6972 3a20 7374 722c 2074 696d  , pair: str, tim
+000170d0: 6566 7261 6d65 3a20 7374 722c 2063 5f74  eframe: str, c_t
+000170e0: 7970 653a 2043 616e 646c 6554 7970 652c  ype: CandleType,
+000170f0: 2074 6963 6b73 3a20 4c69 7374 5b4c 6973   ticks: List[Lis
+00017100: 745d 2c0a 2020 2020 2020 2020 2020 2020  t],.            
+00017110: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+00017120: 6368 653a 2062 6f6f 6c2c 2064 726f 705f  che: bool, drop_
+00017130: 696e 636f 6d70 6c65 7465 3a20 626f 6f6c  incomplete: bool
+00017140: 2920 2d3e 2044 6174 6146 7261 6d65 3a0a  ) -> DataFrame:.
+00017150: 2020 2020 2020 2020 2320 6b65 6570 696e          # keepin
+00017160: 6720 6c61 7374 2063 616e 646c 6520 7469  g last candle ti
+00017170: 6d65 2061 7320 6c61 7374 2072 6566 7265  me as last refre
+00017180: 7368 6564 2074 696d 6520 6f66 2074 6865  shed time of the
+00017190: 2070 6169 720a 2020 2020 2020 2020 6966   pair.        if
+000171a0: 2074 6963 6b73 2061 6e64 2063 6163 6865   ticks and cache
+000171b0: 3a0a 2020 2020 2020 2020 2020 2020 6964  :.            id
+000171c0: 7820 3d20 2d32 2069 6620 6472 6f70 5f69  x = -2 if drop_i
+000171d0: 6e63 6f6d 706c 6574 6520 616e 6420 6c65  ncomplete and le
+000171e0: 6e28 7469 636b 7329 203e 2031 2065 6c73  n(ticks) > 1 els
+000171f0: 6520 2d31 0a20 2020 2020 2020 2020 2020  e -1.           
+00017200: 2073 656c 662e 5f70 6169 7273 5f6c 6173   self._pairs_las
+00017210: 745f 7265 6672 6573 685f 7469 6d65 5b28  t_refresh_time[(
+00017220: 7061 6972 2c20 7469 6d65 6672 616d 652c  pair, timeframe,
+00017230: 2063 5f74 7970 6529 5d20 3d20 7469 636b   c_type)] = tick
+00017240: 735b 6964 785d 5b30 5d20 2f2f 2031 3030  s[idx][0] // 100
+00017250: 300a 2020 2020 2020 2020 2320 6b65 6570  0.        # keep
+00017260: 696e 6720 7061 7273 6564 2064 6174 6166  ing parsed dataf
+00017270: 7261 6d65 2069 6e20 6361 6368 650a 2020  rame in cache.  
+00017280: 2020 2020 2020 6f68 6c63 765f 6466 203d        ohlcv_df =
+00017290: 206f 686c 6376 5f74 6f5f 6461 7461 6672   ohlcv_to_datafr
+000172a0: 616d 6528 7469 636b 732c 2074 696d 6566  ame(ticks, timef
+000172b0: 7261 6d65 2c20 7061 6972 3d70 6169 722c  rame, pair=pair,
+000172c0: 2066 696c 6c5f 6d69 7373 696e 673d 5472   fill_missing=Tr
+000172d0: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
+000172e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172f0: 2020 2020 2020 2020 2020 6472 6f70 5f69            drop_i
+00017300: 6e63 6f6d 706c 6574 653d 6472 6f70 5f69  ncomplete=drop_i
+00017310: 6e63 6f6d 706c 6574 6529 0a20 2020 2020  ncomplete).     
+00017320: 2020 2069 6620 6361 6368 653a 0a20 2020     if cache:.   
+00017330: 2020 2020 2020 2020 2069 6620 2870 6169           if (pai
+00017340: 722c 2074 696d 6566 7261 6d65 2c20 635f  r, timeframe, c_
+00017350: 7479 7065 2920 696e 2073 656c 662e 5f6b  type) in self._k
+00017360: 6c69 6e65 733a 0a20 2020 2020 2020 2020  lines:.         
+00017370: 2020 2020 2020 206f 6c64 203d 2073 656c         old = sel
+00017380: 662e 5f6b 6c69 6e65 735b 2870 6169 722c  f._klines[(pair,
+00017390: 2074 696d 6566 7261 6d65 2c20 635f 7479   timeframe, c_ty
+000173a0: 7065 295d 0a20 2020 2020 2020 2020 2020  pe)].           
+000173b0: 2020 2020 2023 2052 6561 7373 6967 6e20       # Reassign 
+000173c0: 736f 2077 6520 7265 7475 726e 2074 6865  so we return the
+000173d0: 2075 7064 6174 6564 2c20 636f 6d62 696e   updated, combin
+000173e0: 6564 2064 660a 2020 2020 2020 2020 2020  ed df.          
+000173f0: 2020 2020 2020 6f68 6c63 765f 6466 203d        ohlcv_df =
+00017400: 2063 6c65 616e 5f6f 686c 6376 5f64 6174   clean_ohlcv_dat
+00017410: 6166 7261 6d65 2863 6f6e 6361 7428 5b6f  aframe(concat([o
+00017420: 6c64 2c20 6f68 6c63 765f 6466 5d2c 2061  ld, ohlcv_df], a
+00017430: 7869 733d 3029 2c20 7469 6d65 6672 616d  xis=0), timefram
+00017440: 652c 2070 6169 722c 0a20 2020 2020 2020  e, pair,.       
+00017450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017470: 2020 2020 2020 2020 2020 6669 6c6c 5f6d            fill_m
+00017480: 6973 7369 6e67 3d54 7275 652c 2064 726f  issing=True, dro
+00017490: 705f 696e 636f 6d70 6c65 7465 3d46 616c  p_incomplete=Fal
+000174a0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+000174b0: 2020 2020 6361 6e64 6c65 5f6c 696d 6974      candle_limit
+000174c0: 203d 2073 656c 662e 6f68 6c63 765f 6361   = self.ohlcv_ca
+000174d0: 6e64 6c65 5f6c 696d 6974 2874 696d 6566  ndle_limit(timef
+000174e0: 7261 6d65 2c20 7365 6c66 2e5f 636f 6e66  rame, self._conf
+000174f0: 6967 5b27 6361 6e64 6c65 5f74 7970 655f  ig['candle_type_
+00017500: 6465 6627 5d29 0a20 2020 2020 2020 2020  def']).         
+00017510: 2020 2020 2020 2023 2041 6765 206f 7574         # Age out
+00017520: 206f 6c64 2063 616e 646c 6573 0a20 2020   old candles.   
+00017530: 2020 2020 2020 2020 2020 2020 206f 686c               ohl
+00017540: 6376 5f64 6620 3d20 6f68 6c63 765f 6466  cv_df = ohlcv_df
+00017550: 2e74 6169 6c28 6361 6e64 6c65 5f6c 696d  .tail(candle_lim
+00017560: 6974 202b 2073 656c 662e 5f73 7461 7274  it + self._start
+00017570: 7570 5f63 616e 646c 655f 636f 756e 7429  up_candle_count)
+00017580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017590: 206f 686c 6376 5f64 6620 3d20 6f68 6c63   ohlcv_df = ohlc
+000175a0: 765f 6466 2e72 6573 6574 5f69 6e64 6578  v_df.reset_index
+000175b0: 2864 726f 703d 5472 7565 290a 2020 2020  (drop=True).    
+000175c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+000175d0: 2e5f 6b6c 696e 6573 5b28 7061 6972 2c20  ._klines[(pair, 
+000175e0: 7469 6d65 6672 616d 652c 2063 5f74 7970  timeframe, c_typ
+000175f0: 6529 5d20 3d20 6f68 6c63 765f 6466 0a20  e)] = ohlcv_df. 
+00017600: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
 00017610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017620: 2020 2020 2020 2020 2020 2020 2020 6472                dr
-00017630: 6f70 5f69 6e63 6f6d 706c 6574 653a 204f  op_incomplete: O
-00017640: 7074 696f 6e61 6c5b 626f 6f6c 5d20 3d20  ptional[bool] = 
-00017650: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
-00017660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017670: 2020 2920 2d3e 2044 6963 745b 5061 6972    ) -> Dict[Pair
-00017680: 5769 7468 5469 6d65 6672 616d 652c 2044  WithTimeframe, D
-00017690: 6174 6146 7261 6d65 5d3a 0a20 2020 2020  ataFrame]:.     
-000176a0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-000176b0: 6566 7265 7368 2069 6e2d 6d65 6d6f 7279  efresh in-memory
-000176c0: 204f 484c 4356 2061 7379 6e63 6872 6f6e   OHLCV asynchron
-000176d0: 6f75 736c 7920 616e 6420 7365 7420 605f  ously and set `_
-000176e0: 6b6c 696e 6573 6020 7769 7468 2074 6865  klines` with the
-000176f0: 2072 6573 756c 740a 2020 2020 2020 2020   result.        
-00017700: 4c6f 6f70 7320 6173 796e 6368 726f 6e6f  Loops asynchrono
-00017710: 7573 6c79 206f 7665 7220 7061 6972 5f6c  usly over pair_l
-00017720: 6973 7420 616e 6420 646f 776e 6c6f 6164  ist and download
-00017730: 7320 616c 6c20 7061 6972 7320 6173 796e  s all pairs asyn
-00017740: 6320 2873 656d 692d 7061 7261 6c6c 656c  c (semi-parallel
-00017750: 292e 0a20 2020 2020 2020 204f 6e6c 7920  )..        Only 
-00017760: 7573 6564 2069 6e20 7468 6520 6461 7461  used in the data
-00017770: 7072 6f76 6964 6572 2e72 6566 7265 7368  provider.refresh
-00017780: 2829 206d 6574 686f 642e 0a20 2020 2020  () method..     
-00017790: 2020 203a 7061 7261 6d20 7061 6972 5f6c     :param pair_l
-000177a0: 6973 743a 204c 6973 7420 6f66 2032 2065  ist: List of 2 e
-000177b0: 6c65 6d65 6e74 2074 7570 6c65 7320 636f  lement tuples co
-000177c0: 6e74 6169 6e69 6e67 2070 6169 722c 2069  ntaining pair, i
-000177d0: 6e74 6572 7661 6c20 746f 2072 6566 7265  nterval to refre
-000177e0: 7368 0a20 2020 2020 2020 203a 7061 7261  sh.        :para
-000177f0: 6d20 7369 6e63 655f 6d73 3a20 7469 6d65  m since_ms: time
-00017800: 2073 696e 6365 2077 6865 6e20 746f 2064   since when to d
-00017810: 6f77 6e6c 6f61 642c 2069 6e20 6d69 6c6c  ownload, in mill
-00017820: 6973 6563 6f6e 6473 0a20 2020 2020 2020  iseconds.       
-00017830: 203a 7061 7261 6d20 6361 6368 653a 2041   :param cache: A
-00017840: 7373 6967 6e20 7265 7375 6c74 2074 6f20  ssign result to 
-00017850: 5f6b 6c69 6e65 732e 2055 7365 6675 6c6c  _klines. Usefull
-00017860: 2066 6f72 206f 6e65 2d6f 6666 2064 6f77   for one-off dow
-00017870: 6e6c 6f61 6473 206c 696b 6520 666f 7220  nloads like for 
-00017880: 7061 6972 6c69 7374 730a 2020 2020 2020  pairlists.      
-00017890: 2020 3a70 6172 616d 2064 726f 705f 696e    :param drop_in
-000178a0: 636f 6d70 6c65 7465 3a20 436f 6e74 726f  complete: Contro
-000178b0: 6c20 6361 6e64 6c65 2064 726f 7070 696e  l candle droppin
-000178c0: 672e 0a20 2020 2020 2020 2020 2020 2053  g..            S
-000178d0: 7065 6369 6679 696e 6720 4e6f 6e65 2064  pecifying None d
-000178e0: 6566 6175 6c74 7320 746f 205f 6f68 6c63  efaults to _ohlc
-000178f0: 765f 7061 7274 6961 6c5f 6361 6e64 6c65  v_partial_candle
-00017900: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
-00017910: 3a20 4469 6374 206f 6620 5b7b 2870 6169  : Dict of [{(pai
-00017920: 722c 2074 696d 6566 7261 6d65 293a 2044  r, timeframe): D
-00017930: 6174 6166 7261 6d65 7d5d 0a20 2020 2020  ataframe}].     
-00017940: 2020 2022 2222 0a20 2020 2020 2020 206c     """.        l
-00017950: 6f67 6765 722e 6465 6275 6728 2252 6566  ogger.debug("Ref
-00017960: 7265 7368 696e 6720 6361 6e64 6c65 2028  reshing candle (
-00017970: 4f48 4c43 5629 2064 6174 6120 666f 7220  OHLCV) data for 
-00017980: 2564 2070 6169 7273 222c 206c 656e 2870  %d pairs", len(p
-00017990: 6169 725f 6c69 7374 2929 0a0a 2020 2020  air_list))..    
-000179a0: 2020 2020 2320 4761 7468 6572 2063 6f72      # Gather cor
-000179b0: 6f75 7469 6e65 7320 746f 2072 756e 0a20  outines to run. 
-000179c0: 2020 2020 2020 2069 6e70 7574 5f63 6f72         input_cor
-000179d0: 6f75 7469 6e65 732c 2063 6163 6865 645f  outines, cached_
-000179e0: 7061 6972 7320 3d20 7365 6c66 2e5f 6275  pairs = self._bu
-000179f0: 696c 645f 6f68 6c63 765f 646c 5f6a 6f62  ild_ohlcv_dl_job
-00017a00: 7328 7061 6972 5f6c 6973 742c 2073 696e  s(pair_list, sin
-00017a10: 6365 5f6d 732c 2063 6163 6865 290a 0a20  ce_ms, cache).. 
-00017a20: 2020 2020 2020 2072 6573 756c 7473 5f64         results_d
-00017a30: 6620 3d20 7b7d 0a20 2020 2020 2020 2023  f = {}.        #
-00017a40: 2043 6875 6e6b 2072 6571 7565 7374 7320   Chunk requests 
-00017a50: 696e 746f 2062 6174 6368 6573 206f 6620  into batches of 
-00017a60: 3130 3020 746f 2061 766f 6964 206f 7665  100 to avoid ove
-00017a70: 7277 656c 6d69 6e67 2063 6378 7420 5468  rwelming ccxt Th
-00017a80: 726f 7474 6c69 6e67 0a20 2020 2020 2020  rottling.       
-00017a90: 2066 6f72 2069 6e70 7574 5f63 6f72 6f20   for input_coro 
-00017aa0: 696e 2063 6875 6e6b 7328 696e 7075 745f  in chunks(input_
-00017ab0: 636f 726f 7574 696e 6573 2c20 3130 3029  coroutines, 100)
-00017ac0: 3a0a 2020 2020 2020 2020 2020 2020 6173  :.            as
-00017ad0: 796e 6320 6465 6620 6761 7468 6572 5f73  ync def gather_s
-00017ae0: 7475 6666 2829 3a0a 2020 2020 2020 2020  tuff():.        
-00017af0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00017b00: 7761 6974 2061 7379 6e63 696f 2e67 6174  wait asyncio.gat
-00017b10: 6865 7228 2a69 6e70 7574 5f63 6f72 6f2c  her(*input_coro,
-00017b20: 2072 6574 7572 6e5f 6578 6365 7074 696f   return_exceptio
-00017b30: 6e73 3d54 7275 6529 0a0a 2020 2020 2020  ns=True)..      
-00017b40: 2020 2020 2020 7769 7468 2073 656c 662e        with self.
-00017b50: 5f6c 6f6f 705f 6c6f 636b 3a0a 2020 2020  _loop_lock:.    
-00017b60: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-00017b70: 6c74 7320 3d20 7365 6c66 2e6c 6f6f 702e  lts = self.loop.
-00017b80: 7275 6e5f 756e 7469 6c5f 636f 6d70 6c65  run_until_comple
-00017b90: 7465 2867 6174 6865 725f 7374 7566 6628  te(gather_stuff(
-00017ba0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-00017bb0: 666f 7220 7265 7320 696e 2072 6573 756c  for res in resul
-00017bc0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-00017bd0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-00017be0: 6528 7265 732c 2045 7863 6570 7469 6f6e  e(res, Exception
-00017bf0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00017c00: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
-00017c10: 726e 696e 6728 6622 4173 796e 6320 636f  rning(f"Async co
-00017c20: 6465 2072 6169 7365 6420 616e 2065 7863  de raised an exc
-00017c30: 6570 7469 6f6e 3a20 7b72 6570 7228 7265  eption: {repr(re
-00017c40: 7329 7d22 290a 2020 2020 2020 2020 2020  s)}").          
-00017c50: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00017c60: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00017c70: 2020 2023 2044 6563 6f6e 7374 7275 6374     # Deconstruct
-00017c80: 2074 7570 6c65 2028 6861 7320 3520 656c   tuple (has 5 el
-00017c90: 656d 656e 7473 290a 2020 2020 2020 2020  ements).        
-00017ca0: 2020 2020 2020 2020 7061 6972 2c20 7469          pair, ti
-00017cb0: 6d65 6672 616d 652c 2063 5f74 7970 652c  meframe, c_type,
-00017cc0: 2074 6963 6b73 2c20 6472 6f70 5f68 696e   ticks, drop_hin
-00017cd0: 7420 3d20 7265 730a 2020 2020 2020 2020  t = res.        
-00017ce0: 2020 2020 2020 2020 6472 6f70 5f69 6e63          drop_inc
-00017cf0: 6f6d 706c 6574 655f 203d 2064 726f 705f  omplete_ = drop_
-00017d00: 6869 6e74 2069 6620 6472 6f70 5f69 6e63  hint if drop_inc
-00017d10: 6f6d 706c 6574 6520 6973 204e 6f6e 6520  omplete is None 
-00017d20: 656c 7365 2064 726f 705f 696e 636f 6d70  else drop_incomp
-00017d30: 6c65 7465 0a20 2020 2020 2020 2020 2020  lete.           
-00017d40: 2020 2020 206f 686c 6376 5f64 6620 3d20       ohlcv_df = 
-00017d50: 7365 6c66 2e5f 7072 6f63 6573 735f 6f68  self._process_oh
-00017d60: 6c63 765f 6466 280a 2020 2020 2020 2020  lcv_df(.        
-00017d70: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-00017d80: 2c20 7469 6d65 6672 616d 652c 2063 5f74  , timeframe, c_t
-00017d90: 7970 652c 2074 6963 6b73 2c20 6361 6368  ype, ticks, cach
-00017da0: 652c 2064 726f 705f 696e 636f 6d70 6c65  e, drop_incomple
-00017db0: 7465 5f29 0a0a 2020 2020 2020 2020 2020  te_)..          
-00017dc0: 2020 2020 2020 7265 7375 6c74 735f 6466        results_df
-00017dd0: 5b28 7061 6972 2c20 7469 6d65 6672 616d  [(pair, timefram
-00017de0: 652c 2063 5f74 7970 6529 5d20 3d20 6f68  e, c_type)] = oh
-00017df0: 6c63 765f 6466 0a0a 2020 2020 2020 2020  lcv_df..        
-00017e00: 2320 5265 7475 726e 2063 6163 6865 6420  # Return cached 
-00017e10: 6b6c 696e 6573 0a20 2020 2020 2020 2066  klines.        f
-00017e20: 6f72 2070 6169 722c 2074 696d 6566 7261  or pair, timefra
-00017e30: 6d65 2c20 635f 7479 7065 2069 6e20 6361  me, c_type in ca
-00017e40: 6368 6564 5f70 6169 7273 3a0a 2020 2020  ched_pairs:.    
-00017e50: 2020 2020 2020 2020 7265 7375 6c74 735f          results_
-00017e60: 6466 5b28 7061 6972 2c20 7469 6d65 6672  df[(pair, timefr
-00017e70: 616d 652c 2063 5f74 7970 6529 5d20 3d20  ame, c_type)] = 
-00017e80: 7365 6c66 2e6b 6c69 6e65 7328 0a20 2020  self.klines(.   
-00017e90: 2020 2020 2020 2020 2020 2020 2028 7061               (pa
-00017ea0: 6972 2c20 7469 6d65 6672 616d 652c 2063  ir, timeframe, c
-00017eb0: 5f74 7970 6529 2c0a 2020 2020 2020 2020  _type),.        
-00017ec0: 2020 2020 2020 2020 636f 7079 3d46 616c          copy=Fal
-00017ed0: 7365 0a20 2020 2020 2020 2020 2020 2029  se.            )
-00017ee0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-00017ef0: 2072 6573 756c 7473 5f64 660a 0a20 2020   results_df..   
-00017f00: 2064 6566 2072 6566 7265 7368 5f6f 686c   def refresh_ohl
-00017f10: 6376 5f77 6974 685f 6361 6368 6528 0a20  cv_with_cache(. 
-00017f20: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00017f30: 2020 2020 2070 6169 7273 3a20 4c69 7374       pairs: List
-00017f40: 5b50 6169 7257 6974 6854 696d 6566 7261  [PairWithTimefra
-00017f50: 6d65 5d2c 0a20 2020 2020 2020 2073 696e  me],.        sin
-00017f60: 6365 5f6d 733a 2069 6e74 0a20 2020 2029  ce_ms: int.    )
-00017f70: 202d 3e20 4469 6374 5b50 6169 7257 6974   -> Dict[PairWit
-00017f80: 6854 696d 6566 7261 6d65 2c20 4461 7461  hTimeframe, Data
-00017f90: 4672 616d 655d 3a0a 2020 2020 2020 2020  Frame]:.        
-00017fa0: 2222 220a 2020 2020 2020 2020 5265 6672  """.        Refr
-00017fb0: 6573 6820 6f68 6c63 7620 6461 7461 2066  esh ohlcv data f
-00017fc0: 6f72 2061 6c6c 2070 6169 7273 2069 6e20  or all pairs in 
-00017fd0: 6e65 6564 6564 5f70 6169 7273 2069 6620  needed_pairs if 
-00017fe0: 6e65 6365 7373 6172 792e 0a20 2020 2020  necessary..     
-00017ff0: 2020 2043 6163 6865 7320 6461 7461 2077     Caches data w
-00018000: 6974 6820 6578 7069 7269 6e67 2070 6572  ith expiring per
-00018010: 2074 696d 6566 7261 6d65 2e0a 2020 2020   timeframe..    
-00018020: 2020 2020 5368 6f75 6c64 206f 6e6c 7920      Should only 
-00018030: 6265 2075 7365 6420 666f 7220 7061 6972  be used for pair
-00018040: 6c69 7374 7320 7768 6963 6820 6e65 6564  lists which need
-00018050: 2022 6f6e 2074 696d 6522 2065 7870 6972   "on time" expir
-00018060: 6172 696f 6e2c 2061 6e64 206e 6f20 6c6f  arion, and no lo
-00018070: 6e67 6572 2063 6163 6865 2e0a 2020 2020  nger cache..    
-00018080: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00018090: 2074 696d 6566 7261 6d65 7320 3d20 7b70   timeframes = {p
-000180a0: 5b31 5d20 666f 7220 7020 696e 2070 6169  [1] for p in pai
-000180b0: 7273 7d0a 2020 2020 2020 2020 666f 7220  rs}.        for 
-000180c0: 7469 6d65 6672 616d 6520 696e 2074 696d  timeframe in tim
-000180d0: 6566 7261 6d65 733a 0a20 2020 2020 2020  eframes:.       
-000180e0: 2020 2020 2069 6620 2874 696d 6566 7261       if (timefra
-000180f0: 6d65 2c20 7369 6e63 655f 6d73 2920 6e6f  me, since_ms) no
-00018100: 7420 696e 2073 656c 662e 5f65 7870 6972  t in self._expir
-00018110: 696e 675f 6361 6e64 6c65 5f63 6163 6865  ing_candle_cache
-00018120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018130: 2020 7469 6d65 6672 616d 655f 696e 5f73    timeframe_in_s
-00018140: 6563 203d 2074 696d 6566 7261 6d65 5f74  ec = timeframe_t
-00018150: 6f5f 7365 636f 6e64 7328 7469 6d65 6672  o_seconds(timefr
-00018160: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-00018170: 2020 2020 2023 2049 6e69 7469 616c 6973       # Initialis
-00018180: 6520 6361 6368 650a 2020 2020 2020 2020  e cache.        
-00018190: 2020 2020 2020 2020 7365 6c66 2e5f 6578          self._ex
-000181a0: 7069 7269 6e67 5f63 616e 646c 655f 6361  piring_candle_ca
-000181b0: 6368 655b 2874 696d 6566 7261 6d65 2c20  che[(timeframe, 
-000181c0: 7369 6e63 655f 6d73 295d 203d 2050 6572  since_ms)] = Per
-000181d0: 696f 6469 6343 6163 6865 280a 2020 2020  iodicCache(.    
-000181e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000181f0: 7474 6c3d 7469 6d65 6672 616d 655f 696e  ttl=timeframe_in
-00018200: 5f73 6563 2c20 6d61 7873 697a 653d 3130  _sec, maxsize=10
-00018210: 3030 290a 0a20 2020 2020 2020 2023 2047  00)..        # G
-00018220: 6574 2063 616e 646c 6573 2066 726f 6d20  et candles from 
-00018230: 6361 6368 650a 2020 2020 2020 2020 6361  cache.        ca
-00018240: 6e64 6c65 7320 3d20 7b0a 2020 2020 2020  ndles = {.      
-00018250: 2020 2020 2020 633a 2073 656c 662e 5f65        c: self._e
-00018260: 7870 6972 696e 675f 6361 6e64 6c65 5f63  xpiring_candle_c
-00018270: 6163 6865 5b28 635b 315d 2c20 7369 6e63  ache[(c[1], sinc
-00018280: 655f 6d73 295d 2e67 6574 2863 2c20 4e6f  e_ms)].get(c, No
-00018290: 6e65 2920 666f 7220 6320 696e 2070 6169  ne) for c in pai
-000182a0: 7273 0a20 2020 2020 2020 2020 2020 2069  rs.            i
-000182b0: 6620 6320 696e 2073 656c 662e 5f65 7870  f c in self._exp
-000182c0: 6972 696e 675f 6361 6e64 6c65 5f63 6163  iring_candle_cac
-000182d0: 6865 5b28 635b 315d 2c20 7369 6e63 655f  he[(c[1], since_
-000182e0: 6d73 295d 0a20 2020 2020 2020 207d 0a20  ms)].        }. 
-000182f0: 2020 2020 2020 2070 6169 7273 5f74 6f5f         pairs_to_
-00018300: 646f 776e 6c6f 6164 203d 205b 7020 666f  download = [p fo
-00018310: 7220 7020 696e 2070 6169 7273 2069 6620  r p in pairs if 
-00018320: 7020 6e6f 7420 696e 2063 616e 646c 6573  p not in candles
-00018330: 5d0a 2020 2020 2020 2020 6966 2070 6169  ].        if pai
-00018340: 7273 5f74 6f5f 646f 776e 6c6f 6164 3a0a  rs_to_download:.
-00018350: 2020 2020 2020 2020 2020 2020 6361 6e64              cand
-00018360: 6c65 7320 3d20 7365 6c66 2e72 6566 7265  les = self.refre
-00018370: 7368 5f6c 6174 6573 745f 6f68 6c63 7628  sh_latest_ohlcv(
-00018380: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018390: 2070 6169 7273 5f74 6f5f 646f 776e 6c6f   pairs_to_downlo
-000183a0: 6164 2c20 7369 6e63 655f 6d73 3d73 696e  ad, since_ms=sin
-000183b0: 6365 5f6d 732c 2063 6163 6865 3d46 616c  ce_ms, cache=Fal
-000183c0: 7365 0a20 2020 2020 2020 2020 2020 2029  se.            )
-000183d0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000183e0: 2063 2c20 7661 6c20 696e 2063 616e 646c   c, val in candl
-000183f0: 6573 2e69 7465 6d73 2829 3a0a 2020 2020  es.items():.    
-00018400: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00018410: 2e5f 6578 7069 7269 6e67 5f63 616e 646c  ._expiring_candl
-00018420: 655f 6361 6368 655b 2863 5b31 5d2c 2073  e_cache[(c[1], s
-00018430: 696e 6365 5f6d 7329 5d5b 635d 203d 2076  ince_ms)][c] = v
-00018440: 616c 0a20 2020 2020 2020 2072 6574 7572  al.        retur
-00018450: 6e20 6361 6e64 6c65 730a 0a20 2020 2064  n candles..    d
-00018460: 6566 205f 6e6f 775f 6973 5f74 696d 655f  ef _now_is_time_
-00018470: 746f 5f72 6566 7265 7368 2873 656c 662c  to_refresh(self,
-00018480: 2070 6169 723a 2073 7472 2c20 7469 6d65   pair: str, time
-00018490: 6672 616d 653a 2073 7472 2c20 6361 6e64  frame: str, cand
-000184a0: 6c65 5f74 7970 653a 2043 616e 646c 6554  le_type: CandleT
-000184b0: 7970 6529 202d 3e20 626f 6f6c 3a0a 2020  ype) -> bool:.  
-000184c0: 2020 2020 2020 2320 5469 6d65 6672 616d        # Timefram
-000184d0: 6520 696e 2073 6563 6f6e 6473 0a20 2020  e in seconds.   
-000184e0: 2020 2020 2069 6e74 6572 7661 6c5f 696e       interval_in
-000184f0: 5f73 6563 203d 2074 696d 6566 7261 6d65  _sec = timeframe
-00018500: 5f74 6f5f 7365 636f 6e64 7328 7469 6d65  _to_seconds(time
-00018510: 6672 616d 6529 0a20 2020 2020 2020 2070  frame).        p
-00018520: 6c72 203d 2073 656c 662e 5f70 6169 7273  lr = self._pairs
-00018530: 5f6c 6173 745f 7265 6672 6573 685f 7469  _last_refresh_ti
-00018540: 6d65 2e67 6574 2828 7061 6972 2c20 7469  me.get((pair, ti
-00018550: 6d65 6672 616d 652c 2063 616e 646c 655f  meframe, candle_
-00018560: 7479 7065 292c 2030 2920 2b20 696e 7465  type), 0) + inte
-00018570: 7276 616c 5f69 6e5f 7365 630a 2020 2020  rval_in_sec.    
-00018580: 2020 2020 2320 6375 7272 656e 742c 6163      # current,ac
-00018590: 7469 7665 2063 616e 646c 6520 6f70 656e  tive candle open
-000185a0: 2064 6174 650a 2020 2020 2020 2020 6e6f   date.        no
-000185b0: 7720 3d20 696e 7428 7469 6d65 6672 616d  w = int(timefram
-000185c0: 655f 746f 5f70 7265 765f 6461 7465 2874  e_to_prev_date(t
-000185d0: 696d 6566 7261 6d65 292e 7469 6d65 7374  imeframe).timest
-000185e0: 616d 7028 2929 0a20 2020 2020 2020 2072  amp()).        r
-000185f0: 6574 7572 6e20 706c 7220 3c20 6e6f 770a  eturn plr < now.
-00018600: 0a20 2020 2040 7265 7472 6965 725f 6173  .    @retrier_as
-00018610: 796e 630a 2020 2020 6173 796e 6320 6465  ync.    async de
-00018620: 6620 5f61 7379 6e63 5f67 6574 5f63 616e  f _async_get_can
-00018630: 646c 655f 6869 7374 6f72 7928 0a20 2020  dle_history(.   
-00018640: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00018650: 2020 2070 6169 723a 2073 7472 2c0a 2020     pair: str,.  
-00018660: 2020 2020 2020 7469 6d65 6672 616d 653a        timeframe:
-00018670: 2073 7472 2c0a 2020 2020 2020 2020 6361   str,.        ca
-00018680: 6e64 6c65 5f74 7970 653a 2043 616e 646c  ndle_type: Candl
-00018690: 6554 7970 652c 0a20 2020 2020 2020 2073  eType,.        s
-000186a0: 696e 6365 5f6d 733a 204f 7074 696f 6e61  ince_ms: Optiona
-000186b0: 6c5b 696e 745d 203d 204e 6f6e 652c 0a20  l[int] = None,. 
-000186c0: 2020 2029 202d 3e20 4f48 4c43 5652 6573     ) -> OHLCVRes
-000186d0: 706f 6e73 653a 0a20 2020 2020 2020 2022  ponse:.        "
-000186e0: 2222 0a20 2020 2020 2020 2041 7379 6e63  "".        Async
-000186f0: 6872 6f6e 6f75 736c 7920 6765 7420 6361  hronously get ca
-00018700: 6e64 6c65 2068 6973 746f 7279 2064 6174  ndle history dat
-00018710: 6120 7573 696e 6720 6665 7463 685f 6f68  a using fetch_oh
-00018720: 6c63 760a 2020 2020 2020 2020 3a70 6172  lcv.        :par
-00018730: 616d 2063 616e 646c 655f 7479 7065 3a20  am candle_type: 
-00018740: 2727 2c20 6d61 726b 2c20 696e 6465 782c  '', mark, index,
-00018750: 2070 7265 6d69 756d 496e 6465 782c 206f   premiumIndex, o
-00018760: 7220 6675 6e64 696e 675f 7261 7465 0a20  r funding_rate. 
-00018770: 2020 2020 2020 2072 6574 7572 6e73 2074         returns t
-00018780: 7570 6c65 3a20 2870 6169 722c 2074 696d  uple: (pair, tim
-00018790: 6566 7261 6d65 2c20 6f68 6c63 765f 6c69  eframe, ohlcv_li
-000187a0: 7374 290a 2020 2020 2020 2020 2222 220a  st).        """.
-000187b0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-000187c0: 2020 2020 2020 2020 2023 2046 6574 6368           # Fetch
-000187d0: 204f 484c 4356 2061 7379 6e63 6872 6f6e   OHLCV asynchron
-000187e0: 6f75 736c 790a 2020 2020 2020 2020 2020  ously.          
-000187f0: 2020 7320 3d20 2728 2720 2b20 6474 5f66    s = '(' + dt_f
-00018800: 726f 6d5f 7473 2873 696e 6365 5f6d 7329  rom_ts(since_ms)
-00018810: 2e69 736f 666f 726d 6174 2829 202b 2027  .isoformat() + '
-00018820: 2920 2720 6966 2073 696e 6365 5f6d 7320  ) ' if since_ms 
-00018830: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-00018840: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
-00018850: 6c6f 6767 6572 2e64 6562 7567 280a 2020  logger.debug(.  
-00018860: 2020 2020 2020 2020 2020 2020 2020 2246                "F
-00018870: 6574 6368 696e 6720 7061 6972 2025 732c  etching pair %s,
-00018880: 2025 732c 2069 6e74 6572 7661 6c20 2573   %s, interval %s
-00018890: 2c20 7369 6e63 6520 2573 2025 732e 2e2e  , since %s %s...
-000188a0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-000188b0: 2020 2070 6169 722c 2063 616e 646c 655f     pair, candle_
-000188c0: 7479 7065 2c20 7469 6d65 6672 616d 652c  type, timeframe,
-000188d0: 2073 696e 6365 5f6d 732c 2073 0a20 2020   since_ms, s.   
-000188e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000188f0: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-00018900: 6465 6570 636f 7079 2873 656c 662e 5f66  deepcopy(self._f
-00018910: 745f 6861 732e 6765 7428 276f 686c 6376  t_has.get('ohlcv
-00018920: 5f70 6172 616d 7327 2c20 7b7d 2929 0a20  _params', {})). 
-00018930: 2020 2020 2020 2020 2020 2063 616e 646c             candl
-00018940: 655f 6c69 6d69 7420 3d20 7365 6c66 2e6f  e_limit = self.o
-00018950: 686c 6376 5f63 616e 646c 655f 6c69 6d69  hlcv_candle_limi
-00018960: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00018970: 2020 2074 696d 6566 7261 6d65 2c20 6361     timeframe, ca
-00018980: 6e64 6c65 5f74 7970 653d 6361 6e64 6c65  ndle_type=candle
-00018990: 5f74 7970 652c 2073 696e 6365 5f6d 733d  _type, since_ms=
-000189a0: 7369 6e63 655f 6d73 290a 0a20 2020 2020  since_ms)..     
-000189b0: 2020 2020 2020 2069 6620 6361 6e64 6c65         if candle
-000189c0: 5f74 7970 6520 616e 6420 6361 6e64 6c65  _type and candle
-000189d0: 5f74 7970 6520 213d 2043 616e 646c 6554  _type != CandleT
-000189e0: 7970 652e 5350 4f54 3a0a 2020 2020 2020  ype.SPOT:.      
-000189f0: 2020 2020 2020 2020 2020 7061 7261 6d73            params
-00018a00: 2e75 7064 6174 6528 7b27 7072 6963 6527  .update({'price'
-00018a10: 3a20 6361 6e64 6c65 5f74 7970 652e 7661  : candle_type.va
-00018a20: 6c75 657d 290a 2020 2020 2020 2020 2020  lue}).          
-00018a30: 2020 6966 2063 616e 646c 655f 7479 7065    if candle_type
-00018a40: 2021 3d20 4361 6e64 6c65 5479 7065 2e46   != CandleType.F
-00018a50: 554e 4449 4e47 5f52 4154 453a 0a20 2020  UNDING_RATE:.   
-00018a60: 2020 2020 2020 2020 2020 2020 2064 6174               dat
-00018a70: 6120 3d20 6177 6169 7420 7365 6c66 2e5f  a = await self._
-00018a80: 6170 695f 6173 796e 632e 6665 7463 685f  api_async.fetch_
-00018a90: 6f68 6c63 7628 0a20 2020 2020 2020 2020  ohlcv(.         
-00018aa0: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
-00018ab0: 2074 696d 6566 7261 6d65 3d74 696d 6566   timeframe=timef
-00018ac0: 7261 6d65 2c20 7369 6e63 653d 7369 6e63  rame, since=sinc
-00018ad0: 655f 6d73 2c0a 2020 2020 2020 2020 2020  e_ms,.          
-00018ae0: 2020 2020 2020 2020 2020 6c69 6d69 743d            limit=
-00018af0: 6361 6e64 6c65 5f6c 696d 6974 2c20 7061  candle_limit, pa
-00018b00: 7261 6d73 3d70 6172 616d 7329 0a20 2020  rams=params).   
-00018b10: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00018b20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-00018b30: 2046 756e 6469 6e67 2072 6174 650a 2020   Funding rate.  
-00018b40: 2020 2020 2020 2020 2020 2020 2020 6461                da
-00018b50: 7461 203d 2061 7761 6974 2073 656c 662e  ta = await self.
-00018b60: 5f66 6574 6368 5f66 756e 6469 6e67 5f72  _fetch_funding_r
-00018b70: 6174 655f 6869 7374 6f72 7928 0a20 2020  ate_history(.   
-00018b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018b90: 2070 6169 723d 7061 6972 2c0a 2020 2020   pair=pair,.    
-00018ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018bb0: 7469 6d65 6672 616d 653d 7469 6d65 6672  timeframe=timefr
-00018bc0: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00018bd0: 2020 2020 2020 2020 206c 696d 6974 3d63           limit=c
-00018be0: 616e 646c 655f 6c69 6d69 742c 0a20 2020  andle_limit,.   
-00018bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018c00: 2073 696e 6365 5f6d 733d 7369 6e63 655f   since_ms=since_
-00018c10: 6d73 2c0a 2020 2020 2020 2020 2020 2020  ms,.            
-00018c20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00018c30: 2020 2320 536f 6d65 2065 7863 6861 6e67    # Some exchang
-00018c40: 6573 2073 6f72 7420 4f48 4c43 5620 696e  es sort OHLCV in
-00018c50: 2041 5343 206f 7264 6572 2061 6e64 206f   ASC order and o
-00018c60: 7468 6572 7320 696e 2044 4553 432e 0a20  thers in DESC.. 
-00018c70: 2020 2020 2020 2020 2020 2023 2045 783a             # Ex:
-00018c80: 2042 6974 7472 6578 2072 6574 7572 6e73   Bittrex returns
-00018c90: 2074 6865 206c 6973 7420 6f66 204f 484c   the list of OHL
-00018ca0: 4356 2069 6e20 4153 4320 6f72 6465 7220  CV in ASC order 
-00018cb0: 286f 6c64 6573 7420 6669 7273 742c 206e  (oldest first, n
-00018cc0: 6577 6573 7420 6c61 7374 290a 2020 2020  ewest last).    
-00018cd0: 2020 2020 2020 2020 2320 7768 696c 6520          # while 
-00018ce0: 4744 4158 2072 6574 7572 6e73 2074 6865  GDAX returns the
-00018cf0: 206c 6973 7420 6f66 204f 484c 4356 2069   list of OHLCV i
-00018d00: 6e20 4445 5343 206f 7264 6572 2028 6e65  n DESC order (ne
-00018d10: 7765 7374 2066 6972 7374 2c20 6f6c 6465  west first, olde
-00018d20: 7374 206c 6173 7429 0a20 2020 2020 2020  st last).       
-00018d30: 2020 2020 2023 204f 6e6c 7920 736f 7274       # Only sort
-00018d40: 2069 6620 6e65 6365 7373 6172 7920 746f   if necessary to
-00018d50: 2073 6176 6520 636f 6d70 7574 696e 6720   save computing 
-00018d60: 7469 6d65 0a20 2020 2020 2020 2020 2020  time.           
-00018d70: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00018d80: 2020 2020 2020 6966 2064 6174 6120 616e        if data an
-00018d90: 6420 6461 7461 5b30 5d5b 305d 203e 2064  d data[0][0] > d
-00018da0: 6174 615b 2d31 5d5b 305d 3a0a 2020 2020  ata[-1][0]:.    
-00018db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018dc0: 6461 7461 203d 2073 6f72 7465 6428 6461  data = sorted(da
-00018dd0: 7461 2c20 6b65 793d 6c61 6d62 6461 2078  ta, key=lambda x
-00018de0: 3a20 785b 305d 290a 2020 2020 2020 2020  : x[0]).        
-00018df0: 2020 2020 6578 6365 7074 2049 6e64 6578      except Index
-00018e00: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
-00018e10: 2020 2020 2020 206c 6f67 6765 722e 6578         logger.ex
-00018e20: 6365 7074 696f 6e28 2245 7272 6f72 206c  ception("Error l
-00018e30: 6f61 6469 6e67 2025 732e 2052 6573 756c  oading %s. Resul
-00018e40: 7420 7761 7320 2573 2e22 2c20 7061 6972  t was %s.", pair
-00018e50: 2c20 6461 7461 290a 2020 2020 2020 2020  , data).        
-00018e60: 2020 2020 2020 2020 7265 7475 726e 2070          return p
-00018e70: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
-00018e80: 6361 6e64 6c65 5f74 7970 652c 205b 5d2c  candle_type, [],
-00018e90: 2073 656c 662e 5f6f 686c 6376 5f70 6172   self._ohlcv_par
-00018ea0: 7469 616c 5f63 616e 646c 650a 2020 2020  tial_candle.    
-00018eb0: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
-00018ec0: 6562 7567 2822 446f 6e65 2066 6574 6368  ebug("Done fetch
-00018ed0: 696e 6720 7061 6972 2025 732c 2025 7320  ing pair %s, %s 
-00018ee0: 696e 7465 7276 616c 2025 732e 2e2e 222c  interval %s...",
-00018ef0: 2070 6169 722c 2063 616e 646c 655f 7479   pair, candle_ty
-00018f00: 7065 2c20 7469 6d65 6672 616d 6529 0a20  pe, timeframe). 
-00018f10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00018f20: 6e20 7061 6972 2c20 7469 6d65 6672 616d  n pair, timefram
-00018f30: 652c 2063 616e 646c 655f 7479 7065 2c20  e, candle_type, 
-00018f40: 6461 7461 2c20 7365 6c66 2e5f 6f68 6c63  data, self._ohlc
-00018f50: 765f 7061 7274 6961 6c5f 6361 6e64 6c65  v_partial_candle
-00018f60: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-00018f70: 2063 6378 742e 4e6f 7453 7570 706f 7274   ccxt.NotSupport
-00018f80: 6564 2061 7320 653a 0a20 2020 2020 2020  ed as e:.       
-00018f90: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-00018fa0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-00018fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018fc0: 2066 2745 7863 6861 6e67 6520 7b73 656c   f'Exchange {sel
-00018fd0: 662e 5f61 7069 2e6e 616d 657d 2064 6f65  f._api.name} doe
-00018fe0: 7320 6e6f 7420 7375 7070 6f72 7420 6665  s not support fe
-00018ff0: 7463 6869 6e67 2068 6973 746f 7269 6361  tching historica
-00019000: 6c20 270a 2020 2020 2020 2020 2020 2020  l '.            
-00019010: 2020 2020 6627 6361 6e64 6c65 2028 4f48      f'candle (OH
-00019020: 4c43 5629 2064 6174 612e 204d 6573 7361  LCV) data. Messa
-00019030: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
-00019040: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00019050: 6363 7874 2e44 446f 5350 726f 7465 6374  ccxt.DDoSProtect
-00019060: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
-00019070: 2020 2020 2020 7261 6973 6520 4444 6f73        raise DDos
-00019080: 5072 6f74 6563 7469 6f6e 2865 2920 6672  Protection(e) fr
-00019090: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
-000190a0: 6570 7420 2863 6378 742e 4e65 7477 6f72  ept (ccxt.Networ
-000190b0: 6b45 7272 6f72 2c20 6363 7874 2e45 7863  kError, ccxt.Exc
-000190c0: 6861 6e67 6545 7272 6f72 2920 6173 2065  hangeError) as e
-000190d0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-000190e0: 6973 6520 5465 6d70 6f72 6172 7945 7272  ise TemporaryErr
-000190f0: 6f72 2866 2743 6f75 6c64 206e 6f74 2066  or(f'Could not f
-00019100: 6574 6368 2068 6973 746f 7269 6361 6c20  etch historical 
-00019110: 6361 6e64 6c65 2028 4f48 4c43 5629 2064  candle (OHLCV) d
-00019120: 6174 6120 270a 2020 2020 2020 2020 2020  ata '.          
-00019130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019140: 2020 2020 2020 2066 2766 6f72 2070 6169         f'for pai
-00019150: 7220 7b70 6169 727d 2064 7565 2074 6f20  r {pair} due to 
-00019160: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
-00019170: 616d 655f 5f7d 2e20 270a 2020 2020 2020  ame__}. '.      
-00019180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019190: 2020 2020 2020 2020 2020 2066 274d 6573             f'Mes
-000191a0: 7361 6765 3a20 7b65 7d27 2920 6672 6f6d  sage: {e}') from
-000191b0: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
-000191c0: 7420 6363 7874 2e42 6173 6545 7272 6f72  t ccxt.BaseError
-000191d0: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-000191e0: 2020 2072 6169 7365 204f 7065 7261 7469     raise Operati
-000191f0: 6f6e 616c 4578 6365 7074 696f 6e28 6627  onalException(f'
-00019200: 436f 756c 6420 6e6f 7420 6665 7463 6820  Could not fetch 
-00019210: 6869 7374 6f72 6963 616c 2063 616e 646c  historical candl
-00019220: 6520 284f 484c 4356 2920 6461 7461 2027  e (OHLCV) data '
-00019230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019250: 2020 2020 2020 2020 6627 666f 7220 7061          f'for pa
-00019260: 6972 207b 7061 6972 7d2e 204d 6573 7361  ir {pair}. Messa
-00019270: 6765 3a20 7b65 7d27 2920 6672 6f6d 2065  ge: {e}') from e
-00019280: 0a0a 2020 2020 6173 796e 6320 6465 6620  ..    async def 
-00019290: 5f66 6574 6368 5f66 756e 6469 6e67 5f72  _fetch_funding_r
-000192a0: 6174 655f 6869 7374 6f72 7928 0a20 2020  ate_history(.   
-000192b0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000192c0: 2020 2070 6169 723a 2073 7472 2c0a 2020     pair: str,.  
-000192d0: 2020 2020 2020 7469 6d65 6672 616d 653a        timeframe:
-000192e0: 2073 7472 2c0a 2020 2020 2020 2020 6c69   str,.        li
-000192f0: 6d69 743a 2069 6e74 2c0a 2020 2020 2020  mit: int,.      
-00019300: 2020 7369 6e63 655f 6d73 3a20 4f70 7469    since_ms: Opti
-00019310: 6f6e 616c 5b69 6e74 5d20 3d20 4e6f 6e65  onal[int] = None
-00019320: 2c0a 2020 2020 2920 2d3e 204c 6973 745b  ,.    ) -> List[
-00019330: 4c69 7374 5d3a 0a20 2020 2020 2020 2022  List]:.        "
-00019340: 2222 0a20 2020 2020 2020 2046 6574 6368  "".        Fetch
-00019350: 2066 756e 6469 6e67 2072 6174 6520 6869   funding rate hi
-00019360: 7374 6f72 7920 2d20 7573 6564 2074 6f20  story - used to 
-00019370: 7365 6c65 6374 6976 656c 7920 6f76 6572  selectively over
-00019380: 7269 6465 2074 6869 7320 6279 2073 7562  ride this by sub
-00019390: 636c 6173 7365 732e 0a20 2020 2020 2020  classes..       
-000193a0: 2022 2222 0a20 2020 2020 2020 2023 2046   """.        # F
-000193b0: 756e 6469 6e67 2072 6174 650a 2020 2020  unding rate.    
-000193c0: 2020 2020 6461 7461 203d 2061 7761 6974      data = await
-000193d0: 2073 656c 662e 5f61 7069 5f61 7379 6e63   self._api_async
-000193e0: 2e66 6574 6368 5f66 756e 6469 6e67 5f72  .fetch_funding_r
-000193f0: 6174 655f 6869 7374 6f72 7928 0a20 2020  ate_history(.   
-00019400: 2020 2020 2020 2020 2070 6169 722c 2073           pair, s
-00019410: 696e 6365 3d73 696e 6365 5f6d 732c 0a20  ince=since_ms,. 
-00019420: 2020 2020 2020 2020 2020 206c 696d 6974             limit
-00019430: 3d6c 696d 6974 290a 2020 2020 2020 2020  =limit).        
-00019440: 2320 436f 6e76 6572 7420 6675 6e64 696e  # Convert fundin
-00019450: 6720 7261 7465 2074 6f20 6361 6e64 6c65  g rate to candle
-00019460: 2070 6174 7465 726e 0a20 2020 2020 2020   pattern.       
-00019470: 2064 6174 6120 3d20 5b5b 785b 2774 696d   data = [[x['tim
-00019480: 6573 7461 6d70 275d 2c20 785b 2766 756e  estamp'], x['fun
-00019490: 6469 6e67 5261 7465 275d 2c20 302c 2030  dingRate'], 0, 0
-000194a0: 2c20 302c 2030 5d20 666f 7220 7820 696e  , 0, 0] for x in
-000194b0: 2064 6174 615d 0a20 2020 2020 2020 2072   data].        r
-000194c0: 6574 7572 6e20 6461 7461 0a0a 2020 2020  eturn data..    
-000194d0: 2320 4665 7463 6820 6869 7374 6f72 6963  # Fetch historic
-000194e0: 2074 7261 6465 730a 0a20 2020 2040 7265   trades..    @re
-000194f0: 7472 6965 725f 6173 796e 630a 2020 2020  trier_async.    
-00019500: 6173 796e 6320 6465 6620 5f61 7379 6e63  async def _async
-00019510: 5f66 6574 6368 5f74 7261 6465 7328 7365  _fetch_trades(se
-00019520: 6c66 2c20 7061 6972 3a20 7374 722c 0a20  lf, pair: str,. 
-00019530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019550: 2073 696e 6365 3a20 4f70 7469 6f6e 616c   since: Optional
-00019560: 5b69 6e74 5d20 3d20 4e6f 6e65 2c0a 2020  [int] = None,.  
-00019570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019580: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019590: 7061 7261 6d73 3a20 4f70 7469 6f6e 616c  params: Optional
-000195a0: 5b64 6963 745d 203d 204e 6f6e 6529 202d  [dict] = None) -
-000195b0: 3e20 5475 706c 655b 4c69 7374 5b4c 6973  > Tuple[List[Lis
-000195c0: 745d 2c20 416e 795d 3a0a 2020 2020 2020  t], Any]:.      
-000195d0: 2020 2222 220a 2020 2020 2020 2020 4173    """.        As
-000195e0: 796e 6372 6f6e 6f75 736c 7920 6765 7473  yncronously gets
-000195f0: 2074 7261 6465 2068 6973 746f 7279 2075   trade history u
-00019600: 7369 6e67 2066 6574 6368 5f74 7261 6465  sing fetch_trade
-00019610: 732e 0a20 2020 2020 2020 2048 616e 646c  s..        Handl
-00019620: 6573 2065 7863 6861 6e67 6520 6572 726f  es exchange erro
-00019630: 7273 2c20 646f 6573 206f 6e65 2063 616c  rs, does one cal
-00019640: 6c20 746f 2074 6865 2065 7863 6861 6e67  l to the exchang
-00019650: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-00019660: 6d20 7061 6972 3a20 5061 6972 2074 6f20  m pair: Pair to 
-00019670: 6665 7463 6820 7472 6164 6520 6461 7461  fetch trade data
-00019680: 2066 6f72 0a20 2020 2020 2020 203a 7061   for.        :pa
-00019690: 7261 6d20 7369 6e63 653a 2053 696e 6365  ram since: Since
-000196a0: 2061 7320 696e 7465 6765 7220 7469 6d65   as integer time
-000196b0: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
-000196c0: 636f 6e64 730a 2020 2020 2020 2020 7265  conds.        re
-000196d0: 7475 726e 733a 204c 6973 7420 6f66 2064  turns: List of d
-000196e0: 6963 7473 2063 6f6e 7461 696e 696e 6720  icts containing 
-000196f0: 7472 6164 6573 2c20 7468 6520 6e65 7874  trades, the next
-00019700: 2069 7465 7261 7469 6f6e 2076 616c 7565   iteration value
-00019710: 2028 6e65 7720 2273 696e 6365 2220 6f72   (new "since" or
-00019720: 2074 7261 6465 5f69 6429 0a20 2020 2020   trade_id).     
-00019730: 2020 2022 2222 0a20 2020 2020 2020 2074     """.        t
-00019740: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00019750: 2320 6665 7463 6820 7472 6164 6573 2061  # fetch trades a
-00019760: 7379 6e63 6872 6f6e 6f75 736c 790a 2020  synchronously.  
-00019770: 2020 2020 2020 2020 2020 6966 2070 6172            if par
-00019780: 616d 733a 0a20 2020 2020 2020 2020 2020  ams:.           
-00019790: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
-000197a0: 6728 2246 6574 6368 696e 6720 7472 6164  g("Fetching trad
-000197b0: 6573 2066 6f72 2070 6169 7220 2573 2c20  es for pair %s, 
-000197c0: 7061 7261 6d73 3a20 2573 2022 2c20 7061  params: %s ", pa
-000197d0: 6972 2c20 7061 7261 6d73 290a 2020 2020  ir, params).    
-000197e0: 2020 2020 2020 2020 2020 2020 7472 6164              trad
-000197f0: 6573 203d 2061 7761 6974 2073 656c 662e  es = await self.
-00019800: 5f61 7069 5f61 7379 6e63 2e66 6574 6368  _api_async.fetch
-00019810: 5f74 7261 6465 7328 7061 6972 2c20 7061  _trades(pair, pa
-00019820: 7261 6d73 3d70 6172 616d 732c 206c 696d  rams=params, lim
-00019830: 6974 3d31 3030 3029 0a20 2020 2020 2020  it=1000).       
-00019840: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00019850: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00019860: 722e 6465 6275 6728 0a20 2020 2020 2020  r.debug(.       
-00019870: 2020 2020 2020 2020 2020 2020 2022 4665               "Fe
-00019880: 7463 6869 6e67 2074 7261 6465 7320 666f  tching trades fo
-00019890: 7220 7061 6972 2025 732c 2073 696e 6365  r pair %s, since
-000198a0: 2025 7320 2573 2e2e 2e22 2c0a 2020 2020   %s %s...",.    
-000198b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198c0: 7061 6972 2c20 7369 6e63 652c 0a20 2020  pair, since,.   
-000198d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000198e0: 2027 2827 202b 2064 745f 6672 6f6d 5f74   '(' + dt_from_t
-000198f0: 7328 7369 6e63 6529 2e69 736f 666f 726d  s(since).isoform
-00019900: 6174 2829 202b 2027 2920 2720 6966 2073  at() + ') ' if s
-00019910: 696e 6365 2069 7320 6e6f 7420 4e6f 6e65  ince is not None
-00019920: 2065 6c73 6520 2727 0a20 2020 2020 2020   else ''.       
-00019930: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00019940: 2020 2020 2020 2020 2020 2074 7261 6465             trade
-00019950: 7320 3d20 6177 6169 7420 7365 6c66 2e5f  s = await self._
-00019960: 6170 695f 6173 796e 632e 6665 7463 685f  api_async.fetch_
-00019970: 7472 6164 6573 2870 6169 722c 2073 696e  trades(pair, sin
-00019980: 6365 3d73 696e 6365 2c20 6c69 6d69 743d  ce=since, limit=
-00019990: 3130 3030 290a 2020 2020 2020 2020 2020  1000).          
-000199a0: 2020 7472 6164 6573 203d 2073 656c 662e    trades = self.
-000199b0: 5f74 7261 6465 735f 636f 6e74 7261 6374  _trades_contract
-000199c0: 735f 746f 5f61 6d6f 756e 7428 7472 6164  s_to_amount(trad
-000199d0: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-000199e0: 7061 6769 6e61 7469 6f6e 5f76 616c 7565  pagination_value
-000199f0: 203d 2073 656c 662e 5f67 6574 5f74 7261   = self._get_tra
-00019a00: 6465 5f70 6167 696e 6174 696f 6e5f 6e65  de_pagination_ne
-00019a10: 7874 5f76 616c 7565 2874 7261 6465 7329  xt_value(trades)
-00019a20: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00019a30: 7572 6e20 7472 6164 6573 5f64 6963 745f  urn trades_dict_
-00019a40: 746f 5f6c 6973 7428 7472 6164 6573 292c  to_list(trades),
-00019a50: 2070 6167 696e 6174 696f 6e5f 7661 6c75   pagination_valu
-00019a60: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00019a70: 2063 6378 742e 4e6f 7453 7570 706f 7274   ccxt.NotSupport
-00019a80: 6564 2061 7320 653a 0a20 2020 2020 2020  ed as e:.       
-00019a90: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-00019aa0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-00019ab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019ac0: 2066 2745 7863 6861 6e67 6520 7b73 656c   f'Exchange {sel
-00019ad0: 662e 5f61 7069 2e6e 616d 657d 2064 6f65  f._api.name} doe
-00019ae0: 7320 6e6f 7420 7375 7070 6f72 7420 6665  s not support fe
-00019af0: 7463 6869 6e67 2068 6973 746f 7269 6361  tching historica
-00019b00: 6c20 7472 6164 6520 6461 7461 2e27 0a20  l trade data.'. 
-00019b10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00019b20: 274d 6573 7361 6765 3a20 7b65 7d27 2920  'Message: {e}') 
-00019b30: 6672 6f6d 2065 0a20 2020 2020 2020 2065  from e.        e
-00019b40: 7863 6570 7420 6363 7874 2e44 446f 5350  xcept ccxt.DDoSP
-00019b50: 726f 7465 6374 696f 6e20 6173 2065 3a0a  rotection as e:.
-00019b60: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00019b70: 6520 4444 6f73 5072 6f74 6563 7469 6f6e  e DDosProtection
-00019b80: 2865 2920 6672 6f6d 2065 0a20 2020 2020  (e) from e.     
-00019b90: 2020 2065 7863 6570 7420 2863 6378 742e     except (ccxt.
-00019ba0: 4e65 7477 6f72 6b45 7272 6f72 2c20 6363  NetworkError, cc
-00019bb0: 7874 2e45 7863 6861 6e67 6545 7272 6f72  xt.ExchangeError
-00019bc0: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-00019bd0: 2020 2020 7261 6973 6520 5465 6d70 6f72      raise Tempor
-00019be0: 6172 7945 7272 6f72 2866 2743 6f75 6c64  aryError(f'Could
-00019bf0: 206e 6f74 206c 6f61 6420 7472 6164 6520   not load trade 
-00019c00: 6869 7374 6f72 7920 6475 6520 746f 207b  history due to {
-00019c10: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-00019c20: 6d65 5f5f 7d2e 2027 0a20 2020 2020 2020  me__}. '.       
-00019c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c40: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
-00019c50: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-00019c60: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-00019c70: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
-00019c80: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-00019c90: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-00019ca0: 6e61 6c45 7863 6570 7469 6f6e 2866 2743  nalException(f'C
-00019cb0: 6f75 6c64 206e 6f74 2066 6574 6368 2074  ould not fetch t
-00019cc0: 7261 6465 2064 6174 612e 204d 7367 3a20  rade data. Msg: 
-00019cd0: 7b65 7d27 2920 6672 6f6d 2065 0a0a 2020  {e}') from e..  
-00019ce0: 2020 6465 6620 5f76 616c 6964 5f74 7261    def _valid_tra
-00019cf0: 6465 5f70 6167 696e 6174 696f 6e5f 6964  de_pagination_id
-00019d00: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-00019d10: 2c20 6672 6f6d 5f69 643a 2073 7472 2920  , from_id: str) 
-00019d20: 2d3e 2062 6f6f 6c3a 0a20 2020 2020 2020  -> bool:.       
-00019d30: 2022 2222 0a20 2020 2020 2020 2056 6572   """.        Ver
-00019d40: 6966 7920 7472 6164 652d 7061 6769 6e61  ify trade-pagina
-00019d50: 7469 6f6e 2069 6420 6973 2076 616c 6964  tion id is valid
-00019d60: 2e0a 2020 2020 2020 2020 576f 726b 6172  ..        Workar
-00019d70: 6f75 6e64 2066 6f72 206f 6464 204b 7261  ound for odd Kra
-00019d80: 6b65 6e20 6973 7375 6520 7768 6572 6520  ken issue where 
-00019d90: 4944 2069 7320 736f 6d65 7469 6d65 7320  ID is sometimes 
-00019da0: 7772 6f6e 672e 0a20 2020 2020 2020 2022  wrong..        "
-00019db0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-00019dc0: 6e20 5472 7565 0a0a 2020 2020 6465 6620  n True..    def 
-00019dd0: 5f67 6574 5f74 7261 6465 5f70 6167 696e  _get_trade_pagin
-00019de0: 6174 696f 6e5f 6e65 7874 5f76 616c 7565  ation_next_value
-00019df0: 2873 656c 662c 2074 7261 6465 733a 204c  (self, trades: L
-00019e00: 6973 745b 4469 6374 5d29 3a0a 2020 2020  ist[Dict]):.    
-00019e10: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00019e20: 4578 7472 6163 7420 7061 6769 6e61 7469  Extract paginati
-00019e30: 6f6e 2069 6420 666f 7220 7468 6520 6e65  on id for the ne
-00019e40: 7874 2022 6672 6f6d 5f69 6422 2076 616c  xt "from_id" val
-00019e50: 7565 0a20 2020 2020 2020 2041 7070 6c69  ue.        Appli
-00019e60: 6573 206f 6e6c 7920 746f 2066 6574 6368  es only to fetch
-00019e70: 5f74 7261 6465 5f68 6973 746f 7279 2062  _trade_history b
-00019e80: 7920 6964 2e0a 2020 2020 2020 2020 2222  y id..        ""
-00019e90: 220a 2020 2020 2020 2020 6966 206e 6f74  ".        if not
-00019ea0: 2074 7261 6465 733a 0a20 2020 2020 2020   trades:.       
-00019eb0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-00019ec0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-00019ed0: 2e5f 7472 6164 6573 5f70 6167 696e 6174  ._trades_paginat
-00019ee0: 696f 6e20 3d3d 2027 6964 273a 0a20 2020  ion == 'id':.   
-00019ef0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00019f00: 7472 6164 6573 5b2d 315d 2e67 6574 2827  trades[-1].get('
-00019f10: 6964 2729 0a20 2020 2020 2020 2065 6c73  id').        els
-00019f20: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-00019f30: 6574 7572 6e20 7472 6164 6573 5b2d 315d  eturn trades[-1]
-00019f40: 2e67 6574 2827 7469 6d65 7374 616d 7027  .get('timestamp'
-00019f50: 290a 0a20 2020 2061 7379 6e63 2064 6566  )..    async def
-00019f60: 205f 6173 796e 635f 6765 745f 7472 6164   _async_get_trad
-00019f70: 655f 6869 7374 6f72 795f 6964 2873 656c  e_history_id(sel
-00019f80: 662c 2070 6169 723a 2073 7472 2c0a 2020  f, pair: str,.  
-00019f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fb0: 2020 2020 2020 2020 756e 7469 6c3a 2069          until: i
-00019fc0: 6e74 2c0a 2020 2020 2020 2020 2020 2020  nt,.            
-00019fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019fe0: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00019ff0: 6e63 653a 204f 7074 696f 6e61 6c5b 696e  nce: Optional[in
-0001a000: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
-0001a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a030: 2020 2020 2066 726f 6d5f 6964 3a20 4f70       from_id: Op
-0001a040: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
-0001a050: 6e65 2920 2d3e 2054 7570 6c65 5b73 7472  ne) -> Tuple[str
-0001a060: 2c20 4c69 7374 5b4c 6973 745d 5d3a 0a20  , List[List]]:. 
-0001a070: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001a080: 2020 2041 7379 6e63 726f 6e6f 7573 6c79     Asyncronously
-0001a090: 2067 6574 7320 7472 6164 6520 6869 7374   gets trade hist
-0001a0a0: 6f72 7920 7573 696e 6720 6665 7463 685f  ory using fetch_
-0001a0b0: 7472 6164 6573 0a20 2020 2020 2020 2075  trades.        u
-0001a0c0: 7365 2074 6869 7320 7768 656e 2065 7863  se this when exc
-0001a0d0: 6861 6e67 6520 7573 6573 2069 642d 6261  hange uses id-ba
-0001a0e0: 7365 6420 6974 6572 6174 696f 6e20 2863  sed iteration (c
-0001a0f0: 6865 636b 2060 7365 6c66 2e5f 7472 6164  heck `self._trad
-0001a100: 6573 5f70 6167 696e 6174 696f 6e60 290a  es_pagination`).
-0001a110: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-0001a120: 6169 723a 2050 6169 7220 746f 2066 6574  air: Pair to fet
-0001a130: 6368 2074 7261 6465 2064 6174 6120 666f  ch trade data fo
-0001a140: 720a 2020 2020 2020 2020 3a70 6172 616d  r.        :param
-0001a150: 2073 696e 6365 3a20 5369 6e63 6520 6173   since: Since as
-0001a160: 2069 6e74 6567 6572 2074 696d 6573 7461   integer timesta
-0001a170: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
-0001a180: 6473 0a20 2020 2020 2020 203a 7061 7261  ds.        :para
-0001a190: 6d20 756e 7469 6c3a 2055 6e74 696c 2061  m until: Until a
-0001a1a0: 7320 696e 7465 6765 7220 7469 6d65 7374  s integer timest
-0001a1b0: 616d 7020 696e 206d 696c 6c69 7365 636f  amp in milliseco
-0001a1c0: 6e64 730a 2020 2020 2020 2020 3a70 6172  nds.        :par
-0001a1d0: 616d 2066 726f 6d5f 6964 3a20 446f 776e  am from_id: Down
-0001a1e0: 6c6f 6164 2064 6174 6120 7374 6172 7469  load data starti
-0001a1f0: 6e67 2077 6974 6820 4944 2028 6966 2069  ng with ID (if i
-0001a200: 6420 6973 206b 6e6f 776e 292e 2049 676e  d is known). Ign
-0001a210: 6f72 6573 2022 7369 6e63 6522 2069 6620  ores "since" if 
-0001a220: 7365 742e 0a20 2020 2020 2020 2072 6574  set..        ret
-0001a230: 7572 6e73 2074 7570 6c65 3a20 2870 6169  urns tuple: (pai
-0001a240: 722c 2074 7261 6465 732d 6c69 7374 290a  r, trades-list).
-0001a250: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0001a260: 2020 2020 2074 7261 6465 733a 204c 6973       trades: Lis
-0001a270: 745b 4c69 7374 5d20 3d20 5b5d 0a20 2020  t[List] = [].   
-0001a280: 2020 2020 2023 2044 4546 4155 4c54 5f54       # DEFAULT_T
-0001a290: 5241 4445 535f 434f 4c55 4d4e 533a 2030  RADES_COLUMNS: 0
-0001a2a0: 202d 3e20 7469 6d65 7374 616d 700a 2020   -> timestamp.  
-0001a2b0: 2020 2020 2020 2320 4445 4641 554c 545f        # DEFAULT_
-0001a2c0: 5452 4144 4553 5f43 4f4c 554d 4e53 3a20  TRADES_COLUMNS: 
-0001a2d0: 3120 2d3e 2069 640a 2020 2020 2020 2020  1 -> id.        
-0001a2e0: 6861 735f 6f76 6572 6c61 7020 3d20 7365  has_overlap = se
-0001a2f0: 6c66 2e5f 6674 5f68 6173 2e67 6574 2827  lf._ft_has.get('
-0001a300: 7472 6164 6573 5f70 6167 696e 6174 696f  trades_paginatio
-0001a310: 6e5f 6f76 6572 6c61 7027 2c20 5472 7565  n_overlap', True
-0001a320: 290a 2020 2020 2020 2020 2320 536b 6970  ).        # Skip
-0001a330: 206c 6173 7420 7472 6164 6520 6279 2064   last trade by d
-0001a340: 6566 6175 6c74 2073 696e 6365 2069 7473  efault since its
-0001a350: 2074 6865 206b 6579 2066 6f72 2074 6865   the key for the
-0001a360: 206e 6578 7420 6361 6c6c 0a20 2020 2020   next call.     
-0001a370: 2020 2078 203d 2073 6c69 6365 284e 6f6e     x = slice(Non
-0001a380: 652c 202d 3129 2069 6620 6861 735f 6f76  e, -1) if has_ov
-0001a390: 6572 6c61 7020 656c 7365 2073 6c69 6365  erlap else slice
-0001a3a0: 284e 6f6e 6529 0a0a 2020 2020 2020 2020  (None)..        
-0001a3b0: 6966 206e 6f74 2066 726f 6d5f 6964 206f  if not from_id o
-0001a3c0: 7220 6e6f 7420 7365 6c66 2e5f 7661 6c69  r not self._vali
-0001a3d0: 645f 7472 6164 655f 7061 6769 6e61 7469  d_trade_paginati
-0001a3e0: 6f6e 5f69 6428 7061 6972 2c20 6672 6f6d  on_id(pair, from
-0001a3f0: 5f69 6429 3a0a 2020 2020 2020 2020 2020  _id):.          
-0001a400: 2020 2320 4665 7463 6820 6669 7273 7420    # Fetch first 
-0001a410: 656c 656d 656e 7473 2075 7369 6e67 2074  elements using t
-0001a420: 696d 6562 6173 6564 206d 6574 686f 6420  imebased method 
-0001a430: 746f 2067 6574 2061 6e20 4944 2074 6f20  to get an ID to 
-0001a440: 7061 6769 6e61 7465 206f 6e0a 2020 2020  paginate on.    
-0001a450: 2020 2020 2020 2020 2320 4465 7065 6e64          # Depend
-0001a460: 696e 6720 6f6e 2074 6865 2045 7863 6861  ing on the Excha
-0001a470: 6e67 652c 2074 6869 7320 6361 6e20 696e  nge, this can in
-0001a480: 7472 6f64 7563 6520 6120 6472 6966 7420  troduce a drift 
-0001a490: 6174 2074 6865 2073 7461 7274 206f 6620  at the start of 
-0001a4a0: 7468 6520 696e 7465 7276 616c 0a20 2020  the interval.   
-0001a4b0: 2020 2020 2020 2020 2023 206f 6620 7570           # of up
-0001a4c0: 2074 6f20 616e 2068 6f75 722e 0a20 2020   to an hour..   
-0001a4d0: 2020 2020 2020 2020 2023 2065 2e67 2e20           # e.g. 
-0001a4e0: 4269 6e61 6e63 6520 7265 7475 726e 7320  Binance returns 
-0001a4f0: 7468 6520 226c 6173 7420 3130 3030 2220  the "last 1000" 
-0001a500: 6361 6e64 6c65 7320 7769 7468 696e 2061  candles within a
-0001a510: 2031 6820 7469 6d65 2069 6e74 6572 7661   1h time interva
-0001a520: 6c0a 2020 2020 2020 2020 2020 2020 2320  l.            # 
-0001a530: 2d20 736f 2077 6520 7769 6c6c 206d 6973  - so we will mis
-0001a540: 7320 7468 6520 6669 7273 7420 7472 6164  s the first trad
-0001a550: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-0001a560: 742c 2066 726f 6d5f 6964 203d 2061 7761  t, from_id = awa
-0001a570: 6974 2073 656c 662e 5f61 7379 6e63 5f66  it self._async_f
-0001a580: 6574 6368 5f74 7261 6465 7328 7061 6972  etch_trades(pair
-0001a590: 2c20 7369 6e63 653d 7369 6e63 6529 0a20  , since=since). 
-0001a5a0: 2020 2020 2020 2020 2020 2074 7261 6465             trade
-0001a5b0: 732e 6578 7465 6e64 2874 5b78 5d29 0a20  s.extend(t[x]). 
-0001a5c0: 2020 2020 2020 2077 6869 6c65 2054 7275         while Tru
-0001a5d0: 653a 0a20 2020 2020 2020 2020 2020 2074  e:.            t
-0001a5e0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001a5f0: 2020 2020 742c 2066 726f 6d5f 6964 5f6e      t, from_id_n
-0001a600: 6578 7420 3d20 6177 6169 7420 7365 6c66  ext = await self
-0001a610: 2e5f 6173 796e 635f 6665 7463 685f 7472  ._async_fetch_tr
-0001a620: 6164 6573 280a 2020 2020 2020 2020 2020  ades(.          
-0001a630: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
-0001a640: 7061 7261 6d73 3d7b 7365 6c66 2e5f 7472  params={self._tr
-0001a650: 6164 6573 5f70 6167 696e 6174 696f 6e5f  ades_pagination_
-0001a660: 6172 673a 2066 726f 6d5f 6964 7d29 0a20  arg: from_id}). 
-0001a670: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001a680: 6620 743a 0a20 2020 2020 2020 2020 2020  f t:.           
-0001a690: 2020 2020 2020 2020 2074 7261 6465 732e           trades.
-0001a6a0: 6578 7465 6e64 2874 5b78 5d29 0a20 2020  extend(t[x]).   
-0001a6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6c0: 2069 6620 6672 6f6d 5f69 6420 3d3d 2066   if from_id == f
-0001a6d0: 726f 6d5f 6964 5f6e 6578 7420 6f72 2074  rom_id_next or t
-0001a6e0: 5b2d 315d 5b30 5d20 3e20 756e 7469 6c3a  [-1][0] > until:
-0001a6f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a700: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0001a710: 6465 6275 6728 6622 5374 6f70 7069 6e67  debug(f"Stopping
-0001a720: 2062 6563 6175 7365 2066 726f 6d5f 6964   because from_id
-0001a730: 2064 6964 206e 6f74 2063 6861 6e67 652e   did not change.
-0001a740: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-0001a750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a760: 2020 2020 2020 2020 6622 5265 6163 6865          f"Reache
-0001a770: 6420 7b74 5b2d 315d 5b30 5d7d 203e 207b  d {t[-1][0]} > {
-0001a780: 756e 7469 6c7d 2229 0a20 2020 2020 2020  until}").       
-0001a790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a7a0: 2023 2052 6561 6368 6564 2074 6865 2065   # Reached the e
-0001a7b0: 6e64 206f 6620 7468 6520 6465 6669 6e65  nd of the define
-0001a7c0: 642d 646f 776e 6c6f 6164 2070 6572 696f  d-download perio
-0001a7d0: 6420 2d20 6164 6420 6c61 7374 2074 7261  d - add last tra
-0001a7e0: 6465 2061 7320 7765 6c6c 2e0a 2020 2020  de as well..    
+00017620: 2073 656c 662e 5f6b 6c69 6e65 735b 2870   self._klines[(p
+00017630: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
+00017640: 635f 7479 7065 295d 203d 206f 686c 6376  c_type)] = ohlcv
+00017650: 5f64 660a 2020 2020 2020 2020 7265 7475  _df.        retu
+00017660: 726e 206f 686c 6376 5f64 660a 0a20 2020  rn ohlcv_df..   
+00017670: 2064 6566 2072 6566 7265 7368 5f6c 6174   def refresh_lat
+00017680: 6573 745f 6f68 6c63 7628 7365 6c66 2c20  est_ohlcv(self, 
+00017690: 7061 6972 5f6c 6973 743a 204c 6973 7450  pair_list: ListP
+000176a0: 6169 7273 5769 7468 5469 6d65 6672 616d  airsWithTimefram
+000176b0: 6573 2c20 2a2c 0a20 2020 2020 2020 2020  es, *,.         
+000176c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000176d0: 2020 2020 7369 6e63 655f 6d73 3a20 4f70      since_ms: Op
+000176e0: 7469 6f6e 616c 5b69 6e74 5d20 3d20 4e6f  tional[int] = No
+000176f0: 6e65 2c20 6361 6368 653a 2062 6f6f 6c20  ne, cache: bool 
+00017700: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
+00017710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017720: 2020 2020 2064 726f 705f 696e 636f 6d70       drop_incomp
+00017730: 6c65 7465 3a20 4f70 7469 6f6e 616c 5b62  lete: Optional[b
+00017740: 6f6f 6c5d 203d 204e 6f6e 650a 2020 2020  ool] = None.    
+00017750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017760: 2020 2020 2020 2020 2029 202d 3e20 4469           ) -> Di
+00017770: 6374 5b50 6169 7257 6974 6854 696d 6566  ct[PairWithTimef
+00017780: 7261 6d65 2c20 4461 7461 4672 616d 655d  rame, DataFrame]
+00017790: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+000177a0: 2020 2020 2020 5265 6672 6573 6820 696e        Refresh in
+000177b0: 2d6d 656d 6f72 7920 4f48 4c43 5620 6173  -memory OHLCV as
+000177c0: 796e 6368 726f 6e6f 7573 6c79 2061 6e64  ynchronously and
+000177d0: 2073 6574 2060 5f6b 6c69 6e65 7360 2077   set `_klines` w
+000177e0: 6974 6820 7468 6520 7265 7375 6c74 0a20  ith the result. 
+000177f0: 2020 2020 2020 204c 6f6f 7073 2061 7379         Loops asy
+00017800: 6e63 6872 6f6e 6f75 736c 7920 6f76 6572  nchronously over
+00017810: 2070 6169 725f 6c69 7374 2061 6e64 2064   pair_list and d
+00017820: 6f77 6e6c 6f61 6473 2061 6c6c 2070 6169  ownloads all pai
+00017830: 7273 2061 7379 6e63 2028 7365 6d69 2d70  rs async (semi-p
+00017840: 6172 616c 6c65 6c29 2e0a 2020 2020 2020  arallel)..      
+00017850: 2020 4f6e 6c79 2075 7365 6420 696e 2074    Only used in t
+00017860: 6865 2064 6174 6170 726f 7669 6465 722e  he dataprovider.
+00017870: 7265 6672 6573 6828 2920 6d65 7468 6f64  refresh() method
+00017880: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00017890: 2070 6169 725f 6c69 7374 3a20 4c69 7374   pair_list: List
+000178a0: 206f 6620 3220 656c 656d 656e 7420 7475   of 2 element tu
+000178b0: 706c 6573 2063 6f6e 7461 696e 696e 6720  ples containing 
+000178c0: 7061 6972 2c20 696e 7465 7276 616c 2074  pair, interval t
+000178d0: 6f20 7265 6672 6573 680a 2020 2020 2020  o refresh.      
+000178e0: 2020 3a70 6172 616d 2073 696e 6365 5f6d    :param since_m
+000178f0: 733a 2074 696d 6520 7369 6e63 6520 7768  s: time since wh
+00017900: 656e 2074 6f20 646f 776e 6c6f 6164 2c20  en to download, 
+00017910: 696e 206d 696c 6c69 7365 636f 6e64 730a  in milliseconds.
+00017920: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
+00017930: 6163 6865 3a20 4173 7369 676e 2072 6573  ache: Assign res
+00017940: 756c 7420 746f 205f 6b6c 696e 6573 2e20  ult to _klines. 
+00017950: 5573 6566 756c 2066 6f72 206f 6e65 2d6f  Useful for one-o
+00017960: 6666 2064 6f77 6e6c 6f61 6473 206c 696b  ff downloads lik
+00017970: 6520 666f 7220 7061 6972 6c69 7374 730a  e for pairlists.
+00017980: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
+00017990: 726f 705f 696e 636f 6d70 6c65 7465 3a20  rop_incomplete: 
+000179a0: 436f 6e74 726f 6c20 6361 6e64 6c65 2064  Control candle d
+000179b0: 726f 7070 696e 672e 0a20 2020 2020 2020  ropping..       
+000179c0: 2020 2020 2053 7065 6369 6679 696e 6720       Specifying 
+000179d0: 4e6f 6e65 2064 6566 6175 6c74 7320 746f  None defaults to
+000179e0: 205f 6f68 6c63 765f 7061 7274 6961 6c5f   _ohlcv_partial_
+000179f0: 6361 6e64 6c65 0a20 2020 2020 2020 203a  candle.        :
+00017a00: 7265 7475 726e 3a20 4469 6374 206f 6620  return: Dict of 
+00017a10: 5b7b 2870 6169 722c 2074 696d 6566 7261  [{(pair, timefra
+00017a20: 6d65 293a 2044 6174 6166 7261 6d65 7d5d  me): Dataframe}]
+00017a30: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00017a40: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+00017a50: 6728 2252 6566 7265 7368 696e 6720 6361  g("Refreshing ca
+00017a60: 6e64 6c65 2028 4f48 4c43 5629 2064 6174  ndle (OHLCV) dat
+00017a70: 6120 666f 7220 2564 2070 6169 7273 222c  a for %d pairs",
+00017a80: 206c 656e 2870 6169 725f 6c69 7374 2929   len(pair_list))
+00017a90: 0a0a 2020 2020 2020 2020 2320 4761 7468  ..        # Gath
+00017aa0: 6572 2063 6f72 6f75 7469 6e65 7320 746f  er coroutines to
+00017ab0: 2072 756e 0a20 2020 2020 2020 2069 6e70   run.        inp
+00017ac0: 7574 5f63 6f72 6f75 7469 6e65 732c 2063  ut_coroutines, c
+00017ad0: 6163 6865 645f 7061 6972 7320 3d20 7365  ached_pairs = se
+00017ae0: 6c66 2e5f 6275 696c 645f 6f68 6c63 765f  lf._build_ohlcv_
+00017af0: 646c 5f6a 6f62 7328 7061 6972 5f6c 6973  dl_jobs(pair_lis
+00017b00: 742c 2073 696e 6365 5f6d 732c 2063 6163  t, since_ms, cac
+00017b10: 6865 290a 0a20 2020 2020 2020 2072 6573  he)..        res
+00017b20: 756c 7473 5f64 6620 3d20 7b7d 0a20 2020  ults_df = {}.   
+00017b30: 2020 2020 2023 2043 6875 6e6b 2072 6571       # Chunk req
+00017b40: 7565 7374 7320 696e 746f 2062 6174 6368  uests into batch
+00017b50: 6573 206f 6620 3130 3020 746f 2061 766f  es of 100 to avo
+00017b60: 6964 206f 7665 7277 6865 6c6d 696e 6720  id overwhelming 
+00017b70: 6363 7874 2054 6872 6f74 746c 696e 670a  ccxt Throttling.
+00017b80: 2020 2020 2020 2020 666f 7220 696e 7075          for inpu
+00017b90: 745f 636f 726f 2069 6e20 6368 756e 6b73  t_coro in chunks
+00017ba0: 2869 6e70 7574 5f63 6f72 6f75 7469 6e65  (input_coroutine
+00017bb0: 732c 2031 3030 293a 0a20 2020 2020 2020  s, 100):.       
+00017bc0: 2020 2020 2061 7379 6e63 2064 6566 2067       async def g
+00017bd0: 6174 6865 725f 7374 7566 6628 293a 0a20  ather_stuff():. 
+00017be0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00017bf0: 6574 7572 6e20 6177 6169 7420 6173 796e  eturn await asyn
+00017c00: 6369 6f2e 6761 7468 6572 282a 696e 7075  cio.gather(*inpu
+00017c10: 745f 636f 726f 2c20 7265 7475 726e 5f65  t_coro, return_e
+00017c20: 7863 6570 7469 6f6e 733d 5472 7565 290a  xceptions=True).
+00017c30: 0a20 2020 2020 2020 2020 2020 2077 6974  .            wit
+00017c40: 6820 7365 6c66 2e5f 6c6f 6f70 5f6c 6f63  h self._loop_loc
+00017c50: 6b3a 0a20 2020 2020 2020 2020 2020 2020  k:.             
+00017c60: 2020 2072 6573 756c 7473 203d 2073 656c     results = sel
+00017c70: 662e 6c6f 6f70 2e72 756e 5f75 6e74 696c  f.loop.run_until
+00017c80: 5f63 6f6d 706c 6574 6528 6761 7468 6572  _complete(gather
+00017c90: 5f73 7475 6666 2829 290a 0a20 2020 2020  _stuff())..     
+00017ca0: 2020 2020 2020 2066 6f72 2072 6573 2069         for res i
+00017cb0: 6e20 7265 7375 6c74 733a 0a20 2020 2020  n results:.     
+00017cc0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+00017cd0: 696e 7374 616e 6365 2872 6573 2c20 4578  instance(res, Ex
+00017ce0: 6365 7074 696f 6e29 3a0a 2020 2020 2020  ception):.      
+00017cf0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00017d00: 6767 6572 2e77 6172 6e69 6e67 2866 2241  gger.warning(f"A
+00017d10: 7379 6e63 2063 6f64 6520 7261 6973 6564  sync code raised
+00017d20: 2061 6e20 6578 6365 7074 696f 6e3a 207b   an exception: {
+00017d30: 7265 7072 2872 6573 297d 2229 0a20 2020  repr(res)}").   
+00017d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017d50: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00017d60: 2020 2020 2020 2020 2020 2320 4465 636f            # Deco
+00017d70: 6e73 7472 7563 7420 7475 706c 6520 2868  nstruct tuple (h
+00017d80: 6173 2035 2065 6c65 6d65 6e74 7329 0a20  as 5 elements). 
+00017d90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00017da0: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
+00017db0: 635f 7479 7065 2c20 7469 636b 732c 2064  c_type, ticks, d
+00017dc0: 726f 705f 6869 6e74 203d 2072 6573 0a20  rop_hint = res. 
+00017dd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00017de0: 726f 705f 696e 636f 6d70 6c65 7465 5f20  rop_incomplete_ 
+00017df0: 3d20 6472 6f70 5f68 696e 7420 6966 2064  = drop_hint if d
+00017e00: 726f 705f 696e 636f 6d70 6c65 7465 2069  rop_incomplete i
+00017e10: 7320 4e6f 6e65 2065 6c73 6520 6472 6f70  s None else drop
+00017e20: 5f69 6e63 6f6d 706c 6574 650a 2020 2020  _incomplete.    
+00017e30: 2020 2020 2020 2020 2020 2020 6f68 6c63              ohlc
+00017e40: 765f 6466 203d 2073 656c 662e 5f70 726f  v_df = self._pro
+00017e50: 6365 7373 5f6f 686c 6376 5f64 6628 0a20  cess_ohlcv_df(. 
+00017e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017e70: 2020 2070 6169 722c 2074 696d 6566 7261     pair, timefra
+00017e80: 6d65 2c20 635f 7479 7065 2c20 7469 636b  me, c_type, tick
+00017e90: 732c 2063 6163 6865 2c20 6472 6f70 5f69  s, cache, drop_i
+00017ea0: 6e63 6f6d 706c 6574 655f 290a 0a20 2020  ncomplete_)..   
+00017eb0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00017ec0: 756c 7473 5f64 665b 2870 6169 722c 2074  ults_df[(pair, t
+00017ed0: 696d 6566 7261 6d65 2c20 635f 7479 7065  imeframe, c_type
+00017ee0: 295d 203d 206f 686c 6376 5f64 660a 0a20  )] = ohlcv_df.. 
+00017ef0: 2020 2020 2020 2023 2052 6574 7572 6e20         # Return 
+00017f00: 6361 6368 6564 206b 6c69 6e65 730a 2020  cached klines.  
+00017f10: 2020 2020 2020 666f 7220 7061 6972 2c20        for pair, 
+00017f20: 7469 6d65 6672 616d 652c 2063 5f74 7970  timeframe, c_typ
+00017f30: 6520 696e 2063 6163 6865 645f 7061 6972  e in cached_pair
+00017f40: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00017f50: 6573 756c 7473 5f64 665b 2870 6169 722c  esults_df[(pair,
+00017f60: 2074 696d 6566 7261 6d65 2c20 635f 7479   timeframe, c_ty
+00017f70: 7065 295d 203d 2073 656c 662e 6b6c 696e  pe)] = self.klin
+00017f80: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+00017f90: 2020 2020 2870 6169 722c 2074 696d 6566      (pair, timef
+00017fa0: 7261 6d65 2c20 635f 7479 7065 292c 0a20  rame, c_type),. 
+00017fb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00017fc0: 6f70 793d 4661 6c73 650a 2020 2020 2020  opy=False.      
+00017fd0: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
+00017fe0: 2072 6574 7572 6e20 7265 7375 6c74 735f   return results_
+00017ff0: 6466 0a0a 2020 2020 6465 6620 7265 6672  df..    def refr
+00018000: 6573 685f 6f68 6c63 765f 7769 7468 5f63  esh_ohlcv_with_c
+00018010: 6163 6865 280a 2020 2020 2020 2020 7365  ache(.        se
+00018020: 6c66 2c0a 2020 2020 2020 2020 7061 6972  lf,.        pair
+00018030: 733a 204c 6973 745b 5061 6972 5769 7468  s: List[PairWith
+00018040: 5469 6d65 6672 616d 655d 2c0a 2020 2020  Timeframe],.    
+00018050: 2020 2020 7369 6e63 655f 6d73 3a20 696e      since_ms: in
+00018060: 740a 2020 2020 2920 2d3e 2044 6963 745b  t.    ) -> Dict[
+00018070: 5061 6972 5769 7468 5469 6d65 6672 616d  PairWithTimefram
+00018080: 652c 2044 6174 6146 7261 6d65 5d3a 0a20  e, DataFrame]:. 
+00018090: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+000180a0: 2020 2052 6566 7265 7368 206f 686c 6376     Refresh ohlcv
+000180b0: 2064 6174 6120 666f 7220 616c 6c20 7061   data for all pa
+000180c0: 6972 7320 696e 206e 6565 6465 645f 7061  irs in needed_pa
+000180d0: 6972 7320 6966 206e 6563 6573 7361 7279  irs if necessary
+000180e0: 2e0a 2020 2020 2020 2020 4361 6368 6573  ..        Caches
+000180f0: 2064 6174 6120 7769 7468 2065 7870 6972   data with expir
+00018100: 696e 6720 7065 7220 7469 6d65 6672 616d  ing per timefram
+00018110: 652e 0a20 2020 2020 2020 2053 686f 756c  e..        Shoul
+00018120: 6420 6f6e 6c79 2062 6520 7573 6564 2066  d only be used f
+00018130: 6f72 2070 6169 726c 6973 7473 2077 6869  or pairlists whi
+00018140: 6368 206e 6565 6420 226f 6e20 7469 6d65  ch need "on time
+00018150: 2220 6578 7069 7261 7269 6f6e 2c20 616e  " expirarion, an
+00018160: 6420 6e6f 206c 6f6e 6765 7220 6361 6368  d no longer cach
+00018170: 652e 0a20 2020 2020 2020 2022 2222 0a0a  e..        """..
+00018180: 2020 2020 2020 2020 7469 6d65 6672 616d          timefram
+00018190: 6573 203d 207b 705b 315d 2066 6f72 2070  es = {p[1] for p
+000181a0: 2069 6e20 7061 6972 737d 0a20 2020 2020   in pairs}.     
+000181b0: 2020 2066 6f72 2074 696d 6566 7261 6d65     for timeframe
+000181c0: 2069 6e20 7469 6d65 6672 616d 6573 3a0a   in timeframes:.
+000181d0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+000181e0: 7469 6d65 6672 616d 652c 2073 696e 6365  timeframe, since
+000181f0: 5f6d 7329 206e 6f74 2069 6e20 7365 6c66  _ms) not in self
+00018200: 2e5f 6578 7069 7269 6e67 5f63 616e 646c  ._expiring_candl
+00018210: 655f 6361 6368 653a 0a20 2020 2020 2020  e_cache:.       
+00018220: 2020 2020 2020 2020 2074 696d 6566 7261           timefra
+00018230: 6d65 5f69 6e5f 7365 6320 3d20 7469 6d65  me_in_sec = time
+00018240: 6672 616d 655f 746f 5f73 6563 6f6e 6473  frame_to_seconds
+00018250: 2874 696d 6566 7261 6d65 290a 2020 2020  (timeframe).    
+00018260: 2020 2020 2020 2020 2020 2020 2320 496e              # In
+00018270: 6974 6961 6c69 7365 2063 6163 6865 0a20  itialise cache. 
+00018280: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00018290: 656c 662e 5f65 7870 6972 696e 675f 6361  elf._expiring_ca
+000182a0: 6e64 6c65 5f63 6163 6865 5b28 7469 6d65  ndle_cache[(time
+000182b0: 6672 616d 652c 2073 696e 6365 5f6d 7329  frame, since_ms)
+000182c0: 5d20 3d20 5065 7269 6f64 6963 4361 6368  ] = PeriodicCach
+000182d0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+000182e0: 2020 2020 2020 2074 746c 3d74 696d 6566         ttl=timef
+000182f0: 7261 6d65 5f69 6e5f 7365 632c 206d 6178  rame_in_sec, max
+00018300: 7369 7a65 3d31 3030 3029 0a0a 2020 2020  size=1000)..    
+00018310: 2020 2020 2320 4765 7420 6361 6e64 6c65      # Get candle
+00018320: 7320 6672 6f6d 2063 6163 6865 0a20 2020  s from cache.   
+00018330: 2020 2020 2063 616e 646c 6573 203d 207b       candles = {
+00018340: 0a20 2020 2020 2020 2020 2020 2063 3a20  .            c: 
+00018350: 7365 6c66 2e5f 6578 7069 7269 6e67 5f63  self._expiring_c
+00018360: 616e 646c 655f 6361 6368 655b 2863 5b31  andle_cache[(c[1
+00018370: 5d2c 2073 696e 6365 5f6d 7329 5d2e 6765  ], since_ms)].ge
+00018380: 7428 632c 204e 6f6e 6529 2066 6f72 2063  t(c, None) for c
+00018390: 2069 6e20 7061 6972 730a 2020 2020 2020   in pairs.      
+000183a0: 2020 2020 2020 6966 2063 2069 6e20 7365        if c in se
+000183b0: 6c66 2e5f 6578 7069 7269 6e67 5f63 616e  lf._expiring_can
+000183c0: 646c 655f 6361 6368 655b 2863 5b31 5d2c  dle_cache[(c[1],
+000183d0: 2073 696e 6365 5f6d 7329 5d0a 2020 2020   since_ms)].    
+000183e0: 2020 2020 7d0a 2020 2020 2020 2020 7061      }.        pa
+000183f0: 6972 735f 746f 5f64 6f77 6e6c 6f61 6420  irs_to_download 
+00018400: 3d20 5b70 2066 6f72 2070 2069 6e20 7061  = [p for p in pa
+00018410: 6972 7320 6966 2070 206e 6f74 2069 6e20  irs if p not in 
+00018420: 6361 6e64 6c65 735d 0a20 2020 2020 2020  candles].       
+00018430: 2069 6620 7061 6972 735f 746f 5f64 6f77   if pairs_to_dow
+00018440: 6e6c 6f61 643a 0a20 2020 2020 2020 2020  nload:.         
+00018450: 2020 2063 616e 646c 6573 203d 2073 656c     candles = sel
+00018460: 662e 7265 6672 6573 685f 6c61 7465 7374  f.refresh_latest
+00018470: 5f6f 686c 6376 280a 2020 2020 2020 2020  _ohlcv(.        
+00018480: 2020 2020 2020 2020 7061 6972 735f 746f          pairs_to
+00018490: 5f64 6f77 6e6c 6f61 642c 2073 696e 6365  _download, since
+000184a0: 5f6d 733d 7369 6e63 655f 6d73 2c20 6361  _ms=since_ms, ca
+000184b0: 6368 653d 4661 6c73 650a 2020 2020 2020  che=False.      
+000184c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+000184d0: 2020 2020 666f 7220 632c 2076 616c 2069      for c, val i
+000184e0: 6e20 6361 6e64 6c65 732e 6974 656d 7328  n candles.items(
+000184f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00018500: 2020 2073 656c 662e 5f65 7870 6972 696e     self._expirin
+00018510: 675f 6361 6e64 6c65 5f63 6163 6865 5b28  g_candle_cache[(
+00018520: 635b 315d 2c20 7369 6e63 655f 6d73 295d  c[1], since_ms)]
+00018530: 5b63 5d20 3d20 7661 6c0a 2020 2020 2020  [c] = val.      
+00018540: 2020 7265 7475 726e 2063 616e 646c 6573    return candles
+00018550: 0a0a 2020 2020 6465 6620 5f6e 6f77 5f69  ..    def _now_i
+00018560: 735f 7469 6d65 5f74 6f5f 7265 6672 6573  s_time_to_refres
+00018570: 6828 7365 6c66 2c20 7061 6972 3a20 7374  h(self, pair: st
+00018580: 722c 2074 696d 6566 7261 6d65 3a20 7374  r, timeframe: st
+00018590: 722c 2063 616e 646c 655f 7479 7065 3a20  r, candle_type: 
+000185a0: 4361 6e64 6c65 5479 7065 2920 2d3e 2062  CandleType) -> b
+000185b0: 6f6f 6c3a 0a20 2020 2020 2020 2023 2054  ool:.        # T
+000185c0: 696d 6566 7261 6d65 2069 6e20 7365 636f  imeframe in seco
+000185d0: 6e64 730a 2020 2020 2020 2020 696e 7465  nds.        inte
+000185e0: 7276 616c 5f69 6e5f 7365 6320 3d20 7469  rval_in_sec = ti
+000185f0: 6d65 6672 616d 655f 746f 5f73 6563 6f6e  meframe_to_secon
+00018600: 6473 2874 696d 6566 7261 6d65 290a 2020  ds(timeframe).  
+00018610: 2020 2020 2020 706c 7220 3d20 7365 6c66        plr = self
+00018620: 2e5f 7061 6972 735f 6c61 7374 5f72 6566  ._pairs_last_ref
+00018630: 7265 7368 5f74 696d 652e 6765 7428 2870  resh_time.get((p
+00018640: 6169 722c 2074 696d 6566 7261 6d65 2c20  air, timeframe, 
+00018650: 6361 6e64 6c65 5f74 7970 6529 2c20 3029  candle_type), 0)
+00018660: 202b 2069 6e74 6572 7661 6c5f 696e 5f73   + interval_in_s
+00018670: 6563 0a20 2020 2020 2020 2023 2063 7572  ec.        # cur
+00018680: 7265 6e74 2c61 6374 6976 6520 6361 6e64  rent,active cand
+00018690: 6c65 206f 7065 6e20 6461 7465 0a20 2020  le open date.   
+000186a0: 2020 2020 206e 6f77 203d 2069 6e74 2874       now = int(t
+000186b0: 696d 6566 7261 6d65 5f74 6f5f 7072 6576  imeframe_to_prev
+000186c0: 5f64 6174 6528 7469 6d65 6672 616d 6529  _date(timeframe)
+000186d0: 2e74 696d 6573 7461 6d70 2829 290a 2020  .timestamp()).  
+000186e0: 2020 2020 2020 7265 7475 726e 2070 6c72        return plr
+000186f0: 203c 206e 6f77 0a0a 2020 2020 4072 6574   < now..    @ret
+00018700: 7269 6572 5f61 7379 6e63 0a20 2020 2061  rier_async.    a
+00018710: 7379 6e63 2064 6566 205f 6173 796e 635f  sync def _async_
+00018720: 6765 745f 6361 6e64 6c65 5f68 6973 746f  get_candle_histo
+00018730: 7279 280a 2020 2020 2020 2020 7365 6c66  ry(.        self
+00018740: 2c0a 2020 2020 2020 2020 7061 6972 3a20  ,.        pair: 
+00018750: 7374 722c 0a20 2020 2020 2020 2074 696d  str,.        tim
+00018760: 6566 7261 6d65 3a20 7374 722c 0a20 2020  eframe: str,.   
+00018770: 2020 2020 2063 616e 646c 655f 7479 7065       candle_type
+00018780: 3a20 4361 6e64 6c65 5479 7065 2c0a 2020  : CandleType,.  
+00018790: 2020 2020 2020 7369 6e63 655f 6d73 3a20        since_ms: 
+000187a0: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+000187b0: 4e6f 6e65 2c0a 2020 2020 2920 2d3e 204f  None,.    ) -> O
+000187c0: 484c 4356 5265 7370 6f6e 7365 3a0a 2020  HLCVResponse:.  
+000187d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000187e0: 2020 4173 796e 6368 726f 6e6f 7573 6c79    Asynchronously
+000187f0: 2067 6574 2063 616e 646c 6520 6869 7374   get candle hist
+00018800: 6f72 7920 6461 7461 2075 7369 6e67 2066  ory data using f
+00018810: 6574 6368 5f6f 686c 6376 0a20 2020 2020  etch_ohlcv.     
+00018820: 2020 203a 7061 7261 6d20 6361 6e64 6c65     :param candle
+00018830: 5f74 7970 653a 2027 272c 206d 6172 6b2c  _type: '', mark,
+00018840: 2069 6e64 6578 2c20 7072 656d 6975 6d49   index, premiumI
+00018850: 6e64 6578 2c20 6f72 2066 756e 6469 6e67  ndex, or funding
+00018860: 5f72 6174 650a 2020 2020 2020 2020 7265  _rate.        re
+00018870: 7475 726e 7320 7475 706c 653a 2028 7061  turns tuple: (pa
+00018880: 6972 2c20 7469 6d65 6672 616d 652c 206f  ir, timeframe, o
+00018890: 686c 6376 5f6c 6973 7429 0a20 2020 2020  hlcv_list).     
+000188a0: 2020 2022 2222 0a20 2020 2020 2020 2074     """.        t
+000188b0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+000188c0: 2320 4665 7463 6820 4f48 4c43 5620 6173  # Fetch OHLCV as
+000188d0: 796e 6368 726f 6e6f 7573 6c79 0a20 2020  ynchronously.   
+000188e0: 2020 2020 2020 2020 2073 203d 2027 2827           s = '('
+000188f0: 202b 2064 745f 6672 6f6d 5f74 7328 7369   + dt_from_ts(si
+00018900: 6e63 655f 6d73 292e 6973 6f66 6f72 6d61  nce_ms).isoforma
+00018910: 7428 2920 2b20 2729 2027 2069 6620 7369  t() + ') ' if si
+00018920: 6e63 655f 6d73 2069 7320 6e6f 7420 4e6f  nce_ms is not No
+00018930: 6e65 2065 6c73 6520 2727 0a20 2020 2020  ne else ''.     
+00018940: 2020 2020 2020 206c 6f67 6765 722e 6465         logger.de
+00018950: 6275 6728 0a20 2020 2020 2020 2020 2020  bug(.           
+00018960: 2020 2020 2022 4665 7463 6869 6e67 2070       "Fetching p
+00018970: 6169 7220 2573 2c20 2573 2c20 696e 7465  air %s, %s, inte
+00018980: 7276 616c 2025 732c 2073 696e 6365 2025  rval %s, since %
+00018990: 7320 2573 2e2e 2e22 2c0a 2020 2020 2020  s %s...",.      
+000189a0: 2020 2020 2020 2020 2020 7061 6972 2c20            pair, 
+000189b0: 6361 6e64 6c65 5f74 7970 652c 2074 696d  candle_type, tim
+000189c0: 6566 7261 6d65 2c20 7369 6e63 655f 6d73  eframe, since_ms
+000189d0: 2c20 730a 2020 2020 2020 2020 2020 2020  , s.            
+000189e0: 290a 2020 2020 2020 2020 2020 2020 7061  ).            pa
+000189f0: 7261 6d73 203d 2064 6565 7063 6f70 7928  rams = deepcopy(
+00018a00: 7365 6c66 2e5f 6674 5f68 6173 2e67 6574  self._ft_has.get
+00018a10: 2827 6f68 6c63 765f 7061 7261 6d73 272c  ('ohlcv_params',
+00018a20: 207b 7d29 290a 2020 2020 2020 2020 2020   {})).          
+00018a30: 2020 6361 6e64 6c65 5f6c 696d 6974 203d    candle_limit =
+00018a40: 2073 656c 662e 6f68 6c63 765f 6361 6e64   self.ohlcv_cand
+00018a50: 6c65 5f6c 696d 6974 280a 2020 2020 2020  le_limit(.      
+00018a60: 2020 2020 2020 2020 2020 7469 6d65 6672            timefr
+00018a70: 616d 652c 2063 616e 646c 655f 7479 7065  ame, candle_type
+00018a80: 3d63 616e 646c 655f 7479 7065 2c20 7369  =candle_type, si
+00018a90: 6e63 655f 6d73 3d73 696e 6365 5f6d 7329  nce_ms=since_ms)
+00018aa0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
+00018ab0: 2063 616e 646c 655f 7479 7065 2061 6e64   candle_type and
+00018ac0: 2063 616e 646c 655f 7479 7065 2021 3d20   candle_type != 
+00018ad0: 4361 6e64 6c65 5479 7065 2e53 504f 543a  CandleType.SPOT:
+00018ae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018af0: 2070 6172 616d 732e 7570 6461 7465 287b   params.update({
+00018b00: 2770 7269 6365 273a 2063 616e 646c 655f  'price': candle_
+00018b10: 7479 7065 2e76 616c 7565 7d29 0a20 2020  type.value}).   
+00018b20: 2020 2020 2020 2020 2069 6620 6361 6e64           if cand
+00018b30: 6c65 5f74 7970 6520 213d 2043 616e 646c  le_type != Candl
+00018b40: 6554 7970 652e 4655 4e44 494e 475f 5241  eType.FUNDING_RA
+00018b50: 5445 3a0a 2020 2020 2020 2020 2020 2020  TE:.            
+00018b60: 2020 2020 6461 7461 203d 2061 7761 6974      data = await
+00018b70: 2073 656c 662e 5f61 7069 5f61 7379 6e63   self._api_async
+00018b80: 2e66 6574 6368 5f6f 686c 6376 280a 2020  .fetch_ohlcv(.  
+00018b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018ba0: 2020 7061 6972 2c20 7469 6d65 6672 616d    pair, timefram
+00018bb0: 653d 7469 6d65 6672 616d 652c 2073 696e  e=timeframe, sin
+00018bc0: 6365 3d73 696e 6365 5f6d 732c 0a20 2020  ce=since_ms,.   
+00018bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018be0: 206c 696d 6974 3d63 616e 646c 655f 6c69   limit=candle_li
+00018bf0: 6d69 742c 2070 6172 616d 733d 7061 7261  mit, params=para
+00018c00: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
+00018c10: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018c20: 2020 2020 2020 2320 4675 6e64 696e 6720        # Funding 
+00018c30: 7261 7465 0a20 2020 2020 2020 2020 2020  rate.           
+00018c40: 2020 2020 2064 6174 6120 3d20 6177 6169       data = awai
+00018c50: 7420 7365 6c66 2e5f 6665 7463 685f 6675  t self._fetch_fu
+00018c60: 6e64 696e 675f 7261 7465 5f68 6973 746f  nding_rate_histo
+00018c70: 7279 280a 2020 2020 2020 2020 2020 2020  ry(.            
+00018c80: 2020 2020 2020 2020 7061 6972 3d70 6169          pair=pai
+00018c90: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+00018ca0: 2020 2020 2020 2074 696d 6566 7261 6d65         timeframe
+00018cb0: 3d74 696d 6566 7261 6d65 2c0a 2020 2020  =timeframe,.    
+00018cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018cd0: 6c69 6d69 743d 6361 6e64 6c65 5f6c 696d  limit=candle_lim
+00018ce0: 6974 2c0a 2020 2020 2020 2020 2020 2020  it,.            
+00018cf0: 2020 2020 2020 2020 7369 6e63 655f 6d73          since_ms
+00018d00: 3d73 696e 6365 5f6d 732c 0a20 2020 2020  =since_ms,.     
+00018d10: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00018d20: 2020 2020 2020 2020 2023 2053 6f6d 6520           # Some 
+00018d30: 6578 6368 616e 6765 7320 736f 7274 204f  exchanges sort O
+00018d40: 484c 4356 2069 6e20 4153 4320 6f72 6465  HLCV in ASC orde
+00018d50: 7220 616e 6420 6f74 6865 7273 2069 6e20  r and others in 
+00018d60: 4445 5343 2e0a 2020 2020 2020 2020 2020  DESC..          
+00018d70: 2020 2320 4578 3a20 4269 7474 7265 7820    # Ex: Bittrex 
+00018d80: 7265 7475 726e 7320 7468 6520 6c69 7374  returns the list
+00018d90: 206f 6620 4f48 4c43 5620 696e 2041 5343   of OHLCV in ASC
+00018da0: 206f 7264 6572 2028 6f6c 6465 7374 2066   order (oldest f
+00018db0: 6972 7374 2c20 6e65 7765 7374 206c 6173  irst, newest las
+00018dc0: 7429 0a20 2020 2020 2020 2020 2020 2023  t).            #
+00018dd0: 2077 6869 6c65 2047 4441 5820 7265 7475   while GDAX retu
+00018de0: 726e 7320 7468 6520 6c69 7374 206f 6620  rns the list of 
+00018df0: 4f48 4c43 5620 696e 2044 4553 4320 6f72  OHLCV in DESC or
+00018e00: 6465 7220 286e 6577 6573 7420 6669 7273  der (newest firs
+00018e10: 742c 206f 6c64 6573 7420 6c61 7374 290a  t, oldest last).
+00018e20: 2020 2020 2020 2020 2020 2020 2320 4f6e              # On
+00018e30: 6c79 2073 6f72 7420 6966 206e 6563 6573  ly sort if neces
+00018e40: 7361 7279 2074 6f20 7361 7665 2063 6f6d  sary to save com
+00018e50: 7075 7469 6e67 2074 696d 650a 2020 2020  puting time.    
+00018e60: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00018e70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00018e80: 6461 7461 2061 6e64 2064 6174 615b 305d  data and data[0]
+00018e90: 5b30 5d20 3e20 6461 7461 5b2d 315d 5b30  [0] > data[-1][0
+00018ea0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00018eb0: 2020 2020 2020 2064 6174 6120 3d20 736f         data = so
+00018ec0: 7274 6564 2864 6174 612c 206b 6579 3d6c  rted(data, key=l
+00018ed0: 616d 6264 6120 783a 2078 5b30 5d29 0a20  ambda x: x[0]). 
+00018ee0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00018ef0: 7420 496e 6465 7845 7272 6f72 3a0a 2020  t IndexError:.  
+00018f00: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+00018f10: 6767 6572 2e65 7863 6570 7469 6f6e 2822  gger.exception("
+00018f20: 4572 726f 7220 6c6f 6164 696e 6720 2573  Error loading %s
+00018f30: 2e20 5265 7375 6c74 2077 6173 2025 732e  . Result was %s.
+00018f40: 222c 2070 6169 722c 2064 6174 6129 0a20  ", pair, data). 
+00018f50: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00018f60: 6574 7572 6e20 7061 6972 2c20 7469 6d65  eturn pair, time
+00018f70: 6672 616d 652c 2063 616e 646c 655f 7479  frame, candle_ty
+00018f80: 7065 2c20 5b5d 2c20 7365 6c66 2e5f 6f68  pe, [], self._oh
+00018f90: 6c63 765f 7061 7274 6961 6c5f 6361 6e64  lcv_partial_cand
+00018fa0: 6c65 0a20 2020 2020 2020 2020 2020 206c  le.            l
+00018fb0: 6f67 6765 722e 6465 6275 6728 2244 6f6e  ogger.debug("Don
+00018fc0: 6520 6665 7463 6869 6e67 2070 6169 7220  e fetching pair 
+00018fd0: 2573 2c20 2573 2069 6e74 6572 7661 6c20  %s, %s interval 
+00018fe0: 2573 2e2e 2e22 2c20 7061 6972 2c20 6361  %s...", pair, ca
+00018ff0: 6e64 6c65 5f74 7970 652c 2074 696d 6566  ndle_type, timef
+00019000: 7261 6d65 290a 2020 2020 2020 2020 2020  rame).          
+00019010: 2020 7265 7475 726e 2070 6169 722c 2074    return pair, t
+00019020: 696d 6566 7261 6d65 2c20 6361 6e64 6c65  imeframe, candle
+00019030: 5f74 7970 652c 2064 6174 612c 2073 656c  _type, data, sel
+00019040: 662e 5f6f 686c 6376 5f70 6172 7469 616c  f._ohlcv_partial
+00019050: 5f63 616e 646c 650a 0a20 2020 2020 2020  _candle..       
+00019060: 2065 7863 6570 7420 6363 7874 2e4e 6f74   except ccxt.Not
+00019070: 5375 7070 6f72 7465 6420 6173 2065 3a0a  Supported as e:.
+00019080: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00019090: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+000190a0: 6570 7469 6f6e 280a 2020 2020 2020 2020  eption(.        
+000190b0: 2020 2020 2020 2020 6627 4578 6368 616e          f'Exchan
+000190c0: 6765 207b 7365 6c66 2e5f 6170 692e 6e61  ge {self._api.na
+000190d0: 6d65 7d20 646f 6573 206e 6f74 2073 7570  me} does not sup
+000190e0: 706f 7274 2066 6574 6368 696e 6720 6869  port fetching hi
+000190f0: 7374 6f72 6963 616c 2027 0a20 2020 2020  storical '.     
+00019100: 2020 2020 2020 2020 2020 2066 2763 616e             f'can
+00019110: 646c 6520 284f 484c 4356 2920 6461 7461  dle (OHLCV) data
+00019120: 2e20 4d65 7373 6167 653a 207b 657d 2729  . Message: {e}')
+00019130: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
+00019140: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+00019150: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+00019160: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00019170: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+00019180: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+00019190: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+000191a0: 2e4f 7065 7261 7469 6f6e 4661 696c 6564  .OperationFailed
+000191b0: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+000191c0: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+000191d0: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+000191e0: 6d70 6f72 6172 7945 7272 6f72 2866 2743  mporaryError(f'C
+000191f0: 6f75 6c64 206e 6f74 2066 6574 6368 2068  ould not fetch h
+00019200: 6973 746f 7269 6361 6c20 6361 6e64 6c65  istorical candle
+00019210: 2028 4f48 4c43 5629 2064 6174 6120 270a   (OHLCV) data '.
+00019220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019240: 2066 2766 6f72 2070 6169 7220 7b70 6169   f'for pair {pai
+00019250: 727d 2064 7565 2074 6f20 7b65 2e5f 5f63  r} due to {e.__c
+00019260: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+00019270: 2e20 270a 2020 2020 2020 2020 2020 2020  . '.            
+00019280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019290: 2020 2020 2066 274d 6573 7361 6765 3a20       f'Message: 
+000192a0: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+000192b0: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+000192c0: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
+000192d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+000192e0: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+000192f0: 6365 7074 696f 6e28 6627 436f 756c 6420  ception(f'Could 
+00019300: 6e6f 7420 6665 7463 6820 6869 7374 6f72  not fetch histor
+00019310: 6963 616c 2063 616e 646c 6520 284f 484c  ical candle (OHL
+00019320: 4356 2920 6461 7461 2027 0a20 2020 2020  CV) data '.     
+00019330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019350: 2020 6627 666f 7220 7061 6972 207b 7061    f'for pair {pa
+00019360: 6972 7d2e 204d 6573 7361 6765 3a20 7b65  ir}. Message: {e
+00019370: 7d27 2920 6672 6f6d 2065 0a0a 2020 2020  }') from e..    
+00019380: 6173 796e 6320 6465 6620 5f66 6574 6368  async def _fetch
+00019390: 5f66 756e 6469 6e67 5f72 6174 655f 6869  _funding_rate_hi
+000193a0: 7374 6f72 7928 0a20 2020 2020 2020 2073  story(.        s
+000193b0: 656c 662c 0a20 2020 2020 2020 2070 6169  elf,.        pai
+000193c0: 723a 2073 7472 2c0a 2020 2020 2020 2020  r: str,.        
+000193d0: 7469 6d65 6672 616d 653a 2073 7472 2c0a  timeframe: str,.
+000193e0: 2020 2020 2020 2020 6c69 6d69 743a 2069          limit: i
+000193f0: 6e74 2c0a 2020 2020 2020 2020 7369 6e63  nt,.        sinc
+00019400: 655f 6d73 3a20 4f70 7469 6f6e 616c 5b69  e_ms: Optional[i
+00019410: 6e74 5d20 3d20 4e6f 6e65 2c0a 2020 2020  nt] = None,.    
+00019420: 2920 2d3e 204c 6973 745b 4c69 7374 5d3a  ) -> List[List]:
+00019430: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00019440: 2020 2020 2046 6574 6368 2066 756e 6469       Fetch fundi
+00019450: 6e67 2072 6174 6520 6869 7374 6f72 7920  ng rate history 
+00019460: 2d20 7573 6564 2074 6f20 7365 6c65 6374  - used to select
+00019470: 6976 656c 7920 6f76 6572 7269 6465 2074  ively override t
+00019480: 6869 7320 6279 2073 7562 636c 6173 7365  his by subclasse
+00019490: 732e 0a20 2020 2020 2020 2022 2222 0a20  s..        """. 
+000194a0: 2020 2020 2020 2023 2046 756e 6469 6e67         # Funding
+000194b0: 2072 6174 650a 2020 2020 2020 2020 6461   rate.        da
+000194c0: 7461 203d 2061 7761 6974 2073 656c 662e  ta = await self.
+000194d0: 5f61 7069 5f61 7379 6e63 2e66 6574 6368  _api_async.fetch
+000194e0: 5f66 756e 6469 6e67 5f72 6174 655f 6869  _funding_rate_hi
+000194f0: 7374 6f72 7928 0a20 2020 2020 2020 2020  story(.         
+00019500: 2020 2070 6169 722c 2073 696e 6365 3d73     pair, since=s
+00019510: 696e 6365 5f6d 732c 0a20 2020 2020 2020  ince_ms,.       
+00019520: 2020 2020 206c 696d 6974 3d6c 696d 6974       limit=limit
+00019530: 290a 2020 2020 2020 2020 2320 436f 6e76  ).        # Conv
+00019540: 6572 7420 6675 6e64 696e 6720 7261 7465  ert funding rate
+00019550: 2074 6f20 6361 6e64 6c65 2070 6174 7465   to candle patte
+00019560: 726e 0a20 2020 2020 2020 2064 6174 6120  rn.        data 
+00019570: 3d20 5b5b 785b 2774 696d 6573 7461 6d70  = [[x['timestamp
+00019580: 275d 2c20 785b 2766 756e 6469 6e67 5261  '], x['fundingRa
+00019590: 7465 275d 2c20 302c 2030 2c20 302c 2030  te'], 0, 0, 0, 0
+000195a0: 5d20 666f 7220 7820 696e 2064 6174 615d  ] for x in data]
+000195b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000195c0: 6461 7461 0a0a 2020 2020 2320 4665 7463  data..    # Fetc
+000195d0: 6820 6869 7374 6f72 6963 2074 7261 6465  h historic trade
+000195e0: 730a 0a20 2020 2040 7265 7472 6965 725f  s..    @retrier_
+000195f0: 6173 796e 630a 2020 2020 6173 796e 6320  async.    async 
+00019600: 6465 6620 5f61 7379 6e63 5f66 6574 6368  def _async_fetch
+00019610: 5f74 7261 6465 7328 7365 6c66 2c20 7061  _trades(self, pa
+00019620: 6972 3a20 7374 722c 0a20 2020 2020 2020  ir: str,.       
+00019630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019640: 2020 2020 2020 2020 2020 2073 696e 6365             since
+00019650: 3a20 4f70 7469 6f6e 616c 5b69 6e74 5d20  : Optional[int] 
+00019660: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00019670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019680: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+00019690: 3a20 4f70 7469 6f6e 616c 5b64 6963 745d  : Optional[dict]
+000196a0: 203d 204e 6f6e 6529 202d 3e20 5475 706c   = None) -> Tupl
+000196b0: 655b 4c69 7374 5b4c 6973 745d 2c20 416e  e[List[List], An
+000196c0: 795d 3a0a 2020 2020 2020 2020 2222 220a  y]:.        """.
+000196d0: 2020 2020 2020 2020 4173 796e 6368 726f          Asynchro
+000196e0: 6e6f 7573 6c79 2067 6574 7320 7472 6164  nously gets trad
+000196f0: 6520 6869 7374 6f72 7920 7573 696e 6720  e history using 
+00019700: 6665 7463 685f 7472 6164 6573 2e0a 2020  fetch_trades..  
+00019710: 2020 2020 2020 4861 6e64 6c65 7320 6578        Handles ex
+00019720: 6368 616e 6765 2065 7272 6f72 732c 2064  change errors, d
+00019730: 6f65 7320 6f6e 6520 6361 6c6c 2074 6f20  oes one call to 
+00019740: 7468 6520 6578 6368 616e 6765 2e0a 2020  the exchange..  
+00019750: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
+00019760: 723a 2050 6169 7220 746f 2066 6574 6368  r: Pair to fetch
+00019770: 2074 7261 6465 2064 6174 6120 666f 720a   trade data for.
+00019780: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+00019790: 696e 6365 3a20 5369 6e63 6520 6173 2069  ince: Since as i
+000197a0: 6e74 6567 6572 2074 696d 6573 7461 6d70  nteger timestamp
+000197b0: 2069 6e20 6d69 6c6c 6973 6563 6f6e 6473   in milliseconds
+000197c0: 0a20 2020 2020 2020 2072 6574 7572 6e73  .        returns
+000197d0: 3a20 4c69 7374 206f 6620 6469 6374 7320  : List of dicts 
+000197e0: 636f 6e74 6169 6e69 6e67 2074 7261 6465  containing trade
+000197f0: 732c 2074 6865 206e 6578 7420 6974 6572  s, the next iter
+00019800: 6174 696f 6e20 7661 6c75 6520 286e 6577  ation value (new
+00019810: 2022 7369 6e63 6522 206f 7220 7472 6164   "since" or trad
+00019820: 655f 6964 290a 2020 2020 2020 2020 2222  e_id).        ""
+00019830: 220a 2020 2020 2020 2020 7472 793a 0a20  ".        try:. 
+00019840: 2020 2020 2020 2020 2020 2023 2066 6574             # fet
+00019850: 6368 2074 7261 6465 7320 6173 796e 6368  ch trades asynch
+00019860: 726f 6e6f 7573 6c79 0a20 2020 2020 2020  ronously.       
+00019870: 2020 2020 2069 6620 7061 7261 6d73 3a0a       if params:.
+00019880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019890: 6c6f 6767 6572 2e64 6562 7567 2822 4665  logger.debug("Fe
+000198a0: 7463 6869 6e67 2074 7261 6465 7320 666f  tching trades fo
+000198b0: 7220 7061 6972 2025 732c 2070 6172 616d  r pair %s, param
+000198c0: 733a 2025 7320 222c 2070 6169 722c 2070  s: %s ", pair, p
+000198d0: 6172 616d 7329 0a20 2020 2020 2020 2020  arams).         
+000198e0: 2020 2020 2020 2074 7261 6465 7320 3d20         trades = 
+000198f0: 6177 6169 7420 7365 6c66 2e5f 6170 695f  await self._api_
+00019900: 6173 796e 632e 6665 7463 685f 7472 6164  async.fetch_trad
+00019910: 6573 2870 6169 722c 2070 6172 616d 733d  es(pair, params=
+00019920: 7061 7261 6d73 2c20 6c69 6d69 743d 3130  params, limit=10
+00019930: 3030 290a 2020 2020 2020 2020 2020 2020  00).            
+00019940: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00019950: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
+00019960: 7567 280a 2020 2020 2020 2020 2020 2020  ug(.            
+00019970: 2020 2020 2020 2020 2246 6574 6368 696e          "Fetchin
+00019980: 6720 7472 6164 6573 2066 6f72 2070 6169  g trades for pai
+00019990: 7220 2573 2c20 7369 6e63 6520 2573 2025  r %s, since %s %
+000199a0: 732e 2e2e 222c 0a20 2020 2020 2020 2020  s...",.         
+000199b0: 2020 2020 2020 2020 2020 2070 6169 722c             pair,
+000199c0: 2073 696e 6365 2c0a 2020 2020 2020 2020   since,.        
+000199d0: 2020 2020 2020 2020 2020 2020 2728 2720              '(' 
+000199e0: 2b20 6474 5f66 726f 6d5f 7473 2873 696e  + dt_from_ts(sin
+000199f0: 6365 292e 6973 6f66 6f72 6d61 7428 2920  ce).isoformat() 
+00019a00: 2b20 2729 2027 2069 6620 7369 6e63 6520  + ') ' if since 
+00019a10: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+00019a20: 2027 270a 2020 2020 2020 2020 2020 2020   ''.            
+00019a30: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00019a40: 2020 2020 2020 7472 6164 6573 203d 2061        trades = a
+00019a50: 7761 6974 2073 656c 662e 5f61 7069 5f61  wait self._api_a
+00019a60: 7379 6e63 2e66 6574 6368 5f74 7261 6465  sync.fetch_trade
+00019a70: 7328 7061 6972 2c20 7369 6e63 653d 7369  s(pair, since=si
+00019a80: 6e63 652c 206c 696d 6974 3d31 3030 3029  nce, limit=1000)
+00019a90: 0a20 2020 2020 2020 2020 2020 2074 7261  .            tra
+00019aa0: 6465 7320 3d20 7365 6c66 2e5f 7472 6164  des = self._trad
+00019ab0: 6573 5f63 6f6e 7472 6163 7473 5f74 6f5f  es_contracts_to_
+00019ac0: 616d 6f75 6e74 2874 7261 6465 7329 0a20  amount(trades). 
+00019ad0: 2020 2020 2020 2020 2020 2070 6167 696e             pagin
+00019ae0: 6174 696f 6e5f 7661 6c75 6520 3d20 7365  ation_value = se
+00019af0: 6c66 2e5f 6765 745f 7472 6164 655f 7061  lf._get_trade_pa
+00019b00: 6769 6e61 7469 6f6e 5f6e 6578 745f 7661  gination_next_va
+00019b10: 6c75 6528 7472 6164 6573 290a 2020 2020  lue(trades).    
+00019b20: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00019b30: 7261 6465 735f 6469 6374 5f74 6f5f 6c69  rades_dict_to_li
+00019b40: 7374 2874 7261 6465 7329 2c20 7061 6769  st(trades), pagi
+00019b50: 6e61 7469 6f6e 5f76 616c 7565 0a20 2020  nation_value.   
+00019b60: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+00019b70: 2e4e 6f74 5375 7070 6f72 7465 6420 6173  .NotSupported as
+00019b80: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00019b90: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00019ba0: 6c45 7863 6570 7469 6f6e 280a 2020 2020  lException(.    
+00019bb0: 2020 2020 2020 2020 2020 2020 6627 4578              f'Ex
+00019bc0: 6368 616e 6765 207b 7365 6c66 2e5f 6170  change {self._ap
+00019bd0: 692e 6e61 6d65 7d20 646f 6573 206e 6f74  i.name} does not
+00019be0: 2073 7570 706f 7274 2066 6574 6368 696e   support fetchin
+00019bf0: 6720 6869 7374 6f72 6963 616c 2074 7261  g historical tra
+00019c00: 6465 2064 6174 612e 270a 2020 2020 2020  de data.'.      
+00019c10: 2020 2020 2020 2020 2020 6627 4d65 7373            f'Mess
+00019c20: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
+00019c30: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
+00019c40: 2063 6378 742e 4444 6f53 5072 6f74 6563   ccxt.DDoSProtec
+00019c50: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
+00019c60: 2020 2020 2020 2072 6169 7365 2044 446f         raise DDo
+00019c70: 7350 726f 7465 6374 696f 6e28 6529 2066  sProtection(e) f
+00019c80: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
+00019c90: 6365 7074 2028 6363 7874 2e4f 7065 7261  cept (ccxt.Opera
+00019ca0: 7469 6f6e 4661 696c 6564 2c20 6363 7874  tionFailed, ccxt
+00019cb0: 2e45 7863 6861 6e67 6545 7272 6f72 2920  .ExchangeError) 
+00019cc0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+00019cd0: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
+00019ce0: 7945 7272 6f72 2866 2743 6f75 6c64 206e  yError(f'Could n
+00019cf0: 6f74 206c 6f61 6420 7472 6164 6520 6869  ot load trade hi
+00019d00: 7374 6f72 7920 6475 6520 746f 207b 652e  story due to {e.
+00019d10: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00019d20: 5f5f 7d2e 2027 0a20 2020 2020 2020 2020  __}. '.         
+00019d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019d40: 2020 2020 2020 2020 6627 4d65 7373 6167          f'Messag
+00019d50: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
+00019d60: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+00019d70: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
+00019d80: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+00019d90: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+00019da0: 6c45 7863 6570 7469 6f6e 2866 2743 6f75  lException(f'Cou
+00019db0: 6c64 206e 6f74 2066 6574 6368 2074 7261  ld not fetch tra
+00019dc0: 6465 2064 6174 612e 204d 7367 3a20 7b65  de data. Msg: {e
+00019dd0: 7d27 2920 6672 6f6d 2065 0a0a 2020 2020  }') from e..    
+00019de0: 6465 6620 5f76 616c 6964 5f74 7261 6465  def _valid_trade
+00019df0: 5f70 6167 696e 6174 696f 6e5f 6964 2873  _pagination_id(s
+00019e00: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
+00019e10: 6672 6f6d 5f69 643a 2073 7472 2920 2d3e  from_id: str) ->
+00019e20: 2062 6f6f 6c3a 0a20 2020 2020 2020 2022   bool:.        "
+00019e30: 2222 0a20 2020 2020 2020 2056 6572 6966  "".        Verif
+00019e40: 7920 7472 6164 652d 7061 6769 6e61 7469  y trade-paginati
+00019e50: 6f6e 2069 6420 6973 2076 616c 6964 2e0a  on id is valid..
+00019e60: 2020 2020 2020 2020 576f 726b 6172 6f75          Workarou
+00019e70: 6e64 2066 6f72 206f 6464 204b 7261 6b65  nd for odd Krake
+00019e80: 6e20 6973 7375 6520 7768 6572 6520 4944  n issue where ID
+00019e90: 2069 7320 736f 6d65 7469 6d65 7320 7772   is sometimes wr
+00019ea0: 6f6e 672e 0a20 2020 2020 2020 2022 2222  ong..        """
+00019eb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00019ec0: 5472 7565 0a0a 2020 2020 6465 6620 5f67  True..    def _g
+00019ed0: 6574 5f74 7261 6465 5f70 6167 696e 6174  et_trade_paginat
+00019ee0: 696f 6e5f 6e65 7874 5f76 616c 7565 2873  ion_next_value(s
+00019ef0: 656c 662c 2074 7261 6465 733a 204c 6973  elf, trades: Lis
+00019f00: 745b 4469 6374 5d29 3a0a 2020 2020 2020  t[Dict]):.      
+00019f10: 2020 2222 220a 2020 2020 2020 2020 4578    """.        Ex
+00019f20: 7472 6163 7420 7061 6769 6e61 7469 6f6e  tract pagination
+00019f30: 2069 6420 666f 7220 7468 6520 6e65 7874   id for the next
+00019f40: 2022 6672 6f6d 5f69 6422 2076 616c 7565   "from_id" value
+00019f50: 0a20 2020 2020 2020 2041 7070 6c69 6573  .        Applies
+00019f60: 206f 6e6c 7920 746f 2066 6574 6368 5f74   only to fetch_t
+00019f70: 7261 6465 5f68 6973 746f 7279 2062 7920  rade_history by 
+00019f80: 6964 2e0a 2020 2020 2020 2020 2222 220a  id..        """.
+00019f90: 2020 2020 2020 2020 6966 206e 6f74 2074          if not t
+00019fa0: 7261 6465 733a 0a20 2020 2020 2020 2020  rades:.         
+00019fb0: 2020 2072 6574 7572 6e20 4e6f 6e65 0a20     return None. 
+00019fc0: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00019fd0: 7472 6164 6573 5f70 6167 696e 6174 696f  trades_paginatio
+00019fe0: 6e20 3d3d 2027 6964 273a 0a20 2020 2020  n == 'id':.     
+00019ff0: 2020 2020 2020 2072 6574 7572 6e20 7472         return tr
+0001a000: 6164 6573 5b2d 315d 2e67 6574 2827 6964  ades[-1].get('id
+0001a010: 2729 0a20 2020 2020 2020 2065 6c73 653a  ').        else:
+0001a020: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001a030: 7572 6e20 7472 6164 6573 5b2d 315d 2e67  urn trades[-1].g
+0001a040: 6574 2827 7469 6d65 7374 616d 7027 290a  et('timestamp').
+0001a050: 0a20 2020 2061 7379 6e63 2064 6566 205f  .    async def _
+0001a060: 6173 796e 635f 6765 745f 7472 6164 655f  async_get_trade_
+0001a070: 6869 7374 6f72 795f 6964 2873 656c 662c  history_id(self,
+0001a080: 2070 6169 723a 2073 7472 2c0a 2020 2020   pair: str,.    
+0001a090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0b0: 2020 2020 2020 756e 7469 6c3a 2069 6e74        until: int
+0001a0c0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001a0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a0e0: 2020 2020 2020 2020 2020 2020 7369 6e63              sinc
+0001a0f0: 653a 204f 7074 696f 6e61 6c5b 696e 745d  e: Optional[int]
+0001a100: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+0001a110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a130: 2020 2066 726f 6d5f 6964 3a20 4f70 7469     from_id: Opti
+0001a140: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+0001a150: 2920 2d3e 2054 7570 6c65 5b73 7472 2c20  ) -> Tuple[str, 
+0001a160: 4c69 7374 5b4c 6973 745d 5d3a 0a20 2020  List[List]]:.   
+0001a170: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001a180: 2041 7379 6e63 6872 6f6e 6f75 736c 7920   Asynchronously 
+0001a190: 6765 7473 2074 7261 6465 2068 6973 746f  gets trade histo
+0001a1a0: 7279 2075 7369 6e67 2066 6574 6368 5f74  ry using fetch_t
+0001a1b0: 7261 6465 730a 2020 2020 2020 2020 7573  rades.        us
+0001a1c0: 6520 7468 6973 2077 6865 6e20 6578 6368  e this when exch
+0001a1d0: 616e 6765 2075 7365 7320 6964 2d62 6173  ange uses id-bas
+0001a1e0: 6564 2069 7465 7261 7469 6f6e 2028 6368  ed iteration (ch
+0001a1f0: 6563 6b20 6073 656c 662e 5f74 7261 6465  eck `self._trade
+0001a200: 735f 7061 6769 6e61 7469 6f6e 6029 0a20  s_pagination`). 
+0001a210: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+0001a220: 6972 3a20 5061 6972 2074 6f20 6665 7463  ir: Pair to fetc
+0001a230: 6820 7472 6164 6520 6461 7461 2066 6f72  h trade data for
+0001a240: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001a250: 7369 6e63 653a 2053 696e 6365 2061 7320  since: Since as 
+0001a260: 696e 7465 6765 7220 7469 6d65 7374 616d  integer timestam
+0001a270: 7020 696e 206d 696c 6c69 7365 636f 6e64  p in millisecond
+0001a280: 730a 2020 2020 2020 2020 3a70 6172 616d  s.        :param
+0001a290: 2075 6e74 696c 3a20 556e 7469 6c20 6173   until: Until as
+0001a2a0: 2069 6e74 6567 6572 2074 696d 6573 7461   integer timesta
+0001a2b0: 6d70 2069 6e20 6d69 6c6c 6973 6563 6f6e  mp in millisecon
+0001a2c0: 6473 0a20 2020 2020 2020 203a 7061 7261  ds.        :para
+0001a2d0: 6d20 6672 6f6d 5f69 643a 2044 6f77 6e6c  m from_id: Downl
+0001a2e0: 6f61 6420 6461 7461 2073 7461 7274 696e  oad data startin
+0001a2f0: 6720 7769 7468 2049 4420 2869 6620 6964  g with ID (if id
+0001a300: 2069 7320 6b6e 6f77 6e29 2e20 4967 6e6f   is known). Igno
+0001a310: 7265 7320 2273 696e 6365 2220 6966 2073  res "since" if s
+0001a320: 6574 2e0a 2020 2020 2020 2020 7265 7475  et..        retu
+0001a330: 726e 7320 7475 706c 653a 2028 7061 6972  rns tuple: (pair
+0001a340: 2c20 7472 6164 6573 2d6c 6973 7429 0a20  , trades-list). 
+0001a350: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0001a360: 2020 2020 7472 6164 6573 3a20 4c69 7374      trades: List
+0001a370: 5b4c 6973 745d 203d 205b 5d0a 2020 2020  [List] = [].    
+0001a380: 2020 2020 2320 4445 4641 554c 545f 5452      # DEFAULT_TR
+0001a390: 4144 4553 5f43 4f4c 554d 4e53 3a20 3020  ADES_COLUMNS: 0 
+0001a3a0: 2d3e 2074 696d 6573 7461 6d70 0a20 2020  -> timestamp.   
+0001a3b0: 2020 2020 2023 2044 4546 4155 4c54 5f54       # DEFAULT_T
+0001a3c0: 5241 4445 535f 434f 4c55 4d4e 533a 2031  RADES_COLUMNS: 1
+0001a3d0: 202d 3e20 6964 0a20 2020 2020 2020 2068   -> id.        h
+0001a3e0: 6173 5f6f 7665 726c 6170 203d 2073 656c  as_overlap = sel
+0001a3f0: 662e 5f66 745f 6861 732e 6765 7428 2774  f._ft_has.get('t
+0001a400: 7261 6465 735f 7061 6769 6e61 7469 6f6e  rades_pagination
+0001a410: 5f6f 7665 726c 6170 272c 2054 7275 6529  _overlap', True)
+0001a420: 0a20 2020 2020 2020 2023 2053 6b69 7020  .        # Skip 
+0001a430: 6c61 7374 2074 7261 6465 2062 7920 6465  last trade by de
+0001a440: 6661 756c 7420 7369 6e63 6520 6974 7320  fault since its 
+0001a450: 7468 6520 6b65 7920 666f 7220 7468 6520  the key for the 
+0001a460: 6e65 7874 2063 616c 6c0a 2020 2020 2020  next call.      
+0001a470: 2020 7820 3d20 736c 6963 6528 4e6f 6e65    x = slice(None
+0001a480: 2c20 2d31 2920 6966 2068 6173 5f6f 7665  , -1) if has_ove
+0001a490: 726c 6170 2065 6c73 6520 736c 6963 6528  rlap else slice(
+0001a4a0: 4e6f 6e65 290a 0a20 2020 2020 2020 2069  None)..        i
+0001a4b0: 6620 6e6f 7420 6672 6f6d 5f69 6420 6f72  f not from_id or
+0001a4c0: 206e 6f74 2073 656c 662e 5f76 616c 6964   not self._valid
+0001a4d0: 5f74 7261 6465 5f70 6167 696e 6174 696f  _trade_paginatio
+0001a4e0: 6e5f 6964 2870 6169 722c 2066 726f 6d5f  n_id(pair, from_
+0001a4f0: 6964 293a 0a20 2020 2020 2020 2020 2020  id):.           
+0001a500: 2023 2046 6574 6368 2066 6972 7374 2065   # Fetch first e
+0001a510: 6c65 6d65 6e74 7320 7573 696e 6720 7469  lements using ti
+0001a520: 6d65 6261 7365 6420 6d65 7468 6f64 2074  mebased method t
+0001a530: 6f20 6765 7420 616e 2049 4420 746f 2070  o get an ID to p
+0001a540: 6167 696e 6174 6520 6f6e 0a20 2020 2020  aginate on.     
+0001a550: 2020 2020 2020 2023 2044 6570 656e 6469         # Dependi
+0001a560: 6e67 206f 6e20 7468 6520 4578 6368 616e  ng on the Exchan
+0001a570: 6765 2c20 7468 6973 2063 616e 2069 6e74  ge, this can int
+0001a580: 726f 6475 6365 2061 2064 7269 6674 2061  roduce a drift a
+0001a590: 7420 7468 6520 7374 6172 7420 6f66 2074  t the start of t
+0001a5a0: 6865 2069 6e74 6572 7661 6c0a 2020 2020  he interval.    
+0001a5b0: 2020 2020 2020 2020 2320 6f66 2075 7020          # of up 
+0001a5c0: 746f 2061 6e20 686f 7572 2e0a 2020 2020  to an hour..    
+0001a5d0: 2020 2020 2020 2020 2320 652e 672e 2042          # e.g. B
+0001a5e0: 696e 616e 6365 2072 6574 7572 6e73 2074  inance returns t
+0001a5f0: 6865 2022 6c61 7374 2031 3030 3022 2063  he "last 1000" c
+0001a600: 616e 646c 6573 2077 6974 6869 6e20 6120  andles within a 
+0001a610: 3168 2074 696d 6520 696e 7465 7276 616c  1h time interval
+0001a620: 0a20 2020 2020 2020 2020 2020 2023 202d  .            # -
+0001a630: 2073 6f20 7765 2077 696c 6c20 6d69 7373   so we will miss
+0001a640: 2074 6865 2066 6972 7374 2074 7261 6465   the first trade
+0001a650: 732e 0a20 2020 2020 2020 2020 2020 2074  s..            t
+0001a660: 2c20 6672 6f6d 5f69 6420 3d20 6177 6169  , from_id = awai
+0001a670: 7420 7365 6c66 2e5f 6173 796e 635f 6665  t self._async_fe
+0001a680: 7463 685f 7472 6164 6573 2870 6169 722c  tch_trades(pair,
+0001a690: 2073 696e 6365 3d73 696e 6365 290a 2020   since=since).  
+0001a6a0: 2020 2020 2020 2020 2020 7472 6164 6573            trades
+0001a6b0: 2e65 7874 656e 6428 745b 785d 290a 2020  .extend(t[x]).  
+0001a6c0: 2020 2020 2020 7768 696c 6520 5472 7565        while True
+0001a6d0: 3a0a 2020 2020 2020 2020 2020 2020 7472  :.            tr
+0001a6e0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0001a6f0: 2020 2074 2c20 6672 6f6d 5f69 645f 6e65     t, from_id_ne
+0001a700: 7874 203d 2061 7761 6974 2073 656c 662e  xt = await self.
+0001a710: 5f61 7379 6e63 5f66 6574 6368 5f74 7261  _async_fetch_tra
+0001a720: 6465 7328 0a20 2020 2020 2020 2020 2020  des(.           
+0001a730: 2020 2020 2020 2020 2070 6169 722c 2070           pair, p
+0001a740: 6172 616d 733d 7b73 656c 662e 5f74 7261  arams={self._tra
+0001a750: 6465 735f 7061 6769 6e61 7469 6f6e 5f61  des_pagination_a
+0001a760: 7267 3a20 6672 6f6d 5f69 647d 290a 2020  rg: from_id}).  
+0001a770: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001a780: 2074 3a0a 2020 2020 2020 2020 2020 2020   t:.            
+0001a790: 2020 2020 2020 2020 7472 6164 6573 2e65          trades.e
+0001a7a0: 7874 656e 6428 745b 785d 290a 2020 2020  xtend(t[x]).    
+0001a7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a7c0: 6966 2066 726f 6d5f 6964 203d 3d20 6672  if from_id == fr
+0001a7d0: 6f6d 5f69 645f 6e65 7874 206f 7220 745b  om_id_next or t[
+0001a7e0: 2d31 5d5b 305d 203e 2075 6e74 696c 3a0a  -1][0] > until:.
 0001a7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a800: 2020 2020 6966 2068 6173 5f6f 7665 726c      if has_overl
-0001a810: 6170 3a0a 2020 2020 2020 2020 2020 2020  ap:.            
-0001a820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a830: 7472 6164 6573 2e65 7874 656e 6428 745b  trades.extend(t[
-0001a840: 2d31 3a5d 290a 2020 2020 2020 2020 2020  -1:]).          
-0001a850: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0001a860: 6561 6b0a 0a20 2020 2020 2020 2020 2020  eak..           
-0001a870: 2020 2020 2020 2020 2066 726f 6d5f 6964           from_id
-0001a880: 203d 2066 726f 6d5f 6964 5f6e 6578 740a   = from_id_next.
+0001a800: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
+0001a810: 6562 7567 2866 2253 746f 7070 696e 6720  ebug(f"Stopping 
+0001a820: 6265 6361 7573 6520 6672 6f6d 5f69 6420  because from_id 
+0001a830: 6469 6420 6e6f 7420 6368 616e 6765 2e20  did not change. 
+0001a840: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+0001a850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a860: 2020 2020 2020 2066 2252 6561 6368 6564         f"Reached
+0001a870: 207b 745b 2d31 5d5b 305d 7d20 3e20 7b75   {t[-1][0]} > {u
+0001a880: 6e74 696c 7d22 290a 2020 2020 2020 2020  ntil}").        
 0001a890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a8a0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001a8b0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-0001a8c0: 2e64 6562 7567 2822 5374 6f70 7069 6e67  .debug("Stopping
-0001a8d0: 2061 7320 6e6f 206d 6f72 6520 7472 6164   as no more trad
-0001a8e0: 6573 2077 6572 6520 7265 7475 726e 6564  es were returned
-0001a8f0: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0001a900: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-0001a910: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0001a920: 2061 7379 6e63 696f 2e43 616e 6365 6c6c   asyncio.Cancell
-0001a930: 6564 4572 726f 723a 0a20 2020 2020 2020  edError:.       
-0001a940: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0001a950: 6465 6275 6728 2241 7379 6e63 206f 7065  debug("Async ope
-0001a960: 7261 7469 6f6e 2049 6e74 6572 7275 7074  ration Interrupt
-0001a970: 6564 2c20 6272 6561 6b69 6e67 2074 7261  ed, breaking tra
-0001a980: 6465 7320 444c 206c 6f6f 702e 2229 0a20  des DL loop."). 
-0001a990: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0001a9a0: 7265 616b 0a0a 2020 2020 2020 2020 7265  reak..        re
-0001a9b0: 7475 726e 2028 7061 6972 2c20 7472 6164  turn (pair, trad
-0001a9c0: 6573 290a 0a20 2020 2061 7379 6e63 2064  es)..    async d
-0001a9d0: 6566 205f 6173 796e 635f 6765 745f 7472  ef _async_get_tr
-0001a9e0: 6164 655f 6869 7374 6f72 795f 7469 6d65  ade_history_time
-0001a9f0: 2873 656c 662c 2070 6169 723a 2073 7472  (self, pair: str
-0001aa00: 2c20 756e 7469 6c3a 2069 6e74 2c0a 2020  , until: int,.  
-0001aa10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aa30: 2020 2020 2020 2020 2020 7369 6e63 653a            since:
-0001aa40: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-0001aa50: 204e 6f6e 6529 202d 3e20 5475 706c 655b   None) -> Tuple[
-0001aa60: 7374 722c 204c 6973 745b 4c69 7374 5d5d  str, List[List]]
-0001aa70: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-0001aa80: 2020 2020 2020 4173 796e 6372 6f6e 6f75        Asyncronou
-0001aa90: 736c 7920 6765 7473 2074 7261 6465 2068  sly gets trade h
-0001aaa0: 6973 746f 7279 2075 7369 6e67 2066 6574  istory using fet
-0001aab0: 6368 5f74 7261 6465 732c 0a20 2020 2020  ch_trades,.     
-0001aac0: 2020 2077 6865 6e20 7468 6520 6578 6368     when the exch
-0001aad0: 616e 6765 2075 7365 7320 7469 6d65 2d62  ange uses time-b
-0001aae0: 6173 6564 2069 7465 7261 7469 6f6e 2028  ased iteration (
-0001aaf0: 6368 6563 6b20 6073 656c 662e 5f74 7261  check `self._tra
-0001ab00: 6465 735f 7061 6769 6e61 7469 6f6e 6029  des_pagination`)
-0001ab10: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0001ab20: 7061 6972 3a20 5061 6972 2074 6f20 6665  pair: Pair to fe
-0001ab30: 7463 6820 7472 6164 6520 6461 7461 2066  tch trade data f
-0001ab40: 6f72 0a20 2020 2020 2020 203a 7061 7261  or.        :para
-0001ab50: 6d20 7369 6e63 653a 2053 696e 6365 2061  m since: Since a
-0001ab60: 7320 696e 7465 6765 7220 7469 6d65 7374  s integer timest
-0001ab70: 616d 7020 696e 206d 696c 6c69 7365 636f  amp in milliseco
-0001ab80: 6e64 730a 2020 2020 2020 2020 3a70 6172  nds.        :par
-0001ab90: 616d 2075 6e74 696c 3a20 556e 7469 6c20  am until: Until 
-0001aba0: 6173 2069 6e74 6567 6572 2074 696d 6573  as integer times
-0001abb0: 7461 6d70 2069 6e20 6d69 6c6c 6973 6563  tamp in millisec
-0001abc0: 6f6e 6473 0a20 2020 2020 2020 2072 6574  onds.        ret
-0001abd0: 7572 6e73 2074 7570 6c65 3a20 2870 6169  urns tuple: (pai
-0001abe0: 722c 2074 7261 6465 732d 6c69 7374 290a  r, trades-list).
-0001abf0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0001ac00: 2020 2020 2074 7261 6465 733a 204c 6973       trades: Lis
-0001ac10: 745b 4c69 7374 5d20 3d20 5b5d 0a20 2020  t[List] = [].   
-0001ac20: 2020 2020 2023 2044 4546 4155 4c54 5f54       # DEFAULT_T
-0001ac30: 5241 4445 535f 434f 4c55 4d4e 533a 2030  RADES_COLUMNS: 0
-0001ac40: 202d 3e20 7469 6d65 7374 616d 700a 2020   -> timestamp.  
-0001ac50: 2020 2020 2020 2320 4445 4641 554c 545f        # DEFAULT_
-0001ac60: 5452 4144 4553 5f43 4f4c 554d 4e53 3a20  TRADES_COLUMNS: 
-0001ac70: 3120 2d3e 2069 640a 2020 2020 2020 2020  1 -> id.        
-0001ac80: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
-0001ac90: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0001aca0: 2020 2020 2020 2020 2020 2020 2074 2c20               t, 
-0001acb0: 7369 6e63 655f 6e65 7874 203d 2061 7761  since_next = awa
-0001acc0: 6974 2073 656c 662e 5f61 7379 6e63 5f66  it self._async_f
-0001acd0: 6574 6368 5f74 7261 6465 7328 7061 6972  etch_trades(pair
-0001ace0: 2c20 7369 6e63 653d 7369 6e63 6529 0a20  , since=since). 
-0001acf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001ad00: 6620 743a 0a20 2020 2020 2020 2020 2020  f t:.           
-0001ad10: 2020 2020 2020 2020 2023 204e 6f20 6d6f           # No mo
-0001ad20: 7265 2074 7261 6465 7320 746f 2064 6f77  re trades to dow
-0001ad30: 6e6c 6f61 6420 6176 6169 6c61 626c 6520  nload available 
-0001ad40: 6174 2074 6865 2065 7863 6861 6e67 652c  at the exchange,
-0001ad50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ad60: 2020 2020 2023 2053 6f20 7765 2072 6570       # So we rep
-0001ad70: 6561 7465 646c 7920 6765 7420 7468 6520  eatedly get the 
-0001ad80: 7361 6d65 2074 7261 6465 206f 7665 7220  same trade over 
-0001ad90: 616e 6420 6f76 6572 2061 6761 696e 2e0a  and over again..
-0001ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001adb0: 2020 2020 6966 2073 696e 6365 203d 3d20      if since == 
-0001adc0: 7369 6e63 655f 6e65 7874 2061 6e64 206c  since_next and l
-0001add0: 656e 2874 2920 3d3d 2031 3a0a 2020 2020  en(t) == 1:.    
-0001ade0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001adf0: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
-0001ae00: 2822 5374 6f70 7069 6e67 2062 6563 6175  ("Stopping becau
-0001ae10: 7365 206e 6f20 6d6f 7265 2074 7261 6465  se no more trade
-0001ae20: 7320 6172 6520 6176 6169 6c61 626c 652e  s are available.
-0001ae30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-0001ae40: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0001a8a0: 2320 5265 6163 6865 6420 7468 6520 656e  # Reached the en
+0001a8b0: 6420 6f66 2074 6865 2064 6566 696e 6564  d of the defined
+0001a8c0: 2d64 6f77 6e6c 6f61 6420 7065 7269 6f64  -download period
+0001a8d0: 202d 2061 6464 206c 6173 7420 7472 6164   - add last trad
+0001a8e0: 6520 6173 2077 656c 6c2e 0a20 2020 2020  e as well..     
+0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a900: 2020 2069 6620 6861 735f 6f76 6572 6c61     if has_overla
+0001a910: 703a 0a20 2020 2020 2020 2020 2020 2020  p:.             
+0001a920: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001a930: 7261 6465 732e 6578 7465 6e64 2874 5b2d  rades.extend(t[-
+0001a940: 313a 5d29 0a20 2020 2020 2020 2020 2020  1:]).           
+0001a950: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+0001a960: 616b 0a0a 2020 2020 2020 2020 2020 2020  ak..            
+0001a970: 2020 2020 2020 2020 6672 6f6d 5f69 6420          from_id 
+0001a980: 3d20 6672 6f6d 5f69 645f 6e65 7874 0a20  = from_id_next. 
+0001a990: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+0001a9a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001a9b0: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+0001a9c0: 6465 6275 6728 2253 746f 7070 696e 6720  debug("Stopping 
+0001a9d0: 6173 206e 6f20 6d6f 7265 2074 7261 6465  as no more trade
+0001a9e0: 7320 7765 7265 2072 6574 7572 6e65 642e  s were returned.
+0001a9f0: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001aa00: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+0001aa10: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0001aa20: 6173 796e 6369 6f2e 4361 6e63 656c 6c65  asyncio.Cancelle
+0001aa30: 6445 7272 6f72 3a0a 2020 2020 2020 2020  dError:.        
+0001aa40: 2020 2020 2020 2020 6c6f 6767 6572 2e64          logger.d
+0001aa50: 6562 7567 2822 4173 796e 6320 6f70 6572  ebug("Async oper
+0001aa60: 6174 696f 6e20 496e 7465 7272 7570 7465  ation Interrupte
+0001aa70: 642c 2062 7265 616b 696e 6720 7472 6164  d, breaking trad
+0001aa80: 6573 2044 4c20 6c6f 6f70 2e22 290a 2020  es DL loop.").  
+0001aa90: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0001aaa0: 6561 6b0a 0a20 2020 2020 2020 2072 6574  eak..        ret
+0001aab0: 7572 6e20 2870 6169 722c 2074 7261 6465  urn (pair, trade
+0001aac0: 7329 0a0a 2020 2020 6173 796e 6320 6465  s)..    async de
+0001aad0: 6620 5f61 7379 6e63 5f67 6574 5f74 7261  f _async_get_tra
+0001aae0: 6465 5f68 6973 746f 7279 5f74 696d 6528  de_history_time(
+0001aaf0: 7365 6c66 2c20 7061 6972 3a20 7374 722c  self, pair: str,
+0001ab00: 2075 6e74 696c 3a20 696e 742c 0a20 2020   until: int,.   
+0001ab10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ab30: 2020 2020 2020 2020 2073 696e 6365 3a20           since: 
+0001ab40: 4f70 7469 6f6e 616c 5b69 6e74 5d20 3d20  Optional[int] = 
+0001ab50: 4e6f 6e65 2920 2d3e 2054 7570 6c65 5b73  None) -> Tuple[s
+0001ab60: 7472 2c20 4c69 7374 5b4c 6973 745d 5d3a  tr, List[List]]:
+0001ab70: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001ab80: 2020 2020 2041 7379 6e63 6872 6f6e 6f75       Asynchronou
+0001ab90: 736c 7920 6765 7473 2074 7261 6465 2068  sly gets trade h
+0001aba0: 6973 746f 7279 2075 7369 6e67 2066 6574  istory using fet
+0001abb0: 6368 5f74 7261 6465 732c 0a20 2020 2020  ch_trades,.     
+0001abc0: 2020 2077 6865 6e20 7468 6520 6578 6368     when the exch
+0001abd0: 616e 6765 2075 7365 7320 7469 6d65 2d62  ange uses time-b
+0001abe0: 6173 6564 2069 7465 7261 7469 6f6e 2028  ased iteration (
+0001abf0: 6368 6563 6b20 6073 656c 662e 5f74 7261  check `self._tra
+0001ac00: 6465 735f 7061 6769 6e61 7469 6f6e 6029  des_pagination`)
+0001ac10: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001ac20: 7061 6972 3a20 5061 6972 2074 6f20 6665  pair: Pair to fe
+0001ac30: 7463 6820 7472 6164 6520 6461 7461 2066  tch trade data f
+0001ac40: 6f72 0a20 2020 2020 2020 203a 7061 7261  or.        :para
+0001ac50: 6d20 7369 6e63 653a 2053 696e 6365 2061  m since: Since a
+0001ac60: 7320 696e 7465 6765 7220 7469 6d65 7374  s integer timest
+0001ac70: 616d 7020 696e 206d 696c 6c69 7365 636f  amp in milliseco
+0001ac80: 6e64 730a 2020 2020 2020 2020 3a70 6172  nds.        :par
+0001ac90: 616d 2075 6e74 696c 3a20 556e 7469 6c20  am until: Until 
+0001aca0: 6173 2069 6e74 6567 6572 2074 696d 6573  as integer times
+0001acb0: 7461 6d70 2069 6e20 6d69 6c6c 6973 6563  tamp in millisec
+0001acc0: 6f6e 6473 0a20 2020 2020 2020 2072 6574  onds.        ret
+0001acd0: 7572 6e73 2074 7570 6c65 3a20 2870 6169  urns tuple: (pai
+0001ace0: 722c 2074 7261 6465 732d 6c69 7374 290a  r, trades-list).
+0001acf0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0001ad00: 2020 2020 2074 7261 6465 733a 204c 6973       trades: Lis
+0001ad10: 745b 4c69 7374 5d20 3d20 5b5d 0a20 2020  t[List] = [].   
+0001ad20: 2020 2020 2023 2044 4546 4155 4c54 5f54       # DEFAULT_T
+0001ad30: 5241 4445 535f 434f 4c55 4d4e 533a 2030  RADES_COLUMNS: 0
+0001ad40: 202d 3e20 7469 6d65 7374 616d 700a 2020   -> timestamp.  
+0001ad50: 2020 2020 2020 2320 4445 4641 554c 545f        # DEFAULT_
+0001ad60: 5452 4144 4553 5f43 4f4c 554d 4e53 3a20  TRADES_COLUMNS: 
+0001ad70: 3120 2d3e 2069 640a 2020 2020 2020 2020  1 -> id.        
+0001ad80: 7768 696c 6520 5472 7565 3a0a 2020 2020  while True:.    
+0001ad90: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001ada0: 2020 2020 2020 2020 2020 2020 2074 2c20               t, 
+0001adb0: 7369 6e63 655f 6e65 7874 203d 2061 7761  since_next = awa
+0001adc0: 6974 2073 656c 662e 5f61 7379 6e63 5f66  it self._async_f
+0001add0: 6574 6368 5f74 7261 6465 7328 7061 6972  etch_trades(pair
+0001ade0: 2c20 7369 6e63 653d 7369 6e63 6529 0a20  , since=since). 
+0001adf0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001ae00: 6620 743a 0a20 2020 2020 2020 2020 2020  f t:.           
+0001ae10: 2020 2020 2020 2020 2023 204e 6f20 6d6f           # No mo
+0001ae20: 7265 2074 7261 6465 7320 746f 2064 6f77  re trades to dow
+0001ae30: 6e6c 6f61 6420 6176 6169 6c61 626c 6520  nload available 
+0001ae40: 6174 2074 6865 2065 7863 6861 6e67 652c  at the exchange,
 0001ae50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ae60: 2020 2020 2073 696e 6365 203d 2073 696e       since = sin
-0001ae70: 6365 5f6e 6578 740a 2020 2020 2020 2020  ce_next.        
-0001ae80: 2020 2020 2020 2020 2020 2020 7472 6164              trad
-0001ae90: 6573 2e65 7874 656e 6428 7429 0a20 2020  es.extend(t).   
+0001ae60: 2020 2020 2023 2053 6f20 7765 2072 6570       # So we rep
+0001ae70: 6561 7465 646c 7920 6765 7420 7468 6520  eatedly get the 
+0001ae80: 7361 6d65 2074 7261 6465 206f 7665 7220  same trade over 
+0001ae90: 616e 6420 6f76 6572 2061 6761 696e 2e0a  and over again..
 0001aea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aeb0: 2023 2052 6561 6368 6564 2074 6865 2065   # Reached the e
-0001aec0: 6e64 206f 6620 7468 6520 6465 6669 6e65  nd of the define
-0001aed0: 642d 646f 776e 6c6f 6164 2070 6572 696f  d-download perio
-0001aee0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-0001aef0: 2020 2020 2020 6966 2075 6e74 696c 2061        if until a
-0001af00: 6e64 2073 696e 6365 5f6e 6578 7420 3e20  nd since_next > 
-0001af10: 756e 7469 6c3a 0a20 2020 2020 2020 2020  until:.         
-0001af20: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001af30: 6f67 6765 722e 6465 6275 6728 0a20 2020  ogger.debug(.   
-0001af40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001af50: 2020 2020 2020 2020 2066 2253 746f 7070           f"Stopp
-0001af60: 696e 6720 6265 6361 7573 6520 756e 7469  ing because unti
-0001af70: 6c20 7761 7320 7265 6163 6865 642e 207b  l was reached. {
-0001af80: 7369 6e63 655f 6e65 7874 7d20 3e20 7b75  since_next} > {u
-0001af90: 6e74 696c 7d22 290a 2020 2020 2020 2020  ntil}").        
+0001aeb0: 2020 2020 6966 2073 696e 6365 203d 3d20      if since == 
+0001aec0: 7369 6e63 655f 6e65 7874 2061 6e64 206c  since_next and l
+0001aed0: 656e 2874 2920 3d3d 2031 3a0a 2020 2020  en(t) == 1:.    
+0001aee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aef0: 2020 2020 6c6f 6767 6572 2e64 6562 7567      logger.debug
+0001af00: 2822 5374 6f70 7069 6e67 2062 6563 6175  ("Stopping becau
+0001af10: 7365 206e 6f20 6d6f 7265 2074 7261 6465  se no more trade
+0001af20: 7320 6172 6520 6176 6169 6c61 626c 652e  s are available.
+0001af30: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
+0001af40: 2020 2020 2020 2020 2020 2062 7265 616b             break
+0001af50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001af60: 2020 2020 2073 696e 6365 203d 2073 696e       since = sin
+0001af70: 6365 5f6e 6578 740a 2020 2020 2020 2020  ce_next.        
+0001af80: 2020 2020 2020 2020 2020 2020 7472 6164              trad
+0001af90: 6573 2e65 7874 656e 6428 7429 0a20 2020  es.extend(t).   
 0001afa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afb0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
-0001afc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001afd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001afe0: 6c6f 6767 6572 2e64 6562 7567 2822 5374  logger.debug("St
-0001aff0: 6f70 7069 6e67 2061 7320 6e6f 206d 6f72  opping as no mor
-0001b000: 6520 7472 6164 6573 2077 6572 6520 7265  e trades were re
-0001b010: 7475 726e 6564 2e22 290a 2020 2020 2020  turned.").      
-0001b020: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0001b030: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-0001b040: 6578 6365 7074 2061 7379 6e63 696f 2e43  except asyncio.C
-0001b050: 616e 6365 6c6c 6564 4572 726f 723a 0a20  ancelledError:. 
-0001b060: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001b070: 6f67 6765 722e 6465 6275 6728 2241 7379  ogger.debug("Asy
-0001b080: 6e63 206f 7065 7261 7469 6f6e 2049 6e74  nc operation Int
-0001b090: 6572 7275 7074 6564 2c20 6272 6561 6b69  errupted, breaki
-0001b0a0: 6e67 2074 7261 6465 7320 444c 206c 6f6f  ng trades DL loo
-0001b0b0: 702e 2229 0a20 2020 2020 2020 2020 2020  p.").           
-0001b0c0: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
-0001b0d0: 2020 2020 7265 7475 726e 2028 7061 6972      return (pair
-0001b0e0: 2c20 7472 6164 6573 290a 0a20 2020 2061  , trades)..    a
-0001b0f0: 7379 6e63 2064 6566 205f 6173 796e 635f  sync def _async_
-0001b100: 6765 745f 7472 6164 655f 6869 7374 6f72  get_trade_histor
-0001b110: 7928 7365 6c66 2c20 7061 6972 3a20 7374  y(self, pair: st
-0001b120: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
-0001b130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b140: 2020 2020 2020 2020 2020 7369 6e63 653a            since:
-0001b150: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
-0001b160: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
-0001b170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b180: 2020 2020 2020 2020 2020 2020 2020 756e                un
-0001b190: 7469 6c3a 204f 7074 696f 6e61 6c5b 696e  til: Optional[in
-0001b1a0: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
-0001b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1d0: 2020 6672 6f6d 5f69 643a 204f 7074 696f    from_id: Optio
-0001b1e0: 6e61 6c5b 7374 725d 203d 204e 6f6e 6529  nal[str] = None)
-0001b1f0: 202d 3e20 5475 706c 655b 7374 722c 204c   -> Tuple[str, L
-0001b200: 6973 745b 4c69 7374 5d5d 3a0a 2020 2020  ist[List]]:.    
-0001b210: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001b220: 4173 796e 6320 7772 6170 7065 7220 6861  Async wrapper ha
-0001b230: 6e64 6c69 6e67 2064 6f77 6e6c 6f61 6469  ndling downloadi
-0001b240: 6e67 2074 7261 6465 7320 7573 696e 6720  ng trades using 
-0001b250: 6569 7468 6572 2074 696d 6520 6f72 2069  either time or i
-0001b260: 6420 6261 7365 6420 6d65 7468 6f64 732e  d based methods.
-0001b270: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
-0001b280: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
-0001b290: 7567 2866 225f 6173 796e 635f 6765 745f  ug(f"_async_get_
-0001b2a0: 7472 6164 655f 6869 7374 6f72 7928 292c  trade_history(),
-0001b2b0: 2070 6169 723a 207b 7061 6972 7d2c 2022   pair: {pair}, "
-0001b2c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b2d0: 2020 2020 2020 6622 7369 6e63 653a 207b        f"since: {
-0001b2e0: 7369 6e63 657d 2c20 756e 7469 6c3a 207b  since}, until: {
-0001b2f0: 756e 7469 6c7d 2c20 6672 6f6d 5f69 643a  until}, from_id:
-0001b300: 207b 6672 6f6d 5f69 647d 2229 0a0a 2020   {from_id}")..  
-0001b310: 2020 2020 2020 6966 2075 6e74 696c 2069        if until i
-0001b320: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0001b330: 2020 2020 756e 7469 6c20 3d20 6363 7874      until = ccxt
-0001b340: 2e45 7863 6861 6e67 652e 6d69 6c6c 6973  .Exchange.millis
-0001b350: 6563 6f6e 6473 2829 0a20 2020 2020 2020  econds().       
-0001b360: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
-0001b370: 6728 6622 4578 6368 616e 6765 206d 696c  g(f"Exchange mil
-0001b380: 6c69 7365 636f 6e64 733a 207b 756e 7469  liseconds: {unti
-0001b390: 6c7d 2229 0a0a 2020 2020 2020 2020 6966  l}")..        if
-0001b3a0: 2073 656c 662e 5f74 7261 6465 735f 7061   self._trades_pa
-0001b3b0: 6769 6e61 7469 6f6e 203d 3d20 2774 696d  gination == 'tim
-0001b3c0: 6527 3a0a 2020 2020 2020 2020 2020 2020  e':.            
-0001b3d0: 7265 7475 726e 2061 7761 6974 2073 656c  return await sel
-0001b3e0: 662e 5f61 7379 6e63 5f67 6574 5f74 7261  f._async_get_tra
-0001b3f0: 6465 5f68 6973 746f 7279 5f74 696d 6528  de_history_time(
-0001b400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b410: 2070 6169 723d 7061 6972 2c20 7369 6e63   pair=pair, sinc
-0001b420: 653d 7369 6e63 652c 2075 6e74 696c 3d75  e=since, until=u
-0001b430: 6e74 696c 290a 2020 2020 2020 2020 656c  ntil).        el
-0001b440: 6966 2073 656c 662e 5f74 7261 6465 735f  if self._trades_
-0001b450: 7061 6769 6e61 7469 6f6e 203d 3d20 2769  pagination == 'i
-0001b460: 6427 3a0a 2020 2020 2020 2020 2020 2020  d':.            
-0001b470: 7265 7475 726e 2061 7761 6974 2073 656c  return await sel
-0001b480: 662e 5f61 7379 6e63 5f67 6574 5f74 7261  f._async_get_tra
-0001b490: 6465 5f68 6973 746f 7279 5f69 6428 0a20  de_history_id(. 
-0001b4a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001b4b0: 6169 723d 7061 6972 2c20 7369 6e63 653d  air=pair, since=
-0001b4c0: 7369 6e63 652c 2075 6e74 696c 3d75 6e74  since, until=unt
-0001b4d0: 696c 2c20 6672 6f6d 5f69 643d 6672 6f6d  il, from_id=from
-0001b4e0: 5f69 640a 2020 2020 2020 2020 2020 2020  _id.            
-0001b4f0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0001b500: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0001b510: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
-0001b520: 6570 7469 6f6e 2866 2245 7863 6861 6e67  eption(f"Exchang
-0001b530: 6520 7b73 656c 662e 6e61 6d65 7d20 646f  e {self.name} do
-0001b540: 6573 2075 7365 206e 6569 7468 6572 2074  es use neither t
-0001b550: 696d 652c 2022 0a20 2020 2020 2020 2020  ime, ".         
-0001b560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b570: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0001b580: 6e6f 7220 6964 2062 6173 6564 2070 6167  nor id based pag
-0001b590: 696e 6174 696f 6e22 290a 0a20 2020 2064  ination")..    d
-0001b5a0: 6566 2067 6574 5f68 6973 746f 7269 635f  ef get_historic_
-0001b5b0: 7472 6164 6573 2873 656c 662c 2070 6169  trades(self, pai
-0001b5c0: 723a 2073 7472 2c0a 2020 2020 2020 2020  r: str,.        
-0001b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b5e0: 2020 2020 7369 6e63 653a 204f 7074 696f      since: Optio
-0001b5f0: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
-0001b600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b610: 2020 2020 2020 2020 2020 2020 2075 6e74               unt
-0001b620: 696c 3a20 4f70 7469 6f6e 616c 5b69 6e74  il: Optional[int
-0001b630: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-0001b640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b650: 2020 2020 2020 6672 6f6d 5f69 643a 204f        from_id: O
-0001b660: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0001b670: 6f6e 6529 202d 3e20 5475 706c 655b 7374  one) -> Tuple[st
-0001b680: 722c 204c 6973 745d 3a0a 2020 2020 2020  r, List]:.      
-0001b690: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
-0001b6a0: 7420 7472 6164 6520 6869 7374 6f72 7920  t trade history 
-0001b6b0: 6461 7461 2075 7369 6e67 2061 7379 6e63  data using async
-0001b6c0: 696f 2e0a 2020 2020 2020 2020 4861 6e64  io..        Hand
-0001b6d0: 6c65 7320 616c 6c20 6173 796e 6320 776f  les all async wo
-0001b6e0: 726b 2061 6e64 2072 6574 7572 6e73 2074  rk and returns t
-0001b6f0: 6865 206c 6973 7420 6f66 2063 616e 646c  he list of candl
-0001b700: 6573 2e0a 2020 2020 2020 2020 4173 796e  es..        Asyn
-0001b710: 6320 6f76 6572 206f 6e65 2070 6169 722c  c over one pair,
-0001b720: 2061 7373 756d 696e 6720 7765 2067 6574   assuming we get
-0001b730: 2060 7365 6c66 2e6f 686c 6376 5f63 616e   `self.ohlcv_can
-0001b740: 646c 655f 6c69 6d69 7428 2960 2063 616e  dle_limit()` can
-0001b750: 646c 6573 2070 6572 2063 616c 6c2e 0a20  dles per call.. 
-0001b760: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-0001b770: 6972 3a20 5061 6972 2074 6f20 646f 776e  ir: Pair to down
-0001b780: 6c6f 6164 0a20 2020 2020 2020 203a 7061  load.        :pa
-0001b790: 7261 6d20 7369 6e63 653a 2054 696d 6573  ram since: Times
-0001b7a0: 7461 6d70 2069 6e20 6d69 6c6c 6973 6563  tamp in millisec
-0001b7b0: 6f6e 6473 2074 6f20 6765 7420 6869 7374  onds to get hist
-0001b7c0: 6f72 7920 6672 6f6d 0a20 2020 2020 2020  ory from.       
-0001b7d0: 203a 7061 7261 6d20 756e 7469 6c3a 2054   :param until: T
-0001b7e0: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
-0001b7f0: 6973 6563 6f6e 6473 2e20 4465 6661 756c  iseconds. Defaul
-0001b800: 7473 2074 6f20 6375 7272 656e 7420 7469  ts to current ti
-0001b810: 6d65 7374 616d 7020 6966 206e 6f74 2064  mestamp if not d
-0001b820: 6566 696e 6564 2e0a 2020 2020 2020 2020  efined..        
-0001b830: 3a70 6172 616d 2066 726f 6d5f 6964 3a20  :param from_id: 
-0001b840: 446f 776e 6c6f 6164 2064 6174 6120 7374  Download data st
-0001b850: 6172 7469 6e67 2077 6974 6820 4944 2028  arting with ID (
-0001b860: 6966 2069 6420 6973 206b 6e6f 776e 290a  if id is known).
-0001b870: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
-0001b880: 204c 6973 7420 6f66 2074 7261 6465 2064   List of trade d
-0001b890: 6174 610a 2020 2020 2020 2020 2222 220a  ata.        """.
-0001b8a0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0001b8b0: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
-0001b8c0: 2822 6665 7463 6854 7261 6465 7322 293a  ("fetchTrades"):
-0001b8d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001b8e0: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-0001b8f0: 6365 7074 696f 6e28 2254 6869 7320 6578  ception("This ex
-0001b900: 6368 616e 6765 2064 6f65 7320 6e6f 7420  change does not 
-0001b910: 7375 7070 6f72 7420 646f 776e 6c6f 6164  support download
-0001b920: 696e 6720 5472 6164 6573 2e22 290a 0a20  ing Trades.").. 
-0001b930: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
-0001b940: 2e5f 6c6f 6f70 5f6c 6f63 6b3a 0a20 2020  ._loop_lock:.   
-0001b950: 2020 2020 2020 2020 2074 6173 6b20 3d20           task = 
-0001b960: 6173 796e 6369 6f2e 656e 7375 7265 5f66  asyncio.ensure_f
-0001b970: 7574 7572 6528 7365 6c66 2e5f 6173 796e  uture(self._asyn
-0001b980: 635f 6765 745f 7472 6164 655f 6869 7374  c_get_trade_hist
-0001b990: 6f72 7928 0a20 2020 2020 2020 2020 2020  ory(.           
-0001b9a0: 2020 2020 2070 6169 723d 7061 6972 2c20       pair=pair, 
-0001b9b0: 7369 6e63 653d 7369 6e63 652c 2075 6e74  since=since, unt
-0001b9c0: 696c 3d75 6e74 696c 2c20 6672 6f6d 5f69  il=until, from_i
-0001b9d0: 643d 6672 6f6d 5f69 6429 290a 0a20 2020  d=from_id))..   
-0001b9e0: 2020 2020 2020 2020 2066 6f72 2073 6967           for sig
-0001b9f0: 2069 6e20 5b73 6967 6e61 6c2e 5349 4749   in [signal.SIGI
-0001ba00: 4e54 2c20 7369 676e 616c 2e53 4947 5445  NT, signal.SIGTE
-0001ba10: 524d 5d3a 0a20 2020 2020 2020 2020 2020  RM]:.           
-0001ba20: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-0001ba30: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0001ba40: 6c66 2e6c 6f6f 702e 6164 645f 7369 676e  lf.loop.add_sign
-0001ba50: 616c 5f68 616e 646c 6572 2873 6967 2c20  al_handler(sig, 
-0001ba60: 7461 736b 2e63 616e 6365 6c29 0a20 2020  task.cancel).   
-0001ba70: 2020 2020 2020 2020 2020 2020 2065 7863               exc
-0001ba80: 6570 7420 4e6f 7449 6d70 6c65 6d65 6e74  ept NotImplement
-0001ba90: 6564 4572 726f 723a 0a20 2020 2020 2020  edError:.       
-0001baa0: 2020 2020 2020 2020 2020 2020 2023 204e               # N
-0001bab0: 6f74 2061 6c6c 2070 6c61 7466 6f72 6d73  ot all platforms
-0001bac0: 2069 6d70 6c65 6d65 6e74 2073 6967 6e61   implement signa
-0001bad0: 6c73 2028 652e 672e 2077 696e 646f 7773  ls (e.g. windows
-0001bae0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001baf0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
-0001bb00: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0001bb10: 6c66 2e6c 6f6f 702e 7275 6e5f 756e 7469  lf.loop.run_unti
-0001bb20: 6c5f 636f 6d70 6c65 7465 2874 6173 6b29  l_complete(task)
-0001bb30: 0a0a 2020 2020 4072 6574 7269 6572 0a20  ..    @retrier. 
-0001bb40: 2020 2064 6566 205f 6765 745f 6675 6e64     def _get_fund
-0001bb50: 696e 675f 6665 6573 5f66 726f 6d5f 6578  ing_fees_from_ex
-0001bb60: 6368 616e 6765 2873 656c 662c 2070 6169  change(self, pai
-0001bb70: 723a 2073 7472 2c20 7369 6e63 653a 2055  r: str, since: U
-0001bb80: 6e69 6f6e 5b64 6174 6574 696d 652c 2069  nion[datetime, i
-0001bb90: 6e74 5d29 202d 3e20 666c 6f61 743a 0a20  nt]) -> float:. 
-0001bba0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0001bbb0: 2020 2052 6574 7572 6e73 2074 6865 2073     Returns the s
-0001bbc0: 756d 206f 6620 616c 6c20 6675 6e64 696e  um of all fundin
-0001bbd0: 6720 6665 6573 2074 6861 7420 7765 7265  g fees that were
-0001bbe0: 2065 7863 6861 6e67 6564 2066 6f72 2061   exchanged for a
-0001bbf0: 2070 6169 7220 7769 7468 696e 2061 2074   pair within a t
-0001bc00: 696d 6566 7261 6d65 0a20 2020 2020 2020  imeframe.       
-0001bc10: 2044 7279 2d72 756e 2068 616e 646c 696e   Dry-run handlin
-0001bc20: 6720 6861 7070 656e 7320 6173 2070 6172  g happens as par
-0001bc30: 7420 6f66 205f 6361 6c63 756c 6174 655f  t of _calculate_
-0001bc40: 6675 6e64 696e 675f 6665 6573 2e0a 2020  funding_fees..  
-0001bc50: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
-0001bc60: 723a 2028 652e 672e 2041 4441 2f55 5344  r: (e.g. ADA/USD
-0001bc70: 5429 0a20 2020 2020 2020 203a 7061 7261  T).        :para
-0001bc80: 6d20 7369 6e63 653a 2054 6865 2065 6172  m since: The ear
-0001bc90: 6c69 6573 7420 7469 6d65 206f 6620 636f  liest time of co
-0001bca0: 6e73 6964 6572 6174 696f 6e20 666f 7220  nsideration for 
-0001bcb0: 6361 6c63 756c 6174 696e 6720 6675 6e64  calculating fund
-0001bcc0: 696e 6720 6665 6573 2c0a 2020 2020 2020  ing fees,.      
-0001bcd0: 2020 2020 2020 696e 2075 6e69 7820 7469        in unix ti
-0001bce0: 6d65 206f 7220 6173 2061 2064 6174 6574  me or as a datet
-0001bcf0: 696d 650a 2020 2020 2020 2020 2222 220a  ime.        """.
-0001bd00: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-0001bd10: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
-0001bd20: 2822 6665 7463 6846 756e 6469 6e67 4869  ("fetchFundingHi
-0001bd30: 7374 6f72 7922 293a 0a20 2020 2020 2020  story"):.       
-0001bd40: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-0001bd50: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-0001bd60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001bd70: 2066 2266 6574 6368 5f66 756e 6469 6e67   f"fetch_funding
-0001bd80: 5f68 6973 746f 7279 2829 2069 7320 6e6f  _history() is no
-0001bd90: 7420 6176 6169 6c61 626c 6520 7573 696e  t available usin
-0001bda0: 6720 7b73 656c 662e 6e61 6d65 7d22 0a20  g {self.name}". 
-0001bdb0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0001bdc0: 2020 2020 2020 6966 2074 7970 6528 7369        if type(si
-0001bdd0: 6e63 6529 2069 7320 6461 7465 7469 6d65  nce) is datetime
-0001bde0: 3a0a 2020 2020 2020 2020 2020 2020 7369  :.            si
-0001bdf0: 6e63 6520 3d20 6474 5f74 7328 7369 6e63  nce = dt_ts(sinc
-0001be00: 6529 0a0a 2020 2020 2020 2020 7472 793a  e)..        try:
-0001be10: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
-0001be20: 6469 6e67 5f68 6973 746f 7279 203d 2073  ding_history = s
-0001be30: 656c 662e 5f61 7069 2e66 6574 6368 5f66  elf._api.fetch_f
-0001be40: 756e 6469 6e67 5f68 6973 746f 7279 280a  unding_history(.
-0001be50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be60: 7379 6d62 6f6c 3d70 6169 722c 0a20 2020  symbol=pair,.   
-0001be70: 2020 2020 2020 2020 2020 2020 2073 696e               sin
-0001be80: 6365 3d73 696e 6365 0a20 2020 2020 2020  ce=since.       
-0001be90: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001bea0: 2020 2073 656c 662e 5f6c 6f67 5f65 7863     self._log_exc
-0001beb0: 6861 6e67 655f 7265 7370 6f6e 7365 2827  hange_response('
-0001bec0: 6675 6e64 696e 675f 6869 7374 6f72 7927  funding_history'
-0001bed0: 2c20 6675 6e64 696e 675f 6869 7374 6f72  , funding_histor
-0001bee0: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
-0001bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf00: 2020 2020 2020 2020 2020 2061 6464 5f69             add_i
-0001bf10: 6e66 6f3d 6622 7061 6972 3a20 7b70 6169  nfo=f"pair: {pai
-0001bf20: 727d 2c20 7369 6e63 653a 207b 7369 6e63  r}, since: {sinc
-0001bf30: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-0001bf40: 2072 6574 7572 6e20 7375 6d28 6665 655b   return sum(fee[
-0001bf50: 2761 6d6f 756e 7427 5d20 666f 7220 6665  'amount'] for fe
-0001bf60: 6520 696e 2066 756e 6469 6e67 5f68 6973  e in funding_his
-0001bf70: 746f 7279 290a 2020 2020 2020 2020 6578  tory).        ex
-0001bf80: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
-0001bf90: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
-0001bfa0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001bfb0: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
-0001bfc0: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
-0001bfd0: 2020 6578 6365 7074 2028 6363 7874 2e4e    except (ccxt.N
-0001bfe0: 6574 776f 726b 4572 726f 722c 2063 6378  etworkError, ccx
-0001bff0: 742e 4578 6368 616e 6765 4572 726f 7229  t.ExchangeError)
-0001c000: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001c010: 2020 2072 6169 7365 2054 656d 706f 7261     raise Tempora
-0001c020: 7279 4572 726f 7228 0a20 2020 2020 2020  ryError(.       
-0001c030: 2020 2020 2020 2020 2066 2743 6f75 6c64           f'Could
-0001c040: 206e 6f74 2067 6574 2066 756e 6469 6e67   not get funding
-0001c050: 2066 6565 7320 6475 6520 746f 207b 652e   fees due to {e.
-0001c060: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0001c070: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
-0001c080: 7d27 2920 6672 6f6d 2065 0a20 2020 2020  }') from e.     
-0001c090: 2020 2065 7863 6570 7420 6363 7874 2e42     except ccxt.B
-0001c0a0: 6173 6545 7272 6f72 2061 7320 653a 0a20  aseError as e:. 
-0001c0b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001c0c0: 204f 7065 7261 7469 6f6e 616c 4578 6365   OperationalExce
-0001c0d0: 7074 696f 6e28 6529 2066 726f 6d20 650a  ption(e) from e.
-0001c0e0: 0a20 2020 2040 7265 7472 6965 720a 2020  .    @retrier.  
-0001c0f0: 2020 6465 6620 6765 745f 6c65 7665 7261    def get_levera
-0001c100: 6765 5f74 6965 7273 2873 656c 6629 202d  ge_tiers(self) -
-0001c110: 3e20 4469 6374 5b73 7472 2c20 4c69 7374  > Dict[str, List
-0001c120: 5b44 6963 745d 5d3a 0a20 2020 2020 2020  [Dict]]:.       
-0001c130: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0001c140: 2020 7265 7475 726e 2073 656c 662e 5f61    return self._a
-0001c150: 7069 2e66 6574 6368 5f6c 6576 6572 6167  pi.fetch_leverag
-0001c160: 655f 7469 6572 7328 290a 2020 2020 2020  e_tiers().      
-0001c170: 2020 6578 6365 7074 2063 6378 742e 4444    except ccxt.DD
-0001c180: 6f53 5072 6f74 6563 7469 6f6e 2061 7320  oSProtection as 
-0001c190: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001c1a0: 6169 7365 2044 446f 7350 726f 7465 6374  aise DDosProtect
-0001c1b0: 696f 6e28 6529 2066 726f 6d20 650a 2020  ion(e) from e.  
-0001c1c0: 2020 2020 2020 6578 6365 7074 2028 6363        except (cc
-0001c1d0: 7874 2e4e 6574 776f 726b 4572 726f 722c  xt.NetworkError,
-0001c1e0: 2063 6378 742e 4578 6368 616e 6765 4572   ccxt.ExchangeEr
-0001c1f0: 726f 7229 2061 7320 653a 0a20 2020 2020  ror) as e:.     
-0001c200: 2020 2020 2020 2072 6169 7365 2054 656d         raise Tem
-0001c210: 706f 7261 7279 4572 726f 7228 0a20 2020  poraryError(.   
-0001c220: 2020 2020 2020 2020 2020 2020 2066 2743               f'C
-0001c230: 6f75 6c64 206e 6f74 206c 6f61 6420 6c65  ould not load le
-0001c240: 7665 7261 6765 2074 6965 7273 2064 7565  verage tiers due
-0001c250: 2074 6f20 7b65 2e5f 5f63 6c61 7373 5f5f   to {e.__class__
-0001c260: 2e5f 5f6e 616d 655f 5f7d 2e20 4d65 7373  .__name__}. Mess
-0001c270: 6167 653a 207b 657d 270a 2020 2020 2020  age: {e}'.      
-0001c280: 2020 2020 2020 2920 6672 6f6d 2065 0a20        ) from e. 
-0001c290: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
-0001c2a0: 7874 2e42 6173 6545 7272 6f72 2061 7320  xt.BaseError as 
-0001c2b0: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001c2c0: 6169 7365 204f 7065 7261 7469 6f6e 616c  aise Operational
-0001c2d0: 4578 6365 7074 696f 6e28 6529 2066 726f  Exception(e) fro
-0001c2e0: 6d20 650a 0a20 2020 2040 7265 7472 6965  m e..    @retrie
-0001c2f0: 725f 6173 796e 630a 2020 2020 6173 796e  r_async.    asyn
-0001c300: 6320 6465 6620 6765 745f 6d61 726b 6574  c def get_market
-0001c310: 5f6c 6576 6572 6167 655f 7469 6572 7328  _leverage_tiers(
-0001c320: 7365 6c66 2c20 7379 6d62 6f6c 3a20 7374  self, symbol: st
-0001c330: 7229 202d 3e20 5475 706c 655b 7374 722c  r) -> Tuple[str,
-0001c340: 204c 6973 745b 4469 6374 5d5d 3a0a 2020   List[Dict]]:.  
-0001c350: 2020 2020 2020 2222 2220 4c65 7665 7261        """ Levera
-0001c360: 6765 2074 6965 7273 2070 6572 2073 796d  ge tiers per sym
-0001c370: 626f 6c20 2222 220a 2020 2020 2020 2020  bol """.        
-0001c380: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001c390: 2074 6965 7220 3d20 6177 6169 7420 7365   tier = await se
-0001c3a0: 6c66 2e5f 6170 695f 6173 796e 632e 6665  lf._api_async.fe
-0001c3b0: 7463 685f 6d61 726b 6574 5f6c 6576 6572  tch_market_lever
-0001c3c0: 6167 655f 7469 6572 7328 7379 6d62 6f6c  age_tiers(symbol
-0001c3d0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0001c3e0: 7475 726e 2073 796d 626f 6c2c 2074 6965  turn symbol, tie
-0001c3f0: 720a 2020 2020 2020 2020 6578 6365 7074  r.        except
-0001c400: 2063 6378 742e 4444 6f53 5072 6f74 6563   ccxt.DDoSProtec
-0001c410: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-0001c420: 2020 2020 2020 2072 6169 7365 2044 446f         raise DDo
-0001c430: 7350 726f 7465 6374 696f 6e28 6529 2066  sProtection(e) f
-0001c440: 726f 6d20 650a 2020 2020 2020 2020 6578  rom e.        ex
-0001c450: 6365 7074 2028 6363 7874 2e4e 6574 776f  cept (ccxt.Netwo
-0001c460: 726b 4572 726f 722c 2063 6378 742e 4578  rkError, ccxt.Ex
-0001c470: 6368 616e 6765 4572 726f 7229 2061 7320  changeError) as 
-0001c480: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0001c490: 6169 7365 2054 656d 706f 7261 7279 4572  aise TemporaryEr
-0001c4a0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0001c4b0: 2020 2020 2066 2743 6f75 6c64 206e 6f74       f'Could not
-0001c4c0: 206c 6f61 6420 6c65 7665 7261 6765 2074   load leverage t
-0001c4d0: 6965 7273 2066 6f72 207b 7379 6d62 6f6c  iers for {symbol
-0001c4e0: 7d27 0a20 2020 2020 2020 2020 2020 2020  }'.             
-0001c4f0: 2020 2066 2720 6475 6520 746f 207b 652e     f' due to {e.
-0001c500: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
-0001c510: 5f5f 7d2e 204d 6573 7361 6765 3a20 7b65  __}. Message: {e
-0001c520: 7d27 0a20 2020 2020 2020 2020 2020 2029  }'.            )
-0001c530: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0001c540: 6578 6365 7074 2063 6378 742e 4261 7365  except ccxt.Base
-0001c550: 4572 726f 7220 6173 2065 3a0a 2020 2020  Error as e:.    
-0001c560: 2020 2020 2020 2020 7261 6973 6520 4f70          raise Op
-0001c570: 6572 6174 696f 6e61 6c45 7863 6570 7469  erationalExcepti
-0001c580: 6f6e 2865 2920 6672 6f6d 2065 0a0a 2020  on(e) from e..  
-0001c590: 2020 6465 6620 6c6f 6164 5f6c 6576 6572    def load_lever
-0001c5a0: 6167 655f 7469 6572 7328 7365 6c66 2920  age_tiers(self) 
-0001c5b0: 2d3e 2044 6963 745b 7374 722c 204c 6973  -> Dict[str, Lis
-0001c5c0: 745b 4469 6374 5d5d 3a0a 2020 2020 2020  t[Dict]]:.      
-0001c5d0: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
-0001c5e0: 675f 6d6f 6465 203d 3d20 5472 6164 696e  g_mode == Tradin
-0001c5f0: 674d 6f64 652e 4655 5455 5245 533a 0a20  gMode.FUTURES:. 
-0001c600: 2020 2020 2020 2020 2020 2069 6620 7365             if se
-0001c610: 6c66 2e65 7863 6861 6e67 655f 6861 7328  lf.exchange_has(
-0001c620: 2766 6574 6368 4c65 7665 7261 6765 5469  'fetchLeverageTi
-0001c630: 6572 7327 293a 0a20 2020 2020 2020 2020  ers'):.         
-0001c640: 2020 2020 2020 2023 2046 6574 6368 2061         # Fetch a
-0001c650: 6c6c 206c 6576 6572 6167 6520 7469 6572  ll leverage tier
-0001c660: 7320 6174 206f 6e63 650a 2020 2020 2020  s at once.      
-0001c670: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001c680: 2073 656c 662e 6765 745f 6c65 7665 7261   self.get_levera
-0001c690: 6765 5f74 6965 7273 2829 0a20 2020 2020  ge_tiers().     
-0001c6a0: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-0001c6b0: 2e65 7863 6861 6e67 655f 6861 7328 2766  .exchange_has('f
-0001c6c0: 6574 6368 4d61 726b 6574 4c65 7665 7261  etchMarketLevera
-0001c6d0: 6765 5469 6572 7327 293a 0a20 2020 2020  geTiers'):.     
-0001c6e0: 2020 2020 2020 2020 2020 2023 204d 7573             # Mus
-0001c6f0: 7420 6665 7463 6820 7468 6520 6c65 7665  t fetch the leve
-0001c700: 7261 6765 2074 6965 7273 2066 6f72 2065  rage tiers for e
-0001c710: 6163 6820 6d61 726b 6574 2073 6570 6172  ach market separ
-0001c720: 6174 656c 790a 2020 2020 2020 2020 2020  ately.          
-0001c730: 2020 2020 2020 2320 2a20 5468 6973 2069        # * This i
-0001c740: 7320 736c 6f77 287e 3435 7329 206f 6e20  s slow(~45s) on 
-0001c750: 4f6b 782c 206d 616b 6573 207e 3930 2061  Okx, makes ~90 a
-0001c760: 7069 2063 616c 6c73 2074 6f20 6c6f 6164  pi calls to load
-0001c770: 2061 6c6c 206c 696e 6561 7220 7377 6170   all linear swap
-0001c780: 206d 6172 6b65 7473 0a20 2020 2020 2020   markets.       
-0001c790: 2020 2020 2020 2020 206d 6172 6b65 7473           markets
-0001c7a0: 203d 2073 656c 662e 6d61 726b 6574 730a   = self.markets.
-0001c7b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c7c0: 2073 796d 626f 6c73 203d 205b 0a20 2020   symbols = [.   
-0001c7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7e0: 2073 796d 626f 6c20 666f 7220 7379 6d62   symbol for symb
-0001c7f0: 6f6c 2c20 6d61 726b 6574 2069 6e20 6d61  ol, market in ma
-0001c800: 726b 6574 732e 6974 656d 7328 290a 2020  rkets.items().  
-0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c820: 2020 6966 2028 7365 6c66 2e6d 6172 6b65    if (self.marke
-0001c830: 745f 6973 5f66 7574 7572 6528 6d61 726b  t_is_future(mark
-0001c840: 6574 290a 2020 2020 2020 2020 2020 2020  et).            
-0001c850: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0001c860: 6d61 726b 6574 5b27 7175 6f74 6527 5d20  market['quote'] 
-0001c870: 3d3d 2073 656c 662e 5f63 6f6e 6669 675b  == self._config[
-0001c880: 2773 7461 6b65 5f63 7572 7265 6e63 7927  'stake_currency'
-0001c890: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-0001c8a0: 2020 205d 0a0a 2020 2020 2020 2020 2020     ]..          
-0001c8b0: 2020 2020 2020 7469 6572 733a 2044 6963        tiers: Dic
-0001c8c0: 745b 7374 722c 204c 6973 745b 4469 6374  t[str, List[Dict
-0001c8d0: 5d5d 203d 207b 7d0a 0a20 2020 2020 2020  ]] = {}..       
-0001c8e0: 2020 2020 2020 2020 2074 6965 7273 5f63           tiers_c
-0001c8f0: 6163 6865 6420 3d20 7365 6c66 2e6c 6f61  ached = self.loa
-0001c900: 645f 6361 6368 6564 5f6c 6576 6572 6167  d_cached_leverag
-0001c910: 655f 7469 6572 7328 7365 6c66 2e5f 636f  e_tiers(self._co
-0001c920: 6e66 6967 5b27 7374 616b 655f 6375 7272  nfig['stake_curr
-0001c930: 656e 6379 275d 290a 2020 2020 2020 2020  ency']).        
-0001c940: 2020 2020 2020 2020 6966 2074 6965 7273          if tiers
-0001c950: 5f63 6163 6865 643a 0a20 2020 2020 2020  _cached:.       
-0001c960: 2020 2020 2020 2020 2020 2020 2074 6965               tie
-0001c970: 7273 203d 2074 6965 7273 5f63 6163 6865  rs = tiers_cache
-0001c980: 640a 0a20 2020 2020 2020 2020 2020 2020  d..             
-0001c990: 2020 2063 6f72 6f73 203d 205b 0a20 2020     coros = [.   
-0001c9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9b0: 2073 656c 662e 6765 745f 6d61 726b 6574   self.get_market
-0001c9c0: 5f6c 6576 6572 6167 655f 7469 6572 7328  _leverage_tiers(
-0001c9d0: 7379 6d62 6f6c 290a 2020 2020 2020 2020  symbol).        
-0001c9e0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001c9f0: 7379 6d62 6f6c 2069 6e20 736f 7274 6564  symbol in sorted
-0001ca00: 2873 796d 626f 6c73 2920 6966 2073 796d  (symbols) if sym
-0001ca10: 626f 6c20 6e6f 7420 696e 2074 6965 7273  bol not in tiers
-0001ca20: 5d0a 0a20 2020 2020 2020 2020 2020 2020  ]..             
-0001ca30: 2020 2023 2042 6520 7665 7262 6f73 6520     # Be verbose 
-0001ca40: 6865 7265 2c20 6173 2074 6869 7320 6465  here, as this de
-0001ca50: 6c61 7973 2073 7461 7274 7570 2062 7920  lays startup by 
-0001ca60: 7e31 206d 696e 7574 652e 0a20 2020 2020  ~1 minute..     
-0001ca70: 2020 2020 2020 2020 2020 2069 6620 636f             if co
-0001ca80: 726f 733a 0a20 2020 2020 2020 2020 2020  ros:.           
-0001ca90: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0001caa0: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
-0001cab0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0001cac0: 496e 6974 6961 6c69 7a69 6e67 206c 6576  Initializing lev
-0001cad0: 6572 6167 655f 7469 6572 7320 666f 7220  erage_tiers for 
-0001cae0: 7b6c 656e 2873 796d 626f 6c73 297d 206d  {len(symbols)} m
-0001caf0: 6172 6b65 7473 2e20 220a 2020 2020 2020  arkets. ".      
-0001cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb10: 2020 2254 6869 7320 7769 6c6c 2074 616b    "This will tak
-0001cb20: 6520 6162 6f75 7420 6120 6d69 6e75 7465  e about a minute
-0001cb30: 2e22 290a 2020 2020 2020 2020 2020 2020  .").            
-0001cb40: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001cb50: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
-0001cb60: 6767 6572 2e69 6e66 6f28 2255 7369 6e67  gger.info("Using
-0001cb70: 2063 6163 6865 6420 6c65 7665 7261 6765   cached leverage
-0001cb80: 5f74 6965 7273 2e22 290a 0a20 2020 2020  _tiers.")..     
-0001cb90: 2020 2020 2020 2020 2020 2061 7379 6e63             async
-0001cba0: 2064 6566 2067 6174 6865 725f 7265 7375   def gather_resu
-0001cbb0: 6c74 7328 696e 7075 745f 636f 726f 293a  lts(input_coro):
-0001cbc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cbd0: 2020 2020 2072 6574 7572 6e20 6177 6169       return awai
-0001cbe0: 7420 6173 796e 6369 6f2e 6761 7468 6572  t asyncio.gather
-0001cbf0: 282a 696e 7075 745f 636f 726f 2c20 7265  (*input_coro, re
-0001cc00: 7475 726e 5f65 7863 6570 7469 6f6e 733d  turn_exceptions=
-0001cc10: 5472 7565 290a 0a20 2020 2020 2020 2020  True)..         
-0001cc20: 2020 2020 2020 2066 6f72 2069 6e70 7574         for input
-0001cc30: 5f63 6f72 6f20 696e 2063 6875 6e6b 7328  _coro in chunks(
-0001cc40: 636f 726f 732c 2031 3030 293a 0a0a 2020  coros, 100):..  
-0001cc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc60: 2020 7769 7468 2073 656c 662e 5f6c 6f6f    with self._loo
-0001cc70: 705f 6c6f 636b 3a0a 2020 2020 2020 2020  p_lock:.        
-0001cc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc90: 7265 7375 6c74 7320 3d20 7365 6c66 2e6c  results = self.l
-0001cca0: 6f6f 702e 7275 6e5f 756e 7469 6c5f 636f  oop.run_until_co
-0001ccb0: 6d70 6c65 7465 2867 6174 6865 725f 7265  mplete(gather_re
-0001ccc0: 7375 6c74 7328 696e 7075 745f 636f 726f  sults(input_coro
-0001ccd0: 2929 0a0a 2020 2020 2020 2020 2020 2020  ))..            
-0001cce0: 2020 2020 2020 2020 666f 7220 7265 7320          for res 
-0001ccf0: 696e 2072 6573 756c 7473 3a0a 2020 2020  in results:.    
-0001cd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd10: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0001cd20: 6528 7265 732c 2045 7863 6570 7469 6f6e  e(res, Exception
-0001cd30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001cd40: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-0001cd50: 6f67 6765 722e 7761 726e 696e 6728 6622  ogger.warning(f"
-0001cd60: 4c65 7665 7261 6765 2074 6965 7220 6578  Leverage tier ex
-0001cd70: 6365 7074 696f 6e3a 207b 7265 7072 2872  ception: {repr(r
-0001cd80: 6573 297d 2229 0a20 2020 2020 2020 2020  es)}").         
-0001cd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cda0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-0001cdb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cdc0: 2020 2020 7379 6d62 6f6c 2c20 7469 6572      symbol, tier
-0001cdd0: 203d 2072 6573 0a20 2020 2020 2020 2020   = res.         
-0001cde0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001cdf0: 6965 7273 5b73 796d 626f 6c5d 203d 2074  iers[symbol] = t
-0001ce00: 6965 720a 2020 2020 2020 2020 2020 2020  ier.            
-0001ce10: 2020 2020 6966 206c 656e 2863 6f72 6f73      if len(coros
-0001ce20: 2920 3e20 303a 0a20 2020 2020 2020 2020  ) > 0:.         
-0001ce30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001ce40: 6361 6368 655f 6c65 7665 7261 6765 5f74  cache_leverage_t
-0001ce50: 6965 7273 2874 6965 7273 2c20 7365 6c66  iers(tiers, self
-0001ce60: 2e5f 636f 6e66 6967 5b27 7374 616b 655f  ._config['stake_
-0001ce70: 6375 7272 656e 6379 275d 290a 2020 2020  currency']).    
-0001ce80: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0001ce90: 6572 2e69 6e66 6f28 6622 446f 6e65 2069  er.info(f"Done i
-0001cea0: 6e69 7469 616c 697a 696e 6720 7b6c 656e  nitializing {len
-0001ceb0: 2873 796d 626f 6c73 297d 206d 6172 6b65  (symbols)} marke
-0001cec0: 7473 2e22 290a 0a20 2020 2020 2020 2020  ts.")..         
-0001ced0: 2020 2020 2020 2072 6574 7572 6e20 7469         return ti
-0001cee0: 6572 730a 2020 2020 2020 2020 7265 7475  ers.        retu
-0001cef0: 726e 207b 7d0a 0a20 2020 2064 6566 2063  rn {}..    def c
-0001cf00: 6163 6865 5f6c 6576 6572 6167 655f 7469  ache_leverage_ti
-0001cf10: 6572 7328 7365 6c66 2c20 7469 6572 733a  ers(self, tiers:
-0001cf20: 2044 6963 745b 7374 722c 204c 6973 745b   Dict[str, List[
-0001cf30: 4469 6374 5d5d 2c20 7374 616b 655f 6375  Dict]], stake_cu
-0001cf40: 7272 656e 6379 3a20 7374 7229 202d 3e20  rrency: str) -> 
-0001cf50: 4e6f 6e65 3a0a 0a20 2020 2020 2020 2066  None:..        f
-0001cf60: 696c 656e 616d 6520 3d20 7365 6c66 2e5f  ilename = self._
-0001cf70: 636f 6e66 6967 5b27 6461 7461 6469 7227  config['datadir'
-0001cf80: 5d20 2f20 2266 7574 7572 6573 2220 2f20  ] / "futures" / 
-0001cf90: 6622 6c65 7665 7261 6765 5f74 6965 7273  f"leverage_tiers
-0001cfa0: 5f7b 7374 616b 655f 6375 7272 656e 6379  _{stake_currency
-0001cfb0: 7d2e 6a73 6f6e 220a 2020 2020 2020 2020  }.json".        
-0001cfc0: 6966 206e 6f74 2066 696c 656e 616d 652e  if not filename.
-0001cfd0: 7061 7265 6e74 2e69 735f 6469 7228 293a  parent.is_dir():
-0001cfe0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
-0001cff0: 656e 616d 652e 7061 7265 6e74 2e6d 6b64  ename.parent.mkd
-0001d000: 6972 2870 6172 656e 7473 3d54 7275 6529  ir(parents=True)
-0001d010: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0001d020: 7b0a 2020 2020 2020 2020 2020 2020 2275  {.            "u
-0001d030: 7064 6174 6564 223a 2064 6174 6574 696d  pdated": datetim
-0001d040: 652e 6e6f 7728 7469 6d65 7a6f 6e65 2e75  e.now(timezone.u
-0001d050: 7463 292c 0a20 2020 2020 2020 2020 2020  tc),.           
-0001d060: 2022 6461 7461 223a 2074 6965 7273 2c0a   "data": tiers,.
-0001d070: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-0001d080: 2020 6669 6c65 5f64 756d 705f 6a73 6f6e    file_dump_json
-0001d090: 2866 696c 656e 616d 652c 2064 6174 6129  (filename, data)
-0001d0a0: 0a0a 2020 2020 6465 6620 6c6f 6164 5f63  ..    def load_c
-0001d0b0: 6163 6865 645f 6c65 7665 7261 6765 5f74  ached_leverage_t
-0001d0c0: 6965 7273 2873 656c 662c 2073 7461 6b65  iers(self, stake
-0001d0d0: 5f63 7572 7265 6e63 793a 2073 7472 2920  _currency: str) 
-0001d0e0: 2d3e 204f 7074 696f 6e61 6c5b 4469 6374  -> Optional[Dict
-0001d0f0: 5b73 7472 2c20 4c69 7374 5b44 6963 745d  [str, List[Dict]
-0001d100: 5d5d 3a0a 2020 2020 2020 2020 6669 6c65  ]]:.        file
-0001d110: 6e61 6d65 203d 2073 656c 662e 5f63 6f6e  name = self._con
-0001d120: 6669 675b 2764 6174 6164 6972 275d 202f  fig['datadir'] /
-0001d130: 2022 6675 7475 7265 7322 202f 2066 226c   "futures" / f"l
-0001d140: 6576 6572 6167 655f 7469 6572 735f 7b73  everage_tiers_{s
-0001d150: 7461 6b65 5f63 7572 7265 6e63 797d 2e6a  take_currency}.j
-0001d160: 736f 6e22 0a20 2020 2020 2020 2069 6620  son".        if 
-0001d170: 6669 6c65 6e61 6d65 2e69 735f 6669 6c65  filename.is_file
-0001d180: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
-0001d190: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001d1a0: 2020 2020 2074 6965 7273 203d 2066 696c       tiers = fil
-0001d1b0: 655f 6c6f 6164 5f6a 736f 6e28 6669 6c65  e_load_json(file
-0001d1c0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-0001d1d0: 2020 2020 2020 7570 6461 7465 6420 3d20        updated = 
-0001d1e0: 7469 6572 732e 6765 7428 2775 7064 6174  tiers.get('updat
-0001d1f0: 6564 2729 0a20 2020 2020 2020 2020 2020  ed').           
-0001d200: 2020 2020 2069 6620 7570 6461 7465 643a       if updated:
-0001d210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d220: 2020 2020 2075 7064 6174 6564 5f64 7420       updated_dt 
-0001d230: 3d20 7061 7273 6572 2e70 6172 7365 2875  = parser.parse(u
-0001d240: 7064 6174 6564 290a 2020 2020 2020 2020  pdated).        
-0001d250: 2020 2020 2020 2020 2020 2020 6966 2075              if u
-0001d260: 7064 6174 6564 5f64 7420 3c20 6461 7465  pdated_dt < date
-0001d270: 7469 6d65 2e6e 6f77 2874 696d 657a 6f6e  time.now(timezon
-0001d280: 652e 7574 6329 202d 2074 696d 6564 656c  e.utc) - timedel
-0001d290: 7461 2877 6565 6b73 3d34 293a 0a20 2020  ta(weeks=4):.   
-0001d2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2b0: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
-0001d2c0: 2822 4361 6368 6564 206c 6576 6572 6167  ("Cached leverag
-0001d2d0: 6520 7469 6572 7320 6172 6520 6f75 7464  e tiers are outd
-0001d2e0: 6174 6564 2e20 5769 6c6c 2075 7064 6174  ated. Will updat
-0001d2f0: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
-0001d300: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001d310: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0001d320: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0001d330: 7469 6572 735b 2764 6174 6127 5d0a 2020  tiers['data'].  
-0001d340: 2020 2020 2020 2020 2020 6578 6365 7074            except
-0001d350: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
-0001d360: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0001d370: 6572 2e65 7863 6570 7469 6f6e 2822 4572  er.exception("Er
-0001d380: 726f 7220 6c6f 6164 696e 6720 6361 6368  ror loading cach
-0001d390: 6564 206c 6576 6572 6167 6520 7469 6572  ed leverage tier
-0001d3a0: 732e 2052 6566 7265 7368 696e 672e 2229  s. Refreshing.")
-0001d3b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001d3c0: 4e6f 6e65 0a0a 2020 2020 6465 6620 6669  None..    def fi
-0001d3d0: 6c6c 5f6c 6576 6572 6167 655f 7469 6572  ll_leverage_tier
-0001d3e0: 7328 7365 6c66 2920 2d3e 204e 6f6e 653a  s(self) -> None:
-0001d3f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001d400: 2020 2020 2041 7373 6967 6e73 2070 726f       Assigns pro
-0001d410: 7065 7274 7920 5f6c 6576 6572 6167 655f  perty _leverage_
-0001d420: 7469 6572 7320 746f 2061 2064 6963 7469  tiers to a dicti
-0001d430: 6f6e 6172 7920 6f66 2069 6e66 6f72 6d61  onary of informa
-0001d440: 7469 6f6e 2061 626f 7574 2074 6865 206c  tion about the l
-0001d450: 6576 6572 6167 650a 2020 2020 2020 2020  everage.        
-0001d460: 616c 6c6f 7765 6420 6f6e 2065 6163 6820  allowed on each 
-0001d470: 7061 6972 0a20 2020 2020 2020 2022 2222  pair.        """
-0001d480: 0a20 2020 2020 2020 206c 6576 6572 6167  .        leverag
-0001d490: 655f 7469 6572 7320 3d20 7365 6c66 2e6c  e_tiers = self.l
-0001d4a0: 6f61 645f 6c65 7665 7261 6765 5f74 6965  oad_leverage_tie
-0001d4b0: 7273 2829 0a20 2020 2020 2020 2066 6f72  rs().        for
-0001d4c0: 2070 6169 722c 2074 6965 7273 2069 6e20   pair, tiers in 
-0001d4d0: 6c65 7665 7261 6765 5f74 6965 7273 2e69  leverage_tiers.i
-0001d4e0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0001d4f0: 2020 2020 7061 6972 5f74 6965 7273 203d      pair_tiers =
-0001d500: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-0001d510: 666f 7220 7469 6572 2069 6e20 7469 6572  for tier in tier
-0001d520: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001d530: 2020 2070 6169 725f 7469 6572 732e 6170     pair_tiers.ap
-0001d540: 7065 6e64 2873 656c 662e 7061 7273 655f  pend(self.parse_
-0001d550: 6c65 7665 7261 6765 5f74 6965 7228 7469  leverage_tier(ti
-0001d560: 6572 2929 0a20 2020 2020 2020 2020 2020  er)).           
-0001d570: 2073 656c 662e 5f6c 6576 6572 6167 655f   self._leverage_
-0001d580: 7469 6572 735b 7061 6972 5d20 3d20 7061  tiers[pair] = pa
-0001d590: 6972 5f74 6965 7273 0a0a 2020 2020 6465  ir_tiers..    de
-0001d5a0: 6620 7061 7273 655f 6c65 7665 7261 6765  f parse_leverage
-0001d5b0: 5f74 6965 7228 7365 6c66 2c20 7469 6572  _tier(self, tier
-0001d5c0: 2920 2d3e 2044 6963 743a 0a20 2020 2020  ) -> Dict:.     
-0001d5d0: 2020 2069 6e66 6f20 3d20 7469 6572 2e67     info = tier.g
-0001d5e0: 6574 2827 696e 666f 272c 207b 7d29 0a20  et('info', {}). 
-0001d5f0: 2020 2020 2020 2072 6574 7572 6e20 7b0a         return {.
-0001d600: 2020 2020 2020 2020 2020 2020 276d 696e              'min
-0001d610: 4e6f 7469 6f6e 616c 273a 2074 6965 725b  Notional': tier[
-0001d620: 276d 696e 4e6f 7469 6f6e 616c 275d 2c0a  'minNotional'],.
-0001d630: 2020 2020 2020 2020 2020 2020 276d 6178              'max
-0001d640: 4e6f 7469 6f6e 616c 273a 2074 6965 725b  Notional': tier[
-0001d650: 276d 6178 4e6f 7469 6f6e 616c 275d 2c0a  'maxNotional'],.
-0001d660: 2020 2020 2020 2020 2020 2020 276d 6169              'mai
-0001d670: 6e74 656e 616e 6365 4d61 7267 696e 5261  ntenanceMarginRa
-0001d680: 7465 273a 2074 6965 725b 276d 6169 6e74  te': tier['maint
-0001d690: 656e 616e 6365 4d61 7267 696e 5261 7465  enanceMarginRate
-0001d6a0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-0001d6b0: 276d 6178 4c65 7665 7261 6765 273a 2074  'maxLeverage': t
-0001d6c0: 6965 725b 276d 6178 4c65 7665 7261 6765  ier['maxLeverage
-0001d6d0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
-0001d6e0: 276d 6169 6e74 416d 7427 3a20 666c 6f61  'maintAmt': floa
-0001d6f0: 7428 696e 666f 5b27 6375 6d27 5d29 2069  t(info['cum']) i
-0001d700: 6620 2763 756d 2720 696e 2069 6e66 6f20  f 'cum' in info 
-0001d710: 656c 7365 204e 6f6e 652c 0a20 2020 2020  else None,.     
-0001d720: 2020 207d 0a0a 2020 2020 6465 6620 6765     }..    def ge
-0001d730: 745f 6d61 785f 6c65 7665 7261 6765 2873  t_max_leverage(s
-0001d740: 656c 662c 2070 6169 723a 2073 7472 2c20  elf, pair: str, 
-0001d750: 7374 616b 655f 616d 6f75 6e74 3a20 4f70  stake_amount: Op
-0001d760: 7469 6f6e 616c 5b66 6c6f 6174 5d29 202d  tional[float]) -
-0001d770: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
-0001d780: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
-0001d790: 7572 6e73 2074 6865 206d 6178 696d 756d  urns the maximum
-0001d7a0: 206c 6576 6572 6167 6520 7468 6174 2061   leverage that a
-0001d7b0: 2070 6169 7220 6361 6e20 6265 2074 7261   pair can be tra
-0001d7c0: 6465 6420 6174 0a20 2020 2020 2020 203a  ded at.        :
-0001d7d0: 7061 7261 6d20 7061 6972 3a20 5468 6520  param pair: The 
-0001d7e0: 6261 7365 2f71 756f 7465 2063 7572 7265  base/quote curre
-0001d7f0: 6e63 7920 7061 6972 2062 6569 6e67 2074  ncy pair being t
-0001d800: 7261 6465 640a 2020 2020 2020 2020 3a73  raded.        :s
-0001d810: 7461 6b65 5f61 6d6f 756e 743a 2054 6865  take_amount: The
-0001d820: 2074 6f74 616c 2076 616c 7565 206f 6620   total value of 
-0001d830: 7468 6520 7472 6164 6572 7320 6d61 7267  the traders marg
-0001d840: 696e 5f6d 6f64 6520 696e 2071 756f 7465  in_mode in quote
-0001d850: 2063 7572 7265 6e63 790a 2020 2020 2020   currency.      
-0001d860: 2020 2222 220a 0a20 2020 2020 2020 2069    """..        i
-0001d870: 6620 7365 6c66 2e74 7261 6469 6e67 5f6d  f self.trading_m
-0001d880: 6f64 6520 3d3d 2054 7261 6469 6e67 4d6f  ode == TradingMo
-0001d890: 6465 2e53 504f 543a 0a20 2020 2020 2020  de.SPOT:.       
-0001d8a0: 2020 2020 2072 6574 7572 6e20 312e 300a       return 1.0.
-0001d8b0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0001d8c0: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
-0001d8d0: 2054 7261 6469 6e67 4d6f 6465 2e46 5554   TradingMode.FUT
-0001d8e0: 5552 4553 3a0a 0a20 2020 2020 2020 2020  URES:..         
-0001d8f0: 2020 2023 2043 6865 636b 7320 616e 6420     # Checks and 
-0001d900: 6564 6765 2063 6173 6573 0a20 2020 2020  edge cases.     
-0001d910: 2020 2020 2020 2069 6620 7374 616b 655f         if stake_
-0001d920: 616d 6f75 6e74 2069 7320 4e6f 6e65 3a0a  amount is None:.
-0001d930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d940: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-0001d950: 6c45 7863 6570 7469 6f6e 280a 2020 2020  lException(.    
-0001d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d970: 6627 7b73 656c 662e 6e61 6d65 7d2e 6765  f'{self.name}.ge
-0001d980: 745f 6d61 785f 6c65 7665 7261 6765 2072  t_max_leverage r
-0001d990: 6571 7569 7265 7320 6172 6775 6d65 6e74  equires argument
-0001d9a0: 2073 7461 6b65 5f61 6d6f 756e 7427 0a20   stake_amount'. 
-0001d9b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001d9c0: 0a0a 2020 2020 2020 2020 2020 2020 6966  ..            if
-0001d9d0: 2070 6169 7220 6e6f 7420 696e 2073 656c   pair not in sel
-0001d9e0: 662e 5f6c 6576 6572 6167 655f 7469 6572  f._leverage_tier
-0001d9f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-0001da00: 2020 2023 204d 6179 6265 2072 6169 7365     # Maybe raise
-0001da10: 2065 7863 6570 7469 6f6e 2062 6563 6175   exception becau
-0001da20: 7365 2069 7420 6361 6e27 7420 6265 2074  se it can't be t
-0001da30: 7261 6465 6420 6f6e 2066 7574 7572 6573  raded on futures
-0001da40: 3f0a 2020 2020 2020 2020 2020 2020 2020  ?.              
-0001da50: 2020 7265 7475 726e 2031 2e30 0a0a 2020    return 1.0..  
-0001da60: 2020 2020 2020 2020 2020 7061 6972 5f74            pair_t
-0001da70: 6965 7273 203d 2073 656c 662e 5f6c 6576  iers = self._lev
-0001da80: 6572 6167 655f 7469 6572 735b 7061 6972  erage_tiers[pair
-0001da90: 5d0a 0a20 2020 2020 2020 2020 2020 2069  ]..            i
-0001daa0: 6620 7374 616b 655f 616d 6f75 6e74 203d  f stake_amount =
-0001dab0: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-0001dac0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0001dad0: 2e5f 6c65 7665 7261 6765 5f74 6965 7273  ._leverage_tiers
-0001dae0: 5b70 6169 725d 5b30 5d5b 276d 6178 4c65  [pair][0]['maxLe
-0001daf0: 7665 7261 6765 275d 2020 2320 4d61 7820  verage']  # Max 
-0001db00: 6c65 7620 666f 7220 6c6f 7765 7374 2061  lev for lowest a
-0001db10: 6d6f 756e 740a 0a20 2020 2020 2020 2020  mount..         
-0001db20: 2020 2066 6f72 2074 6965 725f 696e 6465     for tier_inde
-0001db30: 7820 696e 2072 616e 6765 286c 656e 2870  x in range(len(p
-0001db40: 6169 725f 7469 6572 7329 293a 0a0a 2020  air_tiers)):..  
-0001db50: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-0001db60: 6572 203d 2070 6169 725f 7469 6572 735b  er = pair_tiers[
-0001db70: 7469 6572 5f69 6e64 6578 5d0a 2020 2020  tier_index].    
-0001db80: 2020 2020 2020 2020 2020 2020 6c65 7620              lev 
-0001db90: 3d20 7469 6572 5b27 6d61 784c 6576 6572  = tier['maxLever
-0001dba0: 6167 6527 5d0a 0a20 2020 2020 2020 2020  age']..         
-0001dbb0: 2020 2020 2020 2069 6620 7469 6572 5f69         if tier_i
-0001dbc0: 6e64 6578 203c 206c 656e 2870 6169 725f  ndex < len(pair_
-0001dbd0: 7469 6572 7329 202d 2031 3a0a 2020 2020  tiers) - 1:.    
-0001dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbf0: 6e65 7874 5f74 6965 7220 3d20 7061 6972  next_tier = pair
-0001dc00: 5f74 6965 7273 5b74 6965 725f 696e 6465  _tiers[tier_inde
-0001dc10: 7820 2b20 315d 0a20 2020 2020 2020 2020  x + 1].         
-0001dc20: 2020 2020 2020 2020 2020 206e 6578 745f             next_
-0001dc30: 666c 6f6f 7220 3d20 6e65 7874 5f74 6965  floor = next_tie
-0001dc40: 725b 276d 696e 4e6f 7469 6f6e 616c 275d  r['minNotional']
-0001dc50: 202f 206e 6578 745f 7469 6572 5b27 6d61   / next_tier['ma
-0001dc60: 784c 6576 6572 6167 6527 5d0a 2020 2020  xLeverage'].    
-0001dc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dc80: 6966 206e 6578 745f 666c 6f6f 7220 3e20  if next_floor > 
-0001dc90: 7374 616b 655f 616d 6f75 6e74 3a20 2023  stake_amount:  #
-0001dca0: 204e 6578 7420 7469 6572 206d 696e 2074   Next tier min t
-0001dcb0: 6f6f 2068 6967 6820 666f 7220 7374 616b  oo high for stak
-0001dcc0: 6520 616d 6f75 6e74 0a20 2020 2020 2020  e amount.       
-0001dcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dce0: 2072 6574 7572 6e20 6d69 6e28 2874 6965   return min((tie
-0001dcf0: 725b 276d 6178 4e6f 7469 6f6e 616c 275d  r['maxNotional']
-0001dd00: 202f 2073 7461 6b65 5f61 6d6f 756e 7429   / stake_amount)
-0001dd10: 2c20 6c65 7629 0a20 2020 2020 2020 2020  , lev).         
-0001dd20: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001dd30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dd40: 2020 2020 2020 2020 2023 2057 6974 6820           # With 
-0001dd50: 7468 6520 7477 6f20 6c65 7665 7261 6765  the two leverage
-0001dd60: 2074 6965 7273 2062 656c 6f77 2c0a 2020   tiers below,.  
-0001dd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd80: 2020 2020 2020 2320 2d20 6120 7374 616b        # - a stak
-0001dd90: 6520 616d 6f75 6e74 206f 6620 3135 3020  e amount of 150 
-0001dda0: 776f 756c 6420 6d65 616e 2061 206d 6178  would mean a max
-0001ddb0: 206c 6576 6572 6167 6520 6f66 2028 3130   leverage of (10
-0001ddc0: 3030 3020 2f20 3135 3029 203d 2036 362e  000 / 150) = 66.
-0001ddd0: 3636 0a20 2020 2020 2020 2020 2020 2020  66.             
-0001dde0: 2020 2020 2020 2020 2020 2023 202d 2073             # - s
-0001ddf0: 7461 6b65 7320 6265 6c6f 7720 3133 332e  takes below 133.
-0001de00: 3333 203d 206d 6178 5f6c 6576 206f 6620  33 = max_lev of 
-0001de10: 3735 0a20 2020 2020 2020 2020 2020 2020  75.             
-0001de20: 2020 2020 2020 2020 2020 2023 202d 2073             # - s
-0001de30: 7461 6b65 7320 6265 7477 6565 6e20 3133  takes between 13
-0001de40: 332e 3333 2d32 3030 203d 206d 6178 5f6c  3.33-200 = max_l
-0001de50: 6576 206f 6620 3130 3030 302f 7374 616b  ev of 10000/stak
-0001de60: 6520 3d20 3530 2e30 312d 3734 2e39 390a  e = 50.01-74.99.
-0001de70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de80: 2020 2020 2020 2020 2320 2d20 7374 616b          # - stak
-0001de90: 6573 2066 726f 6d20 3230 3020 2b20 3130  es from 200 + 10
-0001dea0: 3030 203d 206d 6178 5f6c 6576 206f 6620  00 = max_lev of 
-0001deb0: 3530 0a20 2020 2020 2020 2020 2020 2020  50.             
-0001dec0: 2020 2020 2020 2020 2020 2023 0a20 2020             #.   
-0001ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dee0: 2020 2020 2023 207b 0a20 2020 2020 2020       # {.       
-0001def0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df00: 2023 2020 2020 2022 6d69 6e22 3a20 302c   #     "min": 0,
-0001df10: 2020 2020 2020 2320 7374 616b 6520 3d20        # stake = 
-0001df20: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
-0001df30: 2020 2020 2020 2020 2020 2020 2320 2020              #   
-0001df40: 2020 226d 6178 223a 2031 3030 3030 2c20    "max": 10000, 
-0001df50: 2023 206d 6178 5f73 7461 6b65 4037 3520   # max_stake@75 
-0001df60: 3d20 3130 3030 302f 3735 203d 2031 3333  = 10000/75 = 133
-0001df70: 2e33 3333 3333 3333 3333 3333 3333 340a  .33333333333334.
+0001afb0: 2023 2052 6561 6368 6564 2074 6865 2065   # Reached the e
+0001afc0: 6e64 206f 6620 7468 6520 6465 6669 6e65  nd of the define
+0001afd0: 642d 646f 776e 6c6f 6164 2070 6572 696f  d-download perio
+0001afe0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
+0001aff0: 2020 2020 2020 6966 2075 6e74 696c 2061        if until a
+0001b000: 6e64 2073 696e 6365 5f6e 6578 7420 3e20  nd since_next > 
+0001b010: 756e 7469 6c3a 0a20 2020 2020 2020 2020  until:.         
+0001b020: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001b030: 6f67 6765 722e 6465 6275 6728 0a20 2020  ogger.debug(.   
+0001b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b050: 2020 2020 2020 2020 2066 2253 746f 7070           f"Stopp
+0001b060: 696e 6720 6265 6361 7573 6520 756e 7469  ing because unti
+0001b070: 6c20 7761 7320 7265 6163 6865 642e 207b  l was reached. {
+0001b080: 7369 6e63 655f 6e65 7874 7d20 3e20 7b75  since_next} > {u
+0001b090: 6e74 696c 7d22 290a 2020 2020 2020 2020  ntil}").        
+0001b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0b0: 6272 6561 6b0a 2020 2020 2020 2020 2020  break.          
+0001b0c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0e0: 6c6f 6767 6572 2e64 6562 7567 2822 5374  logger.debug("St
+0001b0f0: 6f70 7069 6e67 2061 7320 6e6f 206d 6f72  opping as no mor
+0001b100: 6520 7472 6164 6573 2077 6572 6520 7265  e trades were re
+0001b110: 7475 726e 6564 2e22 290a 2020 2020 2020  turned.").      
+0001b120: 2020 2020 2020 2020 2020 2020 2020 6272                br
+0001b130: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
+0001b140: 6578 6365 7074 2061 7379 6e63 696f 2e43  except asyncio.C
+0001b150: 616e 6365 6c6c 6564 4572 726f 723a 0a20  ancelledError:. 
+0001b160: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+0001b170: 6f67 6765 722e 6465 6275 6728 2241 7379  ogger.debug("Asy
+0001b180: 6e63 206f 7065 7261 7469 6f6e 2049 6e74  nc operation Int
+0001b190: 6572 7275 7074 6564 2c20 6272 6561 6b69  errupted, breaki
+0001b1a0: 6e67 2074 7261 6465 7320 444c 206c 6f6f  ng trades DL loo
+0001b1b0: 702e 2229 0a20 2020 2020 2020 2020 2020  p.").           
+0001b1c0: 2020 2020 2062 7265 616b 0a0a 2020 2020       break..    
+0001b1d0: 2020 2020 7265 7475 726e 2028 7061 6972      return (pair
+0001b1e0: 2c20 7472 6164 6573 290a 0a20 2020 2061  , trades)..    a
+0001b1f0: 7379 6e63 2064 6566 205f 6173 796e 635f  sync def _async_
+0001b200: 6765 745f 7472 6164 655f 6869 7374 6f72  get_trade_histor
+0001b210: 7928 7365 6c66 2c20 7061 6972 3a20 7374  y(self, pair: st
+0001b220: 722c 0a20 2020 2020 2020 2020 2020 2020  r,.             
+0001b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b240: 2020 2020 2020 2020 2020 7369 6e63 653a            since:
+0001b250: 204f 7074 696f 6e61 6c5b 696e 745d 203d   Optional[int] =
+0001b260: 204e 6f6e 652c 0a20 2020 2020 2020 2020   None,.         
+0001b270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b280: 2020 2020 2020 2020 2020 2020 2020 756e                un
+0001b290: 7469 6c3a 204f 7074 696f 6e61 6c5b 696e  til: Optional[in
+0001b2a0: 745d 203d 204e 6f6e 652c 0a20 2020 2020  t] = None,.     
+0001b2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b2d0: 2020 6672 6f6d 5f69 643a 204f 7074 696f    from_id: Optio
+0001b2e0: 6e61 6c5b 7374 725d 203d 204e 6f6e 6529  nal[str] = None)
+0001b2f0: 202d 3e20 5475 706c 655b 7374 722c 204c   -> Tuple[str, L
+0001b300: 6973 745b 4c69 7374 5d5d 3a0a 2020 2020  ist[List]]:.    
+0001b310: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001b320: 4173 796e 6320 7772 6170 7065 7220 6861  Async wrapper ha
+0001b330: 6e64 6c69 6e67 2064 6f77 6e6c 6f61 6469  ndling downloadi
+0001b340: 6e67 2074 7261 6465 7320 7573 696e 6720  ng trades using 
+0001b350: 6569 7468 6572 2074 696d 6520 6f72 2069  either time or i
+0001b360: 6420 6261 7365 6420 6d65 7468 6f64 732e  d based methods.
+0001b370: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0001b380: 2020 2020 2020 6c6f 6767 6572 2e64 6562        logger.deb
+0001b390: 7567 2866 225f 6173 796e 635f 6765 745f  ug(f"_async_get_
+0001b3a0: 7472 6164 655f 6869 7374 6f72 7928 292c  trade_history(),
+0001b3b0: 2070 6169 723a 207b 7061 6972 7d2c 2022   pair: {pair}, "
+0001b3c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b3d0: 2020 2020 2020 6622 7369 6e63 653a 207b        f"since: {
+0001b3e0: 7369 6e63 657d 2c20 756e 7469 6c3a 207b  since}, until: {
+0001b3f0: 756e 7469 6c7d 2c20 6672 6f6d 5f69 643a  until}, from_id:
+0001b400: 207b 6672 6f6d 5f69 647d 2229 0a0a 2020   {from_id}")..  
+0001b410: 2020 2020 2020 6966 2075 6e74 696c 2069        if until i
+0001b420: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0001b430: 2020 2020 756e 7469 6c20 3d20 6363 7874      until = ccxt
+0001b440: 2e45 7863 6861 6e67 652e 6d69 6c6c 6973  .Exchange.millis
+0001b450: 6563 6f6e 6473 2829 0a20 2020 2020 2020  econds().       
+0001b460: 2020 2020 206c 6f67 6765 722e 6465 6275       logger.debu
+0001b470: 6728 6622 4578 6368 616e 6765 206d 696c  g(f"Exchange mil
+0001b480: 6c69 7365 636f 6e64 733a 207b 756e 7469  liseconds: {unti
+0001b490: 6c7d 2229 0a0a 2020 2020 2020 2020 6966  l}")..        if
+0001b4a0: 2073 656c 662e 5f74 7261 6465 735f 7061   self._trades_pa
+0001b4b0: 6769 6e61 7469 6f6e 203d 3d20 2774 696d  gination == 'tim
+0001b4c0: 6527 3a0a 2020 2020 2020 2020 2020 2020  e':.            
+0001b4d0: 7265 7475 726e 2061 7761 6974 2073 656c  return await sel
+0001b4e0: 662e 5f61 7379 6e63 5f67 6574 5f74 7261  f._async_get_tra
+0001b4f0: 6465 5f68 6973 746f 7279 5f74 696d 6528  de_history_time(
+0001b500: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b510: 2070 6169 723d 7061 6972 2c20 7369 6e63   pair=pair, sinc
+0001b520: 653d 7369 6e63 652c 2075 6e74 696c 3d75  e=since, until=u
+0001b530: 6e74 696c 290a 2020 2020 2020 2020 656c  ntil).        el
+0001b540: 6966 2073 656c 662e 5f74 7261 6465 735f  if self._trades_
+0001b550: 7061 6769 6e61 7469 6f6e 203d 3d20 2769  pagination == 'i
+0001b560: 6427 3a0a 2020 2020 2020 2020 2020 2020  d':.            
+0001b570: 7265 7475 726e 2061 7761 6974 2073 656c  return await sel
+0001b580: 662e 5f61 7379 6e63 5f67 6574 5f74 7261  f._async_get_tra
+0001b590: 6465 5f68 6973 746f 7279 5f69 6428 0a20  de_history_id(. 
+0001b5a0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0001b5b0: 6169 723d 7061 6972 2c20 7369 6e63 653d  air=pair, since=
+0001b5c0: 7369 6e63 652c 2075 6e74 696c 3d75 6e74  since, until=unt
+0001b5d0: 696c 2c20 6672 6f6d 5f69 643d 6672 6f6d  il, from_id=from
+0001b5e0: 5f69 640a 2020 2020 2020 2020 2020 2020  _id.            
+0001b5f0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+0001b600: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0001b610: 6520 4f70 6572 6174 696f 6e61 6c45 7863  e OperationalExc
+0001b620: 6570 7469 6f6e 2866 2245 7863 6861 6e67  eption(f"Exchang
+0001b630: 6520 7b73 656c 662e 6e61 6d65 7d20 646f  e {self.name} do
+0001b640: 6573 2075 7365 206e 6569 7468 6572 2074  es use neither t
+0001b650: 696d 652c 2022 0a20 2020 2020 2020 2020  ime, ".         
+0001b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b670: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0001b680: 6e6f 7220 6964 2062 6173 6564 2070 6167  nor id based pag
+0001b690: 696e 6174 696f 6e22 290a 0a20 2020 2064  ination")..    d
+0001b6a0: 6566 2067 6574 5f68 6973 746f 7269 635f  ef get_historic_
+0001b6b0: 7472 6164 6573 2873 656c 662c 2070 6169  trades(self, pai
+0001b6c0: 723a 2073 7472 2c0a 2020 2020 2020 2020  r: str,.        
+0001b6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b6e0: 2020 2020 7369 6e63 653a 204f 7074 696f      since: Optio
+0001b6f0: 6e61 6c5b 696e 745d 203d 204e 6f6e 652c  nal[int] = None,
+0001b700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b710: 2020 2020 2020 2020 2020 2020 2075 6e74               unt
+0001b720: 696c 3a20 4f70 7469 6f6e 616c 5b69 6e74  il: Optional[int
+0001b730: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+0001b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b750: 2020 2020 2020 6672 6f6d 5f69 643a 204f        from_id: O
+0001b760: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
+0001b770: 6f6e 6529 202d 3e20 5475 706c 655b 7374  one) -> Tuple[st
+0001b780: 722c 204c 6973 745d 3a0a 2020 2020 2020  r, List]:.      
+0001b790: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
+0001b7a0: 7420 7472 6164 6520 6869 7374 6f72 7920  t trade history 
+0001b7b0: 6461 7461 2075 7369 6e67 2061 7379 6e63  data using async
+0001b7c0: 696f 2e0a 2020 2020 2020 2020 4861 6e64  io..        Hand
+0001b7d0: 6c65 7320 616c 6c20 6173 796e 6320 776f  les all async wo
+0001b7e0: 726b 2061 6e64 2072 6574 7572 6e73 2074  rk and returns t
+0001b7f0: 6865 206c 6973 7420 6f66 2063 616e 646c  he list of candl
+0001b800: 6573 2e0a 2020 2020 2020 2020 4173 796e  es..        Asyn
+0001b810: 6320 6f76 6572 206f 6e65 2070 6169 722c  c over one pair,
+0001b820: 2061 7373 756d 696e 6720 7765 2067 6574   assuming we get
+0001b830: 2060 7365 6c66 2e6f 686c 6376 5f63 616e   `self.ohlcv_can
+0001b840: 646c 655f 6c69 6d69 7428 2960 2063 616e  dle_limit()` can
+0001b850: 646c 6573 2070 6572 2063 616c 6c2e 0a20  dles per call.. 
+0001b860: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+0001b870: 6972 3a20 5061 6972 2074 6f20 646f 776e  ir: Pair to down
+0001b880: 6c6f 6164 0a20 2020 2020 2020 203a 7061  load.        :pa
+0001b890: 7261 6d20 7369 6e63 653a 2054 696d 6573  ram since: Times
+0001b8a0: 7461 6d70 2069 6e20 6d69 6c6c 6973 6563  tamp in millisec
+0001b8b0: 6f6e 6473 2074 6f20 6765 7420 6869 7374  onds to get hist
+0001b8c0: 6f72 7920 6672 6f6d 0a20 2020 2020 2020  ory from.       
+0001b8d0: 203a 7061 7261 6d20 756e 7469 6c3a 2054   :param until: T
+0001b8e0: 696d 6573 7461 6d70 2069 6e20 6d69 6c6c  imestamp in mill
+0001b8f0: 6973 6563 6f6e 6473 2e20 4465 6661 756c  iseconds. Defaul
+0001b900: 7473 2074 6f20 6375 7272 656e 7420 7469  ts to current ti
+0001b910: 6d65 7374 616d 7020 6966 206e 6f74 2064  mestamp if not d
+0001b920: 6566 696e 6564 2e0a 2020 2020 2020 2020  efined..        
+0001b930: 3a70 6172 616d 2066 726f 6d5f 6964 3a20  :param from_id: 
+0001b940: 446f 776e 6c6f 6164 2064 6174 6120 7374  Download data st
+0001b950: 6172 7469 6e67 2077 6974 6820 4944 2028  arting with ID (
+0001b960: 6966 2069 6420 6973 206b 6e6f 776e 290a  if id is known).
+0001b970: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
+0001b980: 204c 6973 7420 6f66 2074 7261 6465 2064   List of trade d
+0001b990: 6174 610a 2020 2020 2020 2020 2222 220a  ata.        """.
+0001b9a0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0001b9b0: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
+0001b9c0: 2822 6665 7463 6854 7261 6465 7322 293a  ("fetchTrades"):
+0001b9d0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001b9e0: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
+0001b9f0: 6365 7074 696f 6e28 2254 6869 7320 6578  ception("This ex
+0001ba00: 6368 616e 6765 2064 6f65 7320 6e6f 7420  change does not 
+0001ba10: 7375 7070 6f72 7420 646f 776e 6c6f 6164  support download
+0001ba20: 696e 6720 5472 6164 6573 2e22 290a 0a20  ing Trades.").. 
+0001ba30: 2020 2020 2020 2077 6974 6820 7365 6c66         with self
+0001ba40: 2e5f 6c6f 6f70 5f6c 6f63 6b3a 0a20 2020  ._loop_lock:.   
+0001ba50: 2020 2020 2020 2020 2074 6173 6b20 3d20           task = 
+0001ba60: 6173 796e 6369 6f2e 656e 7375 7265 5f66  asyncio.ensure_f
+0001ba70: 7574 7572 6528 7365 6c66 2e5f 6173 796e  uture(self._asyn
+0001ba80: 635f 6765 745f 7472 6164 655f 6869 7374  c_get_trade_hist
+0001ba90: 6f72 7928 0a20 2020 2020 2020 2020 2020  ory(.           
+0001baa0: 2020 2020 2070 6169 723d 7061 6972 2c20       pair=pair, 
+0001bab0: 7369 6e63 653d 7369 6e63 652c 2075 6e74  since=since, unt
+0001bac0: 696c 3d75 6e74 696c 2c20 6672 6f6d 5f69  il=until, from_i
+0001bad0: 643d 6672 6f6d 5f69 6429 290a 0a20 2020  d=from_id))..   
+0001bae0: 2020 2020 2020 2020 2066 6f72 2073 6967           for sig
+0001baf0: 2069 6e20 5b73 6967 6e61 6c2e 5349 4749   in [signal.SIGI
+0001bb00: 4e54 2c20 7369 676e 616c 2e53 4947 5445  NT, signal.SIGTE
+0001bb10: 524d 5d3a 0a20 2020 2020 2020 2020 2020  RM]:.           
+0001bb20: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+0001bb30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0001bb40: 6c66 2e6c 6f6f 702e 6164 645f 7369 676e  lf.loop.add_sign
+0001bb50: 616c 5f68 616e 646c 6572 2873 6967 2c20  al_handler(sig, 
+0001bb60: 7461 736b 2e63 616e 6365 6c29 0a20 2020  task.cancel).   
+0001bb70: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0001bb80: 6570 7420 4e6f 7449 6d70 6c65 6d65 6e74  ept NotImplement
+0001bb90: 6564 4572 726f 723a 0a20 2020 2020 2020  edError:.       
+0001bba0: 2020 2020 2020 2020 2020 2020 2023 204e               # N
+0001bbb0: 6f74 2061 6c6c 2070 6c61 7466 6f72 6d73  ot all platforms
+0001bbc0: 2069 6d70 6c65 6d65 6e74 2073 6967 6e61   implement signa
+0001bbd0: 6c73 2028 652e 672e 2077 696e 646f 7773  ls (e.g. windows
+0001bbe0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001bbf0: 2020 2020 2020 7061 7373 0a20 2020 2020        pass.     
+0001bc00: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001bc10: 6c66 2e6c 6f6f 702e 7275 6e5f 756e 7469  lf.loop.run_unti
+0001bc20: 6c5f 636f 6d70 6c65 7465 2874 6173 6b29  l_complete(task)
+0001bc30: 0a0a 2020 2020 4072 6574 7269 6572 0a20  ..    @retrier. 
+0001bc40: 2020 2064 6566 205f 6765 745f 6675 6e64     def _get_fund
+0001bc50: 696e 675f 6665 6573 5f66 726f 6d5f 6578  ing_fees_from_ex
+0001bc60: 6368 616e 6765 2873 656c 662c 2070 6169  change(self, pai
+0001bc70: 723a 2073 7472 2c20 7369 6e63 653a 2055  r: str, since: U
+0001bc80: 6e69 6f6e 5b64 6174 6574 696d 652c 2069  nion[datetime, i
+0001bc90: 6e74 5d29 202d 3e20 666c 6f61 743a 0a20  nt]) -> float:. 
+0001bca0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0001bcb0: 2020 2052 6574 7572 6e73 2074 6865 2073     Returns the s
+0001bcc0: 756d 206f 6620 616c 6c20 6675 6e64 696e  um of all fundin
+0001bcd0: 6720 6665 6573 2074 6861 7420 7765 7265  g fees that were
+0001bce0: 2065 7863 6861 6e67 6564 2066 6f72 2061   exchanged for a
+0001bcf0: 2070 6169 7220 7769 7468 696e 2061 2074   pair within a t
+0001bd00: 696d 6566 7261 6d65 0a20 2020 2020 2020  imeframe.       
+0001bd10: 2044 7279 2d72 756e 2068 616e 646c 696e   Dry-run handlin
+0001bd20: 6720 6861 7070 656e 7320 6173 2070 6172  g happens as par
+0001bd30: 7420 6f66 205f 6361 6c63 756c 6174 655f  t of _calculate_
+0001bd40: 6675 6e64 696e 675f 6665 6573 2e0a 2020  funding_fees..  
+0001bd50: 2020 2020 2020 3a70 6172 616d 2070 6169        :param pai
+0001bd60: 723a 2028 652e 672e 2041 4441 2f55 5344  r: (e.g. ADA/USD
+0001bd70: 5429 0a20 2020 2020 2020 203a 7061 7261  T).        :para
+0001bd80: 6d20 7369 6e63 653a 2054 6865 2065 6172  m since: The ear
+0001bd90: 6c69 6573 7420 7469 6d65 206f 6620 636f  liest time of co
+0001bda0: 6e73 6964 6572 6174 696f 6e20 666f 7220  nsideration for 
+0001bdb0: 6361 6c63 756c 6174 696e 6720 6675 6e64  calculating fund
+0001bdc0: 696e 6720 6665 6573 2c0a 2020 2020 2020  ing fees,.      
+0001bdd0: 2020 2020 2020 696e 2075 6e69 7820 7469        in unix ti
+0001bde0: 6d65 206f 7220 6173 2061 2064 6174 6574  me or as a datet
+0001bdf0: 696d 650a 2020 2020 2020 2020 2222 220a  ime.        """.
+0001be00: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+0001be10: 656c 662e 6578 6368 616e 6765 5f68 6173  elf.exchange_has
+0001be20: 2822 6665 7463 6846 756e 6469 6e67 4869  ("fetchFundingHi
+0001be30: 7374 6f72 7922 293a 0a20 2020 2020 2020  story"):.       
+0001be40: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+0001be50: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+0001be60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001be70: 2066 2266 6574 6368 5f66 756e 6469 6e67   f"fetch_funding
+0001be80: 5f68 6973 746f 7279 2829 2069 7320 6e6f  _history() is no
+0001be90: 7420 6176 6169 6c61 626c 6520 7573 696e  t available usin
+0001bea0: 6720 7b73 656c 662e 6e61 6d65 7d22 0a20  g {self.name}". 
+0001beb0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0001bec0: 2020 2020 2020 6966 2074 7970 6528 7369        if type(si
+0001bed0: 6e63 6529 2069 7320 6461 7465 7469 6d65  nce) is datetime
+0001bee0: 3a0a 2020 2020 2020 2020 2020 2020 7369  :.            si
+0001bef0: 6e63 6520 3d20 6474 5f74 7328 7369 6e63  nce = dt_ts(sinc
+0001bf00: 6529 0a0a 2020 2020 2020 2020 7472 793a  e)..        try:
+0001bf10: 0a20 2020 2020 2020 2020 2020 2066 756e  .            fun
+0001bf20: 6469 6e67 5f68 6973 746f 7279 203d 2073  ding_history = s
+0001bf30: 656c 662e 5f61 7069 2e66 6574 6368 5f66  elf._api.fetch_f
+0001bf40: 756e 6469 6e67 5f68 6973 746f 7279 280a  unding_history(.
+0001bf50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf60: 7379 6d62 6f6c 3d70 6169 722c 0a20 2020  symbol=pair,.   
+0001bf70: 2020 2020 2020 2020 2020 2020 2073 696e               sin
+0001bf80: 6365 3d73 696e 6365 0a20 2020 2020 2020  ce=since.       
+0001bf90: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0001bfa0: 2020 2073 656c 662e 5f6c 6f67 5f65 7863     self._log_exc
+0001bfb0: 6861 6e67 655f 7265 7370 6f6e 7365 2827  hange_response('
+0001bfc0: 6675 6e64 696e 675f 6869 7374 6f72 7927  funding_history'
+0001bfd0: 2c20 6675 6e64 696e 675f 6869 7374 6f72  , funding_histor
+0001bfe0: 792c 0a20 2020 2020 2020 2020 2020 2020  y,.             
+0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c000: 2020 2020 2020 2020 2020 2061 6464 5f69             add_i
+0001c010: 6e66 6f3d 6622 7061 6972 3a20 7b70 6169  nfo=f"pair: {pai
+0001c020: 727d 2c20 7369 6e63 653a 207b 7369 6e63  r}, since: {sinc
+0001c030: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
+0001c040: 2072 6574 7572 6e20 7375 6d28 6665 655b   return sum(fee[
+0001c050: 2761 6d6f 756e 7427 5d20 666f 7220 6665  'amount'] for fe
+0001c060: 6520 696e 2066 756e 6469 6e67 5f68 6973  e in funding_his
+0001c070: 746f 7279 290a 2020 2020 2020 2020 6578  tory).        ex
+0001c080: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
+0001c090: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
+0001c0a0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001c0b0: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
+0001c0c0: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
+0001c0d0: 2020 6578 6365 7074 2028 6363 7874 2e4f    except (ccxt.O
+0001c0e0: 7065 7261 7469 6f6e 4661 696c 6564 2c20  perationFailed, 
+0001c0f0: 6363 7874 2e45 7863 6861 6e67 6545 7272  ccxt.ExchangeErr
+0001c100: 6f72 2920 6173 2065 3a0a 2020 2020 2020  or) as e:.      
+0001c110: 2020 2020 2020 7261 6973 6520 5465 6d70        raise Temp
+0001c120: 6f72 6172 7945 7272 6f72 280a 2020 2020  oraryError(.    
+0001c130: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
+0001c140: 756c 6420 6e6f 7420 6765 7420 6675 6e64  uld not get fund
+0001c150: 696e 6720 6665 6573 2064 7565 2074 6f20  ing fees due to 
+0001c160: 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f 5f6e  {e.__class__.__n
+0001c170: 616d 655f 5f7d 2e20 4d65 7373 6167 653a  ame__}. Message:
+0001c180: 207b 657d 2729 2066 726f 6d20 650a 2020   {e}') from e.  
+0001c190: 2020 2020 2020 6578 6365 7074 2063 6378        except ccx
+0001c1a0: 742e 4261 7365 4572 726f 7220 6173 2065  t.BaseError as e
+0001c1b0: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0001c1c0: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0001c1d0: 7863 6570 7469 6f6e 2865 2920 6672 6f6d  xception(e) from
+0001c1e0: 2065 0a0a 2020 2020 4072 6574 7269 6572   e..    @retrier
+0001c1f0: 0a20 2020 2064 6566 2067 6574 5f6c 6576  .    def get_lev
+0001c200: 6572 6167 655f 7469 6572 7328 7365 6c66  erage_tiers(self
+0001c210: 2920 2d3e 2044 6963 745b 7374 722c 204c  ) -> Dict[str, L
+0001c220: 6973 745b 4469 6374 5d5d 3a0a 2020 2020  ist[Dict]]:.    
+0001c230: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0001c240: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0001c250: 2e5f 6170 692e 6665 7463 685f 6c65 7665  ._api.fetch_leve
+0001c260: 7261 6765 5f74 6965 7273 2829 0a20 2020  rage_tiers().   
+0001c270: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
+0001c280: 2e44 446f 5350 726f 7465 6374 696f 6e20  .DDoSProtection 
+0001c290: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
+0001c2a0: 2020 7261 6973 6520 4444 6f73 5072 6f74    raise DDosProt
+0001c2b0: 6563 7469 6f6e 2865 2920 6672 6f6d 2065  ection(e) from e
+0001c2c0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001c2d0: 2863 6378 742e 4f70 6572 6174 696f 6e46  (ccxt.OperationF
+0001c2e0: 6169 6c65 642c 2063 6378 742e 4578 6368  ailed, ccxt.Exch
+0001c2f0: 616e 6765 4572 726f 7229 2061 7320 653a  angeError) as e:
+0001c300: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001c310: 7365 2054 656d 706f 7261 7279 4572 726f  se TemporaryErro
+0001c320: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0001c330: 2020 2066 2743 6f75 6c64 206e 6f74 206c     f'Could not l
+0001c340: 6f61 6420 6c65 7665 7261 6765 2074 6965  oad leverage tie
+0001c350: 7273 2064 7565 2074 6f20 7b65 2e5f 5f63  rs due to {e.__c
+0001c360: 6c61 7373 5f5f 2e5f 5f6e 616d 655f 5f7d  lass__.__name__}
+0001c370: 2e20 4d65 7373 6167 653a 207b 657d 270a  . Message: {e}'.
+0001c380: 2020 2020 2020 2020 2020 2020 2920 6672              ) fr
+0001c390: 6f6d 2065 0a20 2020 2020 2020 2065 7863  om e.        exc
+0001c3a0: 6570 7420 6363 7874 2e42 6173 6545 7272  ept ccxt.BaseErr
+0001c3b0: 6f72 2061 7320 653a 0a20 2020 2020 2020  or as e:.       
+0001c3c0: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+0001c3d0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+0001c3e0: 6529 2066 726f 6d20 650a 0a20 2020 2040  e) from e..    @
+0001c3f0: 7265 7472 6965 725f 6173 796e 630a 2020  retrier_async.  
+0001c400: 2020 6173 796e 6320 6465 6620 6765 745f    async def get_
+0001c410: 6d61 726b 6574 5f6c 6576 6572 6167 655f  market_leverage_
+0001c420: 7469 6572 7328 7365 6c66 2c20 7379 6d62  tiers(self, symb
+0001c430: 6f6c 3a20 7374 7229 202d 3e20 5475 706c  ol: str) -> Tupl
+0001c440: 655b 7374 722c 204c 6973 745b 4469 6374  e[str, List[Dict
+0001c450: 5d5d 3a0a 2020 2020 2020 2020 2222 2220  ]]:.        """ 
+0001c460: 4c65 7665 7261 6765 2074 6965 7273 2070  Leverage tiers p
+0001c470: 6572 2073 796d 626f 6c20 2222 220a 2020  er symbol """.  
+0001c480: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0001c490: 2020 2020 2020 2074 6965 7220 3d20 6177         tier = aw
+0001c4a0: 6169 7420 7365 6c66 2e5f 6170 695f 6173  ait self._api_as
+0001c4b0: 796e 632e 6665 7463 685f 6d61 726b 6574  ync.fetch_market
+0001c4c0: 5f6c 6576 6572 6167 655f 7469 6572 7328  _leverage_tiers(
+0001c4d0: 7379 6d62 6f6c 290a 2020 2020 2020 2020  symbol).        
+0001c4e0: 2020 2020 7265 7475 726e 2073 796d 626f      return symbo
+0001c4f0: 6c2c 2074 6965 720a 2020 2020 2020 2020  l, tier.        
+0001c500: 6578 6365 7074 2063 6378 742e 4444 6f53  except ccxt.DDoS
+0001c510: 5072 6f74 6563 7469 6f6e 2061 7320 653a  Protection as e:
+0001c520: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0001c530: 7365 2044 446f 7350 726f 7465 6374 696f  se DDosProtectio
+0001c540: 6e28 6529 2066 726f 6d20 650a 2020 2020  n(e) from e.    
+0001c550: 2020 2020 6578 6365 7074 2028 6363 7874      except (ccxt
+0001c560: 2e4f 7065 7261 7469 6f6e 4661 696c 6564  .OperationFailed
+0001c570: 2c20 6363 7874 2e45 7863 6861 6e67 6545  , ccxt.ExchangeE
+0001c580: 7272 6f72 2920 6173 2065 3a0a 2020 2020  rror) as e:.    
+0001c590: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
+0001c5a0: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
+0001c5b0: 2020 2020 2020 2020 2020 2020 2020 6627                f'
+0001c5c0: 436f 756c 6420 6e6f 7420 6c6f 6164 206c  Could not load l
+0001c5d0: 6576 6572 6167 6520 7469 6572 7320 666f  everage tiers fo
+0001c5e0: 7220 7b73 796d 626f 6c7d 270a 2020 2020  r {symbol}'.    
+0001c5f0: 2020 2020 2020 2020 2020 2020 6627 2064              f' d
+0001c600: 7565 2074 6f20 7b65 2e5f 5f63 6c61 7373  ue to {e.__class
+0001c610: 5f5f 2e5f 5f6e 616d 655f 5f7d 2e20 4d65  __.__name__}. Me
+0001c620: 7373 6167 653a 207b 657d 270a 2020 2020  ssage: {e}'.    
+0001c630: 2020 2020 2020 2020 2920 6672 6f6d 2065          ) from e
+0001c640: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001c650: 6363 7874 2e42 6173 6545 7272 6f72 2061  ccxt.BaseError a
+0001c660: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
+0001c670: 2072 6169 7365 204f 7065 7261 7469 6f6e   raise Operation
+0001c680: 616c 4578 6365 7074 696f 6e28 6529 2066  alException(e) f
+0001c690: 726f 6d20 650a 0a20 2020 2064 6566 206c  rom e..    def l
+0001c6a0: 6f61 645f 6c65 7665 7261 6765 5f74 6965  oad_leverage_tie
+0001c6b0: 7273 2873 656c 6629 202d 3e20 4469 6374  rs(self) -> Dict
+0001c6c0: 5b73 7472 2c20 4c69 7374 5b44 6963 745d  [str, List[Dict]
+0001c6d0: 5d3a 0a20 2020 2020 2020 2069 6620 7365  ]:.        if se
+0001c6e0: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
+0001c6f0: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e46  == TradingMode.F
+0001c700: 5554 5552 4553 3a0a 2020 2020 2020 2020  UTURES:.        
+0001c710: 2020 2020 6966 2073 656c 662e 6578 6368      if self.exch
+0001c720: 616e 6765 5f68 6173 2827 6665 7463 684c  ange_has('fetchL
+0001c730: 6576 6572 6167 6554 6965 7273 2729 3a0a  everageTiers'):.
+0001c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c750: 2320 4665 7463 6820 616c 6c20 6c65 7665  # Fetch all leve
+0001c760: 7261 6765 2074 6965 7273 2061 7420 6f6e  rage tiers at on
+0001c770: 6365 0a20 2020 2020 2020 2020 2020 2020  ce.             
+0001c780: 2020 2072 6574 7572 6e20 7365 6c66 2e67     return self.g
+0001c790: 6574 5f6c 6576 6572 6167 655f 7469 6572  et_leverage_tier
+0001c7a0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0001c7b0: 656c 6966 2073 656c 662e 6578 6368 616e  elif self.exchan
+0001c7c0: 6765 5f68 6173 2827 6665 7463 684d 6172  ge_has('fetchMar
+0001c7d0: 6b65 744c 6576 6572 6167 6554 6965 7273  ketLeverageTiers
+0001c7e0: 2729 3a0a 2020 2020 2020 2020 2020 2020  '):.            
+0001c7f0: 2020 2020 2320 4d75 7374 2066 6574 6368      # Must fetch
+0001c800: 2074 6865 206c 6576 6572 6167 6520 7469   the leverage ti
+0001c810: 6572 7320 666f 7220 6561 6368 206d 6172  ers for each mar
+0001c820: 6b65 7420 7365 7061 7261 7465 6c79 0a20  ket separately. 
+0001c830: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001c840: 202a 2054 6869 7320 6973 2073 6c6f 7728   * This is slow(
+0001c850: 7e34 3573 2920 6f6e 204f 6b78 2c20 6d61  ~45s) on Okx, ma
+0001c860: 6b65 7320 7e39 3020 6170 6920 6361 6c6c  kes ~90 api call
+0001c870: 7320 746f 206c 6f61 6420 616c 6c20 6c69  s to load all li
+0001c880: 6e65 6172 2073 7761 7020 6d61 726b 6574  near swap market
+0001c890: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0001c8a0: 2020 6d61 726b 6574 7320 3d20 7365 6c66    markets = self
+0001c8b0: 2e6d 6172 6b65 7473 0a0a 2020 2020 2020  .markets..      
+0001c8c0: 2020 2020 2020 2020 2020 7379 6d62 6f6c            symbol
+0001c8d0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+0001c8e0: 2020 2020 2020 2020 2020 7379 6d62 6f6c            symbol
+0001c8f0: 2066 6f72 2073 796d 626f 6c2c 206d 6172   for symbol, mar
+0001c900: 6b65 7420 696e 206d 6172 6b65 7473 2e69  ket in markets.i
+0001c910: 7465 6d73 2829 0a20 2020 2020 2020 2020  tems().         
+0001c920: 2020 2020 2020 2020 2020 2069 6620 2873             if (s
+0001c930: 656c 662e 6d61 726b 6574 5f69 735f 6675  elf.market_is_fu
+0001c940: 7475 7265 286d 6172 6b65 7429 0a20 2020  ture(market).   
+0001c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c960: 2020 2020 2061 6e64 206d 6172 6b65 745b       and market[
+0001c970: 2771 756f 7465 275d 203d 3d20 7365 6c66  'quote'] == self
+0001c980: 2e5f 636f 6e66 6967 5b27 7374 616b 655f  ._config['stake_
+0001c990: 6375 7272 656e 6379 275d 290a 2020 2020  currency']).    
+0001c9a0: 2020 2020 2020 2020 2020 2020 5d0a 0a20              ].. 
+0001c9b0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001c9c0: 6965 7273 3a20 4469 6374 5b73 7472 2c20  iers: Dict[str, 
+0001c9d0: 4c69 7374 5b44 6963 745d 5d20 3d20 7b7d  List[Dict]] = {}
+0001c9e0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
+0001c9f0: 2020 7469 6572 735f 6361 6368 6564 203d    tiers_cached =
+0001ca00: 2073 656c 662e 6c6f 6164 5f63 6163 6865   self.load_cache
+0001ca10: 645f 6c65 7665 7261 6765 5f74 6965 7273  d_leverage_tiers
+0001ca20: 2873 656c 662e 5f63 6f6e 6669 675b 2773  (self._config['s
+0001ca30: 7461 6b65 5f63 7572 7265 6e63 7927 5d29  take_currency'])
+0001ca40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ca50: 2069 6620 7469 6572 735f 6361 6368 6564   if tiers_cached
+0001ca60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ca70: 2020 2020 2020 7469 6572 7320 3d20 7469        tiers = ti
+0001ca80: 6572 735f 6361 6368 6564 0a0a 2020 2020  ers_cached..    
+0001ca90: 2020 2020 2020 2020 2020 2020 636f 726f              coro
+0001caa0: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
+0001cab0: 2020 2020 2020 2020 2020 7365 6c66 2e67            self.g
+0001cac0: 6574 5f6d 6172 6b65 745f 6c65 7665 7261  et_market_levera
+0001cad0: 6765 5f74 6965 7273 2873 796d 626f 6c29  ge_tiers(symbol)
+0001cae0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001caf0: 2020 2020 2066 6f72 2073 796d 626f 6c20       for symbol 
+0001cb00: 696e 2073 6f72 7465 6428 7379 6d62 6f6c  in sorted(symbol
+0001cb10: 7329 2069 6620 7379 6d62 6f6c 206e 6f74  s) if symbol not
+0001cb20: 2069 6e20 7469 6572 735d 0a0a 2020 2020   in tiers]..    
+0001cb30: 2020 2020 2020 2020 2020 2020 2320 4265              # Be
+0001cb40: 2076 6572 626f 7365 2068 6572 652c 2061   verbose here, a
+0001cb50: 7320 7468 6973 2064 656c 6179 7320 7374  s this delays st
+0001cb60: 6172 7475 7020 6279 207e 3120 6d69 6e75  artup by ~1 minu
+0001cb70: 7465 2e0a 2020 2020 2020 2020 2020 2020  te..            
+0001cb80: 2020 2020 6966 2063 6f72 6f73 3a0a 2020      if coros:.  
+0001cb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cba0: 2020 6c6f 6767 6572 2e69 6e66 6f28 0a20    logger.info(. 
+0001cbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cbc0: 2020 2020 2020 2066 2249 6e69 7469 616c         f"Initial
+0001cbd0: 697a 696e 6720 6c65 7665 7261 6765 5f74  izing leverage_t
+0001cbe0: 6965 7273 2066 6f72 207b 6c65 6e28 7379  iers for {len(sy
+0001cbf0: 6d62 6f6c 7329 7d20 6d61 726b 6574 732e  mbols)} markets.
+0001cc00: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0001cc10: 2020 2020 2020 2020 2020 2022 5468 6973             "This
+0001cc20: 2077 696c 6c20 7461 6b65 2061 626f 7574   will take about
+0001cc30: 2061 206d 696e 7574 652e 2229 0a20 2020   a minute.").   
+0001cc40: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+0001cc50: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+0001cc60: 2020 2020 2020 206c 6f67 6765 722e 696e         logger.in
+0001cc70: 666f 2822 5573 696e 6720 6361 6368 6564  fo("Using cached
+0001cc80: 206c 6576 6572 6167 655f 7469 6572 732e   leverage_tiers.
+0001cc90: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
+0001cca0: 2020 2020 6173 796e 6320 6465 6620 6761      async def ga
+0001ccb0: 7468 6572 5f72 6573 756c 7473 2869 6e70  ther_results(inp
+0001ccc0: 7574 5f63 6f72 6f29 3a0a 2020 2020 2020  ut_coro):.      
+0001ccd0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001cce0: 7475 726e 2061 7761 6974 2061 7379 6e63  turn await async
+0001ccf0: 696f 2e67 6174 6865 7228 2a69 6e70 7574  io.gather(*input
+0001cd00: 5f63 6f72 6f2c 2072 6574 7572 6e5f 6578  _coro, return_ex
+0001cd10: 6365 7074 696f 6e73 3d54 7275 6529 0a0a  ceptions=True)..
+0001cd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd30: 666f 7220 696e 7075 745f 636f 726f 2069  for input_coro i
+0001cd40: 6e20 6368 756e 6b73 2863 6f72 6f73 2c20  n chunks(coros, 
+0001cd50: 3130 3029 3a0a 0a20 2020 2020 2020 2020  100):..         
+0001cd60: 2020 2020 2020 2020 2020 2077 6974 6820             with 
+0001cd70: 7365 6c66 2e5f 6c6f 6f70 5f6c 6f63 6b3a  self._loop_lock:
+0001cd80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001cd90: 2020 2020 2020 2020 2072 6573 756c 7473           results
+0001cda0: 203d 2073 656c 662e 6c6f 6f70 2e72 756e   = self.loop.run
+0001cdb0: 5f75 6e74 696c 5f63 6f6d 706c 6574 6528  _until_complete(
+0001cdc0: 6761 7468 6572 5f72 6573 756c 7473 2869  gather_results(i
+0001cdd0: 6e70 7574 5f63 6f72 6f29 290a 0a20 2020  nput_coro))..   
+0001cde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdf0: 2066 6f72 2072 6573 2069 6e20 7265 7375   for res in resu
+0001ce00: 6c74 733a 0a20 2020 2020 2020 2020 2020  lts:.           
+0001ce10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001ce20: 6973 696e 7374 616e 6365 2872 6573 2c20  isinstance(res, 
+0001ce30: 4578 6365 7074 696f 6e29 3a0a 2020 2020  Exception):.    
+0001ce40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce50: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+0001ce60: 6172 6e69 6e67 2866 224c 6576 6572 6167  arning(f"Leverag
+0001ce70: 6520 7469 6572 2065 7863 6570 7469 6f6e  e tier exception
+0001ce80: 3a20 7b72 6570 7228 7265 7329 7d22 290a  : {repr(res)}").
+0001ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cea0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0001ceb0: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
+0001cec0: 2020 2020 2020 2020 2020 2020 2073 796d               sym
+0001ced0: 626f 6c2c 2074 6965 7220 3d20 7265 730a  bol, tier = res.
+0001cee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cef0: 2020 2020 2020 2020 7469 6572 735b 7379          tiers[sy
+0001cf00: 6d62 6f6c 5d20 3d20 7469 6572 0a20 2020  mbol] = tier.   
+0001cf10: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001cf20: 6c65 6e28 636f 726f 7329 203e 2030 3a0a  len(coros) > 0:.
+0001cf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf40: 2020 2020 7365 6c66 2e63 6163 6865 5f6c      self.cache_l
+0001cf50: 6576 6572 6167 655f 7469 6572 7328 7469  everage_tiers(ti
+0001cf60: 6572 732c 2073 656c 662e 5f63 6f6e 6669  ers, self._confi
+0001cf70: 675b 2773 7461 6b65 5f63 7572 7265 6e63  g['stake_currenc
+0001cf80: 7927 5d29 0a20 2020 2020 2020 2020 2020  y']).           
+0001cf90: 2020 2020 206c 6f67 6765 722e 696e 666f       logger.info
+0001cfa0: 2866 2244 6f6e 6520 696e 6974 6961 6c69  (f"Done initiali
+0001cfb0: 7a69 6e67 207b 6c65 6e28 7379 6d62 6f6c  zing {len(symbol
+0001cfc0: 7329 7d20 6d61 726b 6574 732e 2229 0a0a  s)} markets.")..
+0001cfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfe0: 7265 7475 726e 2074 6965 7273 0a20 2020  return tiers.   
+0001cff0: 2020 2020 2072 6574 7572 6e20 7b7d 0a0a       return {}..
+0001d000: 2020 2020 6465 6620 6361 6368 655f 6c65      def cache_le
+0001d010: 7665 7261 6765 5f74 6965 7273 2873 656c  verage_tiers(sel
+0001d020: 662c 2074 6965 7273 3a20 4469 6374 5b73  f, tiers: Dict[s
+0001d030: 7472 2c20 4c69 7374 5b44 6963 745d 5d2c  tr, List[Dict]],
+0001d040: 2073 7461 6b65 5f63 7572 7265 6e63 793a   stake_currency:
+0001d050: 2073 7472 2920 2d3e 204e 6f6e 653a 0a0a   str) -> None:..
+0001d060: 2020 2020 2020 2020 6669 6c65 6e61 6d65          filename
+0001d070: 203d 2073 656c 662e 5f63 6f6e 6669 675b   = self._config[
+0001d080: 2764 6174 6164 6972 275d 202f 2022 6675  'datadir'] / "fu
+0001d090: 7475 7265 7322 202f 2066 226c 6576 6572  tures" / f"lever
+0001d0a0: 6167 655f 7469 6572 735f 7b73 7461 6b65  age_tiers_{stake
+0001d0b0: 5f63 7572 7265 6e63 797d 2e6a 736f 6e22  _currency}.json"
+0001d0c0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001d0d0: 6669 6c65 6e61 6d65 2e70 6172 656e 742e  filename.parent.
+0001d0e0: 6973 5f64 6972 2829 3a0a 2020 2020 2020  is_dir():.      
+0001d0f0: 2020 2020 2020 6669 6c65 6e61 6d65 2e70        filename.p
+0001d100: 6172 656e 742e 6d6b 6469 7228 7061 7265  arent.mkdir(pare
+0001d110: 6e74 733d 5472 7565 290a 2020 2020 2020  nts=True).      
+0001d120: 2020 6461 7461 203d 207b 0a20 2020 2020    data = {.     
+0001d130: 2020 2020 2020 2022 7570 6461 7465 6422         "updated"
+0001d140: 3a20 6461 7465 7469 6d65 2e6e 6f77 2874  : datetime.now(t
+0001d150: 696d 657a 6f6e 652e 7574 6329 2c0a 2020  imezone.utc),.  
+0001d160: 2020 2020 2020 2020 2020 2264 6174 6122            "data"
+0001d170: 3a20 7469 6572 732c 0a20 2020 2020 2020  : tiers,.       
+0001d180: 207d 0a20 2020 2020 2020 2066 696c 655f   }.        file_
+0001d190: 6475 6d70 5f6a 736f 6e28 6669 6c65 6e61  dump_json(filena
+0001d1a0: 6d65 2c20 6461 7461 290a 0a20 2020 2064  me, data)..    d
+0001d1b0: 6566 206c 6f61 645f 6361 6368 6564 5f6c  ef load_cached_l
+0001d1c0: 6576 6572 6167 655f 7469 6572 7328 7365  everage_tiers(se
+0001d1d0: 6c66 2c20 7374 616b 655f 6375 7272 656e  lf, stake_curren
+0001d1e0: 6379 3a20 7374 7229 202d 3e20 4f70 7469  cy: str) -> Opti
+0001d1f0: 6f6e 616c 5b44 6963 745b 7374 722c 204c  onal[Dict[str, L
+0001d200: 6973 745b 4469 6374 5d5d 5d3a 0a20 2020  ist[Dict]]]:.   
+0001d210: 2020 2020 2066 696c 656e 616d 6520 3d20       filename = 
+0001d220: 7365 6c66 2e5f 636f 6e66 6967 5b27 6461  self._config['da
+0001d230: 7461 6469 7227 5d20 2f20 2266 7574 7572  tadir'] / "futur
+0001d240: 6573 2220 2f20 6622 6c65 7665 7261 6765  es" / f"leverage
+0001d250: 5f74 6965 7273 5f7b 7374 616b 655f 6375  _tiers_{stake_cu
+0001d260: 7272 656e 6379 7d2e 6a73 6f6e 220a 2020  rrency}.json".  
+0001d270: 2020 2020 2020 6966 2066 696c 656e 616d        if filenam
+0001d280: 652e 6973 5f66 696c 6528 293a 0a20 2020  e.is_file():.   
+0001d290: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0001d2a0: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+0001d2b0: 6572 7320 3d20 6669 6c65 5f6c 6f61 645f  ers = file_load_
+0001d2c0: 6a73 6f6e 2866 696c 656e 616d 6529 0a20  json(filename). 
+0001d2d0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
+0001d2e0: 7064 6174 6564 203d 2074 6965 7273 2e67  pdated = tiers.g
+0001d2f0: 6574 2827 7570 6461 7465 6427 290a 2020  et('updated').  
+0001d300: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001d310: 2075 7064 6174 6564 3a0a 2020 2020 2020   updated:.      
+0001d320: 2020 2020 2020 2020 2020 2020 2020 7570                up
+0001d330: 6461 7465 645f 6474 203d 2070 6172 7365  dated_dt = parse
+0001d340: 722e 7061 7273 6528 7570 6461 7465 6429  r.parse(updated)
+0001d350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d360: 2020 2020 2069 6620 7570 6461 7465 645f       if updated_
+0001d370: 6474 203c 2064 6174 6574 696d 652e 6e6f  dt < datetime.no
+0001d380: 7728 7469 6d65 7a6f 6e65 2e75 7463 2920  w(timezone.utc) 
+0001d390: 2d20 7469 6d65 6465 6c74 6128 7765 656b  - timedelta(week
+0001d3a0: 733d 3429 3a0a 2020 2020 2020 2020 2020  s=4):.          
+0001d3b0: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+0001d3c0: 6767 6572 2e69 6e66 6f28 2243 6163 6865  gger.info("Cache
+0001d3d0: 6420 6c65 7665 7261 6765 2074 6965 7273  d leverage tiers
+0001d3e0: 2061 7265 206f 7574 6461 7465 642e 2057   are outdated. W
+0001d3f0: 696c 6c20 7570 6461 7465 2e22 290a 2020  ill update.").  
+0001d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d410: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0001d420: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0001d430: 2020 7265 7475 726e 2074 6965 7273 5b27    return tiers['
+0001d440: 6461 7461 275d 0a20 2020 2020 2020 2020  data'].         
+0001d450: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+0001d460: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+0001d470: 2020 2020 206c 6f67 6765 722e 6578 6365       logger.exce
+0001d480: 7074 696f 6e28 2245 7272 6f72 206c 6f61  ption("Error loa
+0001d490: 6469 6e67 2063 6163 6865 6420 6c65 7665  ding cached leve
+0001d4a0: 7261 6765 2074 6965 7273 2e20 5265 6672  rage tiers. Refr
+0001d4b0: 6573 6869 6e67 2e22 290a 2020 2020 2020  eshing.").      
+0001d4c0: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
+0001d4d0: 2020 2064 6566 2066 696c 6c5f 6c65 7665     def fill_leve
+0001d4e0: 7261 6765 5f74 6965 7273 2873 656c 6629  rage_tiers(self)
+0001d4f0: 202d 3e20 4e6f 6e65 3a0a 2020 2020 2020   -> None:.      
+0001d500: 2020 2222 220a 2020 2020 2020 2020 4173    """.        As
+0001d510: 7369 676e 7320 7072 6f70 6572 7479 205f  signs property _
+0001d520: 6c65 7665 7261 6765 5f74 6965 7273 2074  leverage_tiers t
+0001d530: 6f20 6120 6469 6374 696f 6e61 7279 206f  o a dictionary o
+0001d540: 6620 696e 666f 726d 6174 696f 6e20 6162  f information ab
+0001d550: 6f75 7420 7468 6520 6c65 7665 7261 6765  out the leverage
+0001d560: 0a20 2020 2020 2020 2061 6c6c 6f77 6564  .        allowed
+0001d570: 206f 6e20 6561 6368 2070 6169 720a 2020   on each pair.  
+0001d580: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001d590: 2020 6c65 7665 7261 6765 5f74 6965 7273    leverage_tiers
+0001d5a0: 203d 2073 656c 662e 6c6f 6164 5f6c 6576   = self.load_lev
+0001d5b0: 6572 6167 655f 7469 6572 7328 290a 2020  erage_tiers().  
+0001d5c0: 2020 2020 2020 666f 7220 7061 6972 2c20        for pair, 
+0001d5d0: 7469 6572 7320 696e 206c 6576 6572 6167  tiers in leverag
+0001d5e0: 655f 7469 6572 732e 6974 656d 7328 293a  e_tiers.items():
+0001d5f0: 0a20 2020 2020 2020 2020 2020 2070 6169  .            pai
+0001d600: 725f 7469 6572 7320 3d20 5b5d 0a20 2020  r_tiers = [].   
+0001d610: 2020 2020 2020 2020 2066 6f72 2074 6965           for tie
+0001d620: 7220 696e 2074 6965 7273 3a0a 2020 2020  r in tiers:.    
+0001d630: 2020 2020 2020 2020 2020 2020 7061 6972              pair
+0001d640: 5f74 6965 7273 2e61 7070 656e 6428 7365  _tiers.append(se
+0001d650: 6c66 2e70 6172 7365 5f6c 6576 6572 6167  lf.parse_leverag
+0001d660: 655f 7469 6572 2874 6965 7229 290a 2020  e_tier(tier)).  
+0001d670: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+0001d680: 6c65 7665 7261 6765 5f74 6965 7273 5b70  leverage_tiers[p
+0001d690: 6169 725d 203d 2070 6169 725f 7469 6572  air] = pair_tier
+0001d6a0: 730a 0a20 2020 2064 6566 2070 6172 7365  s..    def parse
+0001d6b0: 5f6c 6576 6572 6167 655f 7469 6572 2873  _leverage_tier(s
+0001d6c0: 656c 662c 2074 6965 7229 202d 3e20 4469  elf, tier) -> Di
+0001d6d0: 6374 3a0a 2020 2020 2020 2020 696e 666f  ct:.        info
+0001d6e0: 203d 2074 6965 722e 6765 7428 2769 6e66   = tier.get('inf
+0001d6f0: 6f27 2c20 7b7d 290a 2020 2020 2020 2020  o', {}).        
+0001d700: 7265 7475 726e 207b 0a20 2020 2020 2020  return {.       
+0001d710: 2020 2020 2027 6d69 6e4e 6f74 696f 6e61       'minNotiona
+0001d720: 6c27 3a20 7469 6572 5b27 6d69 6e4e 6f74  l': tier['minNot
+0001d730: 696f 6e61 6c27 5d2c 0a20 2020 2020 2020  ional'],.       
+0001d740: 2020 2020 2027 6d61 784e 6f74 696f 6e61       'maxNotiona
+0001d750: 6c27 3a20 7469 6572 5b27 6d61 784e 6f74  l': tier['maxNot
+0001d760: 696f 6e61 6c27 5d2c 0a20 2020 2020 2020  ional'],.       
+0001d770: 2020 2020 2027 6d61 696e 7465 6e61 6e63       'maintenanc
+0001d780: 654d 6172 6769 6e52 6174 6527 3a20 7469  eMarginRate': ti
+0001d790: 6572 5b27 6d61 696e 7465 6e61 6e63 654d  er['maintenanceM
+0001d7a0: 6172 6769 6e52 6174 6527 5d2c 0a20 2020  arginRate'],.   
+0001d7b0: 2020 2020 2020 2020 2027 6d61 784c 6576           'maxLev
+0001d7c0: 6572 6167 6527 3a20 7469 6572 5b27 6d61  erage': tier['ma
+0001d7d0: 784c 6576 6572 6167 6527 5d2c 0a20 2020  xLeverage'],.   
+0001d7e0: 2020 2020 2020 2020 2027 6d61 696e 7441           'maintA
+0001d7f0: 6d74 273a 2066 6c6f 6174 2869 6e66 6f5b  mt': float(info[
+0001d800: 2763 756d 275d 2920 6966 2027 6375 6d27  'cum']) if 'cum'
+0001d810: 2069 6e20 696e 666f 2065 6c73 6520 4e6f   in info else No
+0001d820: 6e65 2c0a 2020 2020 2020 2020 7d0a 0a20  ne,.        }.. 
+0001d830: 2020 2064 6566 2067 6574 5f6d 6178 5f6c     def get_max_l
+0001d840: 6576 6572 6167 6528 7365 6c66 2c20 7061  everage(self, pa
+0001d850: 6972 3a20 7374 722c 2073 7461 6b65 5f61  ir: str, stake_a
+0001d860: 6d6f 756e 743a 204f 7074 696f 6e61 6c5b  mount: Optional[
+0001d870: 666c 6f61 745d 2920 2d3e 2066 6c6f 6174  float]) -> float
+0001d880: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001d890: 2020 2020 2020 5265 7475 726e 7320 7468        Returns th
+0001d8a0: 6520 6d61 7869 6d75 6d20 6c65 7665 7261  e maximum levera
+0001d8b0: 6765 2074 6861 7420 6120 7061 6972 2063  ge that a pair c
+0001d8c0: 616e 2062 6520 7472 6164 6564 2061 740a  an be traded at.
+0001d8d0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+0001d8e0: 6169 723a 2054 6865 2062 6173 652f 7175  air: The base/qu
+0001d8f0: 6f74 6520 6375 7272 656e 6379 2070 6169  ote currency pai
+0001d900: 7220 6265 696e 6720 7472 6164 6564 0a20  r being traded. 
+0001d910: 2020 2020 2020 203a 7374 616b 655f 616d         :stake_am
+0001d920: 6f75 6e74 3a20 5468 6520 746f 7461 6c20  ount: The total 
+0001d930: 7661 6c75 6520 6f66 2074 6865 2074 7261  value of the tra
+0001d940: 6465 7273 206d 6172 6769 6e5f 6d6f 6465  ders margin_mode
+0001d950: 2069 6e20 7175 6f74 6520 6375 7272 656e   in quote curren
+0001d960: 6379 0a20 2020 2020 2020 2022 2222 0a0a  cy.        """..
+0001d970: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0001d980: 7472 6164 696e 675f 6d6f 6465 203d 3d20  trading_mode == 
+0001d990: 5472 6164 696e 674d 6f64 652e 5350 4f54  TradingMode.SPOT
+0001d9a0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001d9b0: 7475 726e 2031 2e30 0a0a 2020 2020 2020  turn 1.0..      
+0001d9c0: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
+0001d9d0: 675f 6d6f 6465 203d 3d20 5472 6164 696e  g_mode == Tradin
+0001d9e0: 674d 6f64 652e 4655 5455 5245 533a 0a0a  gMode.FUTURES:..
+0001d9f0: 2020 2020 2020 2020 2020 2020 2320 4368              # Ch
+0001da00: 6563 6b73 2061 6e64 2065 6467 6520 6361  ecks and edge ca
+0001da10: 7365 730a 2020 2020 2020 2020 2020 2020  ses.            
+0001da20: 6966 2073 7461 6b65 5f61 6d6f 756e 7420  if stake_amount 
+0001da30: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0001da40: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+0001da50: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+0001da60: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+0001da70: 2020 2020 2020 2020 2066 277b 7365 6c66           f'{self
+0001da80: 2e6e 616d 657d 2e67 6574 5f6d 6178 5f6c  .name}.get_max_l
+0001da90: 6576 6572 6167 6520 7265 7175 6972 6573  everage requires
+0001daa0: 2061 7267 756d 656e 7420 7374 616b 655f   argument stake_
+0001dab0: 616d 6f75 6e74 270a 2020 2020 2020 2020  amount'.        
+0001dac0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001dad0: 2020 2020 2020 2069 6620 7061 6972 206e         if pair n
+0001dae0: 6f74 2069 6e20 7365 6c66 2e5f 6c65 7665  ot in self._leve
+0001daf0: 7261 6765 5f74 6965 7273 3a0a 2020 2020  rage_tiers:.    
+0001db00: 2020 2020 2020 2020 2020 2020 2320 4d61              # Ma
+0001db10: 7962 6520 7261 6973 6520 6578 6365 7074  ybe raise except
+0001db20: 696f 6e20 6265 6361 7573 6520 6974 2063  ion because it c
+0001db30: 616e 2774 2062 6520 7472 6164 6564 206f  an't be traded o
+0001db40: 6e20 6675 7475 7265 733f 0a20 2020 2020  n futures?.     
+0001db50: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001db60: 6e20 312e 300a 0a20 2020 2020 2020 2020  n 1.0..         
+0001db70: 2020 2070 6169 725f 7469 6572 7320 3d20     pair_tiers = 
+0001db80: 7365 6c66 2e5f 6c65 7665 7261 6765 5f74  self._leverage_t
+0001db90: 6965 7273 5b70 6169 725d 0a0a 2020 2020  iers[pair]..    
+0001dba0: 2020 2020 2020 2020 6966 2073 7461 6b65          if stake
+0001dbb0: 5f61 6d6f 756e 7420 3d3d 2030 3a0a 2020  _amount == 0:.  
+0001dbc0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0001dbd0: 7475 726e 2073 656c 662e 5f6c 6576 6572  turn self._lever
+0001dbe0: 6167 655f 7469 6572 735b 7061 6972 5d5b  age_tiers[pair][
+0001dbf0: 305d 5b27 6d61 784c 6576 6572 6167 6527  0]['maxLeverage'
+0001dc00: 5d20 2023 204d 6178 206c 6576 2066 6f72  ]  # Max lev for
+0001dc10: 206c 6f77 6573 7420 616d 6f75 6e74 0a0a   lowest amount..
+0001dc20: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0001dc30: 7469 6572 5f69 6e64 6578 2069 6e20 7261  tier_index in ra
+0001dc40: 6e67 6528 6c65 6e28 7061 6972 5f74 6965  nge(len(pair_tie
+0001dc50: 7273 2929 3a0a 0a20 2020 2020 2020 2020  rs)):..         
+0001dc60: 2020 2020 2020 2074 6965 7220 3d20 7061         tier = pa
+0001dc70: 6972 5f74 6965 7273 5b74 6965 725f 696e  ir_tiers[tier_in
+0001dc80: 6465 785d 0a20 2020 2020 2020 2020 2020  dex].           
+0001dc90: 2020 2020 206c 6576 203d 2074 6965 725b       lev = tier[
+0001dca0: 276d 6178 4c65 7665 7261 6765 275d 0a0a  'maxLeverage']..
+0001dcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcc0: 6966 2074 6965 725f 696e 6465 7820 3c20  if tier_index < 
+0001dcd0: 6c65 6e28 7061 6972 5f74 6965 7273 2920  len(pair_tiers) 
+0001dce0: 2d20 313a 0a20 2020 2020 2020 2020 2020  - 1:.           
+0001dcf0: 2020 2020 2020 2020 206e 6578 745f 7469           next_ti
+0001dd00: 6572 203d 2070 6169 725f 7469 6572 735b  er = pair_tiers[
+0001dd10: 7469 6572 5f69 6e64 6578 202b 2031 5d0a  tier_index + 1].
+0001dd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dd30: 2020 2020 6e65 7874 5f66 6c6f 6f72 203d      next_floor =
+0001dd40: 206e 6578 745f 7469 6572 5b27 6d69 6e4e   next_tier['minN
+0001dd50: 6f74 696f 6e61 6c27 5d20 2f20 6e65 7874  otional'] / next
+0001dd60: 5f74 6965 725b 276d 6178 4c65 7665 7261  _tier['maxLevera
+0001dd70: 6765 275d 0a20 2020 2020 2020 2020 2020  ge'].           
+0001dd80: 2020 2020 2020 2020 2069 6620 6e65 7874           if next
+0001dd90: 5f66 6c6f 6f72 203e 2073 7461 6b65 5f61  _floor > stake_a
+0001dda0: 6d6f 756e 743a 2020 2320 4e65 7874 2074  mount:  # Next t
+0001ddb0: 6965 7220 6d69 6e20 746f 6f20 6869 6768  ier min too high
+0001ddc0: 2066 6f72 2073 7461 6b65 2061 6d6f 756e   for stake amoun
+0001ddd0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001dde0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001ddf0: 206d 696e 2828 7469 6572 5b27 6d61 784e   min((tier['maxN
+0001de00: 6f74 696f 6e61 6c27 5d20 2f20 7374 616b  otional'] / stak
+0001de10: 655f 616d 6f75 6e74 292c 206c 6576 290a  e_amount), lev).
+0001de20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de30: 2020 2020 2020 2020 230a 2020 2020 2020          #.      
+0001de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de50: 2020 2320 5769 7468 2074 6865 2074 776f    # With the two
+0001de60: 206c 6576 6572 6167 6520 7469 6572 7320   leverage tiers 
+0001de70: 6265 6c6f 772c 0a20 2020 2020 2020 2020  below,.         
+0001de80: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0001de90: 202d 2061 2073 7461 6b65 2061 6d6f 756e   - a stake amoun
+0001dea0: 7420 6f66 2031 3530 2077 6f75 6c64 206d  t of 150 would m
+0001deb0: 6561 6e20 6120 6d61 7820 6c65 7665 7261  ean a max levera
+0001dec0: 6765 206f 6620 2831 3030 3030 202f 2031  ge of (10000 / 1
+0001ded0: 3530 2920 3d20 3636 2e36 360a 2020 2020  50) = 66.66.    
+0001dee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001def0: 2020 2020 2320 2d20 7374 616b 6573 2062      # - stakes b
+0001df00: 656c 6f77 2031 3333 2e33 3320 3d20 6d61  elow 133.33 = ma
+0001df10: 785f 6c65 7620 6f66 2037 350a 2020 2020  x_lev of 75.    
+0001df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df30: 2020 2020 2320 2d20 7374 616b 6573 2062      # - stakes b
+0001df40: 6574 7765 656e 2031 3333 2e33 332d 3230  etween 133.33-20
+0001df50: 3020 3d20 6d61 785f 6c65 7620 6f66 2031  0 = max_lev of 1
+0001df60: 3030 3030 2f73 7461 6b65 203d 2035 302e  0000/stake = 50.
+0001df70: 3031 2d37 342e 3939 0a20 2020 2020 2020  01-74.99.       
 0001df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df90: 2020 2020 2020 2020 2320 2020 2020 226c          #     "l
-0001dfa0: 6576 223a 2037 352c 0a20 2020 2020 2020  ev": 75,.       
-0001dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfc0: 2023 207d 2c0a 2020 2020 2020 2020 2020   # },.          
-0001dfd0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001dfe0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0001dff0: 2020 2020 2020 2020 2020 2320 2020 2020            #     
-0001e000: 226d 696e 223a 2031 3030 3030 2c20 2023  "min": 10000,  #
-0001e010: 2073 7461 6b65 203d 2032 3030 2e30 0a20   stake = 200.0. 
-0001e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e030: 2020 2020 2020 2023 2020 2020 2022 6d61         #     "ma
-0001e040: 7822 3a20 3530 3030 302c 2020 2320 6d61  x": 50000,  # ma
-0001e050: 785f 7374 616b 6540 3530 203d 2035 3030  x_stake@50 = 500
-0001e060: 3030 2f35 3020 3d20 3130 3030 2e30 0a20  00/50 = 1000.0. 
-0001e070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e080: 2020 2020 2020 2023 2020 2020 2022 6c65         #     "le
-0001e090: 7622 3a20 3530 2c0a 2020 2020 2020 2020  v": 50,.        
-0001e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0b0: 2320 7d0a 2020 2020 2020 2020 2020 2020  # }.            
-0001e0c0: 2020 2020 2020 2020 2020 2020 230a 0a20              #.. 
-0001e0d0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001e0e0: 6c73 653a 2020 2320 6966 206f 6e20 7468  lse:  # if on th
-0001e0f0: 6520 6c61 7374 2074 6965 720a 2020 2020  e last tier.    
-0001e100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e110: 6966 2073 7461 6b65 5f61 6d6f 756e 7420  if stake_amount 
-0001e120: 3e20 7469 6572 5b27 6d61 784e 6f74 696f  > tier['maxNotio
-0001e130: 6e61 6c27 5d3a 0a20 2020 2020 2020 2020  nal']:.         
-0001e140: 2020 2020 2020 2020 2020 2020 2020 2023                 #
-0001e150: 2049 6620 7374 616b 6520 6973 203e 2074   If stake is > t
-0001e160: 6861 6e20 6d61 7820 7472 6164 6561 626c  han max tradeabl
-0001e170: 6520 616d 6f75 6e74 0a20 2020 2020 2020  e amount.       
+0001df90: 2023 202d 2073 7461 6b65 7320 6672 6f6d   # - stakes from
+0001dfa0: 2032 3030 202b 2031 3030 3020 3d20 6d61   200 + 1000 = ma
+0001dfb0: 785f 6c65 7620 6f66 2035 300a 2020 2020  x_lev of 50.    
+0001dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfd0: 2020 2020 230a 2020 2020 2020 2020 2020      #.          
+0001dfe0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0001dff0: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+0001e000: 2020 2020 2020 2020 2020 2320 2020 2020            #     
+0001e010: 226d 696e 223a 2030 2c20 2020 2020 2023  "min": 0,      #
+0001e020: 2073 7461 6b65 203d 2030 2e30 0a20 2020   stake = 0.0.   
+0001e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e040: 2020 2020 2023 2020 2020 2022 6d61 7822       #     "max"
+0001e050: 3a20 3130 3030 302c 2020 2320 6d61 785f  : 10000,  # max_
+0001e060: 7374 616b 6540 3735 203d 2031 3030 3030  stake@75 = 10000
+0001e070: 2f37 3520 3d20 3133 332e 3333 3333 3333  /75 = 133.333333
+0001e080: 3333 3333 3333 3334 0a20 2020 2020 2020  33333334.       
+0001e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0a0: 2023 2020 2020 2022 6c65 7622 3a20 3735   #     "lev": 75
+0001e0b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001e0c0: 2020 2020 2020 2020 2020 2320 7d2c 0a20            # },. 
+0001e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0e0: 2020 2020 2020 2023 207b 0a20 2020 2020         # {.     
+0001e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e100: 2020 2023 2020 2020 2022 6d69 6e22 3a20     #     "min": 
+0001e110: 3130 3030 302c 2020 2320 7374 616b 6520  10000,  # stake 
+0001e120: 3d20 3230 302e 300a 2020 2020 2020 2020  = 200.0.        
+0001e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e140: 2320 2020 2020 226d 6178 223a 2035 3030  #     "max": 500
+0001e150: 3030 2c20 2023 206d 6178 5f73 7461 6b65  00,  # max_stake
+0001e160: 4035 3020 3d20 3530 3030 302f 3530 203d  @50 = 50000/50 =
+0001e170: 2031 3030 302e 300a 2020 2020 2020 2020   1000.0.        
 0001e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e190: 2072 6169 7365 2049 6e76 616c 6964 4f72   raise InvalidOr
-0001e1a0: 6465 7245 7863 6570 7469 6f6e 2866 2741  derException(f'A
-0001e1b0: 6d6f 756e 7420 7b73 7461 6b65 5f61 6d6f  mount {stake_amo
-0001e1c0: 756e 747d 2074 6f6f 2068 6967 6820 666f  unt} too high fo
-0001e1d0: 7220 7b70 6169 727d 2729 0a20 2020 2020  r {pair}').     
-0001e1e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001e1f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001e200: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0001e210: 7572 6e20 7469 6572 5b27 6d61 784c 6576  urn tier['maxLev
-0001e220: 6572 6167 6527 5d0a 0a20 2020 2020 2020  erage']..       
-0001e230: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
-0001e240: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
-0001e250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e260: 2027 4c6f 6f70 6564 2074 6872 6f75 6768   'Looped through
-0001e270: 2061 6c6c 2074 6965 7273 2077 6974 686f   all tiers witho
-0001e280: 7574 2066 696e 6469 6e67 2061 206d 6178  ut finding a max
-0001e290: 206c 6576 6572 6167 652e 2053 686f 756c   leverage. Shoul
-0001e2a0: 6420 6e65 7665 7220 6265 2072 6561 6368  d never be reach
-0001e2b0: 6564 270a 2020 2020 2020 2020 2020 2020  ed'.            
-0001e2c0: 290a 0a20 2020 2020 2020 2065 6c69 6620  )..        elif 
-0001e2d0: 7365 6c66 2e74 7261 6469 6e67 5f6d 6f64  self.trading_mod
-0001e2e0: 6520 3d3d 2054 7261 6469 6e67 4d6f 6465  e == TradingMode
-0001e2f0: 2e4d 4152 4749 4e3a 2020 2320 5365 6172  .MARGIN:  # Sear
-0001e300: 6368 206d 6172 6b65 7473 2e6c 696d 6974  ch markets.limit
-0001e310: 7320 666f 7220 6d61 7820 6c65 760a 2020  s for max lev.  
-0001e320: 2020 2020 2020 2020 2020 6d61 726b 6574            market
-0001e330: 203d 2073 656c 662e 6d61 726b 6574 735b   = self.markets[
-0001e340: 7061 6972 5d0a 2020 2020 2020 2020 2020  pair].          
-0001e350: 2020 6966 206d 6172 6b65 745b 276c 696d    if market['lim
-0001e360: 6974 7327 5d5b 276c 6576 6572 6167 6527  its']['leverage'
-0001e370: 5d5b 276d 6178 275d 2069 7320 6e6f 7420  ]['max'] is not 
-0001e380: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001e390: 2020 2020 2020 7265 7475 726e 206d 6172        return mar
-0001e3a0: 6b65 745b 276c 696d 6974 7327 5d5b 276c  ket['limits']['l
-0001e3b0: 6576 6572 6167 6527 5d5b 276d 6178 275d  everage']['max']
-0001e3c0: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-0001e3d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0001e3e0: 2020 2072 6574 7572 6e20 312e 3020 2023     return 1.0  #
-0001e3f0: 2044 6566 6175 6c74 2069 6620 6d61 7820   Default if max 
-0001e400: 6c65 7665 7261 6765 2063 616e 6e6f 7420  leverage cannot 
-0001e410: 6265 2066 6f75 6e64 0a20 2020 2020 2020  be found.       
-0001e420: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0001e430: 2020 2072 6574 7572 6e20 312e 300a 0a20     return 1.0.. 
-0001e440: 2020 2040 7265 7472 6965 720a 2020 2020     @retrier.    
-0001e450: 6465 6620 5f73 6574 5f6c 6576 6572 6167  def _set_leverag
-0001e460: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-0001e470: 0a20 2020 2020 2020 206c 6576 6572 6167  .        leverag
-0001e480: 653a 2066 6c6f 6174 2c0a 2020 2020 2020  e: float,.      
-0001e490: 2020 7061 6972 3a20 4f70 7469 6f6e 616c    pair: Optional
-0001e4a0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
-0001e4b0: 2020 2020 2020 6163 6365 7074 5f66 6169        accept_fai
-0001e4c0: 6c3a 2062 6f6f 6c20 3d20 4661 6c73 652c  l: bool = False,
-0001e4d0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-0001e4e0: 2222 220a 2020 2020 2020 2020 5365 7427  """.        Set'
-0001e4f0: 7320 7468 6520 6c65 7665 7261 6765 2062  s the leverage b
-0001e500: 6566 6f72 6520 6d61 6b69 6e67 2061 2074  efore making a t
-0001e510: 7261 6465 2c20 696e 206f 7264 6572 2074  rade, in order t
-0001e520: 6f20 6e6f 740a 2020 2020 2020 2020 6861  o not.        ha
-0001e530: 7665 2074 6865 2073 616d 6520 6c65 7665  ve the same leve
-0001e540: 7261 6765 206f 6e20 6576 6572 7920 7472  rage on every tr
-0001e550: 6164 650a 2020 2020 2020 2020 2222 220a  ade.        """.
-0001e560: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0001e570: 5f63 6f6e 6669 675b 2764 7279 5f72 756e  _config['dry_run
-0001e580: 275d 206f 7220 6e6f 7420 7365 6c66 2e65  '] or not self.e
-0001e590: 7863 6861 6e67 655f 6861 7328 2273 6574  xchange_has("set
-0001e5a0: 4c65 7665 7261 6765 2229 3a0a 2020 2020  Leverage"):.    
-0001e5b0: 2020 2020 2020 2020 2320 536f 6d65 2065          # Some e
-0001e5c0: 7863 6861 6e67 6573 206f 6e6c 7920 7375  xchanges only su
-0001e5d0: 7070 6f72 7420 6f6e 6520 6d61 7267 696e  pport one margin
-0001e5e0: 5f6d 6f64 6520 7479 7065 0a20 2020 2020  _mode type.     
-0001e5f0: 2020 2020 2020 2072 6574 7572 6e0a 2020         return.  
-0001e600: 2020 2020 2020 6966 2073 656c 662e 5f66        if self._f
-0001e610: 745f 6861 732e 6765 7428 2766 6c6f 6f72  t_has.get('floor
-0001e620: 5f6c 6576 6572 6167 6527 2c20 4661 6c73  _leverage', Fals
-0001e630: 6529 2069 7320 5472 7565 3a0a 2020 2020  e) is True:.    
-0001e640: 2020 2020 2020 2020 2320 526f 756e 6469          # Roundi
-0001e650: 6e67 2066 6f72 2062 696e 616e 6365 202e  ng for binance .
-0001e660: 2e2e 0a20 2020 2020 2020 2020 2020 206c  ...            l
-0001e670: 6576 6572 6167 6520 3d20 666c 6f6f 7228  everage = floor(
-0001e680: 6c65 7665 7261 6765 290a 2020 2020 2020  leverage).      
-0001e690: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001e6a0: 2020 2072 6573 203d 2073 656c 662e 5f61     res = self._a
-0001e6b0: 7069 2e73 6574 5f6c 6576 6572 6167 6528  pi.set_leverage(
-0001e6c0: 7379 6d62 6f6c 3d70 6169 722c 206c 6576  symbol=pair, lev
-0001e6d0: 6572 6167 653d 6c65 7665 7261 6765 290a  erage=leverage).
-0001e6e0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0001e6f0: 2e5f 6c6f 675f 6578 6368 616e 6765 5f72  ._log_exchange_r
-0001e700: 6573 706f 6e73 6528 2773 6574 5f6c 6576  esponse('set_lev
-0001e710: 6572 6167 6527 2c20 7265 7329 0a20 2020  erage', res).   
-0001e720: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-0001e730: 2e44 446f 5350 726f 7465 6374 696f 6e20  .DDoSProtection 
-0001e740: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0001e750: 2020 7261 6973 6520 4444 6f73 5072 6f74    raise DDosProt
-0001e760: 6563 7469 6f6e 2865 2920 6672 6f6d 2065  ection(e) from e
-0001e770: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0001e780: 2863 6378 742e 4261 6452 6571 7565 7374  (ccxt.BadRequest
-0001e790: 2c20 6363 7874 2e4f 7065 7261 7469 6f6e  , ccxt.Operation
-0001e7a0: 5265 6a65 6374 6564 2c20 6363 7874 2e49  Rejected, ccxt.I
-0001e7b0: 6e73 7566 6669 6369 656e 7446 756e 6473  nsufficientFunds
-0001e7c0: 2920 6173 2065 3a0a 2020 2020 2020 2020  ) as e:.        
-0001e7d0: 2020 2020 6966 206e 6f74 2061 6363 6570      if not accep
-0001e7e0: 745f 6661 696c 3a0a 2020 2020 2020 2020  t_fail:.        
-0001e7f0: 2020 2020 2020 2020 7261 6973 6520 5465          raise Te
-0001e800: 6d70 6f72 6172 7945 7272 6f72 280a 2020  mporaryError(.  
-0001e810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e820: 2020 6627 436f 756c 6420 6e6f 7420 7365    f'Could not se
-0001e830: 7420 6c65 7665 7261 6765 2064 7565 2074  t leverage due t
-0001e840: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
-0001e850: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
-0001e860: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
-0001e870: 2020 2020 2020 2020 6578 6365 7074 2028          except (
-0001e880: 6363 7874 2e4e 6574 776f 726b 4572 726f  ccxt.NetworkErro
-0001e890: 722c 2063 6378 742e 4578 6368 616e 6765  r, ccxt.Exchange
-0001e8a0: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
-0001e8b0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
-0001e8c0: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
-0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001e8e0: 2743 6f75 6c64 206e 6f74 2073 6574 206c  'Could not set l
-0001e8f0: 6576 6572 6167 6520 6475 6520 746f 207b  everage due to {
-0001e900: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
-0001e910: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
-0001e920: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
-0001e930: 2020 2020 2065 7863 6570 7420 6363 7874       except ccxt
-0001e940: 2e42 6173 6545 7272 6f72 2061 7320 653a  .BaseError as e:
-0001e950: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-0001e960: 7365 204f 7065 7261 7469 6f6e 616c 4578  se OperationalEx
-0001e970: 6365 7074 696f 6e28 6529 2066 726f 6d20  ception(e) from 
-0001e980: 650a 0a20 2020 2064 6566 2067 6574 5f69  e..    def get_i
-0001e990: 6e74 6572 6573 745f 7261 7465 2873 656c  nterest_rate(sel
-0001e9a0: 6629 202d 3e20 666c 6f61 743a 0a20 2020  f) -> float:.   
-0001e9b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001e9c0: 2052 6574 7269 6576 6520 696e 7465 7265   Retrieve intere
-0001e9d0: 7374 2072 6174 6520 2d20 6e65 6365 7373  st rate - necess
-0001e9e0: 6172 7920 666f 7220 4d61 7267 696e 2074  ary for Margin t
-0001e9f0: 7261 6469 6e67 2e0a 2020 2020 2020 2020  rading..        
-0001ea00: 5368 6f75 6c64 206e 6f74 2063 616c 6c20  Should not call 
-0001ea10: 7468 6520 6578 6368 616e 6765 2064 6972  the exchange dir
-0001ea20: 6563 746c 7920 7768 656e 2075 7365 6420  ectly when used 
-0001ea30: 6672 6f6d 2062 6163 6b74 6573 7469 6e67  from backtesting
-0001ea40: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0001ea50: 2020 2020 2020 7265 7475 726e 2030 2e30        return 0.0
-0001ea60: 0a0a 2020 2020 6465 6620 6675 6e64 696e  ..    def fundin
-0001ea70: 675f 6665 655f 6375 746f 6666 2873 656c  g_fee_cutoff(sel
-0001ea80: 662c 206f 7065 6e5f 6461 7465 3a20 6461  f, open_date: da
-0001ea90: 7465 7469 6d65 2920 2d3e 2062 6f6f 6c3a  tetime) -> bool:
-0001eaa0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001eab0: 2020 2020 2046 756e 6469 6e67 2066 6565       Funding fee
-0001eac0: 7320 6172 6520 6f6e 6c79 2063 6861 7267  s are only charg
-0001ead0: 6564 2061 7420 6675 6c6c 2068 6f75 7273  ed at full hours
-0001eae0: 2028 7573 7561 6c6c 7920 6576 6572 7920   (usually every 
-0001eaf0: 342d 3868 292e 0a20 2020 2020 2020 2054  4-8h)..        T
-0001eb00: 6865 7265 666f 7265 2061 2074 7261 6465  herefore a trade
-0001eb10: 206f 7065 6e69 6e67 2061 7420 3130 3a30   opening at 10:0
-0001eb20: 303a 3031 2077 696c 6c20 6e6f 7420 6265  0:01 will not be
-0001eb30: 2063 6861 7267 6564 2061 2066 756e 6469   charged a fundi
-0001eb40: 6e67 2066 6565 2075 6e74 696c 2074 6865  ng fee until the
-0001eb50: 206e 6578 7420 686f 7572 2e0a 2020 2020   next hour..    
-0001eb60: 2020 2020 3a70 6172 616d 206f 7065 6e5f      :param open_
-0001eb70: 6461 7465 3a20 5468 6520 6f70 656e 2064  date: The open d
-0001eb80: 6174 6520 666f 7220 6120 7472 6164 650a  ate for a trade.
-0001eb90: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-0001eba0: 2054 7275 6520 6966 2074 6865 2064 6174   True if the dat
-0001ebb0: 6520 6661 6c6c 7320 6f6e 2061 2066 756c  e falls on a ful
-0001ebc0: 6c20 686f 7572 2c20 4661 6c73 6520 6f74  l hour, False ot
-0001ebd0: 6865 7277 6973 650a 2020 2020 2020 2020  herwise.        
-0001ebe0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-0001ebf0: 726e 206f 7065 6e5f 6461 7465 2e6d 696e  rn open_date.min
-0001ec00: 7574 6520 3d3d 2030 2061 6e64 206f 7065  ute == 0 and ope
-0001ec10: 6e5f 6461 7465 2e73 6563 6f6e 6420 3d3d  n_date.second ==
-0001ec20: 2030 0a0a 2020 2020 4072 6574 7269 6572   0..    @retrier
-0001ec30: 0a20 2020 2064 6566 2073 6574 5f6d 6172  .    def set_mar
-0001ec40: 6769 6e5f 6d6f 6465 2873 656c 662c 2070  gin_mode(self, p
-0001ec50: 6169 723a 2073 7472 2c20 6d61 7267 696e  air: str, margin
-0001ec60: 5f6d 6f64 653a 204d 6172 6769 6e4d 6f64  _mode: MarginMod
-0001ec70: 652c 2061 6363 6570 745f 6661 696c 3a20  e, accept_fail: 
-0001ec80: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0001ec90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eca0: 2020 2020 2020 7061 7261 6d73 3a20 6469        params: di
-0001ecb0: 6374 203d 207b 7d29 3a0a 2020 2020 2020  ct = {}):.      
-0001ecc0: 2020 2222 220a 2020 2020 2020 2020 5365    """.        Se
-0001ecd0: 7427 7320 7468 6520 6d61 7267 696e 206d  t's the margin m
-0001ece0: 6f64 6520 6f6e 2074 6865 2065 7863 6861  ode on the excha
-0001ecf0: 6e67 6520 746f 2063 726f 7373 206f 7220  nge to cross or 
-0001ed00: 6973 6f6c 6174 6564 2066 6f72 2061 2073  isolated for a s
-0001ed10: 7065 6369 6669 6320 7061 6972 0a20 2020  pecific pair.   
-0001ed20: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
-0001ed30: 3a20 6261 7365 2f71 756f 7465 2063 7572  : base/quote cur
-0001ed40: 7265 6e63 7920 7061 6972 2028 652e 672e  rency pair (e.g.
-0001ed50: 2022 4144 412f 5553 4454 2229 0a20 2020   "ADA/USDT").   
-0001ed60: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0001ed70: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
-0001ed80: 5b27 6472 795f 7275 6e27 5d20 6f72 206e  ['dry_run'] or n
-0001ed90: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
-0001eda0: 5f68 6173 2822 7365 744d 6172 6769 6e4d  _has("setMarginM
-0001edb0: 6f64 6522 293a 0a20 2020 2020 2020 2020  ode"):.         
-0001edc0: 2020 2023 2053 6f6d 6520 6578 6368 616e     # Some exchan
-0001edd0: 6765 7320 6f6e 6c79 2073 7570 706f 7274  ges only support
-0001ede0: 206f 6e65 206d 6172 6769 6e5f 6d6f 6465   one margin_mode
-0001edf0: 2074 7970 650a 2020 2020 2020 2020 2020   type.          
-0001ee00: 2020 7265 7475 726e 0a0a 2020 2020 2020    return..      
-0001ee10: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0001ee20: 2020 2072 6573 203d 2073 656c 662e 5f61     res = self._a
-0001ee30: 7069 2e73 6574 5f6d 6172 6769 6e5f 6d6f  pi.set_margin_mo
-0001ee40: 6465 286d 6172 6769 6e5f 6d6f 6465 2e76  de(margin_mode.v
-0001ee50: 616c 7565 2c20 7061 6972 2c20 7061 7261  alue, pair, para
-0001ee60: 6d73 290a 2020 2020 2020 2020 2020 2020  ms).            
-0001ee70: 7365 6c66 2e5f 6c6f 675f 6578 6368 616e  self._log_exchan
-0001ee80: 6765 5f72 6573 706f 6e73 6528 2773 6574  ge_response('set
-0001ee90: 5f6d 6172 6769 6e5f 6d6f 6465 272c 2072  _margin_mode', r
-0001eea0: 6573 290a 2020 2020 2020 2020 6578 6365  es).        exce
-0001eeb0: 7074 2063 6378 742e 4444 6f53 5072 6f74  pt ccxt.DDoSProt
-0001eec0: 6563 7469 6f6e 2061 7320 653a 0a20 2020  ection as e:.   
-0001eed0: 2020 2020 2020 2020 2072 6169 7365 2044           raise D
-0001eee0: 446f 7350 726f 7465 6374 696f 6e28 6529  DosProtection(e)
-0001eef0: 2066 726f 6d20 650a 2020 2020 2020 2020   from e.        
-0001ef00: 6578 6365 7074 2028 6363 7874 2e42 6164  except (ccxt.Bad
-0001ef10: 5265 7175 6573 742c 2063 6378 742e 4f70  Request, ccxt.Op
-0001ef20: 6572 6174 696f 6e52 656a 6563 7465 6429  erationRejected)
-0001ef30: 2061 7320 653a 0a20 2020 2020 2020 2020   as e:.         
-0001ef40: 2020 2069 6620 6e6f 7420 6163 6365 7074     if not accept
-0001ef50: 5f66 6169 6c3a 0a20 2020 2020 2020 2020  _fail:.         
-0001ef60: 2020 2020 2020 2072 6169 7365 2054 656d         raise Tem
-0001ef70: 706f 7261 7279 4572 726f 7228 0a20 2020  poraryError(.   
-0001ef80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef90: 2066 2743 6f75 6c64 206e 6f74 2073 6574   f'Could not set
-0001efa0: 206d 6172 6769 6e20 6d6f 6465 2064 7565   margin mode due
-0001efb0: 2074 6f20 7b65 2e5f 5f63 6c61 7373 5f5f   to {e.__class__
-0001efc0: 2e5f 5f6e 616d 655f 5f7d 2e20 4d65 7373  .__name__}. Mess
-0001efd0: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-0001efe0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0001eff0: 2028 6363 7874 2e4e 6574 776f 726b 4572   (ccxt.NetworkEr
-0001f000: 726f 722c 2063 6378 742e 4578 6368 616e  ror, ccxt.Exchan
-0001f010: 6765 4572 726f 7229 2061 7320 653a 0a20  geError) as e:. 
-0001f020: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0001f030: 2054 656d 706f 7261 7279 4572 726f 7228   TemporaryError(
-0001f040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001f050: 2066 2743 6f75 6c64 206e 6f74 2073 6574   f'Could not set
-0001f060: 206d 6172 6769 6e20 6d6f 6465 2064 7565   margin mode due
-0001f070: 2074 6f20 7b65 2e5f 5f63 6c61 7373 5f5f   to {e.__class__
-0001f080: 2e5f 5f6e 616d 655f 5f7d 2e20 4d65 7373  .__name__}. Mess
-0001f090: 6167 653a 207b 657d 2729 2066 726f 6d20  age: {e}') from 
-0001f0a0: 650a 2020 2020 2020 2020 6578 6365 7074  e.        except
-0001f0b0: 2063 6378 742e 4261 7365 4572 726f 7220   ccxt.BaseError 
-0001f0c0: 6173 2065 3a0a 2020 2020 2020 2020 2020  as e:.          
-0001f0d0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
-0001f0e0: 6e61 6c45 7863 6570 7469 6f6e 2865 2920  nalException(e) 
-0001f0f0: 6672 6f6d 2065 0a0a 2020 2020 6465 6620  from e..    def 
-0001f100: 5f66 6574 6368 5f61 6e64 5f63 616c 6375  _fetch_and_calcu
-0001f110: 6c61 7465 5f66 756e 6469 6e67 5f66 6565  late_funding_fee
-0001f120: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
-0001f130: 0a20 2020 2020 2020 2070 6169 723a 2073  .        pair: s
-0001f140: 7472 2c0a 2020 2020 2020 2020 616d 6f75  tr,.        amou
-0001f150: 6e74 3a20 666c 6f61 742c 0a20 2020 2020  nt: float,.     
-0001f160: 2020 2069 735f 7368 6f72 743a 2062 6f6f     is_short: boo
-0001f170: 6c2c 0a20 2020 2020 2020 206f 7065 6e5f  l,.        open_
-0001f180: 6461 7465 3a20 6461 7465 7469 6d65 2c0a  date: datetime,.
-0001f190: 2020 2020 2020 2020 636c 6f73 655f 6461          close_da
-0001f1a0: 7465 3a20 4f70 7469 6f6e 616c 5b64 6174  te: Optional[dat
-0001f1b0: 6574 696d 655d 203d 204e 6f6e 650a 2020  etime] = None.  
-0001f1c0: 2020 2920 2d3e 2066 6c6f 6174 3a0a 2020    ) -> float:.  
-0001f1d0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001f1e0: 2020 4665 7463 6865 7320 616e 6420 6361    Fetches and ca
-0001f1f0: 6c63 756c 6174 6573 2074 6865 2073 756d  lculates the sum
-0001f200: 206f 6620 616c 6c20 6675 6e64 696e 6720   of all funding 
-0001f210: 6665 6573 2074 6861 7420 6f63 6375 7272  fees that occurr
-0001f220: 6564 2066 6f72 2061 2070 6169 720a 2020  ed for a pair.  
-0001f230: 2020 2020 2020 6475 7269 6e67 2061 2066        during a f
-0001f240: 7574 7572 6573 2074 7261 6465 2e0a 2020  utures trade..  
-0001f250: 2020 2020 2020 4f6e 6c79 2075 7365 6420        Only used 
-0001f260: 6475 7269 6e67 2064 7279 2d72 756e 206f  during dry-run o
-0001f270: 7220 6966 2074 6865 2065 7863 6861 6e67  r if the exchang
-0001f280: 6520 646f 6573 206e 6f74 2070 726f 7669  e does not provi
-0001f290: 6465 2061 2066 756e 6469 6e67 5f72 6174  de a funding_rat
-0001f2a0: 6573 2065 6e64 706f 696e 742e 0a20 2020  es endpoint..   
-0001f2b0: 2020 2020 203a 7061 7261 6d20 7061 6972       :param pair
-0001f2c0: 3a20 5468 6520 7175 6f74 652f 6261 7365  : The quote/base
-0001f2d0: 2070 6169 7220 6f66 2074 6865 2074 7261   pair of the tra
-0001f2e0: 6465 0a20 2020 2020 2020 203a 7061 7261  de.        :para
-0001f2f0: 6d20 616d 6f75 6e74 3a20 5468 6520 7175  m amount: The qu
-0001f300: 616e 7469 7479 206f 6620 7468 6520 7472  antity of the tr
-0001f310: 6164 650a 2020 2020 2020 2020 3a70 6172  ade.        :par
-0001f320: 616d 2069 735f 7368 6f72 743a 2074 7261  am is_short: tra
-0001f330: 6465 2064 6972 6563 7469 6f6e 0a20 2020  de direction.   
-0001f340: 2020 2020 203a 7061 7261 6d20 6f70 656e       :param open
-0001f350: 5f64 6174 653a 2054 6865 2064 6174 6520  _date: The date 
-0001f360: 616e 6420 7469 6d65 2074 6861 7420 7468  and time that th
-0001f370: 6520 7472 6164 6520 7374 6172 7465 640a  e trade started.
-0001f380: 2020 2020 2020 2020 3a70 6172 616d 2063          :param c
-0001f390: 6c6f 7365 5f64 6174 653a 2054 6865 2064  lose_date: The d
-0001f3a0: 6174 6520 616e 6420 7469 6d65 2074 6861  ate and time tha
-0001f3b0: 7420 7468 6520 7472 6164 6520 656e 6465  t the trade ende
-0001f3c0: 640a 2020 2020 2020 2020 2222 220a 0a20  d.        """.. 
-0001f3d0: 2020 2020 2020 2069 6620 7365 6c66 2e66         if self.f
-0001f3e0: 756e 6469 6e67 5f66 6565 5f63 7574 6f66  unding_fee_cutof
-0001f3f0: 6628 6f70 656e 5f64 6174 6529 3a0a 2020  f(open_date):.  
-0001f400: 2020 2020 2020 2020 2020 2320 5368 6966            # Shif
-0001f410: 7420 6261 636b 2074 6f20 3168 2063 616e  t back to 1h can
-0001f420: 646c 6520 746f 2061 766f 6964 206d 6973  dle to avoid mis
-0001f430: 7369 6e67 2066 756e 6469 6e67 2066 6565  sing funding fee
-0001f440: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
-0001f450: 4f6e 6c79 2072 6561 6c6c 7920 7265 6c65  Only really rele
-0001f460: 7661 6e74 2066 6f72 2074 7261 6465 7320  vant for trades 
-0001f470: 7665 7279 2063 6c6f 7365 2074 6f20 7468  very close to th
-0001f480: 6520 6675 6c6c 2068 6f75 720a 2020 2020  e full hour.    
-0001f490: 2020 2020 2020 2020 6f70 656e 5f64 6174          open_dat
-0001f4a0: 6520 3d20 7469 6d65 6672 616d 655f 746f  e = timeframe_to
-0001f4b0: 5f70 7265 765f 6461 7465 2827 3168 272c  _prev_date('1h',
-0001f4c0: 206f 7065 6e5f 6461 7465 290a 2020 2020   open_date).    
-0001f4d0: 2020 2020 7469 6d65 6672 616d 6520 3d20      timeframe = 
-0001f4e0: 7365 6c66 2e5f 6674 5f68 6173 5b27 6d61  self._ft_has['ma
-0001f4f0: 726b 5f6f 686c 6376 5f74 696d 6566 7261  rk_ohlcv_timefra
-0001f500: 6d65 275d 0a20 2020 2020 2020 2074 696d  me'].        tim
-0001f510: 6566 7261 6d65 5f66 6620 3d20 7365 6c66  eframe_ff = self
-0001f520: 2e5f 6674 5f68 6173 5b27 6675 6e64 696e  ._ft_has['fundin
-0001f530: 675f 6665 655f 7469 6d65 6672 616d 6527  g_fee_timeframe'
-0001f540: 5d0a 2020 2020 2020 2020 6d61 726b 5f70  ].        mark_p
-0001f550: 7269 6365 5f74 7970 6520 3d20 4361 6e64  rice_type = Cand
-0001f560: 6c65 5479 7065 2e66 726f 6d5f 7374 7269  leType.from_stri
-0001f570: 6e67 2873 656c 662e 5f66 745f 6861 735b  ng(self._ft_has[
-0001f580: 226d 6172 6b5f 6f68 6c63 765f 7072 6963  "mark_ohlcv_pric
-0001f590: 6522 5d29 0a0a 2020 2020 2020 2020 6966  e"])..        if
-0001f5a0: 206e 6f74 2063 6c6f 7365 5f64 6174 653a   not close_date:
-0001f5b0: 0a20 2020 2020 2020 2020 2020 2063 6c6f  .            clo
-0001f5c0: 7365 5f64 6174 6520 3d20 6461 7465 7469  se_date = dateti
-0001f5d0: 6d65 2e6e 6f77 2874 696d 657a 6f6e 652e  me.now(timezone.
-0001f5e0: 7574 6329 0a20 2020 2020 2020 2073 696e  utc).        sin
-0001f5f0: 6365 5f6d 7320 3d20 6474 5f74 7328 7469  ce_ms = dt_ts(ti
-0001f600: 6d65 6672 616d 655f 746f 5f70 7265 765f  meframe_to_prev_
-0001f610: 6461 7465 2874 696d 6566 7261 6d65 2c20  date(timeframe, 
-0001f620: 6f70 656e 5f64 6174 6529 290a 0a20 2020  open_date))..   
-0001f630: 2020 2020 206d 6172 6b5f 636f 6d62 3a20       mark_comb: 
-0001f640: 5061 6972 5769 7468 5469 6d65 6672 616d  PairWithTimefram
-0001f650: 6520 3d20 2870 6169 722c 2074 696d 6566  e = (pair, timef
-0001f660: 7261 6d65 2c20 6d61 726b 5f70 7269 6365  rame, mark_price
-0001f670: 5f74 7970 6529 0a20 2020 2020 2020 2066  _type).        f
-0001f680: 756e 6469 6e67 5f63 6f6d 623a 2050 6169  unding_comb: Pai
-0001f690: 7257 6974 6854 696d 6566 7261 6d65 203d  rWithTimeframe =
-0001f6a0: 2028 7061 6972 2c20 7469 6d65 6672 616d   (pair, timefram
-0001f6b0: 655f 6666 2c20 4361 6e64 6c65 5479 7065  e_ff, CandleType
-0001f6c0: 2e46 554e 4449 4e47 5f52 4154 4529 0a0a  .FUNDING_RATE)..
-0001f6d0: 2020 2020 2020 2020 6361 6e64 6c65 5f68          candle_h
-0001f6e0: 6973 746f 7269 6573 203d 2073 656c 662e  istories = self.
-0001f6f0: 7265 6672 6573 685f 6c61 7465 7374 5f6f  refresh_latest_o
-0001f700: 686c 6376 280a 2020 2020 2020 2020 2020  hlcv(.          
-0001f710: 2020 5b6d 6172 6b5f 636f 6d62 2c20 6675    [mark_comb, fu
-0001f720: 6e64 696e 675f 636f 6d62 5d2c 0a20 2020  nding_comb],.   
-0001f730: 2020 2020 2020 2020 2073 696e 6365 5f6d           since_m
-0001f740: 733d 7369 6e63 655f 6d73 2c0a 2020 2020  s=since_ms,.    
-0001f750: 2020 2020 2020 2020 6361 6368 653d 4661          cache=Fa
-0001f760: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-0001f770: 2064 726f 705f 696e 636f 6d70 6c65 7465   drop_incomplete
-0001f780: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-0001f790: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
-0001f7a0: 2020 2020 2020 2020 2020 2023 2077 6520             # we 
-0001f7b0: 6361 6e27 7420 6173 7375 6d65 2077 6520  can't assume we 
-0001f7c0: 616c 7761 7973 2067 6574 2068 6973 746f  always get histo
-0001f7d0: 7269 6573 202d 2066 6f72 2065 7861 6d70  ries - for examp
-0001f7e0: 6c65 2064 7572 696e 6720 6578 6368 616e  le during exchan
-0001f7f0: 6765 2064 6f77 6e74 696d 6573 0a20 2020  ge downtimes.   
-0001f800: 2020 2020 2020 2020 2066 756e 6469 6e67           funding
-0001f810: 5f72 6174 6573 203d 2063 616e 646c 655f  _rates = candle_
-0001f820: 6869 7374 6f72 6965 735b 6675 6e64 696e  histories[fundin
-0001f830: 675f 636f 6d62 5d0a 2020 2020 2020 2020  g_comb].        
-0001f840: 2020 2020 6d61 726b 5f72 6174 6573 203d      mark_rates =
-0001f850: 2063 616e 646c 655f 6869 7374 6f72 6965   candle_historie
-0001f860: 735b 6d61 726b 5f63 6f6d 625d 0a20 2020  s[mark_comb].   
-0001f870: 2020 2020 2065 7863 6570 7420 4b65 7945       except KeyE
-0001f880: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-0001f890: 2020 7261 6973 6520 4578 6368 616e 6765    raise Exchange
-0001f8a0: 4572 726f 7228 2243 6f75 6c64 206e 6f74  Error("Could not
-0001f8b0: 2066 696e 6420 6675 6e64 696e 6720 7261   find funding ra
-0001f8c0: 7465 732e 2229 2066 726f 6d20 4e6f 6e65  tes.") from None
-0001f8d0: 0a0a 2020 2020 2020 2020 6675 6e64 696e  ..        fundin
-0001f8e0: 675f 6d61 726b 5f72 6174 6573 203d 2073  g_mark_rates = s
-0001f8f0: 656c 662e 636f 6d62 696e 655f 6675 6e64  elf.combine_fund
-0001f900: 696e 675f 616e 645f 6d61 726b 2866 756e  ing_and_mark(fun
-0001f910: 6469 6e67 5f72 6174 6573 2c20 6d61 726b  ding_rates, mark
-0001f920: 5f72 6174 6573 290a 0a20 2020 2020 2020  _rates)..       
-0001f930: 2072 6574 7572 6e20 7365 6c66 2e63 616c   return self.cal
-0001f940: 6375 6c61 7465 5f66 756e 6469 6e67 5f66  culate_funding_f
-0001f950: 6565 7328 0a20 2020 2020 2020 2020 2020  ees(.           
-0001f960: 2066 756e 6469 6e67 5f6d 6172 6b5f 7261   funding_mark_ra
-0001f970: 7465 732c 0a20 2020 2020 2020 2020 2020  tes,.           
-0001f980: 2061 6d6f 756e 743d 616d 6f75 6e74 2c0a   amount=amount,.
-0001f990: 2020 2020 2020 2020 2020 2020 6973 5f73              is_s
-0001f9a0: 686f 7274 3d69 735f 7368 6f72 742c 0a20  hort=is_short,. 
-0001f9b0: 2020 2020 2020 2020 2020 206f 7065 6e5f             open_
-0001f9c0: 6461 7465 3d6f 7065 6e5f 6461 7465 2c0a  date=open_date,.
-0001f9d0: 2020 2020 2020 2020 2020 2020 636c 6f73              clos
-0001f9e0: 655f 6461 7465 3d63 6c6f 7365 5f64 6174  e_date=close_dat
-0001f9f0: 650a 2020 2020 2020 2020 290a 0a20 2020  e.        )..   
-0001fa00: 2040 7374 6174 6963 6d65 7468 6f64 0a20   @staticmethod. 
-0001fa10: 2020 2064 6566 2063 6f6d 6269 6e65 5f66     def combine_f
-0001fa20: 756e 6469 6e67 5f61 6e64 5f6d 6172 6b28  unding_and_mark(
-0001fa30: 6675 6e64 696e 675f 7261 7465 733a 2044  funding_rates: D
-0001fa40: 6174 6146 7261 6d65 2c20 6d61 726b 5f72  ataFrame, mark_r
-0001fa50: 6174 6573 3a20 4461 7461 4672 616d 652c  ates: DataFrame,
-0001fa60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa80: 2020 6675 7475 7265 735f 6675 6e64 696e    futures_fundin
-0001fa90: 675f 7261 7465 3a20 4f70 7469 6f6e 616c  g_rate: Optional
-0001faa0: 5b69 6e74 5d20 3d20 4e6f 6e65 2920 2d3e  [int] = None) ->
-0001fab0: 2044 6174 6146 7261 6d65 3a0a 2020 2020   DataFrame:.    
-0001fac0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001fad0: 436f 6d62 696e 6520 6675 6e64 696e 672d  Combine funding-
-0001fae0: 7261 7465 7320 616e 6420 6d61 726b 2d72  rates and mark-r
-0001faf0: 6174 6573 2064 6174 6166 7261 6d65 730a  ates dataframes.
-0001fb00: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-0001fb10: 756e 6469 6e67 5f72 6174 6573 3a20 4461  unding_rates: Da
-0001fb20: 7461 6672 616d 6520 636f 6e74 6169 6e69  taframe containi
-0001fb30: 6e67 2046 756e 6469 6e67 2072 6174 6573  ng Funding rates
-0001fb40: 2028 5479 7065 2046 554e 4449 4e47 5f52   (Type FUNDING_R
-0001fb50: 4154 4529 0a20 2020 2020 2020 203a 7061  ATE).        :pa
-0001fb60: 7261 6d20 6d61 726b 5f72 6174 6573 3a20  ram mark_rates: 
-0001fb70: 4461 7461 6672 616d 6520 636f 6e74 6169  Dataframe contai
-0001fb80: 6e69 6e67 204d 6172 6b20 7261 7465 7320  ning Mark rates 
-0001fb90: 2854 7970 6520 6d61 726b 5f6f 686c 6376  (Type mark_ohlcv
-0001fba0: 5f70 7269 6365 290a 2020 2020 2020 2020  _price).        
-0001fbb0: 3a70 6172 616d 2066 7574 7572 6573 5f66  :param futures_f
-0001fbc0: 756e 6469 6e67 5f72 6174 653a 2046 616b  unding_rate: Fak
-0001fbd0: 6520 6675 6e64 696e 6720 7261 7465 2074  e funding rate t
-0001fbe0: 6f20 7573 6520 6966 2066 756e 6469 6e67  o use if funding
-0001fbf0: 5f72 6174 6573 2061 7265 206e 6f74 2061  _rates are not a
-0001fc00: 7661 696c 6162 6c65 0a20 2020 2020 2020  vailable.       
-0001fc10: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
-0001fc20: 6675 7475 7265 735f 6675 6e64 696e 675f  futures_funding_
-0001fc30: 7261 7465 2069 7320 4e6f 6e65 3a0a 2020  rate is None:.  
-0001fc40: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001fc50: 206d 6172 6b5f 7261 7465 732e 6d65 7267   mark_rates.merg
-0001fc60: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0001fc70: 2020 2066 756e 6469 6e67 5f72 6174 6573     funding_rates
-0001fc80: 2c20 6f6e 3d27 6461 7465 272c 2068 6f77  , on='date', how
-0001fc90: 3d22 696e 6e65 7222 2c20 7375 6666 6978  ="inner", suffix
-0001fca0: 6573 3d5b 225f 6d61 726b 222c 2022 5f66  es=["_mark", "_f
-0001fcb0: 756e 6422 5d29 0a20 2020 2020 2020 2065  und"]).        e
-0001fcc0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001fcd0: 2069 6620 6c65 6e28 6675 6e64 696e 675f   if len(funding_
-0001fce0: 7261 7465 7329 203d 3d20 303a 0a20 2020  rates) == 0:.   
-0001fcf0: 2020 2020 2020 2020 2020 2020 2023 204e               # N
-0001fd00: 6f20 6675 6e64 696e 6720 7261 7465 2063  o funding rate c
-0001fd10: 616e 646c 6573 202d 2066 756c 6c20 6669  andles - full fi
-0001fd20: 6c6c 7570 2077 6974 6820 6661 6c6c 6261  llup with fallba
-0001fd30: 636b 2076 6172 6961 626c 650a 2020 2020  ck variable.    
-0001fd40: 2020 2020 2020 2020 2020 2020 6d61 726b              mark
-0001fd50: 5f72 6174 6573 5b27 6f70 656e 5f66 756e  _rates['open_fun
-0001fd60: 6427 5d20 3d20 6675 7475 7265 735f 6675  d'] = futures_fu
-0001fd70: 6e64 696e 675f 7261 7465 0a20 2020 2020  nding_rate.     
-0001fd80: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001fd90: 6e20 6d61 726b 5f72 6174 6573 2e72 656e  n mark_rates.ren
-0001fda0: 616d 6528 0a20 2020 2020 2020 2020 2020  ame(.           
-0001fdb0: 2020 2020 2020 2020 2020 2020 2063 6f6c               col
-0001fdc0: 756d 6e73 3d7b 276f 7065 6e27 3a20 276f  umns={'open': 'o
-0001fdd0: 7065 6e5f 6d61 726b 272c 0a20 2020 2020  pen_mark',.     
-0001fde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fdf0: 2020 2020 2020 2020 2020 2020 2763 6c6f              'clo
-0001fe00: 7365 273a 2027 636c 6f73 655f 6d61 726b  se': 'close_mark
-0001fe10: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-0001fe20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe30: 2020 2020 2768 6967 6827 3a20 2768 6967      'high': 'hig
-0001fe40: 685f 6d61 726b 272c 0a20 2020 2020 2020  h_mark',.       
-0001fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe60: 2020 2020 2020 2020 2020 276c 6f77 273a            'low':
-0001fe70: 2027 6c6f 775f 6d61 726b 272c 0a20 2020   'low_mark',.   
-0001fe80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe90: 2020 2020 2020 2020 2020 2020 2020 2776                'v
-0001fea0: 6f6c 756d 6527 3a20 2776 6f6c 756d 655f  olume': 'volume_
-0001feb0: 6d61 726b 277d 290a 0a20 2020 2020 2020  mark'})..       
-0001fec0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0001fed0: 2020 2020 2020 2020 2020 2023 2046 696c             # Fil
-0001fee0: 6c20 7570 206d 6973 7369 6e67 2066 756e  l up missing fun
-0001fef0: 6469 6e67 5f72 6174 6520 6361 6e64 6c65  ding_rate candle
-0001ff00: 7320 7769 7468 2066 616c 6c62 6163 6b20  s with fallback 
-0001ff10: 7661 6c75 650a 2020 2020 2020 2020 2020  value.          
-0001ff20: 2020 2020 2020 636f 6d62 696e 6564 203d        combined =
-0001ff30: 206d 6172 6b5f 7261 7465 732e 6d65 7267   mark_rates.merg
-0001ff40: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0001ff50: 2020 2020 2020 2066 756e 6469 6e67 5f72         funding_r
-0001ff60: 6174 6573 2c20 6f6e 3d27 6461 7465 272c  ates, on='date',
-0001ff70: 2068 6f77 3d22 6c65 6674 222c 2073 7566   how="left", suf
-0001ff80: 6669 7865 733d 5b22 5f6d 6172 6b22 2c20  fixes=["_mark", 
-0001ff90: 225f 6675 6e64 225d 0a20 2020 2020 2020  "_fund"].       
-0001ffa0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0001ffb0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001ffc0: 6f6d 6269 6e65 645b 276f 7065 6e5f 6675  ombined['open_fu
-0001ffd0: 6e64 275d 203d 2063 6f6d 6269 6e65 645b  nd'] = combined[
-0001ffe0: 276f 7065 6e5f 6675 6e64 275d 2e66 696c  'open_fund'].fil
-0001fff0: 6c6e 6128 6675 7475 7265 735f 6675 6e64  lna(futures_fund
-00020000: 696e 675f 7261 7465 290a 2020 2020 2020  ing_rate).      
-00020010: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00020020: 2063 6f6d 6269 6e65 640a 0a20 2020 2064   combined..    d
-00020030: 6566 2063 616c 6375 6c61 7465 5f66 756e  ef calculate_fun
-00020040: 6469 6e67 5f66 6565 7328 0a20 2020 2020  ding_fees(.     
-00020050: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00020060: 2064 663a 2044 6174 6146 7261 6d65 2c0a   df: DataFrame,.
-00020070: 2020 2020 2020 2020 616d 6f75 6e74 3a20          amount: 
-00020080: 666c 6f61 742c 0a20 2020 2020 2020 2069  float,.        i
-00020090: 735f 7368 6f72 743a 2062 6f6f 6c2c 0a20  s_short: bool,. 
-000200a0: 2020 2020 2020 206f 7065 6e5f 6461 7465         open_date
-000200b0: 3a20 6461 7465 7469 6d65 2c0a 2020 2020  : datetime,.    
-000200c0: 2020 2020 636c 6f73 655f 6461 7465 3a20      close_date: 
-000200d0: 6461 7465 7469 6d65 2c0a 2020 2020 2020  datetime,.      
-000200e0: 2020 7469 6d65 5f69 6e5f 7261 7469 6f3a    time_in_ratio:
-000200f0: 204f 7074 696f 6e61 6c5b 666c 6f61 745d   Optional[float]
-00020100: 203d 204e 6f6e 650a 2020 2020 2920 2d3e   = None.    ) ->
-00020110: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
-00020120: 2222 220a 2020 2020 2020 2020 6361 6c63  """.        calc
-00020130: 756c 6174 6573 2074 6865 2073 756d 206f  ulates the sum o
-00020140: 6620 616c 6c20 6675 6e64 696e 6720 6665  f all funding fe
-00020150: 6573 2074 6861 7420 6f63 6375 7272 6564  es that occurred
-00020160: 2066 6f72 2061 2070 6169 7220 6475 7269   for a pair duri
-00020170: 6e67 2061 2066 7574 7572 6573 2074 7261  ng a futures tra
-00020180: 6465 0a20 2020 2020 2020 203a 7061 7261  de.        :para
-00020190: 6d20 6466 3a20 4461 7461 6672 616d 6520  m df: Dataframe 
-000201a0: 636f 6e74 6169 6e69 6e67 2063 6f6d 6269  containing combi
-000201b0: 6e65 6420 6675 6e64 696e 6720 616e 6420  ned funding and 
-000201c0: 6d61 726b 2072 6174 6573 0a20 2020 2020  mark rates.     
-000201d0: 2020 2020 2020 2020 2020 2020 2020 6173                as
-000201e0: 2060 6f70 656e 5f66 756e 6460 2061 6e64   `open_fund` and
-000201f0: 2060 6f70 656e 5f6d 6172 6b60 2e0a 2020   `open_mark`..  
-00020200: 2020 2020 2020 3a70 6172 616d 2061 6d6f        :param amo
-00020210: 756e 743a 2054 6865 2071 7561 6e74 6974  unt: The quantit
-00020220: 7920 6f66 2074 6865 2074 7261 6465 0a20  y of the trade. 
-00020230: 2020 2020 2020 203a 7061 7261 6d20 6973         :param is
-00020240: 5f73 686f 7274 3a20 7472 6164 6520 6469  _short: trade di
-00020250: 7265 6374 696f 6e0a 2020 2020 2020 2020  rection.        
-00020260: 3a70 6172 616d 206f 7065 6e5f 6461 7465  :param open_date
-00020270: 3a20 5468 6520 6461 7465 2061 6e64 2074  : The date and t
-00020280: 696d 6520 7468 6174 2074 6865 2074 7261  ime that the tra
-00020290: 6465 2073 7461 7274 6564 0a20 2020 2020  de started.     
-000202a0: 2020 203a 7061 7261 6d20 636c 6f73 655f     :param close_
-000202b0: 6461 7465 3a20 5468 6520 6461 7465 2061  date: The date a
-000202c0: 6e64 2074 696d 6520 7468 6174 2074 6865  nd time that the
-000202d0: 2074 7261 6465 2065 6e64 6564 0a20 2020   trade ended.   
-000202e0: 2020 2020 203a 7061 7261 6d20 7469 6d65       :param time
-000202f0: 5f69 6e5f 7261 7469 6f3a 204e 6f74 2075  _in_ratio: Not u
-00020300: 7365 6420 6279 206d 6f73 7420 6578 6368  sed by most exch
-00020310: 616e 6765 2063 6c61 7373 6573 0a20 2020  ange classes.   
-00020320: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00020330: 2066 6565 733a 2066 6c6f 6174 203d 2030   fees: float = 0
-00020340: 0a0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-00020350: 2064 662e 656d 7074 793a 0a20 2020 2020   df.empty:.     
-00020360: 2020 2020 2020 2064 6631 203d 2064 665b         df1 = df[
-00020370: 2864 665b 2764 6174 6527 5d20 3e3d 206f  (df['date'] >= o
-00020380: 7065 6e5f 6461 7465 2920 2620 2864 665b  pen_date) & (df[
-00020390: 2764 6174 6527 5d20 3c3d 2063 6c6f 7365  'date'] <= close
-000203a0: 5f64 6174 6529 5d0a 2020 2020 2020 2020  _date)].        
-000203b0: 2020 2020 6665 6573 203d 2073 756d 2864      fees = sum(d
-000203c0: 6631 5b27 6f70 656e 5f66 756e 6427 5d20  f1['open_fund'] 
-000203d0: 2a20 6466 315b 276f 7065 6e5f 6d61 726b  * df1['open_mark
-000203e0: 275d 202a 2061 6d6f 756e 7429 0a20 2020  '] * amount).   
-000203f0: 2020 2020 2069 6620 6973 6e61 6e28 6665       if isnan(fe
-00020400: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
-00020410: 2066 6565 7320 3d20 302e 300a 2020 2020   fees = 0.0.    
-00020420: 2020 2020 2320 4e65 6761 7465 2066 6565      # Negate fee
-00020430: 7320 666f 7220 6c6f 6e67 7320 6173 2066  s for longs as f
-00020440: 756e 6469 6e67 5f66 6565 7320 6578 7065  unding_fees expe
-00020450: 6374 7320 6974 2074 6869 7320 7761 7920  cts it this way 
-00020460: 6261 7365 6420 6f6e 206c 6976 6520 656e  based on live en
-00020470: 6470 6f69 6e74 732e 0a20 2020 2020 2020  dpoints..       
-00020480: 2072 6574 7572 6e20 6665 6573 2069 6620   return fees if 
-00020490: 6973 5f73 686f 7274 2065 6c73 6520 2d66  is_short else -f
-000204a0: 6565 730a 0a20 2020 2064 6566 2067 6574  ees..    def get
-000204b0: 5f66 756e 6469 6e67 5f66 6565 7328 0a20  _funding_fees(. 
-000204c0: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-000204d0: 2070 6169 723a 2073 7472 2c20 616d 6f75   pair: str, amou
-000204e0: 6e74 3a20 666c 6f61 742c 2069 735f 7368  nt: float, is_sh
-000204f0: 6f72 743a 2062 6f6f 6c2c 206f 7065 6e5f  ort: bool, open_
-00020500: 6461 7465 3a20 6461 7465 7469 6d65 2920  date: datetime) 
-00020510: 2d3e 2066 6c6f 6174 3a0a 2020 2020 2020  -> float:.      
-00020520: 2020 2222 220a 2020 2020 2020 2020 4665    """.        Fe
-00020530: 7463 6820 6675 6e64 696e 6720 6665 6573  tch funding fees
-00020540: 2c20 6569 7468 6572 2066 726f 6d20 7468  , either from th
-00020550: 6520 6578 6368 616e 6765 2028 6c69 7665  e exchange (live
-00020560: 2920 6f72 2063 616c 6375 6c61 7465 7320  ) or calculates 
-00020570: 7468 656d 0a20 2020 2020 2020 2062 6173  them.        bas
-00020580: 6564 206f 6e20 6675 6e64 696e 6720 7261  ed on funding ra
-00020590: 7465 2f6d 6172 6b20 7072 6963 6520 6869  te/mark price hi
-000205a0: 7374 6f72 790a 2020 2020 2020 2020 3a70  story.        :p
-000205b0: 6172 616d 2070 6169 723a 2054 6865 2071  aram pair: The q
-000205c0: 756f 7465 2f62 6173 6520 7061 6972 206f  uote/base pair o
-000205d0: 6620 7468 6520 7472 6164 650a 2020 2020  f the trade.    
-000205e0: 2020 2020 3a70 6172 616d 2069 735f 7368      :param is_sh
-000205f0: 6f72 743a 2074 7261 6465 2064 6972 6563  ort: trade direc
-00020600: 7469 6f6e 0a20 2020 2020 2020 203a 7061  tion.        :pa
-00020610: 7261 6d20 616d 6f75 6e74 3a20 5472 6164  ram amount: Trad
-00020620: 6520 616d 6f75 6e74 0a20 2020 2020 2020  e amount.       
-00020630: 203a 7061 7261 6d20 6f70 656e 5f64 6174   :param open_dat
-00020640: 653a 204f 7065 6e20 6461 7465 206f 6620  e: Open date of 
-00020650: 7468 6520 7472 6164 650a 2020 2020 2020  the trade.      
-00020660: 2020 3a72 6574 7572 6e3a 2066 756e 6469    :return: fundi
-00020670: 6e67 2066 6565 2073 696e 6365 206f 7065  ng fee since ope
-00020680: 6e5f 6461 7465 0a20 2020 2020 2020 2022  n_date.        "
-00020690: 2222 0a20 2020 2020 2020 2069 6620 7365  "".        if se
-000206a0: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
-000206b0: 3d3d 2054 7261 6469 6e67 4d6f 6465 2e46  == TradingMode.F
-000206c0: 5554 5552 4553 3a0a 2020 2020 2020 2020  UTURES:.        
-000206d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-000206e0: 2020 2020 2020 2020 2069 6620 7365 6c66           if self
-000206f0: 2e5f 636f 6e66 6967 5b27 6472 795f 7275  ._config['dry_ru
-00020700: 6e27 5d3a 0a20 2020 2020 2020 2020 2020  n']:.           
-00020710: 2020 2020 2020 2020 2066 756e 6469 6e67           funding
-00020720: 5f66 6565 7320 3d20 7365 6c66 2e5f 6665  _fees = self._fe
-00020730: 7463 685f 616e 645f 6361 6c63 756c 6174  tch_and_calculat
-00020740: 655f 6675 6e64 696e 675f 6665 6573 280a  e_funding_fees(.
-00020750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020760: 2020 2020 2020 2020 7061 6972 2c20 616d          pair, am
-00020770: 6f75 6e74 2c20 6973 5f73 686f 7274 2c20  ount, is_short, 
-00020780: 6f70 656e 5f64 6174 6529 0a20 2020 2020  open_date).     
-00020790: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-000207a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000207b0: 2020 2020 2066 756e 6469 6e67 5f66 6565       funding_fee
-000207c0: 7320 3d20 7365 6c66 2e5f 6765 745f 6675  s = self._get_fu
-000207d0: 6e64 696e 675f 6665 6573 5f66 726f 6d5f  nding_fees_from_
-000207e0: 6578 6368 616e 6765 2870 6169 722c 206f  exchange(pair, o
-000207f0: 7065 6e5f 6461 7465 290a 2020 2020 2020  pen_date).      
-00020800: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00020810: 2066 756e 6469 6e67 5f66 6565 730a 2020   funding_fees.  
-00020820: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00020830: 2045 7863 6861 6e67 6545 7272 6f72 3a0a   ExchangeError:.
-00020840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020850: 6c6f 6767 6572 2e77 6172 6e69 6e67 2866  logger.warning(f
-00020860: 2243 6f75 6c64 206e 6f74 2075 7064 6174  "Could not updat
-00020870: 6520 6675 6e64 696e 6720 6665 6573 2066  e funding fees f
-00020880: 6f72 207b 7061 6972 7d2e 2229 0a0a 2020  or {pair}.")..  
-00020890: 2020 2020 2020 7265 7475 726e 2030 2e30        return 0.0
-000208a0: 0a0a 2020 2020 6465 6620 6765 745f 6c69  ..    def get_li
-000208b0: 7175 6964 6174 696f 6e5f 7072 6963 6528  quidation_price(
-000208c0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-000208d0: 2020 2020 2020 2070 6169 723a 2073 7472         pair: str
-000208e0: 2c0a 2020 2020 2020 2020 2320 4472 792d  ,.        # Dry-
-000208f0: 7275 6e0a 2020 2020 2020 2020 6f70 656e  run.        open
-00020900: 5f72 6174 653a 2066 6c6f 6174 2c20 2020  _rate: float,   
-00020910: 2320 456e 7472 7920 7072 6963 6520 6f66  # Entry price of
-00020920: 2070 6f73 6974 696f 6e0a 2020 2020 2020   position.      
-00020930: 2020 6973 5f73 686f 7274 3a20 626f 6f6c    is_short: bool
-00020940: 2c0a 2020 2020 2020 2020 616d 6f75 6e74  ,.        amount
-00020950: 3a20 666c 6f61 742c 2020 2320 4162 736f  : float,  # Abso
-00020960: 6c75 7465 2076 616c 7565 206f 6620 706f  lute value of po
-00020970: 7369 7469 6f6e 2073 697a 650a 2020 2020  sition size.    
-00020980: 2020 2020 7374 616b 655f 616d 6f75 6e74      stake_amount
-00020990: 3a20 666c 6f61 742c 0a20 2020 2020 2020  : float,.       
-000209a0: 206c 6576 6572 6167 653a 2066 6c6f 6174   leverage: float
-000209b0: 2c0a 2020 2020 2020 2020 7761 6c6c 6574  ,.        wallet
-000209c0: 5f62 616c 616e 6365 3a20 666c 6f61 742c  _balance: float,
-000209d0: 0a20 2020 2020 2020 206d 6d5f 6578 5f31  .        mm_ex_1
-000209e0: 3a20 666c 6f61 7420 3d20 302e 302c 2020  : float = 0.0,  
-000209f0: 2320 2842 696e 616e 6365 2920 4372 6f73  # (Binance) Cros
-00020a00: 7320 6f6e 6c79 0a20 2020 2020 2020 2075  s only.        u
-00020a10: 706e 6c5f 6578 5f31 3a20 666c 6f61 7420  pnl_ex_1: float 
-00020a20: 3d20 302e 302c 2020 2320 2842 696e 616e  = 0.0,  # (Binan
-00020a30: 6365 2920 4372 6f73 7320 6f6e 6c79 0a20  ce) Cross only. 
-00020a40: 2020 2029 202d 3e20 4f70 7469 6f6e 616c     ) -> Optional
-00020a50: 5b66 6c6f 6174 5d3a 0a20 2020 2020 2020  [float]:.       
-00020a60: 2022 2222 0a20 2020 2020 2020 2053 6574   """.        Set
-00020a70: 2773 2074 6865 206d 6172 6769 6e20 6d6f  's the margin mo
-00020a80: 6465 206f 6e20 7468 6520 6578 6368 616e  de on the exchan
-00020a90: 6765 2074 6f20 6372 6f73 7320 6f72 2069  ge to cross or i
-00020aa0: 736f 6c61 7465 6420 666f 7220 6120 7370  solated for a sp
-00020ab0: 6563 6966 6963 2070 6169 720a 2020 2020  ecific pair.    
-00020ac0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00020ad0: 6966 2073 656c 662e 7472 6164 696e 675f  if self.trading_
-00020ae0: 6d6f 6465 203d 3d20 5472 6164 696e 674d  mode == TradingM
-00020af0: 6f64 652e 5350 4f54 3a0a 2020 2020 2020  ode.SPOT:.      
-00020b00: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-00020b10: 650a 2020 2020 2020 2020 656c 6966 2028  e.        elif (
-00020b20: 7365 6c66 2e74 7261 6469 6e67 5f6d 6f64  self.trading_mod
-00020b30: 6520 213d 2054 7261 6469 6e67 4d6f 6465  e != TradingMode
-00020b40: 2e46 5554 5552 4553 293a 0a20 2020 2020  .FUTURES):.     
-00020b50: 2020 2020 2020 2072 6169 7365 204f 7065         raise Ope
-00020b60: 7261 7469 6f6e 616c 4578 6365 7074 696f  rationalExceptio
-00020b70: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-00020b80: 2020 2066 227b 7365 6c66 2e6e 616d 657d     f"{self.name}
-00020b90: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
-00020ba0: 7420 7b73 656c 662e 6d61 7267 696e 5f6d  t {self.margin_m
-00020bb0: 6f64 657d 207b 7365 6c66 2e74 7261 6469  ode} {self.tradi
-00020bc0: 6e67 5f6d 6f64 657d 2229 0a0a 2020 2020  ng_mode}")..    
-00020bd0: 2020 2020 6c69 7175 6964 6174 696f 6e5f      liquidation_
-00020be0: 7072 6963 6520 3d20 4e6f 6e65 0a20 2020  price = None.   
-00020bf0: 2020 2020 2069 6620 7365 6c66 2e5f 636f       if self._co
-00020c00: 6e66 6967 5b27 6472 795f 7275 6e27 5d20  nfig['dry_run'] 
-00020c10: 6f72 206e 6f74 2073 656c 662e 6578 6368  or not self.exch
-00020c20: 616e 6765 5f68 6173 2822 6665 7463 6850  ange_has("fetchP
-00020c30: 6f73 6974 696f 6e73 2229 3a0a 0a20 2020  ositions"):..   
-00020c40: 2020 2020 2020 2020 206c 6971 7569 6461           liquida
-00020c50: 7469 6f6e 5f70 7269 6365 203d 2073 656c  tion_price = sel
-00020c60: 662e 6472 795f 7275 6e5f 6c69 7175 6964  f.dry_run_liquid
-00020c70: 6174 696f 6e5f 7072 6963 6528 0a20 2020  ation_price(.   
-00020c80: 2020 2020 2020 2020 2020 2020 2070 6169               pai
-00020c90: 723d 7061 6972 2c0a 2020 2020 2020 2020  r=pair,.        
-00020ca0: 2020 2020 2020 2020 6f70 656e 5f72 6174          open_rat
-00020cb0: 653d 6f70 656e 5f72 6174 652c 0a20 2020  e=open_rate,.   
-00020cc0: 2020 2020 2020 2020 2020 2020 2069 735f               is_
-00020cd0: 7368 6f72 743d 6973 5f73 686f 7274 2c0a  short=is_short,.
-00020ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020cf0: 616d 6f75 6e74 3d61 6d6f 756e 742c 0a20  amount=amount,. 
-00020d00: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00020d10: 6576 6572 6167 653d 6c65 7665 7261 6765  everage=leverage
-00020d20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00020d30: 2020 7374 616b 655f 616d 6f75 6e74 3d73    stake_amount=s
-00020d40: 7461 6b65 5f61 6d6f 756e 742c 0a20 2020  take_amount,.   
-00020d50: 2020 2020 2020 2020 2020 2020 2077 616c               wal
-00020d60: 6c65 745f 6261 6c61 6e63 653d 7761 6c6c  let_balance=wall
-00020d70: 6574 5f62 616c 616e 6365 2c0a 2020 2020  et_balance,.    
-00020d80: 2020 2020 2020 2020 2020 2020 6d6d 5f65              mm_e
-00020d90: 785f 313d 6d6d 5f65 785f 312c 0a20 2020  x_1=mm_ex_1,.   
-00020da0: 2020 2020 2020 2020 2020 2020 2075 706e               upn
-00020db0: 6c5f 6578 5f31 3d75 706e 6c5f 6578 5f31  l_ex_1=upnl_ex_1
-00020dc0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00020dd0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00020de0: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
-00020df0: 6e73 203d 2073 656c 662e 6665 7463 685f  ns = self.fetch_
-00020e00: 706f 7369 7469 6f6e 7328 7061 6972 290a  positions(pair).
-00020e10: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00020e20: 656e 2870 6f73 6974 696f 6e73 2920 3e20  en(positions) > 
-00020e30: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-00020e40: 2020 2070 6f73 203d 2070 6f73 6974 696f     pos = positio
-00020e50: 6e73 5b30 5d0a 2020 2020 2020 2020 2020  ns[0].          
-00020e60: 2020 2020 2020 6c69 7175 6964 6174 696f        liquidatio
-00020e70: 6e5f 7072 6963 6520 3d20 706f 735b 276c  n_price = pos['l
-00020e80: 6971 7569 6461 7469 6f6e 5072 6963 6527  iquidationPrice'
-00020e90: 5d0a 0a20 2020 2020 2020 2069 6620 6c69  ]..        if li
-00020ea0: 7175 6964 6174 696f 6e5f 7072 6963 6520  quidation_price 
-00020eb0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00020ec0: 2020 2020 2020 2020 2062 7566 6665 725f           buffer_
-00020ed0: 616d 6f75 6e74 203d 2061 6273 286f 7065  amount = abs(ope
-00020ee0: 6e5f 7261 7465 202d 206c 6971 7569 6461  n_rate - liquida
-00020ef0: 7469 6f6e 5f70 7269 6365 2920 2a20 7365  tion_price) * se
-00020f00: 6c66 2e6c 6971 7569 6461 7469 6f6e 5f62  lf.liquidation_b
-00020f10: 7566 6665 720a 2020 2020 2020 2020 2020  uffer.          
-00020f20: 2020 6c69 7175 6964 6174 696f 6e5f 7072    liquidation_pr
-00020f30: 6963 655f 6275 6666 6572 203d 2028 0a20  ice_buffer = (. 
-00020f40: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00020f50: 6971 7569 6461 7469 6f6e 5f70 7269 6365  iquidation_price
-00020f60: 202d 2062 7566 6665 725f 616d 6f75 6e74   - buffer_amount
-00020f70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020f80: 2069 6620 6973 5f73 686f 7274 2065 6c73   if is_short els
-00020f90: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00020fa0: 2020 6c69 7175 6964 6174 696f 6e5f 7072    liquidation_pr
-00020fb0: 6963 6520 2b20 6275 6666 6572 5f61 6d6f  ice + buffer_amo
-00020fc0: 756e 740a 2020 2020 2020 2020 2020 2020  unt.            
-00020fd0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00020fe0: 7475 726e 206d 6178 286c 6971 7569 6461  turn max(liquida
-00020ff0: 7469 6f6e 5f70 7269 6365 5f62 7566 6665  tion_price_buffe
-00021000: 722c 2030 2e30 290a 2020 2020 2020 2020  r, 0.0).        
-00021010: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00021020: 2020 7265 7475 726e 204e 6f6e 650a 0a20    return None.. 
-00021030: 2020 2064 6566 2064 7279 5f72 756e 5f6c     def dry_run_l
-00021040: 6971 7569 6461 7469 6f6e 5f70 7269 6365  iquidation_price
-00021050: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00021060: 2020 2020 2020 2020 7061 6972 3a20 7374          pair: st
-00021070: 722c 0a20 2020 2020 2020 206f 7065 6e5f  r,.        open_
-00021080: 7261 7465 3a20 666c 6f61 742c 2020 2023  rate: float,   #
-00021090: 2045 6e74 7279 2070 7269 6365 206f 6620   Entry price of 
-000210a0: 706f 7369 7469 6f6e 0a20 2020 2020 2020  position.       
-000210b0: 2069 735f 7368 6f72 743a 2062 6f6f 6c2c   is_short: bool,
-000210c0: 0a20 2020 2020 2020 2061 6d6f 756e 743a  .        amount:
-000210d0: 2066 6c6f 6174 2c0a 2020 2020 2020 2020   float,.        
-000210e0: 7374 616b 655f 616d 6f75 6e74 3a20 666c  stake_amount: fl
-000210f0: 6f61 742c 0a20 2020 2020 2020 206c 6576  oat,.        lev
-00021100: 6572 6167 653a 2066 6c6f 6174 2c0a 2020  erage: float,.  
-00021110: 2020 2020 2020 7761 6c6c 6574 5f62 616c        wallet_bal
-00021120: 616e 6365 3a20 666c 6f61 742c 2020 2320  ance: float,  # 
-00021130: 4f72 206d 6172 6769 6e20 6261 6c61 6e63  Or margin balanc
-00021140: 650a 2020 2020 2020 2020 6d6d 5f65 785f  e.        mm_ex_
-00021150: 313a 2066 6c6f 6174 203d 2030 2e30 2c20  1: float = 0.0, 
-00021160: 2023 2028 4269 6e61 6e63 6529 2043 726f   # (Binance) Cro
-00021170: 7373 206f 6e6c 790a 2020 2020 2020 2020  ss only.        
-00021180: 7570 6e6c 5f65 785f 313a 2066 6c6f 6174  upnl_ex_1: float
-00021190: 203d 2030 2e30 2c20 2023 2028 4269 6e61   = 0.0,  # (Bina
-000211a0: 6e63 6529 2043 726f 7373 206f 6e6c 790a  nce) Cross only.
-000211b0: 2020 2020 2920 2d3e 204f 7074 696f 6e61      ) -> Optiona
-000211c0: 6c5b 666c 6f61 745d 3a0a 2020 2020 2020  l[float]:.      
-000211d0: 2020 2222 220a 2020 2020 2020 2020 496d    """.        Im
-000211e0: 706f 7274 616e 743a 204d 7573 7420 6265  portant: Must be
-000211f0: 2066 6574 6368 696e 6720 6461 7461 2066   fetching data f
-00021200: 726f 6d20 6361 6368 6564 2076 616c 7565  rom cached value
-00021210: 7320 6173 2074 6869 7320 6973 2075 7365  s as this is use
-00021220: 6420 6279 2062 6163 6b74 6573 7469 6e67  d by backtesting
-00021230: 210a 2020 2020 2020 2020 5045 5250 4554  !.        PERPET
-00021240: 5541 4c3a 0a20 2020 2020 2020 2020 6761  UAL:.         ga
-00021250: 7465 3a20 6874 7470 733a 2f2f 7777 772e  te: https://www.
-00021260: 6761 7465 2e69 6f2f 6865 6c70 2f66 7574  gate.io/help/fut
-00021270: 7572 6573 2f66 7574 7572 6573 2f32 3737  ures/futures/277
-00021280: 3234 2f6c 6971 7569 6461 7469 6f6e 2d70  24/liquidation-p
-00021290: 7269 6365 2d62 616e 6b72 7570 7463 792d  rice-bankruptcy-
-000212a0: 7072 6963 650a 2020 2020 2020 2020 203e  price.         >
-000212b0: 204c 6971 7569 6461 7469 6f6e 2050 7269   Liquidation Pri
-000212c0: 6365 203d 2028 456e 7472 7920 5072 6963  ce = (Entry Pric
-000212d0: 6520 c2b1 204d 6172 6769 6e20 2f20 436f  e .. Margin / Co
-000212e0: 6e74 7261 6374 204d 756c 7469 706c 6965  ntract Multiplie
-000212f0: 7220 2f20 5369 7a65 2920 2f0a 2020 2020  r / Size) /.    
-00021300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021310: 2020 2020 2020 2020 2020 2020 5b20 3120              [ 1 
-00021320: c2b1 2028 4d61 696e 7465 6e61 6e63 6520  .. (Maintenance 
-00021330: 4d61 7267 696e 2052 6174 696f 202b 2054  Margin Ratio + T
-00021340: 616b 6572 2052 6174 6529 5d0a 2020 2020  aker Rate)].    
-00021350: 2020 2020 2020 2020 5768 6572 6569 6e2c          Wherein,
-00021360: 2022 2b22 206f 7220 222d 2220 6465 7065   "+" or "-" depe
-00021370: 6e64 7320 6f6e 2077 6865 7468 6572 2074  nds on whether t
-00021380: 6865 2063 6f6e 7472 6163 7420 676f 6573  he contract goes
-00021390: 206c 6f6e 6720 6f72 2073 686f 7274 3a0a   long or short:.
-000213a0: 2020 2020 2020 2020 2020 2020 222d 2220              "-" 
-000213b0: 666f 7220 6c6f 6e67 2c20 616e 6420 222b  for long, and "+
-000213c0: 2220 666f 7220 7368 6f72 742e 0a0a 2020  " for short...  
-000213d0: 2020 2020 2020 206f 6b65 783a 2068 7474         okex: htt
-000213e0: 7073 3a2f 2f77 7777 2e6f 6b65 782e 636f  ps://www.okex.co
-000213f0: 6d2f 7375 7070 6f72 742f 6863 2f65 6e2d  m/support/hc/en-
-00021400: 7573 2f61 7274 6963 6c65 732f 0a20 2020  us/articles/.   
-00021410: 2020 2020 2020 2020 2033 3630 3035 3339           3600539
-00021420: 3039 3539 322d 5649 2d49 6e74 726f 6475  09592-VI-Introdu
-00021430: 6374 696f 6e2d 746f 2d74 6865 2d69 736f  ction-to-the-iso
-00021440: 6c61 7465 642d 6d6f 6465 2d6f 662d 5369  lated-mode-of-Si
-00021450: 6e67 6c65 2d4d 756c 7469 2d63 7572 7265  ngle-Multi-curre
-00021460: 6e63 792d 506f 7274 666f 6c69 6f2d 6d61  ncy-Portfolio-ma
-00021470: 7267 696e 0a0a 2020 2020 2020 2020 3a70  rgin..        :p
-00021480: 6172 616d 2070 6169 723a 2050 6169 7220  aram pair: Pair 
-00021490: 746f 2063 616c 6375 6c61 7465 206c 6971  to calculate liq
-000214a0: 7569 6461 7469 6f6e 2070 7269 6365 2066  uidation price f
-000214b0: 6f72 0a20 2020 2020 2020 203a 7061 7261  or.        :para
-000214c0: 6d20 6f70 656e 5f72 6174 653a 2045 6e74  m open_rate: Ent
-000214d0: 7279 2070 7269 6365 206f 6620 706f 7369  ry price of posi
-000214e0: 7469 6f6e 0a20 2020 2020 2020 203a 7061  tion.        :pa
-000214f0: 7261 6d20 6973 5f73 686f 7274 3a20 5472  ram is_short: Tr
-00021500: 7565 2069 6620 7468 6520 7472 6164 6520  ue if the trade 
-00021510: 6973 2061 2073 686f 7274 2c20 6661 6c73  is a short, fals
-00021520: 6520 6f74 6865 7277 6973 650a 2020 2020  e otherwise.    
-00021530: 2020 2020 3a70 6172 616d 2061 6d6f 756e      :param amoun
-00021540: 743a 2041 6273 6f6c 7574 6520 7661 6c75  t: Absolute valu
-00021550: 6520 6f66 2070 6f73 6974 696f 6e20 7369  e of position si
-00021560: 7a65 2069 6e63 6c2e 206c 6576 6572 6167  ze incl. leverag
-00021570: 6520 2869 6e20 6261 7365 2063 7572 7265  e (in base curre
-00021580: 6e63 7929 0a20 2020 2020 2020 203a 7061  ncy).        :pa
-00021590: 7261 6d20 7374 616b 655f 616d 6f75 6e74  ram stake_amount
-000215a0: 3a20 5374 616b 6520 616d 6f75 6e74 202d  : Stake amount -
-000215b0: 2043 6f6c 6c61 7465 7261 6c20 696e 2073   Collateral in s
-000215c0: 6574 746c 6520 6375 7272 656e 6379 2e0a  ettle currency..
-000215d0: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
-000215e0: 6576 6572 6167 653a 204c 6576 6572 6167  everage: Leverag
-000215f0: 6520 7573 6564 2066 6f72 2074 6869 7320  e used for this 
-00021600: 706f 7369 7469 6f6e 2e0a 2020 2020 2020  position..      
-00021610: 2020 3a70 6172 616d 2074 7261 6469 6e67    :param trading
-00021620: 5f6d 6f64 653a 2053 504f 542c 204d 4152  _mode: SPOT, MAR
-00021630: 4749 4e2c 2046 5554 5552 4553 2c20 6574  GIN, FUTURES, et
-00021640: 632e 0a20 2020 2020 2020 203a 7061 7261  c..        :para
-00021650: 6d20 6d61 7267 696e 5f6d 6f64 653a 2045  m margin_mode: E
-00021660: 6974 6865 7220 4953 4f4c 4154 4544 206f  ither ISOLATED o
-00021670: 7220 4352 4f53 530a 2020 2020 2020 2020  r CROSS.        
-00021680: 3a70 6172 616d 2077 616c 6c65 745f 6261  :param wallet_ba
-00021690: 6c61 6e63 653a 2041 6d6f 756e 7420 6f66  lance: Amount of
-000216a0: 206d 6172 6769 6e5f 6d6f 6465 2069 6e20   margin_mode in 
-000216b0: 7468 6520 7761 6c6c 6574 2062 6569 6e67  the wallet being
-000216c0: 2075 7365 6420 746f 2074 7261 6465 0a20   used to trade. 
-000216d0: 2020 2020 2020 2020 2020 2043 726f 7373             Cross
-000216e0: 2d4d 6172 6769 6e20 4d6f 6465 3a20 6372  -Margin Mode: cr
-000216f0: 6f73 7357 616c 6c65 7442 616c 616e 6365  ossWalletBalance
-00021700: 0a20 2020 2020 2020 2020 2020 2049 736f  .            Iso
-00021710: 6c61 7465 642d 4d61 7267 696e 204d 6f64  lated-Margin Mod
-00021720: 653a 2069 736f 6c61 7465 6457 616c 6c65  e: isolatedWalle
-00021730: 7442 616c 616e 6365 0a0a 2020 2020 2020  tBalance..      
-00021740: 2020 2320 2a20 4e6f 7420 7265 7175 6972    # * Not requir
-00021750: 6564 2062 7920 4761 7465 206f 7220 4f4b  ed by Gate or OK
-00021760: 580a 2020 2020 2020 2020 3a70 6172 616d  X.        :param
-00021770: 206d 6d5f 6578 5f31 3a0a 2020 2020 2020   mm_ex_1:.      
-00021780: 2020 3a70 6172 616d 2075 706e 6c5f 6578    :param upnl_ex
-00021790: 5f31 3a0a 2020 2020 2020 2020 2222 220a  _1:.        """.
-000217a0: 0a20 2020 2020 2020 206d 6172 6b65 7420  .        market 
-000217b0: 3d20 7365 6c66 2e6d 6172 6b65 7473 5b70  = self.markets[p
-000217c0: 6169 725d 0a20 2020 2020 2020 2074 616b  air].        tak
-000217d0: 6572 5f66 6565 5f72 6174 6520 3d20 6d61  er_fee_rate = ma
-000217e0: 726b 6574 5b27 7461 6b65 7227 5d0a 2020  rket['taker'].  
-000217f0: 2020 2020 2020 6d6d 5f72 6174 696f 2c20        mm_ratio, 
-00021800: 5f20 3d20 7365 6c66 2e67 6574 5f6d 6169  _ = self.get_mai
-00021810: 6e74 656e 616e 6365 5f72 6174 696f 5f61  ntenance_ratio_a
-00021820: 6e64 5f61 6d74 2870 6169 722c 2073 7461  nd_amt(pair, sta
-00021830: 6b65 5f61 6d6f 756e 7429 0a0a 2020 2020  ke_amount)..    
-00021840: 2020 2020 6966 2073 656c 662e 7472 6164      if self.trad
-00021850: 696e 675f 6d6f 6465 203d 3d20 5472 6164  ing_mode == Trad
-00021860: 696e 674d 6f64 652e 4655 5455 5245 5320  ingMode.FUTURES 
-00021870: 616e 6420 7365 6c66 2e6d 6172 6769 6e5f  and self.margin_
-00021880: 6d6f 6465 203d 3d20 4d61 7267 696e 4d6f  mode == MarginMo
-00021890: 6465 2e49 534f 4c41 5445 443a 0a0a 2020  de.ISOLATED:..  
-000218a0: 2020 2020 2020 2020 2020 6966 206d 6172            if mar
-000218b0: 6b65 745b 2769 6e76 6572 7365 275d 3a0a  ket['inverse']:.
-000218c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000218d0: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
-000218e0: 6c45 7863 6570 7469 6f6e 280a 2020 2020  lException(.    
-000218f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021900: 2246 7265 7174 7261 6465 2064 6f65 7320  "Freqtrade does 
-00021910: 6e6f 7420 7965 7420 7375 7070 6f72 7420  not yet support 
-00021920: 696e 7665 7273 6520 636f 6e74 7261 6374  inverse contract
-00021930: 7322 290a 0a20 2020 2020 2020 2020 2020  s")..           
-00021940: 2076 616c 7565 203d 2077 616c 6c65 745f   value = wallet_
-00021950: 6261 6c61 6e63 6520 2f20 616d 6f75 6e74  balance / amount
-00021960: 0a0a 2020 2020 2020 2020 2020 2020 6d6d  ..            mm
-00021970: 5f72 6174 696f 5f74 616b 6572 203d 2028  _ratio_taker = (
-00021980: 6d6d 5f72 6174 696f 202b 2074 616b 6572  mm_ratio + taker
-00021990: 5f66 6565 5f72 6174 6529 0a20 2020 2020  _fee_rate).     
-000219a0: 2020 2020 2020 2069 6620 6973 5f73 686f         if is_sho
-000219b0: 7274 3a0a 2020 2020 2020 2020 2020 2020  rt:.            
-000219c0: 2020 2020 7265 7475 726e 2028 6f70 656e      return (open
-000219d0: 5f72 6174 6520 2b20 7661 6c75 6529 202f  _rate + value) /
-000219e0: 2028 3120 2b20 6d6d 5f72 6174 696f 5f74   (1 + mm_ratio_t
-000219f0: 616b 6572 290a 2020 2020 2020 2020 2020  aker).          
-00021a00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00021a10: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-00021a20: 6f70 656e 5f72 6174 6520 2d20 7661 6c75  open_rate - valu
-00021a30: 6529 202f 2028 3120 2d20 6d6d 5f72 6174  e) / (1 - mm_rat
-00021a40: 696f 5f74 616b 6572 290a 2020 2020 2020  io_taker).      
-00021a50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00021a60: 2020 2020 7261 6973 6520 4f70 6572 6174      raise Operat
-00021a70: 696f 6e61 6c45 7863 6570 7469 6f6e 280a  ionalException(.
-00021a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021a90: 2246 7265 7174 7261 6465 206f 6e6c 7920  "Freqtrade only 
-00021aa0: 7375 7070 6f72 7473 2069 736f 6c61 7465  supports isolate
-00021ab0: 6420 6675 7475 7265 7320 666f 7220 6c65  d futures for le
-00021ac0: 7665 7261 6765 2074 7261 6469 6e67 2229  verage trading")
-00021ad0: 0a0a 2020 2020 6465 6620 6765 745f 6d61  ..    def get_ma
-00021ae0: 696e 7465 6e61 6e63 655f 7261 7469 6f5f  intenance_ratio_
-00021af0: 616e 645f 616d 7428 0a20 2020 2020 2020  and_amt(.       
-00021b00: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-00021b10: 6169 723a 2073 7472 2c0a 2020 2020 2020  air: str,.      
-00021b20: 2020 6e6f 6d69 6e61 6c5f 7661 6c75 653a    nominal_value:
-00021b30: 2066 6c6f 6174 2c0a 2020 2020 2920 2d3e   float,.    ) ->
-00021b40: 2054 7570 6c65 5b66 6c6f 6174 2c20 4f70   Tuple[float, Op
-00021b50: 7469 6f6e 616c 5b66 6c6f 6174 5d5d 3a0a  tional[float]]:.
-00021b60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00021b70: 2020 2020 496d 706f 7274 616e 743a 204d      Important: M
-00021b80: 7573 7420 6265 2066 6574 6368 696e 6720  ust be fetching 
-00021b90: 6461 7461 2066 726f 6d20 6361 6368 6564  data from cached
-00021ba0: 2076 616c 7565 7320 6173 2074 6869 7320   values as this 
-00021bb0: 6973 2075 7365 6420 6279 2062 6163 6b74  is used by backt
-00021bc0: 6573 7469 6e67 210a 2020 2020 2020 2020  esting!.        
-00021bd0: 3a70 6172 616d 2070 6169 723a 204d 6172  :param pair: Mar
-00021be0: 6b65 7420 7379 6d62 6f6c 0a20 2020 2020  ket symbol.     
-00021bf0: 2020 203a 7061 7261 6d20 6e6f 6d69 6e61     :param nomina
-00021c00: 6c5f 7661 6c75 653a 2054 6865 2074 6f74  l_value: The tot
-00021c10: 616c 2074 7261 6465 2061 6d6f 756e 7420  al trade amount 
-00021c20: 696e 2071 756f 7465 2063 7572 7265 6e63  in quote currenc
-00021c30: 7920 696e 636c 7564 696e 6720 6c65 7665  y including leve
-00021c40: 7261 6765 0a20 2020 2020 2020 206d 6169  rage.        mai
-00021c50: 6e74 656e 616e 6365 2061 6d6f 756e 7420  ntenance amount 
-00021c60: 6f6e 6c79 206f 6e20 4269 6e61 6e63 650a  only on Binance.
-00021c70: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00021c80: 2028 6d61 696e 7465 6e61 6e63 6520 6d61   (maintenance ma
-00021c90: 7267 696e 2072 6174 696f 2c20 6d61 696e  rgin ratio, main
-00021ca0: 7465 6e61 6e63 6520 616d 6f75 6e74 290a  tenance amount).
-00021cb0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-00021cc0: 2020 2020 2069 6620 2873 656c 662e 5f63       if (self._c
-00021cd0: 6f6e 6669 672e 6765 7428 2772 756e 6d6f  onfig.get('runmo
-00021ce0: 6465 2729 2069 6e20 4f50 5449 4d49 5a45  de') in OPTIMIZE
-00021cf0: 5f4d 4f44 4553 0a20 2020 2020 2020 2020  _MODES.         
-00021d00: 2020 2020 2020 206f 7220 7365 6c66 2e65         or self.e
-00021d10: 7863 6861 6e67 655f 6861 7328 2766 6574  xchange_has('fet
-00021d20: 6368 4c65 7665 7261 6765 5469 6572 7327  chLeverageTiers'
-00021d30: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00021d40: 2020 6f72 2073 656c 662e 6578 6368 616e    or self.exchan
-00021d50: 6765 5f68 6173 2827 6665 7463 684d 6172  ge_has('fetchMar
-00021d60: 6b65 744c 6576 6572 6167 6554 6965 7273  ketLeverageTiers
-00021d70: 2729 293a 0a0a 2020 2020 2020 2020 2020  ')):..          
-00021d80: 2020 6966 2070 6169 7220 6e6f 7420 696e    if pair not in
-00021d90: 2073 656c 662e 5f6c 6576 6572 6167 655f   self._leverage_
-00021da0: 7469 6572 733a 0a20 2020 2020 2020 2020  tiers:.         
-00021db0: 2020 2020 2020 2072 6169 7365 2049 6e76         raise Inv
-00021dc0: 616c 6964 4f72 6465 7245 7863 6570 7469  alidOrderExcepti
-00021dd0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-00021de0: 2020 2020 2020 2020 6622 4d61 696e 7465          f"Mainte
-00021df0: 6e61 6e63 6520 6d61 7267 696e 2072 6174  nance margin rat
-00021e00: 6520 666f 7220 7b70 6169 727d 2069 7320  e for {pair} is 
-00021e10: 756e 6176 6169 6c61 626c 6520 666f 7220  unavailable for 
-00021e20: 7b73 656c 662e 6e61 6d65 7d22 0a20 2020  {self.name}".   
-00021e30: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
-00021e40: 2020 2020 2020 2020 2020 2020 7061 6972              pair
-00021e50: 5f74 6965 7273 203d 2073 656c 662e 5f6c  _tiers = self._l
-00021e60: 6576 6572 6167 655f 7469 6572 735b 7061  everage_tiers[pa
-00021e70: 6972 5d0a 0a20 2020 2020 2020 2020 2020  ir]..           
-00021e80: 2066 6f72 2074 6965 7220 696e 2072 6576   for tier in rev
-00021e90: 6572 7365 6428 7061 6972 5f74 6965 7273  ersed(pair_tiers
-00021ea0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00021eb0: 2020 2069 6620 6e6f 6d69 6e61 6c5f 7661     if nominal_va
-00021ec0: 6c75 6520 3e3d 2074 6965 725b 276d 696e  lue >= tier['min
-00021ed0: 4e6f 7469 6f6e 616c 275d 3a0a 2020 2020  Notional']:.    
-00021ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021ef0: 7265 7475 726e 2028 7469 6572 5b27 6d61  return (tier['ma
-00021f00: 696e 7465 6e61 6e63 654d 6172 6769 6e52  intenanceMarginR
-00021f10: 6174 6527 5d2c 2074 6965 725b 276d 6169  ate'], tier['mai
-00021f20: 6e74 416d 7427 5d29 0a0a 2020 2020 2020  ntAmt'])..      
-00021f30: 2020 2020 2020 7261 6973 6520 4578 6368        raise Exch
-00021f40: 616e 6765 4572 726f 7228 226e 6f6d 696e  angeError("nomin
-00021f50: 616c 2076 616c 7565 2063 616e 206e 6f74  al value can not
-00021f60: 2062 6520 6c6f 7765 7220 7468 616e 2030   be lower than 0
-00021f70: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
-00021f80: 2054 6865 206c 6f77 6573 7420 6e6f 7469   The lowest noti
-00021f90: 6f6e 616c 5f66 6c6f 6f72 2066 6f72 2061  onal_floor for a
-00021fa0: 6e79 2070 6169 7220 696e 2066 6574 6368  ny pair in fetch
-00021fb0: 5f6c 6576 6572 6167 655f 7469 6572 7320  _leverage_tiers 
-00021fc0: 6973 2061 6c77 6179 7320 3020 6265 6361  is always 0 beca
-00021fd0: 7573 6520 6974 0a20 2020 2020 2020 2020  use it.         
-00021fe0: 2020 2023 2064 6573 6372 6962 6573 2074     # describes t
-00021ff0: 6865 206d 696e 2061 6d74 2066 6f72 2061  he min amt for a
-00022000: 2074 6965 722c 2061 6e64 2074 6865 206c   tier, and the l
-00022010: 6f77 6573 7420 7469 6572 2077 696c 6c20  owest tier will 
-00022020: 616c 7761 7973 2067 6f20 646f 776e 2074  always go down t
-00022030: 6f20 300a 2020 2020 2020 2020 656c 7365  o 0.        else
-00022040: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00022050: 6973 6520 4578 6368 616e 6765 4572 726f  ise ExchangeErro
-00022060: 7228 6622 4361 6e6e 6f74 2067 6574 206d  r(f"Cannot get m
-00022070: 6169 6e74 656e 616e 6365 2072 6174 696f  aintenance ratio
-00022080: 2075 7369 6e67 207b 7365 6c66 2e6e 616d   using {self.nam
-00022090: 657d 2229 0a20 2020 2020 2020 2020 2020  e}").           
-000220a0: 2072 6169 7365 2045 7863 6861 6e67 6545   raise ExchangeE
-000220b0: 7272 6f72 2866 2243 616e 6e6f 7420 6765  rror(f"Cannot ge
-000220c0: 7420 6d61 696e 7465 6e61 6e63 6520 7261  t maintenance ra
-000220d0: 7469 6f20 7573 696e 6720 7b73 656c 662e  tio using {self.
-000220e0: 6e61 6d65 7d22 290a                      name}").
+0001e190: 2320 2020 2020 226c 6576 223a 2035 302c  #     "lev": 50,
+0001e1a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e1b0: 2020 2020 2020 2020 2023 207d 0a20 2020           # }.   
+0001e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1d0: 2020 2020 2023 0a0a 2020 2020 2020 2020       #..        
+0001e1e0: 2020 2020 2020 2020 656c 7365 3a20 2023          else:  #
+0001e1f0: 2069 6620 6f6e 2074 6865 206c 6173 7420   if on the last 
+0001e200: 7469 6572 0a20 2020 2020 2020 2020 2020  tier.           
+0001e210: 2020 2020 2020 2020 2069 6620 7374 616b           if stak
+0001e220: 655f 616d 6f75 6e74 203e 2074 6965 725b  e_amount > tier[
+0001e230: 276d 6178 4e6f 7469 6f6e 616c 275d 3a0a  'maxNotional']:.
+0001e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e250: 2020 2020 2020 2020 2320 4966 2073 7461          # If sta
+0001e260: 6b65 2069 7320 3e20 7468 616e 206d 6178  ke is > than max
+0001e270: 2074 7261 6465 6162 6c65 2061 6d6f 756e   tradeable amoun
+0001e280: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0001e290: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+0001e2a0: 496e 7661 6c69 644f 7264 6572 4578 6365  InvalidOrderExce
+0001e2b0: 7074 696f 6e28 6627 416d 6f75 6e74 207b  ption(f'Amount {
+0001e2c0: 7374 616b 655f 616d 6f75 6e74 7d20 746f  stake_amount} to
+0001e2d0: 6f20 6869 6768 2066 6f72 207b 7061 6972  o high for {pair
+0001e2e0: 7d27 290a 2020 2020 2020 2020 2020 2020  }').            
+0001e2f0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0001e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e310: 2020 2020 2020 7265 7475 726e 2074 6965        return tie
+0001e320: 725b 276d 6178 4c65 7665 7261 6765 275d  r['maxLeverage']
+0001e330: 0a0a 2020 2020 2020 2020 2020 2020 7261  ..            ra
+0001e340: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+0001e350: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+0001e360: 2020 2020 2020 2020 2020 274c 6f6f 7065            'Loope
+0001e370: 6420 7468 726f 7567 6820 616c 6c20 7469  d through all ti
+0001e380: 6572 7320 7769 7468 6f75 7420 6669 6e64  ers without find
+0001e390: 696e 6720 6120 6d61 7820 6c65 7665 7261  ing a max levera
+0001e3a0: 6765 2e20 5368 6f75 6c64 206e 6576 6572  ge. Should never
+0001e3b0: 2062 6520 7265 6163 6865 6427 0a20 2020   be reached'.   
+0001e3c0: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+0001e3d0: 2020 2020 656c 6966 2073 656c 662e 7472      elif self.tr
+0001e3e0: 6164 696e 675f 6d6f 6465 203d 3d20 5472  ading_mode == Tr
+0001e3f0: 6164 696e 674d 6f64 652e 4d41 5247 494e  adingMode.MARGIN
+0001e400: 3a20 2023 2053 6561 7263 6820 6d61 726b  :  # Search mark
+0001e410: 6574 732e 6c69 6d69 7473 2066 6f72 206d  ets.limits for m
+0001e420: 6178 206c 6576 0a20 2020 2020 2020 2020  ax lev.         
+0001e430: 2020 206d 6172 6b65 7420 3d20 7365 6c66     market = self
+0001e440: 2e6d 6172 6b65 7473 5b70 6169 725d 0a20  .markets[pair]. 
+0001e450: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
+0001e460: 726b 6574 5b27 6c69 6d69 7473 275d 5b27  rket['limits']['
+0001e470: 6c65 7665 7261 6765 275d 5b27 6d61 7827  leverage']['max'
+0001e480: 5d20 6973 206e 6f74 204e 6f6e 653a 0a20  ] is not None:. 
+0001e490: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0001e4a0: 6574 7572 6e20 6d61 726b 6574 5b27 6c69  eturn market['li
+0001e4b0: 6d69 7473 275d 5b27 6c65 7665 7261 6765  mits']['leverage
+0001e4c0: 275d 5b27 6d61 7827 5d0a 2020 2020 2020  ']['max'].      
+0001e4d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001e4e0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001e4f0: 726e 2031 2e30 2020 2320 4465 6661 756c  rn 1.0  # Defaul
+0001e500: 7420 6966 206d 6178 206c 6576 6572 6167  t if max leverag
+0001e510: 6520 6361 6e6e 6f74 2062 6520 666f 756e  e cannot be foun
+0001e520: 640a 2020 2020 2020 2020 656c 7365 3a0a  d.        else:.
+0001e530: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001e540: 726e 2031 2e30 0a0a 2020 2020 4072 6574  rn 1.0..    @ret
+0001e550: 7269 6572 0a20 2020 2064 6566 205f 7365  rier.    def _se
+0001e560: 745f 6c65 7665 7261 6765 280a 2020 2020  t_leverage(.    
+0001e570: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0001e580: 2020 6c65 7665 7261 6765 3a20 666c 6f61    leverage: floa
+0001e590: 742c 0a20 2020 2020 2020 2070 6169 723a  t,.        pair:
+0001e5a0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+0001e5b0: 204e 6f6e 652c 0a20 2020 2020 2020 2061   None,.        a
+0001e5c0: 6363 6570 745f 6661 696c 3a20 626f 6f6c  ccept_fail: bool
+0001e5d0: 203d 2046 616c 7365 2c0a 2020 2020 293a   = False,.    ):
+0001e5e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001e5f0: 2020 2020 2053 6574 2773 2074 6865 206c       Set's the l
+0001e600: 6576 6572 6167 6520 6265 666f 7265 206d  everage before m
+0001e610: 616b 696e 6720 6120 7472 6164 652c 2069  aking a trade, i
+0001e620: 6e20 6f72 6465 7220 746f 206e 6f74 0a20  n order to not. 
+0001e630: 2020 2020 2020 2068 6176 6520 7468 6520         have the 
+0001e640: 7361 6d65 206c 6576 6572 6167 6520 6f6e  same leverage on
+0001e650: 2065 7665 7279 2074 7261 6465 0a20 2020   every trade.   
+0001e660: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001e670: 2069 6620 7365 6c66 2e5f 636f 6e66 6967   if self._config
+0001e680: 5b27 6472 795f 7275 6e27 5d20 6f72 206e  ['dry_run'] or n
+0001e690: 6f74 2073 656c 662e 6578 6368 616e 6765  ot self.exchange
+0001e6a0: 5f68 6173 2822 7365 744c 6576 6572 6167  _has("setLeverag
+0001e6b0: 6522 293a 0a20 2020 2020 2020 2020 2020  e"):.           
+0001e6c0: 2023 2053 6f6d 6520 6578 6368 616e 6765   # Some exchange
+0001e6d0: 7320 6f6e 6c79 2073 7570 706f 7274 206f  s only support o
+0001e6e0: 6e65 206d 6172 6769 6e5f 6d6f 6465 2074  ne margin_mode t
+0001e6f0: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
+0001e700: 7265 7475 726e 0a20 2020 2020 2020 2069  return.        i
+0001e710: 6620 7365 6c66 2e5f 6674 5f68 6173 2e67  f self._ft_has.g
+0001e720: 6574 2827 666c 6f6f 725f 6c65 7665 7261  et('floor_levera
+0001e730: 6765 272c 2046 616c 7365 2920 6973 2054  ge', False) is T
+0001e740: 7275 653a 0a20 2020 2020 2020 2020 2020  rue:.           
+0001e750: 2023 2052 6f75 6e64 696e 6720 666f 7220   # Rounding for 
+0001e760: 6269 6e61 6e63 6520 2e2e 2e0a 2020 2020  binance ....    
+0001e770: 2020 2020 2020 2020 6c65 7665 7261 6765          leverage
+0001e780: 203d 2066 6c6f 6f72 286c 6576 6572 6167   = floor(leverag
+0001e790: 6529 0a20 2020 2020 2020 2074 7279 3a0a  e).        try:.
+0001e7a0: 2020 2020 2020 2020 2020 2020 7265 7320              res 
+0001e7b0: 3d20 7365 6c66 2e5f 6170 692e 7365 745f  = self._api.set_
+0001e7c0: 6c65 7665 7261 6765 2873 796d 626f 6c3d  leverage(symbol=
+0001e7d0: 7061 6972 2c20 6c65 7665 7261 6765 3d6c  pair, leverage=l
+0001e7e0: 6576 6572 6167 6529 0a20 2020 2020 2020  everage).       
+0001e7f0: 2020 2020 2073 656c 662e 5f6c 6f67 5f65       self._log_e
+0001e800: 7863 6861 6e67 655f 7265 7370 6f6e 7365  xchange_response
+0001e810: 2827 7365 745f 6c65 7665 7261 6765 272c  ('set_leverage',
+0001e820: 2072 6573 290a 2020 2020 2020 2020 6578   res).        ex
+0001e830: 6365 7074 2063 6378 742e 4444 6f53 5072  cept ccxt.DDoSPr
+0001e840: 6f74 6563 7469 6f6e 2061 7320 653a 0a20  otection as e:. 
+0001e850: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001e860: 2044 446f 7350 726f 7465 6374 696f 6e28   DDosProtection(
+0001e870: 6529 2066 726f 6d20 650a 2020 2020 2020  e) from e.      
+0001e880: 2020 6578 6365 7074 2028 6363 7874 2e42    except (ccxt.B
+0001e890: 6164 5265 7175 6573 742c 2063 6378 742e  adRequest, ccxt.
+0001e8a0: 4f70 6572 6174 696f 6e52 656a 6563 7465  OperationRejecte
+0001e8b0: 642c 2063 6378 742e 496e 7375 6666 6963  d, ccxt.Insuffic
+0001e8c0: 6965 6e74 4675 6e64 7329 2061 7320 653a  ientFunds) as e:
+0001e8d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0001e8e0: 6e6f 7420 6163 6365 7074 5f66 6169 6c3a  not accept_fail:
+0001e8f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e900: 2072 6169 7365 2054 656d 706f 7261 7279   raise Temporary
+0001e910: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+0001e920: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+0001e930: 6c64 206e 6f74 2073 6574 206c 6576 6572  ld not set lever
+0001e940: 6167 6520 6475 6520 746f 207b 652e 5f5f  age due to {e.__
+0001e950: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0001e960: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
+0001e970: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0001e980: 2065 7863 6570 7420 2863 6378 742e 4f70   except (ccxt.Op
+0001e990: 6572 6174 696f 6e46 6169 6c65 642c 2063  erationFailed, c
+0001e9a0: 6378 742e 4578 6368 616e 6765 4572 726f  cxt.ExchangeErro
+0001e9b0: 7229 2061 7320 653a 0a20 2020 2020 2020  r) as e:.       
+0001e9c0: 2020 2020 2072 6169 7365 2054 656d 706f       raise Tempo
+0001e9d0: 7261 7279 4572 726f 7228 0a20 2020 2020  raryError(.     
+0001e9e0: 2020 2020 2020 2020 2020 2066 2743 6f75             f'Cou
+0001e9f0: 6c64 206e 6f74 2073 6574 206c 6576 6572  ld not set lever
+0001ea00: 6167 6520 6475 6520 746f 207b 652e 5f5f  age due to {e.__
+0001ea10: 636c 6173 735f 5f2e 5f5f 6e61 6d65 5f5f  class__.__name__
+0001ea20: 7d2e 204d 6573 7361 6765 3a20 7b65 7d27  }. Message: {e}'
+0001ea30: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
+0001ea40: 2065 7863 6570 7420 6363 7874 2e42 6173   except ccxt.Bas
+0001ea50: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
+0001ea60: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+0001ea70: 7065 7261 7469 6f6e 616c 4578 6365 7074  perationalExcept
+0001ea80: 696f 6e28 6529 2066 726f 6d20 650a 0a20  ion(e) from e.. 
+0001ea90: 2020 2064 6566 2067 6574 5f69 6e74 6572     def get_inter
+0001eaa0: 6573 745f 7261 7465 2873 656c 6629 202d  est_rate(self) -
+0001eab0: 3e20 666c 6f61 743a 0a20 2020 2020 2020  > float:.       
+0001eac0: 2022 2222 0a20 2020 2020 2020 2052 6574   """.        Ret
+0001ead0: 7269 6576 6520 696e 7465 7265 7374 2072  rieve interest r
+0001eae0: 6174 6520 2d20 6e65 6365 7373 6172 7920  ate - necessary 
+0001eaf0: 666f 7220 4d61 7267 696e 2074 7261 6469  for Margin tradi
+0001eb00: 6e67 2e0a 2020 2020 2020 2020 5368 6f75  ng..        Shou
+0001eb10: 6c64 206e 6f74 2063 616c 6c20 7468 6520  ld not call the 
+0001eb20: 6578 6368 616e 6765 2064 6972 6563 746c  exchange directl
+0001eb30: 7920 7768 656e 2075 7365 6420 6672 6f6d  y when used from
+0001eb40: 2062 6163 6b74 6573 7469 6e67 2e0a 2020   backtesting..  
+0001eb50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0001eb60: 2020 7265 7475 726e 2030 2e30 0a0a 2020    return 0.0..  
+0001eb70: 2020 6465 6620 6675 6e64 696e 675f 6665    def funding_fe
+0001eb80: 655f 6375 746f 6666 2873 656c 662c 206f  e_cutoff(self, o
+0001eb90: 7065 6e5f 6461 7465 3a20 6461 7465 7469  pen_date: dateti
+0001eba0: 6d65 2920 2d3e 2062 6f6f 6c3a 0a20 2020  me) -> bool:.   
+0001ebb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001ebc0: 2046 756e 6469 6e67 2066 6565 7320 6172   Funding fees ar
+0001ebd0: 6520 6f6e 6c79 2063 6861 7267 6564 2061  e only charged a
+0001ebe0: 7420 6675 6c6c 2068 6f75 7273 2028 7573  t full hours (us
+0001ebf0: 7561 6c6c 7920 6576 6572 7920 342d 3868  ually every 4-8h
+0001ec00: 292e 0a20 2020 2020 2020 2054 6865 7265  )..        There
+0001ec10: 666f 7265 2061 2074 7261 6465 206f 7065  fore a trade ope
+0001ec20: 6e69 6e67 2061 7420 3130 3a30 303a 3031  ning at 10:00:01
+0001ec30: 2077 696c 6c20 6e6f 7420 6265 2063 6861   will not be cha
+0001ec40: 7267 6564 2061 2066 756e 6469 6e67 2066  rged a funding f
+0001ec50: 6565 2075 6e74 696c 2074 6865 206e 6578  ee until the nex
+0001ec60: 7420 686f 7572 2e0a 2020 2020 2020 2020  t hour..        
+0001ec70: 3a70 6172 616d 206f 7065 6e5f 6461 7465  :param open_date
+0001ec80: 3a20 5468 6520 6f70 656e 2064 6174 6520  : The open date 
+0001ec90: 666f 7220 6120 7472 6164 650a 2020 2020  for a trade.    
+0001eca0: 2020 2020 3a72 6574 7572 6e3a 2054 7275      :return: Tru
+0001ecb0: 6520 6966 2074 6865 2064 6174 6520 6661  e if the date fa
+0001ecc0: 6c6c 7320 6f6e 2061 2066 756c 6c20 686f  lls on a full ho
+0001ecd0: 7572 2c20 4661 6c73 6520 6f74 6865 7277  ur, False otherw
+0001ece0: 6973 650a 2020 2020 2020 2020 2222 220a  ise.        """.
+0001ecf0: 2020 2020 2020 2020 7265 7475 726e 206f          return o
+0001ed00: 7065 6e5f 6461 7465 2e6d 696e 7574 6520  pen_date.minute 
+0001ed10: 3d3d 2030 2061 6e64 206f 7065 6e5f 6461  == 0 and open_da
+0001ed20: 7465 2e73 6563 6f6e 6420 3d3d 2030 0a0a  te.second == 0..
+0001ed30: 2020 2020 4072 6574 7269 6572 0a20 2020      @retrier.   
+0001ed40: 2064 6566 2073 6574 5f6d 6172 6769 6e5f   def set_margin_
+0001ed50: 6d6f 6465 2873 656c 662c 2070 6169 723a  mode(self, pair:
+0001ed60: 2073 7472 2c20 6d61 7267 696e 5f6d 6f64   str, margin_mod
+0001ed70: 653a 204d 6172 6769 6e4d 6f64 652c 2061  e: MarginMode, a
+0001ed80: 6363 6570 745f 6661 696c 3a20 626f 6f6c  ccept_fail: bool
+0001ed90: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+0001eda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001edb0: 2020 7061 7261 6d73 3a20 4f70 7469 6f6e    params: Option
+0001edc0: 616c 5b44 6963 745d 203d 204e 6f6e 6529  al[Dict] = None)
+0001edd0: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001ede0: 2020 2020 2020 5365 7427 7320 7468 6520        Set's the 
+0001edf0: 6d61 7267 696e 206d 6f64 6520 6f6e 2074  margin mode on t
+0001ee00: 6865 2065 7863 6861 6e67 6520 746f 2063  he exchange to c
+0001ee10: 726f 7373 206f 7220 6973 6f6c 6174 6564  ross or isolated
+0001ee20: 2066 6f72 2061 2073 7065 6369 6669 6320   for a specific 
+0001ee30: 7061 6972 0a20 2020 2020 2020 203a 7061  pair.        :pa
+0001ee40: 7261 6d20 7061 6972 3a20 6261 7365 2f71  ram pair: base/q
+0001ee50: 756f 7465 2063 7572 7265 6e63 7920 7061  uote currency pa
+0001ee60: 6972 2028 652e 672e 2022 4144 412f 5553  ir (e.g. "ADA/US
+0001ee70: 4454 2229 0a20 2020 2020 2020 2022 2222  DT").        """
+0001ee80: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0001ee90: 2e5f 636f 6e66 6967 5b27 6472 795f 7275  ._config['dry_ru
+0001eea0: 6e27 5d20 6f72 206e 6f74 2073 656c 662e  n'] or not self.
+0001eeb0: 6578 6368 616e 6765 5f68 6173 2822 7365  exchange_has("se
+0001eec0: 744d 6172 6769 6e4d 6f64 6522 293a 0a20  tMarginMode"):. 
+0001eed0: 2020 2020 2020 2020 2020 2023 2053 6f6d             # Som
+0001eee0: 6520 6578 6368 616e 6765 7320 6f6e 6c79  e exchanges only
+0001eef0: 2073 7570 706f 7274 206f 6e65 206d 6172   support one mar
+0001ef00: 6769 6e5f 6d6f 6465 2074 7970 650a 2020  gin_mode type.  
+0001ef10: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0001ef20: 0a0a 2020 2020 2020 2020 6966 2070 6172  ..        if par
+0001ef30: 616d 7320 6973 204e 6f6e 653a 0a20 2020  ams is None:.   
+0001ef40: 2020 2020 2020 2020 2070 6172 616d 7320           params 
+0001ef50: 3d20 7b7d 0a20 2020 2020 2020 2074 7279  = {}.        try
+0001ef60: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0001ef70: 7320 3d20 7365 6c66 2e5f 6170 692e 7365  s = self._api.se
+0001ef80: 745f 6d61 7267 696e 5f6d 6f64 6528 6d61  t_margin_mode(ma
+0001ef90: 7267 696e 5f6d 6f64 652e 7661 6c75 652c  rgin_mode.value,
+0001efa0: 2070 6169 722c 2070 6172 616d 7329 0a20   pair, params). 
+0001efb0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+0001efc0: 5f6c 6f67 5f65 7863 6861 6e67 655f 7265  _log_exchange_re
+0001efd0: 7370 6f6e 7365 2827 7365 745f 6d61 7267  sponse('set_marg
+0001efe0: 696e 5f6d 6f64 6527 2c20 7265 7329 0a20  in_mode', res). 
+0001eff0: 2020 2020 2020 2065 7863 6570 7420 6363         except cc
+0001f000: 7874 2e44 446f 5350 726f 7465 6374 696f  xt.DDoSProtectio
+0001f010: 6e20 6173 2065 3a0a 2020 2020 2020 2020  n as e:.        
+0001f020: 2020 2020 7261 6973 6520 4444 6f73 5072      raise DDosPr
+0001f030: 6f74 6563 7469 6f6e 2865 2920 6672 6f6d  otection(e) from
+0001f040: 2065 0a20 2020 2020 2020 2065 7863 6570   e.        excep
+0001f050: 7420 2863 6378 742e 4261 6452 6571 7565  t (ccxt.BadReque
+0001f060: 7374 2c20 6363 7874 2e4f 7065 7261 7469  st, ccxt.Operati
+0001f070: 6f6e 5265 6a65 6374 6564 2920 6173 2065  onRejected) as e
+0001f080: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+0001f090: 206e 6f74 2061 6363 6570 745f 6661 696c   not accept_fail
+0001f0a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001f0b0: 2020 7261 6973 6520 5465 6d70 6f72 6172    raise Temporar
+0001f0c0: 7945 7272 6f72 280a 2020 2020 2020 2020  yError(.        
+0001f0d0: 2020 2020 2020 2020 2020 2020 6627 436f              f'Co
+0001f0e0: 756c 6420 6e6f 7420 7365 7420 6d61 7267  uld not set marg
+0001f0f0: 696e 206d 6f64 6520 6475 6520 746f 207b  in mode due to {
+0001f100: 652e 5f5f 636c 6173 735f 5f2e 5f5f 6e61  e.__class__.__na
+0001f110: 6d65 5f5f 7d2e 204d 6573 7361 6765 3a20  me__}. Message: 
+0001f120: 7b65 7d27 2920 6672 6f6d 2065 0a20 2020  {e}') from e.   
+0001f130: 2020 2020 2065 7863 6570 7420 2863 6378       except (ccx
+0001f140: 742e 4f70 6572 6174 696f 6e46 6169 6c65  t.OperationFaile
+0001f150: 642c 2063 6378 742e 4578 6368 616e 6765  d, ccxt.Exchange
+0001f160: 4572 726f 7229 2061 7320 653a 0a20 2020  Error) as e:.   
+0001f170: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+0001f180: 656d 706f 7261 7279 4572 726f 7228 0a20  emporaryError(. 
+0001f190: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001f1a0: 2743 6f75 6c64 206e 6f74 2073 6574 206d  'Could not set m
+0001f1b0: 6172 6769 6e20 6d6f 6465 2064 7565 2074  argin mode due t
+0001f1c0: 6f20 7b65 2e5f 5f63 6c61 7373 5f5f 2e5f  o {e.__class__._
+0001f1d0: 5f6e 616d 655f 5f7d 2e20 4d65 7373 6167  _name__}. Messag
+0001f1e0: 653a 207b 657d 2729 2066 726f 6d20 650a  e: {e}') from e.
+0001f1f0: 2020 2020 2020 2020 6578 6365 7074 2063          except c
+0001f200: 6378 742e 4261 7365 4572 726f 7220 6173  cxt.BaseError as
+0001f210: 2065 3a0a 2020 2020 2020 2020 2020 2020   e:.            
+0001f220: 7261 6973 6520 4f70 6572 6174 696f 6e61  raise Operationa
+0001f230: 6c45 7863 6570 7469 6f6e 2865 2920 6672  lException(e) fr
+0001f240: 6f6d 2065 0a0a 2020 2020 6465 6620 5f66  om e..    def _f
+0001f250: 6574 6368 5f61 6e64 5f63 616c 6375 6c61  etch_and_calcula
+0001f260: 7465 5f66 756e 6469 6e67 5f66 6565 7328  te_funding_fees(
+0001f270: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+0001f280: 2020 2020 2020 2070 6169 723a 2073 7472         pair: str
+0001f290: 2c0a 2020 2020 2020 2020 616d 6f75 6e74  ,.        amount
+0001f2a0: 3a20 666c 6f61 742c 0a20 2020 2020 2020  : float,.       
+0001f2b0: 2069 735f 7368 6f72 743a 2062 6f6f 6c2c   is_short: bool,
+0001f2c0: 0a20 2020 2020 2020 206f 7065 6e5f 6461  .        open_da
+0001f2d0: 7465 3a20 6461 7465 7469 6d65 2c0a 2020  te: datetime,.  
+0001f2e0: 2020 2020 2020 636c 6f73 655f 6461 7465        close_date
+0001f2f0: 3a20 4f70 7469 6f6e 616c 5b64 6174 6574  : Optional[datet
+0001f300: 696d 655d 203d 204e 6f6e 650a 2020 2020  ime] = None.    
+0001f310: 2920 2d3e 2066 6c6f 6174 3a0a 2020 2020  ) -> float:.    
+0001f320: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001f330: 4665 7463 6865 7320 616e 6420 6361 6c63  Fetches and calc
+0001f340: 756c 6174 6573 2074 6865 2073 756d 206f  ulates the sum o
+0001f350: 6620 616c 6c20 6675 6e64 696e 6720 6665  f all funding fe
+0001f360: 6573 2074 6861 7420 6f63 6375 7272 6564  es that occurred
+0001f370: 2066 6f72 2061 2070 6169 720a 2020 2020   for a pair.    
+0001f380: 2020 2020 6475 7269 6e67 2061 2066 7574      during a fut
+0001f390: 7572 6573 2074 7261 6465 2e0a 2020 2020  ures trade..    
+0001f3a0: 2020 2020 4f6e 6c79 2075 7365 6420 6475      Only used du
+0001f3b0: 7269 6e67 2064 7279 2d72 756e 206f 7220  ring dry-run or 
+0001f3c0: 6966 2074 6865 2065 7863 6861 6e67 6520  if the exchange 
+0001f3d0: 646f 6573 206e 6f74 2070 726f 7669 6465  does not provide
+0001f3e0: 2061 2066 756e 6469 6e67 5f72 6174 6573   a funding_rates
+0001f3f0: 2065 6e64 706f 696e 742e 0a20 2020 2020   endpoint..     
+0001f400: 2020 203a 7061 7261 6d20 7061 6972 3a20     :param pair: 
+0001f410: 5468 6520 7175 6f74 652f 6261 7365 2070  The quote/base p
+0001f420: 6169 7220 6f66 2074 6865 2074 7261 6465  air of the trade
+0001f430: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001f440: 616d 6f75 6e74 3a20 5468 6520 7175 616e  amount: The quan
+0001f450: 7469 7479 206f 6620 7468 6520 7472 6164  tity of the trad
+0001f460: 650a 2020 2020 2020 2020 3a70 6172 616d  e.        :param
+0001f470: 2069 735f 7368 6f72 743a 2074 7261 6465   is_short: trade
+0001f480: 2064 6972 6563 7469 6f6e 0a20 2020 2020   direction.     
+0001f490: 2020 203a 7061 7261 6d20 6f70 656e 5f64     :param open_d
+0001f4a0: 6174 653a 2054 6865 2064 6174 6520 616e  ate: The date an
+0001f4b0: 6420 7469 6d65 2074 6861 7420 7468 6520  d time that the 
+0001f4c0: 7472 6164 6520 7374 6172 7465 640a 2020  trade started.  
+0001f4d0: 2020 2020 2020 3a70 6172 616d 2063 6c6f        :param clo
+0001f4e0: 7365 5f64 6174 653a 2054 6865 2064 6174  se_date: The dat
+0001f4f0: 6520 616e 6420 7469 6d65 2074 6861 7420  e and time that 
+0001f500: 7468 6520 7472 6164 6520 656e 6465 640a  the trade ended.
+0001f510: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0001f520: 2020 2020 2069 6620 7365 6c66 2e66 756e       if self.fun
+0001f530: 6469 6e67 5f66 6565 5f63 7574 6f66 6628  ding_fee_cutoff(
+0001f540: 6f70 656e 5f64 6174 6529 3a0a 2020 2020  open_date):.    
+0001f550: 2020 2020 2020 2020 2320 5368 6966 7420          # Shift 
+0001f560: 6261 636b 2074 6f20 3168 2063 616e 646c  back to 1h candl
+0001f570: 6520 746f 2061 766f 6964 206d 6973 7369  e to avoid missi
+0001f580: 6e67 2066 756e 6469 6e67 2066 6565 730a  ng funding fees.
+0001f590: 2020 2020 2020 2020 2020 2020 2320 4f6e              # On
+0001f5a0: 6c79 2072 6561 6c6c 7920 7265 6c65 7661  ly really releva
+0001f5b0: 6e74 2066 6f72 2074 7261 6465 7320 7665  nt for trades ve
+0001f5c0: 7279 2063 6c6f 7365 2074 6f20 7468 6520  ry close to the 
+0001f5d0: 6675 6c6c 2068 6f75 720a 2020 2020 2020  full hour.      
+0001f5e0: 2020 2020 2020 6f70 656e 5f64 6174 6520        open_date 
+0001f5f0: 3d20 7469 6d65 6672 616d 655f 746f 5f70  = timeframe_to_p
+0001f600: 7265 765f 6461 7465 2827 3168 272c 206f  rev_date('1h', o
+0001f610: 7065 6e5f 6461 7465 290a 2020 2020 2020  pen_date).      
+0001f620: 2020 7469 6d65 6672 616d 6520 3d20 7365    timeframe = se
+0001f630: 6c66 2e5f 6674 5f68 6173 5b27 6d61 726b  lf._ft_has['mark
+0001f640: 5f6f 686c 6376 5f74 696d 6566 7261 6d65  _ohlcv_timeframe
+0001f650: 275d 0a20 2020 2020 2020 2074 696d 6566  '].        timef
+0001f660: 7261 6d65 5f66 6620 3d20 7365 6c66 2e5f  rame_ff = self._
+0001f670: 6674 5f68 6173 5b27 6675 6e64 696e 675f  ft_has['funding_
+0001f680: 6665 655f 7469 6d65 6672 616d 6527 5d0a  fee_timeframe'].
+0001f690: 2020 2020 2020 2020 6d61 726b 5f70 7269          mark_pri
+0001f6a0: 6365 5f74 7970 6520 3d20 4361 6e64 6c65  ce_type = Candle
+0001f6b0: 5479 7065 2e66 726f 6d5f 7374 7269 6e67  Type.from_string
+0001f6c0: 2873 656c 662e 5f66 745f 6861 735b 226d  (self._ft_has["m
+0001f6d0: 6172 6b5f 6f68 6c63 765f 7072 6963 6522  ark_ohlcv_price"
+0001f6e0: 5d29 0a0a 2020 2020 2020 2020 6966 206e  ])..        if n
+0001f6f0: 6f74 2063 6c6f 7365 5f64 6174 653a 0a20  ot close_date:. 
+0001f700: 2020 2020 2020 2020 2020 2063 6c6f 7365             close
+0001f710: 5f64 6174 6520 3d20 6461 7465 7469 6d65  _date = datetime
+0001f720: 2e6e 6f77 2874 696d 657a 6f6e 652e 7574  .now(timezone.ut
+0001f730: 6329 0a20 2020 2020 2020 2073 696e 6365  c).        since
+0001f740: 5f6d 7320 3d20 6474 5f74 7328 7469 6d65  _ms = dt_ts(time
+0001f750: 6672 616d 655f 746f 5f70 7265 765f 6461  frame_to_prev_da
+0001f760: 7465 2874 696d 6566 7261 6d65 2c20 6f70  te(timeframe, op
+0001f770: 656e 5f64 6174 6529 290a 0a20 2020 2020  en_date))..     
+0001f780: 2020 206d 6172 6b5f 636f 6d62 3a20 5061     mark_comb: Pa
+0001f790: 6972 5769 7468 5469 6d65 6672 616d 6520  irWithTimeframe 
+0001f7a0: 3d20 2870 6169 722c 2074 696d 6566 7261  = (pair, timefra
+0001f7b0: 6d65 2c20 6d61 726b 5f70 7269 6365 5f74  me, mark_price_t
+0001f7c0: 7970 6529 0a20 2020 2020 2020 2066 756e  ype).        fun
+0001f7d0: 6469 6e67 5f63 6f6d 623a 2050 6169 7257  ding_comb: PairW
+0001f7e0: 6974 6854 696d 6566 7261 6d65 203d 2028  ithTimeframe = (
+0001f7f0: 7061 6972 2c20 7469 6d65 6672 616d 655f  pair, timeframe_
+0001f800: 6666 2c20 4361 6e64 6c65 5479 7065 2e46  ff, CandleType.F
+0001f810: 554e 4449 4e47 5f52 4154 4529 0a0a 2020  UNDING_RATE)..  
+0001f820: 2020 2020 2020 6361 6e64 6c65 5f68 6973        candle_his
+0001f830: 746f 7269 6573 203d 2073 656c 662e 7265  tories = self.re
+0001f840: 6672 6573 685f 6c61 7465 7374 5f6f 686c  fresh_latest_ohl
+0001f850: 6376 280a 2020 2020 2020 2020 2020 2020  cv(.            
+0001f860: 5b6d 6172 6b5f 636f 6d62 2c20 6675 6e64  [mark_comb, fund
+0001f870: 696e 675f 636f 6d62 5d2c 0a20 2020 2020  ing_comb],.     
+0001f880: 2020 2020 2020 2073 696e 6365 5f6d 733d         since_ms=
+0001f890: 7369 6e63 655f 6d73 2c0a 2020 2020 2020  since_ms,.      
+0001f8a0: 2020 2020 2020 6361 6368 653d 4661 6c73        cache=Fals
+0001f8b0: 652c 0a20 2020 2020 2020 2020 2020 2064  e,.            d
+0001f8c0: 726f 705f 696e 636f 6d70 6c65 7465 3d46  rop_incomplete=F
+0001f8d0: 616c 7365 2c0a 2020 2020 2020 2020 290a  alse,.        ).
+0001f8e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+0001f8f0: 2020 2020 2020 2020 2023 2077 6520 6361           # we ca
+0001f900: 6e27 7420 6173 7375 6d65 2077 6520 616c  n't assume we al
+0001f910: 7761 7973 2067 6574 2068 6973 746f 7269  ways get histori
+0001f920: 6573 202d 2066 6f72 2065 7861 6d70 6c65  es - for example
+0001f930: 2064 7572 696e 6720 6578 6368 616e 6765   during exchange
+0001f940: 2064 6f77 6e74 696d 6573 0a20 2020 2020   downtimes.     
+0001f950: 2020 2020 2020 2066 756e 6469 6e67 5f72         funding_r
+0001f960: 6174 6573 203d 2063 616e 646c 655f 6869  ates = candle_hi
+0001f970: 7374 6f72 6965 735b 6675 6e64 696e 675f  stories[funding_
+0001f980: 636f 6d62 5d0a 2020 2020 2020 2020 2020  comb].          
+0001f990: 2020 6d61 726b 5f72 6174 6573 203d 2063    mark_rates = c
+0001f9a0: 616e 646c 655f 6869 7374 6f72 6965 735b  andle_histories[
+0001f9b0: 6d61 726b 5f63 6f6d 625d 0a20 2020 2020  mark_comb].     
+0001f9c0: 2020 2065 7863 6570 7420 4b65 7945 7272     except KeyErr
+0001f9d0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+0001f9e0: 7261 6973 6520 4578 6368 616e 6765 4572  raise ExchangeEr
+0001f9f0: 726f 7228 2243 6f75 6c64 206e 6f74 2066  ror("Could not f
+0001fa00: 696e 6420 6675 6e64 696e 6720 7261 7465  ind funding rate
+0001fa10: 732e 2229 2066 726f 6d20 4e6f 6e65 0a0a  s.") from None..
+0001fa20: 2020 2020 2020 2020 6675 6e64 696e 675f          funding_
+0001fa30: 6d61 726b 5f72 6174 6573 203d 2073 656c  mark_rates = sel
+0001fa40: 662e 636f 6d62 696e 655f 6675 6e64 696e  f.combine_fundin
+0001fa50: 675f 616e 645f 6d61 726b 2866 756e 6469  g_and_mark(fundi
+0001fa60: 6e67 5f72 6174 6573 2c20 6d61 726b 5f72  ng_rates, mark_r
+0001fa70: 6174 6573 290a 0a20 2020 2020 2020 2072  ates)..        r
+0001fa80: 6574 7572 6e20 7365 6c66 2e63 616c 6375  eturn self.calcu
+0001fa90: 6c61 7465 5f66 756e 6469 6e67 5f66 6565  late_funding_fee
+0001faa0: 7328 0a20 2020 2020 2020 2020 2020 2066  s(.            f
+0001fab0: 756e 6469 6e67 5f6d 6172 6b5f 7261 7465  unding_mark_rate
+0001fac0: 732c 0a20 2020 2020 2020 2020 2020 2061  s,.            a
+0001fad0: 6d6f 756e 743d 616d 6f75 6e74 2c0a 2020  mount=amount,.  
+0001fae0: 2020 2020 2020 2020 2020 6973 5f73 686f            is_sho
+0001faf0: 7274 3d69 735f 7368 6f72 742c 0a20 2020  rt=is_short,.   
+0001fb00: 2020 2020 2020 2020 206f 7065 6e5f 6461           open_da
+0001fb10: 7465 3d6f 7065 6e5f 6461 7465 2c0a 2020  te=open_date,.  
+0001fb20: 2020 2020 2020 2020 2020 636c 6f73 655f            close_
+0001fb30: 6461 7465 3d63 6c6f 7365 5f64 6174 650a  date=close_date.
+0001fb40: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
+0001fb50: 7374 6174 6963 6d65 7468 6f64 0a20 2020  staticmethod.   
+0001fb60: 2064 6566 2063 6f6d 6269 6e65 5f66 756e   def combine_fun
+0001fb70: 6469 6e67 5f61 6e64 5f6d 6172 6b28 6675  ding_and_mark(fu
+0001fb80: 6e64 696e 675f 7261 7465 733a 2044 6174  nding_rates: Dat
+0001fb90: 6146 7261 6d65 2c20 6d61 726b 5f72 6174  aFrame, mark_rat
+0001fba0: 6573 3a20 4461 7461 4672 616d 652c 0a20  es: DataFrame,. 
+0001fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fbd0: 6675 7475 7265 735f 6675 6e64 696e 675f  futures_funding_
+0001fbe0: 7261 7465 3a20 4f70 7469 6f6e 616c 5b69  rate: Optional[i
+0001fbf0: 6e74 5d20 3d20 4e6f 6e65 2920 2d3e 2044  nt] = None) -> D
+0001fc00: 6174 6146 7261 6d65 3a0a 2020 2020 2020  ataFrame:.      
+0001fc10: 2020 2222 220a 2020 2020 2020 2020 436f    """.        Co
+0001fc20: 6d62 696e 6520 6675 6e64 696e 672d 7261  mbine funding-ra
+0001fc30: 7465 7320 616e 6420 6d61 726b 2d72 6174  tes and mark-rat
+0001fc40: 6573 2064 6174 6166 7261 6d65 730a 2020  es dataframes.  
+0001fc50: 2020 2020 2020 3a70 6172 616d 2066 756e        :param fun
+0001fc60: 6469 6e67 5f72 6174 6573 3a20 4461 7461  ding_rates: Data
+0001fc70: 6672 616d 6520 636f 6e74 6169 6e69 6e67  frame containing
+0001fc80: 2046 756e 6469 6e67 2072 6174 6573 2028   Funding rates (
+0001fc90: 5479 7065 2046 554e 4449 4e47 5f52 4154  Type FUNDING_RAT
+0001fca0: 4529 0a20 2020 2020 2020 203a 7061 7261  E).        :para
+0001fcb0: 6d20 6d61 726b 5f72 6174 6573 3a20 4461  m mark_rates: Da
+0001fcc0: 7461 6672 616d 6520 636f 6e74 6169 6e69  taframe containi
+0001fcd0: 6e67 204d 6172 6b20 7261 7465 7320 2854  ng Mark rates (T
+0001fce0: 7970 6520 6d61 726b 5f6f 686c 6376 5f70  ype mark_ohlcv_p
+0001fcf0: 7269 6365 290a 2020 2020 2020 2020 3a70  rice).        :p
+0001fd00: 6172 616d 2066 7574 7572 6573 5f66 756e  aram futures_fun
+0001fd10: 6469 6e67 5f72 6174 653a 2046 616b 6520  ding_rate: Fake 
+0001fd20: 6675 6e64 696e 6720 7261 7465 2074 6f20  funding rate to 
+0001fd30: 7573 6520 6966 2066 756e 6469 6e67 5f72  use if funding_r
+0001fd40: 6174 6573 2061 7265 206e 6f74 2061 7661  ates are not ava
+0001fd50: 696c 6162 6c65 0a20 2020 2020 2020 2022  ilable.        "
+0001fd60: 2222 0a20 2020 2020 2020 2069 6620 6675  "".        if fu
+0001fd70: 7475 7265 735f 6675 6e64 696e 675f 7261  tures_funding_ra
+0001fd80: 7465 2069 7320 4e6f 6e65 3a0a 2020 2020  te is None:.    
+0001fd90: 2020 2020 2020 2020 7265 7475 726e 206d          return m
+0001fda0: 6172 6b5f 7261 7465 732e 6d65 7267 6528  ark_rates.merge(
+0001fdb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fdc0: 2066 756e 6469 6e67 5f72 6174 6573 2c20   funding_rates, 
+0001fdd0: 6f6e 3d27 6461 7465 272c 2068 6f77 3d22  on='date', how="
+0001fde0: 696e 6e65 7222 2c20 7375 6666 6978 6573  inner", suffixes
+0001fdf0: 3d5b 225f 6d61 726b 222c 2022 5f66 756e  =["_mark", "_fun
+0001fe00: 6422 5d29 0a20 2020 2020 2020 2065 6c73  d"]).        els
+0001fe10: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0001fe20: 6620 6c65 6e28 6675 6e64 696e 675f 7261  f len(funding_ra
+0001fe30: 7465 7329 203d 3d20 303a 0a20 2020 2020  tes) == 0:.     
+0001fe40: 2020 2020 2020 2020 2020 2023 204e 6f20             # No 
+0001fe50: 6675 6e64 696e 6720 7261 7465 2063 616e  funding rate can
+0001fe60: 646c 6573 202d 2066 756c 6c20 6669 6c6c  dles - full fill
+0001fe70: 7570 2077 6974 6820 6661 6c6c 6261 636b  up with fallback
+0001fe80: 2076 6172 6961 626c 650a 2020 2020 2020   variable.      
+0001fe90: 2020 2020 2020 2020 2020 6d61 726b 5f72            mark_r
+0001fea0: 6174 6573 5b27 6f70 656e 5f66 756e 6427  ates['open_fund'
+0001feb0: 5d20 3d20 6675 7475 7265 735f 6675 6e64  ] = futures_fund
+0001fec0: 696e 675f 7261 7465 0a20 2020 2020 2020  ing_rate.       
+0001fed0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001fee0: 6d61 726b 5f72 6174 6573 2e72 656e 616d  mark_rates.renam
+0001fef0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0001ff00: 2020 2020 2020 2020 2020 2063 6f6c 756d             colum
+0001ff10: 6e73 3d7b 276f 7065 6e27 3a20 276f 7065  ns={'open': 'ope
+0001ff20: 6e5f 6d61 726b 272c 0a20 2020 2020 2020  n_mark',.       
+0001ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff40: 2020 2020 2020 2020 2020 2763 6c6f 7365            'close
+0001ff50: 273a 2027 636c 6f73 655f 6d61 726b 272c  ': 'close_mark',
+0001ff60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ff80: 2020 2768 6967 6827 3a20 2768 6967 685f    'high': 'high_
+0001ff90: 6d61 726b 272c 0a20 2020 2020 2020 2020  mark',.         
+0001ffa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ffb0: 2020 2020 2020 2020 276c 6f77 273a 2027          'low': '
+0001ffc0: 6c6f 775f 6d61 726b 272c 0a20 2020 2020  low_mark',.     
+0001ffd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ffe0: 2020 2020 2020 2020 2020 2020 2776 6f6c              'vol
+0001fff0: 756d 6527 3a20 2776 6f6c 756d 655f 6d61  ume': 'volume_ma
+00020000: 726b 277d 290a 0a20 2020 2020 2020 2020  rk'})..         
+00020010: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00020020: 2020 2020 2020 2020 2023 2046 696c 6c20           # Fill 
+00020030: 7570 206d 6973 7369 6e67 2066 756e 6469  up missing fundi
+00020040: 6e67 5f72 6174 6520 6361 6e64 6c65 7320  ng_rate candles 
+00020050: 7769 7468 2066 616c 6c62 6163 6b20 7661  with fallback va
+00020060: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
+00020070: 2020 2020 636f 6d62 696e 6564 203d 206d      combined = m
+00020080: 6172 6b5f 7261 7465 732e 6d65 7267 6528  ark_rates.merge(
+00020090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000200a0: 2020 2020 2066 756e 6469 6e67 5f72 6174       funding_rat
+000200b0: 6573 2c20 6f6e 3d27 6461 7465 272c 2068  es, on='date', h
+000200c0: 6f77 3d22 6c65 6674 222c 2073 7566 6669  ow="left", suffi
+000200d0: 7865 733d 5b22 5f6d 6172 6b22 2c20 225f  xes=["_mark", "_
+000200e0: 6675 6e64 225d 0a20 2020 2020 2020 2020  fund"].         
+000200f0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00020100: 2020 2020 2020 2020 2020 2020 2063 6f6d               com
+00020110: 6269 6e65 645b 276f 7065 6e5f 6675 6e64  bined['open_fund
+00020120: 275d 203d 2063 6f6d 6269 6e65 645b 276f  '] = combined['o
+00020130: 7065 6e5f 6675 6e64 275d 2e66 696c 6c6e  pen_fund'].filln
+00020140: 6128 6675 7475 7265 735f 6675 6e64 696e  a(futures_fundin
+00020150: 675f 7261 7465 290a 2020 2020 2020 2020  g_rate).        
+00020160: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00020170: 6f6d 6269 6e65 640a 0a20 2020 2064 6566  ombined..    def
+00020180: 2063 616c 6375 6c61 7465 5f66 756e 6469   calculate_fundi
+00020190: 6e67 5f66 6565 7328 0a20 2020 2020 2020  ng_fees(.       
+000201a0: 2073 656c 662c 0a20 2020 2020 2020 2064   self,.        d
+000201b0: 663a 2044 6174 6146 7261 6d65 2c0a 2020  f: DataFrame,.  
+000201c0: 2020 2020 2020 616d 6f75 6e74 3a20 666c        amount: fl
+000201d0: 6f61 742c 0a20 2020 2020 2020 2069 735f  oat,.        is_
+000201e0: 7368 6f72 743a 2062 6f6f 6c2c 0a20 2020  short: bool,.   
+000201f0: 2020 2020 206f 7065 6e5f 6461 7465 3a20       open_date: 
+00020200: 6461 7465 7469 6d65 2c0a 2020 2020 2020  datetime,.      
+00020210: 2020 636c 6f73 655f 6461 7465 3a20 6461    close_date: da
+00020220: 7465 7469 6d65 2c0a 2020 2020 2020 2020  tetime,.        
+00020230: 7469 6d65 5f69 6e5f 7261 7469 6f3a 204f  time_in_ratio: O
+00020240: 7074 696f 6e61 6c5b 666c 6f61 745d 203d  ptional[float] =
+00020250: 204e 6f6e 650a 2020 2020 2920 2d3e 2066   None.    ) -> f
+00020260: 6c6f 6174 3a0a 2020 2020 2020 2020 2222  loat:.        ""
+00020270: 220a 2020 2020 2020 2020 6361 6c63 756c  ".        calcul
+00020280: 6174 6573 2074 6865 2073 756d 206f 6620  ates the sum of 
+00020290: 616c 6c20 6675 6e64 696e 6720 6665 6573  all funding fees
+000202a0: 2074 6861 7420 6f63 6375 7272 6564 2066   that occurred f
+000202b0: 6f72 2061 2070 6169 7220 6475 7269 6e67  or a pair during
+000202c0: 2061 2066 7574 7572 6573 2074 7261 6465   a futures trade
+000202d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000202e0: 6466 3a20 4461 7461 6672 616d 6520 636f  df: Dataframe co
+000202f0: 6e74 6169 6e69 6e67 2063 6f6d 6269 6e65  ntaining combine
+00020300: 6420 6675 6e64 696e 6720 616e 6420 6d61  d funding and ma
+00020310: 726b 2072 6174 6573 0a20 2020 2020 2020  rk rates.       
+00020320: 2020 2020 2020 2020 2020 2020 6173 2060              as `
+00020330: 6f70 656e 5f66 756e 6460 2061 6e64 2060  open_fund` and `
+00020340: 6f70 656e 5f6d 6172 6b60 2e0a 2020 2020  open_mark`..    
+00020350: 2020 2020 3a70 6172 616d 2061 6d6f 756e      :param amoun
+00020360: 743a 2054 6865 2071 7561 6e74 6974 7920  t: The quantity 
+00020370: 6f66 2074 6865 2074 7261 6465 0a20 2020  of the trade.   
+00020380: 2020 2020 203a 7061 7261 6d20 6973 5f73       :param is_s
+00020390: 686f 7274 3a20 7472 6164 6520 6469 7265  hort: trade dire
+000203a0: 6374 696f 6e0a 2020 2020 2020 2020 3a70  ction.        :p
+000203b0: 6172 616d 206f 7065 6e5f 6461 7465 3a20  aram open_date: 
+000203c0: 5468 6520 6461 7465 2061 6e64 2074 696d  The date and tim
+000203d0: 6520 7468 6174 2074 6865 2074 7261 6465  e that the trade
+000203e0: 2073 7461 7274 6564 0a20 2020 2020 2020   started.       
+000203f0: 203a 7061 7261 6d20 636c 6f73 655f 6461   :param close_da
+00020400: 7465 3a20 5468 6520 6461 7465 2061 6e64  te: The date and
+00020410: 2074 696d 6520 7468 6174 2074 6865 2074   time that the t
+00020420: 7261 6465 2065 6e64 6564 0a20 2020 2020  rade ended.     
+00020430: 2020 203a 7061 7261 6d20 7469 6d65 5f69     :param time_i
+00020440: 6e5f 7261 7469 6f3a 204e 6f74 2075 7365  n_ratio: Not use
+00020450: 6420 6279 206d 6f73 7420 6578 6368 616e  d by most exchan
+00020460: 6765 2063 6c61 7373 6573 0a20 2020 2020  ge classes.     
+00020470: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00020480: 6565 733a 2066 6c6f 6174 203d 2030 0a0a  ees: float = 0..
+00020490: 2020 2020 2020 2020 6966 206e 6f74 2064          if not d
+000204a0: 662e 656d 7074 793a 0a20 2020 2020 2020  f.empty:.       
+000204b0: 2020 2020 2064 6631 203d 2064 665b 2864       df1 = df[(d
+000204c0: 665b 2764 6174 6527 5d20 3e3d 206f 7065  f['date'] >= ope
+000204d0: 6e5f 6461 7465 2920 2620 2864 665b 2764  n_date) & (df['d
+000204e0: 6174 6527 5d20 3c3d 2063 6c6f 7365 5f64  ate'] <= close_d
+000204f0: 6174 6529 5d0a 2020 2020 2020 2020 2020  ate)].          
+00020500: 2020 6665 6573 203d 2073 756d 2864 6631    fees = sum(df1
+00020510: 5b27 6f70 656e 5f66 756e 6427 5d20 2a20  ['open_fund'] * 
+00020520: 6466 315b 276f 7065 6e5f 6d61 726b 275d  df1['open_mark']
+00020530: 202a 2061 6d6f 756e 7429 0a20 2020 2020   * amount).     
+00020540: 2020 2069 6620 6973 6e61 6e28 6665 6573     if isnan(fees
+00020550: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+00020560: 6565 7320 3d20 302e 300a 2020 2020 2020  ees = 0.0.      
+00020570: 2020 2320 4e65 6761 7465 2066 6565 7320    # Negate fees 
+00020580: 666f 7220 6c6f 6e67 7320 6173 2066 756e  for longs as fun
+00020590: 6469 6e67 5f66 6565 7320 6578 7065 6374  ding_fees expect
+000205a0: 7320 6974 2074 6869 7320 7761 7920 6261  s it this way ba
+000205b0: 7365 6420 6f6e 206c 6976 6520 656e 6470  sed on live endp
+000205c0: 6f69 6e74 732e 0a20 2020 2020 2020 2072  oints..        r
+000205d0: 6574 7572 6e20 6665 6573 2069 6620 6973  eturn fees if is
+000205e0: 5f73 686f 7274 2065 6c73 6520 2d66 6565  _short else -fee
+000205f0: 730a 0a20 2020 2064 6566 2067 6574 5f66  s..    def get_f
+00020600: 756e 6469 6e67 5f66 6565 7328 0a20 2020  unding_fees(.   
+00020610: 2020 2020 2020 2020 2073 656c 662c 2070           self, p
+00020620: 6169 723a 2073 7472 2c20 616d 6f75 6e74  air: str, amount
+00020630: 3a20 666c 6f61 742c 2069 735f 7368 6f72  : float, is_shor
+00020640: 743a 2062 6f6f 6c2c 206f 7065 6e5f 6461  t: bool, open_da
+00020650: 7465 3a20 6461 7465 7469 6d65 2920 2d3e  te: datetime) ->
+00020660: 2066 6c6f 6174 3a0a 2020 2020 2020 2020   float:.        
+00020670: 2222 220a 2020 2020 2020 2020 4665 7463  """.        Fetc
+00020680: 6820 6675 6e64 696e 6720 6665 6573 2c20  h funding fees, 
+00020690: 6569 7468 6572 2066 726f 6d20 7468 6520  either from the 
+000206a0: 6578 6368 616e 6765 2028 6c69 7665 2920  exchange (live) 
+000206b0: 6f72 2063 616c 6375 6c61 7465 7320 7468  or calculates th
+000206c0: 656d 0a20 2020 2020 2020 2062 6173 6564  em.        based
+000206d0: 206f 6e20 6675 6e64 696e 6720 7261 7465   on funding rate
+000206e0: 2f6d 6172 6b20 7072 6963 6520 6869 7374  /mark price hist
+000206f0: 6f72 790a 2020 2020 2020 2020 3a70 6172  ory.        :par
+00020700: 616d 2070 6169 723a 2054 6865 2071 756f  am pair: The quo
+00020710: 7465 2f62 6173 6520 7061 6972 206f 6620  te/base pair of 
+00020720: 7468 6520 7472 6164 650a 2020 2020 2020  the trade.      
+00020730: 2020 3a70 6172 616d 2069 735f 7368 6f72    :param is_shor
+00020740: 743a 2074 7261 6465 2064 6972 6563 7469  t: trade directi
+00020750: 6f6e 0a20 2020 2020 2020 203a 7061 7261  on.        :para
+00020760: 6d20 616d 6f75 6e74 3a20 5472 6164 6520  m amount: Trade 
+00020770: 616d 6f75 6e74 0a20 2020 2020 2020 203a  amount.        :
+00020780: 7061 7261 6d20 6f70 656e 5f64 6174 653a  param open_date:
+00020790: 204f 7065 6e20 6461 7465 206f 6620 7468   Open date of th
+000207a0: 6520 7472 6164 650a 2020 2020 2020 2020  e trade.        
+000207b0: 3a72 6574 7572 6e3a 2066 756e 6469 6e67  :return: funding
+000207c0: 2066 6565 2073 696e 6365 206f 7065 6e5f   fee since open_
+000207d0: 6461 7465 0a20 2020 2020 2020 2022 2222  date.        """
+000207e0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000207f0: 2e74 7261 6469 6e67 5f6d 6f64 6520 3d3d  .trading_mode ==
+00020800: 2054 7261 6469 6e67 4d6f 6465 2e46 5554   TradingMode.FUT
+00020810: 5552 4553 3a0a 2020 2020 2020 2020 2020  URES:.          
+00020820: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00020830: 2020 2020 2020 2069 6620 7365 6c66 2e5f         if self._
+00020840: 636f 6e66 6967 5b27 6472 795f 7275 6e27  config['dry_run'
+00020850: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00020860: 2020 2020 2020 2066 756e 6469 6e67 5f66         funding_f
+00020870: 6565 7320 3d20 7365 6c66 2e5f 6665 7463  ees = self._fetc
+00020880: 685f 616e 645f 6361 6c63 756c 6174 655f  h_and_calculate_
+00020890: 6675 6e64 696e 675f 6665 6573 280a 2020  funding_fees(.  
+000208a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000208b0: 2020 2020 2020 7061 6972 2c20 616d 6f75        pair, amou
+000208c0: 6e74 2c20 6973 5f73 686f 7274 2c20 6f70  nt, is_short, op
+000208d0: 656e 5f64 6174 6529 0a20 2020 2020 2020  en_date).       
+000208e0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000208f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020900: 2020 2066 756e 6469 6e67 5f66 6565 7320     funding_fees 
+00020910: 3d20 7365 6c66 2e5f 6765 745f 6675 6e64  = self._get_fund
+00020920: 696e 675f 6665 6573 5f66 726f 6d5f 6578  ing_fees_from_ex
+00020930: 6368 616e 6765 2870 6169 722c 206f 7065  change(pair, ope
+00020940: 6e5f 6461 7465 290a 2020 2020 2020 2020  n_date).        
+00020950: 2020 2020 2020 2020 7265 7475 726e 2066          return f
+00020960: 756e 6469 6e67 5f66 6565 730a 2020 2020  unding_fees.    
+00020970: 2020 2020 2020 2020 6578 6365 7074 2045          except E
+00020980: 7863 6861 6e67 6545 7272 6f72 3a0a 2020  xchangeError:.  
+00020990: 2020 2020 2020 2020 2020 2020 2020 6c6f                lo
+000209a0: 6767 6572 2e77 6172 6e69 6e67 2866 2243  gger.warning(f"C
+000209b0: 6f75 6c64 206e 6f74 2075 7064 6174 6520  ould not update 
+000209c0: 6675 6e64 696e 6720 6665 6573 2066 6f72  funding fees for
+000209d0: 207b 7061 6972 7d2e 2229 0a0a 2020 2020   {pair}.")..    
+000209e0: 2020 2020 7265 7475 726e 2030 2e30 0a0a      return 0.0..
+000209f0: 2020 2020 6465 6620 6765 745f 6c69 7175      def get_liqu
+00020a00: 6964 6174 696f 6e5f 7072 6963 6528 0a20  idation_price(. 
+00020a10: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00020a20: 2020 2020 2070 6169 723a 2073 7472 2c0a       pair: str,.
+00020a30: 2020 2020 2020 2020 2320 4472 792d 7275          # Dry-ru
+00020a40: 6e0a 2020 2020 2020 2020 6f70 656e 5f72  n.        open_r
+00020a50: 6174 653a 2066 6c6f 6174 2c20 2020 2320  ate: float,   # 
+00020a60: 456e 7472 7920 7072 6963 6520 6f66 2070  Entry price of p
+00020a70: 6f73 6974 696f 6e0a 2020 2020 2020 2020  osition.        
+00020a80: 6973 5f73 686f 7274 3a20 626f 6f6c 2c0a  is_short: bool,.
+00020a90: 2020 2020 2020 2020 616d 6f75 6e74 3a20          amount: 
+00020aa0: 666c 6f61 742c 2020 2320 4162 736f 6c75  float,  # Absolu
+00020ab0: 7465 2076 616c 7565 206f 6620 706f 7369  te value of posi
+00020ac0: 7469 6f6e 2073 697a 650a 2020 2020 2020  tion size.      
+00020ad0: 2020 7374 616b 655f 616d 6f75 6e74 3a20    stake_amount: 
+00020ae0: 666c 6f61 742c 0a20 2020 2020 2020 206c  float,.        l
+00020af0: 6576 6572 6167 653a 2066 6c6f 6174 2c0a  everage: float,.
+00020b00: 2020 2020 2020 2020 7761 6c6c 6574 5f62          wallet_b
+00020b10: 616c 616e 6365 3a20 666c 6f61 742c 0a20  alance: float,. 
+00020b20: 2020 2020 2020 206d 6d5f 6578 5f31 3a20         mm_ex_1: 
+00020b30: 666c 6f61 7420 3d20 302e 302c 2020 2320  float = 0.0,  # 
+00020b40: 2842 696e 616e 6365 2920 4372 6f73 7320  (Binance) Cross 
+00020b50: 6f6e 6c79 0a20 2020 2020 2020 2075 706e  only.        upn
+00020b60: 6c5f 6578 5f31 3a20 666c 6f61 7420 3d20  l_ex_1: float = 
+00020b70: 302e 302c 2020 2320 2842 696e 616e 6365  0.0,  # (Binance
+00020b80: 2920 4372 6f73 7320 6f6e 6c79 0a20 2020  ) Cross only.   
+00020b90: 2029 202d 3e20 4f70 7469 6f6e 616c 5b66   ) -> Optional[f
+00020ba0: 6c6f 6174 5d3a 0a20 2020 2020 2020 2022  loat]:.        "
+00020bb0: 2222 0a20 2020 2020 2020 2053 6574 2773  "".        Set's
+00020bc0: 2074 6865 206d 6172 6769 6e20 6d6f 6465   the margin mode
+00020bd0: 206f 6e20 7468 6520 6578 6368 616e 6765   on the exchange
+00020be0: 2074 6f20 6372 6f73 7320 6f72 2069 736f   to cross or iso
+00020bf0: 6c61 7465 6420 666f 7220 6120 7370 6563  lated for a spec
+00020c00: 6966 6963 2070 6169 720a 2020 2020 2020  ific pair.      
+00020c10: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
+00020c20: 2073 656c 662e 7472 6164 696e 675f 6d6f   self.trading_mo
+00020c30: 6465 203d 3d20 5472 6164 696e 674d 6f64  de == TradingMod
+00020c40: 652e 5350 4f54 3a0a 2020 2020 2020 2020  e.SPOT:.        
+00020c50: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00020c60: 2020 2020 2020 2020 656c 6966 2028 7365          elif (se
+00020c70: 6c66 2e74 7261 6469 6e67 5f6d 6f64 6520  lf.trading_mode 
+00020c80: 213d 2054 7261 6469 6e67 4d6f 6465 2e46  != TradingMode.F
+00020c90: 5554 5552 4553 293a 0a20 2020 2020 2020  UTURES):.       
+00020ca0: 2020 2020 2072 6169 7365 204f 7065 7261       raise Opera
+00020cb0: 7469 6f6e 616c 4578 6365 7074 696f 6e28  tionalException(
+00020cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020cd0: 2066 227b 7365 6c66 2e6e 616d 657d 2064   f"{self.name} d
+00020ce0: 6f65 7320 6e6f 7420 7375 7070 6f72 7420  oes not support 
+00020cf0: 7b73 656c 662e 6d61 7267 696e 5f6d 6f64  {self.margin_mod
+00020d00: 657d 207b 7365 6c66 2e74 7261 6469 6e67  e} {self.trading
+00020d10: 5f6d 6f64 657d 2229 0a0a 2020 2020 2020  _mode}")..      
+00020d20: 2020 6c69 7175 6964 6174 696f 6e5f 7072    liquidation_pr
+00020d30: 6963 6520 3d20 4e6f 6e65 0a20 2020 2020  ice = None.     
+00020d40: 2020 2069 6620 7365 6c66 2e5f 636f 6e66     if self._conf
+00020d50: 6967 5b27 6472 795f 7275 6e27 5d20 6f72  ig['dry_run'] or
+00020d60: 206e 6f74 2073 656c 662e 6578 6368 616e   not self.exchan
+00020d70: 6765 5f68 6173 2822 6665 7463 6850 6f73  ge_has("fetchPos
+00020d80: 6974 696f 6e73 2229 3a0a 0a20 2020 2020  itions"):..     
+00020d90: 2020 2020 2020 206c 6971 7569 6461 7469         liquidati
+00020da0: 6f6e 5f70 7269 6365 203d 2073 656c 662e  on_price = self.
+00020db0: 6472 795f 7275 6e5f 6c69 7175 6964 6174  dry_run_liquidat
+00020dc0: 696f 6e5f 7072 6963 6528 0a20 2020 2020  ion_price(.     
+00020dd0: 2020 2020 2020 2020 2020 2070 6169 723d             pair=
+00020de0: 7061 6972 2c0a 2020 2020 2020 2020 2020  pair,.          
+00020df0: 2020 2020 2020 6f70 656e 5f72 6174 653d        open_rate=
+00020e00: 6f70 656e 5f72 6174 652c 0a20 2020 2020  open_rate,.     
+00020e10: 2020 2020 2020 2020 2020 2069 735f 7368             is_sh
+00020e20: 6f72 743d 6973 5f73 686f 7274 2c0a 2020  ort=is_short,.  
+00020e30: 2020 2020 2020 2020 2020 2020 2020 616d                am
+00020e40: 6f75 6e74 3d61 6d6f 756e 742c 0a20 2020  ount=amount,.   
+00020e50: 2020 2020 2020 2020 2020 2020 206c 6576               lev
+00020e60: 6572 6167 653d 6c65 7665 7261 6765 2c0a  erage=leverage,.
+00020e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020e80: 7374 616b 655f 616d 6f75 6e74 3d73 7461  stake_amount=sta
+00020e90: 6b65 5f61 6d6f 756e 742c 0a20 2020 2020  ke_amount,.     
+00020ea0: 2020 2020 2020 2020 2020 2077 616c 6c65             walle
+00020eb0: 745f 6261 6c61 6e63 653d 7761 6c6c 6574  t_balance=wallet
+00020ec0: 5f62 616c 616e 6365 2c0a 2020 2020 2020  _balance,.      
+00020ed0: 2020 2020 2020 2020 2020 6d6d 5f65 785f            mm_ex_
+00020ee0: 313d 6d6d 5f65 785f 312c 0a20 2020 2020  1=mm_ex_1,.     
+00020ef0: 2020 2020 2020 2020 2020 2075 706e 6c5f             upnl_
+00020f00: 6578 5f31 3d75 706e 6c5f 6578 5f31 0a20  ex_1=upnl_ex_1. 
+00020f10: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00020f20: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00020f30: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
+00020f40: 203d 2073 656c 662e 6665 7463 685f 706f   = self.fetch_po
+00020f50: 7369 7469 6f6e 7328 7061 6972 290a 2020  sitions(pair).  
+00020f60: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00020f70: 2870 6f73 6974 696f 6e73 2920 3e20 303a  (positions) > 0:
+00020f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020f90: 2070 6f73 203d 2070 6f73 6974 696f 6e73   pos = positions
+00020fa0: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+00020fb0: 2020 2020 6c69 7175 6964 6174 696f 6e5f      liquidation_
+00020fc0: 7072 6963 6520 3d20 706f 735b 276c 6971  price = pos['liq
+00020fd0: 7569 6461 7469 6f6e 5072 6963 6527 5d0a  uidationPrice'].
+00020fe0: 0a20 2020 2020 2020 2069 6620 6c69 7175  .        if liqu
+00020ff0: 6964 6174 696f 6e5f 7072 6963 6520 6973  idation_price is
+00021000: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+00021010: 2020 2020 2020 2062 7566 6665 725f 616d         buffer_am
+00021020: 6f75 6e74 203d 2061 6273 286f 7065 6e5f  ount = abs(open_
+00021030: 7261 7465 202d 206c 6971 7569 6461 7469  rate - liquidati
+00021040: 6f6e 5f70 7269 6365 2920 2a20 7365 6c66  on_price) * self
+00021050: 2e6c 6971 7569 6461 7469 6f6e 5f62 7566  .liquidation_buf
+00021060: 6665 720a 2020 2020 2020 2020 2020 2020  fer.            
+00021070: 6c69 7175 6964 6174 696f 6e5f 7072 6963  liquidation_pric
+00021080: 655f 6275 6666 6572 203d 2028 0a20 2020  e_buffer = (.   
+00021090: 2020 2020 2020 2020 2020 2020 206c 6971               liq
+000210a0: 7569 6461 7469 6f6e 5f70 7269 6365 202d  uidation_price -
+000210b0: 2062 7566 6665 725f 616d 6f75 6e74 0a20   buffer_amount. 
+000210c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000210d0: 6620 6973 5f73 686f 7274 2065 6c73 650a  f is_short else.
+000210e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000210f0: 6c69 7175 6964 6174 696f 6e5f 7072 6963  liquidation_pric
+00021100: 6520 2b20 6275 6666 6572 5f61 6d6f 756e  e + buffer_amoun
+00021110: 740a 2020 2020 2020 2020 2020 2020 290a  t.            ).
+00021120: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00021130: 726e 206d 6178 286c 6971 7569 6461 7469  rn max(liquidati
+00021140: 6f6e 5f70 7269 6365 5f62 7566 6665 722c  on_price_buffer,
+00021150: 2030 2e30 290a 2020 2020 2020 2020 656c   0.0).        el
+00021160: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00021170: 7265 7475 726e 204e 6f6e 650a 0a20 2020  return None..   
+00021180: 2064 6566 2064 7279 5f72 756e 5f6c 6971   def dry_run_liq
+00021190: 7569 6461 7469 6f6e 5f70 7269 6365 280a  uidation_price(.
+000211a0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000211b0: 2020 2020 2020 7061 6972 3a20 7374 722c        pair: str,
+000211c0: 0a20 2020 2020 2020 206f 7065 6e5f 7261  .        open_ra
+000211d0: 7465 3a20 666c 6f61 742c 2020 2023 2045  te: float,   # E
+000211e0: 6e74 7279 2070 7269 6365 206f 6620 706f  ntry price of po
+000211f0: 7369 7469 6f6e 0a20 2020 2020 2020 2069  sition.        i
+00021200: 735f 7368 6f72 743a 2062 6f6f 6c2c 0a20  s_short: bool,. 
+00021210: 2020 2020 2020 2061 6d6f 756e 743a 2066         amount: f
+00021220: 6c6f 6174 2c0a 2020 2020 2020 2020 7374  loat,.        st
+00021230: 616b 655f 616d 6f75 6e74 3a20 666c 6f61  ake_amount: floa
+00021240: 742c 0a20 2020 2020 2020 206c 6576 6572  t,.        lever
+00021250: 6167 653a 2066 6c6f 6174 2c0a 2020 2020  age: float,.    
+00021260: 2020 2020 7761 6c6c 6574 5f62 616c 616e      wallet_balan
+00021270: 6365 3a20 666c 6f61 742c 2020 2320 4f72  ce: float,  # Or
+00021280: 206d 6172 6769 6e20 6261 6c61 6e63 650a   margin balance.
+00021290: 2020 2020 2020 2020 6d6d 5f65 785f 313a          mm_ex_1:
+000212a0: 2066 6c6f 6174 203d 2030 2e30 2c20 2023   float = 0.0,  #
+000212b0: 2028 4269 6e61 6e63 6529 2043 726f 7373   (Binance) Cross
+000212c0: 206f 6e6c 790a 2020 2020 2020 2020 7570   only.        up
+000212d0: 6e6c 5f65 785f 313a 2066 6c6f 6174 203d  nl_ex_1: float =
+000212e0: 2030 2e30 2c20 2023 2028 4269 6e61 6e63   0.0,  # (Binanc
+000212f0: 6529 2043 726f 7373 206f 6e6c 790a 2020  e) Cross only.  
+00021300: 2020 2920 2d3e 204f 7074 696f 6e61 6c5b    ) -> Optional[
+00021310: 666c 6f61 745d 3a0a 2020 2020 2020 2020  float]:.        
+00021320: 2222 220a 2020 2020 2020 2020 496d 706f  """.        Impo
+00021330: 7274 616e 743a 204d 7573 7420 6265 2066  rtant: Must be f
+00021340: 6574 6368 696e 6720 6461 7461 2066 726f  etching data fro
+00021350: 6d20 6361 6368 6564 2076 616c 7565 7320  m cached values 
+00021360: 6173 2074 6869 7320 6973 2075 7365 6420  as this is used 
+00021370: 6279 2062 6163 6b74 6573 7469 6e67 210a  by backtesting!.
+00021380: 2020 2020 2020 2020 5045 5250 4554 5541          PERPETUA
+00021390: 4c3a 0a20 2020 2020 2020 2020 6761 7465  L:.         gate
+000213a0: 3a20 6874 7470 733a 2f2f 7777 772e 6761  : https://www.ga
+000213b0: 7465 2e69 6f2f 6865 6c70 2f66 7574 7572  te.io/help/futur
+000213c0: 6573 2f66 7574 7572 6573 2f32 3737 3234  es/futures/27724
+000213d0: 2f6c 6971 7569 6461 7469 6f6e 2d70 7269  /liquidation-pri
+000213e0: 6365 2d62 616e 6b72 7570 7463 792d 7072  ce-bankruptcy-pr
+000213f0: 6963 650a 2020 2020 2020 2020 203e 204c  ice.         > L
+00021400: 6971 7569 6461 7469 6f6e 2050 7269 6365  iquidation Price
+00021410: 203d 2028 456e 7472 7920 5072 6963 6520   = (Entry Price 
+00021420: c2b1 204d 6172 6769 6e20 2f20 436f 6e74  .. Margin / Cont
+00021430: 7261 6374 204d 756c 7469 706c 6965 7220  ract Multiplier 
+00021440: 2f20 5369 7a65 2920 2f0a 2020 2020 2020  / Size) /.      
+00021450: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021460: 2020 2020 2020 2020 2020 5b20 3120 c2b1            [ 1 ..
+00021470: 2028 4d61 696e 7465 6e61 6e63 6520 4d61   (Maintenance Ma
+00021480: 7267 696e 2052 6174 696f 202b 2054 616b  rgin Ratio + Tak
+00021490: 6572 2052 6174 6529 5d0a 2020 2020 2020  er Rate)].      
+000214a0: 2020 2020 2020 5768 6572 6569 6e2c 2022        Wherein, "
+000214b0: 2b22 206f 7220 222d 2220 6465 7065 6e64  +" or "-" depend
+000214c0: 7320 6f6e 2077 6865 7468 6572 2074 6865  s on whether the
+000214d0: 2063 6f6e 7472 6163 7420 676f 6573 206c   contract goes l
+000214e0: 6f6e 6720 6f72 2073 686f 7274 3a0a 2020  ong or short:.  
+000214f0: 2020 2020 2020 2020 2020 222d 2220 666f            "-" fo
+00021500: 7220 6c6f 6e67 2c20 616e 6420 222b 2220  r long, and "+" 
+00021510: 666f 7220 7368 6f72 742e 0a0a 2020 2020  for short...    
+00021520: 2020 2020 206f 6b65 783a 2068 7474 7073       okex: https
+00021530: 3a2f 2f77 7777 2e6f 6b65 782e 636f 6d2f  ://www.okex.com/
+00021540: 7375 7070 6f72 742f 6863 2f65 6e2d 7573  support/hc/en-us
+00021550: 2f61 7274 6963 6c65 732f 0a20 2020 2020  /articles/.     
+00021560: 2020 2020 2020 2033 3630 3035 3339 3039         360053909
+00021570: 3539 322d 5649 2d49 6e74 726f 6475 6374  592-VI-Introduct
+00021580: 696f 6e2d 746f 2d74 6865 2d69 736f 6c61  ion-to-the-isola
+00021590: 7465 642d 6d6f 6465 2d6f 662d 5369 6e67  ted-mode-of-Sing
+000215a0: 6c65 2d4d 756c 7469 2d63 7572 7265 6e63  le-Multi-currenc
+000215b0: 792d 506f 7274 666f 6c69 6f2d 6d61 7267  y-Portfolio-marg
+000215c0: 696e 0a0a 2020 2020 2020 2020 3a70 6172  in..        :par
+000215d0: 616d 2070 6169 723a 2050 6169 7220 746f  am pair: Pair to
+000215e0: 2063 616c 6375 6c61 7465 206c 6971 7569   calculate liqui
+000215f0: 6461 7469 6f6e 2070 7269 6365 2066 6f72  dation price for
+00021600: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00021610: 6f70 656e 5f72 6174 653a 2045 6e74 7279  open_rate: Entry
+00021620: 2070 7269 6365 206f 6620 706f 7369 7469   price of positi
+00021630: 6f6e 0a20 2020 2020 2020 203a 7061 7261  on.        :para
+00021640: 6d20 6973 5f73 686f 7274 3a20 5472 7565  m is_short: True
+00021650: 2069 6620 7468 6520 7472 6164 6520 6973   if the trade is
+00021660: 2061 2073 686f 7274 2c20 6661 6c73 6520   a short, false 
+00021670: 6f74 6865 7277 6973 650a 2020 2020 2020  otherwise.      
+00021680: 2020 3a70 6172 616d 2061 6d6f 756e 743a    :param amount:
+00021690: 2041 6273 6f6c 7574 6520 7661 6c75 6520   Absolute value 
+000216a0: 6f66 2070 6f73 6974 696f 6e20 7369 7a65  of position size
+000216b0: 2069 6e63 6c2e 206c 6576 6572 6167 6520   incl. leverage 
+000216c0: 2869 6e20 6261 7365 2063 7572 7265 6e63  (in base currenc
+000216d0: 7929 0a20 2020 2020 2020 203a 7061 7261  y).        :para
+000216e0: 6d20 7374 616b 655f 616d 6f75 6e74 3a20  m stake_amount: 
+000216f0: 5374 616b 6520 616d 6f75 6e74 202d 2043  Stake amount - C
+00021700: 6f6c 6c61 7465 7261 6c20 696e 2073 6574  ollateral in set
+00021710: 746c 6520 6375 7272 656e 6379 2e0a 2020  tle currency..  
+00021720: 2020 2020 2020 3a70 6172 616d 206c 6576        :param lev
+00021730: 6572 6167 653a 204c 6576 6572 6167 6520  erage: Leverage 
+00021740: 7573 6564 2066 6f72 2074 6869 7320 706f  used for this po
+00021750: 7369 7469 6f6e 2e0a 2020 2020 2020 2020  sition..        
+00021760: 3a70 6172 616d 2074 7261 6469 6e67 5f6d  :param trading_m
+00021770: 6f64 653a 2053 504f 542c 204d 4152 4749  ode: SPOT, MARGI
+00021780: 4e2c 2046 5554 5552 4553 2c20 6574 632e  N, FUTURES, etc.
+00021790: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000217a0: 6d61 7267 696e 5f6d 6f64 653a 2045 6974  margin_mode: Eit
+000217b0: 6865 7220 4953 4f4c 4154 4544 206f 7220  her ISOLATED or 
+000217c0: 4352 4f53 530a 2020 2020 2020 2020 3a70  CROSS.        :p
+000217d0: 6172 616d 2077 616c 6c65 745f 6261 6c61  aram wallet_bala
+000217e0: 6e63 653a 2041 6d6f 756e 7420 6f66 206d  nce: Amount of m
+000217f0: 6172 6769 6e5f 6d6f 6465 2069 6e20 7468  argin_mode in th
+00021800: 6520 7761 6c6c 6574 2062 6569 6e67 2075  e wallet being u
+00021810: 7365 6420 746f 2074 7261 6465 0a20 2020  sed to trade.   
+00021820: 2020 2020 2020 2020 2043 726f 7373 2d4d           Cross-M
+00021830: 6172 6769 6e20 4d6f 6465 3a20 6372 6f73  argin Mode: cros
+00021840: 7357 616c 6c65 7442 616c 616e 6365 0a20  sWalletBalance. 
+00021850: 2020 2020 2020 2020 2020 2049 736f 6c61             Isola
+00021860: 7465 642d 4d61 7267 696e 204d 6f64 653a  ted-Margin Mode:
+00021870: 2069 736f 6c61 7465 6457 616c 6c65 7442   isolatedWalletB
+00021880: 616c 616e 6365 0a0a 2020 2020 2020 2020  alance..        
+00021890: 2320 2a20 4e6f 7420 7265 7175 6972 6564  # * Not required
+000218a0: 2062 7920 4761 7465 206f 7220 4f4b 580a   by Gate or OKX.
+000218b0: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
+000218c0: 6d5f 6578 5f31 3a0a 2020 2020 2020 2020  m_ex_1:.        
+000218d0: 3a70 6172 616d 2075 706e 6c5f 6578 5f31  :param upnl_ex_1
+000218e0: 3a0a 2020 2020 2020 2020 2222 220a 0a20  :.        """.. 
+000218f0: 2020 2020 2020 206d 6172 6b65 7420 3d20         market = 
+00021900: 7365 6c66 2e6d 6172 6b65 7473 5b70 6169  self.markets[pai
+00021910: 725d 0a20 2020 2020 2020 2074 616b 6572  r].        taker
+00021920: 5f66 6565 5f72 6174 6520 3d20 6d61 726b  _fee_rate = mark
+00021930: 6574 5b27 7461 6b65 7227 5d0a 2020 2020  et['taker'].    
+00021940: 2020 2020 6d6d 5f72 6174 696f 2c20 5f20      mm_ratio, _ 
+00021950: 3d20 7365 6c66 2e67 6574 5f6d 6169 6e74  = self.get_maint
+00021960: 656e 616e 6365 5f72 6174 696f 5f61 6e64  enance_ratio_and
+00021970: 5f61 6d74 2870 6169 722c 2073 7461 6b65  _amt(pair, stake
+00021980: 5f61 6d6f 756e 7429 0a0a 2020 2020 2020  _amount)..      
+00021990: 2020 6966 2073 656c 662e 7472 6164 696e    if self.tradin
+000219a0: 675f 6d6f 6465 203d 3d20 5472 6164 696e  g_mode == Tradin
+000219b0: 674d 6f64 652e 4655 5455 5245 5320 616e  gMode.FUTURES an
+000219c0: 6420 7365 6c66 2e6d 6172 6769 6e5f 6d6f  d self.margin_mo
+000219d0: 6465 203d 3d20 4d61 7267 696e 4d6f 6465  de == MarginMode
+000219e0: 2e49 534f 4c41 5445 443a 0a0a 2020 2020  .ISOLATED:..    
+000219f0: 2020 2020 2020 2020 6966 206d 6172 6b65          if marke
+00021a00: 745b 2769 6e76 6572 7365 275d 3a0a 2020  t['inverse']:.  
+00021a10: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+00021a20: 6973 6520 4f70 6572 6174 696f 6e61 6c45  ise OperationalE
+00021a30: 7863 6570 7469 6f6e 280a 2020 2020 2020  xception(.      
+00021a40: 2020 2020 2020 2020 2020 2020 2020 2246                "F
+00021a50: 7265 7174 7261 6465 2064 6f65 7320 6e6f  reqtrade does no
+00021a60: 7420 7965 7420 7375 7070 6f72 7420 696e  t yet support in
+00021a70: 7665 7273 6520 636f 6e74 7261 6374 7322  verse contracts"
+00021a80: 290a 0a20 2020 2020 2020 2020 2020 2076  )..            v
+00021a90: 616c 7565 203d 2077 616c 6c65 745f 6261  alue = wallet_ba
+00021aa0: 6c61 6e63 6520 2f20 616d 6f75 6e74 0a0a  lance / amount..
+00021ab0: 2020 2020 2020 2020 2020 2020 6d6d 5f72              mm_r
+00021ac0: 6174 696f 5f74 616b 6572 203d 2028 6d6d  atio_taker = (mm
+00021ad0: 5f72 6174 696f 202b 2074 616b 6572 5f66  _ratio + taker_f
+00021ae0: 6565 5f72 6174 6529 0a20 2020 2020 2020  ee_rate).       
+00021af0: 2020 2020 2069 6620 6973 5f73 686f 7274       if is_short
+00021b00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00021b10: 2020 7265 7475 726e 2028 6f70 656e 5f72    return (open_r
+00021b20: 6174 6520 2b20 7661 6c75 6529 202f 2028  ate + value) / (
+00021b30: 3120 2b20 6d6d 5f72 6174 696f 5f74 616b  1 + mm_ratio_tak
+00021b40: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
+00021b50: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00021b60: 2020 2020 2020 7265 7475 726e 2028 6f70        return (op
+00021b70: 656e 5f72 6174 6520 2d20 7661 6c75 6529  en_rate - value)
+00021b80: 202f 2028 3120 2d20 6d6d 5f72 6174 696f   / (1 - mm_ratio
+00021b90: 5f74 616b 6572 290a 2020 2020 2020 2020  _taker).        
+00021ba0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00021bb0: 2020 7261 6973 6520 4f70 6572 6174 696f    raise Operatio
+00021bc0: 6e61 6c45 7863 6570 7469 6f6e 280a 2020  nalException(.  
+00021bd0: 2020 2020 2020 2020 2020 2020 2020 2246                "F
+00021be0: 7265 7174 7261 6465 206f 6e6c 7920 7375  reqtrade only su
+00021bf0: 7070 6f72 7473 2069 736f 6c61 7465 6420  pports isolated 
+00021c00: 6675 7475 7265 7320 666f 7220 6c65 7665  futures for leve
+00021c10: 7261 6765 2074 7261 6469 6e67 2229 0a0a  rage trading")..
+00021c20: 2020 2020 6465 6620 6765 745f 6d61 696e      def get_main
+00021c30: 7465 6e61 6e63 655f 7261 7469 6f5f 616e  tenance_ratio_an
+00021c40: 645f 616d 7428 0a20 2020 2020 2020 2073  d_amt(.        s
+00021c50: 656c 662c 0a20 2020 2020 2020 2070 6169  elf,.        pai
+00021c60: 723a 2073 7472 2c0a 2020 2020 2020 2020  r: str,.        
+00021c70: 6e6f 6d69 6e61 6c5f 7661 6c75 653a 2066  nominal_value: f
+00021c80: 6c6f 6174 2c0a 2020 2020 2920 2d3e 2054  loat,.    ) -> T
+00021c90: 7570 6c65 5b66 6c6f 6174 2c20 4f70 7469  uple[float, Opti
+00021ca0: 6f6e 616c 5b66 6c6f 6174 5d5d 3a0a 2020  onal[float]]:.  
+00021cb0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00021cc0: 2020 496d 706f 7274 616e 743a 204d 7573    Important: Mus
+00021cd0: 7420 6265 2066 6574 6368 696e 6720 6461  t be fetching da
+00021ce0: 7461 2066 726f 6d20 6361 6368 6564 2076  ta from cached v
+00021cf0: 616c 7565 7320 6173 2074 6869 7320 6973  alues as this is
+00021d00: 2075 7365 6420 6279 2062 6163 6b74 6573   used by backtes
+00021d10: 7469 6e67 210a 2020 2020 2020 2020 3a70  ting!.        :p
+00021d20: 6172 616d 2070 6169 723a 204d 6172 6b65  aram pair: Marke
+00021d30: 7420 7379 6d62 6f6c 0a20 2020 2020 2020  t symbol.       
+00021d40: 203a 7061 7261 6d20 6e6f 6d69 6e61 6c5f   :param nominal_
+00021d50: 7661 6c75 653a 2054 6865 2074 6f74 616c  value: The total
+00021d60: 2074 7261 6465 2061 6d6f 756e 7420 696e   trade amount in
+00021d70: 2071 756f 7465 2063 7572 7265 6e63 7920   quote currency 
+00021d80: 696e 636c 7564 696e 6720 6c65 7665 7261  including levera
+00021d90: 6765 0a20 2020 2020 2020 206d 6169 6e74  ge.        maint
+00021da0: 656e 616e 6365 2061 6d6f 756e 7420 6f6e  enance amount on
+00021db0: 6c79 206f 6e20 4269 6e61 6e63 650a 2020  ly on Binance.  
+00021dc0: 2020 2020 2020 3a72 6574 7572 6e3a 2028        :return: (
+00021dd0: 6d61 696e 7465 6e61 6e63 6520 6d61 7267  maintenance marg
+00021de0: 696e 2072 6174 696f 2c20 6d61 696e 7465  in ratio, mainte
+00021df0: 6e61 6e63 6520 616d 6f75 6e74 290a 2020  nance amount).  
+00021e00: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00021e10: 2020 2069 6620 2873 656c 662e 5f63 6f6e     if (self._con
+00021e20: 6669 672e 6765 7428 2772 756e 6d6f 6465  fig.get('runmode
+00021e30: 2729 2069 6e20 4f50 5449 4d49 5a45 5f4d  ') in OPTIMIZE_M
+00021e40: 4f44 4553 0a20 2020 2020 2020 2020 2020  ODES.           
+00021e50: 2020 2020 206f 7220 7365 6c66 2e65 7863       or self.exc
+00021e60: 6861 6e67 655f 6861 7328 2766 6574 6368  hange_has('fetch
+00021e70: 4c65 7665 7261 6765 5469 6572 7327 290a  LeverageTiers').
+00021e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00021e90: 6f72 2073 656c 662e 6578 6368 616e 6765  or self.exchange
+00021ea0: 5f68 6173 2827 6665 7463 684d 6172 6b65  _has('fetchMarke
+00021eb0: 744c 6576 6572 6167 6554 6965 7273 2729  tLeverageTiers')
+00021ec0: 293a 0a0a 2020 2020 2020 2020 2020 2020  ):..            
+00021ed0: 6966 2070 6169 7220 6e6f 7420 696e 2073  if pair not in s
+00021ee0: 656c 662e 5f6c 6576 6572 6167 655f 7469  elf._leverage_ti
+00021ef0: 6572 733a 0a20 2020 2020 2020 2020 2020  ers:.           
+00021f00: 2020 2020 2072 6169 7365 2049 6e76 616c       raise Inval
+00021f10: 6964 4f72 6465 7245 7863 6570 7469 6f6e  idOrderException
+00021f20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00021f30: 2020 2020 2020 6622 4d61 696e 7465 6e61        f"Maintena
+00021f40: 6e63 6520 6d61 7267 696e 2072 6174 6520  nce margin rate 
+00021f50: 666f 7220 7b70 6169 727d 2069 7320 756e  for {pair} is un
+00021f60: 6176 6169 6c61 626c 6520 666f 7220 7b73  available for {s
+00021f70: 656c 662e 6e61 6d65 7d22 0a20 2020 2020  elf.name}".     
+00021f80: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+00021f90: 2020 2020 2020 2020 2020 7061 6972 5f74            pair_t
+00021fa0: 6965 7273 203d 2073 656c 662e 5f6c 6576  iers = self._lev
+00021fb0: 6572 6167 655f 7469 6572 735b 7061 6972  erage_tiers[pair
+00021fc0: 5d0a 0a20 2020 2020 2020 2020 2020 2066  ]..            f
+00021fd0: 6f72 2074 6965 7220 696e 2072 6576 6572  or tier in rever
+00021fe0: 7365 6428 7061 6972 5f74 6965 7273 293a  sed(pair_tiers):
+00021ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022000: 2069 6620 6e6f 6d69 6e61 6c5f 7661 6c75   if nominal_valu
+00022010: 6520 3e3d 2074 6965 725b 276d 696e 4e6f  e >= tier['minNo
+00022020: 7469 6f6e 616c 275d 3a0a 2020 2020 2020  tional']:.      
+00022030: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00022040: 7475 726e 2028 7469 6572 5b27 6d61 696e  turn (tier['main
+00022050: 7465 6e61 6e63 654d 6172 6769 6e52 6174  tenanceMarginRat
+00022060: 6527 5d2c 2074 6965 725b 276d 6169 6e74  e'], tier['maint
+00022070: 416d 7427 5d29 0a0a 2020 2020 2020 2020  Amt'])..        
+00022080: 2020 2020 7261 6973 6520 4578 6368 616e      raise Exchan
+00022090: 6765 4572 726f 7228 226e 6f6d 696e 616c  geError("nominal
+000220a0: 2076 616c 7565 2063 616e 206e 6f74 2062   value can not b
+000220b0: 6520 6c6f 7765 7220 7468 616e 2030 2229  e lower than 0")
+000220c0: 0a20 2020 2020 2020 2020 2020 2023 2054  .            # T
+000220d0: 6865 206c 6f77 6573 7420 6e6f 7469 6f6e  he lowest notion
+000220e0: 616c 5f66 6c6f 6f72 2066 6f72 2061 6e79  al_floor for any
+000220f0: 2070 6169 7220 696e 2066 6574 6368 5f6c   pair in fetch_l
+00022100: 6576 6572 6167 655f 7469 6572 7320 6973  everage_tiers is
+00022110: 2061 6c77 6179 7320 3020 6265 6361 7573   always 0 becaus
+00022120: 6520 6974 0a20 2020 2020 2020 2020 2020  e it.           
+00022130: 2023 2064 6573 6372 6962 6573 2074 6865   # describes the
+00022140: 206d 696e 2061 6d74 2066 6f72 2061 2074   min amt for a t
+00022150: 6965 722c 2061 6e64 2074 6865 206c 6f77  ier, and the low
+00022160: 6573 7420 7469 6572 2077 696c 6c20 616c  est tier will al
+00022170: 7761 7973 2067 6f20 646f 776e 2074 6f20  ways go down to 
+00022180: 300a 2020 2020 2020 2020 656c 7365 3a0a  0.        else:.
+00022190: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000221a0: 6520 4578 6368 616e 6765 4572 726f 7228  e ExchangeError(
+000221b0: 6622 4361 6e6e 6f74 2067 6574 206d 6169  f"Cannot get mai
+000221c0: 6e74 656e 616e 6365 2072 6174 696f 2075  ntenance ratio u
+000221d0: 7369 6e67 207b 7365 6c66 2e6e 616d 657d  sing {self.name}
+000221e0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+000221f0: 6169 7365 2045 7863 6861 6e67 6545 7272  aise ExchangeErr
+00022200: 6f72 2866 2243 616e 6e6f 7420 6765 7420  or(f"Cannot get 
+00022210: 6d61 696e 7465 6e61 6e63 6520 7261 7469  maintenance rati
+00022220: 6f20 7573 696e 6720 7b73 656c 662e 6e61  o using {self.na
+00022230: 6d65 7d22 290a                           me}").
```

### Comparing `freqtrade-2024.3/freqtrade/exchange/exchange_utils.py` & `freqtrade-2024.4/freqtrade/exchange/exchange_utils.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/exchange_utils_timeframe.py` & `freqtrade-2024.4/freqtrade/exchange/exchange_utils_timeframe.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/gate.py` & `freqtrade-2024.4/freqtrade/exchange/gate.py`

 * *Files 3% similar despite different names*

```diff
@@ -75,15 +75,15 @@
         trades = super().get_trades_for_order(order_id, pair, since, params)
 
         if self.trading_mode == TradingMode.FUTURES:
             # Futures usually don't contain fees in the response.
             # As such, futures orders on gate will not contain a fee, which causes
             # a repeated "update fee" cycle and wrong calculations.
             # Therefore we patch the response with fees if it's not available.
-            # An alternative also contianing fees would be
+            # An alternative also containing fees would be
             # privateFuturesGetSettleAccountBook({"settle": "usdt"})
             pair_fees = self._trading_fees.get(pair, {})
             if pair_fees:
                 for idx, trade in enumerate(trades):
                     fee = trade.get('fee', {})
                     if fee and fee.get('cost') is None:
                         takerOrMaker = trade.get('takerOrMaker', 'taker')
@@ -94,15 +94,15 @@
                                 'rate': pair_fees[takerOrMaker],
                             }
         return trades
 
     def get_order_id_conditional(self, order: Dict[str, Any]) -> str:
         return safe_value_fallback2(order, order, 'id_stop', 'id')
 
-    def fetch_stoploss_order(self, order_id: str, pair: str, params: Dict = {}) -> Dict:
+    def fetch_stoploss_order(self, order_id: str, pair: str, params: Optional[Dict] = None) -> Dict:
         order = self.fetch_order(
             order_id=order_id,
             pair=pair,
             params={'stop': True}
         )
         if order.get('status', 'open') == 'closed':
             # Places a real order - which we need to fetch explicitly.
@@ -115,13 +115,14 @@
                 order1['type'] = 'stoploss'
                 order1['stopPrice'] = order.get('stopPrice')
                 order1['status_stop'] = 'triggered'
 
                 return order1
         return order
 
-    def cancel_stoploss_order(self, order_id: str, pair: str, params: Dict = {}) -> Dict:
+    def cancel_stoploss_order(
+            self, order_id: str, pair: str, params: Optional[Dict] = None) -> Dict:
         return self.cancel_order(
             order_id=order_id,
             pair=pair,
             params={'stop': True}
         )
```

### Comparing `freqtrade-2024.3/freqtrade/exchange/hitbtc.py` & `freqtrade-2024.4/freqtrade/exchange/hitbtc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/htx.py` & `freqtrade-2024.4/freqtrade/exchange/htx.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/kraken.py` & `freqtrade-2024.4/freqtrade/exchange/kraken.py`

 * *Files 2% similar despite different names*

```diff
@@ -80,15 +80,15 @@
                     continue
                 balances[bal]['used'] = sum(order[1] for order in order_list if order[0] == bal)
                 balances[bal]['free'] = balances[bal]['total'] - balances[bal]['used']
 
             return balances
         except ccxt.DDoSProtection as e:
             raise DDosProtection(e) from e
-        except (ccxt.NetworkError, ccxt.ExchangeError) as e:
+        except (ccxt.OperationFailed, ccxt.ExchangeError) as e:
             raise TemporaryError(
                 f'Could not get balance due to {e.__class__.__name__}. Message: {e}') from e
         except ccxt.BaseError as e:
             raise OperationalException(e) from e
 
     def _set_leverage(
         self,
```

### Comparing `freqtrade-2024.3/freqtrade/exchange/kucoin.py` & `freqtrade-2024.4/freqtrade/exchange/kucoin.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/exchange/okx.py` & `freqtrade-2024.4/freqtrade/exchange/okx.py`

 * *Files 2% similar despite different names*

```diff
@@ -52,15 +52,15 @@
     _ccxt_params: Dict = {'options': {'brokerId': 'ffb5405ad327SUDE'}}
 
     def ohlcv_candle_limit(
             self, timeframe: str, candle_type: CandleType, since_ms: Optional[int] = None) -> int:
         """
         Exchange ohlcv candle limit
         OKX has the following behaviour:
-        * 300 candles for uptodate data
+        * 300 candles for up-to-date data
         * 100 candles for historic data
         * 100 candles for additional candles (not futures or spot).
         :param timeframe: Timeframe to check
         :param candle_type: Candle-type
         :param since_ms: Starting timestamp
         :return: Candle limit as integer
         """
@@ -83,15 +83,15 @@
             if self.trading_mode == TradingMode.FUTURES and not self._config['dry_run']:
                 accounts = self._api.fetch_accounts()
                 self._log_exchange_response('fetch_accounts', accounts)
                 if len(accounts) > 0:
                     self.net_only = accounts[0].get('info', {}).get('posMode') == 'net_mode'
         except ccxt.DDoSProtection as e:
             raise DDosProtection(e) from e
-        except (ccxt.NetworkError, ccxt.ExchangeError) as e:
+        except (ccxt.OperationFailed, ccxt.ExchangeError) as e:
             raise TemporaryError(
                 f'Error in additional_exchange_init due to {e.__class__.__name__}. Message: {e}'
                 ) from e
         except ccxt.BaseError as e:
             raise OperationalException(e) from e
 
     def _get_posSide(self, side: BuySell, reduceOnly: bool):
@@ -149,15 +149,15 @@
                         "mgnMode": self.margin_mode.value,
                         "posSide": self._get_posSide(side, False),
                     })
                 self._log_exchange_response('set_leverage', res)
 
             except ccxt.DDoSProtection as e:
                 raise DDosProtection(e) from e
-            except (ccxt.NetworkError, ccxt.ExchangeError) as e:
+            except (ccxt.OperationFailed, ccxt.ExchangeError) as e:
                 already_set = self.__fetch_leverage_already_set(pair, leverage, side)
                 if not already_set:
                     raise TemporaryError(
                         f'Could not set leverage due to {e.__class__.__name__}. Message: {e}'
                         ) from e
             except ccxt.BaseError as e:
                 raise OperationalException(e) from e
@@ -198,15 +198,15 @@
             order_reg['type'] = 'stoploss'
             order_reg['status_stop'] = 'triggered'
             return order_reg
         order = self._order_contracts_to_amount(order)
         order['type'] = 'stoploss'
         return order
 
-    def fetch_stoploss_order(self, order_id: str, pair: str, params: Dict = {}) -> Dict:
+    def fetch_stoploss_order(self, order_id: str, pair: str, params: Optional[Dict] = None) -> Dict:
         if self._config['dry_run']:
             return self.fetch_dry_run_order(order_id)
 
         try:
             params1 = {'stop': True}
             order_reg = self._api.fetch_order(order_id, pair, params=params1)
             self._log_exchange_response('fetch_stoploss_order', order_reg)
@@ -228,15 +228,16 @@
                 f'StoplossOrder not found (pair: {pair} id: {order_id}).')
 
     def get_order_id_conditional(self, order: Dict[str, Any]) -> str:
         if order.get('type', '') == 'stop':
             return safe_value_fallback2(order, order, 'id_stop', 'id')
         return order['id']
 
-    def cancel_stoploss_order(self, order_id: str, pair: str, params: Dict = {}) -> Dict:
+    def cancel_stoploss_order(
+            self, order_id: str, pair: str, params: Optional[Dict] = None) -> Dict:
         params1 = {'stop': True}
         # 'ordType': 'conditional'
         #
         return self.cancel_order(
             order_id=order_id,
             pair=pair,
             params=params1,
```

### Comparing `freqtrade-2024.3/freqtrade/exchange/types.py` & `freqtrade-2024.4/freqtrade/exchange/types.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/RL/Base3ActionRLEnv.py` & `freqtrade-2024.4/freqtrade/freqai/RL/Base3ActionRLEnv.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/RL/Base4ActionRLEnv.py` & `freqtrade-2024.4/freqtrade/freqai/RL/Base4ActionRLEnv.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/RL/Base5ActionRLEnv.py` & `freqtrade-2024.4/freqtrade/freqai/RL/Base5ActionRLEnv.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/RL/BaseEnvironment.py` & `freqtrade-2024.4/freqtrade/freqai/RL/BaseEnvironment.py`

 * *Files 0% similar despite different names*

```diff
@@ -218,15 +218,15 @@
         self._total_unrealized_profit = 1
 
         return self._get_observation(), self.history
 
     @abstractmethod
     def step(self, action: int):
         """
-        Step depeneds on action types, this must be inherited.
+        Step depends on action types, this must be inherited.
         """
         return
 
     def _get_observation(self):
         """
         This may or may not be independent of action types, user can inherit
         this in their custom "MyRLEnv"
@@ -322,15 +322,15 @@
         :return:
         float = the reward to give to the agent for current step (used for optimization
             of weights in NN)
         """
 
     def _update_unrealized_total_profit(self):
         """
-        Update the unrealized total profit incase of episode end.
+        Update the unrealized total profit in case of episode end.
         """
         if self._position in (Positions.Long, Positions.Short):
             pnl = self.get_unrealized_profit()
             if self.compound_trades:
                 # assumes unit stake and compounding
                 unrl_profit = self._total_profit * (1 + pnl)
             else:
@@ -353,15 +353,15 @@
     def get_actions(self) -> Type[Enum]:
         """
         Used by SubprocVecEnv to get actions from
         initialized env for tensorboard callback
         """
         return self.actions
 
-    # Keeping around incase we want to start building more complex environment
+    # Keeping around in case we want to start building more complex environment
     # templates in the future.
     # def most_recent_return(self):
     #     """
     #     Calculate the tick to tick return if in a trade.
     #     Return is generated from rising prices in Long
     #     and falling prices in Short positions.
     #     The actions Sell/Buy or Hold during a Long position trigger the sell/buy-fee.
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/RL/BaseReinforcementLearningModel.py` & `freqtrade-2024.4/freqtrade/freqai/RL/BaseReinforcementLearningModel.py`

 * *Files 0% similar despite different names*

```diff
@@ -307,15 +307,15 @@
 
         prices_train = train_df.filter(rename_dict.keys(), axis=1)
         prices_train_old = train_df.filter(rename_dict_old.keys(), axis=1)
         if prices_train.empty or not prices_train_old.empty:
             if not prices_train_old.empty:
                 prices_train = prices_train_old
                 rename_dict = rename_dict_old
-            logger.warning('Reinforcement learning module didnt find the correct raw prices '
+            logger.warning('Reinforcement learning module didn\'t find the correct raw prices '
                            'assigned in feature_engineering_standard(). '
                            'Please assign them with:\n'
                            'dataframe["%-raw_close"] = dataframe["close"]\n'
                            'dataframe["%-raw_open"] = dataframe["open"]\n'
                            'dataframe["%-raw_high"] = dataframe["high"]\n'
                            'dataframe["%-raw_low"] = dataframe["low"]\n'
                            'inside `feature_engineering_standard()')
@@ -454,15 +454,15 @@
              seed: int, train_df: DataFrame, price: DataFrame,
              env_info: Dict[str, Any] = {}) -> Callable:
     """
     Utility function for multiprocessed env.
 
     :param env_id: (str) the environment ID
     :param num_env: (int) the number of environment you wish to have in subprocesses
-    :param seed: (int) the inital seed for RNG
+    :param seed: (int) the initial seed for RNG
     :param rank: (int) index of the subprocess
     :param env_info: (dict) all required arguments to instantiate the environment.
     :return: (Callable)
     """
 
     def _init() -> gym.Env:
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/base_models/BaseClassifierModel.py` & `freqtrade-2024.4/freqtrade/freqai/base_models/BaseClassifierModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/base_models/BasePyTorchClassifier.py` & `freqtrade-2024.4/freqtrade/freqai/base_models/BasePyTorchClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/base_models/BasePyTorchModel.py` & `freqtrade-2024.4/freqtrade/freqai/base_models/BasePyTorchModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/base_models/BasePyTorchRegressor.py` & `freqtrade-2024.4/freqtrade/freqai/base_models/BasePyTorchRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/base_models/BaseRegressionModel.py` & `freqtrade-2024.4/freqtrade/freqai/base_models/BaseRegressionModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py` & `freqtrade-2024.4/freqtrade/freqai/base_models/FreqaiMultiOutputClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py` & `freqtrade-2024.4/freqtrade/freqai/base_models/FreqaiMultiOutputRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/data_drawer.py` & `freqtrade-2024.4/freqtrade/freqai/data_drawer.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,13 +1,14 @@
 import collections
 import importlib
 import logging
 import re
 import shutil
 import threading
+import warnings
 from datetime import datetime, timedelta, timezone
 from pathlib import Path
 from typing import Any, Dict, Tuple, TypedDict
 
 import numpy as np
 import pandas as pd
 import psutil
@@ -258,59 +259,74 @@
         pair_in_dict = self.pair_dict.get(metadata["pair"])
         if pair_in_dict:
             return
         else:
             self.pair_dict[metadata["pair"]] = self.empty_pair_dict.copy()
             return
 
-    def set_initial_return_values(self, pair: str,
-                                  pred_df: DataFrame,
-                                  dataframe: DataFrame
-                                  ) -> None:
+    def set_initial_return_values(
+        self, pair: str,
+        pred_df: DataFrame,
+        dataframe: DataFrame
+    ) -> None:
         """
         Set the initial return values to the historical predictions dataframe. This avoids needing
         to repredict on historical candles, and also stores historical predictions despite
         retrainings (so stored predictions are true predictions, not just inferencing on trained
         data).
 
         We also aim to keep the date from historical predictions so that the FreqUI displays
         zeros during any downtime (between FreqAI reloads).
         """
 
         new_pred = pred_df.copy()
         # set new_pred values to nans (we want to signal to user that there was nothing
-        # historically made during downtime. The newest pred will get appeneded later in
+        # historically made during downtime. The newest pred will get appended later in
         # append_model_predictions)
-        new_pred.iloc[:, :] = np.nan
+
         new_pred["date_pred"] = dataframe["date"]
+        # set everything to nan except date_pred
+        columns_to_nan = new_pred.columns.difference(['date_pred', 'date'])
+        new_pred[columns_to_nan] = new_pred[columns_to_nan].astype(
+            float).values * np.nan
+
         hist_preds = self.historic_predictions[pair].copy()
 
         # ensure both dataframes have the same date format so they can be merged
         new_pred["date_pred"] = pd.to_datetime(new_pred["date_pred"])
         hist_preds["date_pred"] = pd.to_datetime(hist_preds["date_pred"])
 
         # find the closest common date between new_pred and historic predictions
         # and cut off the new_pred dataframe at that date
-        common_dates = pd.merge(new_pred, hist_preds, on="date_pred", how="inner")
+        common_dates = pd.merge(new_pred, hist_preds,
+                                on="date_pred", how="inner")
         if len(common_dates.index) > 0:
             new_pred = new_pred.iloc[len(common_dates):]
         else:
             logger.warning("No common dates found between new predictions and historic "
                            "predictions. You likely left your FreqAI instance offline "
                            f"for more than {len(dataframe.index)} candles.")
 
-        # reindex new_pred columns to match the historic predictions dataframe
-        new_pred_reindexed = new_pred.reindex(columns=hist_preds.columns)
-        df_concat = pd.concat([hist_preds, new_pred_reindexed], ignore_index=True)
+        # Pandas warns that its keeping dtypes of non NaN columns...
+        # yea we know and we already want that behavior. Ignoring.
+        with warnings.catch_warnings():
+            warnings.filterwarnings("ignore", category=FutureWarning)
+            # reindex new_pred columns to match the historic predictions dataframe
+            new_pred_reindexed = new_pred.reindex(columns=hist_preds.columns)
+            df_concat = pd.concat(
+                [hist_preds, new_pred_reindexed],
+                ignore_index=True
+            )
 
         # any missing values will get zeroed out so users can see the exact
         # downtime in FreqUI
         df_concat = df_concat.fillna(0)
         self.historic_predictions[pair] = df_concat
-        self.model_return_values[pair] = df_concat.tail(len(dataframe.index)).reset_index(drop=True)
+        self.model_return_values[pair] = df_concat.tail(
+            len(dataframe.index)).reset_index(drop=True)
 
     def append_model_predictions(self, pair: str, predictions: DataFrame,
                                  do_preds: NDArray[np.int_],
                                  dk: FreqaiDataKitchen, strat_df: DataFrame) -> None:
         """
         Append model predictions to historic predictions dataframe, then set the
         strategy return dataframe to the tail of the historic predictions. The length of
@@ -319,46 +335,64 @@
         historic predictions.
         """
 
         len_df = len(strat_df)
         index = self.historic_predictions[pair].index[-1:]
         columns = self.historic_predictions[pair].columns
 
-        zeros_df = pd.DataFrame(np.zeros((1, len(columns))), index=index, columns=columns)
+        zeros_df = pd.DataFrame(
+            np.zeros((1, len(columns))),
+            index=index,
+            columns=columns
+        )
         self.historic_predictions[pair] = pd.concat(
-            [self.historic_predictions[pair], zeros_df], ignore_index=True, axis=0)
+            [self.historic_predictions[pair], zeros_df],
+            ignore_index=True,
+            axis=0
+        )
         df = self.historic_predictions[pair]
 
         # model outputs and associated statistics
         for label in predictions.columns:
-            df[label].iloc[-1] = predictions[label].iloc[-1]
+            label_loc = df.columns.get_loc(label)
+            pred_label_loc = predictions.columns.get_loc(label)
+            df.iloc[-1, label_loc] = predictions.iloc[-1, pred_label_loc]
             if df[label].dtype == object:
                 continue
-            df[f"{label}_mean"].iloc[-1] = dk.data["labels_mean"][label]
-            df[f"{label}_std"].iloc[-1] = dk.data["labels_std"][label]
+            label_mean_loc = df.columns.get_loc(f"{label}_mean")
+            label_std_loc = df.columns.get_loc(f"{label}_std")
+            df.iloc[-1, label_mean_loc] = dk.data["labels_mean"][label]
+            df.iloc[-1, label_std_loc] = dk.data["labels_std"][label]
 
         # outlier indicators
-        df["do_predict"].iloc[-1] = do_preds[-1]
+        do_predict_loc = df.columns.get_loc("do_predict")
+        df.iloc[-1, do_predict_loc] = do_preds[-1]
         if self.freqai_info["feature_parameters"].get("DI_threshold", 0) > 0:
-            df["DI_values"].iloc[-1] = dk.DI_values[-1]
+            DI_values_loc = df.columns.get_loc("DI_values")
+            df.iloc[-1, DI_values_loc] = dk.DI_values[-1]
 
         # extra values the user added within custom prediction model
         if dk.data['extra_returns_per_train']:
             rets = dk.data['extra_returns_per_train']
             for return_str in rets:
-                df[return_str].iloc[-1] = rets[return_str]
-
-        # this logic carries users between version without needing to
-        # change their identifier
-        if 'close_price' not in df.columns:
-            df['close_price'] = np.nan
-            df['date_pred'] = np.nan
+                return_loc = df.columns.get_loc(return_str)
+                df.iloc[-1, return_loc] = rets[return_str]
 
-        df['close_price'].iloc[-1] = strat_df['close'].iloc[-1]
-        df['date_pred'].iloc[-1] = strat_df['date'].iloc[-1]
+        high_price_loc = df.columns.get_loc("high_price")
+        high_loc = strat_df.columns.get_loc("high")
+        df.iloc[-1, high_price_loc] = strat_df.iloc[-1, high_loc]
+        low_price_loc = df.columns.get_loc("low_price")
+        low_loc = strat_df.columns.get_loc("low")
+        df.iloc[-1, low_price_loc] = strat_df.iloc[-1, low_loc]
+        close_price_loc = df.columns.get_loc("close_price")
+        close_loc = strat_df.columns.get_loc("close")
+        df.iloc[-1, close_price_loc] = strat_df.iloc[-1, close_loc]
+        date_pred_loc = df.columns.get_loc("date_pred")
+        date_loc = strat_df.columns.get_loc("date")
+        df.iloc[-1, date_pred_loc] = strat_df.iloc[-1, date_loc]
 
         self.model_return_values[pair] = df.tail(len_df).reset_index(drop=True)
 
     def attach_return_values_to_return_dataframe(
             self, pair: str, dataframe: DataFrame) -> DataFrame:
         """
         Attach the return values to the strat dataframe
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/data_kitchen.py` & `freqtrade-2024.4/freqtrade/freqai/data_kitchen.py`

 * *Files 2% similar despite different names*

```diff
@@ -20,14 +20,16 @@
 from freqtrade.data.converter import reduce_dataframe_footprint
 from freqtrade.exceptions import OperationalException
 from freqtrade.exchange import timeframe_to_seconds
 from freqtrade.strategy import merge_informative_pair
 from freqtrade.strategy.interface import IStrategy
 
 
+pd.set_option('future.no_silent_downcasting', True)
+
 SECONDS_IN_DAY = 86400
 SECONDS_IN_HOUR = 3600
 
 logger = logging.getLogger(__name__)
 
 
 class FreqaiDataKitchen:
@@ -217,23 +219,25 @@
         requested feature set.
         :labels: labels cleaned of NaNs.
         """
         filtered_df = unfiltered_df.filter(training_feature_list, axis=1)
         filtered_df = filtered_df.replace([np.inf, -np.inf], np.nan)
 
         drop_index = pd.isnull(filtered_df).any(axis=1)  # get the rows that have NaNs,
-        drop_index = drop_index.replace(True, 1).replace(False, 0)  # pep8 requirement.
+        drop_index = drop_index.replace(True, 1).replace(False, 0).infer_objects(copy=False)
         if (training_filter):
 
             # we don't care about total row number (total no. datapoints) in training, we only care
             # about removing any row with NaNs
             # if labels has multiple columns (user wants to train multiple modelEs), we detect here
             labels = unfiltered_df.filter(label_list, axis=1)
             drop_index_labels = pd.isnull(labels).any(axis=1)
-            drop_index_labels = drop_index_labels.replace(True, 1).replace(False, 0)
+            drop_index_labels = drop_index_labels.replace(
+                True, 1
+            ).replace(False, 0).infer_objects(copy=False)
             dates = unfiltered_df['date']
             filtered_df = filtered_df[
                 (drop_index == 0) & (drop_index_labels == 0)
             ]  # dropping values
             labels = labels[
                 (drop_index == 0) & (drop_index_labels == 0)
             ]  # assuming the labels depend entirely on the dataframe here.
@@ -604,15 +608,15 @@
         :return: corr_dataframes, dictionary of dataframes to be attached
                  to other pairs in same candle.
         """
         corr_dataframes: Dict[str, DataFrame] = {}
         pairs = self.freqai_config["feature_parameters"].get("include_corr_pairlist", [])
 
         for pair in pairs:
-            pair = pair.replace(':', '')  # lightgbm doesnt like colons
+            pair = pair.replace(':', '')  # lightgbm does not like colons
             pair_cols = [col for col in dataframe.columns if col.startswith("%")
                          and f"{pair}_" in col]
 
             if pair_cols:
                 pair_cols.insert(0, 'date')
                 corr_dataframes[pair] = dataframe.filter(pair_cols, axis=1)
 
@@ -630,15 +634,15 @@
         :return:
         :dataframe: current pair dataframe of populated indicators, concatenated with corr_pairs
                     ready for training
         """
         pairs = self.freqai_config["feature_parameters"].get("include_corr_pairlist", [])
         current_pair = current_pair.replace(':', '')
         for pair in pairs:
-            pair = pair.replace(':', '')  # lightgbm doesnt work with colons
+            pair = pair.replace(':', '')  # lightgbm does not work with colons
             if current_pair != pair:
                 dataframe = dataframe.merge(corr_dataframes[pair], how='left', on='date')
 
         return dataframe
 
     def get_pair_data_for_features(self,
                                    pair: str,
@@ -833,15 +837,15 @@
         self.data["labels_mean"], self.data["labels_std"] = {}, {}
         for label in self.data_dictionary["train_labels"].columns:
             if self.data_dictionary["train_labels"][label].dtype == object:
                 continue
             f = spy.stats.norm.fit(self.data_dictionary["train_labels"][label])
             self.data["labels_mean"][label], self.data["labels_std"][label] = f[0], f[1]
 
-        # incase targets are classifications
+        # in case targets are classifications
         for label in self.unique_class_list:
             self.data["labels_mean"][label], self.data["labels_std"][label] = 0, 0
 
         return
 
     def remove_features_from_df(self, dataframe: DataFrame) -> DataFrame:
         """
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/freqai_interface.py` & `freqtrade-2024.4/freqtrade/freqai/freqai_interface.py`

 * *Files 1% similar despite different names*

```diff
@@ -218,15 +218,15 @@
         it simply trains on what ever data is available in the self.dd.
         :param strategy: IStrategy = The user defined strategy class
         """
         while not self._stop_event.is_set():
             time.sleep(1)
             pair = self.train_queue[0]
 
-            # ensure pair is avaialble in dp
+            # ensure pair is available in dp
             if pair not in strategy.dp.current_whitelist():
                 self.train_queue.popleft()
                 logger.warning(f'{pair} not in current whitelist, removing from train queue.')
                 continue
 
             (_, trained_timestamp) = self.dd.get_pair_dict_info(pair)
 
@@ -671,14 +671,16 @@
 
         if self.freqai_info['feature_parameters'].get('DI_threshold', 0) > 0:
             hist_preds_df['DI_values'] = 0
 
         for return_str in dk.data['extra_returns_per_train']:
             hist_preds_df[return_str] = dk.data['extra_returns_per_train'][return_str]
 
+        hist_preds_df['high_price'] = strat_df['high']
+        hist_preds_df['low_price'] = strat_df['low']
         hist_preds_df['close_price'] = strat_df['close']
         hist_preds_df['date_pred'] = strat_df['date']
 
     def fit_live_predictions(self, dk: FreqaiDataKitchen, pair: str) -> None:
         """
         Fit the labels with a gaussian distribution
         """
@@ -712,17 +714,14 @@
             time_spent = (end - self.begin_time)
             if self.freqai_info.get('write_metrics_to_disk', False):
                 self.dd.update_metric_tracker('inference_time', time_spent, pair)
             self.inference_time += time_spent
             if self.pair_it == self.total_pairs:
                 logger.info(
                     f'Total time spent inferencing pairlist {self.inference_time:.2f} seconds')
-                if self.inference_time > 0.25 * self.base_tf_seconds:
-                    logger.warning("Inference took over 25% of the candle time. Reduce pairlist to"
-                                   " avoid blinding open trades and degrading performance.")
                 self.pair_it = 0
                 self.inference_time = 0
         return
 
     def train_timer(self, do: Literal['start', 'stop'] = 'start', pair: str = ''):
         """
         Timer designed to track the cumulative time spent training the full pairlist in
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/CatboostClassifier.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/CatboostClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/CatboostClassifierMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/CatboostRegressor.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/CatboostRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/CatboostRegressorMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/LightGBMClassifier.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/LightGBMClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/LightGBMClassifierMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/LightGBMRegressor.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/LightGBMRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/LightGBMRegressorMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/PyTorchMLPClassifier.py`

 * *Files 1% similar despite different names*

```diff
@@ -70,15 +70,15 @@
             input_dim=n_features,
             output_dim=len(class_names),
             **self.model_kwargs
         )
         model.to(self.device)
         optimizer = torch.optim.AdamW(model.parameters(), lr=self.learning_rate)
         criterion = torch.nn.CrossEntropyLoss()
-        # check if continual_learning is activated, and retreive the model to continue training
+        # check if continual_learning is activated, and retrieve the model to continue training
         trainer = self.get_init_model(dk.pair)
         if trainer is None:
             trainer = PyTorchModelTrainer(
                 model=model,
                 optimizer=optimizer,
                 criterion=criterion,
                 model_meta_data={"class_names": class_names},
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/PyTorchMLPRegressor.py`

 * *Files 2% similar despite different names*

```diff
@@ -65,15 +65,15 @@
             input_dim=n_features,
             output_dim=1,
             **self.model_kwargs
         )
         model.to(self.device)
         optimizer = torch.optim.AdamW(model.parameters(), lr=self.learning_rate)
         criterion = torch.nn.MSELoss()
-        # check if continual_learning is activated, and retreive the model to continue training
+        # check if continual_learning is activated, and retrieve the model to continue training
         trainer = self.get_init_model(dk.pair)
         if trainer is None:
             trainer = PyTorchModelTrainer(
                 model=model,
                 optimizer=optimizer,
                 criterion=criterion,
                 device=self.device,
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/PyTorchTransformerRegressor.py`

 * *Files 2% similar despite different names*

```diff
@@ -76,15 +76,15 @@
             output_dim=n_labels,
             time_window=self.window_size,
             **self.model_kwargs
         )
         model.to(self.device)
         optimizer = torch.optim.AdamW(model.parameters(), lr=self.learning_rate)
         criterion = torch.nn.MSELoss()
-        # check if continual_learning is activated, and retreive the model to continue training
+        # check if continual_learning is activated, and retrieve the model to continue training
         trainer = self.get_init_model(dk.pair)
         if trainer is None:
             trainer = PyTorchTransformerTrainer(
                 model=model,
                 optimizer=optimizer,
                 criterion=criterion,
                 device=self.device,
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/ReinforcementLearner.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/ReinforcementLearner.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/ReinforcementLearner_multiproc.py`

 * *Files 2% similar despite different names*

```diff
@@ -59,10 +59,10 @@
         self.eval_callback = MaskableEvalCallback(self.eval_env, deterministic=True,
                                                   render=False, eval_freq=eval_freq,
                                                   best_model_save_path=str(dk.data_path),
                                                   use_masking=(self.model_type == 'MaskablePPO' and
                                                                is_masking_supported(self.eval_env)))
 
         # TENSORBOARD CALLBACK DOES NOT RECOMMENDED TO USE WITH MULTIPLE ENVS,
-        # IT WILL RETURN FALSE INFORMATIONS, NEVERTHLESS NOT THREAD SAFE WITH SB3!!!
+        # IT WILL RETURN FALSE INFORMATION, NEVERTHELESS NOT THREAD SAFE WITH SB3!!!
         actions = self.train_env.env_method("get_actions")[0]
         self.tensorboard_callback = TensorboardCallback(verbose=1, actions=actions)
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/SKLearnRandomForestClassifier.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/SKLearnRandomForestClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostClassifier.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostRFClassifier.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostRFRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostRegressor.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostRegressor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py` & `freqtrade-2024.4/freqtrade/freqai/prediction_models/XGBoostRegressorMultiTarget.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/tensorboard/TensorboardCallback.py` & `freqtrade-2024.4/freqtrade/freqai/tensorboard/TensorboardCallback.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/tensorboard/__init__.py` & `freqtrade-2024.4/freqtrade/freqai/tensorboard/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/tensorboard/base_tensorboard.py` & `freqtrade-2024.4/freqtrade/freqai/tensorboard/base_tensorboard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/tensorboard/tensorboard.py` & `freqtrade-2024.4/freqtrade/freqai/tensorboard/tensorboard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/torch/PyTorchDataConvertor.py` & `freqtrade-2024.4/freqtrade/freqai/torch/PyTorchDataConvertor.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/torch/PyTorchMLPModel.py` & `freqtrade-2024.4/freqtrade/freqai/torch/PyTorchMLPModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/torch/PyTorchModelTrainer.py` & `freqtrade-2024.4/freqtrade/freqai/torch/PyTorchModelTrainer.py`

 * *Files 1% similar despite different names*

```diff
@@ -34,15 +34,15 @@
         :param model: The PyTorch model to be trained.
         :param optimizer: The optimizer to use for training.
         :param criterion: The loss function to use for training.
         :param device: The device to use for training (e.g. 'cpu', 'cuda').
         :param init_model: A dictionary containing the initial model/optimizer
             state_dict and model_meta_data saved by self.save() method.
         :param model_meta_data: Additional metadata about the model (optional).
-        :param data_convertor: convertor from pd.DataFrame to torch.tensor.
+        :param data_convertor: converter from pd.DataFrame to torch.tensor.
         :param n_steps: used to calculate n_epochs. The number of training iterations to run.
             iteration here refers to the number of times optimizer.step() is called.
             ignored if n_epochs is set.
         :param n_epochs: The maximum number batches to use for evaluation.
         :param batch_size: The size of the batches to use during training.
         """
         self.model = model
```

### Comparing `freqtrade-2024.3/freqtrade/freqai/torch/PyTorchTrainerInterface.py` & `freqtrade-2024.4/freqtrade/freqai/torch/PyTorchTrainerInterface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/torch/PyTorchTransformerModel.py` & `freqtrade-2024.4/freqtrade/freqai/torch/PyTorchTransformerModel.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/torch/datasets.py` & `freqtrade-2024.4/freqtrade/freqai/torch/datasets.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/freqai/utils.py` & `freqtrade-2024.4/freqtrade/freqai/utils.py`

 * *Files 0% similar despite different names*

```diff
@@ -174,15 +174,15 @@
             default=str,
             number_mode=rapidjson.NM_NATIVE | rapidjson.NM_NAN
         )
 
 
 def get_timerange_backtest_live_models(config: Config) -> str:
     """
-    Returns a formated timerange for backtest live/ready models
+    Returns a formatted timerange for backtest live/ready models
     :param config: Configuration dictionary
 
     :return: a string timerange (format example: '20220801-20220822')
     """
     dk = FreqaiDataKitchen(config)
     models_path = dk.get_full_models_path(config)
     dd = FreqaiDataDrawer(models_path, config)
```

### Comparing `freqtrade-2024.3/freqtrade/freqtradebot.py` & `freqtrade-2024.4/freqtrade/freqtradebot.py`

 * *Files 0% similar despite different names*

```diff
@@ -33,14 +33,15 @@
 from freqtrade.resolvers import ExchangeResolver, StrategyResolver
 from freqtrade.rpc import RPCManager
 from freqtrade.rpc.external_message_consumer import ExternalMessageConsumer
 from freqtrade.rpc.rpc_types import (ProfitLossStr, RPCCancelMsg, RPCEntryMsg, RPCExitCancelMsg,
                                      RPCExitMsg, RPCProtectionMsg)
 from freqtrade.strategy.interface import IStrategy
 from freqtrade.strategy.strategy_wrapper import strategy_safe_wrapper
+from freqtrade.util import MeasureTime
 from freqtrade.util.migrations import migrate_binance_futures_names
 from freqtrade.wallets import Wallets
 
 
 logger = logging.getLogger(__name__)
 
 
@@ -60,15 +61,15 @@
 
         # Init bot state
         self.state = State.STOPPED
 
         # Init objects
         self.config = config
         exchange_config: ExchangeConfig = deepcopy(config['exchange'])
-        # Remove credentials from original exchange config to avoid accidental credentail exposure
+        # Remove credentials from original exchange config to avoid accidental credential exposure
         remove_exchange_credentials(config['exchange'], True)
 
         self.strategy: IStrategy = StrategyResolver.load_strategy(self.config)
 
         # Check config consistency here since strategies can set certain options
         validate_config_consistency(config)
 
@@ -113,15 +114,16 @@
 
         # Set initial bot state from config
         initial_state = self.config.get('initial_state')
         self.state = State[initial_state.upper()] if initial_state else State.STOPPED
 
         # Protect exit-logic from forcesell and vice versa
         self._exit_lock = Lock()
-        LoggingMixin.__init__(self, logger, timeframe_to_seconds(self.strategy.timeframe))
+        timeframe_secs = timeframe_to_seconds(self.strategy.timeframe)
+        LoggingMixin.__init__(self, logger, timeframe_secs)
 
         self._schedule = Scheduler()
 
         if self.trading_mode == TradingMode.FUTURES:
 
             def update():
                 self.update_funding_fees()
@@ -135,14 +137,24 @@
                     t = str(time(time_slot, minutes, 2))
                     self._schedule.every().day.at(t).do(update)
 
         self.strategy.ft_bot_start()
         # Initialize protections AFTER bot start - otherwise parameters are not loaded.
         self.protections = ProtectionManager(self.config, self.strategy.protections)
 
+        def log_took_too_long(duration: float, time_limit: float):
+            logger.warning(
+                f"Strategy analysis took {duration:.2f}, which is 25% of the timeframe. "
+                "This can lead to delayed orders and missed signals."
+                "Consider either reducing the amount of work your strategy performs "
+                "or reduce the amount of pairs in the Pairlist."
+            )
+
+        self._measure_execution = MeasureTime(log_took_too_long, timeframe_secs * 0.25)
+
     def notify_status(self, msg: str, msg_type=RPCMessageType.STATUS) -> None:
         """
         Public method for users of this class (worker, etc.) to send notifications
         via RPC about changes in the bot status.
         """
         self.rpc.send_msg({
             'type': msg_type,
@@ -171,15 +183,15 @@
         self.rpc.cleanup()
         if self.emc:
             self.emc.shutdown()
         self.exchange.close()
         try:
             Trade.commit()
         except Exception:
-            # Exeptions here will be happening if the db disappeared.
+            # Exceptions here will be happening if the db disappeared.
             # At which point we can no longer commit anyway.
             pass
 
     def startup(self) -> None:
         """
         Called on startup and after reloading the bot - triggers notifications and
         performs startup tasks
@@ -219,34 +231,35 @@
         # Refreshing candles
         self.dataprovider.refresh(self.pairlists.create_pair_list(self.active_pair_whitelist),
                                   self.strategy.gather_informative_pairs())
 
         strategy_safe_wrapper(self.strategy.bot_loop_start, supress_error=True)(
             current_time=datetime.now(timezone.utc))
 
-        self.strategy.analyze(self.active_pair_whitelist)
+        with self._measure_execution:
+            self.strategy.analyze(self.active_pair_whitelist)
 
         with self._exit_lock:
-            # Check for exchange cancelations, timeouts and user requested replace
+            # Check for exchange cancellations, timeouts and user requested replace
             self.manage_open_orders()
 
         # Protect from collisions with force_exit.
         # Without this, freqtrade may try to recreate stoploss_on_exchange orders
         # while exiting is in process, since telegram messages arrive in an different thread.
         with self._exit_lock:
             trades = Trade.get_open_trades()
             # First process current opened trades (positions)
             self.exit_positions(trades)
 
-        # Check if we need to adjust our current positions before attempting to buy new trades.
+        # Check if we need to adjust our current positions before attempting to enter new trades.
         if self.strategy.position_adjustment_enable:
             with self._exit_lock:
                 self.process_open_trade_positions()
 
-        # Then looking for buy opportunities
+        # Then looking for entry opportunities
         if self.get_free_open_trades():
             self.enter_positions()
         if self.trading_mode == TradingMode.FUTURES:
             self._schedule.run_pending()
         Trade.commit()
         self.rpc.process_msg_queue(self.dataprovider._msg_queue)
         self.last_process = datetime.now(timezone.utc)
@@ -273,15 +286,15 @@
                     f"Handle these trades manually on {self.exchange.name}, "
                     f"or '/start' the bot again and use '/stopentry' "
                     f"to handle open trades gracefully. \n"
                     f"{'Note: Trades are simulated (dry run).' if self.config['dry_run'] else ''}",
             }
             self.rpc.send_msg(msg)
 
-    def _refresh_active_whitelist(self, trades: List[Trade] = []) -> List[str]:
+    def _refresh_active_whitelist(self, trades: Optional[List[Trade]] = None) -> List[str]:
         """
         Refresh active whitelist from pairlist or edge and extend it with
         pairs that have open trades.
         """
         # Refresh whitelist
         _prev_whitelist = self.pairlists.whitelist
         self.pairlists.refresh_pairlist()
@@ -445,14 +458,15 @@
         Only used balance disappeared, which would make exiting impossible.
         """
         try:
             orders = self.exchange.fetch_orders(
                 trade.pair, trade.open_date_utc - timedelta(seconds=10))
             prev_exit_reason = trade.exit_reason
             prev_trade_state = trade.is_open
+            prev_trade_amount = trade.amount
             for order in orders:
                 trade_order = [o for o in trade.orders if o.order_id == order['id']]
 
                 if trade_order:
                     # We knew this order, but didn't have it updated properly
                     order_obj = trade_order[0]
                 else:
@@ -476,23 +490,43 @@
                 # Trade was just closed
                 trade.close_date = trade.date_last_filled_utc
                 self.order_close_notify(trade, order_obj,
                                         order_obj.ft_order_side == 'stoploss',
                                         send_msg=prev_trade_state != trade.is_open)
             else:
                 trade.exit_reason = prev_exit_reason
+                total = self.wallets.get_total(trade.base_currency) if trade.base_currency else 0
+                if total < trade.amount:
+                    if total > trade.amount * 0.98:
+                        logger.warning(
+                            f"{trade} has a total of {trade.amount} {trade.base_currency}, "
+                            f"but the Wallet shows a total of {total} {trade.base_currency}. "
+                            f"Adjusting trade amount to {total}."
+                            "This may however lead to further issues."
+                        )
+                        trade.amount = total
+                    else:
+                        logger.warning(
+                            f"{trade} has a total of {trade.amount} {trade.base_currency}, "
+                            f"but the Wallet shows a total of {total} {trade.base_currency}. "
+                            "Refusing to adjust as the difference is too large."
+                            "This may however lead to further issues."
+                        )
+                if prev_trade_amount != trade.amount:
+                    # Cancel stoploss on exchange if the amount changed
+                    trade = self.cancel_stoploss_on_exchange(trade)
             Trade.commit()
 
         except ExchangeError:
             logger.warning("Error finding onexchange order.")
         except Exception:
             # catching https://github.com/freqtrade/freqtrade/issues/9025
             logger.warning("Error finding onexchange order", exc_info=True)
 #
-# BUY / enter positions / open trades logic and methods
+# enter positions / open trades logic and methods
 #
 
     def enter_positions(self) -> int:
         """
         Tries to execute entry orders for new trades (positions)
         """
         trades_created = 0
@@ -534,18 +568,18 @@
         if not trades_created:
             logger.debug("Found no enter signals for whitelisted currencies. Trying again...")
 
         return trades_created
 
     def create_trade(self, pair: str) -> bool:
         """
-        Check the implemented trading strategy for buy signals.
+        Check the implemented trading strategy for entry signals.
 
-        If the pair triggers the buy signal a new trade record gets created
-        and the buy-order opening the trade gets issued towards the exchange.
+        If the pair triggers the enter signal a new trade record gets created
+        and the entry-order opening the trade gets issued towards the exchange.
 
         :return: True if a trade has been created.
         """
         logger.debug(f"create_trade for pair {pair}")
 
         analyzed_df, _ = self.dataprovider.get_analyzed_dataframe(pair, self.strategy.timeframe)
         nowtime = analyzed_df.iloc[-1]['date'] if len(analyzed_df) > 0 else None
@@ -596,15 +630,15 @@
                 enter_tag=enter_tag,
                 is_short=(signal == SignalDirection.SHORT)
             )
         else:
             return False
 
 #
-# BUY / increase positions / DCA logic and methods
+# Modify positions / DCA logic and methods
 #
     def process_open_trade_positions(self):
         """
         Tries to execute additional buy or sell orders for open trades (positions)
         """
         # Walk through each pair and check if it needs changes
         for trade in Trade.get_open_trades():
@@ -679,15 +713,15 @@
                 return
 
             self.execute_trade_exit(trade, current_exit_rate, exit_check=ExitCheckTuple(
                 exit_type=ExitType.PARTIAL_EXIT), sub_trade_amt=amount, exit_tag=order_tag)
 
     def _check_depth_of_market(self, pair: str, conf: Dict, side: SignalDirection) -> bool:
         """
-        Checks depth of market before executing a buy
+        Checks depth of market before executing an entry
         """
         conf_bids_to_ask_delta = conf.get('bids_to_ask_delta', 0)
         logger.info(f"Checking depth of market for {pair} ...")
         order_book = self.exchange.fetch_l2_order_book(pair, 1000)
         order_book_data_frame = order_book_to_dataframe(order_book['bids'], order_book['asks'])
         order_book_bids = order_book_data_frame['b_size'].sum()
         order_book_asks = order_book_data_frame['a_size'].sum()
@@ -723,18 +757,18 @@
         ordertype: Optional[str] = None,
         enter_tag: Optional[str] = None,
         trade: Optional[Trade] = None,
         mode: EntryExecuteMode = 'initial',
         leverage_: Optional[float] = None,
     ) -> bool:
         """
-        Executes a limit buy for the given pair
-        :param pair: pair for which we want to create a LIMIT_BUY
+        Executes an entry for the given pair
+        :param pair: pair for which we want to create a LIMIT order
         :param stake_amount: amount of stake-currency for the pair
-        :return: True if a buy order is created, false if it fails.
+        :return: True if an entry order is created, False if it fails.
         :raise: DependencyException or it's subclasses like ExchangeError.
         """
         time_in_force = self.strategy.order_time_in_force['entry']
 
         side: BuySell = 'sell' if is_short else 'buy'
         name = 'Short' if is_short else 'Long'
         trade_side: LongShort = 'short' if is_short else 'long'
@@ -855,15 +889,15 @@
                 precision_mode=self.exchange.precisionMode,
                 contract_size=self.exchange.get_contract_size(pair),
             )
             stoploss = self.strategy.stoploss if not self.edge else self.edge.get_stoploss(pair)
             trade.adjust_stop_loss(trade.open_rate, stoploss, initial=True)
 
         else:
-            # This is additional buy, we reset fee_open_currency so timeout checking can work
+            # This is additional entry, we reset fee_open_currency so timeout checking can work
             trade.is_open = True
             trade.fee_open_currency = None
             trade.open_rate_requested = enter_limit_requested
             trade.set_funding_fees(funding_fees)
 
         trade.orders.append(order_obj)
         trade.recalc_trade_from_orders()
@@ -1228,15 +1262,15 @@
             if stoploss_order and stoploss_order['status'] in ('closed', 'triggered'):
                 trade.exit_reason = ExitType.STOPLOSS_ON_EXCHANGE.value
                 self._notify_exit(trade, "stoploss", True)
                 self.handle_protections(trade.pair, trade.trade_direction)
                 return True
 
         if trade.has_open_orders or not trade.is_open:
-            # Trade has an open Buy or Sell order, Stoploss-handling can't happen in this case
+            # Trade has an open order, Stoploss-handling can't happen in this case
             # as the Amount on the exchange is tied up in another trade.
             # The trade can be closed already (sell-order fill confirmation came in this iteration)
             return False
 
         # If enter order is fulfilled but there is no stoploss, we add a stoploss on exchange
         if len(stoploss_orders) == 0:
             stop_price = trade.stoploss_or_liquidation
@@ -1286,20 +1320,20 @@
                 # Create new stoploss order
                 if not self.create_stoploss_order(trade=trade, stop_price=stoploss_norm):
                     logger.warning(f"Could not create trailing stoploss order "
                                    f"for pair {trade.pair}.")
 
     def manage_trade_stoploss_orders(self, trade: Trade, stoploss_orders: List[Dict]):
         """
-        Perform required actions acording to existing stoploss orders of trade
+        Perform required actions according to existing stoploss orders of trade
         :param trade: Corresponding Trade
         :param stoploss_orders: Current on exchange stoploss orders
         :return: None
         """
-        # If all stoploss orderd are canceled for some reason we add it again
+        # If all stoploss ordered are canceled for some reason we add it again
         canceled_sl_orders = [o for o in stoploss_orders
                               if o['status'] in ('canceled', 'cancelled')]
         if (
             trade.is_open and
             len(stoploss_orders) > 0 and
             len(stoploss_orders) == len(canceled_sl_orders)
         ):
@@ -1931,29 +1965,31 @@
         order_obj_or_none = trade.select_order_by_order_id(order_id)
         order_obj = self.order_obj_or_raise(order_id, order_obj_or_none)
 
         self.handle_order_fee(trade, order_obj, order)
 
         trade.update_trade(order_obj, not send_msg)
 
-        trade = self._update_trade_after_fill(trade, order_obj)
+        trade = self._update_trade_after_fill(trade, order_obj, send_msg)
         Trade.commit()
 
         self.order_close_notify(trade, order_obj, stoploss_order, send_msg)
 
         return False
 
-    def _update_trade_after_fill(self, trade: Trade, order: Order) -> Trade:
+    def _update_trade_after_fill(self, trade: Trade, order: Order, send_msg: bool) -> Trade:
         if order.status in constants.NON_OPEN_EXCHANGE_STATES:
             strategy_safe_wrapper(
                 self.strategy.order_filled, default_retval=None)(
                 pair=trade.pair, trade=trade, order=order, current_time=datetime.now(timezone.utc))
             # If a entry order was closed, force update on stoploss on exchange
             if order.ft_order_side == trade.entry_side:
-                trade = self.cancel_stoploss_on_exchange(trade)
+                if send_msg:
+                    # Don't cancel stoploss in recovery modes immediately
+                    trade = self.cancel_stoploss_on_exchange(trade)
                 if not self.edge:
                     # TODO: should shorting/leverage be supported by Edge,
                     # then this will need to be fixed.
                     trade.adjust_stop_loss(trade.open_rate, self.strategy.stoploss, initial=True)
             if order.ft_order_side == trade.entry_side or (trade.amount > 0 and trade.is_open):
                 # Must also run for partial exits
                 # TODO: Margin will need to use interest_rate as well.
@@ -1995,15 +2031,15 @@
         elif send_msg and order.order_id not in trade.open_orders_ids and not stoploss_order:
             sub_trade = not isclose(order.safe_amount_after_fee,
                                     trade.amount, abs_tol=constants.MATH_CLOSE_PREC)
             # Enter fill
             self._notify_enter(trade, order, order.order_type, fill=True, sub_trade=sub_trade)
 
     def handle_protections(self, pair: str, side: LongShort) -> None:
-        # Lock pair for one candle to prevent immediate rebuys
+        # Lock pair for one candle to prevent immediate re-entries
         self.strategy.lock_pair(pair, datetime.now(timezone.utc), reason='Auto lock')
         prot_trig = self.protections.stop_per_pair(pair, side=side)
         if prot_trig:
             msg: RPCProtectionMsg = {
                 'type': RPCMessageType.PROTECTION_TRIGGER,
                 'base_currency': self.exchange.get_pair_base_currency(prot_trig.pair),
                 **prot_trig.to_json()  # type: ignore
@@ -2031,15 +2067,15 @@
         self.wallets.update()
         amount_ = trade.amount
         if order_obj.ft_order_side == trade.exit_side or order_obj.ft_order_side == 'stoploss':
             # check against remaining amount!
             amount_ = trade.amount - amount
 
         if trade.nr_of_successful_entries >= 1 and order_obj.ft_order_side == trade.entry_side:
-            # In case of rebuy's, trade.amount doesn't contain the amount of the last entry.
+            # In case of re-entry's, trade.amount doesn't contain the amount of the last entry.
             amount_ = trade.amount + amount
 
         if fee_abs != 0 and self.wallets.get_free(trade_base_currency) >= amount_:
             # Eat into dust if we own more than base currency
             logger.info(f"Fee amount for {trade} was in base currency - "
                         f"Eating Fee {fee_abs} into dust.")
         elif fee_abs != 0:
```

### Comparing `freqtrade-2024.3/freqtrade/leverage/interest.py` & `freqtrade-2024.4/freqtrade/leverage/interest.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/loggers/__init__.py` & `freqtrade-2024.4/freqtrade/loggers/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/loggers/set_log_levels.py` & `freqtrade-2024.4/freqtrade/loggers/set_log_levels.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/loggers/std_err_stream_handler.py` & `freqtrade-2024.4/freqtrade/loggers/std_err_stream_handler.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/main.py` & `freqtrade-2024.4/freqtrade/main.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/misc.py` & `freqtrade-2024.4/freqtrade/misc.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/mixins/logging_mixin.py` & `freqtrade-2024.4/freqtrade/mixins/logging_mixin.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/analysis/lookahead.py` & `freqtrade-2024.4/freqtrade/optimize/analysis/lookahead.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/analysis/lookahead_helpers.py` & `freqtrade-2024.4/freqtrade/optimize/analysis/lookahead_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/analysis/recursive.py` & `freqtrade-2024.4/freqtrade/optimize/analysis/recursive.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/analysis/recursive_helpers.py` & `freqtrade-2024.4/freqtrade/optimize/analysis/recursive_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/backtest_caching.py` & `freqtrade-2024.4/freqtrade/optimize/backtest_caching.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/backtesting.py` & `freqtrade-2024.4/freqtrade/optimize/backtesting.py`

 * *Files 0% similar despite different names*

```diff
@@ -15,14 +15,15 @@
 from freqtrade import constants
 from freqtrade.configuration import TimeRange, validate_config_consistency
 from freqtrade.constants import DATETIME_PRINT_FORMAT, Config, IntOrInf, LongShort
 from freqtrade.data import history
 from freqtrade.data.btanalysis import find_existing_backtest_stats, trade_list_to_dataframe
 from freqtrade.data.converter import trim_dataframe, trim_dataframes
 from freqtrade.data.dataprovider import DataProvider
+from freqtrade.data.metrics import combined_dataframes_with_rel_mean
 from freqtrade.enums import (BacktestState, CandleType, ExitCheckTuple, ExitType, RunMode,
                              TradingMode)
 from freqtrade.exceptions import DependencyException, OperationalException
 from freqtrade.exchange import (amount_to_contract_precision, price_to_precision,
                                 timeframe_to_seconds)
 from freqtrade.exchange.exchange import Exchange
 from freqtrade.mixins import LoggingMixin
@@ -292,15 +293,15 @@
                 timerange=self.timerange,
                 startup_candles=0,
                 fail_without_data=True,
                 data_format=self.config['dataformat_ohlcv'],
                 candle_type=CandleType.FUNDING_RATE
             )
 
-            # For simplicity, assign to CandleType.Mark (might contian index candles!)
+            # For simplicity, assign to CandleType.Mark (might contain index candles!)
             mark_rates_dict = history.load_data(
                 datadir=self.config['datadir'],
                 pairs=self.pairlists.whitelist,
                 timeframe=mark_timeframe,
                 timerange=self.timerange,
                 startup_candles=0,
                 fail_without_data=True,
@@ -561,15 +562,16 @@
                     entry_tag1=order_tag)
                 if pos_trade is not None:
                     self.wallets.update()
                     return pos_trade
 
         if stake_amount is not None and stake_amount < 0.0:
             amount = amount_to_contract_precision(
-                abs(stake_amount * trade.leverage) / current_rate, trade.amount_precision,
+                abs(stake_amount * trade.amount / trade.stake_amount),
+                trade.amount_precision,
                 self.precision_mode, trade.contract_size)
             if amount == 0.0:
                 return trade
             remaining = (trade.amount - amount) * current_rate
             if min_stake and remaining != 0 and remaining < min_stake:
                 # Remaining stake is too low to be sold.
                 return trade
@@ -1211,15 +1213,15 @@
         :param processed: a processed dictionary with format {pair, data}, which gets cleared to
         optimize memory usage!
         :param start_date: backtesting timerange start datetime
         :param end_date: backtesting timerange end datetime
         :return: DataFrame with trades (results of backtesting)
         """
         self.prepare_backtest(self.enable_protections)
-        # Ensure wallets are uptodate (important for --strategy-list)
+        # Ensure wallets are up-to-date (important for --strategy-list)
         self.wallets.update()
         # Use dict of lists with data for performance
         # (looping lists is a lot faster than pandas DataFrames)
         data: Dict = self._get_ohlcv_as_lists(processed)
 
         # Indexes per pair, so some pairs are allowed to have a missing start.
         indexes: Dict = defaultdict(int)
@@ -1388,17 +1390,16 @@
         if min_backtest_date is not None:
             self.results = find_existing_backtest_stats(
                 self.config['user_data_dir'] / 'backtest_results', self.run_ids, min_backtest_date)
 
     def start(self) -> None:
         """
         Run backtesting end-to-end
-        :return: None
         """
-        data: Dict[str, Any] = {}
+        data: Dict[str, DataFrame] = {}
 
         data, timerange = self.load_bt_data()
         self.load_bt_data_detail()
         logger.info("Dataload complete. Calculating indicators")
 
         self.load_prior_backtest()
 
@@ -1417,15 +1418,17 @@
                 self.results['metadata'].update(results['metadata'])
                 self.results['strategy'].update(results['strategy'])
                 self.results['strategy_comparison'].extend(results['strategy_comparison'])
             else:
                 self.results = results
             dt_appendix = datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
             if self.config.get('export', 'none') in ('trades', 'signals'):
-                store_backtest_stats(self.config['exportfilename'], self.results, dt_appendix)
+                combined_res = combined_dataframes_with_rel_mean(data, min_date, max_date)
+                store_backtest_stats(self.config['exportfilename'], self.results, dt_appendix,
+                                     market_change_data=combined_res)
 
             if (self.config.get('export', 'none') == 'signals' and
                     self.dataprovider.runmode == RunMode.BACKTEST):
                 store_backtest_analysis_results(
                     self.config['exportfilename'], self.processed_dfs, self.rejected_df,
                     dt_appendix)
```

### Comparing `freqtrade-2024.3/freqtrade/optimize/base_analysis.py` & `freqtrade-2024.4/freqtrade/optimize/base_analysis.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/bt_progress.py` & `freqtrade-2024.4/freqtrade/optimize/bt_progress.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/edge_cli.py` & `freqtrade-2024.4/freqtrade/optimize/edge_cli.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_auto.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_auto.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_epoch_filters.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_epoch_filters.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_interface.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_calmar.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_max_drawdown_relative.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_onlyprofit.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_profit_drawdown.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sharpe_daily.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_short_trade_dur.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss/hyperopt_loss_sortino_daily.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_loss_interface.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_loss_interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/optimize/hyperopt_tools.py` & `freqtrade-2024.4/freqtrade/optimize/hyperopt_tools.py`

 * *Files 1% similar despite different names*

```diff
@@ -233,16 +233,18 @@
                 # Convert keys in min_roi dict to strings because
                 # rapidjson cannot dump dicts with integer keys...
                 result_dict['minimal_roi'] = {str(k): v for k, v in all_space_params.items()}
             else:  # 'stoploss', 'trailing'
                 result_dict.update(all_space_params)
 
     @staticmethod
-    def _params_pretty_print(params, space: str, header: str, non_optimized={}) -> None:
-        if space in params or space in non_optimized:
+    def _params_pretty_print(
+            params, space: str, header: str, non_optimized: Optional[Dict] = None) -> None:
+
+        if space in params or (non_optimized and space in non_optimized):
             space_params = HyperoptTools._space_params(params, space, 5)
             no_params = HyperoptTools._space_params(non_optimized, space, 5)
             appendix = ''
             if not space_params and not no_params:
                 # No parameters - don't print
                 return
             if not space_params:
```

### Comparing `freqtrade-2024.3/freqtrade/optimize/optimize_reports/__init__.py` & `freqtrade-2024.4/freqtrade/optimize/optimize_reports/__init__.py`

 * *Files 14% similar despite different names*

```diff
@@ -2,17 +2,16 @@
 from freqtrade.optimize.optimize_reports.bt_output import (generate_edge_table,
                                                            generate_wins_draws_losses,
                                                            show_backtest_result,
                                                            show_backtest_results,
                                                            show_sorted_pairlist,
                                                            text_table_add_metrics,
                                                            text_table_bt_results,
-                                                           text_table_exit_reason,
                                                            text_table_periodic_breakdown,
                                                            text_table_strategy, text_table_tags)
 from freqtrade.optimize.optimize_reports.bt_storage import (store_backtest_analysis_results,
                                                             store_backtest_stats)
 from freqtrade.optimize.optimize_reports.optimize_reports import (
     generate_all_periodic_breakdown_stats, generate_backtest_stats, generate_daily_stats,
-    generate_exit_reason_stats, generate_pair_metrics, generate_periodic_breakdown_stats,
-    generate_rejected_signals, generate_strategy_comparison, generate_strategy_stats,
-    generate_tag_metrics, generate_trade_signal_candles, generate_trading_stats)
+    generate_pair_metrics, generate_periodic_breakdown_stats, generate_rejected_signals,
+    generate_strategy_comparison, generate_strategy_stats, generate_tag_metrics,
+    generate_trade_signal_candles, generate_trading_stats)
```

### Comparing `freqtrade-2024.3/freqtrade/optimize/optimize_reports/bt_output.py` & `freqtrade-2024.4/freqtrade/optimize/optimize_reports/bt_output.py`

 * *Files 8% similar despite different names*

```diff
@@ -56,61 +56,38 @@
         generate_wins_draws_losses(t['wins'], t['draws'], t['losses'])
     ] for t in pair_results]
     # Ignore type as floatfmt does allow tuples but mypy does not know that
     return tabulate(output, headers=headers,
                     floatfmt=floatfmt, tablefmt="orgtbl", stralign="right")
 
 
-def text_table_exit_reason(exit_reason_stats: List[Dict[str, Any]], stake_currency: str) -> str:
-    """
-    Generate small table outlining Backtest results
-    :param exit_reason_stats: Exit reason metrics
-    :param stake_currency: Stakecurrency used
-    :return: pretty printed table with tabulate as string
-    """
-    headers = [
-        'Exit Reason',
-        'Exits',
-        'Win  Draws  Loss  Win%',
-        'Avg Profit %',
-        f'Tot Profit {stake_currency}',
-        'Tot Profit %',
-    ]
-
-    output = [[
-        t.get('exit_reason', t.get('sell_reason')), t['trades'],
-        generate_wins_draws_losses(t['wins'], t['draws'], t['losses']),
-        t['profit_mean_pct'],
-        fmt_coin(t['profit_total_abs'], stake_currency, False),
-        t['profit_total_pct'],
-    ] for t in exit_reason_stats]
-    return tabulate(output, headers=headers, tablefmt="orgtbl", stralign="right")
-
-
 def text_table_tags(tag_type: str, tag_results: List[Dict[str, Any]], stake_currency: str) -> str:
     """
     Generates and returns a text table for the given backtest data and the results dataframe
     :param pair_results: List of Dictionaries - one entry per pair + final TOTAL row
     :param stake_currency: stake-currency - used to correctly name headers
     :return: pretty printed table with tabulate as string
     """
+    fallback: str = ''
     if (tag_type == "enter_tag"):
         headers = _get_line_header("TAG", stake_currency)
     else:
-        headers = _get_line_header("TAG", stake_currency, 'Exits')
+        headers = _get_line_header("Exit Reason", stake_currency, 'Exits')
+        fallback = 'exit_reason'
+
     floatfmt = _get_line_floatfmt(stake_currency)
     output = [
         [
-            t['key'] if t['key'] is not None and len(
-                t['key']) > 0 else "OTHER",
+            t['key'] if t.get('key') is not None and len(
+                str(t['key'])) > 0 else t.get(fallback, "OTHER"),
             t['trades'],
             t['profit_mean_pct'],
             t['profit_total_abs'],
             t['profit_total_pct'],
-            t['duration_avg'],
+            t.get('duration_avg'),
             generate_wins_draws_losses(
                 t['wins'],
                 t['draws'],
                 t['losses'])] for t in tag_results]
     # Ignore type as floatfmt does allow tuples but mypy does not know that
     return tabulate(output, headers=headers,
                     floatfmt=floatfmt, tablefmt="orgtbl", stralign="right")
@@ -297,15 +274,15 @@
                    f"Your starting balance was {start_balance}, "
                    f"and your stake was {stake_amount}."
                    )
         return message
 
 
 def show_backtest_result(strategy: str, results: Dict[str, Any], stake_currency: str,
-                         backtest_breakdown=[]):
+                         backtest_breakdown: List[str]):
     """
     Print results for one strategy
     """
     # Print results
     print(f"Result for strategy {strategy}")
     table = text_table_bt_results(results['results_per_pair'], stake_currency=stake_currency)
     if isinstance(table, str):
@@ -313,25 +290,24 @@
     print(table)
 
     table = text_table_bt_results(results['left_open_trades'], stake_currency=stake_currency)
     if isinstance(table, str) and len(table) > 0:
         print(' LEFT OPEN TRADES REPORT '.center(len(table.splitlines()[0]), '='))
     print(table)
 
-    if (results.get('results_per_enter_tag') is not None):
-        table = text_table_tags("enter_tag", results['results_per_enter_tag'], stake_currency)
+    if (enter_tags := results.get('results_per_enter_tag')) is not None:
+        table = text_table_tags("enter_tag", enter_tags, stake_currency)
 
         if isinstance(table, str) and len(table) > 0:
             print(' ENTER TAG STATS '.center(len(table.splitlines()[0]), '='))
         print(table)
 
-    exit_reasons = results.get('exit_reason_summary')
-    if exit_reasons:
-        table = text_table_exit_reason(exit_reason_stats=exit_reasons,
-                                       stake_currency=stake_currency)
+    if (exit_reasons := results.get('exit_reason_summary')) is not None:
+        table = text_table_tags("exit_tag", exit_reasons, stake_currency)
+
         if isinstance(table, str) and len(table) > 0:
             print(' EXIT REASON STATS '.center(len(table.splitlines()[0]), '='))
         print(table)
 
     for period in backtest_breakdown:
         if period in results.get('periodic_breakdown', {}):
             days_breakdown_stats = results['periodic_breakdown'][period]
```

### Comparing `freqtrade-2024.3/freqtrade/optimize/optimize_reports/bt_storage.py` & `freqtrade-2024.4/freqtrade/optimize/optimize_reports/bt_storage.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,50 +1,70 @@
 import logging
 from pathlib import Path
-from typing import Dict
+from typing import Dict, Optional
+
+from pandas import DataFrame
 
 from freqtrade.constants import LAST_BT_RESULT_FN
 from freqtrade.misc import file_dump_joblib, file_dump_json
 from freqtrade.optimize.backtest_caching import get_backtest_metadata_filename
 from freqtrade.types import BacktestResultType
 
 
 logger = logging.getLogger(__name__)
 
 
+def _generate_filename(recordfilename: Path, appendix: str, suffix: str) -> Path:
+    """
+    Generates a filename based on the provided parameters.
+    :param recordfilename: Path object, which can either be a filename or a directory.
+    :param appendix: use for the filename. e.g. backtest-result-<datetime>
+    :param suffix: Suffix to use for the file, e.g. .json, .pkl
+    :return: Generated filename as a Path object
+    """
+    if recordfilename.is_dir():
+        filename = (recordfilename / f'backtest-result-{appendix}').with_suffix(suffix)
+    else:
+        filename = Path.joinpath(
+            recordfilename.parent, f'{recordfilename.stem}-{appendix}'
+        ).with_suffix(suffix)
+    return filename
+
+
 def store_backtest_stats(
-        recordfilename: Path, stats: BacktestResultType, dtappendix: str) -> Path:
+        recordfilename: Path, stats: BacktestResultType, dtappendix: str, *,
+        market_change_data: Optional[DataFrame] = None) -> Path:
     """
     Stores backtest results
     :param recordfilename: Path object, which can either be a filename or a directory.
         Filenames will be appended with a timestamp right before the suffix
         while for directories, <directory>/backtest-result-<datetime>.json will be used as filename
     :param stats: Dataframe containing the backtesting statistics
     :param dtappendix: Datetime to use for the filename
     """
-    if recordfilename.is_dir():
-        filename = (recordfilename / f'backtest-result-{dtappendix}.json')
-    else:
-        filename = Path.joinpath(
-            recordfilename.parent, f'{recordfilename.stem}-{dtappendix}'
-        ).with_suffix(recordfilename.suffix)
+    filename = _generate_filename(recordfilename, dtappendix, '.json')
 
     # Store metadata separately.
     file_dump_json(get_backtest_metadata_filename(filename), stats['metadata'])
     # Don't mutate the original stats dict.
     stats_copy = {
         'strategy': stats['strategy'],
         'strategy_comparison': stats['strategy_comparison'],
     }
 
     file_dump_json(filename, stats_copy)
 
     latest_filename = Path.joinpath(filename.parent, LAST_BT_RESULT_FN)
     file_dump_json(latest_filename, {'latest_backtest': str(filename.name)})
 
+    if market_change_data is not None:
+        filename_mc = _generate_filename(recordfilename, f"{dtappendix}_market_change", '.feather')
+        market_change_data.reset_index().to_feather(
+            filename_mc, compression_level=9, compression='lz4')
+
     return filename
 
 
 def _store_backtest_analysis_data(
         recordfilename: Path, data: Dict[str, Dict],
         dtappendix: str, name: str) -> Path:
     """
@@ -53,20 +73,15 @@
         Filenames will be appended with a timestamp right before the suffix
         while for directories, <directory>/backtest-result-<datetime>_<name>.pkl will be used
         as filename
     :param candles: Dict containing the backtesting data for analysis
     :param dtappendix: Datetime to use for the filename
     :param name: Name to use for the file, e.g. signals, rejected
     """
-    if recordfilename.is_dir():
-        filename = (recordfilename / f'backtest-result-{dtappendix}_{name}.pkl')
-    else:
-        filename = Path.joinpath(
-            recordfilename.parent, f'{recordfilename.stem}-{dtappendix}_{name}.pkl'
-        )
+    filename = _generate_filename(recordfilename, f"{dtappendix}_{name}", '.pkl')
 
     file_dump_joblib(filename, data)
 
     return filename
 
 
 def store_backtest_analysis_results(
```

### Comparing `freqtrade-2024.3/freqtrade/optimize/optimize_reports/optimize_reports.py` & `freqtrade-2024.4/freqtrade/optimize/optimize_reports/optimize_reports.py`

 * *Files 5% similar despite different names*

```diff
@@ -2,15 +2,15 @@
 from copy import deepcopy
 from datetime import datetime, timedelta, timezone
 from typing import Any, Dict, List, Tuple, Union
 
 import numpy as np
 from pandas import DataFrame, Series, concat, to_datetime
 
-from freqtrade.constants import BACKTEST_BREAKDOWNS, DATETIME_PRINT_FORMAT, IntOrInf
+from freqtrade.constants import BACKTEST_BREAKDOWNS, DATETIME_PRINT_FORMAT
 from freqtrade.data.metrics import (calculate_cagr, calculate_calmar, calculate_csum,
                                     calculate_expectancy, calculate_market_change,
                                     calculate_max_drawdown, calculate_sharpe, calculate_sortino)
 from freqtrade.types import BacktestResultType
 from freqtrade.util import decimals_per_coin, fmt_coin
 
 
@@ -67,15 +67,16 @@
     # (end-capital - starting capital) / starting capital
     profit_total = result['profit_abs'].sum() / starting_balance
 
     return {
         'key': first_column,
         'trades': len(result),
         'profit_mean': result['profit_ratio'].mean() if len(result) > 0 else 0.0,
-        'profit_mean_pct': result['profit_ratio'].mean() * 100.0 if len(result) > 0 else 0.0,
+        'profit_mean_pct': round(result['profit_ratio'].mean() * 100.0, 2
+                                 ) if len(result) > 0 else 0.0,
         'profit_sum': profit_sum,
         'profit_sum_pct': round(profit_sum * 100.0, 2),
         'profit_total_abs': result['profit_abs'].sum(),
         'profit_total': profit_total,
         'profit_total_pct': round(profit_total * 100.0, 2),
         'duration_avg': str(timedelta(
                             minutes=round(result['trade_duration'].mean()))
@@ -150,50 +151,14 @@
         # Append Total
         tabular_data.append(_generate_result_line(results, starting_balance, 'TOTAL'))
         return tabular_data
     else:
         return []
 
 
-def generate_exit_reason_stats(max_open_trades: IntOrInf, results: DataFrame) -> List[Dict]:
-    """
-    Generate small table outlining Backtest results
-    :param max_open_trades: Max_open_trades parameter
-    :param results: Dataframe containing the backtest result for one strategy
-    :return: List of Dicts containing the metrics per Sell reason
-    """
-    tabular_data = []
-
-    for reason, count in results['exit_reason'].value_counts().items():
-        result = results.loc[results['exit_reason'] == reason]
-
-        profit_mean = result['profit_ratio'].mean()
-        profit_sum = result['profit_ratio'].sum()
-        profit_total = profit_sum / max_open_trades
-
-        tabular_data.append(
-            {
-                'exit_reason': reason,
-                'trades': count,
-                'wins': len(result[result['profit_abs'] > 0]),
-                'draws': len(result[result['profit_abs'] == 0]),
-                'losses': len(result[result['profit_abs'] < 0]),
-                'winrate': len(result[result['profit_abs'] > 0]) / count if count else 0.0,
-                'profit_mean': profit_mean,
-                'profit_mean_pct': round(profit_mean * 100, 2),
-                'profit_sum': profit_sum,
-                'profit_sum_pct': round(profit_sum * 100, 2),
-                'profit_total_abs': result['profit_abs'].sum(),
-                'profit_total': profit_total,
-                'profit_total_pct': round(profit_total * 100, 2),
-            }
-        )
-    return tabular_data
-
-
 def generate_strategy_comparison(bt_stats: Dict) -> List[Dict]:
     """
     Generate summary per strategy
     :param bt_stats: Dict of <Strategyname: DataFrame> containing results for all strategies
     :return: List of Dicts containing the metrics per Strategy
     """
 
@@ -379,17 +344,16 @@
 
     pair_results = generate_pair_metrics(pairlist, stake_currency=stake_currency,
                                          starting_balance=start_balance,
                                          results=results, skip_nan=False)
 
     enter_tag_results = generate_tag_metrics("enter_tag", starting_balance=start_balance,
                                              results=results, skip_nan=False)
-
-    exit_reason_stats = generate_exit_reason_stats(max_open_trades=max_open_trades,
-                                                   results=results)
+    exit_reason_stats = generate_tag_metrics('exit_reason', starting_balance=start_balance,
+                                             results=results, skip_nan=False)
     left_open_results = generate_pair_metrics(
         pairlist, stake_currency=stake_currency, starting_balance=start_balance,
         results=results.loc[results['exit_reason'] == 'force_exit'], skip_nan=True)
 
     daily_stats = generate_daily_stats(results)
     trade_stats = generate_trading_stats(results)
```

### Comparing `freqtrade-2024.3/freqtrade/optimize/space/decimalspace.py` & `freqtrade-2024.4/freqtrade/optimize/space/decimalspace.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/persistence/custom_data.py` & `freqtrade-2024.4/freqtrade/persistence/custom_data.py`

 * *Files 0% similar despite different names*

```diff
@@ -14,15 +14,15 @@
 logger = logging.getLogger(__name__)
 
 
 class _CustomData(ModelBase):
     """
     CustomData database model
     Keeps records of metadata as key/value store
-    for trades or global persistant values
+    for trades or global persistent values
     One to many relationship with Trades:
       - One trade can have many metadata entries
       - One metadata entry can only be associated with one Trade
     """
     __tablename__ = 'trade_custom_data'
     __allow_unmapped__ = True
     session: ClassVar[SessionType]
```

### Comparing `freqtrade-2024.3/freqtrade/persistence/key_value_store.py` & `freqtrade-2024.4/freqtrade/persistence/key_value_store.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/persistence/migrations.py` & `freqtrade-2024.4/freqtrade/persistence/migrations.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/persistence/models.py` & `freqtrade-2024.4/freqtrade/persistence/models.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/persistence/pairlock.py` & `freqtrade-2024.4/freqtrade/persistence/pairlock.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/persistence/pairlock_middleware.py` & `freqtrade-2024.4/freqtrade/persistence/pairlock_middleware.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/persistence/trade_model.py` & `freqtrade-2024.4/freqtrade/persistence/trade_model.py`

 * *Files 0% similar despite different names*

```diff
@@ -843,15 +843,15 @@
         if order.ft_order_side != self.entry_side:
             amount_tr = amount_to_contract_precision(self.amount, self.amount_precision,
                                                      self.precision_mode, self.contract_size)
             if (
                 isclose(order.safe_amount_after_fee, amount_tr, abs_tol=MATH_CLOSE_PREC)
                 or (not recalculating and order.safe_amount_after_fee > amount_tr)
             ):
-                # When recalculating a trade, only comming out to 0 can force a close
+                # When recalculating a trade, only coming out to 0 can force a close
                 self.close(order.safe_price)
             else:
                 self.recalc_trade_from_orders()
 
         Trade.commit()
 
     def close(self, rate: float, *, show_msg: bool = True) -> None:
@@ -1121,15 +1121,15 @@
                     self.funding_fees = funding_fees
 
                 exit_rate = o.safe_price
                 exit_amount = o.safe_amount_after_fee
                 prof = self.calculate_profit(exit_rate, exit_amount, float(avg_price))
                 close_profit_abs += prof.profit_abs
                 if total_stake > 0:
-                    # This needs to be calculated based on the last occuring exit to be aligned
+                    # This needs to be calculated based on the last occurring exit to be aligned
                     # with realized_profit.
                     close_profit = (close_profit_abs / total_stake) * self.leverage
             else:
                 total_stake = total_stake + self._calc_open_trade_value(tmp_amount, price)
                 max_stake_amount += (tmp_amount * price)
         self.funding_fees = funding_fees
         self.max_stake_amount = float(max_stake_amount)
@@ -1534,15 +1534,15 @@
     close_profit: Mapped[Optional[float]] = mapped_column(Float())  # type: ignore
     close_profit_abs: Mapped[Optional[float]] = mapped_column(Float())  # type: ignore
     stake_amount: Mapped[float] = mapped_column(Float(), nullable=False)  # type: ignore
     max_stake_amount: Mapped[Optional[float]] = mapped_column(Float())  # type: ignore
     amount: Mapped[float] = mapped_column(Float())  # type: ignore
     amount_requested: Mapped[Optional[float]] = mapped_column(Float())  # type: ignore
     open_date: Mapped[datetime] = mapped_column(
-        nullable=False, default=datetime.utcnow)  # type: ignore
+        nullable=False, default=datetime.now)  # type: ignore
     close_date: Mapped[Optional[datetime]] = mapped_column()  # type: ignore
     # absolute value of the stop loss
     stop_loss: Mapped[float] = mapped_column(Float(), nullable=True, default=0.0)  # type: ignore
     # percentage value of the stop loss
     stop_loss_pct: Mapped[Optional[float]] = mapped_column(Float(), nullable=True)  # type: ignore
     # absolute value of the initial stop loss
     initial_stop_loss: Mapped[Optional[float]] = mapped_column(
```

### Comparing `freqtrade-2024.3/freqtrade/persistence/usedb_context.py` & `freqtrade-2024.4/freqtrade/persistence/usedb_context.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plot/plotting.py` & `freqtrade-2024.4/freqtrade/plot/plotting.py`

 * *Files 1% similar despite different names*

```diff
@@ -436,29 +436,33 @@
             logger.warning(f"No {column_name}-signals found.")
 
     return None
 
 
 def generate_candlestick_graph(
         pair: str, data: pd.DataFrame, trades: Optional[pd.DataFrame] = None, *,
-        indicators1: List[str] = [], indicators2: List[str] = [],
-        plot_config: Dict[str, Dict] = {},
+        indicators1: Optional[List[str]] = None, indicators2: Optional[List[str]] = None,
+        plot_config: Optional[Dict[str, Dict]] = None,
         ) -> go.Figure:
     """
     Generate the graph from the data generated by Backtesting or from DB
-    Volume will always be ploted in row2, so Row 1 and 3 are to our disposal for custom indicators
+    Volume will always be plotted in row2, so Row 1 and 3 are to our disposal for custom indicators
     :param pair: Pair to Display on the graph
     :param data: OHLCV DataFrame containing indicators and entry/exit signals
     :param trades: All trades created
     :param indicators1: List containing Main plot indicators
     :param indicators2: List containing Sub plot indicators
     :param plot_config: Dict of Dicts containing advanced plot configuration
     :return: Plotly figure
     """
-    plot_config = create_plotconfig(indicators1, indicators2, plot_config)
+    plot_config = create_plotconfig(
+        indicators1 or [],
+        indicators2 or [],
+        plot_config or {},
+    )
     rows = 2 + len(plot_config['subplots'])
     row_widths = [1 for _ in plot_config['subplots']]
     # Define the graph
     fig = make_subplots(
         rows=rows,
         cols=1,
         shared_xaxes=True,
@@ -669,15 +673,15 @@
     logger.info('End of plotting process. %s plots generated', pair_counter)
 
 
 def plot_profit(config: Config) -> None:
     """
     Plots the total profit for all pairs.
     Note, the profit calculation isn't realistic.
-    But should be somewhat proportional, and therefor useful
+    But should be somewhat proportional, and therefore useful
     in helping out to find a good algorithm.
     """
     if 'timeframe' not in config:
         raise OperationalException('Timeframe must be set in either config or via --timeframe.')
 
     exchange = ExchangeResolver.load_exchange(config)
     plot_elements = init_plotscript(config, list(exchange.markets))
```

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/AgeFilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/AgeFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/FullTradesFilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/FullTradesFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/IPairList.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/IPairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/MarketCapPairList.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/MarketCapPairList.py`

 * *Files 1% similar despite different names*

```diff
@@ -34,15 +34,15 @@
 
         self._stake_currency = config['stake_currency']
         self._number_assets = self._pairlistconfig['number_assets']
         self._max_rank = self._pairlistconfig.get('max_rank', 30)
         self._refresh_period = self._pairlistconfig.get('refresh_period', 86400)
         self._marketcap_cache: TTLCache = TTLCache(maxsize=1, ttl=self._refresh_period)
         self._def_candletype = self._config['candle_type_def']
-        self._coingekko: CoinGeckoAPI = CoinGeckoAPI()
+        self._coingecko: CoinGeckoAPI = CoinGeckoAPI()
 
         if self._max_rank > 250:
             raise OperationalException(
                 "This filter only support marketcap rank up to 250."
             )
 
     @property
@@ -123,15 +123,15 @@
         :param pairlist: pairlist to filter or sort
         :param tickers: Tickers (from exchange.get_tickers). May be cached.
         :return: new whitelist
         """
         marketcap_list = self._marketcap_cache.get('marketcap')
 
         if marketcap_list is None:
-            data = self._coingekko.get_coins_markets(vs_currency='usd', order='market_cap_desc',
+            data = self._coingecko.get_coins_markets(vs_currency='usd', order='market_cap_desc',
                                                      per_page='250', page='1', sparkline='false',
                                                      locale='en')
             if data:
                 marketcap_list = [row['symbol'] for row in data]
                 self._marketcap_cache['marketcap'] = marketcap_list
 
         if marketcap_list:
```

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/OffsetFilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/OffsetFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/PerformanceFilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/PerformanceFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/PrecisionFilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/PrecisionFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/PriceFilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/PriceFilter.py`

 * *Files 0% similar despite different names*

```diff
@@ -97,15 +97,15 @@
                 "description": "Maximum value",
                 "help": "Remove pairs with a value (price * amount) above this value.",
             },
         }
 
     def _validate_pair(self, pair: str, ticker: Optional[Ticker]) -> bool:
         """
-        Check if if one price-step (pip) is > than a certain barrier.
+        Check if one price-step (pip) is > than a certain barrier.
         :param pair: Pair that's currently validated
         :param ticker: ticker dict as returned from ccxt.fetch_ticker
         :return: True if the pair can stay, false if it should be removed
         """
         if ticker and 'last' in ticker and ticker['last'] is not None and ticker.get('last') != 0:
             price: float = ticker['last']
         else:
```

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/ProducerPairList.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/ProducerPairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/RemotePairList.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/RemotePairList.py`

 * *Files 0% similar despite different names*

```diff
@@ -112,15 +112,15 @@
                 "help": "Should this pairlist operate as a whitelist or blacklist?",
             },
             "processing_mode": {
                 "type": "option",
                 "default": "filter",
                 "options": ["filter", "append"],
                 "description": "Processing mode",
-                "help": "Append pairs to incomming pairlist or filter them?",
+                "help": "Append pairs to incoming pairlist or filter them?",
             },
             **IPairList.refresh_period_parameter(),
             "keep_pairlist_on_failure": {
                 "type": "boolean",
                 "default": True,
                 "description": "Keep last pairlist on failure",
                 "help": "Keep last pairlist on failure",
```

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/ShuffleFilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/ShuffleFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/SpreadFilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/SpreadFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/StaticPairList.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/StaticPairList.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/VolatilityFilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/VolatilityFilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/VolumePairList.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/VolumePairList.py`

 * *Files 1% similar despite different names*

```diff
@@ -61,15 +61,15 @@
             self._lookback_timeframe = '1d'
             self._lookback_period = self._lookback_days
 
         # get timeframe in minutes and seconds
         self._tf_in_min = timeframe_to_minutes(self._lookback_timeframe)
         _tf_in_sec = self._tf_in_min * 60
 
-        # wether to use range lookback or not
+        # whether to use range lookback or not
         self._use_range = (self._tf_in_min > 0) & (self._lookback_period > 0)
 
         if self._use_range & (self._refresh_period < _tf_in_sec):
             raise OperationalException(
                 f'Refresh period of {self._refresh_period} seconds is smaller than one '
                 f'timeframe of {self._lookback_timeframe}. Please adjust refresh_period '
                 f'to at least {_tf_in_sec} and restart the bot.'
```

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/pairlist_helpers.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/pairlist_helpers.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlist/rangestabilityfilter.py` & `freqtrade-2024.4/freqtrade/plugins/pairlist/rangestabilityfilter.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/pairlistmanager.py` & `freqtrade-2024.4/freqtrade/plugins/pairlistmanager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/protectionmanager.py` & `freqtrade-2024.4/freqtrade/plugins/protectionmanager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/protections/cooldown_period.py` & `freqtrade-2024.4/freqtrade/plugins/protections/cooldown_period.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/protections/iprotection.py` & `freqtrade-2024.4/freqtrade/plugins/protections/iprotection.py`

 * *Files 0% similar despite different names*

```diff
@@ -106,14 +106,14 @@
 
     @staticmethod
     def calculate_lock_end(trades: List[LocalTrade], stop_minutes: int) -> datetime:
         """
         Get lock end time
         """
         max_date: datetime = max([trade.close_date for trade in trades if trade.close_date])
-        # comming from Database, tzinfo is not set.
+        # coming from Database, tzinfo is not set.
         if max_date.tzinfo is None:
             max_date = max_date.replace(tzinfo=timezone.utc)
 
         until = max_date + timedelta(minutes=stop_minutes)
 
         return until
```

### Comparing `freqtrade-2024.3/freqtrade/plugins/protections/low_profit_pairs.py` & `freqtrade-2024.4/freqtrade/plugins/protections/low_profit_pairs.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/protections/max_drawdown_protection.py` & `freqtrade-2024.4/freqtrade/plugins/protections/max_drawdown_protection.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/plugins/protections/stoploss_guard.py` & `freqtrade-2024.4/freqtrade/plugins/protections/stoploss_guard.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/resolvers/__init__.py` & `freqtrade-2024.4/freqtrade/resolvers/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/resolvers/exchange_resolver.py` & `freqtrade-2024.4/freqtrade/resolvers/exchange_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/resolvers/freqaimodel_resolver.py` & `freqtrade-2024.4/freqtrade/resolvers/freqaimodel_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/resolvers/hyperopt_resolver.py` & `freqtrade-2024.4/freqtrade/resolvers/hyperopt_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/resolvers/iresolver.py` & `freqtrade-2024.4/freqtrade/resolvers/iresolver.py`

 * *Files 1% similar despite different names*

```diff
@@ -43,26 +43,27 @@
     user_subdir: Optional[str] = None
     initial_search_path: Optional[Path] = None
     # Optional config setting containing a path (strategy_path, freqaimodel_path)
     extra_path: Optional[str] = None
 
     @classmethod
     def build_search_paths(cls, config: Config, user_subdir: Optional[str] = None,
-                           extra_dirs: List[str] = []) -> List[Path]:
+                           extra_dirs: Optional[List[str]] = None) -> List[Path]:
 
         abs_paths: List[Path] = []
         if cls.initial_search_path:
             abs_paths.append(cls.initial_search_path)
 
         if user_subdir:
             abs_paths.insert(0, config['user_data_dir'].joinpath(user_subdir))
 
         # Add extra directory to the top of the search paths
-        for dir in extra_dirs:
-            abs_paths.insert(0, Path(dir).resolve())
+        if extra_dirs:
+            for dir in extra_dirs:
+                abs_paths.insert(0, Path(dir).resolve())
 
         if cls.extra_path and (extra := config.get(cls.extra_path)):
             abs_paths.insert(0, Path(extra).resolve())
 
         return abs_paths
 
     @classmethod
@@ -135,15 +136,15 @@
                 if add_source:
                     obj[0].__source__ = obj[1]
                 return (obj[0], module_path)
         return (None, None)
 
     @classmethod
     def _load_object(cls, paths: List[Path], *, object_name: str, add_source: bool = False,
-                     kwargs: dict = {}) -> Optional[Any]:
+                     kwargs: Dict) -> Optional[Any]:
         """
         Try to load object from path list.
         """
 
         for _path in paths:
             try:
                 (module, module_path) = cls._search_object(directory=_path,
@@ -159,15 +160,15 @@
 
         return None
 
     @classmethod
     def load_object(cls, object_name: str, config: Config, *, kwargs: dict,
                     extra_dir: Optional[str] = None) -> Any:
         """
-        Search and loads the specified object as configured in hte child class.
+        Search and loads the specified object as configured in the child class.
         :param object_name: name of the module to import
         :param config: configuration dictionary
         :param extra_dir: additional directory to search for the given pairlist
         :raises: OperationalException if the class is invalid or does not exist.
         :return: Object instance or None
         """
```

### Comparing `freqtrade-2024.3/freqtrade/resolvers/pairlist_resolver.py` & `freqtrade-2024.4/freqtrade/resolvers/pairlist_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/resolvers/protection_resolver.py` & `freqtrade-2024.4/freqtrade/resolvers/protection_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/resolvers/strategy_resolver.py` & `freqtrade-2024.4/freqtrade/resolvers/strategy_resolver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/api_auth.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/api_auth.py`

 * *Files 2% similar despite different names*

```diff
@@ -22,14 +22,15 @@
 def verify_auth(api_config, username: str, password: str):
     """Verify username/password"""
     return (secrets.compare_digest(username, api_config.get('username')) and
             secrets.compare_digest(password, api_config.get('password')))
 
 
 httpbasic = HTTPBasic(auto_error=False)
+security = HTTPBasic()
 oauth2_scheme = OAuth2PasswordBearer(tokenUrl="token", auto_error=False)
 
 
 def get_user_from_token(token, secret_key: str, token_type: str = "access") -> str:
     credentials_exception = HTTPException(
         status_code=status.HTTP_401_UNAUTHORIZED,
         detail="Could not validate credentials",
@@ -113,15 +114,15 @@
     raise HTTPException(
         status_code=status.HTTP_401_UNAUTHORIZED,
         detail="Unauthorized",
     )
 
 
 @router_login.post('/token/login', response_model=AccessAndRefreshToken)
-def token_login(form_data: HTTPBasicCredentials = Depends(HTTPBasic()),
+def token_login(form_data: HTTPBasicCredentials = Depends(security),
                 api_config=Depends(get_api_config)):
 
     if verify_auth(api_config, form_data.username, form_data.password):
         token_data = {'identity': {'u': form_data.username}}
         access_token = create_token(token_data, api_config.get('jwt_secret_key', 'super-secret'))
         refresh_token = create_token(token_data, api_config.get('jwt_secret_key', 'super-secret'),
                                      token_type="refresh")
```

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/api_background_tasks.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/api_background_tasks.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/api_backtest.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/api_backtest.py`

 * *Files 2% similar despite different names*

```diff
@@ -6,38 +6,41 @@
 from typing import Any, Dict, List
 
 from fastapi import APIRouter, BackgroundTasks, Depends
 from fastapi.exceptions import HTTPException
 
 from freqtrade.configuration.config_validation import validate_config_consistency
 from freqtrade.constants import Config
-from freqtrade.data.btanalysis import (delete_backtest_result, get_backtest_result,
-                                       get_backtest_resultlist, load_and_merge_backtest_result,
-                                       update_backtest_metadata)
+from freqtrade.data.btanalysis import (delete_backtest_result, get_backtest_market_change,
+                                       get_backtest_result, get_backtest_resultlist,
+                                       load_and_merge_backtest_result, update_backtest_metadata)
 from freqtrade.enums import BacktestState
 from freqtrade.exceptions import ConfigurationError, DependencyException, OperationalException
 from freqtrade.exchange.common import remove_exchange_credentials
 from freqtrade.misc import deep_merge_dicts, is_file_in_dir
-from freqtrade.rpc.api_server.api_schemas import (BacktestHistoryEntry, BacktestMetadataUpdate,
-                                                  BacktestRequest, BacktestResponse)
+from freqtrade.rpc.api_server.api_schemas import (BacktestHistoryEntry, BacktestMarketChange,
+                                                  BacktestMetadataUpdate, BacktestRequest,
+                                                  BacktestResponse)
 from freqtrade.rpc.api_server.deps import get_config
 from freqtrade.rpc.api_server.webserver_bgwork import ApiBG
 from freqtrade.rpc.rpc import RPCException
 from freqtrade.types import get_BacktestResultType_default
 
 
 logger = logging.getLogger(__name__)
 
 # Private API, protected by authentication and webserver_mode dependency
 router = APIRouter()
 
 
 def __run_backtest_bg(btconfig: Config):
+    from freqtrade.data.metrics import combined_dataframes_with_rel_mean
     from freqtrade.optimize.optimize_reports import generate_backtest_stats, store_backtest_stats
     from freqtrade.resolvers import StrategyResolver
+
     asyncio.set_event_loop(asyncio.new_event_loop())
     try:
         # Reload strategy
         lastconfig = ApiBG.bt['last_config']
         strat = StrategyResolver.load_strategy(btconfig)
         validate_config_consistency(btconfig)
 
@@ -85,19 +88,22 @@
                 strat, ApiBG.bt['data'], ApiBG.bt['timerange'])
 
             ApiBG.bt['bt'].results = generate_backtest_stats(
                 ApiBG.bt['data'], ApiBG.bt['bt'].all_results,
                 min_date=min_date, max_date=max_date)
 
         if btconfig.get('export', 'none') == 'trades':
+            combined_res = combined_dataframes_with_rel_mean(ApiBG.bt['data'], min_date, max_date)
             fn = store_backtest_stats(
-                btconfig['exportfilename'], ApiBG.bt['bt'].results,
-                datetime.now().strftime("%Y-%m-%d_%H-%M-%S")
+                btconfig['exportfilename'],
+                ApiBG.bt['bt'].results,
+                datetime.now().strftime("%Y-%m-%d_%H-%M-%S"),
+                market_change_data=combined_res
                 )
-            ApiBG.bt['bt'].results['metadata'][strategy_name]['filename'] = str(fn.name)
+            ApiBG.bt['bt'].results['metadata'][strategy_name]['filename'] = str(fn.stem)
             ApiBG.bt['bt'].results['metadata'][strategy_name]['strategy'] = strategy_name
 
         logger.info("Backtest finished.")
 
     except ConfigurationError as e:
         logger.error(f"Backtesting encountered a configuration Error: {e}")
 
@@ -304,7 +310,24 @@
     }
     try:
         update_backtest_metadata(file_abs, body.strategy, content)
     except ValueError as e:
         raise HTTPException(status_code=400, detail=str(e))
 
     return get_backtest_result(file_abs)
+
+
+@router.get('/backtest/history/{file}/market_change', response_model=BacktestMarketChange,
+            tags=['webserver', 'backtest'])
+def api_get_backtest_market_change(file: str, config=Depends(get_config)):
+    bt_results_base: Path = config['user_data_dir'] / 'backtest_results'
+    file_abs = (bt_results_base / f"{file}_market_change").with_suffix('.feather')
+    # Ensure file is in backtest_results directory
+    if not is_file_in_dir(file_abs, bt_results_base):
+        raise HTTPException(status_code=404, detail="File not found.")
+    df = get_backtest_market_change(file_abs)
+
+    return {
+        'columns': df.columns.tolist(),
+        'data': df.values.tolist(),
+        'length': len(df),
+    }
```

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/api_schemas.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/api_schemas.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,11 @@
 from datetime import date, datetime
 from typing import Any, Dict, List, Optional, Union
 
-from pydantic import BaseModel, RootModel, SerializeAsAny
+from pydantic import AwareDatetime, BaseModel, RootModel, SerializeAsAny
 
 from freqtrade.constants import IntOrInf
 from freqtrade.enums import MarginMode, OrderTypeValues, SignalDirection, TradingMode
 from freqtrade.types import ValidExchangesType
 
 
 class ExchangeModePayloadMixin(BaseModel):
@@ -374,14 +374,21 @@
 
 
 class Locks(BaseModel):
     lock_count: int
     locks: List[LockModel]
 
 
+class LocksPayload(BaseModel):
+    pair: str
+    side: str = '*'  # Default to both sides
+    until: AwareDatetime
+    reason: Optional[str] = None
+
+
 class DeleteLockRequest(BaseModel):
     pair: Optional[str] = None
     lockid: Optional[int] = None
 
 
 class Logs(BaseModel):
     log_count: int
@@ -478,20 +485,34 @@
 
 class AvailablePairs(BaseModel):
     length: int
     pairs: List[str]
     pair_interval: List[List[str]]
 
 
+class PairCandlesRequest(BaseModel):
+    pair: str
+    timeframe: str
+    limit: Optional[int] = None
+    columns: Optional[List[str]] = None
+
+
+class PairHistoryRequest(PairCandlesRequest):
+    timerange: str
+    strategy: str
+    freqaimodel: Optional[str] = None
+
+
 class PairHistory(BaseModel):
     strategy: str
     pair: str
     timeframe: str
     timeframe_ms: int
     columns: List[str]
+    all_columns: List[str] = []
     data: SerializeAsAny[List[Any]]
     length: int
     buy_signals: int
     sell_signals: int
     enter_long_signals: int
     exit_long_signals: int
     enter_short_signals: int
@@ -547,14 +568,20 @@
 
 
 class BacktestMetadataUpdate(BaseModel):
     strategy: str
     notes: str = ''
 
 
+class BacktestMarketChange(BaseModel):
+    columns: List[str]
+    length: int
+    data: List[List[Any]]
+
+
 class SysInfo(BaseModel):
     cpu_pct: List[float]
     ram_pct: float
 
 
 class Health(BaseModel):
     last_process: Optional[datetime] = None
```

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/api_v1.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/api_v1.py`

 * *Files 5% similar despite different names*

```diff
@@ -11,20 +11,21 @@
 from freqtrade.exceptions import OperationalException
 from freqtrade.rpc import RPC
 from freqtrade.rpc.api_server.api_schemas import (AvailablePairs, Balances, BlacklistPayload,
                                                   BlacklistResponse, Count, DailyWeeklyMonthly,
                                                   DeleteLockRequest, DeleteTrade, Entry,
                                                   ExchangeListResponse, Exit, ForceEnterPayload,
                                                   ForceEnterResponse, ForceExitPayload,
-                                                  FreqAIModelListResponse, Health, Locks, Logs,
-                                                  MixTag, OpenTradeSchema, PairHistory,
-                                                  PerformanceEntry, Ping, PlotConfig, Profit,
-                                                  ResultMsg, ShowConfig, Stats, StatusMsg,
-                                                  StrategyListResponse, StrategyResponse, SysInfo,
-                                                  Version, WhitelistResponse)
+                                                  FreqAIModelListResponse, Health, Locks,
+                                                  LocksPayload, Logs, MixTag, OpenTradeSchema,
+                                                  PairCandlesRequest, PairHistory,
+                                                  PairHistoryRequest, PerformanceEntry, Ping,
+                                                  PlotConfig, Profit, ResultMsg, ShowConfig, Stats,
+                                                  StatusMsg, StrategyListResponse, StrategyResponse,
+                                                  SysInfo, Version, WhitelistResponse)
 from freqtrade.rpc.api_server.deps import get_config, get_exchange, get_rpc, get_rpc_optional
 from freqtrade.rpc.rpc import RPCException
 
 
 logger = logging.getLogger(__name__)
 
 # API version
@@ -49,15 +50,16 @@
 # 2.28: Switch reload endpoint to Post
 # 2.29: Add /exchanges endpoint
 # 2.30: new /pairlists endpoint
 # 2.31: new /backtest/history/ delete endpoint
 # 2.32: new /backtest/history/ patch endpoint
 # 2.33: Additional weekly/monthly metrics
 # 2.34: new entries/exits/mix_tags endpoints
-API_VERSION = 2.34
+# 2.35: pair_candles and pair_history endpoints as Post variant
+API_VERSION = 2.35
 
 # Public API, requires no auth.
 router_public = APIRouter()
 # Private API, protected by authentication
 router = APIRouter()
 
 
@@ -251,14 +253,21 @@
 
 
 @router.post('/locks/delete', response_model=Locks, tags=['info', 'locks'])
 def delete_lock_pair(payload: DeleteLockRequest, rpc: RPC = Depends(get_rpc)):
     return rpc._rpc_delete_lock(lockid=payload.lockid, pair=payload.pair)
 
 
+@router.post('/locks', response_model=Locks, tags=['info', 'locks'])
+def add_locks(payload: List[LocksPayload], rpc: RPC = Depends(get_rpc)):
+    for lock in payload:
+        rpc._rpc_add_lock(lock.pair, lock.until, lock.reason, lock.side)
+    return rpc._rpc_locks()
+
+
 @router.get('/logs', response_model=Logs, tags=['info'])
 def logs(limit: Optional[int] = None):
     return RPC._rpc_get_logs(limit)
 
 
 @router.post('/start', response_model=StatusMsg, tags=['botcontrol'])
 def start(rpc: RPC = Depends(get_rpc)):
@@ -280,15 +289,22 @@
 def reload_config(rpc: RPC = Depends(get_rpc)):
     return rpc._rpc_reload_config()
 
 
 @router.get('/pair_candles', response_model=PairHistory, tags=['candle data'])
 def pair_candles(
         pair: str, timeframe: str, limit: Optional[int] = None, rpc: RPC = Depends(get_rpc)):
-    return rpc._rpc_analysed_dataframe(pair, timeframe, limit)
+    return rpc._rpc_analysed_dataframe(pair, timeframe, limit, None)
+
+
+@router.post('/pair_candles', response_model=PairHistory, tags=['candle data'])
+def pair_candles_filtered(payload: PairCandlesRequest, rpc: RPC = Depends(get_rpc)):
+    # Advanced pair_candles endpoint with column filtering
+    return rpc._rpc_analysed_dataframe(
+        payload.pair, payload.timeframe, payload.limit, payload.columns)
 
 
 @router.get('/pair_history', response_model=PairHistory, tags=['candle data'])
 def pair_history(pair: str, timeframe: str, timerange: str, strategy: str,
                  freqaimodel: Optional[str] = None,
                  config=Depends(get_config), exchange=Depends(get_exchange)):
     # The initial call to this endpoint can be slow, as it may need to initialize
@@ -296,15 +312,33 @@
     config = deepcopy(config)
     config.update({
         'strategy': strategy,
         'timerange': timerange,
         'freqaimodel': freqaimodel if freqaimodel else config.get('freqaimodel'),
     })
     try:
-        return RPC._rpc_analysed_history_full(config, pair, timeframe, exchange)
+        return RPC._rpc_analysed_history_full(config, pair, timeframe, exchange, None)
+    except Exception as e:
+        raise HTTPException(status_code=502, detail=str(e))
+
+
+@router.post('/pair_history', response_model=PairHistory, tags=['candle data'])
+def pair_history_filtered(payload: PairHistoryRequest,
+                          config=Depends(get_config), exchange=Depends(get_exchange)):
+    # The initial call to this endpoint can be slow, as it may need to initialize
+    # the exchange class.
+    config = deepcopy(config)
+    config.update({
+        'strategy': payload.strategy,
+        'timerange': payload.timerange,
+        'freqaimodel': payload.freqaimodel if payload.freqaimodel else config.get('freqaimodel'),
+    })
+    try:
+        return RPC._rpc_analysed_history_full(
+            config, payload.pair, payload.timeframe, exchange, payload.columns)
     except Exception as e:
         raise HTTPException(status_code=502, detail=str(e))
 
 
 @router.get('/plot_config', response_model=PlotConfig, tags=['candle data'])
 def plot_config(strategy: Optional[str] = None, config=Depends(get_config),
                 rpc: Optional[RPC] = Depends(get_rpc_optional)):
```

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/api_ws.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/api_ws.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/deps.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/deps.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/ui/fallback_file.html` & `freqtrade-2024.4/freqtrade/rpc/api_server/ui/fallback_file.html`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/ui/favicon.ico` & `freqtrade-2024.4/freqtrade/rpc/api_server/ui/favicon.ico`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/uvicorn_threaded.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/uvicorn_threaded.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/web_ui.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/web_ui.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/webserver.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/webserver.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/webserver_bgwork.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/webserver_bgwork.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/ws/channel.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/ws/channel.py`

 * *Files 1% similar despite different names*

```diff
@@ -148,15 +148,15 @@
 
     def is_closed(self) -> bool:
         """
         Closed flag
         """
         return self._closed.is_set()
 
-    def set_subscriptions(self, subscriptions: List[str] = []) -> None:
+    def set_subscriptions(self, subscriptions: List[str]) -> None:
         """
         Set which subscriptions this channel is subscribed to
 
         :param subscriptions: List of subscriptions, List[str]
         """
         self._subscriptions = subscriptions
```

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/ws/message_stream.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/ws/message_stream.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/ws/proxy.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/ws/proxy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/ws/serializer.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/ws/serializer.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/api_server/ws_schemas.py` & `freqtrade-2024.4/freqtrade/rpc/api_server/ws_schemas.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/discord.py` & `freqtrade-2024.4/freqtrade/rpc/discord.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/external_message_consumer.py` & `freqtrade-2024.4/freqtrade/rpc/external_message_consumer.py`

 * *Files 0% similar despite different names*

```diff
@@ -233,15 +233,15 @@
                 websockets.exceptions.ConnectionClosedOK
             ):
                 # Just keep trying to connect again indefinitely
                 await asyncio.sleep(self.sleep_time)
                 continue
 
             except Exception as e:
-                # An unforseen error has occurred, log and continue
+                # An unforeseen error has occurred, log and continue
                 logger.error("Unexpected error has occurred:")
                 logger.exception(e)
                 await asyncio.sleep(self.sleep_time)
                 continue
 
     async def _send_requests(self, channel: WebSocketChannel, channel_stream: MessageStream):
         # Send the initial requests
@@ -383,15 +383,15 @@
             last_analyzed=la,
             timeframe=timeframe,
             candle_type=candle_type,
             producer_name=producer_name
             )
 
         if not did_append:
-            # We want an overlap in candles incase some data has changed
+            # We want an overlap in candles in case some data has changed
             n_missing += 1
             # Set to None for all candles if we missed a full df's worth of candles
             n_missing = n_missing if n_missing < FULL_DATAFRAME_THRESHOLD else 1500
 
             logger.warning(f"Holes in data or no existing df, requesting {n_missing} candles "
                            f"for {key} from `{producer_name}`")
```

### Comparing `freqtrade-2024.3/freqtrade/rpc/fiat_convert.py` & `freqtrade-2024.4/freqtrade/rpc/fiat_convert.py`

 * *Files 6% similar despite different names*

```diff
@@ -35,43 +35,43 @@
 class CryptoToFiatConverter(LoggingMixin):
     """
     Main class to initiate Crypto to FIAT.
     This object contains a list of pair Crypto, FIAT
     This object is also a Singleton
     """
     __instance = None
-    _coingekko: CoinGeckoAPI = None
+    _coingecko: CoinGeckoAPI = None
     _coinlistings: List[Dict] = []
     _backoff: float = 0.0
 
     def __new__(cls):
         """
         This class is a singleton - cannot be instantiated twice.
         """
         if CryptoToFiatConverter.__instance is None:
             CryptoToFiatConverter.__instance = object.__new__(cls)
             try:
                 # Limit retires to 1 (0 and 1)
                 # otherwise we risk bot impact if coingecko is down.
-                CryptoToFiatConverter._coingekko = CoinGeckoAPI(retries=1)
+                CryptoToFiatConverter._coingecko = CoinGeckoAPI(retries=1)
             except BaseException:
-                CryptoToFiatConverter._coingekko = None
+                CryptoToFiatConverter._coingecko = None
         return CryptoToFiatConverter.__instance
 
     def __init__(self) -> None:
         # Timeout: 6h
         self._pair_price: TTLCache = TTLCache(maxsize=500, ttl=6 * 60 * 60)
 
         LoggingMixin.__init__(self, logger, 3600)
         self._load_cryptomap()
 
     def _load_cryptomap(self) -> None:
         try:
             # Use list-comprehension to ensure we get a list.
-            self._coinlistings = [x for x in self._coingekko.get_coins_list()]
+            self._coinlistings = [x for x in self._coingecko.get_coins_list()]
         except RequestException as request_exception:
             if "429" in str(request_exception):
                 logger.warning(
                     "Too many requests for CoinGecko API, backing off and trying again later.")
                 # Set backoff timestamp to 60 seconds in the future
                 self._backoff = datetime.now().timestamp() + 60
                 return
@@ -80,15 +80,15 @@
                 "Could not load FIAT Cryptocurrency map for the following problem: "
                 f"{request_exception}"
             )
         except (Exception) as exception:
             logger.error(
                 f"Could not load FIAT Cryptocurrency map for the following problem: {exception}")
 
-    def _get_gekko_id(self, crypto_symbol):
+    def _get_gecko_id(self, crypto_symbol):
         if not self._coinlistings:
             if self._backoff <= datetime.now().timestamp():
                 self._load_cryptomap()
                 # Still not loaded.
                 if not self._coinlistings:
                     return None
             else:
@@ -176,26 +176,26 @@
         if not self._is_supported_fiat(fiat=fiat_symbol):
             raise ValueError(f'The fiat {fiat_symbol} is not supported.')
 
         # No need to convert if both crypto and fiat are the same
         if crypto_symbol == fiat_symbol:
             return 1.0
 
-        _gekko_id = self._get_gekko_id(crypto_symbol)
+        _gecko_id = self._get_gecko_id(crypto_symbol)
 
-        if not _gekko_id:
+        if not _gecko_id:
             # return 0 for unsupported stake currencies (fiat-convert should not break the bot)
             self.log_once(
                 f"unsupported crypto-symbol {crypto_symbol.upper()} - returning 0.0",
                 logger.warning)
             return 0.0
 
         try:
             return float(
-                self._coingekko.get_price(
-                    ids=_gekko_id,
+                self._coingecko.get_price(
+                    ids=_gecko_id,
                     vs_currencies=fiat_symbol
-                )[_gekko_id][fiat_symbol]
+                )[_gecko_id][fiat_symbol]
             )
         except Exception as exception:
             logger.error("Error in _find_price: %s", exception)
             return 0.0
```

### Comparing `freqtrade-2024.3/freqtrade/rpc/rpc.py` & `freqtrade-2024.4/freqtrade/rpc/rpc.py`

 * *Files 1% similar despite different names*

```diff
@@ -12,30 +12,30 @@
 from dateutil.tz import tzlocal
 from numpy import NAN, inf, int64, mean
 from pandas import DataFrame, NaT
 from sqlalchemy import func, select
 
 from freqtrade import __version__
 from freqtrade.configuration.timerange import TimeRange
-from freqtrade.constants import CANCEL_REASON, Config
+from freqtrade.constants import CANCEL_REASON, DEFAULT_DATAFRAME_COLUMNS, Config
 from freqtrade.data.history import load_data
 from freqtrade.data.metrics import calculate_expectancy, calculate_max_drawdown
 from freqtrade.enums import (CandleType, ExitCheckTuple, ExitType, MarketDirection, SignalDirection,
                              State, TradingMode)
 from freqtrade.exceptions import ExchangeError, PricingError
 from freqtrade.exchange import timeframe_to_minutes, timeframe_to_msecs
 from freqtrade.exchange.types import Tickers
 from freqtrade.loggers import bufferHandler
 from freqtrade.persistence import KeyStoreKeys, KeyValueStore, PairLocks, Trade
 from freqtrade.persistence.models import PairLock
 from freqtrade.plugins.pairlist.pairlist_helpers import expand_pairlist
 from freqtrade.rpc.fiat_convert import CryptoToFiatConverter
 from freqtrade.rpc.rpc_types import RPCSendMsg
-from freqtrade.util import (decimals_per_coin, dt_humanize, dt_now, dt_ts_def, format_date,
-                            shorten_date)
+from freqtrade.util import decimals_per_coin, dt_now, dt_ts_def, format_date, shorten_date
+from freqtrade.util.datetime_helpers import dt_humanize_delta
 from freqtrade.wallets import PositionWallet, Wallet
 
 
 logger = logging.getLogger(__name__)
 
 
 class RPCException(Exception):
@@ -151,15 +151,15 @@
             'max_entry_position_adjustment': (
                 config.get('max_entry_position_adjustment', -1)
                 if config.get('max_entry_position_adjustment') != float('inf')
                 else -1)
         }
         return val
 
-    def _rpc_trade_status(self, trade_ids: List[int] = []) -> List[Dict[str, Any]]:
+    def _rpc_trade_status(self, trade_ids: Optional[List[int]] = None) -> List[Dict[str, Any]]:
         """
         Below follows the RPC backend it is prefixed with rpc_ to raise awareness that it is
         a remotely exposed function
         """
         # Fetch open trades
         if trade_ids:
             trades: Sequence[Trade] = Trade.get_trades(trade_filter=Trade.id.in_(trade_ids)).all()
@@ -297,21 +297,21 @@
                         else fiat_profit_sum + trade_profit
 
                 active_attempt_side_symbols = [
                     '*' if (oo and oo.ft_order_side == trade.entry_side) else '**'
                     for oo in trade.open_orders
                 ]
 
-                # exemple: '*.**.**' trying to enter, exit and exit with 3 different orders
+                # example: '*.**.**' trying to enter, exit and exit with 3 different orders
                 active_attempt_side_symbols_str = '.'.join(active_attempt_side_symbols)
 
                 detail_trade = [
                     f'{trade.id} {direction_str}',
                     trade.pair + active_attempt_side_symbols_str,
-                    shorten_date(dt_humanize(trade.open_date, only_distance=True)),
+                    shorten_date(dt_humanize_delta(trade.open_date_utc)),
                     profit_str
                 ]
 
                 if self._config.get('position_adjustment_enable', False):
                     max_entry_str = ''
                     if self._config.get('max_entry_position_adjustment', -1) > 0:
                         max_entry_str = f"/{self._config['max_entry_position_adjustment'] + 1}"
@@ -456,16 +456,19 @@
         losses_dur = sum(dur['losses']) / len(dur['losses']) if len(dur['losses']) > 0 else None
 
         durations = {'wins': wins_dur, 'draws': draws_dur, 'losses': losses_dur}
         return {'exit_reasons': exit_reasons, 'durations': durations}
 
     def _rpc_trade_statistics(
             self, stake_currency: str, fiat_display_currency: str,
-            start_date: datetime = datetime.fromtimestamp(0)) -> Dict[str, Any]:
+            start_date: Optional[datetime] = None) -> Dict[str, Any]:
         """ Returns cumulative profit statistics """
+
+        start_date = datetime.fromtimestamp(0) if start_date is None else start_date
+
         trade_filter = ((Trade.is_open.is_(False) & (Trade.close_date >= start_date)) |
                         Trade.is_open.is_(True))
         trades: Sequence[Trade] = Trade.session.scalars(Trade.get_trades_query(
             trade_filter, include_orders=False).order_by(Trade.id)).all()
 
         profit_all_coin = []
         profit_all_ratio = []
@@ -592,18 +595,18 @@
             'profit_all_ratio_sum': profit_all_ratio_sum,
             'profit_all_ratio': profit_all_ratio_fromstart,
             'profit_all_percent': round(profit_all_ratio_fromstart * 100, 2),
             'profit_all_fiat': profit_all_fiat,
             'trade_count': len(trades),
             'closed_trade_count': closed_trade_count,
             'first_trade_date': format_date(first_date),
-            'first_trade_humanized': dt_humanize(first_date) if first_date else '',
+            'first_trade_humanized': dt_humanize_delta(first_date) if first_date else '',
             'first_trade_timestamp': dt_ts_def(first_date, 0),
             'latest_trade_date': format_date(last_date),
-            'latest_trade_humanized': dt_humanize(last_date) if last_date else '',
+            'latest_trade_humanized': dt_humanize_delta(last_date) if last_date else '',
             'latest_trade_timestamp': dt_ts_def(last_date, 0),
             'avg_duration': str(timedelta(seconds=sum(durations) / num)).split('.')[0],
             'best_pair': best_pair[0] if best_pair else '',
             'best_rate': round(best_pair[1] * 100, 2) if best_pair else 0,  # Deprecated
             'best_pair_profit_ratio': best_pair[1] if best_pair else 0,
             'winning_trades': winning_trades,
             'losing_trades': losing_trades,
@@ -1100,14 +1103,24 @@
             lock.active = False
             lock.lock_end_time = datetime.now(timezone.utc)
 
         Trade.commit()
 
         return self._rpc_locks()
 
+    def _rpc_add_lock(
+            self, pair: str, until: datetime, reason: Optional[str], side: str) -> PairLock:
+        lock = PairLocks.lock_pair(
+            pair=pair,
+            until=until,
+            reason=reason,
+            side=side,
+        )
+        return lock
+
     def _rpc_whitelist(self) -> Dict:
         """ Returns the currently active whitelist"""
         res = {'method': self._freqtrade.pairlists.name_list,
                'length': len(self._freqtrade.active_pair_whitelist),
                'whitelist': self._freqtrade.active_pair_whitelist
                }
         return res
@@ -1173,24 +1186,31 @@
     def _rpc_edge(self) -> List[Dict[str, Any]]:
         """ Returns information related to Edge """
         if not self._freqtrade.edge:
             raise RPCException('Edge is not enabled.')
         return self._freqtrade.edge.accepted_pairs()
 
     @staticmethod
-    def _convert_dataframe_to_dict(strategy: str, pair: str, timeframe: str, dataframe: DataFrame,
-                                   last_analyzed: datetime) -> Dict[str, Any]:
+    def _convert_dataframe_to_dict(
+            strategy: str, pair: str, timeframe: str, dataframe: DataFrame,
+            last_analyzed: datetime, selected_cols: Optional[List[str]]) -> Dict[str, Any]:
         has_content = len(dataframe) != 0
+        dataframe_columns = list(dataframe.columns)
         signals = {
             'enter_long': 0,
             'exit_long': 0,
             'enter_short': 0,
             'exit_short': 0,
         }
         if has_content:
+            if selected_cols is not None:
+                # Ensure OHLCV columns are always present
+                cols_set = set(DEFAULT_DATAFRAME_COLUMNS + list(signals.keys()) + selected_cols)
+                df_cols = [col for col in dataframe_columns if col in cols_set]
+                dataframe = dataframe.loc[:, df_cols]
 
             dataframe.loc[:, '__date_ts'] = dataframe.loc[:, 'date'].astype(int64) // 1000 // 1000
             # Move signal close to separate column when signal for easy plotting
             for sig_type in signals.keys():
                 if sig_type in dataframe.columns:
                     mask = (dataframe[sig_type] == 1)
                     signals[sig_type] = int(mask.sum())
@@ -1207,14 +1227,15 @@
             dataframe = dataframe.replace({inf: None, -inf: None, NAN: None})
 
         res = {
             'pair': pair,
             'timeframe': timeframe,
             'timeframe_ms': timeframe_to_msecs(timeframe),
             'strategy': strategy,
+            'all_columns': dataframe_columns,
             'columns': list(dataframe.columns),
             'data': dataframe.values.tolist(),
             'length': len(dataframe),
             'buy_signals': signals['enter_long'],  # Deprecated
             'sell_signals': signals['exit_long'],  # Deprecated
             'enter_long_signals': signals['enter_long'],
             'exit_long_signals': signals['exit_long'],
@@ -1232,21 +1253,24 @@
                 'data_start': str(dataframe.iloc[0]['date']),
                 'data_start_ts': int(dataframe.iloc[0]['__date_ts']),
                 'data_stop': str(dataframe.iloc[-1]['date']),
                 'data_stop_ts': int(dataframe.iloc[-1]['__date_ts']),
             })
         return res
 
-    def _rpc_analysed_dataframe(self, pair: str, timeframe: str,
-                                limit: Optional[int]) -> Dict[str, Any]:
+    def _rpc_analysed_dataframe(
+            self, pair: str, timeframe: str, limit: Optional[int],
+            selected_cols: Optional[List[str]]) -> Dict[str, Any]:
         """ Analyzed dataframe in Dict form """
 
         _data, last_analyzed = self.__rpc_analysed_dataframe_raw(pair, timeframe, limit)
-        return RPC._convert_dataframe_to_dict(self._freqtrade.config['strategy'],
-                                              pair, timeframe, _data, last_analyzed)
+        return RPC._convert_dataframe_to_dict(
+            self._freqtrade.config['strategy'], pair, timeframe, _data, last_analyzed,
+            selected_cols
+        )
 
     def __rpc_analysed_dataframe_raw(
         self,
         pair: str,
         timeframe: str,
         limit: Optional[int]
     ) -> Tuple[DataFrame, datetime]:
@@ -1305,15 +1329,15 @@
 
     def _ws_request_whitelist(self):
         """ Whitelist data for WebSocket """
         return self._freqtrade.active_pair_whitelist
 
     @staticmethod
     def _rpc_analysed_history_full(config: Config, pair: str, timeframe: str,
-                                   exchange) -> Dict[str, Any]:
+                                   exchange, selected_cols: Optional[List[str]]) -> Dict[str, Any]:
         timerange_parsed = TimeRange.parse_timerange(config.get('timerange'))
 
         from freqtrade.data.converter import trim_dataframe
         from freqtrade.data.dataprovider import DataProvider
         from freqtrade.resolvers.strategy_resolver import StrategyResolver
 
         strategy = StrategyResolver.load_strategy(config)
@@ -1335,15 +1359,16 @@
         strategy.dp = DataProvider(config, exchange=exchange, pairlists=None)
         strategy.ft_bot_start()
 
         df_analyzed = strategy.analyze_ticker(_data[pair], {'pair': pair})
         df_analyzed = trim_dataframe(df_analyzed, timerange_parsed, startup_candles=startup_candles)
 
         return RPC._convert_dataframe_to_dict(strategy.get_strategy_name(), pair, timeframe,
-                                              df_analyzed.copy(), dt_now())
+                                              df_analyzed.copy(), dt_now(),
+                                              selected_cols)
 
     def _rpc_plot_config(self) -> Dict[str, Any]:
         if (self._freqtrade.strategy.plot_config and
                 'subplots' not in self._freqtrade.strategy.plot_config):
             self._freqtrade.strategy.plot_config['subplots'] = {}
         return self._freqtrade.strategy.plot_config
```

### Comparing `freqtrade-2024.3/freqtrade/rpc/rpc_manager.py` & `freqtrade-2024.4/freqtrade/rpc/rpc_manager.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/rpc_types.py` & `freqtrade-2024.4/freqtrade/rpc/rpc_types.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/rpc/telegram.py` & `freqtrade-2024.4/freqtrade/rpc/telegram.py`

 * *Files 0% similar despite different names*

```diff
@@ -29,15 +29,15 @@
 from freqtrade.constants import DUST_PER_COIN, Config
 from freqtrade.enums import MarketDirection, RPCMessageType, SignalDirection, TradingMode
 from freqtrade.exceptions import OperationalException
 from freqtrade.misc import chunks, plural
 from freqtrade.persistence import Trade
 from freqtrade.rpc import RPC, RPCException, RPCHandler
 from freqtrade.rpc.rpc_types import RPCEntryMsg, RPCExitMsg, RPCOrderMsg, RPCSendMsg
-from freqtrade.util import dt_humanize, fmt_coin, format_date, round_value
+from freqtrade.util import dt_from_ts, dt_humanize_delta, fmt_coin, format_date, round_value
 
 
 MAX_MESSAGE_LENGTH = MessageLimit.MAX_TEXT_LENGTH
 
 
 logger = logging.getLogger(__name__)
 
@@ -484,15 +484,15 @@
 
         elif msg['type'] == RPCMessageType.STATUS:
             message = f"*Status:* `{msg['status']}`"
 
         elif msg['type'] == RPCMessageType.WARNING:
             message = f"\N{WARNING SIGN} *Warning:* `{msg['status']}`"
         elif msg['type'] == RPCMessageType.EXCEPTION:
-            # Errors will contain exceptions, which are wrapped in tripple ticks.
+            # Errors will contain exceptions, which are wrapped in triple ticks.
             message = f"\N{WARNING SIGN} *ERROR:* \n {msg['status']}"
 
         elif msg['type'] == RPCMessageType.STARTUP:
             message = f"{msg['status']}"
         elif msg['type'] == RPCMessageType.STRATEGY_MSG:
             message = f"{msg['msg']}"
         else:
@@ -569,16 +569,15 @@
                     f"({fmt_coin(order['cost'], quote_currency)})"
                 )
                 lines.append(f"*Average Price:* {round_value(cur_entry_average, 8)}")
             else:
                 # TODO: This calculation ignores fees.
                 price_to_1st_entry = ((cur_entry_average - first_avg) / first_avg)
                 if is_open:
-                    lines.append("({})".format(dt_humanize(order["order_filled_date"],
-                                                           granularity=["day", "hour", "minute"])))
+                    lines.append("({})".format(dt_humanize_delta(order["order_filled_date"])))
                 lines.append(f"*Amount:* {round_value(cur_entry_amount, 8)} "
                              f"({fmt_coin(order['cost'], quote_currency)})")
                 lines.append(f"*Average {wording} Price:* {round_value(cur_entry_average, 8)} "
                              f"({price_to_1st_entry:.2%} from 1st entry rate)")
                 lines.append(f"*Order Filled:* {order['order_filled_date']}")
 
             lines_detail.append("\n".join(lines))
@@ -653,15 +652,15 @@
         if context.args and len(context.args) > 0:
             trade_ids = [int(i) for i in context.args if i.isnumeric()]
 
         results = self._rpc._rpc_trade_status(trade_ids=trade_ids)
         position_adjust = self._config.get('position_adjustment_enable', False)
         max_entries = self._config.get('max_entry_position_adjustment', -1)
         for r in results:
-            r['open_date_hum'] = dt_humanize(r['open_date'])
+            r['open_date_hum'] = dt_humanize_delta(r['open_date'])
             r['num_entries'] = len([o for o in r['orders'] if o['ft_is_entry']])
             r['num_exits'] = len([o for o in r['orders'] if not o['ft_is_entry']
                                  and not o['ft_order_side'] == 'stoploss'])
             r['exit_reason'] = r.get('exit_reason', "")
             r['stake_amount_r'] = fmt_coin(r['stake_amount'], r['quote_currency'])
             r['max_stake_amount_r'] = fmt_coin(
                 r['max_stake_amount'] or r['stake_amount'], r['quote_currency'])
@@ -1170,15 +1169,15 @@
                 for trade in trades]
             buttons_aligned = self._layout_inline_keyboard_onecol(trade_buttons)
 
             buttons_aligned.append([InlineKeyboardButton(
                 text='Cancel', callback_data='force_exit__cancel')])
             await self._send_msg(msg="Which trade?", keyboard=buttons_aligned)
 
-    async def _force_exit_action(self, trade_id):
+    async def _force_exit_action(self, trade_id: str):
         if trade_id != 'cancel':
             try:
                 loop = asyncio.get_running_loop()
                 # Workaround to avoid nested loops
                 await loop.run_in_executor(None, safe_async_db(self._rpc._rpc_force_exit), trade_id)
             except RPCException as e:
                 await self._send_msg(str(e))
@@ -1285,15 +1284,15 @@
             nrecent = int(context.args[0]) if context.args else 10
         except (TypeError, ValueError, IndexError):
             nrecent = 10
         trades = self._rpc._rpc_trade_history(
             nrecent
         )
         trades_tab = tabulate(
-            [[dt_humanize(trade['close_date']),
+            [[dt_humanize_delta(dt_from_ts(trade['close_timestamp'])),
                 trade['pair'] + " (#" + str(trade['trade_id']) + ")",
                 f"{(trade['close_profit']):.2%} ({trade['close_profit_abs']})"]
                 for trade in trades['trades']],
             headers=[
                 'Close Date',
                 'Pair (ID)',
                 f'Profit ({stake_cur})',
@@ -1545,15 +1544,15 @@
         Handler for /blacklist
         Shows the currently active blacklist
         """
         await self.send_blacklist_msg(self._rpc._rpc_blacklist(context.args))
 
     async def send_blacklist_msg(self, blacklist: Dict):
         errmsgs = []
-        for pair, error in blacklist['errors'].items():
+        for _, error in blacklist['errors'].items():
             errmsgs.append(f"Error: {error['error_msg']}")
         if errmsgs:
             await self._send_msg('\n'.join(errmsgs))
 
         message = f"Blacklist contains {blacklist['length']} pairs\n"
         message += f"`{', '.join(blacklist['blacklist'])}`"
```

### Comparing `freqtrade-2024.3/freqtrade/rpc/webhook.py` & `freqtrade-2024.4/freqtrade/rpc/webhook.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/strategy/__init__.py` & `freqtrade-2024.4/freqtrade/strategy/__init__.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/strategy/hyper.py` & `freqtrade-2024.4/freqtrade/strategy/hyper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/strategy/informative_decorator.py` & `freqtrade-2024.4/freqtrade/strategy/informative_decorator.py`

 * *Files 1% similar despite different names*

```diff
@@ -60,15 +60,15 @@
     _fmt = fmt
     _ffill = ffill
     _candle_type = CandleType.from_string(candle_type) if candle_type else None
 
     def decorator(fn: PopulateIndicators):
         informative_pairs = getattr(fn, '_ft_informative', [])
         informative_pairs.append(InformativeData(_asset, _timeframe, _fmt, _ffill, _candle_type))
-        setattr(fn, '_ft_informative', informative_pairs)
+        setattr(fn, '_ft_informative', informative_pairs)  # noqa: B010
         return fn
     return decorator
 
 
 def __get_pair_formats(market: Optional[Dict[str, Any]]) -> Dict[str, str]:
     if not market:
         return {}
```

### Comparing `freqtrade-2024.3/freqtrade/strategy/interface.py` & `freqtrade-2024.4/freqtrade/strategy/interface.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/strategy/parameters.py` & `freqtrade-2024.4/freqtrade/strategy/parameters.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/strategy/strategy_helper.py` & `freqtrade-2024.4/freqtrade/strategy/strategy_helper.py`

 * *Files 0% similar despite different names*

```diff
@@ -74,15 +74,15 @@
         date_merge = f'date_merge_{suffix}'
         informative.columns = [f"{col}_{suffix}" for col in informative.columns]
 
     # Combine the 2 dataframes
     # all indicators on the informative sample MUST be calculated before this point
     if ffill:
         # https://pandas.pydata.org/docs/user_guide/merging.html#timeseries-friendly-merging
-        # merge_ordered - ffill method is 2.5x faster than seperate ffill()
+        # merge_ordered - ffill method is 2.5x faster than separate ffill()
         dataframe = pd.merge_ordered(dataframe, informative, fill_method="ffill", left_on='date',
                                      right_on=date_merge, how='left')
     else:
         dataframe = pd.merge(dataframe, informative, left_on='date',
                              right_on=date_merge, how='left')
     dataframe = dataframe.drop(date_merge, axis=1)
```

### Comparing `freqtrade-2024.3/freqtrade/strategy/strategy_wrapper.py` & `freqtrade-2024.4/freqtrade/strategy/strategy_wrapper.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/strategy/strategyupdater.py` & `freqtrade-2024.4/freqtrade/strategy/strategyupdater.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/templates/FreqaiExampleHybridStrategy.py` & `freqtrade-2024.4/freqtrade/templates/FreqaiExampleHybridStrategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/templates/FreqaiExampleStrategy.py` & `freqtrade-2024.4/freqtrade/templates/FreqaiExampleStrategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/templates/base_config.json.j2` & `freqtrade-2024.4/freqtrade/templates/base_config.json.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/templates/base_strategy.py.j2` & `freqtrade-2024.4/freqtrade/templates/base_strategy.py.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/templates/sample_hyperopt_loss.py` & `freqtrade-2024.4/freqtrade/templates/sample_hyperopt_loss.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/templates/sample_strategy.py` & `freqtrade-2024.4/freqtrade/templates/sample_strategy.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/templates/strategy_analysis_example.ipynb` & `freqtrade-2024.4/freqtrade/templates/strategy_analysis_example.ipynb`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/indicators_full.j2` & `freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/indicators_full.j2`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2` & `freqtrade-2024.4/freqtrade/templates/strategy_subtemplates/strategy_methods_advanced.j2`

 * *Files 1% similar despite different names*

```diff
@@ -1,13 +1,13 @@
 
 def bot_loop_start(self, current_time: datetime, **kwargs) -> None:
     """
     Called at the start of the bot iteration (one loop).
     Might be used to perform pair-independent tasks
-    (e.g. gather some remote ressource for comparison)
+    (e.g. gather some remote resource for comparison)
 
     For full documentation please go to https://www.freqtrade.io/en/latest/strategy-advanced/
 
     When not implemented by a strategy, this simply does nothing.
     :param current_time: datetime object, containing the current datetime
     :param **kwargs: Ensure to keep this here so updates to this won't break your strategy.
     """
```

### Comparing `freqtrade-2024.3/freqtrade/types/backtest_result_type.py` & `freqtrade-2024.4/freqtrade/types/backtest_result_type.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/util/__init__.py` & `freqtrade-2024.4/freqtrade/util/__init__.py`

 * *Files 8% similar despite different names*

```diff
@@ -1,27 +1,29 @@
-from freqtrade.util.datetime_helpers import (dt_floor_day, dt_from_ts, dt_humanize, dt_now, dt_ts,
-                                             dt_ts_def, dt_ts_none, dt_utc, format_date,
+from freqtrade.util.datetime_helpers import (dt_floor_day, dt_from_ts, dt_humanize_delta, dt_now,
+                                             dt_ts, dt_ts_def, dt_ts_none, dt_utc, format_date,
                                              format_ms_time, shorten_date)
 from freqtrade.util.formatters import decimals_per_coin, fmt_coin, round_value
 from freqtrade.util.ft_precise import FtPrecise
+from freqtrade.util.measure_time import MeasureTime
 from freqtrade.util.periodic_cache import PeriodicCache
 from freqtrade.util.template_renderer import render_template, render_template_with_fallback  # noqa
 
 
 __all__ = [
     'dt_floor_day',
     'dt_from_ts',
-    'dt_humanize',
+    'dt_humanize_delta',
     'dt_now',
     'dt_ts',
     'dt_ts_def',
     'dt_ts_none',
     'dt_utc',
     'format_date',
     'format_ms_time',
     'FtPrecise',
     'PeriodicCache',
     'shorten_date',
     'decimals_per_coin',
     'round_value',
     'fmt_coin',
+    'MeasureTime',
 ]
```

### Comparing `freqtrade-2024.3/freqtrade/util/datetime_helpers.py` & `freqtrade-2024.4/freqtrade/util/datetime_helpers.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,12 +1,13 @@
 import re
 from datetime import datetime, timezone
-from typing import Optional
+from time import time
+from typing import Optional, Union
 
-import arrow
+import humanize
 
 from freqtrade.constants import DATETIME_PRINT_FORMAT
 
 
 def dt_now() -> datetime:
     """Return the current datetime in UTC."""
     return datetime.now(timezone.utc)
@@ -21,15 +22,15 @@
 def dt_ts(dt: Optional[datetime] = None) -> int:
     """
     Return dt in ms as a timestamp in UTC.
     If dt is None, return the current datetime in UTC.
     """
     if dt:
         return int(dt.timestamp() * 1000)
-    return int(dt_now().timestamp() * 1000)
+    return int(time() * 1000)
 
 
 def dt_ts_def(dt: Optional[datetime], default: int = 0) -> int:
     """
     Return dt in ms as a timestamp in UTC.
     If dt is None, return the given default.
     """
@@ -72,33 +73,31 @@
     new_date = re.sub('minutes?', 'min', new_date)
     new_date = re.sub('hours?', 'h', new_date)
     new_date = re.sub('days?', 'd', new_date)
     new_date = re.sub('^an?', '1', new_date)
     return new_date
 
 
-def dt_humanize(dt: datetime, **kwargs) -> str:
+def dt_humanize_delta(dt: datetime):
     """
-    Return a humanized string for the given datetime.
-    :param dt: datetime to humanize
-    :param kwargs: kwargs to pass to arrow's humanize()
+    Return a humanized string for the given timedelta.
     """
-    return arrow.get(dt).humanize(**kwargs)
+    return humanize.naturaltime(dt)
 
 
 def format_date(date: Optional[datetime]) -> str:
     """
     Return a formatted date string.
     Returns an empty string if date is None.
     :param date: datetime to format
     """
     if date:
         return date.strftime(DATETIME_PRINT_FORMAT)
     return ''
 
 
-def format_ms_time(date: int) -> str:
+def format_ms_time(date: Union[int, float]) -> str:
     """
     convert MS date to readable format.
     : epoch-string in ms
     """
-    return datetime.fromtimestamp(date / 1000.0).strftime('%Y-%m-%dT%H:%M:%S')
+    return dt_from_ts(date).strftime('%Y-%m-%dT%H:%M:%S')
```

### Comparing `freqtrade-2024.3/freqtrade/util/formatters.py` & `freqtrade-2024.4/freqtrade/util/formatters.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/util/migrations/binance_mig.py` & `freqtrade-2024.4/freqtrade/util/migrations/binance_mig.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/util/migrations/funding_rate_mig.py` & `freqtrade-2024.4/freqtrade/util/migrations/funding_rate_mig.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/util/periodic_cache.py` & `freqtrade-2024.4/freqtrade/util/periodic_cache.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/util/template_renderer.py` & `freqtrade-2024.4/freqtrade/util/template_renderer.py`

 * *Files 5% similar despite different names*

```diff
@@ -1,27 +1,32 @@
 """
 Jinja2 rendering utils, used to generate new strategy and configurations.
 """
 
 
-def render_template(templatefile: str, arguments: dict = {}) -> str:
+from typing import Dict, Optional
+
+
+def render_template(templatefile: str, arguments: Dict) -> str:
 
     from jinja2 import Environment, PackageLoader, select_autoescape
 
     env = Environment(
         loader=PackageLoader('freqtrade', 'templates'),
         autoescape=select_autoescape(['html', 'xml'])
     )
     template = env.get_template(templatefile)
     return template.render(**arguments)
 
 
 def render_template_with_fallback(templatefile: str, templatefallbackfile: str,
-                                  arguments: dict = {}) -> str:
+                                  arguments: Optional[Dict] = None) -> str:
     """
     Use templatefile if possible, otherwise fall back to templatefallbackfile
     """
     from jinja2.exceptions import TemplateNotFound
+    if arguments is None:
+        arguments = {}
     try:
         return render_template(templatefile, arguments)
     except TemplateNotFound:
         return render_template(templatefallbackfile, arguments)
```

### Comparing `freqtrade-2024.3/freqtrade/vendor/qtpylib/indicators.py` & `freqtrade-2024.4/freqtrade/vendor/qtpylib/indicators.py`

 * *Files identical despite different names*

### Comparing `freqtrade-2024.3/freqtrade/wallets.py` & `freqtrade-2024.4/freqtrade/wallets.py`

 * *Files 0% similar despite different names*

```diff
@@ -66,15 +66,15 @@
             return balance.total
         else:
             return 0
 
     def _update_dry(self) -> None:
         """
         Update from database in dry-run mode
-        - Apply apply profits of closed trades on top of stake amount
+        - Apply profits of closed trades on top of stake amount
         - Subtract currently tied up stake_amount in open trades
         - update balances for currencies currently in trades
         """
         # Recreate _wallets to reset closed trade balances
         _wallets = {}
         _positions = {}
         open_trades = Trade.get_trades_proxy(is_open=True)
@@ -302,15 +302,15 @@
             self, pair: str, max_open_trades: IntOrInf, edge=None, update: bool = True) -> float:
         """
         Calculate stake amount for the trade
         :return: float: Stake amount
         :raise: DependencyException if the available stake amount is too low
         """
         stake_amount: float
-        # Ensure wallets are uptodate.
+        # Ensure wallets are up-to-date.
         if update:
             self.update()
         val_tied_up = Trade.total_open_trades_stakes()
         available_amount = self.get_available_stake_amount()
 
         if edge:
             stake_amount = edge.stake_amount(
```

### Comparing `freqtrade-2024.3/freqtrade/worker.py` & `freqtrade-2024.4/freqtrade/worker.py`

 * *Files 0% similar despite different names*

```diff
@@ -133,15 +133,15 @@
     def _throttle(self, func: Callable[..., Any], throttle_secs: float,
                   timeframe: Optional[str] = None, timeframe_offset: float = 1.0,
                   *args, **kwargs) -> Any:
         """
         Throttles the given callable that it
         takes at least `min_secs` to finish execution.
         :param func: Any callable
-        :param throttle_secs: throttling interation execution time limit in seconds
+        :param throttle_secs: throttling iteration execution time limit in seconds
         :param timeframe: ensure iteration is executed at the beginning of the next candle.
         :param timeframe_offset: offset in seconds to apply to the next candle time.
         :return: Any (result of execution of func)
         """
         last_throttle_start_time = time.time()
         logger.debug("========================================")
         result = func(*args, **kwargs)
```

### Comparing `freqtrade-2024.3/freqtrade.egg-info/PKG-INFO` & `freqtrade-2024.4/freqtrade.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: freqtrade
-Version: 2024.3
+Version: 2024.4
 Summary: Freqtrade - Crypto Trading Bot
 Home-page: https://github.com/freqtrade/freqtrade
 Author: Freqtrade Team
 Author-email: Freqtrade Team <freqtrade@protonmail.com>
 License: GPLv3
 Project-URL: Homepage, https://github.com/freqtrade/freqtrade
 Project-URL: Documentation, https://freqtrade.io
@@ -21,22 +21,22 @@
 Classifier: Topic :: Office/Business :: Financial :: Investment
 Requires-Python: >=3.9
 Description-Content-Type: text/markdown
 License-File: LICENSE
 Requires-Dist: ccxt>=4.2.47
 Requires-Dist: SQLAlchemy>=2.0.6
 Requires-Dist: python-telegram-bot>=20.1
-Requires-Dist: arrow>=1.0.0
+Requires-Dist: humanize>=4.0.0
 Requires-Dist: cachetools
 Requires-Dist: requests
 Requires-Dist: httpx>=0.24.1
 Requires-Dist: urllib3
 Requires-Dist: jsonschema
 Requires-Dist: numpy
-Requires-Dist: pandas
+Requires-Dist: pandas<3.0,>=2.2.0
 Requires-Dist: TA-Lib
 Requires-Dist: pandas-ta
 Requires-Dist: technical
 Requires-Dist: tabulate
 Requires-Dist: pycoingecko
 Requires-Dist: py_find_1st
 Requires-Dist: python-rapidjson
```

### Comparing `freqtrade-2024.3/freqtrade.egg-info/SOURCES.txt` & `freqtrade-2024.4/freqtrade.egg-info/SOURCES.txt`

 * *Files 1% similar despite different names*

```diff
@@ -79,27 +79,29 @@
 freqtrade/enums/runmode.py
 freqtrade/enums/signaltype.py
 freqtrade/enums/state.py
 freqtrade/enums/tradingmode.py
 freqtrade/exchange/__init__.py
 freqtrade/exchange/binance.py
 freqtrade/exchange/binance_leverage_tiers.json
+freqtrade/exchange/bingx.py
 freqtrade/exchange/bitmart.py
 freqtrade/exchange/bitpanda.py
 freqtrade/exchange/bitvavo.py
 freqtrade/exchange/bybit.py
 freqtrade/exchange/check_exchange.py
 freqtrade/exchange/coinbasepro.py
 freqtrade/exchange/common.py
 freqtrade/exchange/exchange.py
 freqtrade/exchange/exchange_utils.py
 freqtrade/exchange/exchange_utils_timeframe.py
 freqtrade/exchange/gate.py
 freqtrade/exchange/hitbtc.py
 freqtrade/exchange/htx.py
+freqtrade/exchange/idex.py
 freqtrade/exchange/kraken.py
 freqtrade/exchange/kucoin.py
 freqtrade/exchange/okx.py
 freqtrade/exchange/types.py
 freqtrade/freqai/__init__.py
 freqtrade/freqai/data_drawer.py
 freqtrade/freqai/data_kitchen.py
@@ -306,14 +308,15 @@
 freqtrade/types/backtest_result_type.py
 freqtrade/types/valid_exchanges_type.py
 freqtrade/util/__init__.py
 freqtrade/util/datetime_helpers.py
 freqtrade/util/formatters.py
 freqtrade/util/ft_precise.py
 freqtrade/util/gc_setup.py
+freqtrade/util/measure_time.py
 freqtrade/util/periodic_cache.py
 freqtrade/util/template_renderer.py
 freqtrade/util/migrations/__init__.py
 freqtrade/util/migrations/binance_mig.py
 freqtrade/util/migrations/funding_rate_mig.py
 freqtrade/vendor/__init__.py
 freqtrade/vendor/qtpylib/__init__.py
```

### Comparing `freqtrade-2024.3/freqtrade.egg-info/requires.txt` & `freqtrade-2024.4/freqtrade.egg-info/requires.txt`

 * *Files 5% similar despite different names*

```diff
@@ -1,18 +1,18 @@
 ccxt>=4.2.47
 SQLAlchemy>=2.0.6
 python-telegram-bot>=20.1
-arrow>=1.0.0
+humanize>=4.0.0
 cachetools
 requests
 httpx>=0.24.1
 urllib3
 jsonschema
 numpy
-pandas
+pandas<3.0,>=2.2.0
 TA-Lib
 pandas-ta
 technical
 tabulate
 pycoingecko
 py_find_1st
 python-rapidjson
```

### Comparing `freqtrade-2024.3/pyproject.toml` & `freqtrade-2024.4/pyproject.toml`

 * *Files 8% similar despite different names*

```diff
@@ -84,15 +84,16 @@
 addopts = "--dist loadscope"
 
 [tool.mypy]
 ignore_missing_imports = true
 namespace_packages = false
 warn_unused_ignores = true
 exclude = [
-    '^build_helpers\.py$'
+    '^build_helpers\.py$',
+    '^ft_client/build/.*$',
 ]
 plugins = [
   "sqlalchemy.ext.mypy.plugin"
 ]
 
 [[tool.mypy.overrides]]
 module = "tests.*"
@@ -117,48 +118,59 @@
 extend-exclude = [".env", ".venv"]
 target-version = "py38"
 
 [tool.ruff.lint]
 # Exclude UP036 as it's causing the "exit if < 3.9" to fail.
 extend-select = [
   "C90",    # mccabe
+  # "B",    # bugbear
   # "N",    # pep8-naming
   "F",      # pyflakes
   "E",      # pycodestyle
   "W",      # pycodestyle
   "UP",     # pyupgrade
   "TID",    # flake8-tidy-imports
   # "EXE",  # flake8-executable
+  # "C4",     # flake8-comprehensions
   "YTT",    # flake8-2020
   # "S",    # flake8-bandit
   # "DTZ",  # flake8-datetimez
   # "RSE",  # flake8-raise
   # "TCH",  # flake8-type-checking
   "PTH",    # flake8-use-pathlib
 ]
 
 extend-ignore = [
   "E241",  # Multiple spaces after comma
   "E272",  # Multiple spaces before keyword
   "E221",  # Multiple spaces before operator
+  "B007",  # Loop control variable not used
 ]
 
 [tool.ruff.lint.mccabe]
 max-complexity = 12
 
 [tool.ruff.lint.per-file-ignores]
 "tests/*" = ["S"]
 
+[tool.ruff.lint.flake8-bugbear]
+# Allow default arguments like, e.g., `data: List[str] = fastapi.Query(None)`.
+extend-immutable-calls = ["fastapi.Depends", "fastapi.Query"]
+
 [tool.flake8]
 # Default from https://flake8.pycqa.org/en/latest/user/options.html#cmdoption-flake8-ignore
 # minus E226
 ignore = ["E121","E123","E126","E24","E704","W503","W504"]
 max-line-length = 100
 max-complexity = 12
 exclude = [
     ".git",
     "__pycache__",
     ".eggs",
     "user_data",
     ".venv",
     ".env",
 ]
+
+[tool.codespell]
+ignore-words-list = "coo,fo,strat,zar,selectin"
+skip="*.svg,./user_data,./freqtrade/rpc/api_server/ui/installed"
```

### Comparing `freqtrade-2024.3/setup.py` & `freqtrade-2024.4/setup.py`

 * *Files 4% similar despite different names*

```diff
@@ -69,22 +69,22 @@
         'pytest-mock',
     ],
     install_requires=[
         # from requirements.txt
         'ccxt>=4.2.47',
         'SQLAlchemy>=2.0.6',
         'python-telegram-bot>=20.1',
-        'arrow>=1.0.0',
+        'humanize>=4.0.0',
         'cachetools',
         'requests',
         'httpx>=0.24.1',
         'urllib3',
         'jsonschema',
         'numpy',
-        'pandas',
+        'pandas>=2.2.0,<3.0',
         'TA-Lib',
         'pandas-ta',
         'technical',
         'tabulate',
         'pycoingecko',
         'py_find_1st',
         'python-rapidjson',
```

